<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
        "http://struts.apache.org/dtds/struts-2.5.dtd">

<struts>

    <constant name="struts.beanValidation.providerClass" value="org.hibernate.validator.HibernateValidator"/>
    <constant name="struts.beanValidation.ignoreXMLConfiguration" value="false"/>
    <constant name="struts.xwork.chaining.copyErrors" value="true"/>
    <constant name="struts.xwork.chaining.copyFieldErrors" value="true"/>
    <constant name="struts.xwork.chaining.copyMessages" value="true"/>

    <package name="agentFilesDownloadApi" namespace="/api/agent/downloads" extends="json-default">

        <interceptors>
            <interceptor name="agentDownloadInterceptor"
                         class="com.facilio.bmsconsole.interceptors.AgentFileDownloadInterceptor">
            </interceptor>
            <interceptor name="validationinterceptor"
                         class="com.facilio.bmsconsole.interceptors.ValidationInterceptor" />

            <interceptor-stack name="downloadInterceptorStack">
                <interceptor-ref name="agentDownloadInterceptor"/>
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="validationinterceptor"/>
            </interceptor-stack>
        </interceptors>

        <action name="file" class="com.facilio.bmsconsole.actions.AgentFileDownloadAction" method="downloadFile">
            <interceptor-ref name="downloadInterceptorStack"/>
            <result name="success" type="stream">
                <param name="contentType">application/octet-stream</param>
                <param name="inputName">fileInputStream</param>
                <param name="contentDisposition">attachment;filename="${fileName}"</param>
                <param name="bufferSize">1024</param>
            </result>
            <result name="invalidToken" type="json">
                <param name="includeProperties">errorStatus</param>
            </result>
        </action>

    </package>
    <package name="agentDownloadApi" namespace="/api/agent/download" extends="json-default">

        <interceptors>
            <interceptor name="agentDownloadInterceptor"
                         class="com.facilio.bmsconsole.interceptors.AgentDownloadInterceptor">
            </interceptor>
            <interceptor name="validationinterceptor"
                         class="com.facilio.bmsconsole.interceptors.ValidationInterceptor" />

            <interceptor-stack name="downloadInterceptorStack">
                <interceptor-ref name="agentDownloadInterceptor"/>
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="validationinterceptor"/>
            </interceptor-stack>
        </interceptors>

        <action name="downloadAgent" class="com.facilio.bmsconsole.actions.AgentDownloadAction" method="downloadAgent">
            <interceptor-ref name="downloadInterceptorStack"/>
            <result name="success" type="stream">
                <param name="contentType">application/octet-stream</param>
                <param name="inputName">fileInputStream</param>
                <param name="contentDisposition">attachment;filename="FacilioAgent.exe"</param>
                <param name="bufferSize">1024</param>
            </result>
            <result name="invalidToken" type="json">
                <param name="includeProperties">errorStatus</param>
            </result>
        </action>

    </package>

    <package name="agent" namespace="/agentV2" extends="v2Api">
        <interceptors>
            <interceptor name="cacheinterceptor"
                         class="com.facilio.bmsconsole.interceptors.CacheInterceptor"/>
            <interceptor name="scopeinterceptor"
                         class="com.facilio.bmsconsole.interceptors.ScopeInterceptor"/>
            <interceptor name="datasourceinterceptor"
                         class="com.facilio.bmsconsole.interceptors.DataSourceInterceptor"/>
            <interceptor name="authinterceptor"
                         class="com.facilio.bmsconsole.interceptors.AuthInterceptor"/>
            <interceptor name="beanValidation"
                         class="com.facilio.interceptors.FacilioBeanValidationInterceptor"/>
            <interceptor name="validationinterceptor"
                         class="com.facilio.bmsconsole.interceptors.ValidationInterceptor" />
            <interceptor name="globalscopevariableinterceptor"
                         class="com.facilio.bmsconsole.interceptors.GlobalScopeVariableInterceptor" />
            <interceptor name="permissionSetInterceptor"
                         class="com.facilio.bmsconsole.interceptors.PermissionSetInterceptor" />
            <interceptor name="malwareInterceptor" class="com.facilio.security.MalwareInterceptor" />
            <interceptor-stack name="validator">
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="json">
                    <param name="enableSMD">true</param>
                </interceptor-ref>
                <interceptor-ref name="authinterceptor"/>
                <interceptor-ref name="beanValidation"/>
                <interceptor-ref name="datasourceinterceptor"/>
                <interceptor-ref name="scopeinterceptor"/>
                <interceptor-ref name="malwareInterceptor"/>
                <interceptor-ref name="globalscopevariableinterceptor"/>
                <interceptor-ref name="cacheinterceptor"/>
                <interceptor-ref name="validationinterceptor"/>
                <interceptor-ref name="permissionSetInterceptor" />
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="validator"/>
        <global-results>
            <result name="error" type="json">
                <param name="ignoreHierarchy">false</param>
                <param name="includeProperties">.*</param>
            </result>
            <result name="sessionexpired" type="httpheader">
                <param name="status">440</param>
            </result>
            <result name="sessiontimeout" type="httpheader">
                <param name="status">408</param>
            </result>
        </global-results>
    </package>


    <package name="AgentApiV2" namespace="/api/v2/agent" extends="agent">

        <!--1-->
        <action name="list" class="com.facilio.agentv2.AgentAction" method="listAgents"> <!--DONE-->
        </action>

        <!--2-->
        <action name="ping" class="com.facilio.agentv2.actions.AgentIdAction" method="pingAgent"> <!--DONE-->
        </action>

        <!--3-->
        <action name="create" class="com.facilio.agentv2.actions.AddAgentAction" method="createAgent">
        </action>

        <!--4-->
        <action name="get" class="com.facilio.agentv2.actions.AgentIdAction" method="getAgentUsingId"> <!--DONE-->
        </action>

        <!--5-->
        <action name="download" class="com.facilio.agentv2.AgentAction" method="download">
        </action>

        <!--6-->
        <action name="edit" class="com.facilio.agentv2.actions.UpdateAgentAction" method="edit">
        </action>

        <!--7-->
        <action name="count" class="com.facilio.agentv2.AgentAction" method="getAgentCount"> <!--DONE-->
        </action>

        <!--8-->
        <action name="delete" class="com.facilio.agentv2.actions.IdsAction" method="deleteAgent"> <!--DONE-->
        </action>

        <!--9-->
        <action name="restart" class="com.facilio.agentv2.actions.IdsAction" method="restartAgent"> <!--DONE-->
        </action>

        <!--10-->
        <action name="jvmStatus" class="com.facilio.agentv2.actions.AgentIdAction" method="getjvmStatus"> <!--DONE-->
        </action>

        <!--11-->
        <action name="threadDump" class="com.facilio.agentv2.actions.AgentIdAction" method="getThreadDump"> <!--DONE-->
        </action>

        <!--12-->
        <action name="downloadAgent" class="com.facilio.bmsconsole.actions.AgentDownloadAction" method="downloadAgent">
        </action>

        <action name="metrics" class="com.facilio.agentv2.actions.AgentIdAction" method="getMetrics">
        </action>
        
        <action name="metricsCount" class="com.facilio.agentv2.actions.AgentIdAction" method="getMetricsCount">
        </action>

        <action name="overview" class="com.facilio.agentv2.AgentAction" method="getOverview">
        </action>

        <action name="agentOverview" class="com.facilio.agentv2.actions.AgentIdAction" method="getAgentOverView">
        </action>


        <action name="getIotMessages" class="com.facilio.agentv2.actions.AgentIdAction" method="getIotMessages">
        </action>

        <action name="getIotMessage" class="com.facilio.agentv2.AgentAction" method="getIotMessage">
        </action>
        
        <action name="deviceSearch" class="com.facilio.agentv2.AgentAction" method="getDeviceSearchList">
        </action>

        <action name="iotMessageCount" class="com.facilio.agentv2.actions.AgentIdAction" method="getIotMessageCount">
        </action>


        <action name="getPointCount" class="com.facilio.agentv2.actions.AgentIdAction" method="getPointCount">
        </action>

        <action name="getFilter" class="com.facilio.agentv2.AgentAction" method="getAgentFilter">
        </action>

        <action name="data" class="com.facilio.agentv2.AgentAction" method="getAlertsPoints">
        </action>
        <action name="addClientToPolicy" class="com.facilio.agentv2.AgentAction" method="addClientToPolicy">
        </action>
        <action name="addVersion" class="com.facilio.agentv2.actions.AgentVersionAction" method="addAgentVersion">
        </action>
        <action name="upgradeAgent" class="com.facilio.agentv2.actions.VersionLogAction" method="upgradeAgent">
        </action>
        <action name="versions" class="com.facilio.agentv2.AgentAction" method="listAgentVersions">
        </action>
        <action name="logs" class="com.facilio.agentv2.actions.AgentIdAction" method="getAgentLogs">
        </action>
        <action name="logCount" class="com.facilio.agentv2.actions.AgentIdAction" method="getLogCount">
        </action>
        <action name="agentDownload" class="com.facilio.bmsconsole.actions.AgentDownloadAction" method="downloadAgent">
         <result name="success" type="stream">
             <param name="contentType">application/octet-stream</param>
                <param name="inputName">fileInputStream</param>
                <param name="contentDisposition">attachment;filename="${filename}"</param>
                <param name="bufferSize">1024</param>
            </result>
        </action>
		<action name="agentControl" class="com.facilio.agent.agentcontrol.AgentControl" method="sendToKafka">
		</action>
		<action name="certificate" class="com.facilio.agentv2.AgentAction" method="downloadCertificate">
		 <result name="success" type="stream">
             <param name="contentType">application/octet-stream</param>
                <param name="inputName">downloadStream</param>
                <param name="contentDisposition">attachment;filename="${filename}"</param>
                <param name="bufferSize">1024</param>
            </result>
        </action>
        <action name="config" class="com.facilio.agentv2.AgentAction" method="downloadConfig">
            <result name="success" type="stream">
                <param name="contentType">application/octet-stream</param>
                <param name="inputName">downloadStream</param>
                <param name="contentDisposition">attachment;filename="${filename}"</param>
                <param name="bufferSize">1024</param>
            </result>
        </action>

        <action name="addAgentWorkflowRule" class="com.facilio.agentv2.AgentAction" method="addAgentWorkflowRule"></action>
    </package>

    <package name="ControllerThreadApiV2" namespace="/api/v2/agent/threadDump" extends="agent">
        <action name="list" class="com.facilio.agentv2.AgentAction" method="listThreadDump">
        </action>
        <action name="count" class="com.facilio.agentv2.AgentAction" method="countThreadDump">
        </action>
    </package>

    <package name="ControllerApiV2" namespace="/api/v2/controller" extends="agent">

		<!-- Get controllers and count -->
		<action name="controllers" class="com.facilio.agentv2.actions.AgentIdAction" method="getControllersData"> 
        </action>

        <!--1-->
        <action name="count" class="com.facilio.agentv2.actions.AgentIdAction" method="getControllerCount"> <!--DONE-->
        </action>

        <!--3-->
        <action name="list" class="com.facilio.agentv2.actions.AgentIdAction" method="getControllers"> <!--DONE-->
        </action>

        <!--4-->
        <action name="get" class="com.facilio.agentv2.actions.ControllerActions"
                method="getControllerUsingId">  <!--DONE-->
        </action>
		
		<action name="controllersList" class="com.facilio.agentv2.actions.ControllerActions"
                method="getControllers">  <!--DONE-->
        </action>

        <!--5-->
        <action name="delete" class="com.facilio.agentv2.actions.IdsAction" method="deleteControllers">
        </action>


        <!--6-->
        <action name="discover" class="com.facilio.agentv2.actions.TypeAgentAction"
                method="discoverControllers"> <!--DONE-->
        </action>
		
        <!--8-->
        <action name="update" class="com.facilio.agentv2.actions.UpdateControllerAction" method="updateController">
        </action>

        <action name="reset" class="com.facilio.agentv2.actions.ControllerActions" method="resetController">
        </action>

        <action name="getControllerForDevice" class="com.facilio.agentv2.AgentAction"
                method="getControllerUsingIdentifier">
        </action> <!--testing purpose-->

        <action name="typeList" class="com.facilio.agentv2.actions.TypeAgentAction"
                method="getControllerOfTypeForAgent"> <!--DONE-->
        </action>

        <action name="getUsingId" class="com.facilio.agentv2.AgentAction" method="getControllerUsingId"> <!--DONE-->
        </action>

        <action name="getFilter" class="com.facilio.agentv2.actions.AgentIdAction"
                method="getControllerFilter"> <!--DONE-->
        </action>
        <action name="filterControllerTypes" class="com.facilio.agentv2.actions.AgentIdAction"
                method="getControllerTypeFilter"> <!--DONE-->
        </action>

    </package>

    <package name="PointsApiV2" namespace="/api/v2/point" extends="agent">

        <action name="list" class="com.facilio.agentv2.AgentAction" method="listPoints"> <!--DONE--> <!--DONE-->
        </action>

        <action name="count" class="com.facilio.agentv2.AgentAction" method="PointsCount"> <!--DONE-->
        </action>
        <action name="pointscount" class="com.facilio.agentv2.actions.GetPointsAction" method="getCount"> <!--DONE-->
        </action>
        <action name="getPoints" class="com.facilio.agentv2.actions.GetPointsAction" method="getPoints"> <!--DONE-->
        </action>

        <action name="set" class="com.facilio.agentv2.actions.SetValueAction" method="setValue">
        </action>

        <!-- <action name="configure"  class="com.facilio.agentv2.AgentAction" method="configurePoint"> &lt;!&ndash;DONE&ndash;&gt; &lt;!&ndash;TOTEST&ndash;&gt;
         </action>-->

        <action name="configure" class="com.facilio.agentv2.actions.controllerTypeIdsAction"
                method="configurePointsAndMakeController">
        </action>

        <action name="unconfigure" class="com.facilio.agentv2.actions.controllerTypeIdsAction"
                method="unConfigurePoints"> <!--DONE-->
        </action>
        <action name="subscribe" class="com.facilio.agentv2.actions.SubscribeAndUnscribeAction"
                method="subscribePoints"> <!--DONE-->
        </action>
        <action name="unsubscribe" class="com.facilio.agentv2.actions.SubscribeAndUnscribeAction"
                method="unsubscribePoints"> <!--DONE-->
        </action>

        <action name="discover" class="com.facilio.agentv2.actions.ControllerActions"
                method="discoverPoints"> <!--DONE-->
        </action>

        <action name="remove" class="com.facilio.agentv2.actions.controllerTypeIdsAction"
                method="removePoints"> <!--DONE-->
        </action>

        <!--.. list points using controllerId..-->
        <action name="getControllerConfPoints" class="com.facilio.agentv2.actions.ControllerActions"
                method="getConfiguredPoints"> <!--DONE-->
        </action>

        <action name="getControllerSubPoints" class="com.facilio.agentv2.actions.ControllerActions"
                method="getSubscribedPoints"> <!--DONE-->
        </action>

        <action name="getControllerUnonfPoints" class="com.facilio.agentv2.actions.ControllerActions"
                method="getUnconfiguredPoints"> <!--DONE-->
        </action>

        <action name="getControllerCommPoints" class="com.facilio.agentv2.actions.ControllerActions"
                method="getCommissionedPoints"> <!--DONE-->
        </action>

        <action name="makeWritable" class="com.facilio.agentv2.actions.IdsAction"
                method="makeWritable"> <!--DONE-->
        </action>

        <action name="disableWritable" class="com.facilio.agentv2.actions.IdsAction"
                method="disableWritable"> <!--DONE-->
        </action>
        <action name="export" class="com.facilio.bmsconsole.actions.CommissionAction" method="exportPoints">
        </action>
    </package>
	
    <package name="DeviceApiV2" namespace="/api/v2/device" extends="agent">
        <action name="list" class="com.facilio.agentv2.actions.AgentIdAction" method="devices"> <!--DONEDONE-->
        </action>
        
        <action name="getlist" class="com.facilio.agentv2.actions.AgentIdAction" method="getDeviceOrControllersData"> <!--DONEDONE-->
        </action>
        
        <action name="add" class="com.facilio.agentv2.actions.AddFieldDeviceAction" method="addDevice">
        </action>

        <action name="discoverPoints" class="com.facilio.agentv2.actions.IdsAction" method="discoverDevicePoints">
        </action>

        <!--<action name="agetDeviceCount" class="com.facilio.agentv2.actions.AgentIdAction" method="countAgentDevices">
        </action>
-->
        <action name="count" class="com.facilio.agentv2.actions.AgentIdAction" method="devicesCount">
        </action>

        <!--
                <action name="countType" class="com.facilio.agentv2.actions.AgentDeviceAction" method="countTypeDevice">
                </action>
        -->

        <action name="delete" class="com.facilio.agentv2.actions.IdsAction" method="deleteDevice">
        </action>

        <action name="get" class="com.facilio.agentv2.actions.DeviceIdActions" method="device">
        </action>

        <action name="getFilter" class="com.facilio.agentv2.actions.AgentIdAction" method="getDeviceFilter">
        </action>

        <action name="getModbusDevices" class="com.facilio.agentv2.actions.AgentIdAction" method="getModbusDevice">
        </action>
    </package>


    <package name="dbMigration" namespace="/api/v2/db" extends="agent">
        <action name="getSqlite" class="com.facilio.agentv2.actions.AgentIdAction" method="getSqlite">
        </action>
        <action name="migrate" class="com.facilio.agentv2.actions.AgentIdAction" method="migrate">
        </action>
        <action name="validateSQL" class="com.facilio.agentv2.actions.SQLiteAction" method="validateDb">
        </action>
    </package>

    <package name="modbus" namespace="/api/v2/modbus" extends="agent">
        <action name="addController" class="com.facilio.agentv2.actions.ModbusControllerAction"
                method="addModbusController">
        </action>
         <action name="addMiscController" class="com.facilio.agentv2.actions.AddMiscControllerAction"
                method="addMiscController">
        </action>
        <action name="addPoint" class="com.facilio.agentv2.actions.ModbusPointAction"
                method="createModbusPoint">
        </action>

        <!--<action name="addRtuNetwork" class="com.facilio.agentv2.actions.RtuNetworkAction" method="addRtuNetwork">
        </action>-->

        <action name="addIpControllers" class="com.facilio.agentv2.actions.BulkAddMosbusIpAction" method="addControllers">
        </action>

        <action name="addIpPoints" class="com.facilio.agentv2.actions.BulkAddModbusIpPointAction" method="addPoints">
        </action>
		
		<action name="rtuNetworks" class="com.facilio.agentv2.actions.AgentIdAction" method="getRtuNetworks">
        </action>
    </package>

    <package name="modbusDeviceImport" namespace="/api/v2/modbus/deviceImport" extends="agent">
        <action name="import" class="com.facilio.agentv2.actions.UploadFileAction" method="bulkAddModbusDevice">
        </action>
        <action name="retry" class="com.facilio.agentv2.AgentAction" method="retry">
        </action>
        <action name="getPending" class="com.facilio.agentv2.actions.AgentIdAction" method="getPendingControllerImports">
        </action>
        <action name="ignore" class="com.facilio.agentv2.AgentAction" method="ignoreImport">
        </action>
        <action name="pendingCount" class="com.facilio.agentv2.actions.AgentIdAction" method="pendingDeviceImportCount">
        </action>

    </package>

    <package name="modbusPointImport" namespace="/api/v2/modbus/pointImport" extends="agent">
        <action name="retry" class="com.facilio.agentv2.AgentAction" method="retry">
        </action>
        <action name="import" class="com.facilio.agentv2.actions.UploadFileAction" method="bulkAddModbusPoint">
        </action>
        <action name="getPending" class="com.facilio.agentv2.actions.DeviceIdActions" method="getPenfingPointImports">
        </action>
        <action name="pendingCount" class="com.facilio.agentv2.actions.DeviceIdActions" method="penfingPointImportsCount">
        </action>
        <action name="ignore" class="com.facilio.agentv2.AgentAction" method="ignoreImport">
        </action>
    </package>

    <package name="opcDa" namespace="/api/v2/opcda" extends="agent">
        <action name="addController" class="com.facilio.agentv2.actions.OpcDaControllerAction" method="addController">
        </action>
    </package>


    <package name="opcUa" namespace="/api/v2/opcUa" extends="agent">
        <action name="addController" class="com.facilio.agentv2.actions.OpcUaControllerAction" method="addController">
        </action>
    </package>

    <package name="rdm" namespace="/api/v2/rdm" extends="agent">
        <action name="addController" class="com.facilio.agentv2.actions.RdmControllerAction" method="addController">
        </action>
    </package>
    <package name="e2" namespace="/api/v2/e2" extends="agent">
        <action name="addController" class="com.facilio.agentv2.actions.E2ControllerAction" method="addController">
        </action>
    </package>

    <package name="agentMetrics" namespace="/api/v2/agent/metrics" extends="agent">
        <action name="list" class="com.facilio.agentv2.actions.AgentIdAction" method="getAgentMetrics">
        </action>
    </package>

    <package name="test" namespace="/api/v2/agent/test" extends="agent">
        <!--<action name="addModbucControllers" class="com.facilio.agentv2.AgentAction" method="addModbusControllers">
        </action>-->
        <action name="getPolicyGist" class="com.facilio.agentv2.AgentAction" method="getPolicyGist">
        </action>
    </package>
    <package name="altairSmartEdgeIntegration" namespace="/api/v2/agent/integration/altair" extends="agent">
        <action name="getIntegrationList" class="com.facilio.agentv2.actions.AgentIntegrationAction" method="getAltairIntegrations">
        </action>
        <action name="addIntegration" class="com.facilio.agentv2.actions.AgentIntegrationAction" method="addAltairIntegration">
        </action>
    </package>

    <package name="inboundConnectionConf" namespace="/api/v2/agent/inboundConnections" extends="agent">
        <action name="add" class="com.facilio.agentv2.actions.InboundConnectionsAction" method="add">
        </action>
    </package>
    <package name="inboundConnections" namespace="/api/agent/inbound/wegot"
             extends="struts-default,json-default">
        <interceptors>
            <interceptor name="agentInboundConnectionInterceptor"
                         class="com.facilio.bmsconsole.interceptors.AgentInboundConnectionInterceptor">
            </interceptor>
            <interceptor name="validationinterceptor"
                         class="com.facilio.bmsconsole.interceptors.ValidationInterceptor" />
            <interceptor-stack name="inboundInterceptorStack">
                <interceptor-ref name="agentInboundConnectionInterceptor"/>
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="json">
                    <param name="enableSMD">true</param>
                </interceptor-ref>
                <interceptor-ref name="validationinterceptor"/>
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="inboundInterceptorStack" />
        <action name="events" class="com.facilio.agentv2.actions.InboundNotificationAction">
            <result name="success" type="json">
                <param name="statusCode">200</param>
            </result>
        </action>
    </package>

</struts>
