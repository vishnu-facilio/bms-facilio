<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
    "http://struts.apache.org/dtds/struts-2.5.dtd">

<struts>

	<package name="v2Api" strict-method-invocation="false"
		namespace="/api/v2" extends="struts-default,json-default">
		<result-types>
			<result-type name="tiles"
				class="org.apache.struts2.views.tiles.TilesResult" />
			<result-type name="json"
				class="com.facilio.bmsconsole.interceptors.CacheResult" />
		</result-types>
		<interceptors>
			<interceptor name="cacheinterceptor"
				class="com.facilio.bmsconsole.interceptors.CacheInterceptor" />
			<interceptor name="authinterceptor"
				class="com.facilio.bmsconsole.interceptors.AuthInterceptor" />
			<interceptor-stack name="defaultInterceptor">
				<interceptor-ref name="defaultStack" />
				<interceptor-ref name="authinterceptor" />
				<interceptor-ref name="cacheinterceptor" />				
				<interceptor-ref name="json">
					<param name="enableSMD">true</param>
				</interceptor-ref>
			</interceptor-stack>
		</interceptors>

		<default-interceptor-ref name="defaultInterceptor" />
		<global-results>
			<result name="login" type="redirect">
				<param name="location">/app/login</param>
				<param name="parse">false</param>
			</result>
			<result name="unauthorized" type="redirect">
				<param name="location">/jsps/unauthorized.jsp</param>
				<param name="parse">false</param>
			</result>
			<result name="error" type="json">
				<param name="ignoreHierarchy">false</param>
				<param name="includeProperties">responseCode, message, stackTrace</param>
			</result>
			<result name="exception" type="chain">
				 <param name="actionName">handleException</param>
				 <param name="namespace">/v2/internal</param>
			</result>
			<result name="success" type="json">
				<param name="ignoreHierarchy">false</param>
				<param name="includeProperties">responseCode, ^result.*</param>
			</result>
		</global-results>
		<global-exception-mappings>
		    <exception-mapping exception="java.lang.Exception" result="exception" />
		</global-exception-mappings>
		
		<action name="account" class="com.facilio.bmsconsole.actions.LoginAction"
			method="v2currentAccount">
		</action>
		
		<action name="basespace" class="com.facilio.bmsconsole.actions.BaseSpaceAction"
			method="v2baseSpaceList">
		</action>
		
		<action name="attachments" class="com.facilio.bmsconsole.actions.AttachmentAction"
			method="v2attachmentList">
		</action>
		
	</package>
	
	<package name="internalV2" namespace="/v2/internal" extends="v2Api">
		<action name="handleException" class="com.facilio.bmsconsole.actions.FacilioAction" 
			method="handleException">
			<interceptor-ref name="defaultStack" />
		</action>
	</package>

	<package name="importTemplate" namespace="/api/v2/importTemplate" extends="v2Api">
		<action name="getnames" class="com.facilio.bmsconsole.actions.ImportTemplateAction" method="getTemplateNames"></action>
		<action name="getnewtemplate" class="com.facilio.bmsconsole.actions.ImportTemplateAction" method="getNewTemplate"></action>
		<action name="save" class="com.facilio.bmsconsole.actions.ImportTemplateAction" method="saveImportTemplate">
		<param name="permission">DATA_ADMINISTRATION</param>
		</action>
		<action name="deletetemplate" class="com.facilio.bmsconsole.actions.ImportTemplateAction" method="deleteTemplate"></action>
	</package>

	<package name="workOrderApiV2" namespace="/api/v2/workorders" extends="v2Api">
	
		<action name="add" class="com.facilio.bmsconsole.actions.WorkOrderAction"
			method="v2addWorkOrder">
			<param name="moduleName">workorder</param>
			<param name="permission">CREATE</param>
		</action>
		
		<action name="update" class="com.facilio.bmsconsole.actions.WorkOrderAction"
			method="v2updateWorkOrder">
			<param name="moduleName">workorder</param>
			<param name="permission">UPDATE,UPDATE_TEAM,UPDATE_OWN</param>
		</action>
		
		<action name="assign" class="com.facilio.bmsconsole.actions.WorkOrderAction"
			method="v2assignWorkOrder">
			<param name="moduleName">workorder</param>
			<param name="permission">UPDATE,UPDATE_TEAM,UPDATE_OWN</param>
		</action>
		
		<action name="sync" class="com.facilio.bmsconsole.actions.WorkOrderAction"
			method="syncOfflineWorkOrders">
			<param name="moduleName">workorder</param>
			<param name="permission">UPDATE,UPDATE_TEAM,UPDATE_OWN</param>
		</action>
		
		<action name="*" class="com.facilio.bmsconsole.actions.WorkOrderAction"
				method="v2viewWorkOrder">
			<param name="moduleName">workorder</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="workOrderId">{1}</param>
		</action>
		
	</package>
	<package name="workOrderListApiV2" namespace="/api/v2/workorders/view" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.WorkOrderAction"
			method="v2workOrderList">
			<param name="moduleName">workorder</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="viewName">{1}</param>
			<result name="success" type="json">
				<param name="ignoreHierarchy">false</param>
				<param name="includeProperties">responseCode, ^result.*</param>
				<param name="excludeProperties">result.subViewCount.*\.criteria</param>
			</result>
		</action>
	</package>
	
	
	<package name="workOrderRequestApiV2" namespace="/api/v2/workorderrequests" extends="v2Api">
		
		<action name="approve"
			class="com.facilio.bmsconsole.actions.WorkOrderRequestAction" method="v2approveWorkOrderRequest">
			<param name="moduleName">workorderrequest</param>
			<param name="permission">APPROVE_REJECT_WORKREQUEST</param>
		</action>

		<action name="reject"
			class="com.facilio.bmsconsole.actions.WorkOrderRequestAction" method="v2rejectWorkOrderRequest">
			<param name="moduleName">workorderrequest</param>
			<param name="permission">APPROVE_REJECT_WORKREQUEST</param>
		</action>
		
		<action name="add"
			class="com.facilio.bmsconsole.actions.WorkOrderRequestAction" method="v2addWorkOrderRequest">
			<param name="permission">WORKORDER_CREATE</param>
		</action>
		
		<action name="*" class="com.facilio.bmsconsole.actions.WorkOrderRequestAction" method="v2viewWorkOrderRequest">
			<param name="moduleName">workorderrequest</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="workOrderRequestId">{1}</param>
		</action>
		
	</package>
	<package name="workOrderRequestListApiV2" namespace="/api/v2/workorderrequests/view" extends="v2Api">
		<action name="*"
			class="com.facilio.bmsconsole.actions.WorkOrderRequestAction" method="v2workOrderRequestList">
			<param name="moduleName">workorderrequest</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="viewName">{1}</param>
		</action>
	</package>
	
	<package name = "alarmApiV2" namespace="/api/v2/alarms" extends = "v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.AlarmAction" method="v2viewAlarm">
			<param name="moduleName">alarm</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="id">{1}</param>
		</action>
		
		<action name="updatestatus" class="com.facilio.bmsconsole.actions.AlarmAction"
			method="v2updateStatus">
			<param name="moduleName">alarm</param>
			<param name="permission">UPDATE,UPDATE_TEAM,UPDATE_OWN</param>
		</action>
		
		<action name="createWorkorder" class="com.facilio.bmsconsole.actions.AlarmAction" method="v2createWorkorder">
			<param name="moduleName">alarm</param>
			<param name="permission">CREATE_WO</param>
		</action>
		
		<action name="delete" class="com.facilio.bmsconsole.actions.AlarmAction" method="v2deleteAlarm">
			<param name="moduleName">alarm</param>
			<param name="permission">DELETE,DELETE_TEAM,DELETE_OWN</param>
		</action>
	</package>
	
	<package name="alarmListApiv2" namespace="/api/v2/alarms/view" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.AlarmAction"
			method="v2alarmList">
			<param name="moduleName">alarm</param>
			<param name="permission">READ,READ_OWN,READ_TEAM</param>
			<param name="viewName">{1}</param>
		</action>
	</package>
	
	<package name = "eventApiV2" namespace="/api/v2/events" extends = "v2Api">
		<action name="*" class="com.facilio.events.actions.EventAction" method="v2viewEvent">
			<param name="moduleName">alarm</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="eventId">{1}</param>
		</action>
	</package>
	
	<package name="eventListApiv2" namespace="/api/v2/events/view" extends="v2Api">
		<action name="*" class="com.facilio.events.actions.EventAction" method="v2eventList">
			<param name="moduleName">alarm</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="viewName">{1}</param>
		</action>
	</package>
	
	<package name="alarmEventListApiv2" namespace="/api/v2/events/alarm" extends="v2Api">
		<action name="*" class="com.facilio.events.actions.EventAction" method="v2eventList">
			<param name="moduleName">alarm</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="alarmId">{1}</param>
		</action>
	</package>
	
	
	<package name="taskApiv2" namespace="/api/v2/tasks" extends="v2Api">
	
		<action name="updatestatus" class="com.facilio.bmsconsole.actions.TaskAction" method="v2updateStatus">
			<param name="moduleName">workorder</param>
			<param name="permission">ADD_UPDATE_DELETE_TASK</param>
		</action>
		
		<action name="closeAllTask" class="com.facilio.bmsconsole.actions.TaskAction" method="v2closeAllTask">
			<param name="permission">TASK_CREATE</param>
		</action>
		
		<action name="updateAllTask" class="com.facilio.bmsconsole.actions.TaskAction" method="v2updateAllTask">
			<param name="permission">TASK_CREATE</param>
		</action>
		
		<action name="update" class="com.facilio.bmsconsole.actions.TaskAction" method="v2updateTask">
			<param name="moduleName">workorder</param>
			<param name="permission">ADD_UPDATE_DELETE_TASK</param>
		</action>
		
		<action name="sync" class="com.facilio.bmsconsole.actions.TaskAction" method="syncOfflineTasks">
			<param name="moduleName">workorder</param>
			<param name="permission">ADD_UPDATE_DELETE_TASK</param>
		</action>
		
		<action name="parents" class="com.facilio.bmsconsole.actions.TaskAction" method="v2multipleTaskList">
			<param name="moduleName">workorder</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
		</action>
	
		<action name="*" class="com.facilio.bmsconsole.actions.TaskAction" method="v2viewTask">
			<param name="moduleName">workorder</param>
			<param name="permission">ADD_UPDATE_DELETE_TASK</param>
			<param name="taskId">{1}</param>
		</action>
	
	</package>
	<package name="taskApiListv2" namespace="/api/v2/tasks/parent" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.TaskAction" method="v2taskList">
			<param name="moduleName">workorder</param>
			<param name="permission">READ,READ_TEAM,READ_OWN</param>
			<param name="recordId">{1}</param>
		</action>
		<action name="closeAllTask" class="com.facilio.bmsconsole.actions.TaskAction" method="v2closeAllTask">
			<param name="permission">TASK_CREATE</param>
		</action>
	</package>
	
	<package name="noteApiv2" namespace="/api/v2/notes" extends="v2Api">
		<action name="add" class="com.facilio.bmsconsole.actions.NoteAction" method="v2addNote">
		</action>
	</package> 
	
	<package name="noteApiListv2" namespace="/api/v2/notes/parent" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.NoteAction" method="v2noteList">
			<param name="parentId">{1}</param>
		</action>
	</package>
	
	<package name="attachmentApiv2" namespace="/api/v2/attachments" extends="v2Api">
		<action name="add" class="com.facilio.bmsconsole.actions.AttachmentAction" method="v2addAttachment">
		</action>
	</package> 
	
	<package name="picklistApiv2" namespace="/api/v2/picklist" extends="v2Api">
	
		<action name="*" class="com.facilio.bmsconsole.actions.PickListAction" method="v2pickList">
			<param name="moduleName">{1}</param>
		</action>
		
	</package>
	
	<package name="readingRuleHistoricalRunApiV2" namespace="/api/v2/reading/rule/historicalrun" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.ReadingAction" method="runThroughRule">
			<param name="moduleName">setup</param>
			<param name="permission">ENERGY_ANALYTICS</param>
			<param name="id">{1}</param>
		</action>
	</package>
	<package name="formulaApiv2" namespace="/api/v2/reading/formula" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.ReadingAction" method="getFormulaField">
			<param name="moduleName">setup</param>
			<param name="permission">ENERGY_ANALYTICS</param>
			<param name="id">{1}</param>
		</action>
	</package>
	<package name="formulaFieldApiv2" namespace="/api/v2/reading/formula/field" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.ReadingAction" method="getFormulaFromReadingField">
			<param name="moduleName">setup</param>
			<param name="permission">ENERGY_ANALYTICS</param>
			<param name="id">{1}</param>
		</action>
	</package>
	<package name="formulaFieldHistoricalCaulculationApiv2" namespace="/api/v2/reading/formula/historicalCalculation" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.ReadingAction" method="calculateHistoryForFormula">
			<param name="moduleName">setup</param>
			<param name="permission">ENERGY_ANALYTICS</param>
			<param name="id">{1}</param>
		</action>
	</package>
	<package name="assetLatestDataApiv2" namespace="/api/v2/reading/latestdata" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.ReadingAction" method="v2GetLatestReadingData">
			<param name="parentId">{1}</param>
		</action>
	</package>
	
	<package name="readingFieldLatestValuesApiv2" namespace="/api/v2/reading" extends="v2Api">
		<action name="occupantdata" class="com.facilio.bmsconsole.actions.ReadingAction" method="getResourcesOccupantLatestReadingData">
		</action>
	</package>
	<package name="reportApiv2" namespace="/api/v2/report" extends="v2Api">
		<action name="readingReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="fetchReadingsData">
		</action>
		<action name="getReadingsFromCard" class="com.facilio.bmsconsole.actions.V2ReportAction" method="getReadingsFromCard">
		</action>
		<action name="workorderReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="fetchWorkorderData">
		</action>
		<action name="addReadingReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="addOrUpdateReadingReport">
		</action>
		<action name="addWorkOrderReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="addWorkOrderReport">
		</action>
		<action name="fetchReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="fetchReport">
		</action>
		<action name="export" class="com.facilio.bmsconsole.actions.V2ReportAction" method="exportReport">
		</action>
		<action name="sendMail" class="com.facilio.bmsconsole.actions.V2ReportAction" method="sendReportMail">
		</action>
		<action name="schedule" class="com.facilio.bmsconsole.actions.V2ReportAction" method="scheduleReport">
		</action>
		<action name="fetchReportFolders" class="com.facilio.bmsconsole.actions.V2ReportAction" method="fetchReportFolders">
		</action>
		<action name="addReportFolder" class="com.facilio.bmsconsole.actions.V2ReportAction" method="addReportFolder">
		</action>
		<action name="fetchReportWithData" class="com.facilio.bmsconsole.actions.V2ReportAction" method="fetchReportWithData">
		</action>
		<action name="deleteReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="deleteReport">
		</action>
		<action name="updateReportFolder" class="com.facilio.bmsconsole.actions.V2ReportAction" method="updateReportFolder">
		</action>
		<action name="deleteReportFolder" class="com.facilio.bmsconsole.actions.V2ReportAction" method="deleteReportFolder">
		</action>
		<action name="duplicateReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="duplicateReport">
		</action>
		<action name="moveReport" class="com.facilio.bmsconsole.actions.V2ReportAction" method="moveReport">
		</action>
	</package>
	
	<package name="scheduledReportApiv2" namespace="/api/v2/report/scheduled" extends="v2Api">
		<action name="edit" class="com.facilio.bmsconsole.actions.V2ReportAction" method="editScheduledReport">
		</action>
		<action name="delete" class="com.facilio.bmsconsole.actions.V2ReportAction" method="deleteScheduledReport">
		</action>
		<action name="*" class="com.facilio.bmsconsole.actions.V2ReportAction" method="scheduledList">
			<param name="moduleName">{1}</param>
		</action>
	</package>
	
	<package name="resourceApiv2" namespace="/api/v2/resource" extends="v2Api">
		<action name="getResourcesDetails" class="com.facilio.bmsconsole.actions.ResourceAction" method="getResources">
		</action>
	</package>
	<package name="moduleDataApiv2" namespace="/api/v2/module/data" extends="v2Api">
	
		<action name="add" class="com.facilio.bmsconsole.actions.ModuleAction"
			method="addModuleData">
		</action>
		
		<action name="update" class="com.facilio.bmsconsole.actions.ModuleAction"
			method="updateModuleData">
		</action>
		
		<action name="delete" class="com.facilio.bmsconsole.actions.ModuleAction"
			method="deleteModuleData">
		</action>
		
		<action name="*" class="com.facilio.bmsconsole.actions.ModuleAction"
				method="moduleDataDetails">
			<param name="id">{1}</param>
		</action>
		
	</package>
	<package name="moduleDataApiListv2" namespace="/api/v2/module/data/view" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.ModuleAction"
			method="getModuleDataList">
			<param name="viewName">{1}</param>
		</action>
	</package>
	
	<package name="assetApiV2" namespace="/api/v2/assets" extends="v2Api">
	
		<action name="qr" class="com.facilio.bmsconsole.actions.AssetAction"
			method="fetchAssetFromQR">
			<param name="moduleName">asset</param>
			<param name="permission">READ</param>
		</action>
		
		<action name="cards" class="com.facilio.bmsconsole.actions.AssetAction"
			method="reportCards">
		</action>
		
		<action name="*" class="com.facilio.bmsconsole.actions.AssetAction" method="assetDetails">
			<param name="moduleName">asset</param>
			<param name="permission">READ</param>
			<param name="assetId">{1}</param>
		</action>
		
	</package>
	
	<package name="assetListApiv2" namespace="/api/v2/assets/view" extends="v2Api">
		<action name="*" class="com.facilio.bmsconsole.actions.AssetAction" method="assetList">
			<param name="moduleName">asset</param>
			<param name="permission">READ</param>
			<param name="viewName">{1}</param>
		</action>
	</package>
	
	<package name="workflowApiv2" namespace="/api/v2/workflow" extends="v2Api">
		<action name="xml" class="com.facilio.bmsconsole.actions.WorkflowAction" method="getWorkflowXmlFromObject">
		</action>
	</package>
	
</struts>