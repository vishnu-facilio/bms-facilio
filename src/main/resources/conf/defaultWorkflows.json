{
   "0": {
        "description" : "sample",
        "usage" : "test",
        "workflow" : "Number getSquareOf(Number i)
                      {
                      		return i * i;
                      }"
        },
   "1": {
    	"description" : "woAverageResponseTime",
        "usage" : "pmSummary",
        "workflow" : "Map test(Number pmId) 
        			  	{ 
        			  		woModule = Module(\"workorder\"); 
        			  		res = woModule.fetch([pm == pmId && actualWorkStart > 0]); 
        			  		if (res == null) 
        			  		{ 
        			  			return 0; 
        			  		} 
  							date = NameSpace(\"date\");
    						temp = date.getPreviousMonthEndDate();
  							previousMonthRes = woModule.fetch([pm == pmId && actualWorkStart > 0 && createdTime <= temp]);
  							previousMonthresponseTime = 0; 
  							if (previousMonthRes != null) {	
	        			  		b = previousMonthRes.size(); 
	                              for each index,value in previousMonthRes { 
	        			  			wd =  (value.actualWorkStart - value.createdTime); 
	        			  			previousMonthresponseTime = (previousMonthresponseTime + wd);
	        			  		}
                                previousMonthresponseTime = previousMonthresponseTime/b; 
                            }
        			  		responseTime = 0; 
        			  		a = res.size(); 
        			  		for each index,value in res { 
        			  			wd =  (value.actualWorkStart - value.createdTime); 
        			  			responseTime = (responseTime + wd);
        			  		} 
        			  		responseTime = responseTime/a; 
                            resMap = {};
                            resMap[\"responseTime\"] = responseTime;
                            resMap[\"previousMonthresponseTime\"] = previousMonthresponseTime;
         					return resMap; 
        			  	}"
        },
		"2": {
			"description" : "fetchGraphicsData",
			"usage" : "graphics",
			"workflow" : "Map fetchGraphicsData(List variables,List conditionalFormattings) 
							  {
								  resultMap = {};
								  if (variables == null) {
									  return resultMap;
								  }
								  recordMap = {};
								  for each index, variableObj in variables {
								  	  variableParentId = variableObj.parentId;
								  	  if (variableObj.fetchType == \"field\") {
									  	  recordKey = variableObj.module + \"_\" + variableParentId;
									  	  recordObj = {};
									  	  if (recordMap.get(recordKey) != null) {
									  	  	  recordObj = recordMap.get(recordKey);
									  	  }
									  	  else {
									  	      fetchModule = Module(variableObj.module);
									  	      recordObj = fetchModule.fetch([id == (variableParentId)]);
									  	      recordMap[recordKey] = recordObj;
									  	  }
									  	  
									  	  valueStr = null;
									  	  if (recordObj != null && recordObj.size() > 0) {
									  	  	  rec = recordObj[0];
									  	  	  valueStr = rec.get(variableObj.select);
									  	  }
									  	  	  
								  	  	  valueMap = {};
										  valueMap[\"value\"] = valueStr;
                                          
                                          resultMap[variableObj.key] = valueMap;
									  }
									  else if (variableObj.fetchType == \"space\") {
									  	fetchModule = Module(variableObj.module);
									  	recordObj = fetchModule.fetch([id == (variableParentId)]);
									  	
									  	valueMap = {};
										valueMap[\"value\"] = recordObj;
										
										resultMap[variableObj.key] = valueMap;
									  }
									  else if (variableObj.fetchType == \"liveValue\") {
									  	  fieldObj = NameSpace(\"module\").getField(variableObj.select, variableObj.module);
									  	  if (fieldObj != null) {
										  	  fieldid = fieldObj.id();
										  	  fieldMapInfo = fieldObj.asMap();
										  	  
										  	  lastVal = Reading(fieldid, variableParentId).getLastValue();
										  	  enumMap = Reading(fieldid, variableParentId).getEnumMap();
											  
											  valueMap = {};
											  valueMap[\"value\"] = lastVal;
											  valueMap[\"fieldid\"] = fieldid;
											  if (enumMap != null) {
											      valueMap[\"enumMap\"] = enumMap;
											  }
											  if (fieldMapInfo != null) {
											  	valueMap[\"unit\"] = fieldMapInfo.get(\"unit\");
											  }
											  
											  resultMap[variableObj.key] = valueMap;
									     }
									     else {
									     	  valueMap = {};
											  valueMap[\"value\"] = null;
									          resultMap[variableObj.key] = valueMap;
									     }
									  }
									  else if (variableObj.fetchType == \"aggrValue\") {
									  	fieldObj = NameSpace(\"module\").getField(variableObj.select, variableObj.module);
									  	if (fieldObj != null) {
									  	  fetchModule = Module(variableObj.module);
										  
										  date = NameSpace(\"date\");
										  month = date.getDateRange(variableObj.dateRange);
										  db = {
											criteria : [parentId == (variableParentId) && ttime == month],
											field : variableObj.select,
											aggregation : variableObj.aggr
										  };
										
										  res = fetchModule.fetch(db);
										
										  valueMap = {};
										  valueMap[\"value\"] = res;
										
										  fieldid = fieldObj.id();
										  enumMap = Reading(fieldid, variableParentId).getEnumMap();
                                        
                                          valueMap[\"fieldid\"] = fieldid;
                                          if (enumMap != null) {
                                            valueMap[\"enumMap\"] = enumMap;
                                          }
                                        
                                         fieldMapInfo = fieldObj.asMap();
                                         valueMap[\"unit\"] = fieldMapInfo.get(\"unit\");
                                         
                                         resultMap[variableObj.key] = valueMap;
                                       }
                                       else {
								     	  valueMap = {};
										  valueMap[\"value\"] = null;
								          resultMap[variableObj.key] = valueMap;
								        }
									  }
								  }
								  
								if(conditionalFormattings != null) {
   	 
								    for each index,conditionalFormatting in conditionalFormattings {
								      
								      if(conditionalFormatting.conditionalFormattings != null) {
								        
								        formatings = conditionalFormatting.conditionalFormattings;
								        
								        for each index,formating in formatings {
								          
								          if(formating.criteria != null && formating.actions != null) {
								             
											 criteria1 = NameSpace(\"criteria\").get(json); 
								             res = criteria1.evaluate(resultMap);
								             if(res) {
								               actionMap = formating.actions;
								               for each key,value in actionMap {
								                 conditionalFormatting[key] = value;
								               }
								             }
								          }
								        }
								      }
								    }
								}
									  
								return resultMap; 
							}"
		},
		"3": {
			"description" : "fetchConsumptionDetailsForMVSummary",
			"usage" : "total consumption,baseline consumption,carbon saved for MV summary",
			"workflow" : "Map test(Number projectId) 
							{ 
							  resultMap = {};
							  carbonConstant = 0.41;
							  costConstant = 0.44;
							  mvProject = Module(\"mvproject\").fetch([id == projectId])[0];
							  baseline = Module(\"mvbaseline\").fetch([project == projectId])[0];
							  formulaFieldWithAdj = Module(\"formulaField\").fetch([id == (baseline.formulaFieldWithAjustment.id)])[0];
							  lastMonthEndTime = NameSpace(\"date\").getDateRange(\"Last Month\").getEndTime();
							  db = {
							    criteria : [parentId == (mvProject.meter.id) && ttime >= (mvProject.reportingPeriodStartTime) && ttime < lastMonthEndTime],
							    field : \"totalEnergyConsumptionDelta\",
							    aggregation : \"sum\"
							  }
							  thisMonthActualConsumption = Module(\"energydata\").fetch(db);
							  if(thisMonthActualConsumption == null) {
							    thisMonthActualConsumption = 0;
							  }
							  resultMap[\"thisMonthActualConsumption\"] = thisMonthActualConsumption;
							  db = {
							    criteria : [parentId == (mvProject.meter.id) && ttime >= (mvProject.reportingPeriodStartTime) && ttime < lastMonthEndTime],
							    field : (formulaFieldWithAdj.readingField.name),
							    aggregation : \"sum\"
							  }
							  thisMonthBaselineConsumption = Module(formulaFieldWithAdj.moduleName).fetch(db);
							  if(thisMonthBaselineConsumption == null) {
							    thisMonthBaselineConsumption = 0;
							  }
							  resultMap[\"thisMonthBaselineConsumption\"] = thisMonthBaselineConsumption;
							
							  savedConsumption = thisMonthBaselineConsumption - thisMonthActualConsumption;
							  carbonEmissionSaved = savedConsumption * carbonConstant;
							  resultMap[\"carbonEmissionSaved\"] = carbonEmissionSaved;
							
							  costSaved = savedConsumption * costConstant;
							  resultMap[\"costSaved\"] = costSaved;
							
							  if(mvProject.saveGoal != null) {
							    targetSavedConsumption =  (thisMonthBaselineConsumption*(mvProject.saveGoal)/100);
							  }
							  else {
							    saveGoalFormulaField = Module(\"formulaField\").fetch([id == (mvProject.saveGoalFormulaField.id)])[0];
							    db = {
							    	criteria : [parentId == (mvProject.meter.id) && ttime >= (mvProject.reportingPeriodStartTime) && ttime < lastMonthEndTime],
							    	field : (saveGoalFormulaField.readingField.name),
							    	aggregation : \"sum\"
							  	}
							    thisMonthTargetConsumption = Module(saveGoalFormulaField.moduleName).fetch(db);
							    targetSavedConsumption = thisMonthBaselineConsumption - thisMonthTargetConsumption;
							  }
							  targetCost = targetSavedConsumption * costConstant;
							  resultMap[\"targetCost\"] = targetCost;
							  return resultMap;
							}"
		},
		"4": {
			"description" : "portfolioAlarmCardData",
			"usage" : "total consumption,baseline consumption,carbon saved for MV summary",
			"workflow" : "Map openalarms()
		     {
                clearCondition = {
                   criteria :[severity == \"Clear\" ],
                 }
                 alarmSevrityModule = Module(\"alarmseverity\");
                 AlarmSeverityContext clearSeverityContext = alarmSevrityModule.fetch(clearCondition);
                 clearId = clearSeverityContext.get(0).get(\"id\");
                 activeAssetcri = {
					criteria : [severity != clearId  ],
                    field : \"id\",
                   	aggregation : \"count\",
				  };
               	unAcknowledgedCri = {
                 	criteria : [severity != clearId && acknowledged == false  ] ,
                 	field : \"id\",
                   	aggregation : \"count\",
               	}
		        readingAlarmModule = Module(\"newreadingalarm\");
		        activeRecord = readingAlarmModule.fetch(activeAssetcri);
               	unAckRecord = readingAlarmModule.fetch(unAcknowledgedCri);
                resultMap = {};
                resultMap[\"active\"] = activeRecord;
               	resultMap[\"unacknowledged\"] = unAckRecord;
                return resultMap;
		    }"
		},
		"50": {
        	"description" : "ruleNewAlarmsDetails",
        	"usage" : "rulesNewSummary",
        	"workflow": "Map newAlarmDetails(Number ruleId)
		     {
                  clearCondition = {
                    criteria :[severity == \"Clear\" ]
                  }
            	date = NameSpace(\"date\");
            	ranges = date.getDateRange(\"Current Week\");
                monthRanges = date.getDateRange(\"Current Month\");
		    	alarmsCurrWeekCri = {
              		criteria : [rule == ruleId && lastOccurredTime == ranges ]
            	};
                  alarmSevrityModule = Module(\"alarmseverity\");
                  AlarmSeverityContext clearSeverityContext = alarmSevrityModule.fetch(clearCondition);
                  clearId = clearSeverityContext.get(0).get(\"id\");
                  activeAssetcri = {
					criteria : [rule == ruleId && severity != clearId  ]
				};
		        readingAlarmModule = Module(\"newreadingalarm\");
                workOrderModule = Module(\"ticket\");
		        activeRecord = readingAlarmModule.fetch(activeAssetcri);
              	activeAlarms = 0;
                  activeAlarmResources = [];
              	if (activeRecord != null) {
                  for each index,value in activeRecord {
		                        if (value != null) {
                                  if (value.get(\"resource\") != null) {
                                    activeAlarmResources.add(value.get(\"resource\").get(\"id\"));
                                  }
		                        }                                
		                }
                      activeAlarms = activeRecord.size();
                 }
              	currWeekAlarmRec = readingAlarmModule.fetch(alarmsCurrWeekCri);
              	currWeekAlarms = 0;
              	alarmThisWeekResources = [];
              	if (currWeekAlarmRec != null) {
              		for each index,value in currWeekAlarmRec {
		                        if (value != null) {
                                  if (value.get(\"resource\") != null) {
                                    alarmThisWeekResources.add(value.get(\"resource\").get(\"id\"));
                                  }
		                        }                                
		                }
                	currWeekAlarms = currWeekAlarmRec.size();
             	}
                  resultMap = {};
                  resultMap[\"activeAlarms\"] = activeAlarms;
                  resultMap[\"alarmRuleThisWeek\"] = currWeekAlarms;
                  resultMap[\"activeAlarmResources\"] = activeAlarmResources;
                  resultMap[\"alarmThisWeekResources\"] = alarmThisWeekResources;
                  return resultMap;
		    }"
        },
        "51": {
        "description" : "newAlarmRuleWoDetails",
        	"usage" : "rulesSummary",
        	"workflow": "Map ruleWoDetails(Number ruleId) {
				  date = NameSpace(\"date\");
				  ranges = date.getDateRange(\"Current Week\");
				  monthRanges = date.getDateRange(\"Current Month\");
				  alarmsCurrWeekCri = {
				    criteria: [rule == ruleId && lastOccurredTime == ranges]
				  };
				  readingAlarmModule = Module(\"newreadingalarm\");
				  workOrderModule = Module(\"workorder\");
				  alarmoccurrenceModule = Module(\"alarmoccurrence\");
				  woThisWeek = {
				    criteria: [rule == ruleId && lastOccurredTime == ranges]
				  };
				  woThisMonth = {
				    criteria: [rule == ruleId && lastOccurredTime == monthRanges]
				  };
				  currWeekOccurence = readingAlarmModule.fetch(woThisWeek);
				  occurencesID = []
				  if (currWeekOccurence != null) {
				    for each index, value in currWeekOccurence {
				      occurencesID.add(value.lastOccurrenceId);
				    }
				  }
				  alarmOccurrencesCri = {
				    criteria: [id == occurencesID && woId != null]
				  }
				  currenWeekAlarmOccurrences = alarmoccurrenceModule.fetch(alarmOccurrencesCri);
				  currentWeekWo = 0 currentWeekWoId = []
				  if (currenWeekAlarmOccurrences != null) {
				    currentWeekWo = currenWeekAlarmOccurrences.size();
				    for each index, value in currenWeekAlarmOccurrences {
				      if (value != null) {
				        currentWeekWoId.add(value.get(\"woId\"));
				      }
				    }
				  }
				  woThisMonth = {
				    criteria: [rule == ruleId && lastOccurredTime == monthRanges]
				  };
				  currMonthOccurence = readingAlarmModule.fetch(woThisMonth);
				  occurencesMonthID = []
				  if (currMonthOccurence != null) {
				    for each index, value in currMonthOccurence {
				      occurencesMonthID.add(value.lastOccurrenceId);
				    }
				  }
				  alarmMonthOccurrencesCri = {
				    criteria: [id == occurencesMonthID && woId != null]
				  }
				  currenMonthAlarmOccurrences = alarmoccurrenceModule.fetch(alarmMonthOccurrencesCri);
				  currentMonthWo = 0 currentMonthWoId = []
				  if (currenMonthAlarmOccurrences != null) {
				    currentMonthWo = currenMonthAlarmOccurrences.size();
				    for each index, value in currenMonthAlarmOccurrences {
				      if (value != null) {
				        currentMonthWoId.add(value.get(\"woId\"));
				      }
				    }
				  }
				  ticketContextRespondTime = {
				    criteria: [id == currentMonthWoId && actualWorkStart > 0]
				  };
				  ticketContextResolutionTime = {
				    criteria: [id == currentMonthWoId && actualWorkDuration > 0]
				  };
				  ticketsResponse = workOrderModule.fetch(ticketContextRespondTime);
				  ticketsResolution = workOrderModule.fetch(ticketContextResolutionTime);
				  previousMonthresponseTime = 0;
				  previousMonthresolutionTime = 0;
				  if (ticketsResponse != null) {
				    b = ticketsResponse.size();
				    for each index, value in ticketsResponse {
				      wd = (value.actualWorkStart - value.createdTime);
				      previousMonthresponseTime = (previousMonthresponseTime + wd);
				    }
				    previousMonthresponseTime = previousMonthresponseTime / b;
				  }
				  if (ticketsResolution != null) {
				    c = ticketsResolution.size();
				    for each index, value in ticketsResolution {
				      pd = value.actualWorkDuration;
				      previousMonthresolutionTime = (previousMonthresolutionTime + pd);
				
				    }
				    previousMonthresolutionTime = previousMonthresolutionTime / c;
				  }
				  resultMap = {};
				  resultMap[\"currentMonthWo\"] = currentMonthWo;
				  resultMap[\"currentWeekWo\"] = currentWeekWo;
				  resultMap[\"currentWeekWoId\"] = currentWeekWoId;
				  resultMap[\"currentMonthWoID\"] = currentMonthWoId;
				  resultMap[\"previousMonthresponseTime\"] = previousMonthresponseTime;
				  resultMap[\"previousMonthresolutionTime\"] = previousMonthresolutionTime;
				  return resultMap;
				}"
        
        },
         "52": {
        	"description" : "newAlarmRuleRank",
        	"usage" : "ruleRank",
        	"workflow": " Map newAlrmRankWorkflow(Number ruleId) {
			date = NameSpace(\"date\");
			  monthRanges = date.getDateRange(\"Current Year\");
			    db = {
			      criteria: [lastOccurredTime == monthRanges],
			      field:\"rule\",
			      aggregation:\"count, rule\",
			      groupBy:\"rule\",
			      orderBy:\"rule\" desc
			    }; readingAlarmModule = Module(\"newreadingalarm\");
			      activeRecord = readingAlarmModule.fetch(db); ranking = 0;
			      if (activeRecord != null) {
			        for each index, value in activeRecord {
			          temp = value.result;
			          temp = value.result + 0;
			          if (temp == ruleId) {
			            ranking = index + 1;
			          }
			        }
			      }
			      resultMap = {};
			      if (activeRecord != null) {
			        resultMap[\"ranks\"] = activeRecord;
			        resultMap[\"ranking\"] = ranking;
			        resultMap[\"outOfRule\"] = activeRecord.size();
			      }
			    return resultMap;
			}",
        },
         "53": {
        	"description" : "newAlarmMeanTimeBetweenTriggers",
        	"usage" : "newAlarmrulesSummary",
        	"workflow": "Map getNewAlarmRuleTriggerDetials(Number ruleId)
				{
				  date = NameSpace(\"date\");
				  tillLastMonthranges = date.getDateRange(\"Current year upto last month\");
				  currentMonthranges = date.getDateRange(\"Current Month\");
				  tillLastMonthcri = {
				    criteria : [rule == ruleId && lastOccurredTime == tillLastMonthranges ],
				        orderBy : \"lastOccurredTime\" asc
				  };
				  currentMonthCri = {
				    criteria : [rule == ruleId && lastOccurredTime == currentMonthranges ],
				        orderBy : \"lastOccurredTime\" asc
				  };
				  currentMonthAlarmId = [],
				  readingAlarmModule = Module(\"newreadingalarm\");
				  alarmoccurrenceModule = Module(\"alarmoccurrence\");
				  currentMonthresult = readingAlarmModule.fetch(currentMonthCri);
				  tillLastMonthMonthresult = readingAlarmModule.fetch(tillLastMonthcri);
				
				  if (currentMonthresult != null) {
				    for each index,value in currentMonthresult {
				      currentMonthAlarmId.add(value.id)
				    }
				  }
				  tillLastMonthAlarmId = []
				  if (tillLastMonthMonthresult != null) {
				    
				    for each index,value in tillLastMonthMonthresult {
				      tillLastMonthAlarmId.add(value.id)
				    }
				  }
				  alarmMonthOccurenceList = alarmoccurrenceModule.fetch([alarm == currentMonthAlarmId ]);
				  alarmOccurenceTillLMonthList = alarmoccurrenceModule.fetch([alarm == tillLastMonthAlarmId ]);
				
				  mtbt = 0;
				  pmtbt = 0;
				  mttc = 0;
				  mOverAllDuration = 0;
				  pmttc = 0;
				  pmOverAllDuration = 0;
				  if (alarmMonthOccurenceList != null) {
				    perivousTriggerTime = 0
				     sumMtbt = 0;
				    sumMttc = 0;
				    countOfClearedOccurence = 0
				    	 for each index,occurrence in alarmMonthOccurenceList {
				           sumMtbt = occurrence.createdTime - perivousTriggerTime
				           perivousTriggerTime = occurrence.createdTime ;
				           if (occurrence.clearedTime != null) {
				             countOfClearedOccurence = countOfClearedOccurence + 1;
				             sumMttc = sumMttc + (occurrence.clearedTime - occurrence.createdTime);
				           }
				         }
				    mOverAllDuration = sumMttc;
				     mttc = sumMttc /countOfClearedOccurence;
				    mtbt = sumMtbt / alarmMonthOccurenceList.size();
				  }	
				  if (alarmOccurenceTillLMonthList != null) {
				    perivousTriggerTime = 0
				      sumPmtbt = 0;
				    sumPmttc = 0;
				    countOfClearedOccurence = 0
				    	 for each index,occurrence in alarmOccurenceTillLMonthList {
				    	 sumPmtbt = occurrence.createdTime - perivousTriggerTime
				           perivousTriggerTime = occurrence.createdTime ;
							if (occurrence.clearedTime != null) {
				             countOfClearedOccurence = countOfClearedOccurence + 1;
				             sumMttc = sumMttc + (occurrence.clearedTime - occurrence.createdTime);
				           }
				         }
				     pmtbt = sumPmtbt / alarmOccurenceTillLMonthList.size();
				 	mOverAllDuration = sumPmttc;
				     pmttc = sumPmttc /countOfClearedOccurence;
				  }	
				  resMap = {};
					resMap[\"mtbt\"] = mtbt;
					resMap[\"timeToClear\"] = mOverAllDuration;
					resMap[\"mttc\"] = mttc;
					resMap[\"pmtbt\"] = pmtbt;
					resMap[\"previousMonthTimeToClear\"] = pmOverAllDuration;
					resMap[\"pmttc\"] = pmttc;
				  return resMap;
				}"
        },
		"99":{
			"description" : "mlpredictedEnergyWastage",
			"usage" : "AnomalySummary",
			"workflow": "Map calculateEnergyWastage(Number resourceId){
			    resultMap = {};
			    mlReadings = Module(\"anomalydetectionmllogreadings\");
			   	date = NameSpace(\"date\");
			    thisMonthRanges = date.getDateRange(\"Current Month\");
			    lastMonthRange = date.getDateRange(\"Last Month\");
			  	lastMonthEnergy = {
					criteria: [parentId == resourceId && ttime == thisMonthRanges],
			    };
			   currentMonthWastage =  mlReadings.fetch(lastMonthEnergy);
			   energyWastage = 0
			   if (currentMonthWastage != null) {
			   	for each index,value in currentMonthWastage {
			       diffConsu = value.actualValue - value.upperBound;
			    	if (diffConsu > 0) {
			       		energyWastage =  energyWastage + diffConsu
			       }
			   	}
			   }
			   resultMap[\"currentMonthWastage\"] = energyWastage;
			   log \"energyWastage\" + energyWastage;
			   return resultMap;
			}"
		},
		"100" : {
        	"description" : "noOfAnomalies",
        	"usage" : "AnomalySummary",
        	"workflow": "Map test(Number alarmId){ 
			    mlAnomalyAlarmModule = Module(\"mlAnomalyAlarm\");
			    date = NameSpace(\"date\");
			   	thisMonthRanges = date.getDateRange(\"Current Month\");
			    lastMonthRange = date.getDateRange(\"Last Month\");
			  	anomaliesThisMonth = 0;
			  	anomaliesLastMonth = 0;
			    alarmoccurrenceModule = Module(\"alarmoccurrence\");
			    occurenceThisMonthCrit = {
					criteria: [alarm == alarmId && createdTime == thisMonthRanges]
			    };
			    thismothoccurence =  alarmoccurrenceModule.fetch(occurenceThisMonthCrit);
				if (thismothoccurence != null ) {
			      anomaliesThisMonth = thismothoccurence.size();
			    }
			    occurenceLastMonthCrit = {
					criteria: [alarm == alarmId && createdTime == lastMonthRange]
			    };
			    lastmothoccurence =  alarmoccurrenceModule.fetch(occurenceLastMonthCrit);  
			    if (lastmothoccurence != null) {
			       anomaliesLastMonth = lastmothoccurence.size();
			    }
			   	resMap = {};
			  	resMap[\"anomaliesThisMonth\"] = anomaliesThisMonth;
			    resMap[\"anomaliesLastMonth\"] = anomaliesLastMonth;
			
			  	log resMap
			    return resMap
			  
			}"
        },
        "101": {
        	"description" : "meanTimeBetweenTriggers",
        	"usage" : "rulesSummary",
        	"workflow": "Map getRuleTriggerDetials(Number ruleId) 
		    { 
		            cri = {
						criteria : [ruleId == ruleId && clearedTime > 0 ],
		        		orderBy : \"createdTime\" asc
					};
		            date = NameSpace(\"date\");
		            ranges = date.getDateRange(\"Last Month\");
		        	readingAlarmModule = Module(\"readingalarm\"); 
		        	res = readingAlarmModule.fetch(cri);
		            previousMonthDetails = readingAlarmModule.fetch([ruleId == ruleId  && createdTime == ranges]);
		            meanTimeBetweenTigger = 0;
		            timeToClear = 0;
		            meanTimeToClear = 0;
		            if (res != null) {
		                firstRes =res[0];
		                previousClearedTime = 0 
		                if (firstRes.clearedTime != null ) {
		                  previousClearedTime = firstRes.createdTime;
		                }
		                meanTimeToTriggerSize = 0
		                for each index,value in res {
							if(index > 0) {
		                        if (value != null) {
		                            createdTime = value.createdTime;
                                  if (createdTime > previousClearedTime) {
                                  		meanTimeToTriggerSize  = meanTimeToTriggerSize + 1
                                   		meanTimeBetweenTigger = meanTimeBetweenTigger + (createdTime - previousClearedTime); 
                                  }
		      						if (value.createdTime != null) {
		      							previousClearedTime = value.createdTime ;
		      						
		      						}
		                        }                                
							}
		                }
					    meanTimeBetweenTigger = meanTimeBetweenTigger / meanTimeToTriggerSize;	
		                for each index,value in res {
					        if(index > 0) {
		                        if (value != null) {
		      				        timeToClear = timeToClear + (value.clearedTime - value.createdTime); 
		                        }                                
					        }
		                } 
		                 meanTimeToClear =   timeToClear / res.size();
		            }
		            previousMonthMeanTimeBetweenTigger = 0;
		            previousMonthTimeToClear = 0;
		            previousMonthmeanTimeToClear = 0;
                	previousMonthClearedTime = 0;
		            if (previousMonthDetails != null ) {
		                previousRes =previousMonthDetails[0];
                      if (previousRes.clearedTime != null ) {
                        previousMonthClearedTime = previousRes.clearedTime
                      }
		                for each index,value in previousMonthDetails {
						    if(index > 0) {
		                        if (value != null) {
		                            createdTime = value.createdTime;
		      						previousMonthMeanTimeBetweenTigger = previousMonthMeanTimeBetweenTigger + (createdTime -previousMonthClearedTime); 
                                  if (value.clearedTime  != null ) {
                                    previousMonthClearedTime = value.clearedTime ;
                                  }
		                        }                                
							}
		                }
						previousMonthMeanTimeBetweenTigger = previousMonthMeanTimeBetweenTigger / previousMonthDetails.size();
		                for each index,value in previousMonthDetails {
							if(index > 0) {
		                        if (value != null) {
                                  previousCreatedTime = 0;
                                  previousClearedTime = 0;
                                  if (value.clearedTime != null) {
                                    previousClearedTime = value.clearedTime
                                  } 
                                  if (value.createdTime != null) {
                                    previousCreatedTime = value.createdTime

                                  }
		      						previousMonthTimeToClear = previousMonthTimeToClear + (previousClearedTime - previousCreatedTime); 
		                        }                                
							}
		                } 
		                previousMonthmeanTimeToClear =   previousMonthTimeToClear / previousMonthDetails.size();
		            }
					resMap = {};
		            resMap[\"mtbt\"] = meanTimeBetweenTigger;
		            resMap[\"timeToClear\"] = timeToClear;
		            resMap[\"mttc\"] = meanTimeToClear;
		            resMap[\"pmtbt\"] = previousMonthMeanTimeBetweenTigger;
		            resMap[\"previousMonthTimeToClear\"] = previousMonthTimeToClear;
		            resMap[\"pmttc\"] = previousMonthmeanTimeToClear;
              		log resMap;
		         	return resMap;
		        
		    }"
        },
        "102" : {
        	"description" : "ruleAlarmsDetails",
        	"usage" : "rulesSummary",
        	"workflow": "Map alarmDetails(Number ruleId)
		    	{
                  clearCondition = {
                    criteria :[severity == \"Clear\" ]
                  }
            	date = NameSpace(\"date\");
            	ranges = date.getDateRange(\"Current Week\");
                monthRanges = date.getDateRange(\"Current Month\");
		    	alarmsCurrWeekCri = {
              		criteria : [ruleId == ruleId && createdTime == ranges ]
            	};
                  alarmSevrityModule = Module(\"alarmseverity\");
                  AlarmSeverityContext clearSeverityContext = alarmSevrityModule.fetch(clearCondition);
                  clearId = clearSeverityContext.get(0).get(\"id\");
                  activeAssetcri = {
					criteria : [ruleId == ruleId && severity != clearId  ]
				};
		        readingAlarmModule = Module(\"readingalarm\");
                workOrderModule = Module(\"ticket\");
		        activeRecord = readingAlarmModule.fetch(activeAssetcri);
              	activeAlarms = 0;
                  activeAlarmResources = [];
              	if (activeRecord != null) {
                  for each index,value in activeRecord {
		                        if (value != null) {
                                  if (value.get(\"resource\") != null) {
                                    activeAlarmResources.add(value.get(\"resource\").get(\"id\"));
                                  }
		                        }                                
		                }
                      activeAlarms = activeRecord.size();
                 }
              	currWeekAlarmRec = readingAlarmModule.fetch(alarmsCurrWeekCri);
              	currWeekAlarms = 0;
              	alarmThisWeekResources = [];
              	if (currWeekAlarmRec != null) {
              		for each index,value in currWeekAlarmRec {
		                        if (value != null) {
                                  if (value.get(\"resource\") != null) {
                                    alarmThisWeekResources.add(value.get(\"resource\").get(\"id\"));
                                  }
		                        }                                
		                }
                	currWeekAlarms = currWeekAlarmRec.size();
             	}
                  resultMap = {};
                  resultMap[\"activeAlarms\"] = activeAlarms;
                  resultMap[\"alarmRuleThisWeek\"] = currWeekAlarms;
                  resultMap[\"activeAlarmResources\"] = activeAlarmResources;
                  resultMap[\"alarmThisWeekResources\"] = alarmThisWeekResources;
                  return resultMap;
		    }"
        },
          "103" : {
        	"description" : "ruleWoDetails",
        	"usage" : "rulesSummary",
        	"workflow": "Map ruleWoDetails(Number ruleId) {
		    date = NameSpace(\"date\");
		        ranges = date.getDateRange(\"Current Week\");
		          monthRanges = date.getDateRange(\"Current Month\");
		            alarmsCurrWeekCri = {
		              criteria: [ruleId == ruleId && createdTime == ranges]
		            }; readingAlarmModule = Module(\"readingalarm\");
		              workOrderModule = Module(\"workorder\");
		                woThisWeek = {
		                  criteria: [ruleId == ruleId && createdTime == ranges && woId != null],
		                  groupBy: \"woId\",
		                };
		
		                currWeekWo = readingAlarmModule.fetch(woThisWeek); currentWeekWo = 0 currentWeekWoId = []
		                if (currWeekWo != null) {
		                  currentWeekWo = currWeekWo.size();
		                  for each index, value in currWeekWo {
		                    if (value != null) {
		                      currentWeekWoId.add(value.get(\"woId\"));
		                     }
		                  }
		                }
		               woThisMonth = {
		                 criteria: [ruleId == ruleId && createdTime == monthRanges && woId != null],
		                 groupBy: \"woId\",
		               };
                      monthWO = readingAlarmModule.fetch(woThisMonth);
                      currentMonthWo = 0;
                      currentMonthWoID = [];
                      if (monthWO != null) {
                        currentMonthWo = monthWO.size();
                        for each index, value in monthWO {
                            if (value != null) {
                              	   currentMonthWoID.add(value.get(\"woId\"));
                                }
                              }
                            }
                            ticketContextRespondTime = {
                              criteria: [id == currentMonthWoID && actualWorkStart > 0 ]
                            };
                            ticketContextResolutionTime = {
                              criteria: [id == currentMonthWoID && actualWorkDuration > 0 ]
                            };
                            ticketsResponse = workOrderModule.fetch(ticketContextRespondTime);
                            ticketsResolution = workOrderModule.fetch(ticketContextResolutionTime);
                            previousMonthresponseTime = 0;
                            previousMonthresolutionTime = 0;
                            if (ticketsResponse != null) {
                              b = ticketsResponse.size();
                              for each index, value in ticketsResponse {
                                      wd = (value.actualWorkStart - value.createdTime); previousMonthresponseTime = (previousMonthresponseTime + wd);
                                    }
                                    previousMonthresponseTime = previousMonthresponseTime / b;
                                  }
                                   if (ticketsResolution != null) {
                             		 c = ticketsResolution.size();
                             	    for each index, value in ticketsResolution {
                             	        pd = value.actualWorkDuration;
                                        previousMonthresolutionTime = (previousMonthresolutionTime + pd);

                                    }
                                    previousMonthresolutionTime = previousMonthresolutionTime / c;
                                  }
                                  resultMap = {};
                                  resultMap[\"currentMonthWo\"] = currentMonthWo;
                                  resultMap[\"currentWeekWo\"] = currentWeekWo;
                                  resultMap[\"currentWeekWoId\"] = currentWeekWoId;
                                  resultMap[\"currentMonthWoID\"] = currentMonthWoID;
                                  resultMap[\"previousMonthresponseTime\"] = previousMonthresponseTime;
                                  resultMap[\"previousMonthresolutionTime\"] = previousMonthresolutionTime;
                                  log resultMap;
                                  return resultMap;
			}"
        },
         "104" : {
        	"description" : "ruleRank",
        	"usage" : "ruleRank",
        	"workflow": "Map rankWorkflow (Number ruleId){
				  date = NameSpace(\"date\");
				   monthRanges = date.getDateRange(\"Current Year\");
				  db = {
						criteria : [createdTime == monthRanges],
					    field : \"ruleId\",
				    	aggregation : \"count, ruleId\",
				    	groupBy: \"ruleId\",
				    	orderBy : \"ruleId\" desc
					};
				    readingAlarmModule = Module(\"readingalarm\");
				    activeRecord = readingAlarmModule.fetch(db);
  					let ranking = 0;
  					if (activeRecord != null ) {
                       for each index,value in activeRecord { 
							temp = value.result;
                         temp = value.result+0;
                         if(temp == ruleId) {
        					ranking = index + 1;
                           log \"test -- \"+index;
                         }
                         
                         
                       }
                    }
          			resultMap = {};
          			if (activeRecord != null) {
          				resultMap[\"ranks\"] = activeRecord;
  						resultMap[\"ranking\"] = ranking;
						resultMap[\"outOfRule\"] = activeRecord.size();
          			}
				   	return resultMap;
				}"
        },
    "105": {
    	"description" : "assetMaintenanceCost",
        "usage" : "assetSummary",
        "workflow" : "Map maintenanceCost(Number assetId) 
        			  	{ 
        			  		 woModule = Module(\"workorder\"); 
						     date = NameSpace(\"date\");
							 ranges = date.getDateRange(\"Current Year\");
						     res = woModule.fetch([totalCost !=null && resource == assetId && createdTime == ranges]); 
						    
						     maintenanceCost = 0;
						     plannedMaintenanceCost = 0;
						     unplannedMaintenanceCost = 0;
						  if(res !=null) {
						      for each index,value in res{
						         if(value.sourceType == 5){
						           plannedMaintenanceCost = plannedMaintenanceCost + value.totalCost;
						         }
						         else{
						           unplannedMaintenanceCost = unplannedMaintenanceCost + value.totalCost;
						         }
						     } 
						  }
						     resMap = {};
						     resMap[\"plannedMaintenanceCost\"] = plannedMaintenanceCost;
						     resMap[\"unplannedMaintenanceCost\"] = unplannedMaintenanceCost;
						     resMap[\"maintenanceCost\"] = plannedMaintenanceCost + unplannedMaintenanceCost;
						     return resMap; 
        			  	}"
        },
    "106": {
    	"description" : "assetPlannedMaintenanceCost",
        "usage" : "assetSummary",
        "workflow" : "Map maintenanceCost(Number assetId) 
        			  	{ 
        			  		 woModule = Module(\"workorder\"); 
						     date = NameSpace(\"date\");
							 ranges = date.getDateRange(\"Current Year\");
						     res = woModule.fetch([totalCost !=null && resource == assetId && createdTime == ranges]); 
						     woCostModule = Module(\"workorderCost\"); 
						   
						     pmItemsCost = 0;
						     pmToolCost = 0;
						     pmLabourCost = 0;
						     pmCustomCost = 0;
						     maintenanceCost = 0;
						     plannedMaintenanceCost = 0;
						     unplannedMaintenanceCost = 0;
						  if(res !=null) {
						      for each index,value in res{
						       costResult = woCostModule.fetch([cost !=null && parentId == value.id]);
						         if(value.sourceType == 5){
						          if(costResult != null){
						           for each cosIndex,cosValue in costResult{
						           
						             if(cosValue.costType == 1){
						               pmItemsCost = pmItemsCost + cosValue.cost ;
						             }else if(cosValue.costType == 2){
						               pmToolCost = pmToolCost + cosValue.cost ;
						             }else if(cosValue.costType == 3){
						               pmLabourCost = pmLabourCost + cosValue.cost ;
						             }else {
						               pmCustomCost = pmCustomCost + cosValue.cost ;
						             }
						            }
						           }
						           
						           plannedMaintenanceCost = plannedMaintenanceCost + value.totalCost;
						           
						         }
						         else{
						           unplannedMaintenanceCost = unplannedMaintenanceCost + value.totalCost;
						           
						         }
						     } 
						  }
						     resMap = {};
						     resMap[\"pmItemsCost\"] = pmItemsCost;
						     resMap[\"pmToolCost\"] = pmToolCost;
						     resMap[\"pmLabourCost\"] = pmLabourCost;
						     resMap[\"pmCustomCost\"] = pmCustomCost;
						     resMap[\"maintenanceCost\"] = plannedMaintenanceCost + unplannedMaintenanceCost;
						     return resMap; 
        			  	}"
        },
    "107": {
    	"description" : "assetUnplannedMaintenanceCost",
        "usage" : "assetSummary",
        "workflow" : "Map maintenanceCost(Number assetId) 
        			  	{ 
        			  		 woModule = Module(\"workorder\"); 
						     date = NameSpace(\"date\");
							 ranges = date.getDateRange(\"Current Year\");
						     res = woModule.fetch([totalCost !=null && resource == assetId && createdTime == ranges]); 
						     woCostModule = Module(\"workorderCost\"); 
						     
						     upmItemsCost = 0;
						     upmToolCost = 0;
						     upmLabourCost = 0;
						     upmCustomCost = 0;
						     maintenanceCost = 0;
						     plannedMaintenanceCost = 0;
						     unplannedMaintenanceCost = 0;
						  if(res !=null) {
						      for each index,value in res{
						       costResult = woCostModule.fetch([cost !=null && parentId == value.id]);
						         if(value.sourceType == 5){
						          
						           plannedMaintenanceCost = plannedMaintenanceCost + value.totalCost;
						           
						         }
						         else{
						         if(costResult != null){
						           for each cosIndex,cosValue in costResult{
						            
						             if(cosValue.costType == 1){
						               upmItemsCost = upmItemsCost + cosValue.cost ;
						             }else if(cosValue.costType == 2){
						               upmToolCost = upmToolCost + cosValue.cost ;
						             }else if(cosValue.costType == 3){
						               upmLabourCost = upmLabourCost + cosValue.cost ;
						             }else {
						               upmCustomCost = upmCustomCost + cosValue.cost ;
						             }
						            
						           }
						          } 
						           unplannedMaintenanceCost = unplannedMaintenanceCost + value.totalCost;
						           
						         }
						     } 
						  }
						     resMap = {};
						     resMap[\"upmItemsCost\"] = upmItemsCost;
						     resMap[\"upmToolCost\"] = upmToolCost;
						     resMap[\"upmLabourCost\"] = upmLabourCost;
						     resMap[\"upmCustomCost\"] = upmCustomCost;
						     resMap[\"maintenanceCost\"] = plannedMaintenanceCost + unplannedMaintenanceCost;
						     return resMap; 
        			  	}"
        }
        
}