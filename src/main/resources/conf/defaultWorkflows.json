{
   "0": {
        "description" : "sample",
        "usage" : "test",
        "workflow" : "Number getSquareOf(Number i)
                      {
                      		return i * i;
                      }"
        },
   "1": {
    	"description" : "woAverageResponseTime",
        "usage" : "pmSummary",
        "workflow" : "Map test(Number pmId) 
        			  	{ 
        			  		woModule = Module(\"workorder\"); 
        			  		res = woModule.fetch([pm == pmId && actualWorkStart > 0]); 
        			  		if (res == null) 
        			  		{ 
        			  			return 0; 
        			  		} 
  							date = NameSpace(\"date\");
    						temp = date.getPreviousMonthEndDate();
  							previousMonthRes = woModule.fetch([pm == pmId && actualWorkStart > 0 && createdTime <= temp]);
  							previousMonthresponseTime = 0; 
  							if (previousMonthRes != null) {	
	        			  		b = previousMonthRes.size(); 
	                              for each index,value in previousMonthRes { 
	        			  			wd =  (value.actualWorkStart - value.createdTime); 
	        			  			previousMonthresponseTime = (previousMonthresponseTime + wd);
	        			  		}
                                previousMonthresponseTime = previousMonthresponseTime/b; 
                            }
        			  		responseTime = 0; 
        			  		a = res.size(); 
        			  		for each index,value in res { 
        			  			wd =  (value.actualWorkStart - value.createdTime); 
        			  			responseTime = (responseTime + wd);
        			  		} 
        			  		responseTime = responseTime/a; 
                            resMap = {};
                            resMap[\"responseTime\"] = responseTime;
                            resMap[\"previousMonthresponseTime\"] = previousMonthresponseTime;
         					return resMap; 
        			  	}"
        },
		"2": {
			"description" : "fetchGraphicsData",
			"usage" : "graphics",
			"workflow" : "Map fetchGraphicsData(List variables) 
							  {
								  resultMap = {};
								  if (variables == null) {
									  return resultMap;
								  }
								  recordMap = {}
								  for each index, variableObj in variables {
									  if (variableObj.fetchType == \"field\") {
									  	  recordKey = variableObj.module + \"_\" + variableObj.parentId;
									  	  recordObj = {};
									  	  if (recordMap.get(recordKey) != null) {
									  	  	  recordObj = recordMap.get(recordKey);
									  	  }
									  	  else {
									  	      fetchModule = Module(variableObj.module);
									  	      recordObj = fetchModule.fetch([id == (variableObj.parentId)]);
									  	      recordMap[recordKey] = recordObj;
									  	  }
									  	  if (recordObj != null && recordObj.size() > 0) {
									  	  	  rec = recordObj[0];
									  	  	  
									  	  	  valueMap = {};
											  valueMap[\"value\"] = rec.get(variableObj.select);
									  	  	  resultMap[variableObj.key] = valueMap;
									  	  }
									  }
									  else if (variableObj.fetchType == \"liveValue\") {
									  	  fieldObj = NameSpace(\"module\").getField(variableObj.select, variableObj.module);
									  	  fieldid = fieldObj.id();
									  	  fieldMapInfo = fieldObj.asMap();
									  	  
									  	  lastVal = Reading(fieldid, variableObj.parentId).getLastValue();
									  	  enumMap = Reading(fieldid, variableObj.parentId).getEnumMap();
										  
										  valueMap = {};
										  valueMap[\"value\"] = lastVal;
										  if (enumMap != null) {
										      valueMap[\"enumMap\"] = enumMap;
										  }
										  if (fieldMapInfo != null) {
										  	valueMap[\"unit\"] = fieldMapInfo.get(\"unit\");
                                            valueMap[\"dataType\"] = fieldMapInfo.get(\"dataTypeEnum\");
										  }
										  
										  resultMap[variableObj.key] = valueMap;
									  }
									  else if (variableObj.fetchType == \"aggrValue\") {
									  	  fieldObj = NameSpace(\"module\").getField(variableObj.select, variableObj.module);
									  	  fieldMapInfo = fieldObj.asMap();
									  	  
										  fetchModule = Module(variableObj.module);
										  
										  date = NameSpace(\"date\");
										month = date.getDateRange(variableObj.dateRange);
										db = {
											criteria : [parentId == (variableObj.parentId) && ttime == month],
											field : variableObj.select,
											aggregation : variableObj.aggr
										};
										
										res = fetchModule.fetch(db);
										
										valueMap = {};
										valueMap[\"value\"] = res;
										
										enumMap = Reading(fieldid, variableObj.parentId).getEnumMap();
                                        
                                        if (enumMap != null) {
                                          valueMap[\"enumMap\"] = enumMap;
                                        }
                                        if (fieldMapInfo != null) {
                                          valueMap[\"unit\"] = fieldMapInfo.get(\"unit\");
                                          valueMap[\"dataType\"] = fieldMapInfo.get(\"dataTypeEnum\");
                                        }
										
										resultMap[variableObj.key] = valueMap;
									  }
								  }
									  
								return resultMap; 
				}"
		},
		"3": {
			"description" : "fetchConsumptionDetailsForMVSummary",
			"usage" : "total consumption,baseline consumption,carbon saved for MV summary",
			"workflow" : "Map test(Number projectId) 
							{ 
							  resultMap = {};
							  carbonConstant = 0.41;
							  costConstant = 0.44;
							  mvProject = Module(\"mvproject\").fetch([id == projectId])[0];
							  baseline = Module(\"mvbaseline\").fetch([project == projectId])[0];
							  formulaFieldWithAdj = Module(\"formulaField\").fetch([id == (baseline.formulaFieldWithAjustment.id)])[0];
							  lastMonthEndTime = NameSpace(\"date\").getDateRange(\"Last Month\").getEndTime();
							  db = {
							    criteria : [parentId == (mvProject.meter.id) && ttime >= (mvProject.reportingPeriodStartTime) && ttime < lastMonthEndTime],
							    field : \"totalEnergyConsumptionDelta\",
							    aggregation : \"sum\"
							  }
							  thisMonthActualConsumption = Module(\"energydata\").fetch(db);
							  if(thisMonthActualConsumption == null) {
							    thisMonthActualConsumption = 0;
							  }
							  resultMap[\"thisMonthActualConsumption\"] = thisMonthActualConsumption;
							  db = {
							    criteria : [parentId == (mvProject.meter.id) && ttime >= (mvProject.reportingPeriodStartTime) && ttime < lastMonthEndTime],
							    field : (formulaFieldWithAdj.readingField.name),
							    aggregation : \"sum\"
							  }
							  thisMonthBaselineConsumption = Module(formulaFieldWithAdj.moduleName).fetch(db);
							  if(thisMonthBaselineConsumption == null) {
							    thisMonthBaselineConsumption = 0;
							  }
							  resultMap[\"thisMonthBaselineConsumption\"] = thisMonthBaselineConsumption;
							
							  savedConsumption = thisMonthBaselineConsumption - thisMonthActualConsumption;
							  carbonEmissionSaved = savedConsumption * carbonConstant;
							  resultMap[\"carbonEmissionSaved\"] = carbonEmissionSaved;
							
							  costSaved = savedConsumption * costConstant;
							  resultMap[\"costSaved\"] = costSaved;
							
							  if(mvProject.saveGoal != null) {
							    targetSavedConsumption =  (thisMonthBaselineConsumption*(mvProject.saveGoal)/100);
							  }
							  else {
							    saveGoalFormulaField = Module(\"formulaField\").fetch([id == (mvProject.saveGoalFormulaField.id)])[0];
							    db = {
							    	criteria : [parentId == (mvProject.meter.id) && ttime >= (mvProject.reportingPeriodStartTime) && ttime < lastMonthEndTime],
							    	field : (saveGoalFormulaField.readingField.name),
							    	aggregation : \"sum\"
							  	}
							    thisMonthTargetConsumption = Module(saveGoalFormulaField.moduleName).fetch(db);
							    targetSavedConsumption = thisMonthBaselineConsumption - thisMonthTargetConsumption;
							  }
							  targetCost = targetSavedConsumption * costConstant;
							  resultMap[\"targetCost\"] = targetCost;
							  return resultMap;
							}"
		},
        "101": {
        	"description" : "meanTimeBetweenTriggers",
        	"usage" : "rulesSummary",
        	"workflow": "Map getRuleTriggerDetials(Number ruleId) 
		    { 
		            cri = {
						criteria : [ruleId == ruleId && clearedTime > 0 ],
		        		orderBy : \"createdTime\" asc
					};
		            date = NameSpace(\"date\");
		            ranges = date.getDateRange(\"Last Month\");
		        	readingAlarmModule = Module(\"readingalarm\"); 
		        	res = readingAlarmModule.fetch(cri);
		            previousMonthDetails = readingAlarmModule.fetch([ruleId == ruleId  && createdTime == ranges]);
		            meanTimeBetweenTigger = 0;
		            timeToClear = 0;
		            meanTimeToClear = 0;
		            if (res != null) {
		                firstRes =res[0];
		                previousClearedTime = 0 
		                if (firstRes.clearedTime != null ) {
		                  previousClearedTime = firstRes.clearedTime;
		                }
		                for each index,value in res {
							if(index > 0) {
		                        if (value != null) {
		                            createdTime = value.createdTime;
		      						meanTimeBetweenTigger = meanTimeBetweenTigger + (createdTime -previousClearedTime); 
		      						if (value.clearedTime != null) {
		      							previousClearedTime = value.clearedTime ;
		      						
		      						}
		                        }                                
							}
		                }
					    meanTimeBetweenTigger = meanTimeBetweenTigger / res.size();	
		                for each index,value in res {
					        if(index > 0) {
		                        if (value != null) {
		      				        timeToClear = timeToClear + (value.clearedTime - value.createdTime); 
		                        }                                
					        }
		                } 
		                 meanTimeToClear =   timeToClear / res.size();
		            }
		            previousMonthMeanTimeBetweenTigger = 0;
		            previousMonthTimeToClear = 0;
		            previousMonthmeanTimeToClear = 0;
                	previousMonthClearedTime = 0;
		            if (previousMonthDetails != null ) {
		                previousRes =previousMonthDetails[0];
                      if (previousRes.clearedTime != null ) {
                        previousMonthClearedTime = previousRes.clearedTime
                      }
		                for each index,value in previousMonthDetails {
						    if(index > 0) {
		                        if (value != null) {
		                            createdTime = value.createdTime;
		      						previousMonthMeanTimeBetweenTigger = previousMonthMeanTimeBetweenTigger + (createdTime -previousMonthClearedTime); 
                                  if (value.clearedTime  != null ) {
                                    previousMonthClearedTime = value.clearedTime ;
                                  }
		                        }                                
							}
		                }
						previousMonthMeanTimeBetweenTigger = previousMonthMeanTimeBetweenTigger / previousMonthDetails.size();
		                for each index,value in previousMonthDetails {
							if(index > 0) {
		                        if (value != null) {
                                  previousCreatedTime = 0;
                                  previousClearedTime = 0;
                                  if (value.clearedTime != null) {
                                    previousClearedTime = value.clearedTime
                                  } 
                                  if (value.createdTime != null) {
                                    previousCreatedTime = value.createdTime

                                  }
		      						previousMonthTimeToClear = previousMonthTimeToClear + (previousClearedTime - previousCreatedTime); 
		                        }                                
							}
		                } 
		                previousMonthmeanTimeToClear =   previousMonthTimeToClear / previousMonthDetails.size();
		            }
					resMap = {};
		            resMap[\"mtbt\"] = meanTimeBetweenTigger;
		            resMap[\"timeToClear\"] = timeToClear;
		            resMap[\"mttc\"] = meanTimeToClear;
		            resMap[\"pmtbt\"] = previousMonthMeanTimeBetweenTigger;
		            resMap[\"previousMonthTimeToClear\"] = previousMonthTimeToClear;
		            resMap[\"pmttc\"] = previousMonthmeanTimeToClear;
		         	return resMap;
		        
		    }"
        },
        "102" : {
        	"description" : "meanTimeBetweenTriggers",
        	"usage" : "rulesSummary",
        	"workflow": "Map test(ruleId)
		    	{
		     		activeAssetcri = {
					criteria : [ruleId == ruleId && clearedTime == null ]
				};
            	date = NameSpace(\"date\");
            	ranges = date.getDateRange(\"Current Week\");
		    	alarmsCurrWeekCri = {
              		criteria : [ruleId == ruleId && createdTime == ranges ]
            	};
		        readingAlarmModule = Module(\"readingalarm\");
		        activeRecord = readingAlarmModule.fetch(activeAssetcri);
              	activeAlarms = 0;
              	if (activeRecord != null) {
                      activeAlarms = res.size();
                 }
              	currWeekAlarmRec = readingAlarmModule.fetch(alarmsCurrWeekCri);
              	currWeekAlarms = 0;
              	if (currWeekAlarms != null) {
                	currWeekAlarms = currWeekAlarms.size();
             	}
              	resultMap = {};
              	resultMap[\"activeAlarms\"] = activeAlarms;
		    }"
        }
        
}