
-- Create Organizations Table
CREATE TABLE IF NOT EXISTS Organizations (
	ORGID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGNAME VARCHAR(100),
	FACILIODOMAINNAME VARCHAR(50),
	LOGO_ID BIGINT,
	PHONE CHAR(20),
	MOBILE CHAR(20),
	FAX CHAR(50),
	STREET CHAR(255),
  	CITY CHAR(255),
  	STATE CHAR(255),
  	ZIP CHAR(255),
  	COUNTRY CHAR(255),
  	CURRENCY CHAR(100),
  	TIMEZONE CHAR(100),
  	CREATED_TIME BIGINT,
  	DELETED_TIME BIGINT DEFAULT -1
);

-- Create Users Table
CREATE TABLE IF NOT EXISTS Users (
	USERID BIGINT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(255),
	USER_VERIFIED BOOLEAN,
	EMAIL VARCHAR(150),
	PASSWORD VARCHAR(150),
	PHOTO_ID BIGINT,
	TIMEZONE CHAR(100),
	LANGUAGE CHAR(50),
	PHONE CHAR(20),
	MOBILE CHAR(20),
	STREET VARCHAR(255),
	CITY VARCHAR(255),
	STATE VARCHAR(255),
	ZIP VARCHAR(255),
	COUNTRY VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS UserSessions (
	SESSIONID BIGINT AUTO_INCREMENT PRIMARY KEY,
	USERID BIGINT,
	TOKEN VARCHAR(1000),
	START_TIME BIGINT DEFAULT -1,
	END_TIME BIGINT DEFAULT -1,
	IS_ACTIVE BOOLEAN,
	IPADDRESS VARCHAR(200),
	USER_AGENT VARCHAR(3000),
	CONSTRAINT USERSESSIONS_FK_USERID FOREIGN KEY (USERID) REFERENCES Users(USERID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS `faciliousers` (
`id` int( 11 ) NOT NULL AUTO_INCREMENT ,
`username` varchar( 200 ) NOT NULL ,
`email` varchar( 200 ) NOT NULL ,
`mobile` char(20) DEFAULT NULL,
USERID BIGINT NOT NULL,
PRIMARY KEY ( `id` ) ,
UNIQUE KEY `username` ( `username` ) ,
UNIQUE KEY `email` ( `email` ),
CONSTRAINT faciliousers_FK_USERID FOREIGN KEY (USERID) REFERENCES Users(USERID) ON UPDATE CASCADE
)  DEFAULT CHARSET = utf8;

CREATE TABLE IF NOT EXISTS User_Mobile_Setting (
	USER_MOBILE_SETTING_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	USERID BIGINT NOT NULL,
	MOBILE_INSTANCE_ID VARCHAR(500) NOT NULL,
	CREATED_TIME BIGINT,
	CONSTRAINT UNIQUE_INSTANCE_ID UNIQUE(USERID, MOBILE_INSTANCE_ID),
	CONSTRAINT USER_MOBILE_SETTING_FK_USERID FOREIGN KEY (USERID) REFERENCES Users(USERID)
);

-- Create Roles Table
CREATE TABLE IF NOT EXISTS Role (
	ROLE_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	NAME VARCHAR(50),
	DESCRIPTION VARCHAR(500),
	CREATED_TIME BIGINT,
	CONSTRAINT ROLE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Permission (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ROLE_ID BIGINT NOT NULL,
	MODULE_NAME VARCHAR(100),
	PERMISSION BIGINT NOT NULL,
	CONSTRAINT PERMISSION_FK_ROLEID FOREIGN KEY (ROLE_ID) REFERENCES Role(ROLE_ID)
);

CREATE TABLE IF NOT EXISTS File (
  FILE_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  FILE_NAME CHAR(255),
  FILE_PATH CHAR(255),
  FILE_SIZE BIGINT,
  CONTENT_TYPE CHAR(255),
  UPLOADED_BY BIGINT,
  UPLOADED_TIME BIGINT,
  IS_DELETED BOOLEAN,
  CONSTRAINT FILE_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Modules (
	MODULEID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	DISPLAY_NAME VARCHAR(150),
	TABLE_NAME VARCHAR(50) NOT NULL,
	EXTENDS_ID BIGINT,
	MODULE_TYPE TINYINT NOT NULL,
	IS_TRASH_ENABLED BOOLEAN,
	DATA_INTERVAL INT,
	CONSTRAINT MODULES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT MODULES_FK_PARENT FOREIGN KEY (EXTENDS_ID) REFERENCES Modules(MODULEID),
	CONSTRAINT MODULES_UNQIUE UNIQUE(ORGID, NAME)
);



CREATE TABLE IF NOT EXISTS Resources (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(1000),
	PHOTO_ID BIGINT,
	RESOURCE_TYPE TINYINT NOT NULL,
	SPACE_ID BIGINT,
	CONTROLLER_ID BIGINT,
	SYS_DELETED BOOLEAN,
	SITE_ID BIGINT,
	QR_VALUE VARCHAR(500),
	CONSTRAINT RESOURCES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT RESOURCES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT RESOURCES_FK_SPACE_ID FOREIGN KEY (SPACE_ID) REFERENCES Resources(ID),
	CONSTRAINT RESOURCES_FK_PHOTO_ID FOREIGN KEY (PHOTO_ID) REFERENCES File (FILE_ID),
	CONSTRAINT RESOURCES_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Resources(ID),
	CONSTRAINT RESOURCES_UNIQYE_QR_VALUE UNIQUE (ORGID, QR_VALUE)
);

CREATE INDEX RESOURCES_NAME ON Resources (ORGID,MODULEID,NAME);

-- Create ORG_Users Table
CREATE TABLE IF NOT EXISTS ORG_Users (
	ORG_USERID BIGINT PRIMARY KEY,
	USERID BIGINT,
	ORGID BIGINT,
	INVITEDTIME BIGINT,
	LICENSE INT,
	ISDEFAULT BOOLEAN,
	USER_STATUS BOOLEAN,
	INVITATION_ACCEPT_STATUS BOOLEAN,
	ROLE_ID BIGINT,
	USER_TYPE TINYINT,
	DELETED_TIME BIGINT DEFAULT -1,
	PORTAL_VERIFIED TINYINT DEFAULT NULL,
	CONSTRAINT ORG_USERS_FK_ORG_USERID FOREIGN KEY (ORG_USERID) REFERENCES Resources(ID) ON DELETE CASCADE,
	CONSTRAINT ORG_USERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ORG_USERS_FK_USERID FOREIGN KEY (USERID) REFERENCES Users(USERID) ON UPDATE CASCADE,
	CONSTRAINT ORG_USERS_FK_ROLE_ID FOREIGN KEY (ROLE_ID) REFERENCES Role(ROLE_ID)
);


CREATE TABLE IF NOT EXISTS Locations (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  MODULEID BIGINT NOT NULL,
  NAME CHAR(255) NOT NULL,
  STREET CHAR(255),
  CITY CHAR(255),
  STATE CHAR(255),
  ZIP CHAR(255),
  COUNTRY CHAR(255),
  LAT DOUBLE NOT NULL,
  LNG DOUBLE NOT NULL,
  CONTACT_ID BIGINT NULL,
  PHONE CHAR(100),
  FAX_PHONE CHAR(100),
  CONSTRAINT LOCATIONS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT LOCATIONS_MODULEID_FK FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
  CONSTRAINT LOCATIONS_CONTACT_FK FOREIGN KEY (CONTACT_ID) REFERENCES ORG_Users (ORG_USERID)
);

CREATE TABLE IF NOT EXISTS BaseSpace (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	AREA DOUBLE(9,3),
	SPACE_TYPE TINYINT NOT NULL, 
	OPERATION_HOURS_START FLOAT,
	OPERATION_HOURS_END FLOAT,
	MAX_OCCUPANCY INT,
	LOCAL_ID INT,
	SITE_ID BIGINT,
	BUILDING_ID BIGINT,
	FLOOR_ID BIGINT,
	SPACE_ID1 BIGINT,
	SPACE_ID2 BIGINT,
	SPACE_ID3 BIGINT,
	SPACE_ID4 BIGINT,
	CONSTRAINT BASE_SPACE_FK_ID FOREIGN KEY (ID) REFERENCES Resources(ID) ON DELETE CASCADE,
	CONSTRAINT BASE_SPACE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BASE_SPACE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT BASE_SPACE_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES BaseSpace (ID),
	CONSTRAINT BASE_SPACE_FK_BUILDING_ID FOREIGN KEY (BUILDING_ID) REFERENCES BaseSpace (ID),
	CONSTRAINT BASE_SPACE_FK_FLOOR_ID FOREIGN KEY (FLOOR_ID) REFERENCES BaseSpace (ID),
	CONSTRAINT BASE_SPACE_FK_SPACE_ID1 FOREIGN KEY (SPACE_ID1) REFERENCES BaseSpace (ID),
	CONSTRAINT BASE_SPACE_FK_SPACE_ID2 FOREIGN KEY (SPACE_ID2) REFERENCES BaseSpace (ID),
	CONSTRAINT BASE_SPACE_FK_SPACE_ID3 FOREIGN KEY (SPACE_ID3) REFERENCES BaseSpace (ID),
	CONSTRAINT BASE_SPACE_FK_SPACE_ID4 FOREIGN KEY (SPACE_ID4) REFERENCES BaseSpace (ID)
);

CREATE TABLE IF NOT EXISTS Site (
       ID BIGINT PRIMARY KEY,
       ORGID BIGINT NOT NULL,
       MODULEID BIGINT NOT NULL,
       LOCATION_ID BIGINT,
       MANAGED_BY BIGINT,
       NO_OF_BUILDINGS INT,
       GROSS_FLOOR_AREA DOUBLE(9,3),
       SITE_TYPE INT,
       WEATHER_STATION VARCHAR(100),
       CDD_BASE_TEMPERATURE DOUBLE,
       HDD_BASE_TEMPERATURE DOUBLE,
       WDD_BASE_TEMPERATURE DOUBLE,
       STRING_CF1 VARCHAR(50),
       STRING_CF2 VARCHAR(50),
       STRING_CF3 VARCHAR(50),
       STRING_CF4 VARCHAR(50),
       STRING_CF5 VARCHAR(50),
       NUMBER_CF1 BIGINT,
       NUMBER_CF2 BIGINT,
       NUMBER_CF3 BIGINT,
       NUMBER_CF4 BIGINT,
       NUMBER_CF5 BIGINT,
       DECIMAL_CF1 DOUBLE(9,3),
       DECIMAL_CF2 DOUBLE(9,3),
       DECIMAL_CF3 DOUBLE(9,3),
       DECIMAL_CF4 DOUBLE(9,3),
       DECIMAL_CF5 DOUBLE(9,3),
       BOOLEAN_CF1 BOOLEAN,
       BOOLEAN_CF2 BOOLEAN,
       BOOLEAN_CF3 BOOLEAN,
       BOOLEAN_CF4 BOOLEAN,
       BOOLEAN_CF5 BOOLEAN,
       DATE_CF1 BIGINT,
       DATE_CF2 BIGINT,
       DATE_CF3 BIGINT,
       DATE_CF4 BIGINT,
       DATE_CF5 BIGINT,
       DATETIME_CF1 BIGINT,
       DATETIME_CF2 BIGINT,
       DATETIME_CF3 BIGINT,
       DATETIME_CF4 BIGINT,
       DATETIME_CF5 BIGINT,
       CONSTRAINT SITE_FK_ID FOREIGN KEY (ID) REFERENCES BaseSpace(ID) ON DELETE CASCADE,
       CONSTRAINT SITE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
       CONSTRAINT SITE_FK_MANAGED_BY FOREIGN KEY (MANAGED_BY) REFERENCES ORG_Users (ORG_USERID),
       CONSTRAINT SITE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
       CONSTRAINT SITE_FK_LOCATION_ID FOREIGN KEY (LOCATION_ID) REFERENCES Locations(ID)
);




CREATE TABLE IF NOT EXISTS Global_FacilioAuthToken (
	`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	authtoken DOUBLE not null,
	ORGID BIGINT not null,
	USERID BIGINT not null,
	CONSTRAINT Global_FacilioAuthToken_USERID_FK FOREIGN KEY (USERID) REFERENCES ORG_Users (ORG_USERID),
	CONSTRAINT Global_FacilioAuthToken_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

-- Create GLobal_Domain_Index
CREATE TABLE IF NOT EXISTS Global_Domain_Index (
	DOMAINNAME VARCHAR(50),
	ORGID BIGINT 
);

-- Creating org_units table

CREATE TABLE IF NOT EXISTS Org_Units (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  METRIC int(11) DEFAULT NULL,
  UNIT int(11) DEFAULT NULL,
  CONSTRAINT ORG_UNITS_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

-- Create Jobs Table
CREATE TABLE IF NOT EXISTS Jobs (
	JOBID BIGINT,
	ORGID BIGINT,
	JOBNAME VARCHAR(50),
	IS_ACTIVE BOOLEAN,
	TRANSACTION_TIMEOUT INT,
	IS_PERIODIC BOOLEAN,	
	PERIOD INT,
	SCHEDULE_INFO VARCHAR(1000),
	NEXT_EXECUTION_TIME BIGINT,
	EXECUTOR_NAME VARCHAR(50),
	END_EXECUTION_TIME BIGINT,
	MAX_EXECUTION INT,
	CURRENT_EXECUTION_COUNT INT,
	STATUS tinyint(4) NOT NULL DEFAULT 3,
    JOB_SERVER_ID bigint(20) NOT NULL DEFAULT 0,
    CURRENT_EXECUTION_TIME bigint(20) NOT NULL DEFAULT 0,
    EXECUTION_ERROR_COUNT tinyint(4) NOT NULL DEFAULT 0,
	CONSTRAINT JOBS_PK PRIMARY KEY (JOBID, JOBNAME),
	CONSTRAINT JOBS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

-- Create Jobs Table
CREATE TABLE IF NOT EXISTS System_Jobs (
	JOBID BIGINT,
	LAST_EXECUTION_TIME BIGINT,
	CONSTRAINT SYSTEM_JOBS_FK_JOBID FOREIGN KEY (JOBID) REFERENCES Jobs(JOBID)
);

CREATE TABLE IF NOT EXISTS UtilityProviders (
	UTILITYID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	USERID BIGINT,
	LOGINURL TEXT,
	USERNAME TEXT,
	PASSWORD TEXT,
	STATUS INT,
	CONSTRAINT UTILITY_PROVIDERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT UTILITY_PROVIDERS_FK_USERID FOREIGN KEY (USERID) REFERENCES ORG_Users(USERID) 
);

CREATE TABLE IF NOT EXISTS MeasurementType (
   TYPEID BIGINT AUTO_INCREMENT PRIMARY KEY,
   TYPENAME VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS MeasurementUnit(
   UNITID BIGINT AUTO_INCREMENT PRIMARY KEY,
   TYPEID BIGINT,
   UNITNAME VARCHAR(50),
   UNITSYMBOL VARCHAR(30),
   CONSTRAINT MEASUREMENT_UNIT_FK_TYPEID FOREIGN KEY (TYPEID) REFERENCES MeasurementType(TYPEID)
);

CREATE TABLE IF NOT EXISTS MeasurementConversion (
   TYPEID BIGINT,
   FROMUNITID  BIGINT,
   TOUNITID   BIGINT,
   FROMUNITOFFSET FLOAT,
   MULTIPLICAND FLOAT,
   DIVIDEND FLOAT,
   TOUNITOFFSET FLOAT,
   CONSTRAINT MEASUREMENT_CONVERSION_PK PRIMARY KEY (TYPEID, FROMUNITID, TOUNITID),
   CONSTRAINT MEASUREMENT_CONVERSION_FK_TYPEID FOREIGN KEY (TYPEID) REFERENCES MeasurementType(TYPEID),
   CONSTRAINT MEASUREMENT_CONVERSION_FK_FROMUNITID FOREIGN KEY (FROMUNITID) REFERENCES MeasurementUnit(UNITID),
   CONSTRAINT MEASUREMENT_CONVERSION_FK_TOUNITID FOREIGN KEY (TOUNITID) REFERENCES MeasurementUnit(UNITID)
);

CREATE TABLE IF NOT EXISTS Modules (
	MODULEID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	DISPLAY_NAME VARCHAR(150),
	TABLE_NAME VARCHAR(50) NOT NULL,
	EXTENDS_ID BIGINT,
	MODULE_TYPE TINYINT NOT NULL,
	IS_TRASH_ENABLED BOOLEAN,
	DATA_INTERVAL INT,
	CONSTRAINT MODULES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT MODULES_FK_PARENT FOREIGN KEY (EXTENDS_ID) REFERENCES Modules(MODULEID),
	CONSTRAINT MODULES_UNQIUE UNIQUE(ORGID, NAME)
);

CREATE TABLE IF NOT EXISTS `Groups` (
	GROUPID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	GROUP_NAME VARCHAR(255),
	GROUP_EMAIL VARCHAR(255),
	GROUP_DESC VARCHAR(1000),
	IS_ACTIVE BOOLEAN NOT NULL,
	CREATED_TIME BIGINT,
	CREATED_BY BIGINT,
	PARENT BIGINT,
	SITE_ID BIGINT,
	CONSTRAINT GROUPS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT GROUPS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS `GroupMembers` (
	MEMBERID BIGINT AUTO_INCREMENT PRIMARY KEY,
	GROUPID BIGINT,
	ORG_USERID BIGINT,
	MEMBER_ROLE INT,
	CONSTRAINT GROUP_MEMBERS_FK_ORGID FOREIGN KEY (GROUPID) REFERENCES `Groups`(GROUPID) ON DELETE CASCADE,
	CONSTRAINT GROUP_MEMBERS_FK_USERID FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS ORGCache	(
   ORGID BIGINT,
   URL VARCHAR(500),
   CONTENT TEXT,
   EXPIREAT BIGINT,
   CONSTRAINT ORG_CACHE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS SubModulesRel (
	PARENT_MODULE_ID BIGINT,
	CHILD_MODULE_ID BIGINT,
	PRIMARY KEY (PARENT_MODULE_ID, CHILD_MODULE_ID),
	CONSTRAINT SUB_MODULES_REL_PARENT_FK FOREIGN KEY (PARENT_MODULE_ID) REFERENCES Modules(MODULEID) ON DELETE CASCADE,
	CONSTRAINT SUB_MODULES_REL_CHILD_FK FOREIGN KEY (CHILD_MODULE_ID) REFERENCES Modules(MODULEID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Fields (
	FIELDID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	EXTENDED_MODULEID BIGINT,
	NAME VARCHAR(100) NOT NULL,
	DISPLAY_NAME VARCHAR(150),
	DISPLAY_TYPE TINYINT,
	COLUMN_NAME VARCHAR(50),
	SEQUENCE_NUMBER TINYINT,
	DATA_TYPE TINYINT NOT NULL,
	IS_DEFAULT BOOLEAN,
	IS_MAIN_FIELD BOOLEAN,
	REQUIRED BOOLEAN,
	DISABLED BOOLEAN,
	STYLE_CLASS VARCHAR(50),
	ICON VARCHAR(20),
	PLACE_HOLDER VARCHAR(50),
	CONSTRAINT FIELDS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FIELDS_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT FIELDS_EXTENDED_MODULEID FOREIGN KEY (EXTENDED_MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT FIELDS_NAME_UNIQUE UNIQUE (ORGID, MODULEID, NAME),
	CONSTRAINT FIELDS_COLUMN_NAME_UNIQUE UNIQUE (ORGID, MODULEID, COLUMN_NAME)
);

CREATE TABLE IF NOT EXISTS LookupFields (
	FIELDID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	LOOKUP_MODULE_ID BIGINT,
	SPECIAL_TYPE VARCHAR(25),
	CONSTRAINT LOOKUP_FIELDS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT LOOKUP_FIELDS_FK_FIELDID FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE,
	CONSTRAINT LOOKUP_FIELDS_FK_MODULE_ID FOREIGN KEY (LOOKUP_MODULE_ID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS NumberFields (
	FIELDID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	UNIT VARCHAR(50),
	METRIC INT,
	IS_COUNTER_FIELD BOOLEAN,
	CONSTRAINT NUMBER_FIELDS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT NUMBER_FIELDS_FK_FIELDID FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE 
);

CREATE TABLE IF NOT EXISTS BooleanFields (
	FIELDID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	TRUE_VAL VARCHAR(100),
	FALSE_VAL VARCHAR(100),
	CONSTRAINT BOOLEAN_FIELDS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BOOLEAN_FIELDS_FK_FIELDID FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE 
);

CREATE TABLE IF NOT EXISTS EnumFieldValues (
	FIELDID BIGINT NOT NULL,
	ORGID BIGINT NOT NULL,
	IDX INT NOT NULL,
	VAL VARCHAR(100) NOT NULL,
	PRIMARY KEY(ORGID,FIELDID,IDX),
	CONSTRAINT ENUM_FIELD_VALUES_UNIQUE UNIQUE (ORGID,FIELDID,VAL),
	CONSTRAINT ENUM_FIELD_VALUES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ENUM_FIELD_VALUES_FK_FIELDID FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE 
);

CREATE TABLE IF NOT EXISTS Shift_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	SHIFT_ENTRY TINYINT NOT NULL,
	CONSTRAINT SHIFT_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SHIFT_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT SHIFT_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES ORG_Users(ORG_USERID)
);

-- Create indexes for Shift_Reading table
CREATE INDEX SHIFT_READINGS_PARENT_ID_INDEX on Shift_Readings (PARENT_ID);
CREATE INDEX SHIFT_READINGS_PARENT_ID_TTIME_INDEX ON Shift_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX SHIFT_READINGS_TTIME_INDEX ON Shift_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS BusinessHours (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	CONSTRAINT BUSINESS_HOURS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS SingleDayBusinessHours (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	PARENT_ID BIGINT NOT NULL,
	DAY_OF_WEEK TINYINT NOT NULL,
	START_TIME TIME NOT NULL,
	END_TIME TIME NOT NULL,
	CONSTRAINT SINGLE_DAY_BUSINESS_HOURS FOREIGN KEY (PARENT_ID) REFERENCES BusinessHours(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS File (
  FILE_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  FILE_NAME CHAR(255),
  FILE_PATH CHAR(255),
  FILE_SIZE BIGINT,
  CONTENT_TYPE CHAR(255),
  UPLOADED_BY BIGINT,
  UPLOADED_TIME BIGINT,
  CONSTRAINT FILE_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS ResizedFile (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  FILE_ID BIGINT NOT NULL,
  ORGID BIGINT NOT NULL,
  WIDTH INT,
  HEIGHT INT,
  FILE_PATH CHAR(255),
  FILE_SIZE BIGINT,
  CONTENT_TYPE CHAR(255),
  GENERATED_TIME BIGINT,
  URL VARCHAR(8000),
  EXPIRY_TIME BIGINT,
  CONSTRAINT RESIZEDFILE_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT RESIZEDFILE_FK_ID FOREIGN KEY (FILE_ID) REFERENCES File(FILE_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Common_Job_Props (
	JOBID BIGINT NOT NULL,
	ORGID BIGINT,
	JOBNAME VARCHAR(50) NOT NULL,
	PROPS VARCHAR(10000) NOT NULL,
	CONSTRAINT COMMON_JOB_PROPS_PK PRIMARY KEY (JOBID, JOBNAME),
	CONSTRAINT COMMON_JOB_PROPS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Workflow (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  WORKFLOW_XML_STRING VARCHAR(10000) DEFAULT NULL,
  UI_MODE TINYINT,
  CONSTRAINT WORKFLOW_ORG_ID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

CREATE TABLE IF NOT EXISTS Workflow_Field (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  WORKFLOW_ID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  FIELD_ID BIGINT DEFAULT NULL,
  RESOURCE_ID BIGINT DEFAULT NULL,
  AGGREGATION INT DEFAULT NULL,
  CONSTRAINT WORKFLOW_FIELDS_FIELD_ID FOREIGN KEY (FIELD_ID) REFERENCES Fields (FIELDID),
  CONSTRAINT WORKFLOW_FIELDS_MODULE_ID FOREIGN KEY (MODULEID) REFERENCES Modules (MODULEID),
  CONSTRAINT WORKFLOW_FIELDS_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT WORKFLOW_FIELDS_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID),
  CONSTRAINT WORKFLOW_FIELDS_WORKLFOW_ID FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow (ID) ON DELETE CASCADE,
  CONSTRAINT WORKFLOW_FIELDS_UNIQUE_ID UNIQUE(ORGID, MODULEID, FIELD_ID, RESOURCE_ID)
);


CREATE TABLE IF NOT EXISTS Accessible_Space (
	ORG_USER_ID BIGINT,
	BS_ID BIGINT,
	SITE_ID BIGINT,
	PRIMARY KEY (ORG_USER_ID, BS_ID),
	CONSTRAINT ACCESSIBLE_SPACE_ORG_USER_ID_FK FOREIGN KEY (ORG_USER_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT ACCESSIBLE_SPACE_BS_ID_FK FOREIGN KEY (BS_ID) REFERENCES BaseSpace(ID),
	CONSTRAINT ACCESSIBLE_SPACE_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Resource_Readings (
	RESOURCE_ID BIGINT,
	READING_ID BIGINT,
	PRIMARY KEY (RESOURCE_ID,READING_ID),
	CONSTRAINT RESOURCE_READINGS_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID) ON DELETE CASCADE,
	CONSTRAINT RESOURCE_READINGS_FK_READING_ID FOREIGN KEY (READING_ID) REFERENCES Modules(MODULEID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Current_Occupancy_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	CURRENT_OCCUPANCY INT NOT NULL,
	CONSTRAINT CURRENT_OCCUPANCY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CURRENT_OCCUPANCY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CURRENT_OCCUPANCY_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX CURRENT_OCCUPANCY_PARENT_ID_INDEX on Current_Occupancy_Reading (PARENT_SPACE);
CREATE INDEX CURRENT_OCCUPANCY_PARENT_ID_TTIME_INDEX ON Current_Occupancy_Reading (ORGID, MODULEID, PARENT_SPACE, TTIME);
CREATE INDEX CURRENT_OCCUPANCY_TTIME_INDEX ON Current_Occupancy_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Assigned_Occupancy_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	ASSIGNED_OCCUPANCY INT NOT NULL,
	CONSTRAINT ASSIGNED_OCCUPANCY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSIGNED_OCCUPANCY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ASSIGNED_OCCUPANCY_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX ASSIGNED_OCCUPANCY_PARENT_ID_INDEX on Assigned_Occupancy_Reading (PARENT_SPACE);
CREATE INDEX ASSIGNED_OCCUPANCY_PARENT_ID_TTIME_INDEX ON Assigned_Occupancy_Reading (ORGID, MODULEID, PARENT_SPACE, TTIME);
CREATE INDEX ASSIGNED_OCCUPANCY_TTIME_INDEX ON Assigned_Occupancy_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Temperature_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	TEMPERATURE DOUBLE(9,3) NOT NULL,
	CONSTRAINT TEMPERATURE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TEMPERATURE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TEMPERATURE_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX TEMPERATURE_PARENT_ID_INDEX on Temperature_Reading (PARENT_SPACE);
CREATE INDEX TEMPERATURE_PARENT_ID_TTIME_INDEX ON Temperature_Reading (ORGID, MODULEID, PARENT_SPACE, TTIME);
CREATE INDEX TEMPERATURE_TTIME_INDEX ON Temperature_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Humidity_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	HUMIDITY INT NOT NULL,
	CONSTRAINT HUMIDITY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT HUMIDITY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT HUMIDITY_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX HUMIDITY_PARENT_ID_INDEX on Humidity_Reading (PARENT_SPACE);
CREATE INDEX HUMIDITY_PARENT_ID_TTIME_INDEX ON Humidity_Reading (ORGID, MODULEID, PARENT_SPACE, TTIME);
CREATE INDEX HUMIDITY_TTIME_INDEX ON Humidity_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS CO2_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	CO2 DOUBLE(9,3) NOT NULL,
	CONSTRAINT CO2_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CO2_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CO2_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX CO2_PARENT_ID_INDEX on CO2_Reading (PARENT_SPACE);
CREATE INDEX CO2_PARENT_ID_TTIME_INDEX ON CO2_Reading (ORGID, MODULEID, PARENT_SPACE, TTIME);
CREATE INDEX CO2_TTIME_INDEX ON CO2_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Set_Point_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	SET_POINT DOUBLE(9,3) NOT NULL,
	CONSTRAINT SET_POINT_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SET_POINT_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT SET_POINT_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX SET_POINT_PARENT_ID_INDEX on Set_Point_Reading (PARENT_SPACE);
CREATE INDEX SET_POINT_PARENT_ID_TTIME_INDEX ON Set_Point_Reading (ORGID, MODULEID, PARENT_SPACE, TTIME);
CREATE INDEX SET_POINT_TTIME_INDEX ON Set_Point_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Weather_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	SUMMARY VARCHAR(100),
	ICON VARCHAR(100),
	TEMPERATURE DOUBLE,
	HUMIDITY DOUBLE,
	DEW_POINT DOUBLE,
	PRESSURE DOUBLE,
	APPARENT_TEMPERATURE DOUBLE,
	CONSTRAINT WEATHER_READING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WEATHER_READING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT WEATHER_READING_FK_PARENT_SPACE FOREIGN KEY (PARENT_ID) REFERENCES BaseSpace (ID)
);
-- Create indexes for Weather_Reading table
CREATE INDEX WEATHER_READING_PARENT_ID_INDEX on Weather_Reading (PARENT_ID);
CREATE INDEX WEATHER_READING_PARENT_ID_TTIME_INDEX ON Weather_Reading (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX WEATHER_READING_TTIME_INDEX ON Weather_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Psychrometric_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	DEWPOINT_TEMPERATURE DOUBLE,
	WETBULB_TEMPERATURE DOUBLE,
	ENTHALPY DOUBLE,
	CONSTRAINT PSYCHROMETRIC_READING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT PSYCHROMETRIC_READING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT PSYCHROMETRIC_READING_FK_PARENT_SPACE FOREIGN KEY (PARENT_ID) REFERENCES BaseSpace (ID)
);
-- Create indexes for Psychrometric_Reading table
CREATE INDEX PSYCHROMETRIC_READING_PARENT_ID_INDEX on Psychrometric_Reading (PARENT_ID);
CREATE INDEX PSYCHROMETRIC_READING_PARENT_ID_TTIME_INDEX ON Psychrometric_Reading (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX PSYCHROMETRIC_READING_TTIME_INDEX ON Psychrometric_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS CDD_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	CDD DOUBLE,
	CONSTRAINT CDD_READING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CDD_READING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CDD_READING_FK_PARENT_SPACE FOREIGN KEY (PARENT_ID) REFERENCES BaseSpace (ID)
);
-- Create indexes for CDD_Reading table
CREATE INDEX CDD_READING_PARENT_ID_INDEX on CDD_Reading (PARENT_ID);
CREATE INDEX CDD_READING_PARENT_ID_TTIME_INDEX ON CDD_Reading (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX CDD_READING_TTIME_INDEX ON CDD_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS HDD_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	HDD DOUBLE,
	CONSTRAINT HDD_READING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT HDD_READING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT HDD_READING_FK_PARENT_SPACE FOREIGN KEY (PARENT_ID) REFERENCES BaseSpace (ID)
);
-- Create indexes for CDD_Reading table
CREATE INDEX HDD_READING_PARENT_ID_INDEX on HDD_Reading (PARENT_ID);
CREATE INDEX HDD_READING_PARENT_ID_TTIME_INDEX ON HDD_Reading (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX HDD_READING_TTIME_INDEX ON HDD_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS WDD_Reading (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	WDD DOUBLE,
	CONSTRAINT WDD_READING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WDD_READING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT WDD_READING_FK_PARENT_SPACE FOREIGN KEY (PARENT_ID) REFERENCES BaseSpace (ID)
);
-- Create indexes for CDD_Reading table
CREATE INDEX WDD_READING_PARENT_ID_INDEX on WDD_Reading (PARENT_ID);
CREATE INDEX WDD_READING_PARENT_ID_TTIME_INDEX ON WDD_Reading (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX WDD_READING_TTIME_INDEX ON WDD_Reading (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS BaseSpace_Photos (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	PHOTO_ID BIGINT NOT NULL,
	CONSTRAINT BASESPACE_PHOTOS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BASESPACE_PHOTOS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT BASESPACE_PHOTOS_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID),
	CONSTRAINT BASESPACE_PHOTOS_FK_PHOTO_ID FOREIGN KEY (PHOTO_ID) REFERENCES File (FILE_ID)
);

CREATE TABLE IF NOT EXISTS BaseSpace_Attachments (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_SPACE BIGINT NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	FILE_ID BIGINT NOT NULL,
	CONSTRAINT BASESPACE_ATTACHEMENTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BASESPACE_ATTACHEMENTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT BASESPACE_ATTACHEMENTS_FK_PARENT_SPACE FOREIGN KEY (PARENT_SPACE) REFERENCES BaseSpace (ID),
	CONSTRAINT BASESPACE_ATTACHEMENTS_FK_FILE_ID FOREIGN KEY (FILE_ID) REFERENCES File (FILE_ID)
);

CREATE TABLE IF NOT EXISTS BaseSpace_Notes (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	MODULEID BIGINT NOT NULL,
	CREATED_BY BIGINT,
	CREATED_TIME BIGINT,
	PARENT_ID BIGINT NOT NULL,
	TITLE VARCHAR(50),
	BODY VARCHAR(1000) NOT NULL,
	CONSTRAINT BASESPACE_NOTES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BASESPACE_NOTES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT BASESPACE_NOTES_FK_CREATED_BY_ID FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT BASESPACE_NOTES_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES BaseSpace (ID)
);

CREATE TABLE IF NOT EXISTS Site (
       ID BIGINT PRIMARY KEY,
       ORGID BIGINT NOT NULL,
       MODULEID BIGINT NOT NULL,
       LOCATION_ID BIGINT,
       MANAGED_BY BIGINT,
       NO_OF_BUILDINGS INT,
       GROSS_FLOOR_AREA DOUBLE(9,3),
       SITE_TYPE INT,
       WEATHER_STATION VARCHAR(100),
       CDD_BASE_TEMPERATURE DOUBLE,
       HDD_BASE_TEMPERATURE DOUBLE,
       WDD_BASE_TEMPERATURE DOUBLE,
       STRING_CF1 VARCHAR(50),
       STRING_CF2 VARCHAR(50),
       STRING_CF3 VARCHAR(50),
       STRING_CF4 VARCHAR(50),
       STRING_CF5 VARCHAR(50),
       NUMBER_CF1 BIGINT,
       NUMBER_CF2 BIGINT,
       NUMBER_CF3 BIGINT,
       NUMBER_CF4 BIGINT,
       NUMBER_CF5 BIGINT,
       DECIMAL_CF1 DOUBLE(9,3),
       DECIMAL_CF2 DOUBLE(9,3),
       DECIMAL_CF3 DOUBLE(9,3),
       DECIMAL_CF4 DOUBLE(9,3),
       DECIMAL_CF5 DOUBLE(9,3),
       BOOLEAN_CF1 BOOLEAN,
       BOOLEAN_CF2 BOOLEAN,
       BOOLEAN_CF3 BOOLEAN,
       BOOLEAN_CF4 BOOLEAN,
       BOOLEAN_CF5 BOOLEAN,
       DATE_CF1 BIGINT,
       DATE_CF2 BIGINT,
       DATE_CF3 BIGINT,
       DATE_CF4 BIGINT,
       DATE_CF5 BIGINT,
       DATETIME_CF1 BIGINT,
       DATETIME_CF2 BIGINT,
       DATETIME_CF3 BIGINT,
       DATETIME_CF4 BIGINT,
       DATETIME_CF5 BIGINT,
       CONSTRAINT SITE_FK_ID FOREIGN KEY (ID) REFERENCES BaseSpace(ID) ON DELETE CASCADE,
       CONSTRAINT SITE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
       CONSTRAINT SITE_FK_MANAGED_BY FOREIGN KEY (MANAGED_BY) REFERENCES ORG_Users (ORG_USERID),
       CONSTRAINT SITE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
       CONSTRAINT SITE_FK_LOCATION_ID FOREIGN KEY (LOCATION_ID) REFERENCES Locations(ID)
);

CREATE TABLE IF NOT EXISTS `Groups` (
	GROUPID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	GROUP_NAME VARCHAR(255),
	GROUP_EMAIL VARCHAR(255),
	GROUP_DESC VARCHAR(1000),
	IS_ACTIVE BOOLEAN NOT NULL,
	CREATED_TIME BIGINT,
	CREATED_BY BIGINT,
	PARENT BIGINT,
	SITE_ID BIGINT,
	CONSTRAINT GROUPS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT GROUPS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS `GroupMembers` (
	MEMBERID BIGINT AUTO_INCREMENT PRIMARY KEY,
	GROUPID BIGINT,
	ORG_USERID BIGINT,
	MEMBER_ROLE INT,
	CONSTRAINT GROUP_MEMBERS_FK_ORGID FOREIGN KEY (GROUPID) REFERENCES `Groups`(GROUPID) ON DELETE CASCADE,
	CONSTRAINT GROUP_MEMBERS_FK_USERID FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Forms (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	NAME VARCHAR(255) NOT NULL,
	DISPLAYNAME VARCHAR(255) NOT NULL,
	MODULEID BIGINT NOT NULL,
	FORM_TYPE TINYINT NOT NULL,
	CONSTRAINT FORMS_UNIQUE UNIQUE (ORGID, MODULEID, NAME),
	CONSTRAINT FORMS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FORMS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT FORMS_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS Form_Fields (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	FORMID BIGINT NOT NULL,
	DISPLAYNAME VARCHAR(255) NOT NULL,
	FIELDID BIGINT,
	DISPLAY_TYPE TINYINT NOT NULL,
	REQUIRED BOOLEAN DEFAULT false NOT NULL,
	SEQUENCE_NUMBER TINYINT NOT NULL,
	SPAN TINYINT NOT NULL DEFAULT 1,
	CONSTRAINT FORMFIELDS_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FORMFIELDS_FORMID FOREIGN KEY (FORMID) REFERENCES Forms(ID) ON DELETE CASCADE,
	CONSTRAINT FORMFIELDS_FIELDID FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID),
	CONSTRAINT FORMFIELDS_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS Building (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	LOCATION_ID BIGINT,
	MANAGED_BY BIGINT,
	GROSS_FLOOR_AREA DOUBLE(10,3),
	NO_OF_FLOORS INT,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE(9,3),
	DECIMAL_CF2 DOUBLE(9,3),
	DECIMAL_CF3 DOUBLE(9,3),
	DECIMAL_CF4 DOUBLE(9,3),
	DECIMAL_CF5 DOUBLE(9,3),
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT BUILDING_FK_ID FOREIGN KEY (ID) REFERENCES BaseSpace(ID) ON DELETE CASCADE,
	CONSTRAINT BUILDING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT BUILDING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BUILDING_FK_LOCATION_ID FOREIGN KEY (LOCATION_ID) REFERENCES Locations(ID),
	CONSTRAINT BUILDING_FK_MANAGED_BY FOREIGN KEY (MANAGED_BY) REFERENCES ORG_Users (ORG_USERID),
	CONSTRAINT BUILDING_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Controller (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	NAME VARCHAR(100) NOT NULL,
	MAC_ADDR VARCHAR(100) NOT NULL,
	DATA_INTERVAL INT,
	BATCHES_PER_CYCLE TINYINT,
	ACTIVE BOOLEAN NOT NULL,
	CONSTRAINT CONTROLLER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CONTROLLER_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID),
	CONSTRAINT CONTROLLER_UNIQUE_ORGID_MAC_ADDR UNIQUE(ORGID, MAC_ADDR)
);

ALTER TABLE Resources ADD CONSTRAINT RESOURCES_FK_CONTROLLER_ID FOREIGN KEY (CONTROLLER_ID) REFERENCES Controller (ID);

CREATE TABLE IF NOT EXISTS Controller_Activity (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	CONTROLLER_MAC_ADDR VARCHAR(100) NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	RECORD_TIME BIGINT NOT NULL,
	CONSTRAINT CONTROLLER_ACTIVITY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CONTROLLER_ACTIVITY_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE INDEX CONTROLLER_ACTIVITY_ORG_MAC_ADDR_TIME ON Controller_Activity (ORGID,CONTROLLER_MAC_ADDR,RECORD_TIME);

CREATE TABLE IF NOT EXISTS Controller_Activity_Records ( -- Having separate table because Controller_Activity will be queried frequently
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	CURRENT_RECORDS LONGTEXT NOT NULL,
	CONSTRAINT CONTROLLER_ACTIVITY_RECORDS_FK_ID FOREIGN KEY (ID) REFERENCES Controller_Activity(ID) ON DELETE CASCADE,
	CONSTRAINT CONTROLLER_ACTIVITY_RECORDS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CONTROLLER_ACTIVITY_RECORDS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)	
);

CREATE TABLE IF NOT EXISTS Controller_Activity_Watcher (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	RECORD_TIME BIGINT NOT NULL,
	DATA_INTERVAL INT NOT NULL,
	LEVEL TINYINT NOT NULL,
	COMPLETION_STATUS BOOLEAN,
	CONSTRAINT CONTROLLER_ACTIVITY_WATCHER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CONTROLLER_ACTIVITY_WATCHER_UNIQUE_RECORD UNIQUE(ORGID,RECORD_TIME,DATA_INTERVAL, LEVEL)
);

CREATE TABLE IF NOT EXISTS Controller_Building_Rel (
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	CONTROLLER_ID BIGINT NOT NULL,
	BUILDING_ID BIGINT NOT NULL,
	CONSTRAINT CONTROLLER_BUILDING_REL_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CONTROLLER_BUILDING_REL_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID),
	CONSTRAINT CONTROLLER_BUILDING_REL_FK_CONTROLLER_ID FOREIGN KEY (CONTROLLER_ID) REFERENCES Controller(ID),
	CONSTRAINT CONTROLLER_BUILDING_REL_FK_BUILDING_ID FOREIGN KEY (BUILDING_ID) REFERENCES Building(ID)
);

CREATE TABLE IF NOT EXISTS Floor (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	FLOOR_LEVEL TINYINT,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE(9,3),
	DECIMAL_CF2 DOUBLE(9,3),
	DECIMAL_CF3 DOUBLE(9,3),
	DECIMAL_CF4 DOUBLE(9,3),
	DECIMAL_CF5 DOUBLE(9,3),
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT FLOOR_FK_ID FOREIGN KEY (ID) REFERENCES BaseSpace(ID) ON DELETE CASCADE,
	CONSTRAINT FLOOR_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT FLOOR_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FLOOR_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Space_Category (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50),
	DESCRIPTION VARCHAR(1000),
	IS_COMMON_AREA BOOLEAN,
	CONSTRAINT SPACE_CATEGORY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT SPACE_CATEGORY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Space_Category_Readings (
	PARENT_CATEGORY_ID BIGINT,
	READING_MODULE_ID BIGINT,
	PRIMARY KEY (PARENT_CATEGORY_ID, READING_MODULE_ID),
	CONSTRAINT SPACE_CATEGORY_READINGS_PARENT_FK FOREIGN KEY (PARENT_CATEGORY_ID) REFERENCES Space_Category(ID),
	CONSTRAINT SPACE_CATEGORY_READINGS_CHILD_FK FOREIGN KEY (READING_MODULE_ID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Space (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SPACE_CATEGORY_ID BIGINT,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE(9,3),
	DECIMAL_CF2 DOUBLE(9,3),
	DECIMAL_CF3 DOUBLE(9,3),
	DECIMAL_CF4 DOUBLE(9,3),
	DECIMAL_CF5 DOUBLE(9,3),
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT SPACE_FK_ID FOREIGN KEY (ID) REFERENCES BaseSpace(ID) ON DELETE CASCADE,
	CONSTRAINT SPACE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT SPACE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SPACE_FK_CATEGORY_ID FOREIGN KEY (SPACE_CATEGORY_ID) REFERENCES Space_Category(ID),
	CONSTRAINT SPACE_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Zone (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT,
	CONSTRAINT ZONE_FK_ID FOREIGN KEY (ID) REFERENCES BaseSpace(ID) ON DELETE CASCADE,
	CONSTRAINT ZONE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ZONE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ZONE_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Zone_Space (
	ZONE_ID BIGINT,
	BASE_SPACE_ID BIGINT,
	IS_IMMEDIATE TINYINT,
	CONSTRAINT ZONE_SPACE_FK_ZONE_ID FOREIGN KEY (ZONE_ID) REFERENCES Zone(ID) ON DELETE CASCADE,
	CONSTRAINT ZONE_SPACE_FK_BASE_SPACE_ID FOREIGN KEY (BASE_SPACE_ID) REFERENCES BaseSpace(ID)
);

CREATE TABLE IF NOT EXISTS Asset_Types (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50),
	IS_MOVABLE BOOLEAN,
	CONSTRAINT ASSET_TYPES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_TYPES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Asset_Categories (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50),
	CATEGORY_TYPE TINYINT NOT NULL,
	PARENT_CATEGORY_ID BIGINT,
	CONSTRAINT ASSET_CATEGORIES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_CATEGORIES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ASSET_CATEGORIES_FK_PARENT_CATEGORY_ID FOREIGN KEY (PARENT_CATEGORY_ID) REFERENCES Asset_Categories(ID)
);

CREATE TABLE IF NOT EXISTS Asset_Category_Readings (
	PARENT_CATEGORY_ID BIGINT,
	READING_MODULE_ID BIGINT,
	PRIMARY KEY (PARENT_CATEGORY_ID, READING_MODULE_ID),
	CONSTRAINT ASSET_CATEGORY_READINGS_PARENT_FK FOREIGN KEY (PARENT_CATEGORY_ID) REFERENCES Asset_Categories(ID),
	CONSTRAINT ASSET_CATEGORY_READINGS_CHILD_FK FOREIGN KEY (READING_MODULE_ID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Asset_Departments (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50),
	CONSTRAINT ASSET_DEPARTMENTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_DEPARTMENTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Assets (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	STATE TINYINT,
	ASSET_TYPE BIGINT,
	CATEGORY BIGINT,
	PARENT_ASSET_ID BIGINT,
	DEPARTMENT_ID BIGINT,
	MANUFACTURER VARCHAR(100),
	MODEL VARCHAR(100),
	SERIAL_NUMBER VARCHAR(100),
	TAG_NUMBER VARCHAR(100),
	PART_NUMBER VARCHAR(100),
	UNIT_PRICE INT,
	SUPPLIER VARCHAR(100),
	PURCHASED_DATE BIGINT,
	RETIRE_DATE BIGINT,
	WARRANTY_EXPIRY_DATE BIGINT,
	LOCAL_ID INT,
	HIDE_TO_CUSTOMER BOOLEAN,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	STRING_CF6 VARCHAR(50),
	STRING_CF7 VARCHAR(50),
	STRING_CF8 VARCHAR(50),
	STRING_CF9 VARCHAR(50),
	STRING_CF10 VARCHAR(50),
	STRING_CF11 VARCHAR(50),
	STRING_CF12 VARCHAR(50),
	STRING_CF13 VARCHAR(50),
	STRING_CF14 VARCHAR(50),
	STRING_CF15 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	NUMBER_CF6 BIGINT,
	NUMBER_CF7 BIGINT,
	NUMBER_CF8 BIGINT,
	NUMBER_CF9 BIGINT,
	NUMBER_CF10 BIGINT,
	NUMBER_CF11 BIGINT,
	NUMBER_CF12 BIGINT,
	NUMBER_CF13 BIGINT,
	NUMBER_CF14 BIGINT,
	NUMBER_CF15 BIGINT,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	DECIMAL_CF6 DOUBLE,
	DECIMAL_CF7 DOUBLE,
	DECIMAL_CF8 DOUBLE,
	DECIMAL_CF9 DOUBLE,
	DECIMAL_CF10 DOUBLE,
	DECIMAL_CF11 DOUBLE,
	DECIMAL_CF12 DOUBLE,
	DECIMAL_CF13 DOUBLE,
	DECIMAL_CF14 DOUBLE,
	DECIMAL_CF15 DOUBLE,
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	BOOLEAN_CF6 BOOLEAN,
	BOOLEAN_CF7 BOOLEAN,
	BOOLEAN_CF8 BOOLEAN,
	BOOLEAN_CF9 BOOLEAN,
	BOOLEAN_CF10 BOOLEAN,
	BOOLEAN_CF11 BOOLEAN,
	BOOLEAN_CF12 BOOLEAN,
	BOOLEAN_CF13 BOOLEAN,
	BOOLEAN_CF14 BOOLEAN,
	BOOLEAN_CF15 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATE_CF6 BIGINT,
	DATE_CF7 BIGINT,
	DATE_CF8 BIGINT,
	DATE_CF9 BIGINT,
	DATE_CF10 BIGINT,
	DATE_CF11 BIGINT,
	DATE_CF12 BIGINT,
	DATE_CF13 BIGINT,
	DATE_CF14 BIGINT,
	DATE_CF15 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	DATETIME_CF6 BIGINT,
	DATETIME_CF7 BIGINT,
	DATETIME_CF8 BIGINT,
	DATETIME_CF9 BIGINT,
	DATETIME_CF10 BIGINT,
	DATETIME_CF11 BIGINT,
	DATETIME_CF12 BIGINT,
	DATETIME_CF13 BIGINT,
	DATETIME_CF14 BIGINT,
	DATETIME_CF15 BIGINT,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT ASSET_FK_ID FOREIGN KEY (ID) REFERENCES Resources(ID) ON DELETE CASCADE,
	CONSTRAINT ASSET_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ASSET_FK_ASSET_TYPE FOREIGN KEY (ASSET_TYPE) REFERENCES Asset_Types(ID) ON DELETE SET NULL,
	CONSTRAINT ASSET_FK_CATEGORY FOREIGN KEY (CATEGORY) REFERENCES Asset_Categories(ID),
	CONSTRAINT ASSET_FK_PARENT_ASSET_ID FOREIGN KEY (PARENT_ASSET_ID) REFERENCES Assets(ID),
	CONSTRAINT ASSET_FK_DEPARTMENT_ID FOREIGN KEY (DEPARTMENT_ID) REFERENCES Asset_Departments(ID) ON DELETE SET NULL,
	CONSTRAINT ASSET_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE INDEX ASSETS_LOCAL_ID ON Assets (ORGID,MODULEID,LOCAL_ID);
CREATE INDEX ASSETS_TYPE ON Assets (ORGID,MODULEID,ASSET_TYPE);

CREATE TABLE IF NOT EXISTS Energy_Meter_Purpose (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50) NOT NULL,
	CONSTRAINT ENERGY_METER_PURPOSE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ENERGY_METER_PURPOSE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Energy_Meter (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PURPOSE_ID BIGINT,
	IS_ROOT BOOLEAN,
	PURPOSE_SPACE_ID BIGINT,
	IS_VIRTUAL BOOLEAN,
	CHILD_METER_EXPRESSION VARCHAR(100),
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT ENERGY_METER_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT ENERGY_METER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ENERGY_METER_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ENERGY_METER_FK_PURPOSE_ID FOREIGN KEY (PURPOSE_ID) REFERENCES Energy_Meter_Purpose(ID),
	CONSTRAINT ENERGY_METER_FK_PURPOSE_SPACE_ID FOREIGN KEY (PURPOSE_SPACE_ID) REFERENCES BaseSpace(ID),
	CONSTRAINT ENERGY_METER_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(id)
);

CREATE TABLE IF NOT EXISTS Virtual_Energy_Meter_Rel (
	VIRTUAL_METER_ID BIGINT,
	CHILD_METER_ID BIGINT,
	PRIMARY KEY (VIRTUAL_METER_ID, CHILD_METER_ID),
	CONSTRAINT VIRTUAL_ENERGY_METER_REL_METER_ID FOREIGN KEY (VIRTUAL_METER_ID) REFERENCES Energy_Meter(ID) ON DELETE CASCADE,
	CONSTRAINT VIRTUAL_ENERGY_METER_REL_CHILD_ID FOREIGN KEY (CHILD_METER_ID) REFERENCES Energy_Meter(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Chiller (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT CHILLER_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT CHILLER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Chiller_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	OUT_DOOR_TEMPERATURE DOUBLE,
	RETURN_TEMPERATURE DOUBLE,
	SUPPLY_TEMPERATURE DOUBLE,
	CHILLER_SETPOINT DOUBLE,
	CHILLED_WATER_RETURN DOUBLE,
	CONTROL_POINT DOUBLE,
	CIRCUIT_A_CURRENT DOUBLE,
	CIRCUIT_B_CURRENT DOUBLE,
	DELTA_T DOUBLE,
	DIFFERENTIAL_PRESSURE DOUBLE,
	FAILURE BOOLEAN,
	CHILLER_LOAD DOUBLE,
	RUN_STATUS BOOLEAN,
	SETPOINT DOUBLE,
	TOTAL_CURRENT DOUBLE,
	TRIP_STATUS BOOLEAN,
	CAP_T_CH_2 DOUBLE,
	CAP_T_CH_3 DOUBLE,
	CAPA_T DOUBLE,
	CAPB_T DOUBLE,
	CTRL_WT DOUBLE,
	CURR_LIM DOUBLE,
	DB_B DOUBLE,
	ALARM_STATUS BOOLEAN,
	AVERAGE_LINE_VOLTAGE DOUBLE,
	CHILLED_WATER_P_FV_STATUS BOOLEAN,
	CHILLED_WATER_FLOW_STATUS BOOLEAN,
	CHILLED_WATER_VALVE_OPEN_STATUS BOOLEAN,
	COMPRESSOR_RUNNING_HOURS DOUBLE,
	COMPRESSOR_STARTS DOUBLE,
	CURRENT_SET_POINT_ACTIVE DOUBLE,
	EVAPORATOR_APPROACH_TEMPERATURE DOUBLE,
	EVAPORATOR_SATURATED_REFRIGERANT_PRESSURE DOUBLE,
	EVAPORATOR_SATURATED_REFRIGERANT_TEMPERATURE DOUBLE,
	OIL_TEMPERATURE DOUBLE,
	RLA DOUBLE,
	SYSTEM_SUPPLY_TEMPERATURE DOUBLE,
	SYSTEM_RETURN_TEMPERATURE DOUBLE,
	CPC_ALARM DOUBLE,
	CONDENSER_SUPPLY_HEADER_TEMPERATURE DOUBLE,
	CONDENSER_RETURN_HEADER_TEMPERATURE DOUBLE,
	DPT DOUBLE,
	CIRCUIT_A_SUCTION_PRESSURE DOUBLE,
	CIRCUIT_A_EXV_VALVE_POSITION DOUBLE,
	CIRCUIT_B_SUCTION_PRESSURE DOUBLE,
	CIRCUIT_B_EXV_VALVE_POSITION DOUBLE,
	COMPRESSOR_A_SUCTION_TEMPERATURE DOUBLE,
	COMPRESSOR_B_SUCTION_TEMPERATURE DOUBLE,
	COMPRESSOR_A_HOURS DOUBLE,
	COMPRESSOR_A_STARTS DOUBLE,
	COMPRESSOR_B_HOURS DOUBLE,
	COMPRESSOR_B_STARTS DOUBLE,
	SHUT_DOWN BOOLEAN,
	ALARM_OUT BOOLEAN,
	ALERT BOOLEAN,
	READY BOOLEAN,
	MACHINE_OPERATING_HOURS DOUBLE,
	MACHINE_START_NUMBER DOUBLE,
	COOLING_SETPOINT_2 DOUBLE,
	CHILLER_OCCUPIED BOOLEAN,
	MINUTES_LEFT_FOR_START DOUBLE,
	HEAT_RECLAIM_SELECT BOOLEAN,
	FREE_COOLING_DISABLE BOOLEAN,
	EMERGENCY_STOP BOOLEAN,
	SETPOINT_OCCUPIED BOOLEAN,
	COOLING_SETPOINT_1 DOUBLE,
	TRIP_ALARM BOOLEAN,
	ALARM BOOLEAN,
	HEAT_COOL_SELECT BOOLEAN,
	CHILLER_CAPACITY_SIGNAL DOUBLE,
	LAG_CAPACITY_LIMIT_VALVE DOUBLE,
	ACTIVE_DEMAND_LIMIT_VALVE DOUBLE,
	RUN_HOURS DOUBLE,
	CURRENT_CONTROL VARCHAR(500),
	FAIL_RESET VARCHAR(500),
	CONSTRAINT CHILLER_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Chiller(ID)
);

-- Create indexes for Chiller_Readings table
CREATE INDEX CHILLER_READINGS_PARENT_ID_INDEX on Chiller_Readings (PARENT_ID);
CREATE INDEX CHILLER_READINGS_PARENT_ID_TTIME_INDEX ON Chiller_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX CHILLER_READINGS_TTIME_INDEX ON Chiller_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Chiller_Condenser_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	CONDENSER_ENTERING_WATER_TEMPERATURE DOUBLE,
	CONDENSER_LEAVING_WATER_TEMPERATURE DOUBLE,
	COOLING_TOWER_ENTERING_WATER_TEMPERATURE DOUBLE,
	COOLING_TOWER_LEAVING_WATER_TEMPERATURE DOUBLE,
	CONDENSER_APPROACH_TEMPERATURE DOUBLE,
	CONDENSER_SATURATED_REFRIGERANT_PRESSURE DOUBLE,
	CONDENSER_SATURATED_REFRIGERANT_TEMPERATURE DOUBLE,
	CONDENSER_VALVE_OPEN_STATUS BOOLEAN,
	CONDENSER_WATER_FLOW_STATUS BOOLEAN,
	CONDENSER_WATER_P_FV_STATUS BOOLEAN,
	CONSTRAINT CHILLER_CONDENSER_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_CONDENSER_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_CONDENSER_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Chiller(ID)
);

-- Create indexes for Chiller_Condenser_Readings table
CREATE INDEX CHILLER_CONDENSER_READINGS_PARENT_ID_INDEX on Chiller_Condenser_Readings (PARENT_ID);
CREATE INDEX CHILLER_CONDENSER_READINGS_PARENT_ID_TTIME_INDEX ON Chiller_Condenser_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX CHILLER_CONDENSER_READINGS_TTIME_INDEX ON Chiller_Condenser_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Chiller_Primary_Pump (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT CHILLER_PRIMARY_PUMP_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT CHILLER_PRIMARY_PUMP_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_PRIMARY_PUMP_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_PRIMARY_PUMP_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Chiller_Primary_Pump_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	COMMAND_WORD DOUBLE,
	DRIVE_RESET DOUBLE,
	FREQUENCY_SET_POINT DOUBLE,
	INPUT_ENERGY DOUBLE,
	INPUT_POWER DOUBLE,
	OUTPUT_CURRENT DOUBLE,
	OUTPUT_FREQUENCY DOUBLE,
	PUMP_FAIL_STATUS BOOLEAN,
	PUMP_AUTO_MANUAL_STATUS BOOLEAN,
	PUMP_COMMAND DOUBLE,
	PUMP_RUN_STATUS BOOLEAN,
	SET_POINT_MODE DOUBLE,
	SET_POINT_MODE_STATUS BOOLEAN,
	STATUS_ALARM BOOLEAN,
	STATUS_WORD DOUBLE,
	TIME_OUT DOUBLE,
	TORQUE DOUBLE,
	TRIP_CODE DOUBLE,
	VFD_COMMAND_MODE DOUBLE,
	VFD_COMMAND_MODE_STATUS BOOLEAN,
	VFD_LOCAL_REMOTE_STATUS BOOLEAN,
	VFD_RUN_COMMAND DOUBLE,
	VFD_RUN_COMMAND_STATUS BOOLEAN,
	ALARM_CODE BOOLEAN,
	CONSTRAINT CHILLER_PRIMARY_PUMP_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_PRIMARY_PUMP_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_PRIMARY_PUMP_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Chiller_Primary_Pump(ID)
);

-- Create indexes for Chiller_Primary_Pump_Readings table
CREATE INDEX CHILLER_PRIMARY_PUMP_READINGS_PARENT_ID_INDEX on Chiller_Primary_Pump_Readings (PARENT_ID);
CREATE INDEX CHILLER_PRIMARY_PUMP_READINGS_PARENT_ID_TTIME_INDEX ON Chiller_Primary_Pump_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX CHILLER_PRIMARY_PUMP_READINGS_TTIME_INDEX ON Chiller_Primary_Pump_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Chiller_Secondary_Pump (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT CHILLER_SECONDARY_PUMP_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT CHILLER_SECONDARY_PUMP_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_SECONDARY_PUMP_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_SECONDARY_PUMP_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Chiller_Secondary_Pump_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	PUMP_FAIL_STATUS BOOLEAN,
	PUMP_AUTO_MANUAL_STATUS BOOLEAN,
	PUMP_COMMAND DOUBLE,
	PUMP_RUN_STATUS BOOLEAN,
	VFD_COMMAND DOUBLE,
	VFD_FEEDBACK DOUBLE,
	CONSTRAINT CHILLER_SECONDARY_PUMP_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_SECONDARY_PUMP_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_SECONDARY_PUMP_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Chiller_Secondary_Pump(ID)
);

-- Create indexes for Chiller_Secondary_Pump_Readings table
CREATE INDEX CHILLER_SECONDARY_PUMP_READINGS_PARENT_ID_INDEX on Chiller_Secondary_Pump_Readings (PARENT_ID);
CREATE INDEX CHILLER_SECONDARY_PUMP_READINGS_PARENT_ID_TTIME_INDEX ON Chiller_Secondary_Pump_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX CHILLER_SECONDARY_PUMP_READINGS_TTIME_INDEX ON Chiller_Secondary_Pump_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Chiller_Condenser_Pump (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT CHILLER_CONDENSER_PUMP_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT CHILLER_CONDENSER_PUMP_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_CONDENSER_PUMP_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_CONDENSER_PUMP_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Chiller_Condenser_Pump_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	COMMAND_WORD DOUBLE,
	DRIVE_RESET DOUBLE,
	FREQUENCY_SET_POINT DOUBLE,
	INPUT_ENERGY DOUBLE,
	INPUT_POWER DOUBLE,
	OUTPUT_CURRENT DOUBLE,
	OUTPUT_FREQUENCY DOUBLE,
	PUMP_FAIL_STATUS BOOLEAN,
	PUMP_AUTO_MANUAL_STATUS BOOLEAN,
	PUMP_COMMAND DOUBLE,
	PUMP_RUN_STATUS BOOLEAN,
	SET_POINT_MODE DOUBLE,
	SET_POINT_MODE_STATUS BOOLEAN,
	STATUS_ALARM BOOLEAN,
	STATUS_WORD DOUBLE,
	TIME_OUT DOUBLE,
	TORQUE DOUBLE,
	TRIP_CODE DOUBLE,
	VFD_COMMAND_MODE DOUBLE,
	VFD_COMMAND_MODE_STATUS BOOLEAN,
	VFD_LOCAL_REMOTE_STATUS BOOLEAN,
	VFD_RUN_COMMAND DOUBLE,
	VFD_RUN_COMMAND_STATUS BOOLEAN,
	ALARM_CODE BOOLEAN,
	CONSTRAINT CHILLER_CONDENSER_PUMP_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CHILLER_CONDENSER_PUMP_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT CHILLER_CONDENSER_PUMP_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Chiller_Condenser_Pump(ID)
);

-- Create indexes for Chiller_Condenser_Pump_Readings table
CREATE INDEX CHILLER_CONDENSER_PUMP_READINGS_PARENT_ID_INDEX on Chiller_Condenser_Pump_Readings (PARENT_ID);
CREATE INDEX CHILLER_CONDENSER_PUMP_READINGS_PARENT_ID_TTIME_INDEX ON Chiller_Condenser_Pump_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX CHILLER_CONDENSER_PUMP_READINGS_TTIME_INDEX ON Chiller_Condenser_Pump_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS AHU (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT AHU_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT AHU_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT AHU_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT AHU_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS AHU_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	COMMAND_WORD DOUBLE,
	DRIVE_RESET DOUBLE,
	FREQUENCY_SET_POINT DOUBLE,
	INPUT_ENERGY DOUBLE,
	INPUT_POWER DOUBLE,
	OUTPUT_CURRENT DOUBLE,
	OUTPUT_FREQUENCY DOUBLE,
	PUMP_FAIL_STATUS BOOLEAN,
	PUMP_AUTO_MANUAL_STATUS BOOLEAN,
	PUMP_COMMAND DOUBLE,
	PUMP_RUN_STATUS BOOLEAN,
	SET_POINT_MODE DOUBLE,
	SET_POINT_MODE_STATUS BOOLEAN,
	STATUS_ALARM BOOLEAN,
	STATUS_WORD DOUBLE,
	TIME_OUT DOUBLE,
	TORQUE DOUBLE,
	TRIP_CODE DOUBLE,
	VFD_COMMAND_MODE DOUBLE,
	VFD_COMMAND_MODE_STATUS BOOLEAN,
	VFD_LOCAL_REMOTE_STATUS BOOLEAN,
	VFD_RUN_COMMAND DOUBLE,
	VFD_RUN_COMMAND_STATUS BOOLEAN,
	ALARM_CODE BOOLEAN,
	CONSTRAINT AHU_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT AHU_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT AHU_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES AHU(ID)
);
-- Create indexes for AHU_Readings table
CREATE INDEX AHU_READINGS_PARENT_ID_INDEX on AHU_Readings (PARENT_ID);
CREATE INDEX AHU_READINGS_PARENT_ID_TTIME_INDEX ON AHU_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX AHU_READINGS_TTIME_INDEX ON AHU_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Cooling_Tower (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT COOLING_TOWER_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT COOLING_TOWER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT COOLING_TOWER_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT COOLING_TOWER_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Cooling_Tower_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	AUTO_MANUAL_STATUS BOOLEAN,
	COMMAND DOUBLE,
	FAIL_STATUS BOOLEAN,
	INLET_VALVE_COMMAND DOUBLE,
	INLET_VALVE_OPEN_STATUS BOOLEAN,
	OUTLET_TEMPERATURE DOUBLE,
	OUTLET_VALVE_COMMAND DOUBLE,
	OUTLET_VALVE_OPEN_STATUS BOOLEAN,
	RUN_STATUS BOOLEAN,
	VFD_COMMAND_STATUS BOOLEAN,
	VFD_FEEDBACK DOUBLE,
	CONSTRAINT COOLING_TOWER_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT COOLING_TOWER_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT COOLING_TOWER_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Cooling_Tower(ID)
);
-- Create indexes for Cooling_Tower_Readings table
CREATE INDEX COOLING_TOWER_READINGS_PARENT_ID_INDEX on Cooling_Tower_Readings (PARENT_ID);
CREATE INDEX COOLING_TOWER_READINGS_PARENT_ID_TTIME_INDEX ON Cooling_Tower_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX COOLING_TOWER_READINGS_TTIME_INDEX ON Cooling_Tower_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS FCU (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT FCU_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT FCU_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FCU_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT FCU_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS FCU_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	FAN_MODE TINYINT,
	FCU_VALVE BOOLEAN,
	ROOM_TEMPERATURE DOUBLE,
	SET_POINT DOUBLE,
	CONSTRAINT FCU_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FCU_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT FCU_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES FCU(ID)
);
-- Create indexes for FCU_Readings table
CREATE INDEX FCU_READINGS_PARENT_ID_INDEX on FCU_Readings (PARENT_ID);
CREATE INDEX FCU_READINGS_PARENT_ID_TTIME_INDEX ON FCU_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX FCU_READINGS_TTIME_INDEX ON FCU_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Heat_Pump (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT HEAT_PUMP_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT HEAT_PUMP_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT HEAT_PUMP_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT HEAT_PUMP_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Heat_Pump_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	FAN_POWER BIGINT,
	OCCUPANCY_STATUS BOOLEAN,
	DISCHARGE_AIR_TEMPERATURE BIGINT,
	REVERSING_VALVE_COMMAND BOOLEAN,
	ISOLATION_VALVE_COMMAND BOOLEAN,
	COMPRESSOR_POWER BIGINT,
	FAN_COMMAND BOOLEAN,
	SPACE_TEMPERATURE BIGINT,
	LEAVING_WATER_TEMPERATURE BIGINT,
	COMPRESSOR_COMMAND BOOLEAN,
	FAN_STATUS BOOLEAN,
	CONSTRAINT HEAT_PUMP_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT HEAT_PUMP_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT HEAT_PUMP_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Heat_Pump(ID)
);
-- Create indexes for Heat_Pump_Readings table
CREATE INDEX HEAT_PUMP_READINGS_PARENT_ID_INDEX on Heat_Pump_Readings (PARENT_ID);
CREATE INDEX HEAT_PUMP_READINGS_PARENT_ID_TTIME_INDEX ON Heat_Pump_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX HEAT_PUMP_READINGS_TTIME_INDEX ON Heat_Pump_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS Utility_Meters (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ASSET_NUMBER VARCHAR(100),
	PREMISE VARCHAR(100),
	LOCATION VARCHAR(100),
	CONSUMER_NUMBER VARCHAR(100),
	SITE_ID BIGINT NOT NULL,
	CONSTRAINT UTILITY_METERS_FK_ID FOREIGN KEY (ID) REFERENCES Assets(ID) ON DELETE CASCADE,
	CONSTRAINT UTILITY_METERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT UTILITY_METERS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT UTILITY_METERS_FK_SITEID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS Utility_Bill_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	BILL_START_DATE BIGINT,
	BILL_DATE BIGINT,
	BILL_ID VARCHAR(50),
	ENERGY_CONSUMPTION DOUBLE,
	ENERGY_COST DOUBLE,
	WATER_CONSUMPTION DOUBLE,
	WATER_COST DOUBLE,
	CONSTRAINT UTILITY_BILL_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT UTILITY_BILL_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT UTILITY_BILL_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Utility_Meters(ID)
);

-- Create indexes for Utility_Bill_Readings table
CREATE INDEX UTILITY_BILL_READINGS_PARENT_ID_INDEX on Utility_Bill_Readings (PARENT_ID);
CREATE INDEX UTILITY_BILL_READINGS_PARENT_ID_TTIME_INDEX ON Utility_Bill_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX UTILITY_BILL_READINGS_TTIME_INDEX ON Utility_Bill_Readings (ORGID, MODULEID, TTIME);



CREATE TABLE Water_Meter (
  ID BIGINT(20) PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  MODULEID BIGINT(20) NOT NULL,
  SITE_ID BIGINT(20) DEFAULT NULL,
  CONSTRAINT WATER_METER_FK_ID FOREIGN KEY (ID) REFERENCES Assets (ID) ON DELETE CASCADE,
  CONSTRAINT WATER_METER_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules (MODULEID),
  CONSTRAINT WATER_METER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT WATER_METER_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS Water_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	WATER_CONSUMPTION DOUBLE,
	WATER_CONSUMPTION_DELTA DOUBLE,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	DECIMAL_CF6 DOUBLE,
	DECIMAL_CF7 DOUBLE,
	DECIMAL_CF8 DOUBLE,
	DECIMAL_CF9 DOUBLE,
	DECIMAL_CF10 DOUBLE,
	CONSTRAINT WATER_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WATER_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT WATER_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Assets(ID)
);

-- Create indexes for Water_Readings table
CREATE INDEX WATER_READINGS_PARENT_ID_INDEX on Water_Readings (PARENT_ID);
CREATE INDEX WATER_READINGS_PARENT_ID_TTIME_INDEX ON Water_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX WATER_READINGS_TTIME_INDEX ON Water_Readings (ORGID, MODULEID, TTIME);


CREATE TABLE IF NOT EXISTS Asset_Photos (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_ASSET BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	PHOTO_ID BIGINT NOT NULL,
	CONSTRAINT ASSET_PHOTOS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_PHOTOS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ASSET_PHOTOS_FK_PARENT_ASSET FOREIGN KEY (PARENT_ASSET) REFERENCES Assets (ID),
	CONSTRAINT ASSET_PHOTOS_FK_PHOTO_ID FOREIGN KEY (PHOTO_ID) REFERENCES File (FILE_ID)
);

CREATE TABLE IF NOT EXISTS Asset_Attachments (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_ASSET BIGINT NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	FILE_ID BIGINT NOT NULL,
	CONSTRAINT ASSET_ATTACHEMENTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_ATTACHEMENTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ASSET_ATTACHEMENTS_FK_PARENT_ASSET FOREIGN KEY (PARENT_ASSET) REFERENCES Assets (ID),
	CONSTRAINT ASSET_ATTACHEMENTS_FK_FILE_ID FOREIGN KEY (FILE_ID) REFERENCES File (FILE_ID)
);

CREATE TABLE IF NOT EXISTS Asset_Notes (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	MODULEID BIGINT NOT NULL,
	CREATED_BY BIGINT,
	CREATED_TIME BIGINT,
	PARENT_ID BIGINT NOT NULL,
	TITLE VARCHAR(50),
	BODY VARCHAR(1000) NOT NULL,
	CONSTRAINT ASSET_NOTES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ASSET_NOTES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ASSET_NOTES_FK_CREATED_BY_ID FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT ASSET_NOTES_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Assets(ID) ON DELETE CASCADE
);

-- Create Tickets Tables
CREATE TABLE IF NOT EXISTS TicketStatus (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	STATUS VARCHAR(20) NOT NULL,
	STATUS_TYPE TINYINT NOT NULL,
	CONSTRAINT TICKET_STATUS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TICKET_STATUS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKET_STATUS_UNIQUE UNIQUE (ORGID, STATUS)
);

CREATE TABLE IF NOT EXISTS TicketStateFlow (
	ACTIVITY_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ACTIVITY_NAME VARCHAR(20) NOT NULL,
	STATE_ID BIGINT NOT NULL,
	NEXT_STATE_ID BIGINT NOT NULL,
	CONSTRAINT TICKET_STATEFLOW_FK_STATE FOREIGN KEY (STATE_ID) REFERENCES TicketStatus(ID),
	CONSTRAINT TICKET_STATEFLOW_FK_NEXT_STATE FOREIGN KEY (STATE_ID) REFERENCES TicketStatus(ID),
	CONSTRAINT TICKET_STATEFLOW_UNIQUE UNIQUE (STATE_ID, NEXT_STATE_ID)
);


CREATE TABLE IF NOT EXISTS TicketPriority (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PRIORITY VARCHAR(20) NOT NULL,
	SEQUENCE_NUMBER TINYINT NOT NULL,
	CONSTRAINT TICKET_PRIORITY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TICKET_PRIORITY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKET_PRIORITY_UNIQUE UNIQUE (ORGID, PRIORITY)
);

CREATE TABLE IF NOT EXISTS TicketCategory (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50) NOT NULL,
	DESCRIPTION VARCHAR(1000),
	CONSTRAINT TICKET_CATEGORY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKET_CATEGORY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS TicketType (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	NAME VARCHAR(50),
	DESCRIPTION VARCHAR(1000),
	CONSTRAINT TICKET_TYPE_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKET_TYPE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Tickets (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SUBJECT VARCHAR(300),
	DESCRIPTION VARCHAR(1000),
	STATUS_ID BIGINT,
	PRIORITY_ID BIGINT,
	CATEGORY_ID BIGINT,
	TYPE_ID BIGINT,
	SOURCE_TYPE TINYINT NOT NULL,
	CREATED_BY BIGINT NOT NULL,
	ASSIGNMENT_GROUP_ID BIGINT,
	ASSIGNED_TO_ID BIGINT,
	ASSIGNED_BY_ID BIGINT,
	RESOURCE_ID BIGINT,
	DUE_DATE BIGINT,
	SERIAL_NUMBER BIGINT,
	NO_OF_NOTES INT,
	NO_OF_ATTACHMENTS INT,
	NO_OF_TASKS INT,
	NO_OF_CLOSED_TASKS INT,
	SCHEDULED_START BIGINT,
	ESTIMATED_START BIGINT,
	ESTIMATED_END BIGINT,
	ACTUAL_WORK_START BIGINT,
	ACTUAL_WORK_END BIGINT,
	RESUMED_WORK_START BIGINT,
	ACTUAL_WORK_DURATION BIGINT,
	ESTIMATED_WORK_DURATION BIGINT,
	SITE_ID BIGINT,
	CONSTRAINT TICKETS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TICKETS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKETS_FK_STATUS_ID FOREIGN KEY (STATUS_ID) REFERENCES TicketStatus(ID) ON DELETE SET NULL,
	CONSTRAINT TICKETS_FK_PRIORITY_ID FOREIGN KEY (PRIORITY_ID) REFERENCES TicketPriority(ID) ON DELETE SET NULL,
	CONSTRAINT TICKETS_FK_CATEGORY_ID FOREIGN KEY (CATEGORY_ID) REFERENCES TicketCategory(ID) ON DELETE SET NULL,
	CONSTRAINT TICKETS_FK_TYPE_ID FOREIGN KEY (TYPE_ID) REFERENCES TicketType(ID) ON DELETE SET NULL,
	CONSTRAINT TICKETS_FK_ASSIGNMENT_GROUP FOREIGN KEY (ASSIGNMENT_GROUP_ID) REFERENCES `Groups`(GROUPID),
	CONSTRAINT TICKETS_FK_ASSIGNED_TO_ID FOREIGN KEY (ASSIGNED_TO_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT TICKETS_FK_ASSIGNED_BY_ID FOREIGN KEY (ASSIGNED_BY_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT TICKETS_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT TICKETS_FK_CREATED_BY_ID FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT TICKETS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Ticket_Attachments (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_TICKET BIGINT NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	FILE_ID BIGINT NOT NULL,
	ATTACHMENT_TYPE TINYINT,
	CONSTRAINT TICKET_ATTACHEMENTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TICKET_ATTACHEMENTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKET_ATTACHEMENTS_FK_PARENT_TICKET FOREIGN KEY (PARENT_TICKET) REFERENCES Tickets (ID),
	CONSTRAINT TICKET_ATTACHEMENTS_FK_FILE_ID FOREIGN KEY (FILE_ID) REFERENCES File (FILE_ID)
);

CREATE TABLE IF NOT EXISTS Ticket_Notes (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	MODULEID BIGINT NOT NULL,
	CREATED_BY BIGINT,
	CREATED_TIME BIGINT,
	PARENT_ID BIGINT NOT NULL,
	TITLE VARCHAR(50),
	BODY VARCHAR(1000) NOT NULL,
	NOTIFY_REQUESTER BOOLEAN,
	CONSTRAINT TICKET_NOTES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TICKET_NOTES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TICKET_NOTES_FK_CREATED_BY_ID FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT TICKET_NOTES_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Tickets(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS WorkOrderRequests (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	REQUESTER_ID BIGINT,
	STATUS TINYINT,
	URGENCY TINYINT,
	CREATED_TIME BIGINT,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE(9,3),
	DECIMAL_CF2 DOUBLE(9,3),
	DECIMAL_CF3 DOUBLE(9,3),
	DECIMAL_CF4 DOUBLE(9,3),
	DECIMAL_CF5 DOUBLE(9,3),
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	SITE_ID BIGINT,
	CONSTRAINT WORK_ORDER_REQUESTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WORK_ORDER_REQUESTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT WORK_ORDER_REQUESTS_FK_ID FOREIGN KEY (ID) REFERENCES Tickets(ID) ON DELETE CASCADE,
	CONSTRAINT WORK_ORDER_REQUESTS_FK_REQUESTER_ID FOREIGN KEY (REQUESTER_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT WORK_ORDER_REQUESTS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

-- Create table for WorkOrderRequests creation from Email
CREATE TABLE IF NOT EXISTS WorkOrderRequest_EMail (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	S3_MESSAGE_ID VARCHAR(100) NOT NULL,
	TO_ADDR VARCHAR(500) NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	IS_PROCESSED BOOLEAN,
	REQUEST_ID BIGINT,
	CONSTRAINT WORK_ORDER_REQUESTS_EMAIL_FK_REQUEST_ID FOREIGN KEY (REQUEST_ID) REFERENCES WorkOrderRequests(ID) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS Task_Section (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(300) NOT NULL,
	IS_EDITABLE BOOLEAN,
	PARENT_TICKET_ID BIGINT NOT NULL,
	SEQUENCE_NUMBER INT NOT NULL,
	CONSTRAINT TASK_SECTION_FK_PARENT_TICKET_ID FOREIGN KEY (PARENT_TICKET_ID) REFERENCES Tickets(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Tasks (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	SUBJECT VARCHAR(300),
	DESCRIPTION VARCHAR(1000),
	STATUS TINYINT NOT NULL DEFAULT 1,
	RESOURCE_ID BIGINT,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_TICKET_ID BIGINT,
	UNIQUE_ID INT,
	CREATED_TIME BIGINT,
	MODIFIED_TIME BIGINT,
	INPUT_TYPE TINYINT NOT NULL,
	INPUT_TIME BIGINT,
	READING_ID BIGINT,
	READING_DATA_ID BIGINT,
	LAST_READING VARCHAR(500),
	INPUT_VALUE VARCHAR(500),
	SECTION_ID BIGINT,
	SEQUENCE INT,
	ATTACHMENT_REQUIRED BOOLEAN,
	NO_OF_ATTACHMENTS INT,
	REMARKS VARCHAR(1000),
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	SITE_ID BIGINT,
	CREATED_BY BIGINT NOT NULL,
	CONSTRAINT TASKS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TASKS_FK_PARENT_TICKET_ID FOREIGN KEY (PARENT_TICKET_ID) REFERENCES Tickets(ID) ON DELETE CASCADE,
	CONSTRAINT TASKS_FK_READING_ID FOREIGN KEY (READING_ID) REFERENCES Fields(FIELDID),
	CONSTRAINT TASKS_FK_SECTION_ID FOREIGN KEY (SECTION_ID) REFERENCES Task_Section(ID),
	CONSTRAINT TASKS_UNIQUE_ID UNIQUE(PARENT_TICKET_ID, UNIQUE_ID),
	CONSTRAINT TASKS_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(id),
	CONSTRAINT TASKS_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT TASKS_FK_CREATED_BY_ID FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID)
);

CREATE TABLE IF NOT EXISTS Task_Attachments (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	FILE_ID BIGINT NOT NULL,
	ATTACHMENT_TYPE TINYINT,
	CONSTRAINT TASK_ATTACHMENTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TASK_ATTACHMENTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT TASK_ATTACHMENTS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Tasks (ID),
	CONSTRAINT TASK_ATTACHMENTS_FK_FILE_ID FOREIGN KEY (FILE_ID) REFERENCES File (FILE_ID)
);

CREATE TABLE IF NOT EXISTS Task_Input_Options (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	TASK_ID BIGINT,
	OPTION_VALUE VARCHAR(100),
	CONSTRAINT TASK_INPUT_OPTIONS_FK_TASK_ID FOREIGN KEY (TASK_ID) REFERENCES Tasks(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS UserLocationCoverage (
  USER_LOCATION_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORG_USERID BIGINT,
  LOCATION_ID BIGINT,
  CONSTRAINT USERLOCATIONS_USERID_FK FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID) ON DELETE CASCADE,
  CONSTRAINT USERLOCATIONS_LOCATION_FK FOREIGN KEY (LOCATION_ID) REFERENCES Locations (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS GroupLocationCoverage (
  GROUP_LOCATION_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  GROUPID BIGINT,
  LOCATION_ID BIGINT,
  CONSTRAINT GLC_GROUPID_FK FOREIGN KEY (GROUPID) REFERENCES `Groups`(GROUPID) ON DELETE CASCADE,
  CONSTRAINT GLC_LOCATION_FK FOREIGN KEY (LOCATION_ID) REFERENCES Locations (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Skills (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  MODULEID BIGINT NOT NULL,
  NAME VARCHAR(255) NOT NULL,
  ACTIVE BOOLEAN,
  DESCRIPTION VARCHAR(1000),
  CATEGORY_ID BIGINT,
  CONSTRAINT SKILLS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT SKILLS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
  CONSTRAINT SKILLS_FK_CATEGORYID FOREIGN KEY (CATEGORY_ID) REFERENCES TicketCategory(ID)
);

CREATE TABLE IF NOT EXISTS UserSkills (
  USER_SKILL_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORG_USERID BIGINT,
  SKILL_ID BIGINT,
  CONSTRAINT USERSKILLS_USERID_FK FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID) ON DELETE CASCADE,
  CONSTRAINT USERSKILLS_SKILL_FK FOREIGN KEY (SKILL_ID) REFERENCES Skills (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS GroupSkills (
  GROUP_SKILL_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  GROUPID BIGINT,
  SKILL_ID BIGINT,
  CONSTRAINT GROUPSKILLS_GROUPID_FK FOREIGN KEY (GROUPID) REFERENCES `Groups`(GROUPID) ON DELETE CASCADE,
  CONSTRAINT GROUPSKILLS_SKILL_FK FOREIGN KEY (SKILL_ID) REFERENCES Skills (ID) ON DELETE CASCADE
);

-- Device Table

CREATE TABLE IF NOT EXISTS Service (
	SERVICE_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS Alarm_Severity (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	SEVERITY VARCHAR(50) NOT NULL,
	CARDINALITY TINYINT NOT NULL,
	CONSTRAINT ALARM_SEVERITY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ALARM_SEVERITY_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Alarm_Entity (
	ENTITY_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	CONSTRAINT ALARM_ENTITY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Alarms (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	MODULEID BIGINT NOT NULL,
	ENTITY VARCHAR(500),
	SOURCE VARCHAR(100),
	IS_ACKNOWLEDGED BOOLEAN,
	ACKNOWLEDGED_BY BIGINT,
	ACKNOWLEDGED_TIME BIGINT,
	ALARM_TYPE TINYINT,
	CREATED_TIME BIGINT NOT NULL,
	MODIFIED_TIME BIGINT NOT NULL,
	CLEARED_TIME BIGINT,
	CLEARED_BY BIGINT,
	PREVIOUS_SEVERITY BIGINT,
	SEVERITY BIGINT NOT NULL,
	ALARM_PRIORITY VARCHAR(100),
	ALARM_CLASS VARCHAR(100),
	STATE VARCHAR(100),
	ADDITIONAL_INFO VARCHAR(5000),
	NO_OF_EVENTS INT,
	IS_WO_CREATED BOOLEAN,
	ENTITY_ID BIGINT NOT NULL,
	PROBLEM VARCHAR(500),
	POSSIBLE_CAUSES VARCHAR(1000),
	RECOMMENDATION VARCHAR(1000),
	CONTROLLER_ID BIGINT,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE(9,3),
	DECIMAL_CF2 DOUBLE(9,3),
	DECIMAL_CF3 DOUBLE(9,3),
	DECIMAL_CF4 DOUBLE(9,3),
	DECIMAL_CF5 DOUBLE(9,3),
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,	
	CONSTRAINT ALARMS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ALARMS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ALARMS_FK_ID FOREIGN KEY (ID) REFERENCES Tickets(ID) ON DELETE CASCADE,
	CONSTRAINT ALARMS_FK_PREVIOUS_SEVERITY FOREIGN KEY (PREVIOUS_SEVERITY) REFERENCES Alarm_Severity(ID),
	CONSTRAINT ALARMS_FK_SEVERITY FOREIGN KEY (SEVERITY) REFERENCES Alarm_Severity(ID),
	CONSTRAINT ALARMS_FK_ASSIGNED_TO_ID FOREIGN KEY (ACKNOWLEDGED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT ALARMS_FK_CLEARED_BY_ID FOREIGN KEY (CLEARED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT ALARMS_FK_ENTITY_ID FOREIGN KEY (ENTITY_ID) REFERENCES Alarm_Entity(ENTITY_ID),
	CONSTRAINT ALARMS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID),
	CONSTRAINT ALARMS_FK_CONTROLLER_ID FOREIGN KEY (CONTROLLER_ID) REFERENCES Controller (ID)
);

CREATE TABLE IF NOT EXISTS AlarmFollowers (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ALARM_ID BIGINT NOT NULL,
	FOLLOWER_TYPE VARCHAR(50),
	FOLLOWER VARCHAR(255),
	CONSTRAINT ALARM_FOLLOWERS_FK_ALARMID FOREIGN KEY (ALARM_ID) REFERENCES Alarms(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	CONSTRAINT READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);
-- Create indexes for Readings table
CREATE INDEX READINGS_PARENT_ID_INDEX on Readings (PARENT_ID);
CREATE INDEX READINGS_PARENT_ID_TTIME_INDEX ON Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX READINGS_TTIME_INDEX ON Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS CustomModuleData (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	MODULEID BIGINT NOT NULL,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	STRING_CF6 VARCHAR(50),
	STRING_CF7 VARCHAR(50),
	STRING_CF8 VARCHAR(50),
	STRING_CF9 VARCHAR(50),
	STRING_CF10 VARCHAR(50),
	STRING_CF11 VARCHAR(50),
	STRING_CF12 VARCHAR(50),
	STRING_CF13 VARCHAR(50),
	STRING_CF14 VARCHAR(50),
	STRING_CF15 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	NUMBER_CF6 BIGINT,
	NUMBER_CF7 BIGINT,
	NUMBER_CF8 BIGINT,
	NUMBER_CF9 BIGINT,
	NUMBER_CF10 BIGINT,
	NUMBER_CF11 BIGINT,
	NUMBER_CF12 BIGINT,
	NUMBER_CF13 BIGINT,
	NUMBER_CF14 BIGINT,
	NUMBER_CF15 BIGINT,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	DECIMAL_CF6 DOUBLE,
	DECIMAL_CF7 DOUBLE,
	DECIMAL_CF8 DOUBLE,
	DECIMAL_CF9 DOUBLE,
	DECIMAL_CF10 DOUBLE,
	DECIMAL_CF11 DOUBLE,
	DECIMAL_CF12 DOUBLE,
	DECIMAL_CF13 DOUBLE,
	DECIMAL_CF14 DOUBLE,
	DECIMAL_CF15 DOUBLE,
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	BOOLEAN_CF6 BOOLEAN,
	BOOLEAN_CF7 BOOLEAN,
	BOOLEAN_CF8 BOOLEAN,
	BOOLEAN_CF9 BOOLEAN,
	BOOLEAN_CF10 BOOLEAN,
	BOOLEAN_CF11 BOOLEAN,
	BOOLEAN_CF12 BOOLEAN,
	BOOLEAN_CF13 BOOLEAN,
	BOOLEAN_CF14 BOOLEAN,
	BOOLEAN_CF15 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATE_CF6 BIGINT,
	DATE_CF7 BIGINT,
	DATE_CF8 BIGINT,
	DATE_CF9 BIGINT,
	DATE_CF10 BIGINT,
	DATE_CF11 BIGINT,
	DATE_CF12 BIGINT,
	DATE_CF13 BIGINT,
	DATE_CF14 BIGINT,
	DATE_CF15 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	DATETIME_CF6 BIGINT,
	DATETIME_CF7 BIGINT,
	DATETIME_CF8 BIGINT,
	DATETIME_CF9 BIGINT,
	DATETIME_CF10 BIGINT,
	DATETIME_CF11 BIGINT,
	DATETIME_CF12 BIGINT,
	DATETIME_CF13 BIGINT,
	DATETIME_CF14 BIGINT,
	DATETIME_CF15 BIGINT,
	ENUM_CF1 INTEGER,
	ENUM_CF2 INTEGER,
	ENUM_CF3 INTEGER,
	ENUM_CF4 INTEGER,
	ENUM_CF5 INTEGER,
	CONSTRAINT CM_DATA_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT CM_DATA_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Attachments (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	CREATED_TIME BIGINT NOT NULL,
	FILE_ID BIGINT NOT NULL,
	CONSTRAINT ATTACHEMENTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ATTACHEMENTS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ATTACHEMENTS_FK_FILE_ID FOREIGN KEY (FILE_ID) REFERENCES File (FILE_ID)
);

-- Create Notes Table
CREATE TABLE IF NOT EXISTS Notes (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	MODULEID BIGINT NOT NULL,
	CREATED_BY BIGINT,
	CREATED_TIME BIGINT,
	PARENT_ID BIGINT NOT NULL,
	TITLE VARCHAR(50),
	BODY VARCHAR(1000) NOT NULL,
	CONSTRAINT NOTES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT NOTES_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT NOTES_FK_CREATED_BY_ID FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID)
);

CREATE TABLE IF NOT EXISTS Energy_Data (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	CREATED_TIME BIGINT,
	MARKED BOOLEAN,
	PARENT_METER_ID BIGINT NOT NULL,
	TOTAL_ENERGY_CONSUMPTION DOUBLE,
	TOTAL_ENERGY_CONSUMPTION_DELTA DOUBLE DEFAULT 0,
	LINE_VOLTAGE_R DOUBLE,
	LINE_VOLTAGE_Y DOUBLE,
	LINE_VOLTAGE_B DOUBLE,
	PHASE_VOLTAGE_R DOUBLE,
	PHASE_VOLTAGE_Y DOUBLE,
	PHASE_VOLTAGE_B DOUBLE,
	LINE_CURRENT_R DOUBLE,
	LINE_CURRENT_Y DOUBLE,
	LINE_CURRENT_B DOUBLE,
	POWER_FACTOR_R DOUBLE,
	POWER_FACTOR_Y DOUBLE,
	POWER_FACTOR_B DOUBLE,
	FREQUENCY_R DOUBLE,
	FREQUENCY_Y DOUBLE,
	FREQUENCY_B DOUBLE,
	ACTIVE_POWER_R DOUBLE,
	ACTIVE_POWER_Y DOUBLE,
	ACTIVE_POWER_B DOUBLE,
	REACTIVE_POWER_R DOUBLE,
	REACTIVE_POWER_Y DOUBLE,
	REACTIVE_POWER_B DOUBLE,
	APPARENT_POWER_R DOUBLE,
	APPARENT_POWER_Y DOUBLE,
	APPARENT_POWER_B DOUBLE,
	PHASE_ENERGY_R DOUBLE,
	PHASE_ENERGY_R_DELTA DOUBLE,
	PHASE_ENERGY_Y DOUBLE,
	PHASE_ENERGY_Y_DELTA DOUBLE,
	PHASE_ENERGY_B DOUBLE,
	PHASE_ENERGY_B_DELTA DOUBLE,
	TOTAL_DEMAND DOUBLE,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	DECIMAL_CF6 DOUBLE,
	DECIMAL_CF7 DOUBLE,
	DECIMAL_CF8 DOUBLE,
	DECIMAL_CF9 DOUBLE,
	DECIMAL_CF10 DOUBLE,
	CONSTRAINT ENERGY_DATA_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ENERGY_DATA_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT ENERGY_DATA_FK_PARENT_DEVICE_ID FOREIGN KEY (PARENT_METER_ID) REFERENCES Energy_Meter(ID)
);
-- Create indexes for Energy_Data table
CREATE INDEX ENERGY_DATA_PARENT_ID_INDEX on Energy_Data (PARENT_METER_ID);
CREATE INDEX ENERGY_DATA_PARENT_METER_ID_TTIME_INDEX ON Energy_Data (ORGID, MODULEID, PARENT_METER_ID, TTIME);
CREATE INDEX ENERGY_DATA_TTIME_INDEX ON Energy_Data (ORGID, MODULEID, TTIME);

-- Trigger change starts..
-- Create trigger for calculating TOTAL_ENERGY_CONSUMPTION_DELTA in Energy_Data table
-- DELIMITER $$
-- CREATE TRIGGER calculate_delta BEFORE INSERT ON Energy_Data FOR EACH ROW
-- BEGIN
-- DECLARE PREV_ENERGY_CONSUMPTION DOUBLE;
-- SELECT TOTAL_ENERGY_CONSUMPTION INTO PREV_ENERGY_CONSUMPTION FROM Energy_Data WHERE PARENT_METER_ID = NEW.PARENT_METER_ID ORDER BY TTIME DESC LIMIT 1;
-- IF (PREV_ENERGY_CONSUMPTION IS NOT NULL  AND NEW.TOTAL_ENERGY_CONSUMPTION_DELTA IS NULL ) THEN
-- IF( NEW.TOTAL_ENERGY_CONSUMPTION - PREV_ENERGY_CONSUMPTION > -1 ) THEN
-- SET NEW.TOTAL_ENERGY_CONSUMPTION_DELTA = NEW.TOTAL_ENERGY_CONSUMPTION - PREV_ENERGY_CONSUMPTION;
-- ELSE
-- SET NEW.TOTAL_ENERGY_CONSUMPTION_DELTA =0;
-- END IF;
-- END IF;	
-- END; $$
-- DELIMITER ;
-- Trigger change Ends..
CREATE TABLE IF NOT EXISTS Criteria (
	CRITERIAID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	PATTERN VARCHAR(100),
	FORMULA_ID BIGINT DEFAULT NULL,
	CONSTRAINT CRITERIA_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Conditions (
	CONDITIONID BIGINT AUTO_INCREMENT PRIMARY KEY,
	PARENT_CRITERIA_ID BIGINT NOT NULL,
	SEQUENCE TINYINT NOT NULL,
	FIELD_NAME VARCHAR(50) NOT NULL,
	COLUMN_NAME VARCHAR(50) NOT NULL,
	OPERATOR INT NOT NULL,
	VAL VARCHAR(500),
	CRITERIA_VAL_ID  BIGINT,
	IS_EXPRESSION_VALUE BOOLEAN,
	COMPUTED_WHERE_CLAUSE VARCHAR(2000),
	CONSTRAINT CONDITIONS_PARENT_CRITERIA_ID_FK FOREIGN KEY (PARENT_CRITERIA_ID) REFERENCES Criteria(CRITERIAID) ON DELETE CASCADE,
	CONSTRAINT CONDITIONS_CRITERIA_VAL_ID_FK FOREIGN KEY (CRITERIA_VAL_ID) REFERENCES Criteria(CRITERIAID)
);

CREATE TABLE IF NOT EXISTS Views (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(50) NOT NULL,
	DISPLAY_NAME VARCHAR(50),
	VIEW_TYPE TINYINT NOT NULL,
	MODULEID BIGINT,
	MODULENAME varchar(100),
	CRITERIAID BIGINT,
	ISDEFAULT BOOLEAN,
	SEQUENCE_NUMBER INT,
	ISHIDDEN BOOLEAN DEFAULT FALSE,
	CONSTRAINT VIEWS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT VIEWS_MODULEID_FK FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT VIEWS_CRITERIAID_FK FOREIGN KEY (CRITERIAID) REFERENCES Criteria(CRITERIAID),
	CONSTRAINT VIEWS_NAME_UNIQUE UNIQUE(ORGID, MODULEID, NAME)
);

CREATE TABLE IF NOT EXISTS View_Sort_Columns (
	ID BIGINT AUTO_INCREMENT NOT NULL,
	ORGID BIGINT NOT NULL,
	VIEWID BIGINT NOT NULL,
	FIELDID BIGINT NOT NULL,
	IS_ASCENDING BOOLEAN NOT NULL,
	PRIMARY KEY (VIEWID, FIELDID),
	CONSTRAINT VIEW_SORT_COLUMNS_ID_UNIQUE UNIQUE(ID),
	CONSTRAINT VIEW_SORT_COLUMN_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT VIEW_SORT_COLUMN_VIEWID_FK FOREIGN KEY (VIEWID) REFERENCES Views(ID) ON DELETE CASCADE,
	CONSTRAINT VIEW_SORT_COLUMN_FIELDID_FK FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS ImportProcess (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	MODULEID BIGINT,
	STATUS INT,
	COLUMN_HEADING VARCHAR(5000),
	FILE_PATH VARCHAR(100),
	FILEID BIGINT,
	FILE_PATH_FAILED VARCHAR(100),
	FIELD_MAPPING VARCHAR(5000),
	IMPORT_TIME BIGINT,
	IMPORT_TYPE INT,
	IMPORT_JOB_META VARCHAR(5000),
	IMPORT_SETTING INT,
	MAIL_SETTING INT,
	IMPORT_MODE INT,
	TEMPLATE_ID BIGINT DEFAULT NULL,
	CONSTRAINT IMPORT_PROCESS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT IMPORT_PROCESS_MODULEID_FK FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT IMPORT_ORGFILE_FK_ORGID FOREIGN KEY (FILEID) REFERENCES File(FILE_ID)
);


CREATE TABLE IF NOT EXISTS ImportTemplate(
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	TEMPLATE_NAME VARCHAR(1000) DEFAULT NULL,
	MODULE VARCHAR(10000) DEFAULT NULL,
	UNIQUE_MAPPING VARCHAR(3000) DEFAULT NULL,
	FIELD_MAPPING VARCHAR(3000) DEFAULT NULL,
	SYS_SHOW TINYINT DEFAULT NULL,
	CONSTRAINT IMPORT_TEMPLATE_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Expression (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  EXPRESSION_STRING VARCHAR(5000) DEFAULT NULL,
  CONSTRAINT EXPRESSION_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

CREATE TABLE IF NOT EXISTS Formula_Field (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(500),
	FORMULA_FIELD_TYPE TINYINT NOT NULL,
	WORKFLOW_ID BIGINT NOT NULL,
	TRIGGER_TYPE TINYINT NOT NULL,
	FREQUENCY_TYPE TINYINT,
	DATA_INTERVAL INT,
	MODULE_ID BIGINT NOT NULL,
	READING_FIELD_ID BIGINT NOT NULL,
	RESOURCE_TYPE TINYINT NOT NULL,
	RESOURCE_ID BIGINT,
	ASSET_CATEGORY_ID BIGINT,
	SPACE_CATEGORY_ID BIGINT,
	ACTIVE BOOLEAN NOT NULL,
	CONSTRAINT FORMULA_FIELD_FK_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT FORMULA_FIELD_FK_WORKFLOW_ID FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow (ID),
	CONSTRAINT FORMULA_FIELD_FK_MODULE_ID FOREIGN KEY (MODULE_ID) REFERENCES Modules (MODULEID),
	CONSTRAINT FORMULA_FIELD_FK_READING_FIELD_ID FOREIGN KEY (READING_FIELD_ID) REFERENCES Fields (FIELDID),
	CONSTRAINT FORMULA_FIELD_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID),
	CONSTRAINT FORMULA_FIELD_FK_ASSET_CATEGORY_ID FOREIGN KEY (ASSET_CATEGORY_ID) REFERENCES Asset_Categories(ID),
	CONSTRAINT FORMULA_FIELD_FK_SPACE_CATEGORY_ID FOREIGN KEY (SPACE_CATEGORY_ID) REFERENCES Space_Category(ID)
);

CREATE TABLE IF NOT EXISTS Formula_Field_Inclusions (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	FORMULA_FIELD_ID BIGINT NOT NULL,
	RESOURCE_ID BIGINT NOT NULL,
	CONSTRAINT FORMULA_FIELD_INCLUSIONS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FORMULA_FIELD_INCLUSIONS_FK_RULE_ID FOREIGN KEY (FORMULA_FIELD_ID) REFERENCES Formula_Field(ID) ON DELETE CASCADE,
	CONSTRAINT FORMULA_FIELD_INCLUSIONS_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT FORMULA_FIELD_INCLUSIONS_UNIQUE UNIQUE (FORMULA_FIELD_ID, RESOURCE_ID)
);

CREATE TABLE IF NOT EXISTS Formula_Field_Resource_Jobs (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	FORMULA_FIELD_ID BIGINT NOT NULL,
	RESOURCE_ID BIGINT NOT NULL,
	START_TIME BIGINT NOT NULL,
	END_TIME BIGINT NOT NULL,
	IS_SYSTEM BOOLEAN NOT NULL,
	CALCULATE_HISTORICAL_ALARM BOOLEAN,
	CONSTRAINT FORMULA_FIELD_RESOURCE_JOBS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT FORMULA_FIELD_RESOURCE_JOBS_FK_RULE_ID FOREIGN KEY (FORMULA_FIELD_ID) REFERENCES Formula_Field(ID) ON DELETE CASCADE,
	CONSTRAINT FORMULA_FIELD_RESOURCE_JOBS_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT FORMULA_FIELD_RESOURCE_JOBS_UNIQUE UNIQUE (FORMULA_FIELD_ID, RESOURCE_ID, IS_SYSTEM)
);

CREATE TABLE IF NOT EXISTS Workflow_Event (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTIVITY_TYPE INT NOT NULL,
	CONSTRAINT WORKFLOW_EVENT_UNIQUE UNIQUE (MODULEID, ACTIVITY_TYPE),
	CONSTRAINT WORKFLOW_EVENT_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WORKFLOW_EVENT_MODULEID_FK FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);


CREATE TABLE IF NOT EXISTS Templates (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(250) NOT NULL,
	TEMPLATE_TYPE INT,
	PLACEHOLDER VARCHAR(250),
	WORKFLOW_ID BIGINT,
	IS_FTL BOOLEAN,
	CONSTRAINT TEMPLATES_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TEMPLATES_WORKFLOW_ID_FK FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow(ID)
);

CREATE TABLE IF NOT EXISTS EMail_Templates (
	ID BIGINT PRIMARY KEY,
	FROM_ADDR VARCHAR(50) NOT NULL,
	TO_ADDR VARCHAR(100) NOT NULL,
	SUBJECT VARCHAR(100),
	BODY_ID BIGINT NOT NULL,
	CONSTRAINT EMAIL_TEMPLATES_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE,
	CONSTRAINT EMAIL_TEMPLATES_BODY_FK FOREIGN KEY (BODY_ID) REFERENCES File(FILE_ID)
);

CREATE TABLE IF NOT EXISTS SMS_Templates (
	ID BIGINT PRIMARY KEY,
	FROM_NUM VARCHAR(50),
	TO_NUM VARCHAR(100) NOT NULL,
	MSG VARCHAR(500) NOT NULL,
	CONSTRAINT SMS_TEMPLATES_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Assignment_Templates (
	ID BIGINT PRIMARY KEY,
	USERID BIGINT,
	GROUPID BIGINT,
	CONSTRAINT ASSIGNMENT_TEMPLATES_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE,
	CONSTRAINT ASSIGNMENT_TEMPLATES_USER_FK FOREIGN KEY (USERID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT ASSIGNMENT_TEMPLATES_GROUP_FK FOREIGN KEY (GROUPID) REFERENCES `Groups`(GROUPID)
);

CREATE TABLE IF NOT EXISTS SLA_Templates (
	ID BIGINT PRIMARY KEY,
	SLAPOLICYJSON VARCHAR(250),
	CONSTRAINT SLA_TEMPLATES_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Push_Notification_Templates (
	ID BIGINT PRIMARY KEY,
	TO_UID VARCHAR(100) NOT NULL,
	MSG VARCHAR(5000) NOT NULL,
	TITLE VARCHAR(250),
	URL VARCHAR(250),
	CONSTRAINT PUSH_NOTIFICATION_TEMPLATE_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Web_Notification_Templates (
	ID BIGINT PRIMARY KEY,
	TO_UID VARCHAR(100) NOT NULL,
	MSG VARCHAR(250) NOT NULL,
	TITLE VARCHAR(250),
	URL VARCHAR(250),
	CONSTRAINT WEB_NOTIFICATION_TEMPLATE_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS JSON_Template (
  	ID BIGINT PRIMARY KEY,
  	CONTENT_ID BIGINT NOT NULL,
  	CONSTRAINT JSON_TEMPLATE_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Workorder_Template (
	ID BIGINT PRIMARY KEY,
	SUBJECT VARCHAR(300),
	DESCRIPTION VARCHAR(1000),
	STATUS_ID BIGINT,
	PRIORITY_ID BIGINT,
	CATEGORY_ID BIGINT,
	TYPE_ID BIGINT,
	ASSIGNMENT_GROUP_ID BIGINT,
	ASSIGNED_TO_ID BIGINT,
	RESOURCE_ID BIGINT,
	DURATION BIGINT, 
	REQUESTER_ID BIGINT,
	ADDITIONAL_INFO VARCHAR(5000),
	SITE_ID BIGINT,
	CONSTRAINT WORKORDER_TEMPLATE_FK_STATUS_ID FOREIGN KEY (STATUS_ID) REFERENCES TicketStatus(ID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_PRIORITY_ID FOREIGN KEY (PRIORITY_ID) REFERENCES TicketPriority(ID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_CATEGORY_ID FOREIGN KEY (CATEGORY_ID) REFERENCES TicketCategory(ID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_TYPE_ID FOREIGN KEY (TYPE_ID) REFERENCES TicketType(ID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_ASSIGNMENT_GROUP FOREIGN KEY (ASSIGNMENT_GROUP_ID) REFERENCES `Groups`(GROUPID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_ASSIGNED_TO_ID FOREIGN KEY (ASSIGNED_TO_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_REQUESTER_ID FOREIGN KEY (REQUESTER_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT WORKORDER_TEMPLATE_FK_ID FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE,
	CONSTRAINT WORKOREDER_TEMPLATE_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Task_Section_Template (
	ID BIGINT PRIMARY KEY,
	IS_EDITABLE BOOLEAN,
	PARENT_WO_TEMPLATE_ID BIGINT,
	SEQUENCE_NUMBER INT,
	ASSIGNMENT_TYPE INT DEFAULT NULL,
  	ASSET_CATEGORY_ID BIGINT DEFAULT NULL,
  	SPACE_CATEGORY_ID BIGINT DEFAULT NULL,
  	RESOURCE_ID BIGINT DEFAULT NULL,
	CONSTRAINT TASK_SECTION_TEMPLATE_FK_ID FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE,
	CONSTRAINT Task_Section_Template_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID),
  	CONSTRAINT Task_Section_Template_ASSET_CATEGORY_ID FOREIGN KEY (ASSET_CATEGORY_ID) REFERENCES Asset_Categories (ID),
  	CONSTRAINT Task_Section_Template_SPACE_CATEGORY_ID FOREIGN KEY (SPACE_CATEGORY_ID) REFERENCES Space_Category (ID),
	CONSTRAINT TASK_SECTION_TEMPLATE_FK_PARENT_WO_TEMPLATE_ID FOREIGN KEY (PARENT_WO_TEMPLATE_ID) REFERENCES Workorder_Template (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Task_Template (
	ID BIGINT PRIMARY KEY,
	DESCRIPTION VARCHAR(1000),
	STATUS TINYINT DEFAULT 1,
	PRIORITY_ID BIGINT,
	CATEGORY_ID BIGINT,
	TYPE_ID BIGINT,
	ASSIGNMENT_GROUP_ID BIGINT,
	ASSIGNED_TO_ID BIGINT,
	RESOURCE_ID BIGINT,
	DURATION BIGINT, 
	PARENT_WO_TEMPLATE_ID BIGINT,
	INPUT_TYPE TINYINT,
	READING_ID BIGINT,
	SECTION_ID BIGINT,
	SEQUENCE INT,
	ATTACHMENT_REQUIRED BOOLEAN,
	ADDITIONAL_INFO VARCHAR(5000),
	SITE_ID BIGINT,
	ASSIGNMENT_TYPE INT DEFAULT NULL,
  	ASSET_CATEGORY_ID BIGINT DEFAULT NULL,
  	SPACE_CATEGORY_ID BIGINT DEFAULT NULL,
	CONSTRAINT TASK_TEMPLATE_FK_ID FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE,
	CONSTRAINT TASK_TEMPLATE_FK_PRIORITY_ID FOREIGN KEY (PRIORITY_ID) REFERENCES TicketPriority(ID),
	CONSTRAINT TASK_TEMPLATE_FK_CATEGORY_ID FOREIGN KEY (CATEGORY_ID) REFERENCES TicketCategory(ID),
	CONSTRAINT TASK_TEMPLATE_FK_TYPE_ID FOREIGN KEY (TYPE_ID) REFERENCES TicketType(ID),
	CONSTRAINT TASK_TEMPLATE_FK_ASSIGNMENT_GROUP FOREIGN KEY (ASSIGNMENT_GROUP_ID) REFERENCES `Groups`(GROUPID),
	CONSTRAINT TASK_TEMPLATE_FK_ASSIGNED_TO_ID FOREIGN KEY (ASSIGNED_TO_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT TASK_TEMPLATE_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT TASK_TEMPLATE_FK_PARENT_WO_TEMPLATE_ID FOREIGN KEY (PARENT_WO_TEMPLATE_ID) REFERENCES Workorder_Template (ID) ON DELETE CASCADE,
	CONSTRAINT TASK_TEMPLATE_FK_READING_ID FOREIGN KEY (READING_ID) REFERENCES Fields(FIELDID),
	CONSTRAINT TASK_TEMPLATE_FK_SECTION_ID FOREIGN KEY (SECTION_ID) REFERENCES Task_Section_Template(ID) ON DELETE CASCADE,
	CONSTRAINT Task_Template_ASSET_CATEGORY_ID FOREIGN KEY (ASSET_CATEGORY_ID) REFERENCES Asset_Categories (ID),
  	CONSTRAINT Task_Template_SPACE_CATEGORY_ID FOREIGN KEY (SPACE_CATEGORY_ID) REFERENCES Space_Category (ID),
	CONSTRAINT TASK_TEMPLATE_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);

CREATE TABLE IF NOT EXISTS Action (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	ACTION_TYPE INT NOT NULL,
	DEFAULT_TEMPLATE_ID INT,
	TEMPLATE_ID BIGINT,
	STATUS BOOLEAN,
	CONSTRAINT ACTION_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT ACTION_TEMPLATE_FK FOREIGN KEY (TEMPLATE_ID) REFERENCES Templates(ID)
);

CREATE TABLE IF NOT EXISTS Workflow_Rule (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(1000),
	EVENT_ID BIGINT,
	CRITERIAID BIGINT,
	WORKFLOW_ID BIGINT,
	EXECUTION_ORDER INT,
	STATUS BOOLEAN,
	RULE_TYPE INT NOT NULL,
	PARENT_RULE_ID BIGINT,
	ON_SUCCESS BOOLEAN,
	CONSTRAINT WORKFLOW_RULE_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WORKFLOW_RULE_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT WORKFLOW_RULE_EVENT_ID_FK FOREIGN KEY (EVENT_ID) REFERENCES Workflow_Event(ID) ON DELETE CASCADE,
	CONSTRAINT WORKFLOW_RULE_CRITERIAID_FK FOREIGN KEY (CRITERIAID) REFERENCES Criteria(CRITERIAID),
	CONSTRAINT WORKFLOW_RULE_WORKFLOW_ID_FK FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow(ID),
	CONSTRAINT WORKFLOW_RULE_PARENT_RULE_ID_FK FOREIGN KEY (PARENT_RULE_ID) REFERENCES Workflow_Rule(ID)
);

CREATE TABLE IF NOT EXISTS Workflow_Field_Change_Fields (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	RULE_ID BIGINT NOT NULL,
	FIELD_ID BIGINT NOT NULL,
	OLD_VALUE VARCHAR(500),
	NEW_VALUE VARCHAR(500),
	CONSTRAINT WORKFLOW_FIELD_CHANGE_FIELDS_UNIQUE UNIQUE (ORGID, RULE_ID, FIELD_ID),
	CONSTRAINT WORKFLOW_FIELD_CHANGE_FIELDS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WORKFLOW_FIELD_CHANGE_FIELDS_RULE_ID_FK FOREIGN KEY (RULE_ID) REFERENCES Workflow_Rule (ID) ON DELETE CASCADE,
	CONSTRAINT WORKFLOW_FIELD_CHANGE_FIELDS_FIELD_ID_FK FOREIGN KEY (FIELD_ID) REFERENCES Fields (FIELDID)
);

CREATE TABLE IF NOT EXISTS Workflow_Rule_Action (
	WORKFLOW_RULE_ACTION_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	WORKFLOW_RULE_ID BIGINT NOT NULL,
	ACTION_ID BIGINT NOT NULL,
	CONSTRAINT WORKFLOW_ACTION_RULE_WORKFLOW_ID_FK FOREIGN KEY (WORKFLOW_RULE_ID) REFERENCES Workflow_Rule(ID) ON DELETE CASCADE,
	CONSTRAINT WORKFLOW_ACTION_RULE_ACTION_ID_FK FOREIGN KEY (ACTION_ID) REFERENCES Action(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Excel_Templates (
	ID BIGINT PRIMARY KEY,
	EXCEL_FILE_ID BIGINT,
	CONSTRAINT EXCEL_TEMPLATES_ID_FK FOREIGN KEY (ID) REFERENCES Templates(ID) ON DELETE CASCADE,
	CONSTRAINT EXCEL_FILE_ID_FK FOREIGN KEY (EXCEL_FILE_ID) REFERENCES File(FILE_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Excel_PlaceHolders (
	TEMPLATEID BIGINT,
	PLACEHOLDERNAME VARCHAR(50),
	CELLDATA VARCHAR(50),
	CONSTRAINT TEMPLATE_EXCELPLACEHOLDER_ID_FK FOREIGN KEY (TEMPLATEID) REFERENCES Excel_Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Tenant (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(50),
	ADDRESS VARCHAR(100),
	CONTACTEMAIL VARCHAR(50),
	CONTACTNUMBER VARCHAR(50),
	TEMPLATEID BIGINT,
	CONSTRAINT TENANT_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT BILL_TENANTS_ID_FK FOREIGN KEY (TEMPLATEID) REFERENCES Excel_Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS TenantZones (
	TENANT_ID BIGINT,	
  	ZONE_ID BIGINT,
	PRIMARY KEY(TENANT_ID,ZONE_ID),
  	CONSTRAINT TENANT_TENANTZONE_ID_FK FOREIGN KEY (TENANT_ID) REFERENCES Tenant(ID) ON DELETE CASCADE,
  	CONSTRAINT ZONE_TENANTZONE_ID_FK FOREIGN KEY (ZONE_ID) REFERENCES Zone(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS TenantMeters (
	TENANT_ID BIGINT,	
  	METER_ID BIGINT,
	PRIMARY KEY(TENANT_ID,METER_ID),
  	CONSTRAINT TENANT_TENANTMETER_ID_FK FOREIGN KEY (TENANT_ID) REFERENCES Tenant(ID) ON DELETE CASCADE,
  	CONSTRAINT METER_TENANTMETER_ID_FK FOREIGN KEY (METER_ID) REFERENCES Energy_Meter(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Preventive_Maintenance (
  	ID BIGINT PRIMARY KEY,
  	ORGID BIGINT NOT NULL,
  	TITLE VARCHAR(250) NOT NULL,
  	STATUS BOOLEAN,
	CREATED_BY BIGINT NOT NULL,
	MODIFIED_BY BIGINT,
	CREATION_TIME BIGINT NOT NULL,
	LAST_MODIFIED_TIME BIGINT,
	TEMPLATE_ID BIGINT,
	TRIGGER_TYPE TINYINT NOT NULL,
	END_TIME BIGINT,
	CURRENT_EXECUTION_COUNT INT,
	MAX_COUNT INT,
	WAIT_FOR_ALL_TRIGGERS BOOLEAN,
	FREQUENCY_TYPE TINYINT,
	IS_CUSTOM BOOLEAN,
	SITE_ID BIGINT,
	ASSIGNMENT_TYPE TINYINT DEFAULT NULL,
  	BASE_SPACE_ID BIGINT DEFAULT NULL,
  	PM_CREARTION_TYPE TINYINT DEFAULT NULL,
  	ASSET_CATEGORY_ID BIGINT DEFAULT NULL,
  	SPACE_CATEGORY_ID BIGINT DEFAULT NULL,
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_ID FOREIGN KEY (ID) REFERENCES Resources(ID) ON DELETE CASCADE,
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_CREATED_BY FOREIGN KEY (CREATED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_MODIFIED_BY FOREIGN KEY (MODIFIED_BY) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_TEMPLATE_ID FOREIGN KEY (TEMPLATE_ID) REFERENCES Templates(ID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_BASESPACE_ID FOREIGN KEY (BASE_SPACE_ID) REFERENCES BaseSpace (ID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_ASSET_CATEGORY_ID FOREIGN KEY (ASSET_CATEGORY_ID) REFERENCES Asset_Categories (ID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_SPACE_CATEGORY_ID FOREIGN KEY (SPACE_CATEGORY_ID) REFERENCES Space_Category (ID),
	CONSTRAINT PREVENTIVE_MAINTENANCE_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);


CREATE TABLE IF NOT EXISTS PM_Include_Exclude_Resource (
  ID BIGINT PRIMARY KEY AUTO_INCREMENT,
  PARENT_TYPE INT DEFAULT NULL,
  PM_ID BIGINT DEFAULT NULL,
  TASK_SECTION_TEMPLATE_ID BIGINT DEFAULT NULL,
  TASK_TEMPLATE_ID BIGINT DEFAULT NULL,
  RESOURCE_ID BIGINT DEFAULT NULL,
  IS_INCLUDE TINYINT DEFAULT NULL,
  CONSTRAINT PM_INCLUDE_EXCLUDE_RESOURCE_PM_ID FOREIGN KEY (PM_ID) REFERENCES Preventive_Maintenance (ID),
  CONSTRAINT PM_INCLUDE_EXCLUDE_RESOURCE_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID),
  CONSTRAINT PM_INCLUDE_EXCLUDE_RESOURCE_TASK_SECTION_ID FOREIGN KEY (TASK_SECTION_TEMPLATE_ID) REFERENCES Task_Section_Template (ID),
  CONSTRAINT PM_INCLUDE_EXCLUDE_RESOURCE_TASK_TEMPLATE_ID FOREIGN KEY (TASK_TEMPLATE_ID) REFERENCES Task_Template (ID)
);

CREATE TABLE IF NOT EXISTS Approval_Rules (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	APPROVAL_RULE_ID BIGINT NOT NULL,
	REJECTION_RULE_ID BIGINT NOT NULL,
	APPROVAL_FORM_ID BIGINT,
	REJECTION_FORM_ID BIGINT,
	APPROVAL_BUTTON VARCHAR(50),
	REJECTION_BUTTON VARCHAR(50),
	ALL_APPROVAL_REQUIRED BOOLEAN,
	CONSTRAINT APPROVAL_RULES_FK_ID FOREIGN KEY (ID) REFERENCES Workflow_Rule(ID) ON DELETE CASCADE,
	CONSTRAINT APPROVAL_RULES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT APPROVAL_RULES_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT APPROVAL_RULES_FK_APPROVAL_RULE_ID FOREIGN KEY (APPROVAL_RULE_ID) REFERENCES Workflow_Rule(ID),
	CONSTRAINT APPROVAL_RULES_FK_REJECTION_RULE_ID FOREIGN KEY (REJECTION_RULE_ID) REFERENCES Workflow_Rule(ID),
	CONSTRAINT APPROVAL_RULES_FK_APPROVAL_FORM_ID FOREIGN KEY (APPROVAL_FORM_ID) REFERENCES Forms(ID),
	CONSTRAINT APPROVAL_RULES_FK_REJECTION_FORM_ID FOREIGN KEY (REJECTION_FORM_ID) REFERENCES Forms(ID)
);

CREATE TABLE IF NOT EXISTS Approvers (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	ORG_USERID BIGINT, 
	ROLE_ID BIGINT,
	GROUP_ID BIGINT,
	SHARING_TYPE TINYINT NOT NULL,
	CONSTRAINT APPROVERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT APPROVERS_FK_ID FOREIGN KEY (PARENT_ID) REFERENCES Approval_Rules(ID) ON DELETE CASCADE,
	CONSTRAINT APPROVERS_FK_ORG_USERID FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT APPROVERS_FK_ROLE_ID FOREIGN KEY (ROLE_ID) REFERENCES Role(ROLE_ID),
	CONSTRAINT APPROVERS_FK_GROUP_ID FOREIGN KEY (GROUP_ID) REFERENCES `Groups`(GROUPID)
);

CREATE TABLE IF NOT EXISTS Approval_Steps (
	ID BIGINT PRIMARY KEY AUTO_INCREMENT,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	RULE_ID BIGINT NOT NULL,
	RECORD_ID BIGINT NOT NULL,
	ACTION_BY BIGINT NOT NULL,
	APPROVER_GROUP BIGINT NOT NULL,
	ACTION TINYINT NOT NULL,
	CONSTRAINT APPROVAL_STEPS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT APPROVAL_STEPS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT APPROVAL_STEPS_FK_RULE_ID FOREIGN KEY (RULE_ID) REFERENCES Approval_Rules(ID) ON DELETE CASCADE,
	CONSTRAINT APPROVAL_STEPS_FK_ACTION_BY FOREIGN KEY (ACTION_BY) REFERENCES ORG_Users(ORG_USERID) ON DELETE SET NULL,
	CONSTRAINT APPROVAL_STEPS_FK_APPROVER_GROUP FOREIGN KEY (APPROVER_GROUP) REFERENCES Approvers(ID) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS WorkOrders (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	REQUESTER_ID BIGINT,
	CREATED_TIME BIGINT,
	MODIFIED_TIME BIGINT,
	PM_ID BIGINT,
	IS_WORKDURATION_CHANGE_ALLOWED BOOLEAN,
	APPROVAL_STATE TINYINT NOT NULL,
	APPROVAL_RULE_ID BIGINT,
	SEND_FOR_APPROVAL BOOLEAN,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE(9,3),
	DECIMAL_CF2 DOUBLE(9,3),
	DECIMAL_CF3 DOUBLE(9,3),
	DECIMAL_CF4 DOUBLE(9,3),
	DECIMAL_CF5 DOUBLE(9,3),
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	DATE_CF1 BIGINT,
	DATE_CF2 BIGINT,
	DATE_CF3 BIGINT,
	DATE_CF4 BIGINT,
	DATE_CF5 BIGINT,
	DATETIME_CF1 BIGINT,
	DATETIME_CF2 BIGINT,
	DATETIME_CF3 BIGINT,
	DATETIME_CF4 BIGINT,
	DATETIME_CF5 BIGINT,
	SITE_ID BIGINT,
	CONSTRAINT WORK_ORDERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT WORK_ORDERS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT WORK_ORDERS_FK_ID FOREIGN KEY (ID) REFERENCES Tickets(ID) ON DELETE CASCADE,
	CONSTRAINT WORK_ORDERS_FK_REQUESTER_ID FOREIGN KEY (REQUESTER_ID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT WORK_ORDERS_FK_PM_ID FOREIGN KEY (PM_ID) REFERENCES Preventive_Maintenance(ID) ON DELETE SET NULL,
	CONSTRAINT WORK_ORDERS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID),
	CONSTRAINT WORK_ORDERS_FK_APPROVAL_RULE_ID FOREIGN KEY (APPROVAL_RULE_ID) REFERENCES Approval_Rules(ID)
);

CREATE TABLE IF NOT EXISTS User_Workhour_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	WORK_HOUR_ENTRY TINYINT NOT NULL,
	WO_ID BIGINT NOT NULL,
	SOURCE_ACTIVITY BIGINT NOT NULL,
	HAS_MANUAL_ENTRY BOOLEAN,
	CONSTRAINT USER_WORKHOUR_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT USER_WORKHOUR_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT USER_WORKHOUR_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES ORG_Users(ORG_USERID)
);

-- Create indexes for User_Workhour_Readings table
CREATE INDEX USER_WORKHOUR_READINGS_PARENT_ID_INDEX on User_Workhour_Readings (PARENT_ID);
CREATE INDEX USER_WORKHOUR_READINGS_PARENT_ID_TTIME_INDEX ON User_Workhour_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX USER_WORKHOUR_READINGS_TTIME_INDEX ON User_Workhour_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS  PM_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	WO_ID BIGINT NOT NULL,
	TASK_ID BIGINT NOT NULL,
	TASK_UNIQUE_ID BIGINT NOT NULL,
	STRING_CF1 VARCHAR(50),
	STRING_CF2 VARCHAR(50),
	STRING_CF3 VARCHAR(50),
	STRING_CF4 VARCHAR(50),
	STRING_CF5 VARCHAR(50),
	NUMBER_CF1 BIGINT,
	NUMBER_CF2 BIGINT,
	NUMBER_CF3 BIGINT,
	NUMBER_CF4 BIGINT,
	NUMBER_CF5 BIGINT,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	BOOLEAN_CF1 BOOLEAN,
	BOOLEAN_CF2 BOOLEAN,
	BOOLEAN_CF3 BOOLEAN,
	BOOLEAN_CF4 BOOLEAN,
	BOOLEAN_CF5 BOOLEAN,
	ENUM_CF1 INTEGER,
	ENUM_CF2 INTEGER,
	ENUM_CF3 INTEGER,
	ENUM_CF4 INTEGER,
	ENUM_CF5 INTEGER,
	CONSTRAINT PM_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT PM_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT PM_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Preventive_Maintenance(ID) ON DELETE CASCADE
);

-- Create indexes for PM_Readings table
CREATE INDEX PM_READINGS_PARENT_ID_INDEX on PM_Readings (PARENT_ID);
CREATE INDEX PM_READINGS_PARENT_ID_TTIME_INDEX ON PM_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX PM_READINGS_TTIME_INDEX ON PM_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS SupportEmails (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	REPLY_NAME VARCHAR(50),
	ACTUAL_EMAIL VARCHAR(50) UNIQUE NOT NULL,
	FWD_EMAIL VARCHAR(50) UNIQUE NOT NULL,
	AUTO_ASSIGN_GROUP_ID BIGINT,
	VERIFIED BOOLEAN,
	PRIMARY_SUPPORT_EMAIL BOOLEAN,
	CONSTRAINT SUPPORT_EMAILS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SUPPORT_EMAILS_FK_AUTO_ASSIGN_GROUP FOREIGN KEY (AUTO_ASSIGN_GROUP_ID) REFERENCES `Groups`(GROUPID),
	CONSTRAINT SUPPORT_EMAILS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID)
);

CREATE TABLE IF NOT EXISTS EmailSettings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT UNIQUE NOT NULL,
	BCC_EMAIL VARCHAR(50),
	FLAGS TINYINT,
	CONSTRAINT EMAIL_SETTINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

-- service portal --
CREATE TABLE IF NOT EXISTS PortalInfo (
	PORTALID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	PORTALTYPE INT DEFAULT 0,
	SIGNUP_ALLOWED BOOLEAN,
	GMAILLOGIN_ALLOWED BOOLEAN,
	IS_PUBLIC_CREATE_ALLOWED BOOLEAN,
	IS_ANYDOMAIN_ALLOWED BOOLEAN,
	WHITELISTED_DOMAINS VARCHAR(255),
	SAML_ENABLED BOOLEAN,
	CAPTCHA_ENABLED BOOLEAN,
	CUSTOM_DOMAIN VARCHAR(100),
	ALGORITHM VARCHAR(50),
	PUBLICKEY BIGINT,
	LOGIN_URL VARCHAR(50),
	LOGOUT_URL VARCHAR(50),
	PASSWORD_URL VARCHAR(50),
	UNIQUE KEY PortalInfo_type (ORGID,PORTALTYPE),
	CONSTRAINT `PORTALINFO_PUBLICKEY_FILEID` FOREIGN KEY (`PUBLICKEY`) REFERENCES `File` (`FILE_ID`),
	CONSTRAINT PortalInfo_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS `faciliorequestors` (
`id` int( 11 ) NOT NULL AUTO_INCREMENT ,
`PORTALID` BIGINT NOT NULL  ,
`username` varchar( 200 ) NOT NULL ,
`email` varchar( 200 ) NOT NULL ,
USERID BIGINT NOT NULL,
PRIMARY KEY ( `id` ) ,
CONSTRAINT UNIQUE_FACILIOREQUESTORS_ID UNIQUE(PORTALID, email),
CONSTRAINT FACILIOREQUESTORS_FK_PORTALID FOREIGN KEY (PORTALID) REFERENCES PortalInfo(PORTALID),
CONSTRAINT FACILIOREQUESTORS_FK_USERID FOREIGN KEY (USERID) REFERENCES Users(USERID) ON UPDATE CASCADE
)  DEFAULT CHARSET = utf8;

CREATE TABLE IF NOT EXISTS Ticket_Activity (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	TICKET_ID BIGINT NOT NULL,
	MODIFIED_TIME BIGINT NOT NULL,
	MODIFIED_BY BIGINT NOT NULL,
	ACTIVITY_TYPE INT NOT NULL,
	INFO VARCHAR(5000),
	CONSTRAINT Ticket_Activity_FK_TICKET_ID FOREIGN KEY (TICKET_ID) REFERENCES Tickets(ID) ON DELETE CASCADE,
	CONSTRAINT Ticket_Activity_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT Ticket_Activity_FK_MODIFIED_BY FOREIGN KEY (MODIFIED_BY) REFERENCES ORG_Users(ORG_USERID)
);

CREATE TABLE IF NOT EXISTS Connected_App (
	CONNECTED_APP_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	NAME VARCHAR(100),
	LINK_NAME VARCHAR(100),
	DESCRIPTION VARCHAR(500),
	BASEURL VARCHAR(500),
	CONSTRAINT CONNECTED_APP_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Tab_Widget (
	TAB_WIDGET_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULE_LINK_NAME VARCHAR(100),
	TAB_NAME VARCHAR(100),
	TAB_LINK_NAME VARCHAR(100),
	WIDGET_NAME VARCHAR(100),
	CONNECTED_APP_ID BIGINT,
	RESOURCE_PATH VARCHAR(500),
	CONSTRAINT TAB_WIDGET_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT TAB_WIDGET_FK_CONNECTED_APP_ID FOREIGN KEY (CONNECTED_APP_ID) REFERENCES Connected_App(CONNECTED_APP_ID)
);

CREATE TABLE IF NOT EXISTS Notification (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	USERID BIGINT NOT NULL,
	NOTIFICATION_TYPE INT NOT NULL,
	ACTOR_ID BIGINT,
	INFO VARCHAR(5000),
	IS_READ BOOLEAN DEFAULT FALSE,
	READ_AT BIGINT,
	IS_SEEN BOOLEAN DEFAULT FALSE,
	SEEN_AT BIGINT,
	CREATED_TIME BIGINT,
	CONSTRAINT NOTIFICATION_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT NOTIFICATION_FK_USERID FOREIGN KEY (USERID) REFERENCES ORG_Users(ORG_USERID),
	CONSTRAINT NOTIFICATION_FK_ACTORID FOREIGN KEY (ACTOR_ID) REFERENCES ORG_Users(ORG_USERID)
);

CREATE TABLE IF NOT EXISTS Report_Folder (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  PARENT_FOLDER_ID BIGINT DEFAULT NULL,
  NAME VARCHAR(500) DEFAULT NULL,
  BUILDING_ID BIGINT DEFAULT NULL,
  CONSTRAINT REPORT_FOLDER_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
  CONSTRAINT REPORT_FOLDER_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT REPORT_FOLDER_PARENT_ID FOREIGN KEY (PARENT_FOLDER_ID) REFERENCES Report_Folder (ID)
);

CREATE TABLE IF NOT EXISTS Report_Formula_Field (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  NAME VARCHAR(500) DEFAULT NULL,
  DATA_TYPE INT DEFAULT NULL,
  FORMULA VARCHAR(500) DEFAULT NULL,
  CONSTRAINT REPORT_FORMULA_FIELDS_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT REPORT_FORMULA_FIELDS_MODULE_ID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID)
);

CREATE TABLE IF NOT EXISTS Report_Field (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  FIELD_LABEL VARCHAR(500) DEFAULT NULL,
  MODULE_FIELD_ID BIGINT DEFAULT NULL,
  FORMULA_FIELD_ID BIGINT DEFAULT NULL,
  UNIT VARCHAR(50) DEFAULT NULL,
  CONSTRAINT REPORT_FIELD_FORMULA_FIELD_ID FOREIGN KEY (FORMULA_FIELD_ID) REFERENCES Report_Formula_Field (ID),
  CONSTRAINT REPORT_FIELD_MODULE_FIELD_ID FOREIGN KEY (MODULE_FIELD_ID) REFERENCES Fields (FIELDID) 
);

CREATE TABLE IF NOT EXISTS Report_Entity ( 
	ID BIGINT AUTO_INCREMENT PRIMARY KEY, 
	ORGID BIGINT NOT NULL, 
	CONSTRAINT REPORT_ENTITY_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID) 
);

CREATE TABLE IF NOT EXISTS Report (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  REPORT_FOLDER_ID BIGINT DEFAULT NULL,
  REPORT_ENTITY_ID BIGINT DEFAULT NULL,
  NAME VARCHAR(250) DEFAULT NULL,
  DESCRIPTION VARCHAR(1000),
  CHART_TYPE INT DEFAULT NULL,
  SEC_CHART_TYPE INT DEFAULT NULL,
  X_AXIS BIGINT NOT NULL,
  X_AGGREGATE_FUNCTION INT DEFAULT NULL,
  X_AXIS_LABEL VARCHAR(255) DEFAULT NULL,
  X_AXIS_UNIT VARCHAR(50) DEFAULT NULL,
  Y1_AXIS BIGINT DEFAULT NULL,
  Y1_AGGREGATE_FUNCTION INT DEFAULT NULL,
  Y1_AXIS_LABEL VARCHAR(255) DEFAULT NULL,
  Y1_AXIS_UNIT VARCHAR(50) DEFAULT NULL,
  Y2_AXIS BIGINT DEFAULT NULL,
  Y2_AGGREGATE_FUNCTION INT DEFAULT NULL,
  Y3_AXIS BIGINT DEFAULT NULL,
  Y3_AGGREGATE_FUNCTION INT DEFAULT NULL,
  IS_COMPARISION_REPORT TINYINT DEFAULT NULL,
  IS_HIGHRESOLUTION_REPORT TINYINT DEFAULT NULL,
  IS_COMBINATION_REPORT TINYINT DEFAULT NULL,
  EXCLUDE_BASELINE TINYINT DEFAULT NULL,
  REPORT_ORDER INT DEFAULT NULL,
  X_AXIS_LEGEND VARCHAR(45) DEFAULT NULL,
  GROUP_BY BIGINT DEFAULT NULL,
  GROUP_BY_AGGREGATE_FUNCTION INT DEFAULT NULL,
  GROUP_BY_LABEL VARCHAR(255) DEFAULT NULL,
  GROUP_BY_UNIT VARCHAR(50) DEFAULT NULL,
  LLIMIT INT DEFAULT NULL,
  ORDER_BY VARCHAR(45) DEFAULT NULL,
  ORDER_BY_FUNCTION INT DEFAULT NULL,
  REPORT_COLOR VARCHAR(30) DEFAULT NULL,
  CUSTOM_REPORT_CLASS VARCHAR(200) DEFAULT NULL,
  CONSTRAINT REPORT_PARENT_FOLDER_ID FOREIGN KEY (REPORT_FOLDER_ID) REFERENCES Report_Folder (ID),
  CONSTRAINT REPORT_MODULE_ID_FK FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
  CONSTRAINT REPORT_ORG_ID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT REPORT_ENTITY_FK_ID FOREIGN KEY (REPORT_ENTITY_ID) REFERENCES Report_Entity (ID),
  CONSTRAINT REPORT_X_AXIS FOREIGN KEY (X_AXIS) REFERENCES Report_Field (ID),
  CONSTRAINT REPORT_Y1_AXIS FOREIGN KEY (Y1_AXIS) REFERENCES Report_Field (ID),
  CONSTRAINT REPORT_Y2_AXIS FOREIGN KEY (Y2_AXIS) REFERENCES Report_Field (ID),
  CONSTRAINT REPORT_Y3_AXIS FOREIGN KEY (Y3_AXIS) REFERENCES Report_Field (ID),
  CONSTRAINT REPORT_GROUP_BY FOREIGN KEY (GROUP_BY) REFERENCES Report_Field (ID)
);

CREATE TABLE IF NOT EXISTS Report_DateFilter (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  FIELD_ID BIGINT DEFAULT NULL,
  OPERATOR INT NOT NULL,
  VAL VARCHAR(50),
  START_TIME BIGINT DEFAULT NULL,
  END_TIME BIGINT DEFAULT NULL,
  CONSTRAINT REPORT_DATEFILTER_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID) 
);

CREATE TABLE IF NOT EXISTS Report_EnergyMeter (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  BUILDING_ID BIGINT DEFAULT NULL,
  SERVICE_ID BIGINT DEFAULT NULL,
  SUB_METER_ID BIGINT DEFAULT NULL,
  GROUP_BY VARCHAR(100),
  CONSTRAINT REPORT_ENERGYMETER_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID) 
);

CREATE TABLE IF NOT EXISTS Report_Criteria (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  CRITERIA_ID BIGINT DEFAULT NULL,
  CONSTRAINT REPORT_COMPARISION_CONDITIONS_CRITERIA_ID FOREIGN KEY (CRITERIA_ID) REFERENCES Criteria (CRITERIAID),
  CONSTRAINT REPORT_COMPARISION_CONDITIONS_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID) ON DELETE CASCADE 
);

CREATE TABLE IF NOT EXISTS Report_Threshold (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  NAME VARCHAR(45) DEFAULT NULL,
  VALUE BIGINT DEFAULT NULL,
  COLOR VARCHAR(45) DEFAULT NULL,
  LINE_STYLE INT DEFAULT NULL,
  CONSTRAINT REPORT_THRESHOLD_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID)
);

CREATE TABLE IF NOT EXISTS Report_User_Filter (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  REPORT_FIELD_ID BIGINT DEFAULT NULL,
  WHERE_CLAUSE VARCHAR(1000) DEFAULT NULL,
  CONSTRAINT REPORT_USER_FILTER_REPORT_FIELD_ID FOREIGN KEY (REPORT_FIELD_ID) REFERENCES Report_Field (ID),
  CONSTRAINT REPORT_USER_FILTER_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID)
);

CREATE TABLE IF NOT EXISTS BaseLines (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	SPACE_ID BIGINT,
	RANGE_TYPE TINYINT NOT NULL,
	START_TIME BIGINT,
	END_TIME BIGINT,
	CONSTRAINT BASE_LINE_ORG_ID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT BASE_LINE_SPACE_ID_FK FOREIGN KEY (SPACE_ID) REFERENCES BaseSpace(ID)
);

CREATE TABLE IF NOT EXISTS Benchmark (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	VAL DOUBLE NOT NULL,
	METRIC TINYINT NOT NULL,
	DURATION TINYINT,
	CONSTRAINT BENCHMARK_ORG_ID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

CREATE TABLE IF NOT EXISTS Report1_Folder (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  SITE_ID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  PARENT_FOLDER_ID BIGINT DEFAULT NULL,
  NAME VARCHAR(100) DEFAULT NULL,
  CONSTRAINT REPORT1_FOLDER_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT REPORT1_FOLDER_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
  CONSTRAINT REPORT1_FOLDER_MODULEID_FK FOREIGN KEY (MODULEID) REFERENCES Modules (MODULEID),
  CONSTRAINT REPORT1_FOLDER_PARENT_FOLDER_ID_FK FOREIGN KEY (PARENT_FOLDER_ID) REFERENCES Report1_Folder (ID)
);

CREATE TABLE IF NOT EXISTS Report1 (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT NOT NULL,
  SITE_ID BIGINT DEFAULT NULL,
  REPORT_FOLDER_ID BIGINT DEFAULT NULL,
  NAME VARCHAR(250) NOT NULL,
  DESCRIPTION VARCHAR(1000) DEFAULT NULL,
  WORKFLOW_ID BIGINT DEFAULT NULL,
  CHART_STATE_JSON TEXT DEFAULT NULL,
  TABULAR_STATE_JSON TEXT DEFAULT NULL,
  COMMON_STATE_JSON TEXT DEFAULT NULL,
  DATE_OPERATOR INT DEFAULT NULL,
  DATE_VALUE VARCHAR(45) DEFAULT NULL,
  DATE_RANGE_JSON VARCHAR(100) DEFAULT NULL,
  DATA_POINT_JSON TEXT DEFAULT NULL,
  X_CRITERIA_JSON text DEFAULT NULL,
  BASELINE_JSON text DEFAULT NULL,
  BENCHMARK_JSON text DEFAULT NULL,
  ANALYTICS_TYPE TINYINT NOT NULL,
  BOOLEAN_SETTINGS TINYINT NOT NULL,
  TRANSFORM_CLASS VARCHAR(200),
  CONSTRAINT REPORT1_ORGID1 FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT REPORT1_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
  CONSTRAINT REPORT1_WF_ID FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow (ID)
);

CREATE TABLE IF NOT EXISTS Report_Fields (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  FIELD_ID BIGINT DEFAULT NULL,
  FIELD_NAME VARCHAR(100) DEFAULT NULL,
  MODULE_NAME VARCHAR(100) DEFAULT NULL,
  CONSTRAINT REPORT_FIELDS_REPORT_ID1 FOREIGN KEY (REPORT_ID) REFERENCES Report1 (ID) ON DELETE CASCADE,
  CONSTRAINT REPORT_FIELD_FIELD_ID FOREIGN KEY (FIELD_ID) REFERENCES Fields (FIELDID)
);




CREATE TABLE IF NOT EXISTS Dashboard_Folder (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  PARENT_FOLDER_ID BIGINT DEFAULT NULL,
  NAME VARCHAR(500) DEFAULT NULL,
  CONSTRAINT Dashboard_FOLDER_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
  CONSTRAINT Dashboard_FOLDER_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT Dashboard_FOLDER_PARENT_ID FOREIGN KEY (PARENT_FOLDER_ID) REFERENCES Dashboard_Folder (ID)
);

CREATE TABLE IF NOT EXISTS Dashboard (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  DASHBOARD_FOLDER_ID BIGINT DEFAULT NULL,
  DASHBOARD_NAME VARCHAR(45) NOT NULL,
  LINK_NAME VARCHAR(45) NULL,
  CREATED_BY_USER_ID BIGINT DEFAULT NULL,
  PUBLISH_STATUS INT DEFAULT NULL,
  DASHBOARD_URL VARCHAR(100) DEFAULT NULL,
  BASE_SPACE_ID BIGINT DEFAULT NULL,
  DISPLAY_ORDER INT DEFAULT NULL,
  SHOW_HIDE_MOBILE TINYINT DEFAULT NULL,
  DATE_OPERATOR INT DEFAULT NULL,
  DATE_VALUE VARCHAR(50) DEFAULT NULL,
  CONSTRAINT DASHBOARD_MODULE_ID FOREIGN KEY (MODULEID) REFERENCES Modules (MODULEID),
  CONSTRAINT DASHBOARD_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT DASHBOARD_BASE_SPACE_ID FOREIGN KEY (BASE_SPACE_ID) REFERENCES BaseSpace (ID),
  CONSTRAINT DASHBOARD_FOLDER_ID1 FOREIGN KEY (DASHBOARD_FOLDER_ID) REFERENCES Dashboard_Folder (ID),
  CONSTRAINT DASHBOARD_CREATED_BY_USER_ID FOREIGN KEY (CREATED_BY_USER_ID) REFERENCES ORG_Users (ORG_USERID)
);

CREATE TABLE IF NOT EXISTS Widget (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  WIDGET_NAME VARCHAR(500) DEFAULT NULL,
  TYPE INT DEFAULT NULL,
  WIDGET_URL VARCHAR(100) DEFAULT NULL,
  DATA_REFRESH_INTERTVEL INT DEFAULT NULL,
  HEADER_TEXT VARCHAR(500) DEFAULT NULL,
  HEADER_SUB_TEXT VARCHAR(45) DEFAULT NULL,
  HEADER_IS_EXPORT TINYINT DEFAULT NULL,
  CONSTRAINT WIDGET_MODULE_ID FOREIGN KEY (MODULEID) REFERENCES Modules (MODULEID),
  CONSTRAINT WIDGET_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

CREATE TABLE IF NOT EXISTS Dashboard_vs_Widget (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  DASHBOARD_ID BIGINT DEFAULT NULL,
  WIDGET_ID BIGINT DEFAULT NULL,
  LAYOUT_WIDTH INT DEFAULT NULL,
  LAYOUT_HEIGHT INT DEFAULT NULL,
  X_POSITION INT DEFAULT NULL,
  Y_POSITION INT DEFAULT NULL,
  LAYOUT_POSITION INT DEFAULT NULL,
  META_JSON VARCHAR(1000) DEFAULT NULL,
  CONSTRAINT dashboard_vs_widget_dashboard_id FOREIGN KEY (DASHBOARD_ID) REFERENCES Dashboard (ID) ON DELETE CASCADE,
  CONSTRAINT dashboard_vs_widget_widget_id FOREIGN KEY (WIDGET_ID) REFERENCES Widget (ID) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS Widget_Chart (
  ID BIGINT NOT NULL PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  NEW_REPORT_ID BIGINT DEFAULT NULL,
  CHART_TYPE INT DEFAULT NULL,
  DATE_FILTER BIGINT DEFAULT NULL,
  CONSTRAINT WIDGET_CHART_REPORT_DATE_FILTER FOREIGN KEY (DATE_FILTER) REFERENCES Report_DateFilter (ID),
  CONSTRAINT WIDGET_CHART_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID),
  CONSTRAINT WIDGET_CHART_NEW_REPORT_ID FOREIGN KEY (NEW_REPORT_ID) REFERENCES Report1 (ID),
  CONSTRAINT WIDGET_CHART_WIDGET_ID FOREIGN KEY (ID) REFERENCES Widget (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Widget_List_View (
  ID bigint(20) NOT NULL PRIMARY KEY,
   MODULE_NAME VARCHAR(100) DEFAULT NULL,
  VIEW_NAME VARCHAR(100) DEFAULT NULL,
  CONSTRAINT WIDGET_LIST_WIDGET_ID FOREIGN KEY (ID) REFERENCES Widget (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Widget_Static (
  ID bigint(20) NOT NULL PRIMARY KEY,
  STATIC_KEY VARCHAR(100) DEFAULT NULL,
  PARAMS_JSON VARCHAR(1000) DEFAULT NULL,
  META_JSON LONGTEXT DEFAULT NULL,
  CONSTRAINT WIDGET_STATIC_WIDGET_ID FOREIGN KEY (ID) REFERENCES Widget (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Widget_Vs_Workflow (
  ID bigint(20) AUTO_INCREMENT PRIMARY KEY,
  WIDGET_ID bigint(20) DEFAULT NULL,
  WORKFLOW_NAME varchar(100) DEFAULT NULL,
  WORKFLOW_ID bigint(20) DEFAULT NULL,
  BASE_SPACE_ID bigint(20) DEFAULT NULL,
  CONSTRAINT WIDGET_WF_BASE_SPACE_ID FOREIGN KEY (BASE_SPACE_ID) REFERENCES BaseSpace (ID),
  CONSTRAINT WIDGET_WF_WIDGET_ID FOREIGN KEY (WIDGET_ID) REFERENCES Widget (ID) ON DELETE CASCADE,
  CONSTRAINT WIDGET_WF_WORKFLOW_ID FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow (ID)
);

CREATE TABLE IF NOT EXISTS Widget_Web (
  ID bigint(20) NOT NULL PRIMARY KEY,
  WEB_URL VARCHAR(1000) DEFAULT NULL,
  CONSTRAINT WIDGET_WEB_WIDGET_ID FOREIGN KEY (ID) REFERENCES Widget (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Screen (
  ID BIGINT NOT NULL AUTO_INCREMENT,
  ORGID BIGINT DEFAULT NULL,
  NAME VARCHAR(100) NOT NULL,
  REFRESH_INTERVAL INT DEFAULT NULL,
  SCREEN_SETTING VARCHAR(3000) DEFAULT NULL,
  PRIMARY KEY (ID),
  CONSTRAINT SCRREN_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

CREATE TABLE IF NOT EXISTS Screen_Dashboard_Rel (
  ID BIGINT NOT NULL AUTO_INCREMENT,
  SCREEN_ID BIGINT NOT NULL,
  DASHBOARD_ID BIGINT NOT NULL,
  SPACE_ID BIGINT DEFAULT NULL,
  SEQUENCE_NO INT NOT NULL,
  PRIMARY KEY (ID),
  CONSTRAINT SCREEN_DASHBOARD_DASHBOARD_ID FOREIGN KEY (DASHBOARD_ID) REFERENCES Dashboard (ID),
  CONSTRAINT SCREEN_DASHBOARD_SCREEN_ID FOREIGN KEY (SCREEN_ID) REFERENCES Screen (ID)
);

CREATE TABLE IF NOT EXISTS Remote_Screens (
  ID BIGINT NOT NULL AUTO_INCREMENT,
  ORGID BIGINT DEFAULT NULL,
  NAME VARCHAR(100) NOT NULL,
  SCREEN_ID BIGINT,
  TOKEN VARCHAR(500) DEFAULT NULL,
  SESSION_START_TIME BIGINT DEFAULT NULL,
  SESSION_INFO VARCHAR(5000),
  PRIMARY KEY (ID),
  CONSTRAINT REMOTE_SCREEN_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT REMOTE_SCREEN_SCREEN_ID FOREIGN KEY (SCREEN_ID) REFERENCES Screen(ID) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS TVPasscodes (
  CODE VARCHAR(10) NOT NULL,
  GENERATED_TIME BIGINT DEFAULT NULL,
  EXPIRY_TIME BIGINT DEFAULT NULL,
  CONNECTED_SCREEN_ID BIGINT DEFAULT NULL,
  INFO VARCHAR(5000),
  PRIMARY KEY (CODE),
  CONSTRAINT CONNECTED_SCREEN_ID_FK FOREIGN KEY (CONNECTED_SCREEN_ID) REFERENCES Remote_Screens (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Formula (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT DEFAULT NULL,
  MODULEID BIGINT DEFAULT NULL,
  SELECT_FIELD_ID BIGINT DEFAULT NULL,
  AGGREGATE_OPERATION INT DEFAULT NULL,
  CRITERIA_ID BIGINT DEFAULT NULL,
  CONSTRAINT FORMULA_CRITERIA_ID FOREIGN KEY (CRITERIA_ID) REFERENCES Criteria (CRITERIAID),
  CONSTRAINT FORMULA_MODULE_ID FOREIGN KEY (MODULEID) REFERENCES Modules (MODULEID),
  CONSTRAINT FORMULA_ORG_ID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  CONSTRAINT FORMULA_SELECT_FIELD_ID FOREIGN KEY (SELECT_FIELD_ID) REFERENCES Fields (FIELDID)
);

CREATE TABLE IF NOT EXISTS Report_SpaceFilter (
  ID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  REPORT_ID BIGINT DEFAULT NULL,
  DASHBOARD_ID BIGINT DEFAULT NULL,
  SITE_ID BIGINT DEFAULT NULL,
  BUILDING_ID BIGINT DEFAULT NULL,
  FLOOR_ID BIGINT DEFAULT NULL,
  CHILLER_ID BIGINT DEFAULT NULL,
  GROUP_BY VARCHAR(250) DEFAULT NULL,
  CONSTRAINT REPORT_SPACE_FILTER_REPORT_ID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID),
  CONSTRAINT REPORT_SPACE_FILTER_DASHBOARD_ID FOREIGN KEY (DASHBOARD_ID) REFERENCES Dashboard (ID)
);

CREATE TABLE IF NOT EXISTS Unmodeled_Instance (
  ID BIGINT(20) AUTO_INCREMENT PRIMARY KEY, 
  ORGID BIGINT(20) NOT NULL,
  DEVICE_NAME VARCHAR(500) NOT NULL,
  INSTANCE_NAME VARCHAR(250) NOT NULL,
  CONTROLLER_ID BIGINT,
  CONSTRAINT UNIQUE_DEVICE_INSTANCE_ID UNIQUE(ORGID, DEVICE_NAME, INSTANCE_NAME),
  CONSTRAINT Unmodeled_Instance_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT Unmodeled_Instance_FK_CONTROLLER_ID FOREIGN KEY (CONTROLLER_ID) REFERENCES Controller (ID)
);

CREATE TABLE IF NOT EXISTS Unmodeled_Data (
  ID BIGINT(20) AUTO_INCREMENT PRIMARY KEY,
  INSTANCE_ID BIGINT(20) NOT NULL,
  TTIME BIGINT(20), 
  VALUE VARCHAR(1000), 
  CONSTRAINT UNMODELED_DATA_FK_INSTANCEID FOREIGN KEY (INSTANCE_ID) REFERENCES Unmodeled_Instance(ID) ON DELETE CASCADE
 );
 
 CREATE TABLE IF NOT EXISTS Historical_VM_Calculation  (
  ID BIGINT(20) AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  METER_ID BIGINT(20) NOT NULL,
  START_TIME BIGINT(20), 
  END_TIME BIGINT(20),
  INTERVAL_VALUE INT,
  UPDATE_READING BOOLEAN,
  RUN_PARENT_METER BOOLEAN,
  CONSTRAINT Historical_VM_Calculation_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT Historical_VM_Calculation_FK_RESOURCEID FOREIGN KEY (METER_ID) REFERENCES Energy_Meter(ID) ON DELETE CASCADE
 );
 
 CREATE TABLE IF NOT EXISTS Instance_To_Asset_Mapping (
   ID BIGINT AUTO_INCREMENT PRIMARY KEY, 
   ORGID BIGINT NOT NULL,
   DEVICE_NAME VARCHAR(500) NOT NULL,
   INSTANCE_NAME VARCHAR(250),
   ASSET_ID BIGINT(20), 
   FIELD_ID BIGINT(20),
   CONTROLLER_ID BIGINT,
   CONSTRAINT INSTANCE_TO_ASSET_MAPPING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
   CONSTRAINT INSTANCE_TO_ASSET_MAPPING_FK_FIELDID FOREIGN KEY (FIELD_ID) REFERENCES Fields(FIELDID) ON DELETE CASCADE,
   CONSTRAINT INSTANCE_TO_ASSET_MAPPING_FK_ASSETID FOREIGN KEY (ASSET_ID) REFERENCES Assets(ID) ON DELETE CASCADE,
   CONSTRAINT INSTANCE_TO_ASSET_MAPPING_FK_CONTROLLER_ID FOREIGN KEY (CONTROLLER_ID) REFERENCES Controller (ID)

 );

CREATE TABLE IF NOT EXISTS View_Column (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	VIEWID BIGINT NOT NULL,
	FIELDID BIGINT NOT NULL,
	DISPLAY_NAME VARCHAR(250),
	PARENT_FIELDID BIGINT,
	CONSTRAINT VIEW_COLUMN_VIEWID_FK FOREIGN KEY (VIEWID) REFERENCES Views(ID)  ON DELETE CASCADE,
	CONSTRAINT VIEW_COLUMN_FIELDID_FK FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE,
	CONSTRAINT VIEW_COLUMN_PARENT_FIELDID_FK FOREIGN KEY (FIELDID) REFERENCES Fields(FIELDID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS License (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	LICENSE INT NOT NULL,
	TOTAL_LICENSE INT,
	USED_LICENSE INT,
	LICENSETYPE INT NULL DEFAULT 1,
	EXPIRY_DATE BIGINT DEFAULT -1,
	CONSTRAINT LICENSE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS FeatureLicense (
	ORGID BIGINT NOT NULL,
	MODULE INT
);

-- CREATE TABLE IF NOT EXISTS UserLicense (
--	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
--	ORGID BIGINT NOT NULL,
--	ROLE_ID BIGINT NOT NULL,
--	NUMBER_OF_USERS INT,
--	CONSTRAINT USERLICENSE_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
-- );

CREATE TABLE IF NOT EXISTS OrgInfo (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
    NAME VARCHAR(50),
	VALUE VARCHAR(100),
	CONSTRAINT ORG_INFO_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
);

CREATE TABLE IF NOT EXISTS Report_Schedule_Info (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	REPORTID BIGINT NOT NULL,
	FILE_FORMAT INT NOT NULL,
	DATE_FILTER VARCHAR(50),
	TEMPLATEID BIGINT NOT NULL,
	CONSTRAINT REPORT_SCHEDULE_REPORTID_FK FOREIGN KEY (REPORTID) REFERENCES Report(ID)  ON DELETE CASCADE,
	CONSTRAINT REPORT_SCHEDULE_TEMPLATEID_FK FOREIGN KEY (TEMPLATEID) REFERENCES EMail_Templates(ID)  ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Report_Schedule_Info1 (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	REPORTID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	FILE_FORMAT INT NOT NULL,
	TEMPLATEID BIGINT NOT NULL,
	CONSTRAINT REPORT_SCHEDULE1_ORG_ID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT REPORT_SCHEDULE1_REPORTID_FK FOREIGN KEY (REPORTID) REFERENCES Report1(ID)  ON DELETE CASCADE,
	CONSTRAINT REPORT_SCHEDULE1_MODULEID_FK FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID) ON DELETE CASCADE,
	CONSTRAINT REPORT_SCHEDULE1_TEMPLATEID_FK FOREIGN KEY (TEMPLATEID) REFERENCES EMail_Templates(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Calendar_Color (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
  	BASED_ON VARCHAR(100) DEFAULT NULL,
  	CONSTRAINT CALENDAR_COLOR_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
);

CREATE TABLE IF NOT EXISTS Benchmark_Units (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	BENCHMARK_ID BIGINT NOT NULL,
	UNIT TINYINT NOT NULL,
	CONSTRAINT BENCHMARK_UNITS_ORG_ID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT BENCHMARK_UNITS_BENCHMARK_ID_FK FOREIGN KEY (BENCHMARK_ID) REFERENCES Benchmark (ID)
);

CREATE TABLE IF NOT EXISTS Report_Benchmark_Rel (
  REPORT_ID BIGINT NOT NULL,
  BENCHMARK_ID BIGINT NOT NULL,
  CONSTRAINT REPORT_BENCHMARK_BENCHMARKID FOREIGN KEY (BENCHMARK_ID) REFERENCES Benchmark (ID),
  CONSTRAINT REPORT_BENCHMARK_REPORTID FOREIGN KEY (REPORT_ID) REFERENCES Report (ID)
);

CREATE TABLE IF NOT EXISTS Reading_Rule (
	ID BIGINT PRIMARY KEY,
	RESOURCE_ID BIGINT,
	ASSET_CATEGORY_ID BIGINT,
	READING_FIELD_ID BIGINT,
	START_VALUE BIGINT,
	INTERVAL_VALUE BIGINT,
	`LAST_VALUE` BIGINT,	
	BASELINE_ID BIGINT,
	AGGREGATION VARCHAR(50),
	DATE_RANGE INT,
	OPERATOR_ID INT,
	PERCENTAGE VARCHAR(50),
	THRESHOLD_TYPE TINYINT NOT NULL,
	CLEAR_ALARM BOOLEAN,
	OCCURENCES INT,
	OVER_PERIOD BIGINT,
	IS_CONSECUTIVE BOOLEAN,
	FLAP_COUNT INT,
	FLAP_INTERVAL INT,
	MIN_FLAP_VAL DOUBLE,
	MAX_FLAP_VAL DOUBLE,
	FLAP_FREQUENCY INT,
	CONSTRAINT READING_RULE_ID_FK FOREIGN KEY (ID) REFERENCES Workflow_Rule(ID) ON DELETE CASCADE,
	CONSTRAINT READING_RULE_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT READING_RULE_FK_ASSET_CATEGORY_ID FOREIGN KEY (ASSET_CATEGORY_ID) REFERENCES Asset_Categories(ID),
	CONSTRAINT READING_RULE_FK_READING_ID FOREIGN KEY (READING_FIELD_ID) REFERENCES Fields(FIELDID),
	CONSTRAINT READING_RULE_FK_BASELINE_ID FOREIGN KEY (BASELINE_ID) REFERENCES BaseLines(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Reading_Rule_Inclusions_Exclusions (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	RULE_ID BIGINT NOT NULL,
	RESOURCE_ID BIGINT NOT NULL,
	IS_INCLUDE BOOLEAN NOT NULL,
	CONSTRAINT READING_RULE_INCLUSIONS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT READING_RULE_INCLUSIONS_FK_RULE_ID FOREIGN KEY (RULE_ID) REFERENCES Reading_Rule(ID) ON DELETE CASCADE,
	CONSTRAINT READING_RULE_INCLUSIONS_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID)
);

CREATE TABLE IF NOT EXISTS Reading_Rule_Alarm_Meta (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	ALARM_ID BIGINT NOT NULL,
	RULE_ID BIGINT NOT NULL,
	RESOURCE_ID BIGINT NOT NULL,
	READING_FIELD_ID BIGINT NOT NULL,
	IS_CLEAR BOOLEAN NOT NULL,
	CONSTRAINT READING_RULE_ALARM_META_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT READING_RULE_ALARM_META_FK_ALARM_ID FOREIGN KEY (ALARM_ID) REFERENCES Reading_Alarms (ID) ON DELETE CASCADE,
	CONSTRAINT READING_RULE_ALARM_META_FK_RULE_ID FOREIGN KEY (RULE_ID) REFERENCES Reading_Rule (ID) ON DELETE CASCADE,
	CONSTRAINT READING_RULE_ALARM_META_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID) ON DELETE CASCADE,
	CONSTRAINT READING_RULE_ALARM_META_FK_READING_FIELD_ID FOREIGN KEY (READING_FIELD_ID) REFERENCES Fields (FIELDID) ON DELETE CASCADE,
	CONSTRAINT READING_RULE_ALARM_META_UNIQUE_RULE_ID_RESOURCE_ID UNIQUE (RULE_ID, RESOURCE_ID),
	CONSTRAINT READING_RULE_ALARM_META_UNIQUE_ALARM_ID UNIQUE (ALARM_ID)
);

CREATE TABLE IF NOT EXISTS SLA_Rule (
	ID BIGINT PRIMARY KEY,
	RESOURCE_ID BIGINT,
	GROUP_ID BIGINT,
	CONSTRAINT SLA_RULE_ID_FK FOREIGN KEY (ID) REFERENCES Workflow_Rule(ID) ON DELETE CASCADE,
	CONSTRAINT SLA_RULE_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID),
	CONSTRAINT SLA_RULE_FK_GROUP_ID FOREIGN KEY (GROUP_ID) REFERENCES `Groups`(GROUPID)
);

CREATE TABLE IF NOT EXISTS Reading_Rule_Flaps (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	RULE_ID BIGINT NOT NULL,
	FLAP_TIME BIGINT NOT NULL,
	RESOURCE_ID BIGINT NOT NULL,
	CONSTRAINT READING_RULE_FLAPS_RULE_ID_FK FOREIGN KEY (RULE_ID) REFERENCES Reading_Rule(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Scheduled_Rules (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	DATE_FIELD_ID BIGINT NOT NULL,
	SCHEDULE_TYPE BIGINT NOT NULL,
	TIME_INTERVAL BIGINT,
	JOB_TIME VARCHAR(5),
	CONSTRAINT SCHEDULED_RULES_ID_FK FOREIGN KEY (ID) REFERENCES Workflow_Rule(ID) ON DELETE CASCADE,
	CONSTRAINT SCHEDULED_RULES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SCHEDULED_RULES_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID),
	CONSTRAINT SCHEDULED_RULES_FK_DATE_FIELD_ID FOREIGN KEY (DATE_FIELD_ID) REFERENCES Fields(FIELDID)
);

CREATE TABLE IF NOT EXISTS Scheduled_Rule_Jobs (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	RULE_ID BIGINT NOT NULL,
	RECORD_ID BIGINT,
	SCHEDULED_TIME BIGINT NOT NULL,
	CONSTRAINT SCHEDULED_RULE_JOBS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SCHEDULED_RULE_JOBS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID),
	CONSTRAINT SCHEDULED_RULE_JOBS_FK_RULE_ID FOREIGN KEY (RULE_ID) REFERENCES Scheduled_Rules (ID) ON DELETE CASCADE,
	CONSTRAINT SCHEDULED_RULE_JOBS_UNIQUE_RULE_ID_RECORD_ID UNIQUE (RULE_ID, RECORD_ID)
);

CREATE TABLE IF NOT EXISTS Reading_Alarms (
	ID BIGINT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	READING_FIELD_ID BIGINT NOT NULL,
	READING_DATA_ID BIGINT,
	BASELINE_ID BIGINT,
	START_TIME BIGINT,
	END_TIME BIGINT,
	READING_MSG VARCHAR(2000),
	RULE_ID BIGINT,
	SITE_ID BIGINT,
	CONSTRAINT READING_ALARMS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT READING_ALARMS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT READING_ALARMS_FK_ID FOREIGN KEY (ID) REFERENCES Alarms(ID) ON DELETE CASCADE,
	CONSTRAINT READING_ALARMS_FK_READING_ID FOREIGN KEY (READING_FIELD_ID) REFERENCES Fields(FIELDID),
	CONSTRAINT READING_ALARMS_FK_BASELINE_ID FOREIGN KEY (BASELINE_ID) REFERENCES BaseLines(ID) ON DELETE SET NULL,
	CONSTRAINT READING_ALARMS_FK_RULE_ID FOREIGN KEY (RULE_ID) REFERENCES Reading_Rule(ID) ON DELETE SET NULL,
	CONSTRAINT REAING_ALARMS_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site(ID)
);


CREATE TABLE IF NOT EXISTS PM_Triggers(
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	PM_ID BIGINT NOT NULL,
	SCHEDULE_INFO VARCHAR(1000),
	START_TIME BIGINT,
	READING_RULE_ID BIGINT,
	TRIGGER_TYPE INT DEFAULT NULL,
	ASSIGNED_TO BIGINT DEFAULT NULL,
	CONSTRAINT PM_TRIGGERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT PM_TRIGGERS_FK_PM_ID FOREIGN KEY (PM_ID) REFERENCES Preventive_Maintenance(ID) ON DELETE CASCADE,
	CONSTRAINT PM_Triggers_ASSIGNED_TO FOREIGN KEY (ASSIGNED_TO) REFERENCES ORG_Users (ORG_USERID),
	CONSTRAINT PM_TRIGGERS_FK_READING_RULE_ID FOREIGN KEY (READING_RULE_ID) REFERENCES Reading_Rule(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS PM_Triggers_Resource (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  PM_ID BIGINT DEFAULT NULL,
  RESOURCE_ID BIGINT DEFAULT NULL,
  TRIGGER_ID BIGINT DEFAULT NULL,
  ASSIGNED_TO BIGINT DEFAULT NULL,
  CONSTRAINT PM_Triggers_Resource_ASSIGNED_TO_ID FOREIGN KEY (ASSIGNED_TO) REFERENCES ORG_Users (ORG_USERID),
  CONSTRAINT PM_Triggers_Resource_PM_ID FOREIGN KEY (PM_ID) REFERENCES Preventive_Maintenance (ID),
  CONSTRAINT PM_Triggers_Resource_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID),
  CONSTRAINT PM_Triggers_Resource_TRIGGER_ID FOREIGN KEY (TRIGGER_ID) REFERENCES PM_Triggers (ID)
);

CREATE TABLE IF NOT EXISTS PM_Jobs(
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	PM_ID BIGINT NOT NULL,
	PM_TRIGGER_ID BIGINT NOT NULL,
	NEXT_EXECUTION_TIME BIGINT NOT NULL,
	TEMPLATE_ID BIGINT,
	STATUS TINYINT NOT NULL,
	RESOURCE_ID BIGINT DEFAULT NULL,
	CONSTRAINT PM_JOBS_FK_PM_ID FOREIGN KEY (PM_ID) REFERENCES Preventive_Maintenance(ID) ON DELETE CASCADE,
	CONSTRAINT PM_JOBS_FK_PM_TRIGGER_ID FOREIGN KEY (PM_TRIGGER_ID) REFERENCES PM_Triggers(ID) ON DELETE CASCADE,
	CONSTRAINT PM_Jobs_FK_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources (ID),
	CONSTRAINT PM_JOBS_FK_TEMPLATE_ID FOREIGN KEY (TEMPLATE_ID) REFERENCES Workorder_Template(ID)
);
-- Index for PM_Jobs
CREATE INDEX PM_JOBS_TRIGGER_ID_TIME_INDEX on PM_Jobs (PM_TRIGGER_ID,NEXT_EXECUTION_TIME);
CREATE INDEX PM_JOBS_PM_ID_TIME_INDEX on PM_Jobs (PM_ID,NEXT_EXECUTION_TIME);

CREATE TABLE IF NOT EXISTS PM_Reminders (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	PM_ID BIGINT NOT NULL,
	REMINDER_TYPE TINYINT NOT NULL,
	DURATION BIGINT NOT NULL,
	ACTION_ID BIGINT NOT NULL,
	CONSTRAINT PM_REMINDER_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT PM_REMINDER_FK_PM_ID FOREIGN KEY (PM_ID) REFERENCES Preventive_Maintenance(ID) ON DELETE CASCADE,
	CONSTRAINT PM_REMINDER_FK_ACTION_ID FOREIGN KEY (ACTION_ID) REFERENCES Action(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Before_PM_Reminder_Trigger_Rel (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	PM_REMINDER_ID BIGINT,
	PM_TRIGGER_ID BIGINT,
	CONSTRAINT BEFORE_PM_REMINDER_TRIGGER_REL_UK UNIQUE(PM_REMINDER_ID, PM_TRIGGER_ID),
	CONSTRAINT BEFORE_PM_REMINDER_TRIGGER_REL_FK_PM_REMINDER_ID FOREIGN KEY (PM_REMINDER_ID) REFERENCES PM_Reminders(ID) ON DELETE CASCADE,
	CONSTRAINT BEFORE_PM_REMINDER_TRIGGER_REL_PM_TRIGGER_ID FOREIGN KEY (PM_TRIGGER_ID) REFERENCES PM_Triggers(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS After_PM_Reminder_WO_Rel (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	PM_REMINDER_ID BIGINT,
	WO_ID BIGINT,
	CONSTRAINT AFTER_PM_REMINDERS_WO_REL_FK_PM_REMINDER_ID FOREIGN KEY (PM_REMINDER_ID) REFERENCES PM_Reminders(ID) ON DELETE CASCADE,
	CONSTRAINT AFTER_PM_REMINDERS_WO_REL_FK_WO_ID FOREIGN KEY (WO_ID) REFERENCES WorkOrders(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Report_BaseLine_Rel (
	BASE_LINE_ID BIGINT,
	REPORT_ID BIGINT,
	ADJUST_TYPE TINYINT,
	PRIMARY KEY(BASE_LINE_ID, REPORT_ID),
	CONSTRAINT REPORT_BASE_LINE_REL_BASE_LINE_ID_FK FOREIGN KEY (BASE_LINE_ID) REFERENCES BaseLines(ID) ON DELETE CASCADE,
	CONSTRAINT REPORT_BASE_LINE_REL_REPORT_ID_FK FOREIGN KEY (REPORT_ID) REFERENCES Report(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Report_Columns (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT,
	REPORT_ENTITY_ID BIGINT,
	REPORT_ID BIGINT,
	BASE_LINE_ID BIGINT,
	BASE_LINE_ADJUST BOOLEAN,
	IS_ACTIVE BOOLEAN,
	SEQUENCE_NUMBER INT,
	WIDTH INT,
	CONSTRAINT REPORT_COLUMNS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT REPORT_COLUMNS_REPORT_ENTITY_ID_FK FOREIGN KEY (REPORT_ENTITY_ID) REFERENCES Report_Entity (ID) ON DELETE CASCADE,
	CONSTRAINT REPORT_COLUMNS_REPORT_ID_FK FOREIGN KEY (REPORT_ID) REFERENCES Report(ID) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS Reading_Data_Meta (
  ORGID BIGINT(20) NOT NULL,
  RESOURCE_ID BIGINT(20) NOT NULL,
  FIELD_ID BIGINT(20) NOT NULL,
  TTIME BIGINT(20) NOT NULL, 
  VALUE VARCHAR(500) NOT NULL,
  READING_DATA_ID BIGINT,
  INPUT_TYPE TINYINT NOT NULL,
  UNIT INT,
  PRIMARY KEY(ORGID,RESOURCE_ID,FIELD_ID),
  CONSTRAINT READING_DATA_META_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT READING_DATA_META_FK_FIELDID FOREIGN KEY (FIELD_ID) REFERENCES Fields(FIELDID) ON DELETE CASCADE,
  CONSTRAINT READING_DATA_META_FK_RESOURCEID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID) ON DELETE CASCADE,
  CONSTRAINT READING_DATA_META_FK_UNIQUE_ORGID_RESOURCE_ID_FIELD_ID UNIQUE (ORGID, RESOURCE_ID, FIELD_ID)
);

CREATE INDEX READING_DATA_META_ORGID_RESOURCE_ID_FIELD_ID ON Reading_Data_Meta (ORGID, RESOURCE_ID, FIELD_ID);

CREATE TABLE IF NOT EXISTS Marked_Reading (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  DATA_ID BIGINT(20),
  MODULEID BIGINT(20),
  RESOURCE_ID BIGINT(20), 
  FIELD_ID BIGINT(20),
  MARK_TYPE TINYINT NOT NULL,
  TTIME BIGINT(20), 
  ACTUAL_VALUE VARCHAR(500),
  MODIFIED_VALUE VARCHAR(500),
  CONSTRAINT MARKED_READING_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID) ON DELETE CASCADE,
  CONSTRAINT MARKED_READING_FK_FIELDID FOREIGN KEY (FIELD_ID) REFERENCES Fields(FIELDID) ON DELETE CASCADE,
  CONSTRAINT MARKED_READING_FK_RESOURCEID FOREIGN KEY (RESOURCE_ID) REFERENCES Resources(ID) ON DELETE CASCADE  
);

CREATE TABLE IF NOT EXISTS Dashboard_Sharing (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  DASHBOARD_ID BIGINT(20) NOT NULL,
  ORG_USERID BIGINT(20), 
  ROLE_ID BIGINT(20),
  GROUP_ID BIGINT(20),
  SHARING_TYPE TINYINT NOT NULL,
  CONSTRAINT DASHBOARD_SHARING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT DASHBOARD_SHARING_FK_DASHBOARD_ID FOREIGN KEY (DASHBOARD_ID) REFERENCES Dashboard (ID),
  CONSTRAINT DASHBOARD_SHARING_FK_ORG_USERID FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID),
  CONSTRAINT DASHBOARD_SHARING_FK_ROLE_ID FOREIGN KEY (ROLE_ID) REFERENCES Role(ROLE_ID),
  CONSTRAINT DASHBOARD_SHARING_FK_GROUP_ID FOREIGN KEY (GROUP_ID) REFERENCES `Groups`(GROUPID)
);

CREATE TABLE IF NOT EXISTS View_Sharing (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  VIEWID BIGINT(20) NOT NULL,
  ORG_USERID BIGINT(20), 
  ROLE_ID BIGINT(20),
  GROUP_ID BIGINT(20),
  SHARING_TYPE TINYINT NOT NULL,
  CONSTRAINT VIEW_SHARING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT VIEW_SHARING_VIEWID_FK FOREIGN KEY (VIEWID) REFERENCES Views(ID)  ON DELETE CASCADE,
  CONSTRAINT VIEW_SHARING_FK_ORG_USERID FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users(ORG_USERID),
  CONSTRAINT VIEW_SHARING_FK_ROLE_ID FOREIGN KEY (ROLE_ID) REFERENCES Role(ROLE_ID),
  CONSTRAINT VIEW_SHARING_FK_GROUP_ID FOREIGN KEY (GROUP_ID) REFERENCES `Groups`(GROUPID)
);

CREATE TABLE IF NOT EXISTS Derivations (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  NAME VARCHAR(45) NOT NULL,
  ANALYTICS_TYPE TINYINT NOT NULL,
  WORKFLOW_ID BIGINT NOT NULL,
  FORMULA_FIELD_ID BIGINT,
  CONSTRAINT DERIVATIONS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT DERIVATIONS_FORMULA_FIELD_ID FOREIGN KEY (FORMULA_FIELD_ID) REFERENCES Formula_Field(ID),
  CONSTRAINT DERIVATIONS_WORKLFOW_ID FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Weather_Stations (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  ORGID BIGINT(20) NOT NULL,
  SITE_ID BIGINT(20) NOT NULL,
  NAME VARCHAR(100) NOT NULL,
  LOCATION_ID BIGINT(20),
  CONSTRAINT Weather_Stations_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
  CONSTRAINT Weather_Stations_FK_SITE_ID FOREIGN KEY (SITE_ID) REFERENCES Site (ID) ON DELETE CASCADE,
  CONSTRAINT Weather_Stations_FK_LOCATION_ID FOREIGN KEY (LOCATION_ID) REFERENCES Locations(ID)
);

CREATE TABLE IF NOT EXISTS Tenants (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT(20) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(500),
	CONTACT_ID BIGINT(20),
	LOGO_ID BIGINT,
	SPACE BIGINT NOT NULL,
	CONSTRAINT TENANTS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  	CONSTRAINT TENANTS_FK_SPACE_ID FOREIGN KEY (SPACE) REFERENCES BaseSpace (ID),
	CONSTRAINT TENANTS_FK_LOGO_ID FOREIGN KEY (LOGO_ID) REFERENCES File (FILE_ID),
	CONSTRAINT TENANTS_FK_CONTACT_ID FOREIGN KEY (CONTACT_ID) REFERENCES ORG_Users (ORG_USERID)
);


CREATE TABLE IF NOT EXISTS Tenant_Users (
	TENANTID BIGINT(20) NOT NULL,
    ORGID BIGINT(20) NOT NULL,
    ORG_USERID BIGINT(20) NOT NULL,
 	CONSTRAINT TENANT_USERS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
  	CONSTRAINT TENANT_USERS_FK_ORG_USERID FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users (ORG_USERID) ON DELETE CASCADE,
	CONSTRAINT TENANT_USERS_FK_TENANTID FOREIGN KEY (TENANTID) REFERENCES Tenants (ID) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS Tenants_Utility_Mapping (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT(20) NOT NULL,
	TENANT_ID BIGINT NOT NULL,
	UTILITY_ID BIGINT NOT NULL,
	ASSET_ID BIGINT NOT NULL,
	SHOW_IN_PORTAL TINYINT DEFAULT NULL,
	CONSTRAINT TENANTS_UTILITY_MAPPING_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT TENANTS_UTILITY_MAPPING_FK_TENANT_ID FOREIGN KEY (TENANT_ID) REFERENCES Tenants (ID) ON DELETE CASCADE,
	CONSTRAINT TENANTS_UTILITY_MAPPING_FK_ASSET_ID FOREIGN KEY (ASSET_ID) REFERENCES Assets (ID),
	CONSTRAINT TENANTS_UTILITY_MAPPING_UNIQUE UNIQUE (TENANT_ID,UTILITY_ID,ASSET_ID)
);

 CREATE TABLE IF NOT EXISTS Rate_Card (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT(20) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(500),
	CONSTRAINT RATE_CARD_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID)
 );

 CREATE TABLE IF NOT EXISTS Rate_Card_Services (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT(20) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	RATE_CARD_ID BIGINT NOT NULL,
	SERVICE_TYPE TINYINT NOT NULL,
	UTILITY_ID BIGINT,
	PRICE DOUBLE,
	WORKFLOW_ID BIGINT,
	CONSTRAINT RATE_CARD_SERVICES_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT RATE_CARD_SERVICES_FK_RATE_CARD_ID FOREIGN KEY (RATE_CARD_ID) REFERENCES Rate_Card (ID) ON DELETE CASCADE,
	CONSTRAINT RATE_CARD_SERVICES_FK_WORKFLOW_ID FOREIGN KEY (WORKFLOW_ID) REFERENCES Workflow (ID),
	CONSTRAINT RATE_CARD_SERVICES_UNIQUE UNIQUE (RATE_CARD_ID,UTILITY_ID)
 );
 
 CREATE TABLE IF NOT EXISTS Module_Local_ID (
  ORGID BIGINT NOT NULL,
  MODULE_NAME varchar(45) NOT NULL,
  LAST_LOCAL_ID BIGINT NOT NULL,
  PRIMARY KEY (MODULE_NAME,ORGID),
  CONSTRAINT MODULE_LOCAL_ID_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID) ON DELETE NO ACTION ON UPDATE NO ACTION
);

CREATE TABLE IF NOT EXISTS Shift (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	SITE_ID BIGINT NOT NULL,
	BUSINESSHOURSID BIGINT NOT NULL,
	ISSAMETIME BOOLEAN NOT NULL,
	START_TIME TIME,
	END_TIME TIME,
	CONSTRAINT SHIFT_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT SHIFT_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT SHIFT_BUSINESSHOURS_FK FOREIGN KEY (BUSINESSHOURSID) REFERENCES BusinessHours (ID)
);

CREATE TABLE IF NOT EXISTS Shift_User_Rel (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORG_USERID BIGINT NOT NULL,
	SHIFTID BIGINT NOT NULL,
	CONSTRAINT SHIFT_USER_REL_USERID_FK FOREIGN KEY (ORG_USERID) REFERENCES ORG_Users (ORG_USERID) ON DELETE CASCADE,
	CONSTRAINT SHIFT_USER_REL_SHIFTID_FK FOREIGN KEY (SHIFTID) REFERENCES Shift (ID)
);

CREATE TABLE IF NOT EXISTS Costs (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	NAME VARCHAR(100) NOT NULL,
	UTILITY_ID TINYINT NOT NULL,
	UTILITY_PROVIDER VARCHAR(100),
	READING_ID BIGINT NOT NULL,
	CONSTRAINT COSTS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT COSTS_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT COSTS_READING_ID_FK FOREIGN KEY (READING_ID) REFERENCES Modules (MODULEID)
);

CREATE TABLE IF NOT EXISTS Cost_Slabs (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	COST_ID BIGINT NOT NULL,
	NAME VARCHAR(100),
	UNIT_COST DOUBLE NOT NULL,
	START_RANGE DOUBLE,
	END_RANGE DOUBLE,
	MAX_UNIT DOUBLE,
	CONSTRAINT COST_SLABS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT COST_SLABS_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT COST_SLABS_COST_ID_FK FOREIGN KEY (COST_ID) REFERENCES Costs (ID)
);

CREATE TABLE IF NOT EXISTS Additional_Costs (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	COST_ID BIGINT NOT NULL,
	NAME VARCHAR (100) NOT NULL,
	COST DOUBLE NOT NULL,
	COST_TYPE TINYINT NOT NULL,
	READING_FIELD_ID BIGINT NOT NULL,
	CONSTRAINT ADDITONAL_COSTS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT ADDITONAL_COSTS_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT ADDITONAL_COSTS_COST_ID_FK FOREIGN KEY (COST_ID) REFERENCES Costs (ID),
	CONSTRAINT ADDITONAL_COSTS_READING_FIELD_ID_FK FOREIGN KEY (READING_FIELD_ID) REFERENCES Fields (FIELDID)
);

CREATE TABLE IF NOT EXISTS Cost_Assets (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	SITE_ID BIGINT,
	COST_ID BIGINT NOT NULL,
	ASSET_ID BIGINT NOT NULL,
	BILL_START_DAY INT NOT NULL,
	NO_OF_BILL_MONTHS INT NOT NULL,
	FIRST_BILL_TIME BIGINT NOT NULL,
	CONSTRAINT COST_ASSETS_ORGID_FK FOREIGN KEY (ORGID) REFERENCES Organizations (ORGID),
	CONSTRAINT COST_ASSETS_SITE_ID_FK FOREIGN KEY (SITE_ID) REFERENCES Site (ID),
	CONSTRAINT COST_ASSETS_COST_ID_FK FOREIGN KEY (COST_ID) REFERENCES Costs (ID)
);

CREATE TABLE IF NOT EXISTS Cost_Readings (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
	ORGID BIGINT NOT NULL,
	MODULEID BIGINT NOT NULL,
	ACTUAL_TTIME BIGINT NOT NULL,
	TTIME BIGINT NOT NULL,
	TTIME_DATE DATE NOT NULL,
	TTIME_MONTH INT NOT NULL,
	TTIME_WEEK INT NOT NULL,
	TTIME_DAY INT NOT NULL,
	TTIME_HOUR INT NOT NULL,
	PARENT_ID BIGINT NOT NULL,
	TOTAL_COST DOUBLE NOT NULL,
	SLAB_COST DOUBLE,
	DECIMAL_CF1 DOUBLE,
	DECIMAL_CF2 DOUBLE,
	DECIMAL_CF3 DOUBLE,
	DECIMAL_CF4 DOUBLE,
	DECIMAL_CF5 DOUBLE,
	DECIMAL_CF6 DOUBLE,
	DECIMAL_CF7 DOUBLE,
	DECIMAL_CF8 DOUBLE,
	DECIMAL_CF9 DOUBLE,
	DECIMAL_CF10 DOUBLE,
	CONSTRAINT COST_READINGS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT COST_READINGS_FK_MODULEID FOREIGN KEY (MODULEID) REFERENCES Modules(MODULEID),
	CONSTRAINT COST_READINGS_FK_PARENT_ID FOREIGN KEY (PARENT_ID) REFERENCES Assets(ID)
);

-- Create indexes for Cost_Readings table
CREATE INDEX COST_READINGS_PARENT_ID_INDEX on Cost_Readings (PARENT_ID);
CREATE INDEX COST_READINGS_PARENT_ID_TTIME_INDEX ON Cost_Readings (ORGID, MODULEID, PARENT_ID, TTIME);
CREATE INDEX COST_READINGS_TTIME_INDEX ON Cost_Readings (ORGID, MODULEID, TTIME);

CREATE TABLE IF NOT EXISTS server_info (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  private_ip varchar(50) DEFAULT NULL,
  environment varchar(18) DEFAULT NULL,
  status tinyint(4) DEFAULT NULL,
  pingtime bigint(20) DEFAULT NULL,
  in_use tinyint(4) DEFAULT NULL,
  leader tinyint(4) DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY private_ip (private_ip)
  );
  
  CREATE TABLE IF NOT EXISTS Sync_Errors (
  	ORGID BIGINT NOT NULL,
  	MODULE_NAME VARCHAR(100),
  	SYNCED_BY BIGINT NOT NULL,
  	CREATED_TIME BIGINT NOT NULL,
  	LAST_SYNC_TIME BIGINT NOT NULL,
  	ERROR_INFO VARCHAR(5000) NOT NULL,
  	CONSTRAINT SYNC_ERRORS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID),
	CONSTRAINT SYNC_ERRORS_FK_SYNCED_BY FOREIGN KEY (SYNCED_BY) REFERENCES ORG_Users(ORG_USERID)
  );

  CREATE TABLE IF NOT EXISTS DeviceDetails (
    ID bigint(20) NOT NULL AUTO_INCREMENT,
    ORGID bigint(20) NOT NULL,
    DEVICE_NAME varchar(30) DEFAULT NULL,
    DEVICE_ID varchar(30) NOT NULL,
    IN_USE tinyint(4) NOT NULL,
    LAST_UPDATED_TIME bigint(20) NOT NULL,
    ALERT_FREQUENCY bigint(20) NOT NULL DEFAULT 2400000,
    LAST_ALERTED_TIME bigint(20) NOT NULL DEFAULT 0,
    PRIMARY KEY (ID),
    CONSTRAINT DEVICE_DETAILS_FK_ORGID FOREIGN KEY (ORGID) REFERENCES Organizations(ORGID)
   );

  CREATE TABLE IF NOT EXISTS ClientApp (
     id int(11) NOT NULL AUTO_INCREMENT,
     environment varchar(50) NOT NULL,
     version varchar(20) NOT NULL,
     updatedTime bigint(20) DEFAULT NULL,
     updatedBy bigint(20) DEFAULT NULL,
     PRIMARY KEY (id)
   );

-- Triggers
DELIMITER $$

CREATE TRIGGER generateBaseSpaceLocalId BEFORE INSERT
ON BaseSpace FOR EACH ROW
BEGIN
DECLARE MAX_LOCAL_ID INT;
SELECT COALESCE(MAX(LOCAL_ID),0) INTO MAX_LOCAL_ID FROM BaseSpace WHERE ORGID = NEW.ORGID AND SPACE_TYPE = NEW.SPACE_TYPE;
SET NEW.LOCAL_ID = MAX_LOCAL_ID + 1;
END; $$

CREATE TRIGGER incrementTicketNoteCount AFTER INSERT
ON Ticket_Notes FOR EACH ROW
BEGIN
UPDATE Tickets SET NO_OF_NOTES = COALESCE(NO_OF_NOTES,0)+1 WHERE ID = NEW.PARENT_ID;		
END; $$

CREATE TRIGGER decrementTicketNoteCount AFTER DELETE
ON Ticket_Notes FOR EACH ROW
BEGIN
UPDATE Tickets SET NO_OF_NOTES = NO_OF_NOTES-1 WHERE ID = OLD.PARENT_ID;		
END; $$

CREATE TRIGGER incrementTicketAttachmentCount AFTER INSERT
ON Ticket_Attachments FOR EACH ROW
BEGIN
UPDATE Tickets SET NO_OF_ATTACHMENTS = COALESCE(NO_OF_ATTACHMENTS,0)+1 WHERE ID = NEW.PARENT_TICKET;		
END; $$

CREATE TRIGGER ticketAttachmentCascadeDelete BEFORE DELETE
ON File FOR EACH ROW
BEGIN
DELETE FROM Ticket_Attachments WHERE FILE_ID = OLD.FILE_ID;		
END; $$

CREATE TRIGGER decrementTicketAttachmentCount AFTER DELETE
ON Ticket_Attachments FOR EACH ROW 
BEGIN
UPDATE Tickets SET NO_OF_ATTACHMENTS = NO_OF_ATTACHMENTS-1 WHERE ID = OLD.PARENT_TICKET;		
END; $$

CREATE TRIGGER incrementTaskAttachmentCount AFTER INSERT
ON Task_Attachments FOR EACH ROW
BEGIN
UPDATE Tasks SET NO_OF_ATTACHMENTS = COALESCE(NO_OF_ATTACHMENTS,0)+1 WHERE ID = NEW.PARENT_ID;		
END; $$

CREATE TRIGGER decrementTaskAttachmentCount AFTER DELETE
ON Task_Attachments FOR EACH ROW 
BEGIN
UPDATE Tasks SET NO_OF_ATTACHMENTS = NO_OF_ATTACHMENTS-1 WHERE ID = OLD.PARENT_ID;		
END; $$

CREATE TRIGGER incrementTaskCount AFTER INSERT
ON Tasks FOR EACH ROW
BEGIN
DECLARE TICKET_STATUS_TYPE TINYINT;
UPDATE Tickets SET NO_OF_TASKS = COALESCE(NO_OF_TASKS,0)+1 WHERE ID = NEW.PARENT_TICKET_ID;
SELECT STATUS_TYPE INTO TICKET_STATUS_TYPE FROM TicketStatus INNER JOIN Tickets ON TicketStatus.ID = Tickets.STATUS_ID WHERE Tickets.ID = NEW.ID;
IF TICKET_STATUS_TYPE = 2 THEN
UPDATE Tickets SET NO_OF_CLOSED_TASKS = COALESCE(NO_OF_CLOSED_TASKS,0)+1 WHERE ID = NEW.PARENT_TICKET_ID;
END IF;
END; $$

CREATE TRIGGER decrementTaskCount AFTER DELETE
ON Tasks FOR EACH ROW
BEGIN
DECLARE TICKET_STATUS_TYPE TINYINT;
UPDATE Tickets SET NO_OF_TASKS = NO_OF_TASKS-1 WHERE ID = OLD.PARENT_TICKET_ID;
SELECT STATUS_TYPE INTO TICKET_STATUS_TYPE FROM TicketStatus INNER JOIN Tickets ON TicketStatus.ID = Tickets.STATUS_ID WHERE Tickets.ID = OLD.ID;
IF TICKET_STATUS_TYPE = 2 THEN
UPDATE Tickets SET NO_OF_CLOSED_TASKS = NO_OF_CLOSED_TASKS-1 WHERE ID = OLD.PARENT_TICKET_ID;
END IF;
END; $$

CREATE TRIGGER generateCustomViewOrder BEFORE INSERT
ON Views FOR EACH ROW 
BEGIN
DECLARE MAX_SEQUENCE_NUMBER INT;
SELECT GREATEST(COALESCE(MAX(SEQUENCE_NUMBER),1000),1000) INTO MAX_SEQUENCE_NUMBER FROM Views WHERE ORGID = NEW.ORGID AND MODULEID = NEW.MODULEID;
IF NEW.ISDEFAULT = FALSE THEN
SET NEW.SEQUENCE_NUMBER = MAX_SEQUENCE_NUMBER + 1;
END IF;
END; $$

CREATE TRIGGER generateTaskSequence BEFORE INSERT
ON Tasks FOR EACH ROW 
BEGIN
DECLARE MAX_SEQUENCE_NUMBER INT;
IF NEW.SECTION_ID IS NULL THEN
SELECT COALESCE(MAX(SEQUENCE),0) INTO MAX_SEQUENCE_NUMBER FROM Tasks WHERE ORGID = NEW.ORGID AND SECTION_ID = NEW.SECTION_ID;
SET NEW.SEQUENCE = MAX_SEQUENCE_NUMBER + 1;
END IF;
END; $$

DELIMITER ;

-- Insert Queries
-- Add entry in Jobs for workorderemail parser
INSERT INTO Jobs (JOBID, JOBNAME, IS_ACTIVE, IS_PERIODIC, PERIOD, NEXT_EXECUTION_TIME, EXECUTOR_NAME) VALUES (1, 'WorkOrderRequestEmailParser', true, true, 60, UNIX_TIMESTAMP()+30,'priority');
