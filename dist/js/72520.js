(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[72520,541],{
/***/405657:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return NewSurvey}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/survey/NewSurvey.vue?vue&type=template&id=b22911de
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"formbuilder-fullscreen-popup sla-policy-container"},[_c("div",{staticClass:"setting-header"},[_vm.isNew?_c("div",{staticClass:"d-flex flex-direction-column"},[_c("div",{staticClass:"mT10 mB10 f22 fw3 letter-spacing0_5"},[_vm._v(" "+_vm._s(_vm.$t("survey.configure_survey"))+" ")])]):_c("div",[_c("div",{staticClass:"pointer fc-link fw-normal f13",on:{click:_vm.goBack}},[_c("inline-svg",{attrs:{src:"left-arrow",iconClass:"icon icon-sm vertical-text-top mR5"}}),_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.go_back"))+" ")],1),_c("div",{staticClass:"mT10 mB5 f22 fw3 letter-spacing0_5"},[_vm._v(" "+_vm._s(_vm.$t("common._common.edit")+" "+_vm.policyTitle)+" ")])]),_c("div",{staticClass:"fR stateflow-btn-wrapper"},[_c("async-button",{attrs:{buttonClass:"asset-el-btn",clickAction:_vm.goBack}},[_vm._v(" "+_vm._s(_vm.$t("setup.users_management.cancel"))+" ")]),_c("async-button",{attrs:{buttonType:"primary",buttonClass:"asset-el-btn",clickAction:_vm.save}},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.save"))+" ")])],1)]),_c("div",{staticClass:"d-flex setup-grey-bg"},[_c("div",{staticClass:"sla-sidebar pT10"},[_c("a",{staticClass:"sla-link active",attrs:{id:"surveyBasicDetails-link"},on:{click:function($event){return _vm.scrollTo("surveyBasicDetails")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_details"))+" ")]),_c("a",{staticClass:"sla-link",attrs:{id:"surveyRespondent-link"},on:{click:function($event){return _vm.scrollTo("surveyRespondent")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_respondent"))+" ")]),_c("a",{staticClass:"sla-link",attrs:{id:"surveyCustomization-link"},on:{click:function($event){return _vm.scrollTo("surveyCustomization")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_customization"))+" ")]),_c("a",{staticClass:"sla-link",attrs:{id:"surveyActions-link"},on:{click:function($event){return _vm.scrollTo("surveyActions")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_actions"))+" ")])]),_c("div",{staticClass:"scroll-container"},[_vm.isLoading?_c("div",{staticClass:"mT20"},[_c("spinner",{attrs:{show:_vm.isLoading,size:"80"}})],1):[_c("SurveyBasicDetails",{ref:"surveyBasicDetails-section",staticClass:"mB20",attrs:{id:"surveyBasicDetails-section",selectedSurvey:_vm.selectedSurvey}}),_c("SurveyRespondent",{ref:"surveyRespondent-section",staticClass:"mB20",attrs:{id:"surveyRespondent-section",selectedSurvey:_vm.selectedSurvey,moduleFields:_vm.moduleFields}}),_c("SurveyCustomization",{ref:"surveyCustomization-section",staticClass:"mB20",attrs:{id:"surveyCustomization-section",selectedSurvey:_vm.selectedSurvey}}),_c("SurveyActions",{ref:"surveyActions-section",staticClass:"mB70",attrs:{id:"surveyActions-section",selectedSurvey:_vm.selectedSurvey,data:_vm.data}})]],2)])])},staticRenderFns=[],slicedToArray=__webpack_require__(554621),objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),validation=(__webpack_require__(670560),__webpack_require__(434284),__webpack_require__(260228),__webpack_require__(186466),__webpack_require__(659749),__webpack_require__(386544),__webpack_require__(947522),__webpack_require__(336585),__webpack_require__(538077),__webpack_require__(990260)),AsyncButton=__webpack_require__(303514),SurveyBasicDetailsvue_type_template_id_1ba50964_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"section-header survey-header-color pB10",attrs:{id:"survey-basic-details-header"}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_details"))+" ")]),_c("div",{staticClass:"survey-basic-details"},[_c("el-form",{ref:"basicDetailsForm",staticClass:"p50 pT10 pB30 pR10",attrs:{model:_vm.survey,"label-width":"150px","label-position":"left"}},[_c("div",{staticClass:"section-container flex-container"},[_c("div",{staticClass:"form-one-column fc-label-required"},[_c("el-form-item",{attrs:{label:_vm.$t("survey.survey_name"),prop:"qandaTemplateId"}},[_c("el-select",{staticClass:"fc-input-full-border2 width50",attrs:{placeholder:_vm.$t("survey.select_survey"),autofocus:!0,"default-first-option":""},on:{change:_vm.handleTemplateChange},model:{value:_vm.survey.qandaTemplateId,callback:function($$v){_vm.$set(_vm.survey,"qandaTemplateId",$$v)},expression:"survey.qandaTemplateId"}},_vm._l(_vm.templates,(function(template){return _c("el-option",{key:template.id,attrs:{label:template.name,value:template.id}})})),1)],1)],1),_c("div",{staticClass:"form-one-column"},[_c("el-form-item",{attrs:{label:_vm.$t("maintenance._workorder.execute_on"),prop:"activityType"}},[_c("el-select",{staticClass:"width50 fc-input-full-border-select2",attrs:{placeholder:_vm.$t("survey.select")},model:{value:_vm.survey.event.activityType,callback:function($$v){_vm.$set(_vm.survey.event,"activityType",$$v)},expression:"survey.event.activityType"}},_vm._l(_vm.activityTypes,(function(type,index){return _c("el-option",{key:index,attrs:{label:type.label,value:type.value}})})),1)],1)],1),"field"===_vm.checkActivityType(_vm.survey)?_c("div",{staticClass:"form-one-column"},[_c("el-row",[_c("div",{staticClass:"form-one-column"},[_c("el-form-item",{staticClass:"fc-tag p0 pL10 pR10",attrs:{prop:"activityType"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.header.field"))+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width50",attrs:{"multiple-limit":3,multiple:"","collapse-tags":"",placeholder:_vm.$t("survey.select")},model:{value:_vm.survey.fields,callback:function($$v){_vm.$set(_vm.survey,"fields",$$v)},expression:"survey.fields"}},_vm._l(_vm.moduleFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1),_c("el-button",{staticClass:"all-rule-btn",attrs:{slot:"reference"},slot:"reference"},[_c("inline-svg",{attrs:{src:"svgs/survey/add-icon",iconClass:"mL10"}})],1)],1)],1)])],1):"scheduled"===_vm.checkActivityType(_vm.survey)?_c("div",{staticClass:"form-one-column mL150"},[_c("el-row",[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.dateField"))+" ")]),_c("el-select",{staticClass:"width300px fc-input-full-border-select2",attrs:{placeholder:_vm.$t("survey.select")},model:{value:_vm.survey.dateFieldId,callback:function($$v){_vm.$set(_vm.survey,"dateFieldId",$$v)},expression:"survey.dateFieldId"}},_vm._l(_vm.filteredDateFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1)],1),_c("el-col",{staticClass:"pL40",attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.scheduled_type"))+" ")]),_c("el-radio-group",{staticClass:"criteria-radio-label",model:{value:_vm.survey.scheduleType,callback:function($$v){_vm.$set(_vm.survey,"scheduleType",$$v)},expression:"survey.scheduleType"}},_vm._l(_vm.dateFieldHash,(function(item){return _c("el-radio",{key:item.keyField,staticClass:"fc-radio-btn",attrs:{label:item.labelField}},[(1!==item.labelField||_vm.beforeFieldIds.includes(_vm.survey.dateFieldId),[_vm._v(_vm._s(item.fieldName))])],2)})),1)],1)],1),_c("el-row",{staticClass:"mT30"},[_vm.checkScheduledType?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.days"))+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:"",placeholder:_vm.$t("survey.select")},model:{value:_vm.dateObject.days,callback:function($$v){_vm.$set(_vm.dateObject,"days",$$v)},expression:"dateObject.days"}},_vm._l(60,(function(index){return _c("el-option",{key:"days-"+index,attrs:{label:index,value:index}})})),1)],1),_vm.checkDateTimeField?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common._common.hours"))+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:""},model:{value:_vm.dateObject.hours,callback:function($$v){_vm.$set(_vm.dateObject,"hours",$$v)},expression:"dateObject.hours"}},_vm._l(_vm.$constants.HOURS,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1),_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.mins"))+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{placeholder:_vm.$t("survey.select")},model:{value:_vm.dateObject.minute,callback:function($$v){_vm.$set(_vm.dateObject,"minute",$$v)},expression:"dateObject.minute"}},_vm._l(_vm.$constants.MINUTES,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1)]:_vm._e()]:_vm._e(),_vm.checkDateTimeField?_vm._e():_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.time"))+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{"collapse-tags":""},model:{value:_vm.survey.time,callback:function($$v){_vm.$set(_vm.survey,"time",$$v)},expression:"survey.time"}},_vm._l(_vm.timesOption,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1)],2)],1):_vm._e()])]),_c("div",{staticClass:"d-flex fc-label-required pB50"},[_c("div",{staticClass:"criteria-section fc-label-required"},[_vm._v(" "+_vm._s(_vm.$t("survey.criteria"))+" ")]),_c("CriteriaBuilder",{ref:"criteriaBuilder",staticClass:"pL50 criteria-builder-section",attrs:{moduleName:_vm.moduleName},model:{value:_vm.survey.criteria,callback:function($$v){_vm.$set(_vm.survey,"criteria",$$v)},expression:"survey.criteria"}})],1)],1)])},SurveyBasicDetailsvue_type_template_id_1ba50964_scoped_true_staticRenderFns=[],toConsumableArray=__webpack_require__(488478),SurveyUtil=(__webpack_require__(450886),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(634338),__webpack_require__(425728),__webpack_require__(169358),__webpack_require__(575369)),dist=__webpack_require__(191853),utils_field=__webpack_require__(815872),api=__webpack_require__(32284),activityTypeHash={SCHEDULED:524288,FIELD_CHANGE:1048576},SurveyBasicDetailsvue_type_script_lang_js={props:["selectedSurvey"],name:"SurveyBasicdetails",components:{CriteriaBuilder:dist/* CriteriaBuilder */.IP},created:function(){this.initBasicDetails(),this.getModuleFields()},data:function(){return{timesOption:[],criteriaRendered:!1,isLoading:!1,templates:null,modules:"workorder",survey:{name:"",description:"",criteria:{},qandaTemplateId:null,event:{activityType:3,moduleName:this.moduleName},siteId:null,dateFieldId:null,time:null,interval:null,fields:[],scheduleType:3},dateObject:{days:null,minute:0,hours:0,minu:null},dateFields:[],dateFieldToExclude:["sysCreatedTime","sysModifiedTime","sysDeletedTime"],beforeDateFieldsToExclude:["createdTime","modifiedTime"],beforeFieldIds:[],dateFieldHash:[{fieldName:"Before",keyField:1,labelField:1},{fieldName:"On",keyField:2,labelField:2},{fieldName:"After",keyField:3,labelField:3}],moduleFields:[]}},mounted:function(){for(var i=0;i<=23;i++){var time=(i<10?"0"+i:i)+":",timesOption=this.timesOption;timesOption.push(time+"00"),timesOption.push(time+"30"),this.$set(this,"timesOption",timesOption)}},watch:{moduleFields:function(newVal){var _this=this;(0,validation/* isEmpty */.xb)(newVal)||(this.dateFields=newVal.filter((function(dateFld){var dateFieldName=_this.$getProperty(dateFld,"dataTypeEnum._name","");return"DATE"===dateFieldName||"DATE_TIME"===dateFieldName})),this.beforeFieldIds=this.dateFields.filter((function(field){return _this.beforeDateFieldsToExclude.includes(field.name)})).map((function(field){return field.id})))}},computed:{checkScheduledType:function(){var scheduleType=this.$getProperty(this,"survey.scheduleType",0);return!![1,3].includes(parseInt(scheduleType))},workFlowActionHash:function(){var isCustomModule=this.isCustomModule,modules=this.modules,moduleName=isCustomModule?"customModules":modules;return(0,validation/* isEmpty */.xb)(modules.extendModule)||"basealarm"!==modules.extendModule.name||(moduleName="basealarm"),this.$constants.WorkFlowAction.module[moduleName]||this.$constants.WorkFlowAction.module.customModules},activityTypes:function(){var workFlowActionHash=this.workFlowActionHash;return workFlowActionHash.activityTypes},moduleName:function(){return this.$route.params.moduleName},filteredDateFields:function(){var dateFieldToExclude=this.dateFieldToExclude,beforeDateFieldsToExclude=this.beforeDateFieldsToExclude,fields=(0,toConsumableArray/* default */.Z)(dateFieldToExclude),scheduleType=this.$getProperty(this,"survey.scheduleType",null);return 1===scheduleType&&(fields=[].concat((0,toConsumableArray/* default */.Z)(fields),(0,toConsumableArray/* default */.Z)(beforeDateFieldsToExclude))),(this.dateFields||[]).filter((function(field){return!fields.includes(field.name)}))},checkDateTimeField:function(){var dateFields=this.dateFields,survey=this.survey,_ref=survey||{},dateFieldId=_ref.dateFieldId,field=(dateFields||[]).find((function(fld){return fld.fieldId===dateFieldId}))||{};return!(0,validation/* isEmpty */.xb)(field)&&(0,utils_field/* isDateTimeField */.K)(field)}},methods:{initBasicDetails:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this2.loadAvailableTemplates();case 2:_this2.prefillSurveyDetails();case 3:case"end":return _context.stop()}}),_callee)})))()},getModuleFields:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api/* API */.bl.get("/module/metafields?moduleName=".concat(_this3.moduleName)).then((function(response){_this3.moduleFields=response.data.meta.fields})).catch((function(){}));case 2:case"end":return _context2.stop()}}),_callee2)})))()},prefillSurveyDetails:function(){var selectedSurvey=this.selectedSurvey;if(!(0,validation/* isEmpty */.xb)(selectedSurvey)){var _ref2=selectedSurvey||{},workflowRule=_ref2.workflowRule,_ref3=workflowRule||{},actions=_ref3.actions,name=_ref3.name,description=_ref3.description,criteria=_ref3.criteria,siteId=_ref3.siteId,event=_ref3.event,fields=_ref3.fields,interval=_ref3.interval,scheduleType=_ref3.scheduleType,dateFieldId=_ref3.dateFieldId,qandaTemplateId=this.$getProperty(actions,"0.template.qandaTemplateId",null);if((0,validation/* isEmpty */.xb)(fields)||(fields=fields.map((function(field){var _ref4=field||{},fieldId=_ref4.fieldId;return fieldId}))),!(0,validation/* isEmpty */.xb)(interval)){var $helpers=this.$helpers,_ref5=$helpers||{},secTodaysHoursMinu=_ref5.secTodaysHoursMinu;this.dateObject=secTodaysHoursMinu(interval)}var surveyDetails={name:name,description:description,criteria:criteria,siteId:siteId,qandaTemplateId:qandaTemplateId,event:event,fields:fields,interval:interval,scheduleType:scheduleType,dateFieldId:dateFieldId};this.$set(this,"survey",surveyDetails)}},updateCriteria:function(value){this.$set(this.survey,"criteria",value)},loadAvailableTemplates:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var viewName,templatePage,templatePerPage,moduleName,templates;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this4.isLoading=!0,viewName="all",templatePage=1,templatePerPage=50,moduleName="workorder",_this4.isLoading=!0,_context3.next=8,(0,SurveyUtil/* loadAllTemplates */.qd)(moduleName,templatePage,templatePerPage,viewName);case 8:templates=_context3.sent,_this4.templates=templates.filter((function(template){var _ref6=template||{},status=_ref6.status,totalQuestions=_ref6.totalQuestions;return!(0,validation/* isEmpty */.xb)(status)&&!(0,validation/* isEmpty */.xb)(totalQuestions)})),_this4.isLoading=!1;case 11:case"end":return _context3.stop()}}),_callee3)})))()},handleTemplateChange:function(){var survey=this.survey,templates=this.templates,_ref7=survey||{},qandaTemplateId=_ref7.qandaTemplateId;if(!(0,validation/* isEmpty */.xb)(qandaTemplateId)){var template=templates.find((function(template){return template.id===qandaTemplateId}));survey.name=this.$getProperty(template,"name",null);var _ref8=template||{},siteId=_ref8.siteId;this.$set(survey,"siteId",siteId)}},serialize:function(){var survey=this.survey,moduleName=this.moduleName,dateObject=this.dateObject,checkDateTimeField=this.checkDateTimeField,_ref9=survey||{},event=_ref9.event,fields=_ref9.fields,interval=_ref9.interval,dateFieldId=_ref9.dateFieldId,criteria=_ref9.criteria,_ref10=event||{},activityType=_ref10.activityType;event=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},event),{},{moduleName:moduleName}),survey=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},survey),{},{event:event}),(0,validation/* isEmpty */.xb)(fields)||(fields=fields.map((function(field){return{fieldId:field}})),survey=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},survey),{},{fields:fields})),activityType===activityTypeHash.SCHEDULED&&((0,validation/* isEmpty */.xb)(dateObject)||(dateFieldId&&(checkDateTimeField||(this.dateObject.hours=0,this.dateObject.minute=0)),interval=this.$helpers.daysHoursMinuToSec(this.dateObject))),survey=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},survey),{},{interval:interval}),Object.keys(survey).forEach((function(property){(0,validation/* isEmpty */.xb)(survey[property])&&delete survey[property]}));var _ref11=criteria||{},conditions=_ref11.conditions,conditionsEmpty=!1;return(0,validation/* isEmpty */.xb)(conditions)||Object.keys(conditions).forEach((function(condition){var conditionObj=conditions[condition]||{},_ref12=conditionObj||{},fieldName=_ref12.fieldName;(0,validation/* isEmpty */.xb)(fieldName)&&(conditionsEmpty=conditionsEmpty||!0)})),conditionsEmpty&&(survey=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},survey),{},{criteria:null})),survey},checkActivityType:function(survey){var _ref13=survey||{},event=_ref13.event,activityType=this.$getProperty(event,"activityType",null);return activityType===activityTypeHash.FIELD_CHANGE?"field":activityType===activityTypeHash.SCHEDULED?"scheduled":""}}},new_SurveyBasicDetailsvue_type_script_lang_js=SurveyBasicDetailsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(new_SurveyBasicDetailsvue_type_script_lang_js,SurveyBasicDetailsvue_type_template_id_1ba50964_scoped_true_render,SurveyBasicDetailsvue_type_template_id_1ba50964_scoped_true_staticRenderFns,!1,null,"1ba50964",null)
/* harmony default export */,SurveyBasicDetails=component.exports,SurveyRespondentvue_type_template_id_78473e16_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"survey-respondent-style",staticStyle:{"min-height":"200px"}},[_c("div",{staticClass:"section-header survey-header-color",attrs:{id:"surveyRespondent-header"}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_respondent"))+" ")]),_c("div",{staticClass:"pL50 pR70 fc-input-label-txt survey-required-label d-flex",staticStyle:{"margin-top":"10px"}},[_c("span",[_vm._v(" "+_vm._s(_vm.$t("survey.define_who_can_take_this_survey")))]),_c("div",{staticClass:"survey-info-icon"},[_c("el-tooltip",{attrs:{"popper-class":"tooltip-content",effect:"dark",content:_vm.$t("survey.survey_info_for_tenant_primary_contact"),placement:"top-start"}},[_c("fc-icon",{staticClass:"pointer mL10",attrs:{group:"action",name:"info",size:"18",color:"#E6333D"}})],1)],1)]),_c("div",{staticClass:"pB30 pL40 mT15"},[_c("div",{staticStyle:{"min-height":"150px"}},_vm._l(_vm.activeApprovers,(function(approver,key){return _c("el-row",{key:key,staticClass:"pL20"},[_c("el-col",{attrs:{span:6}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{placeholder:_vm.$t("common.products.select_type"),filterable:""},on:{change:function($event){return _vm.resetApproverId(key)}},model:{value:approver.type,callback:function($$v){_vm.$set(approver,"type",$$v)},expression:"approver.type"}},_vm._l(_vm.approverTypes,(function(type){return _c("el-option",{key:"type-"+type.id,attrs:{label:type.name,value:type.id}})})),1)],1),_c("el-col",{staticClass:"pL10",attrs:{span:15}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width75",attrs:{placeholder:_vm.$t("common._common.select"),filterable:""},model:{value:approver.approverId,callback:function($$v){_vm.$set(approver,"approverId",$$v)},expression:"approver.approverId"}},[1===approver.type?_c("div",_vm._l(_vm.typeOptionMap[approver.type],(function(option,index){return _c("el-option",{key:"approveroption-"+index,attrs:{label:option.name||option.email||"---",value:option.id}})})),1):_vm._l(_vm.typeOptionMap[approver.type],(function(option,index){return _c("el-option",{key:"approveroption-"+index,attrs:{label:option.displayName||option.name,value:option.id}})}))],2)],1)],1)})),1)])])},SurveyRespondentvue_type_template_id_78473e16_scoped_true_staticRenderFns=[],defineProperty=__webpack_require__(482482),Approvers=__webpack_require__(996440),approverType={USER:1,ROLE:2,TEAM:3,FIELD:4,TENANT:6,VENDOR:7},dataTypes={LOOKUP:7},SurveyRespondentvue_type_script_lang_js={name:"SurveyRespondent",props:["moduleFields","selectedSurvey"],extends:Approvers/* default */.Z,data:function(){return{assignedTo:null,approverTypes:[{id:1,name:"User"},{id:4,name:"Field"}],respondentHash:{1:"userId",2:"roleId",4:"fieldId",6:"fieldId",7:"fieldId"},userList:[]}},watch:{selectedSurvey:{handler:function(newVal){(0,validation/* isEmpty */.xb)(newVal)||this.prefillRespondent()},immediate:!0},typeOptions:{handler:function(){var _handler=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(typeOptions){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,this.getApproverOptions(typeOptions);case 2:return this.typeOptionMap=_context.sent,_context.next=5,this.loadUserList();case 5:case"end":return _context.stop()}}),_callee,this)})));function handler(_x){return _handler.apply(this,arguments)}return handler}(),immediate:!0}},computed:{typeOptions:function(){return{users:[].concat((0,toConsumableArray/* default */.Z)(this.users),[{name:"Requester",peopleId:"requester"}]),roles:this.roles,teams:this.teams,fields:this.moduleFields}}},methods:{prefillRespondent:function(){var selectedSurvey=this.selectedSurvey;if(!(0,validation/* isEmpty */.xb)(selectedSurvey)){var _ref=selectedSurvey||{},workflowRule=_ref.workflowRule,_ref2=workflowRule||{},actions=_ref2.actions,type=this.$getProperty(actions,"0.template.sharingType",null),fieldId=this.$getProperty(actions,"0.template.fieldId",null);if(type!==approverType.USER||(0,validation/* isEmpty */.xb)(fieldId)){if(type===approverType.USER){var userId=this.$getProperty(actions,"0.template.userId",null);this.$set(this,"activeApprovers",[{type:type,approverId:userId}])}[approverType.FIELD,approverType.TENANT,approverType.VENDOR].includes(type)&&this.$set(this,"activeApprovers",[{type:type,approverId:fieldId}])}else this.$set(this,"activeApprovers",[{type:type,approverId:"requester"}])}},serialize:function(){var activeApprovers=this.activeApprovers,respondentHash=this.respondentHash,moduleFields=this.moduleFields,_ref3=activeApprovers[0]||{},type=_ref3.type,approverId=_ref3.approverId;return"requester"===approverId?(approverId=(moduleFields.find((function(f){return"requester"===f.name}))||{}).id,{sharingType:type,fieldId:approverId}):(approverType.USER,(0,defineProperty/* default */.Z)({sharingType:type},respondentHash[type],approverId))},loadUserList:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var filters,_yield$API$get,data,error,_ref6,_ref6$people,people;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return filters={peopleType:{operatorId:54,value:["1","3","5"]}},_context2.next=3,api/* API */.bl.get("/v2/people/list",{filters:filters});case 3:_yield$API$get=_context2.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this.$message.error(error.message||_this.$t("common._common.error_occured")):(_ref6=data||{},_ref6$people=_ref6.people,people=void 0===_ref6$people?[]:_ref6$people,_this.typeOptionMap[1]=[].concat((0,toConsumableArray/* default */.Z)(people),[{name:"Requester",id:"requester"}]));case 7:case"end":return _context2.stop()}}),_callee2)})))()},getApproverOptions:function(options){var _arguments=arguments,_this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var supportedTypes,types,supportedFields,users,roles,teams,fields;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return supportedTypes=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:null,types=(0,validation/* isEmpty */.xb)(supportedTypes)?Object.values(approverType):supportedTypes,_context3.next=4,_this2.getSupportedFields(options.fields);case 4:return supportedFields=_context3.sent,users=options.users,roles=options.roles,teams=options.teams,fields=options.fields,_context3.abrupt("return",types.reduce((function(res,type){return type===approverType.USER?res[type]=users:type===approverType.ROLE?res[type]=roles:type===approverType.TEAM?res[type]=teams:type===approverType.VENDOR?res[type]=_this2.getVendorFields(fields):type===approverType.TENANT?res[type]=_this2.getTenantFields(fields):type===approverType.FIELD&&(res[type]=supportedFields),res}),{}));case 7:case"end":return _context3.stop()}}),_callee3)})))()},getTenantFields:function(fields){var _this3=this;return fields.filter((function(field){var dataType=field.dataType;return dataType===dataTypes.LOOKUP&&"tenant"===_this3.$getProperty(field,"lookupModule.name","")}))},getVendorFields:function(fields){var _this4=this;return fields.filter((function(field){var dataType=field.dataType;return dataType===dataTypes.LOOKUP&&"vendors"===_this4.$getProperty(field,"lookupModule.name","")}))},getSupportedFields:function(){var _arguments2=arguments,_this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var fields,peopleModuleId,_yield$API$get2,data,error,_data$meta,_data$meta2,_data$meta2$module,module,fieldsList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return fields=_arguments2.length>0&&void 0!==_arguments2[0]?_arguments2[0]:[],peopleModuleId=null,_context4.next=4,api/* API */.bl.get("/module/meta",{moduleName:"people"});case 4:return _yield$API$get2=_context4.sent,data=_yield$API$get2.data,error=_yield$API$get2.error,error||(_data$meta=data.meta,_data$meta2=void 0===_data$meta?{}:_data$meta,_data$meta2$module=_data$meta2.module,module=void 0===_data$meta2$module?{}:_data$meta2$module,module&&(peopleModuleId=module["moduleId"])),fieldsList=fields.filter((function(field){var isPeopleField=!1;if(peopleModuleId){var extendedModuleIds=_this5.$getProperty(field,"lookupModule.extendedModuleIds",[]),moduleId=_this5.$getProperty(field,"lookupModule.moduleId",null);isPeopleField=peopleModuleId===moduleId||extendedModuleIds.some((function(id){return id===peopleModuleId}))}var lookupModuleName=_this5.$getProperty(field,"lookupModule.name","");return field.dataType===dataTypes.LOOKUP&&(["users","tenant"].includes(lookupModuleName)||isPeopleField)})),_context4.abrupt("return",fieldsList);case 10:case"end":return _context4.stop()}}),_callee4)})))()}}},new_SurveyRespondentvue_type_script_lang_js=SurveyRespondentvue_type_script_lang_js,SurveyRespondent_component=(0,componentNormalizer/* default */.Z)(new_SurveyRespondentvue_type_script_lang_js,SurveyRespondentvue_type_template_id_78473e16_scoped_true_render,SurveyRespondentvue_type_template_id_78473e16_scoped_true_staticRenderFns,!1,null,"78473e16",null)
/* harmony default export */,SurveyRespondent=SurveyRespondent_component.exports,SurveyCustomizationvue_type_template_id_1bb8013d_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"section-header survey-header-color",attrs:{id:"surveyCustomization-header"}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_customization"))+" ")]),_c("div",{staticClass:"pL50 customization-block"},[_c("el-form",{ref:"customizationForm",staticClass:"pT10 pB30",attrs:{model:_vm.customization,"label-width":"350px","label-position":"left"}},[_c("div",{staticClass:"section-container flex-container"},[_c("div",{staticClass:"form-one-column"},[_c("el-form-item",{attrs:{label:_vm.$t("survey.unanswered_survey_expiry"),prop:"expiryDay"}},[_c("el-select",{staticClass:"fc-input-full-border2 width50",attrs:{placeholder:"Choose Days"},model:{value:_vm.customization.expiryDay,callback:function($$v){_vm.$set(_vm.customization,"expiryDay",$$v)},expression:"customization.expiryDay"}},_vm._l(_vm.dayOptions,(function(key,label){return _c("el-option",{key:key,attrs:{label:label,value:key}})})),1)],1)],1),_c("div",{staticClass:"form-one-column"},[_c("el-form-item",{attrs:{label:_vm.$t("survey.configure_whether_retake_survey"),prop:"isRetakeAllowed"}},[_c("el-radio-group",{staticClass:"fc-visitor-radio",model:{value:_vm.customization.isRetakeAllowed,callback:function($$v){_vm.$set(_vm.customization,"isRetakeAllowed",$$v)},expression:"customization.isRetakeAllowed"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:!0}},[_vm._v(" "+_vm._s(_vm.$t("common.products.yes")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:!1}},[_vm._v(" "+_vm._s(_vm.$t("common.products._no")))])],1)],1)],1),_vm.customization.isRetakeAllowed?_c("div",{staticClass:"form-one-column"},[_c("el-form-item",{attrs:{label:_vm.$t("survey.display_retake_option"),prop:"retakeExpiryDay"}},[_c("el-select",{staticClass:"fc-input-full-border2 width50",attrs:{placeholder:"Choose Days"},model:{value:_vm.customization.retakeExpiryDay,callback:function($$v){_vm.$set(_vm.customization,"retakeExpiryDay",$$v)},expression:"customization.retakeExpiryDay"}},_vm._l(_vm.dayOptions,(function(key,label){return _c("el-option",{key:key,attrs:{label:label,value:key}})})),1)],1)],1):_vm._e()])])],1)])},SurveyCustomizationvue_type_template_id_1bb8013d_scoped_true_staticRenderFns=[],SurveyCustomizationvue_type_script_lang_js={name:"Survey-Customization",props:["selectedSurvey"],data:function(){return{customization:{isRetakeAllowed:!1,retakeExpiryDay:3,expiryDay:3},dayOptions:{"1 Day":1,"2 Days":2,"3 Days":3,"4 Days":4,"5 Days":5,"6 Days":6,"7 Days":7,"8 Days":8,"9 Days":9,"10 Days":10}}},watch:{selectedSurvey:{handler:function(newVal){(0,validation/* isEmpty */.xb)(newVal)||this.prefillSurveyCustomization()},immediate:!0}},methods:{prefillSurveyCustomization:function(){var selectedSurvey=this.selectedSurvey;if(!(0,validation/* isEmpty */.xb)(selectedSurvey)){var _ref=selectedSurvey||{},workflowRule=_ref.workflowRule,_ref2=workflowRule||{},actions=_ref2.actions,isRetakeAllowed=this.$getProperty(actions,"0.template.isRetakeAllowed",null),retakeExpiryDay=this.$getProperty(actions,"0.template.retakeExpiryDay",null),expiryDay=this.$getProperty(actions,"0.template.expiryDay",null),surveyDetails={isRetakeAllowed:isRetakeAllowed,retakeExpiryDay:retakeExpiryDay,expiryDay:expiryDay};this.$set(this,"customization",surveyDetails)}},serialize:function(){var customization=this.customization;return customization}}},new_SurveyCustomizationvue_type_script_lang_js=SurveyCustomizationvue_type_script_lang_js,SurveyCustomization_component=(0,componentNormalizer/* default */.Z)(new_SurveyCustomizationvue_type_script_lang_js,SurveyCustomizationvue_type_template_id_1bb8013d_scoped_true_render,SurveyCustomizationvue_type_template_id_1bb8013d_scoped_true_staticRenderFns,!1,null,"1bb8013d",null)
/* harmony default export */,SurveyCustomization=SurveyCustomization_component.exports,SurveyActionsvue_type_template_id_aae92898_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"section-header survey-header-color",attrs:{id:"surveyActions-header"}},[_vm._v(" "+_vm._s(_vm.$t("survey.survey_actions"))+" ")]),_c("div",{staticClass:"pL50 pT10 pB30 el-form pR0 survey-action-block"},[_c("SurveyActionConfig",{ref:"create-action-config",staticClass:"mT15 mB20 mR15",attrs:{module:_vm.moduleName,configuredActions:_vm.executeCreateActions,actionsHash:_vm.actionsHash,supportedActions:_vm.supportedActions,hideAction:_vm.hideCreateAction},on:{"update:hideAction":function($event){_vm.hideCreateAction=$event},"update:hide-action":function($event){_vm.hideCreateAction=$event},enableAction:_vm.enableCreationAction,disableAction:_vm.disableCreateAction},scopedSlots:_vm._u([{key:"header",fn:function(){return[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("survey.specify_action_when_survey_triggered"))+" ")])]},proxy:!0}])}),_c("SurveyActionConfig",{ref:"respondent-action-config",staticClass:"mT15 mB20 mR15",attrs:{configuredActions:_vm.executeResponseActions,module:_vm.moduleName,actionsHash:_vm.actionsHash,supportedActions:_vm.supportedActions,hideAction:_vm.hideResponseAction},on:{"update:hideAction":function($event){_vm.hideResponseAction=$event},"update:hide-action":function($event){_vm.hideResponseAction=$event},enableAction:_vm.enableResponseAction,disableAction:_vm.disableResponseAction},scopedSlots:_vm._u([{key:"header",fn:function(){return[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("survey.specify_action_when_survey_taken"))+" ")])]},proxy:!0}])})],1)])},SurveyActionsvue_type_template_id_aae92898_staticRenderFns=[],SurveyActionConfigvue_type_template_id_e3088f42_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"actions-config mB20 survey-action-config"},[_c("el-row",{staticClass:"mB10 flex-middle"},[_c("el-col",{attrs:{span:18}},[_vm._t("header")],2),_vm.hideAction?_vm._e():_c("el-col",{attrs:{span:6}},[_c("el-dropdown",{staticClass:"fR",attrs:{"hide-on-click":"",trigger:"click"},on:{command:_vm.addAction}},[_c("div",{staticClass:"f13 add-action-color"},[_c("fc-icon",{staticClass:"pointer vertical-middle add-icon-style",attrs:{group:"action",name:"circle-plus",color:"#23b096"}}),_vm._v(" "+_vm._s(_vm.$t("survey.add_action"))+" ")],1),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},_vm._l(_vm.supportedActions,(function(action,index){return _c("el-dropdown-item",{key:"actiontype-"+index,attrs:{command:_vm.getActionParam(action)}},[_vm._v(" "+_vm._s(_vm.getActionLabel(action))+" ")])})),1)],1)],1)],1),_vm.$validation.isEmpty(_vm.actionsList)?_c("el-row",{staticClass:"action-row no-hover"},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"details-heading"},[_vm._v(_vm._s(_vm.$t("survey.no_actions_configured")))])])],1):_vm._e(),_vm.isEmailConfi?_c("el-row",{staticClass:"action-row"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"details-heading"},[_vm._v(_vm._s(_vm.$t("survey.send_email")))])]),_c("el-col",{staticClass:"pT4 text-right",attrs:{span:12}},[_c("span",{staticClass:"configured-green"},[_vm._v(_vm._s(_vm.$t("survey.configured")))]),_vm.isEmailConfi?_c("span",{staticClass:"mL20 action-edit-section"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"default",name:"edit-text",title:_vm.$t("survey.edit_mail"),size:"15"},on:{click:function($event){return _vm.editAction(_vm.emailContext)}}}),_c("span",{staticClass:"mL20 reset-txt pointer",on:{click:function($event){return _vm.reset("mail")}}},[_vm._v(_vm._s(_vm.$t("survey.reset")))])],1):_vm._e()])],1):_vm._e(),_vm.isSmsConfi?_c("el-row",{staticClass:"action-row"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"details-heading"},[_vm._v(_vm._s(_vm.$t("survey.send_sms")))])]),_c("el-col",{staticClass:"pT4 text-right",attrs:{span:12}},[_c("span",{staticClass:"configured-green"},[_vm._v(_vm._s(_vm.$t("survey.configured")))]),_vm.isSmsConfi?_c("span",{staticClass:"mL20 action-edit-section"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"default",name:"edit-text",title:_vm.$t("survey.edit_Sms"),size:"15"},on:{click:function($event){return _vm.editAction(_vm.smsContent)}}}),_c("span",{staticClass:"mL20 reset-txt pointer",on:{click:function($event){return _vm.reset("sms")}}},[_vm._v(_vm._s(_vm.$t("survey.reset")))])],1):_vm._e()])],1):_vm._e(),_vm.isMobileConfig?_c("el-row",{staticClass:"action-row"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"details-heading"},[_vm._v(" "+_vm._s(_vm.$t("survey.send_mobile_notification"))+" ")])]),_c("el-col",{staticClass:"pT4 text-right",attrs:{span:12}},[_c("span",{staticClass:"configured-green"},[_vm._v(_vm._s(_vm.$t("survey.configured")))]),_vm.isMobileConfig?_c("span",{staticClass:"mL20 action-edit-section"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"default",name:"edit-text",title:_vm.$t("survey.edit_Mobile"),size:"15"},on:{click:function($event){return _vm.editAction(_vm.mobileContent)}}}),_c("span",{staticClass:"mL20 reset-txt pointer",on:{click:function($event){return _vm.reset("mobile")}}},[_vm._v(_vm._s(_vm.$t("survey.reset")))])],1):_vm._e()])],1):_vm._e(),_vm.isFieldConfi?_c("el-row",{staticClass:"action-row"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"details-heading"},[_vm._v(_vm._s(_vm.$t("survey.field_update")))])]),_c("el-col",{staticClass:"pT4 text-right",attrs:{span:12}},[_c("span",{staticClass:"configured-green"},[_vm._v(_vm._s(_vm.$t("survey.configured")))]),_vm.isFieldConfi?_c("span",{staticClass:"mL20 action-edit-section"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"default",name:"edit-text",title:_vm.$t("survey.edit_Field"),size:"15"},on:{click:function($event){return _vm.editAction(_vm.fieldContext)}}}),_c("span",{staticClass:"mL20 reset-txt pointer",on:{click:function($event){return _vm.reset("fieldChange")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.reset"))+" ")])],1):_vm._e()])],1):_vm._e(),_vm.isScriptConfi?_c("el-row",{staticClass:"action-row"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"details-Heading"},[_vm._v(_vm._s(_vm.$t("survey.execute_script")))])]),_c("el-col",{staticClass:"pT4 text-right",attrs:{span:12}},[_c("span",{staticClass:"configured-green"},[_vm._v(_vm._s(_vm.$t("survey.configured")))]),_vm.isScriptConfi?_c("span",{staticClass:"mL20 action-edit-section"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"default",name:"edit-text",title:_vm.$t("survey.edit_script"),size:"15"},on:{click:function($event){return _vm.editAction(_vm.scriptData)}}}),_c("span",{staticClass:"mL20 reset-txt pointer",on:{click:function($event){return _vm.reset("script")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.reset"))+" ")])],1):_vm._e()])],1):_vm._e(),_vm.isStatusConfig?_c("el-row",{staticClass:"action-row"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"details-heading"},[_vm._v(_vm._s(_vm.$t("survey.change_status")))])]),_c("el-col",{staticClass:"pT4 text-right",attrs:{span:12}},[_c("span",{staticClass:"configured-green"},[_vm._v(_vm._s(_vm.$t("survey.configured")))]),_vm.isStatusConfig?_c("span",{staticClass:"mL20 action-edit-section"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"default",name:"edit-text",title:_vm.$t("survey.edit_status"),size:"15"},on:{click:function($event){return _vm.editAction(_vm.changeStatus)}}}),_c("span",{staticClass:"mL20 reset-txt pointer",on:{click:function($event){return _vm.reset("changeStatus")}}},[_vm._v(" "+_vm._s(_vm.$t("survey.reset"))+" ")])],1):_vm._e()])],1):_vm._e(),_c("send-notification",{ref:"notificationpage",staticClass:"ruleDialog",attrs:{visibility:_vm.actionEdit,mode:_vm.actionMode,option:_vm.actionData,module:_vm.module},on:{onsave:_vm.actionSave,"update:visibility":function($event){_vm.actionEdit=$event},"update:mode":function($event){_vm.actionMode=$event},"update:option":function($event){_vm.actionData=$event}}}),_vm.fieldUpdateValue?_c("field-update-dialog",{attrs:{statusFieldName:_vm.statusFieldName,fieldChange:_vm.fieldChange,moduleFields:_vm.moduleFields,module:_vm.module,picklistOptions:_vm.picklistOptions,addRow:_vm.addRow,actionSave:_vm.actionSave,fieldUpdateValue:_vm.fieldUpdateValue},on:{"update:fieldUpdateValue":function($event){_vm.fieldUpdateValue=$event},"update:field-update-value":function($event){_vm.fieldUpdateValue=$event}}}):_vm._e(),_vm.openStatusDialog?_c("change-status-dialog",{attrs:{changeStatus:_vm.changeStatus,module:_vm.module,actionSave:_vm.actionSave,closeDialog:_vm.closeDialog}}):_vm._e(),_vm.showScriptDialog?_c("ScriptDialog",{attrs:{actionObj:_vm.scriptData,moduleName:_vm.module},on:{onSave:_vm.actionSave,onClose:function($event){_vm.showScriptDialog=!1}}}):_vm._e()],1)},SurveyActionConfigvue_type_template_id_e3088f42_scoped_true_staticRenderFns=[],ActionConfig=(__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(662624)),actionTypeHash={EMAIL:3,SMS:4,MOBILE:7,FIELD:13,STATUS:19,SCRIPT:21},SurveyActionConfigvue_type_script_lang_js={extends:ActionConfig/* default */.Z,props:["module","moduleFields","configuredActions","actionsHash","supportedActions","hideAction"],methods:{actionSave:function(dataObj){var actions=this.getActions(),data=this.$helpers.cloneObject(dataObj),index=actions.findIndex((function(d){return d.actionType===data.actionType}));-1!==index&&actions.splice(index,1),data.actionType===actionTypeHash.EMAIL?(this.isEmailConfi=!0,this.emailContext=data,this.$emit("disableAction",!0)):data.actionType===actionTypeHash.SMS?(this.isSmsConfi=!0,this.smsContent=data):data.actionType===actionTypeHash.MOBILE?(this.isMobileConfig=!0,this.formatMobileData(data.templateJson),this.mobileContent=data):data.actionType===actionTypeHash.FIELD?(this.fieldUpdateValue=!1,this.fieldContext=data,this.isFieldConfi=!0):data.actionType===actionTypeHash.STATUS?(this.openStatusDialog=!1,this.changeStatus=data,this.isStatusConfig=!0):data.actionType===actionTypeHash.SCRIPT&&(this.showScriptDialog=!1,this.isScriptConfi=!0,this.scriptData=data||{}),this.addModuleParam(data),actions.push(data),this.actionEdit=!1},reset:function(action){var actions=this.getActions();if("sms"===action){var idx=actions.findIndex((function(d){return d.actionType===actionTypeHash.SMS}));actions.splice(idx,1),this.smsContent="",this.isSmsConfi=!1}else if("mail"===action){var _idx=actions.findIndex((function(d){return d.actionType===actionTypeHash.EMAIL}));actions.splice(_idx,1),this.emailContext="",this.isEmailConfi=!1,_idx>=0&&this.hideAction&&this.$emit("enableAction",!0)}else if("mobile"===action){var _idx2=actions.findIndex((function(d){return d.actionType===actionTypeHash.MOBILE}));actions.splice(_idx2,1),this.mobileContent="",this.isMobileConfig=!1}else if("fieldChange"===action){var _idx3=actions.findIndex((function(d){return d.actionType===actionTypeHash.FIELD}));actions.splice(_idx3,1),this.isFieldConfi=!1}else if("changeStatus"===action){var _idx4=actions.findIndex((function(d){return d.actionType===actionTypeHash.STATUS}));actions.splice(_idx4,1),this.isStatusConfig=!1}else if("script"===action){var _idx5=actions.findIndex((function(d){return d.actionType===actionTypeHash.SCRIPT}));actions.splice(_idx5,1),this.isScriptConfi=!1,this.scriptData=null}},getActionParam:function(action){var actionsHash=this.actionsHash;return this.$getProperty(actionsHash,"".concat(action,".actionParam"),"")},getActionLabel:function(action){var actionsHash=this.actionsHash;return actionsHash[action]&&this.$getProperty(actionsHash,"".concat(action,".label"),"")}}},survey_SurveyActionConfigvue_type_script_lang_js=SurveyActionConfigvue_type_script_lang_js,SurveyActionConfig_component=(0,componentNormalizer/* default */.Z)(survey_SurveyActionConfigvue_type_script_lang_js,SurveyActionConfigvue_type_template_id_e3088f42_scoped_true_render,SurveyActionConfigvue_type_template_id_e3088f42_scoped_true_staticRenderFns,!1,null,"e3088f42",null)
/* harmony default export */,SurveyActionConfig=SurveyActionConfig_component.exports,actionsHash={email:{label:"Send Email",actionParam:"mail"}},SurveyActionsvue_type_script_lang_js={name:"SurveyActions",components:{SurveyActionConfig:SurveyActionConfig},props:["selectedSurvey"],data:function(){return{executeResponseActions:[],executeCreateActions:[],actionsHash:actionsHash,hideCreateAction:!0,hideResponseAction:!0}},created:function(){this.prefillActions(),this.hideActionButton()},computed:{moduleName:function(){return"surveyResponse"},supportedActions:function(){var actions=["email"];return actions}},watch:{selectedSurvey:{handler:function(newVal){(0,validation/* isEmpty */.xb)(newVal)||this.prefillActions()},immediate:!0}},methods:{enableCreationAction:function(){this.hideCreateAction=!1},enableResponseAction:function(){this.hideResponseAction=!1},disableCreateAction:function(){this.hideCreateAction=!0},disableResponseAction:function(){this.hideResponseAction=!0},prefillActions:function(){var selectedSurvey=this.selectedSurvey;if(!(0,validation/* isEmpty */.xb)(selectedSurvey)){var _ref=selectedSurvey||{},_ref$executeResponseA=_ref.executeResponseActions,executeResponseActions=void 0===_ref$executeResponseA?[]:_ref$executeResponseA,_ref$executeCreateAct=_ref.executeCreateActions,executeCreateActions=void 0===_ref$executeCreateAct?[]:_ref$executeCreateAct;this.$set(this,"executeResponseActions",executeResponseActions),this.$set(this,"executeCreateActions",executeCreateActions)}},hideActionButton:function(){var executeCreateActions=this.executeCreateActions,executeResponseActions=this.executeResponseActions;this.hideCreateAction=(executeCreateActions||[]).length>0,this.hideResponseAction=(executeResponseActions||[]).length>0},serialize:function(){var executeResponseActions=this.executeResponseActions,executeCreateActions=this.executeCreateActions;return executeCreateActions=this.$refs["create-action-config"].serialize(),executeResponseActions=this.$refs["respondent-action-config"].serialize(),{executeResponseActions:executeResponseActions,executeCreateActions:executeCreateActions}}}},new_SurveyActionsvue_type_script_lang_js=SurveyActionsvue_type_script_lang_js,SurveyActions_component=(0,componentNormalizer/* default */.Z)(new_SurveyActionsvue_type_script_lang_js,SurveyActionsvue_type_template_id_aae92898_render,SurveyActionsvue_type_template_id_aae92898_staticRenderFns,!1,null,null,null)
/* harmony default export */,SurveyActions=SurveyActions_component.exports,SidebarScrollMixin=__webpack_require__(565476),AlarmRuleCreation=__webpack_require__(145306),Spinner=__webpack_require__(604947),NewSurveyvue_type_script_lang_js={name:"New-Survey",props:["id","moduleName"],mixins:[SidebarScrollMixin/* default */.Z],extends:[AlarmRuleCreation["default"]],components:{SurveyBasicDetails:SurveyBasicDetails,SurveyRespondent:SurveyRespondent,SurveyCustomization:SurveyCustomization,SurveyActions:SurveyActions,AsyncButton:AsyncButton/* default */.Z,Spinner:Spinner/* default */.Z},mounted:function(){this.$nextTick(this.registerScrollHandler)},data:function(){return{isLoading:!0,hasChanged:!1,sectionResponses:{},selectedSurvey:{},policyTitle:"Survey",rootElementForScroll:".scroll-container",sidebarElements:["#surveyBasicDetails-link","#surveyRespondent-link","#surveyCustomization-link","#surveyActions-link"],sectionElements:["#surveyBasicDetails-section","#surveyRespondent-section","#surveyCustomization-section","#surveyActions-section"],actionObj:{actionType:3,templateJson:{}},data:{rule:{name:"",scheduleType:3,description:"",ruleType:46,event:{moduleName:"workorder",activityType:3},dateFieldId:null,time:null,interval:null,fields:[],criteria:{},siteId:null,actions:[{actionType:36,templateJson:{isRetakeAllowed:!0,retakeExpiryDay:null,expiryDay:null,qandaTemplateId:null}}]}},moduleFields:[]}},created:function(){this.fetchMetaFields(),this.fetchSurveyDetails()},computed:{isNew:function(){return(0,validation/* isEmpty */.xb)(this.id)},ruleId:function(){return parseInt(this.$route.params.id)}},methods:{goBack:function(){this.$router.push({name:"survey.list",moduleName:this.moduleName})},fetchSurveyDetails:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var isNew,ruleId,params,_yield$API$get,error,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this.isLoading=!0,isNew=_this.isNew,ruleId=_this.ruleId,isNew){_context.next=10;break}return params={workFlowRuleId:ruleId},_context.next=6,api/* API */.bl.get("v2/setup/survey/fetch",params);case 6:_yield$API$get=_context.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?_this.$message.error(error.message||"Error Occured"):(0,validation/* isEmpty */.xb)(data)||(_this.selectedSurvey=data||{});case 10:_this.isLoading=!1;case 11:case"end":return _context.stop()}}),_callee)})))()},save:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var isNew,basicDetails,respondentDetails,customizationDetails,actions,isValidSurvey,promise,params,_yield$promise,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(isNew=_this2.isNew,basicDetails=_this2.$refs["surveyBasicDetails-section"].serialize(),respondentDetails=_this2.$refs["surveyRespondent-section"].serialize(),customizationDetails=_this2.$refs["surveyCustomization-section"].serialize(),actions=_this2.$refs["surveyActions-section"].serialize(),_this2.sectionResponses=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},basicDetails),respondentDetails),{},{customizationDetails:customizationDetails},actions),_this2.sectionResponses=_this2.serializeSurvey(_this2.sectionResponses),isValidSurvey=_this2.validateSurvey(_this2.sectionResponses),!isValidSurvey){_context2.next=26;break}if(params=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},_this2.sectionResponses),{},{moduleName:"workorder"}),isNew){_context2.next=16;break}return _context2.next=13,api/* API */.bl.post("v2/setup/survey/edit",params);case 13:promise=_context2.sent,_context2.next=19;break;case 16:return _context2.next=18,api/* API */.bl.post("v2/setup/survey/add",params);case 18:promise=_context2.sent;case 19:return _context2.next=21,promise;case 21:_yield$promise=_context2.sent,error=_yield$promise.error,error?_this2.$message.error(error.message||"Error Occured"):(isNew?_this2.$message.success("Survey created successfully!"):_this2.$message.success("Survey updated successfully!"),_this2.$router.push({name:"survey.list",moduleName:_this2.moduleName})),_context2.next=27;break;case 26:_this2.$message.error("Please fill all mandatory fields");case 27:case"end":return _context2.stop()}}),_callee2)})))()},validateSurvey:function(survey){var validSurvey=!0,_ref=survey||{},rule=_ref.rule,_ref2=rule||{},name=_ref2.name,actions=_ref2.actions,criteria=_ref2.criteria,_ref3=actions[0]||{},templateJson=_ref3.templateJson,_ref4=templateJson||{},qandaTemplateId=_ref4.qandaTemplateId,sharingType=_ref4.sharingType,expiryDay=_ref4.expiryDay,retakeExpiryDay=_ref4.retakeExpiryDay,userId=_ref4.userId,fieldId=_ref4.fieldId,isRetakeAllowed=_ref4.isRetakeAllowed,mandatoryFields={name:name,qandaTemplateId:qandaTemplateId,sharingType:sharingType,expiryDay:expiryDay,criteria:criteria};return isRetakeAllowed&&(mandatoryFields=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},mandatoryFields),{},{retakeExpiryDay:retakeExpiryDay})),mandatoryFields=1===sharingType&&(0,validation/* isEmpty */.xb)(fieldId)?(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},mandatoryFields),{},{userId:userId}):(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},mandatoryFields),{},{fieldId:fieldId}),validSurvey=Object.values(mandatoryFields).every((function(value){return!(0,validation/* isEmpty */.xb)(value)})),validSurvey},serializeSurvey:function(survey){var data=this.data,isNew=this.isNew,ruleId=this.ruleId,_ref5=data||{},rule=_ref5.rule,_ref6=rule||{},actions=_ref6.actions,_ref7=actions[0]||{},templateJson=_ref7.templateJson,_ref8=survey||{},name=_ref8.name,description=_ref8.description,criteria=_ref8.criteria,qandaTemplateId=_ref8.qandaTemplateId,executeResponseActions=_ref8.executeResponseActions,executeCreateActions=_ref8.executeCreateActions,customizationDetails=_ref8.customizationDetails,siteId=_ref8.siteId,sharingType=_ref8.sharingType,userId=_ref8.userId,fieldId=_ref8.fieldId,event=_ref8.event,fields=_ref8.fields,interval=_ref8.interval,dateFieldId=_ref8.dateFieldId,replaceableFields={name:name,description:description,siteId:siteId,event:event,fields:fields,interval:interval,dateFieldId:dateFieldId};if(Object.entries(replaceableFields).forEach((function(_ref9){var _ref10=(0,slicedToArray/* default */.Z)(_ref9,2),key=_ref10[0],value=_ref10[1];Object.prototype.hasOwnProperty.call(rule,"".concat(key))&&(rule[key]=value)})),(0,validation/* isEmpty */.xb)(rule)||(0,validation/* isEmpty */.xb)(actions)||(templateJson=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},templateJson),customizationDetails),this.$set(rule,"criteria",criteria),this.$set(actions[0],"templateJson",templateJson),this.$set(actions[0].templateJson,"qandaTemplateId",qandaTemplateId),this.$set(actions[0].templateJson,"sharingType",sharingType),1===sharingType&&(0,validation/* isEmpty */.xb)(fieldId)?this.$set(actions[0].templateJson,"userId",userId):this.$set(actions[0].templateJson,"fieldId",fieldId)),isNew)survey={executeResponseActions:executeResponseActions,executeCreateActions:executeCreateActions};else{rule=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},rule),{},{id:ruleId});var serializedSurveyActions=this.serializeActions(survey);survey=(0,objectSpread2/* default */.Z)({},serializedSurveyActions)}return survey=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},survey),{},{rule:rule}),survey},serializeActions:function(survey){var _ref11=survey||{},executeResponseActions=_ref11.executeResponseActions,executeCreateActions=_ref11.executeCreateActions,_ref12=executeCreateActions[0]||{},_ref12$templateJson=_ref12.templateJson,createTemplate=void 0===_ref12$templateJson?{}:_ref12$templateJson,_ref13=executeResponseActions[0]||{},_ref13$templateJson=_ref13.templateJson,responseTemplate=void 0===_ref13$templateJson?{}:_ref13$templateJson,serializedCreateAction={actionType:3,templateJson:createTemplate},serializedResponseAction={actionType:3,templateJson:responseTemplate};
//handling only for email actions  hence actions[0]
return{executeCreateActions:(0,validation/* isEmpty */.xb)(createTemplate)?[]:[serializedCreateAction],executeResponseActions:(0,validation/* isEmpty */.xb)(responseTemplate)?[]:[serializedResponseAction]}},fetchMetaFields:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$API$get2,error,data,fields;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,api/* API */.bl.get("/module/metafields",{moduleName:_this3.moduleName});case 2:_yield$API$get2=_context3.sent,error=_yield$API$get2.error,data=_yield$API$get2.data,error||(fields=_this3.$getProperty(data,"meta.fields",[])||[],_this3.moduleFields=fields.filter((function(field){return"TASKS"!==field.displayTypeEnum}))||[]);case 6:case"end":return _context3.stop()}}),_callee3)})))()}}},survey_NewSurveyvue_type_script_lang_js=NewSurveyvue_type_script_lang_js,NewSurvey_component=(0,componentNormalizer/* default */.Z)(survey_NewSurveyvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,NewSurvey=NewSurvey_component.exports},
/***/353654:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"d7f1f315aba97cd14240ee6f3d34465f.svg";
/***/},
/***/385769:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"4a9843791f38c4a28fdf9f0a4584780d.svg";
/***/},
/***/581121:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"88cd7135ef1417b08c9498c51d2cda59.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/72520.js.map