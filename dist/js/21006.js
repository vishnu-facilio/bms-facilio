"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[21006],{
/***/268141:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return Commissioning}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/commissioning/Commissioning.vue?vue&type=template&id=ce91470e
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"full-layout-white height100 user-layout width100"},[_vm._m(0),_c("div",{staticClass:"container-scroll"},[_c("div",{staticClass:"row setting-Rlayout"},[_c("div",{staticClass:"col-lg-12 col-md-12"},[_c("div",{staticClass:"commissioning-tab-container mT20"},[_c("controller-filter",{attrs:{loading:_vm.loading},on:{"update:loading":function($event){_vm.loading=$event},onControllerSelected:_vm.onControllerSelected}},[_c("el-col",{staticClass:"flRight commission-tool-right",attrs:{span:8}},["mapped"===_vm.selectedTab&&_vm.canSubscribe?_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{disabled:!_vm.selectedInstanceIds.length,type:"primary",loading:_vm.subscribing},on:{click:_vm.onSubscribeClicked}},[_vm._v(_vm._s(_vm.subscribing?"Subscribing...":"Subscribe")+" ")]):"subscribed"===_vm.selectedTab?_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{disabled:!_vm.selectedInstanceIds.length,type:"primary",loading:_vm.unsubscribing},on:{click:_vm.unsubscribe}},[_vm._v(_vm._s(_vm.unsubscribing?"Unsubscribing...":"Unsubscribe")+" ")]):_vm._e(),"mapped"===_vm.selectedTab||"notmapped"===_vm.selectedTab?_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{type:"primary"},on:{click:function($event){return _vm.mapInstance()}}},[_vm._v("SAVE")]):_vm._e()],1),"mapped"===_vm.selectedTab||"notmapped"===_vm.selectedTab?_c("el-col",{staticClass:"flRight commission-tool-right",attrs:{span:24}},[_c("div",[_c("el-popover",{attrs:{placement:"right",width:"300",trigger:"click","popper-class":"commission-popover",title:"Map Asset"},on:{show:_vm.onPopoverShow},model:{value:_vm.poptab,callback:function($$v){_vm.poptab=$$v},expression:"poptab"}},[_c("div",{staticClass:"height250 pL10 pR10"},[_c("div",{},[_c("div",{staticClass:"fc-dark-grey-txt14 mB10"},[_vm._v("Category")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",clearable:"",placeholder:"Category"},on:{change:_vm.onBulkCategoryChange},model:{value:_vm.updateBulk.categoryId,callback:function($$v){_vm.$set(_vm.updateBulk,"categoryId",$$v)},expression:"updateBulk.categoryId"}},_vm._l(_vm.assetCategories,(function(category,idx){return _c("el-option",{key:idx,attrs:{label:category.displayName,value:category.id}})})),1)],1),_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-dark-grey-txt14 mB10"},[_vm._v("Asset")])]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{clearable:"",filterable:"",placeholder:"Asset"},model:{value:_vm.updateBulk.assetId,callback:function($$v){_vm.$set(_vm.updateBulk,"assetId",$$v)},expression:"updateBulk.assetId"}},_vm._l(_vm.assets[this.updateBulk.categoryId],(function(asset){return _c("el-option",{key:asset.id,attrs:{label:asset.name,value:asset.id}})})),1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_vm._t("footer",(function(){return[_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",attrs:{type:"primary"},on:{click:_vm.cancel}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.updateCategoryAndAsset}},[_vm._v(_vm._s("SAVE")+" ")])],1)]}))],2),_vm.selectedInstanceIds.length?_c("el-button",{staticClass:"fc-btn-pink-medium-fill mL20",attrs:{slot:"reference",size:"mini"},on:{click:function($event){_vm.poptab=!0}},slot:"reference"},[_vm._v("MAP ASSET")]):_vm._e()],1)],1),_c("div",[_c("el-popover",{attrs:{placement:"right",width:"300",trigger:"click","popper-class":"commission-popover",title:"Map Readings"},on:{show:_vm.onPopoverShow},model:{value:_vm.showBulkReadings,callback:function($$v){_vm.showBulkReadings=$$v},expression:"showBulkReadings"}},[_c("div",{staticClass:"height250 pL10 pR10"},[_c("div",{},[_c("div",{staticClass:"fc-dark-grey-txt14 mB10"},[_vm._v("Category")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",clearable:"",placeholder:"Category"},on:{change:_vm.onBulkCategoryChange},model:{value:_vm.updateBulk.categoryId,callback:function($$v){_vm.$set(_vm.updateBulk,"categoryId",$$v)},expression:"updateBulk.categoryId"}},_vm._l(_vm.assetCategories,(function(category,idx){return _c("el-option",{key:idx,attrs:{label:category.displayName,value:category.id}})})),1)],1),_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-dark-grey-txt14 mB10"},[_vm._v("Readings")])]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",placeholder:"Select Reading"},model:{value:_vm.updateBulk.fieldId,callback:function($$v){_vm.$set(_vm.updateBulk,"fieldId",$$v)},expression:"updateBulk.fieldId"}},_vm._l(_vm.readingMap[_vm.updateBulk.categoryId]||[],(function(reading){return _c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.readingMap[_vm.updateBulk.categoryId],expression:"readingMap[updateBulk.categoryId]"}],key:reading.fieldId,attrs:{label:reading.displayName,value:reading.fieldId}})})),1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_vm._t("footer",(function(){return[_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",attrs:{type:"primary"},on:{click:_vm.cancel}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.updateCategoryAndReading}},[_vm._v(_vm._s("SAVE")+" ")])],1)]}))],2),_vm.selectedInstanceIds.length?_c("el-button",{staticClass:"fc-btn-pink-medium-fill mL10",attrs:{slot:"reference",size:"mini"},on:{click:function($event){_vm.showBulkReadings=!0}},slot:"reference"},[_vm._v("MAP READINGS")]):_vm._e()],1)],1)]):_vm._e()],1),_c("div",{staticClass:"fR commissioning-search-pagination",style:{top:!_vm.selectedInstanceIds.length||"mapped"!==_vm.selectedTab&&"notmapped"!==_vm.selectedTab?"150px":"192px"}},[_c("div",{staticClass:"inline mR20"},[_vm.showQuickSearches?_c("div",{staticClass:"row",staticStyle:{"margin-right":"20px"}},[_c("div",{staticClass:"fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper fc-list-search-wrapper-reading relative"},[_c("svg",{staticClass:"search-icon3",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 32 32"}},[_c("title",[_vm._v("search")]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQueries,expression:"quickSearchQueries"}],ref:"quickSearchQueries",staticClass:"quick-search-input6",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQueries},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.quickSearches()},input:function($event){$event.target.composing||(_vm.quickSearchQueries=$event.target.value)}}}),_c("svg",{staticClass:"close-icon6",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.closeSearches}},[_c("title",[_vm._v("close")]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_vm._e(),_c("div",{directives:[{name:"show",rawName:"v-show",value:!_vm.showQuickSearches,expression:"!showQuickSearches"}],staticClass:"pointer text-right search-show-hide",on:{click:_vm.toggleQuickSearches}},[_vm._m(1)])]),_c("pagination",{ref:"f-page",staticClass:"inline",attrs:{total:_vm.listCount,perPage:_vm.perPage}})],1),_c("el-tabs",{staticClass:"pT20",on:{"tab-click":_vm.onTabChange},model:{value:_vm.selectedTab,callback:function($$v){_vm.selectedTab=$$v},expression:"selectedTab"}},_vm._l(_vm.tabs,(function(tab){return _c("el-tab-pane",{key:tab.key,attrs:{label:tab.label,name:tab.key}},[_c("v-infinite-scroll",{staticStyle:{"max-height":"80vh","overflow-y":"scroll"},attrs:{offset:20}},[_c("table",{staticClass:"setting-list-view-table instance-mapping"},["subscribed"===_vm.selectedTab?_c("thead",[_c("tr",[_c("th",{staticStyle:{width:"5%",padding:"15px 30px"}},[_c("el-checkbox",{attrs:{value:_vm.selectedInstanceIds.length&&_vm.selectedInstanceIds.length===_vm.instances.filter((function(instance){return 2!==instance.subscribeStatus})).length},on:{change:_vm.toggleSelectAll}})],1),_c("th",{staticClass:"setting-table-th setting-th-text ellipsis",staticStyle:{width:"160px"}},[_vm._v(" INSTANCE NAME ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" INSTANCE NUMBER ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" INSTANCE TYPE ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" ADDED TIME ")]),_vm.canSubscribe?_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" SUBSCRIBE STATUS ")]):_vm._e()])]):_c("thead",[_c("tr",[(_vm.selectedTab,_vm.canSubscribe,_c("th",{staticStyle:{width:"5%",padding:"15px 30px"}},[_c("el-checkbox",{attrs:{value:_vm.selectedInstanceIds.length&&_vm.selectedInstanceIds.length===_vm.instances.filter((function(instance){return 2!==instance.subscribeStatus})).length},on:{change:_vm.toggleSelectAll}})],1)),_c("th",{staticClass:"setting-table-th setting-th-text ellipsis",staticStyle:{width:"160px"}},[_vm._v(" INSTANCE ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" CATEGORY ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" ASSET ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" READING ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" INPUT UNIT ")]),"mapped"===_vm.selectedTab&&_vm.canSubscribe?_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" SUBSCRIBE STATUS ")]):_vm._e()])]),_vm.loading?_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1)])]):_vm.instances.length?"subscribed"===_vm.selectedTab?_c("tbody",_vm._l(_vm.instances,(function(instance){return _c("tr",{directives:[{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"},{name:"show",rawName:"v-show",value:!_vm.quickSearchQueries||instance.instance.toLowerCase().includes(_vm.quickSearchQueries.toLowerCase()),expression:"\n                          !quickSearchQueries ||\n                            instance.instance\n                              .toLowerCase()\n                              .includes(quickSearchQueries.toLowerCase())\n                        "}],key:instance.id,staticClass:"tablerow"},[_c("td",{staticClass:"text-center"},[_c("el-checkbox",{attrs:{disabled:2===instance.subscribeStatus,value:_vm.selectedInstanceIds.indexOf(instance.id)>=0},on:{change:function($event){return _vm.toggleSelection(instance.id)}}})],1),_c("td",[_vm._v(_vm._s(instance.instance))]),_c("td",[_vm._v(_vm._s(instance.objectInstanceNumber))]),_c("td",[_vm._v(_vm._s(_vm._f("pascalCase")(instance.instanceTypeVal)))]),_c("td",[_vm._v(_vm._s(_vm._f("formatDate")(instance.createdTime)))]),_vm.canSubscribe?_c("td",[_vm._v(" "+_vm._s(_vm.$constants.SUBSCRIBE_STATUS[instance.subscribeStatus])+" ")]):_vm._e()])})),0):_c("tbody",_vm._l(_vm.instances,(function(instance,idx){return _c("tr",{key:idx,staticClass:"tablerow"},[(_vm.selectedTab,_vm.canSubscribe,_c("td",{staticClass:"text-center"},[_c("el-checkbox",{attrs:{disabled:"notmapped"!==_vm.selectedTab&&2===instance.subscribeStatus,value:_vm.selectedInstanceIds.indexOf(instance.id)>=0},on:{change:function($event){return _vm.toggleSelection(instance.id)}}})],1)),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"min-width180px"},[_c("div",{staticClass:"label-txt3-14"},[_vm._v(" "+_vm._s(instance.instance)+" ")]),_c("div",{staticClass:"label-txt3-12"},[_vm._v(" "+_vm._s(instance.device)+" ")])])]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width160px",attrs:{filterable:"",placeholder:"Select Category"},on:{change:function($event){return _vm.onCategoryChanged(instance)}},model:{value:instance.categoryId,callback:function($$v){_vm.$set(instance,"categoryId",$$v)},expression:"instance.categoryId"}},_vm._l(_vm.assetCategories,(function(category,idx){return _c("el-option",{key:idx,attrs:{label:category.displayName,value:category.id}})})),1)],1)]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width160px",attrs:{placeholder:"Select Asset",filterable:""},on:{change:function($event){return _vm.onAssetChanged(instance)}},model:{value:instance.resourceId,callback:function($$v){_vm.$set(instance,"resourceId",$$v)},expression:"instance.resourceId"}},_vm._l(_vm.assets[instance.categoryId],(function(asset){return _c("el-option",{key:asset.id,attrs:{label:asset.name,value:asset.id}})})),1)],1)]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px flex-middle"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width160px",attrs:{filterable:"",placeholder:"Select Reading"},on:{change:function($event){return _vm.fieldupdate(instance)}},model:{value:instance.fieldId,callback:function($$v){_vm.$set(instance,"fieldId",$$v)},expression:"instance.fieldId"}},_vm._l(_vm.readingMap[instance.categoryId]||[],(function(reading){return _c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.readingMap[instance.categoryId],expression:"readingMap[instance.categoryId]"}],key:instance.instance+reading.fieldId,attrs:{label:reading.displayName,value:reading.fieldId}})})),1),_c("div",{directives:[{name:"show",rawName:"v-show",value:instance.resourceId>0,expression:"instance.resourceId > 0"},{name:"tippy",rawName:"v-tippy"}],staticClass:"actions inline pointer mL10",attrs:{title:"Add Reading"},on:{click:function($event){return _vm.showAddReading(instance.resourceId,instance.categoryId)}}},[_c("i",{staticClass:"el-icon-plus"})]),instance.resourceId>0&&instance.fieldId&&instance.rdmId&&_vm.readingMap[instance.categoryId]&&_vm.readingMap[instance.categoryId][instance.fieldId]&&[4,8].includes(_vm.readingMap[instance.categoryId][instance.fieldId].dataType)?_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"actions inline pointer mL10",attrs:{title:"Set Values"},on:{click:function($event){return _vm.showInputReadingDialog(instance)}}},[_c("i",{staticClass:"el-icon-edit-outline"})]):_vm._e()],1)]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px"},[instance.fieldId&&_vm.isMetricAvailable(instance.categoryId,instance.fieldId)?_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"130px"},attrs:{placeholder:instance.defaultUnit,filterable:""},on:{change:function($event){return _vm.updateUnit($event,instance.resourceId,instance.fieldId)}},model:{value:instance.unit,callback:function($$v){_vm.$set(instance,"unit",$$v)},expression:"instance.unit"}},_vm._l(_vm.metricsUnits.metricWithUnits[_vm.readingMap[instance.categoryId][instance.fieldId].metricEnum._name],(function(unit,index){return _c("el-option",{key:index,attrs:{value:unit.unitId,label:unit.symbol}},[_c("span",{domProps:{innerHTML:_vm._s(unit.displayName+(unit.symbol?" ("+unit.symbol+")":""))}})])})),1):_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"130px"},model:{value:instance.temp,callback:function($$v){_vm.$set(instance,"temp",$$v)},expression:"instance.temp"}})],1)]),_c("td",{staticClass:"expand-content-th"},["notmapped"!==_vm.selectedTab?_c("div",{staticClass:"width200px"},[_vm._v(" "+_vm._s(_vm.$constants.SUBSCRIBE_STATUS[instance.subscribeStatus]||"Not Subscribed")+" ")]):_vm._e()])])})),0):_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center pT20 pB20",attrs:{colspan:"100%"}},[_vm._v(" No instances available ")])])])])])],1)})),1)],1)])])])]),_vm.showAddReadingDialog?_c("new-asset-reading-dialog",{attrs:{visibility:_vm.showAddReadingDialog,hideFormula:"true",categoryId:_vm.selectedCategoryId},on:{"update:visibility":function($event){_vm.showAddReadingDialog=$event},saved:function($event){return _vm.loadReadings(_vm.selectedAssetId,!0)}}}):_vm._e(),_vm.showThresholdDialog?_c("f-dialog",{attrs:{visible:_vm.showThresholdDialog,title:"Set Threshold Values",width:"50%",maxHeight:"500px",customClass:"threshold-value-dialog",confirmTitle:"Subscribe",stayOnSave:!0},on:{"update:visible":function($event){_vm.showThresholdDialog=$event},save:_vm.subscribe}},[_c("div",{staticClass:"pT10 pB10"},[_c("el-row",{staticClass:"pB20 threshold-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:6}},[_vm._v("Name")]),_c("el-col",{attrs:{span:6}},[_vm._v("Operator")]),_c("el-col",{attrs:{span:6}},[_vm._v("Threshold")]),_c("el-col",{attrs:{span:6}},[_vm._v("Step Count")])],1),_vm._l(_vm.selectedInstances.filter((function(inst){return![3,4,5].includes(inst.instanceType)})),(function(instance){return _c("el-row",{key:instance.id,staticClass:"pB20 threshold-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:6}},[_vm._v(_vm._s(instance.instance))]),_c("el-col",{attrs:{span:6}},[_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"130px"},model:{value:instance.operatorValue,callback:function($$v){_vm.$set(instance,"operatorValue",$$v)},expression:"instance.operatorValue"}},_vm._l(_vm.options,(function(item){return _c("el-option",{key:item.value,attrs:{label:item.label,value:item.value}})})),1)],1),10===instance.operatorValue?_c("el-col",{attrs:{span:6}},[_c("el-input",{staticClass:"el-input-textbox-full-border",attrs:{type:"number",min:5},model:{value:instance.threshold,callback:function($$v){_vm.$set(instance,"threshold",$$v)},expression:"instance.threshold"}},[_c("template",{slot:"append"},[_vm._v("(%)")])],2)],1):_c("el-col",{attrs:{span:6}},[_c("el-input",{staticClass:"el-input-textbox-full-border",attrs:{type:"number",min:5},model:{value:instance.threshold,callback:function($$v){_vm.$set(instance,"threshold",$$v)},expression:"instance.threshold"}})],1),_c("el-col",{attrs:{span:6}},[_c("el-input",{staticClass:"el-input-textbox-full-border",attrs:{type:"number",min:5},model:{value:instance.stepCountVal,callback:function($$v){_vm.$set(instance,"stepCountVal",$$v)},expression:"instance.stepCountVal"}})],1)],1)}))],2)]):_vm._e(),_vm.showInputDialog?_c("f-dialog",{attrs:{visible:_vm.showInputDialog,title:"Set Input Values",width:"30%",maxHeight:"500px",customClass:"input-value-dialog"},on:{"update:visible":function($event){_vm.showInputDialog=$event},save:_vm.setInputValue}},[4===_vm.selectedReading.dataType?_c("div",{staticClass:"pT10 pB10"},[_c("el-row",{staticClass:"pB20 input-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(_vm.selectedReading.trueVal||"True"))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",model:{value:_vm.selectedInputValues[1],callback:function($$v){_vm.$set(_vm.selectedInputValues,1,$$v)},expression:"selectedInputValues[1]"}})],1)],1),_c("el-row",{staticClass:"pB20 input-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(_vm.selectedReading.falseVal||"False"))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",model:{value:_vm.selectedInputValues[0],callback:function($$v){_vm.$set(_vm.selectedInputValues,0,$$v)},expression:"selectedInputValues[0]"}})],1)],1)],1):_c("div",{staticClass:"pT10 pB10"},_vm._l(_vm.selectedReading.enumMap,(function(label,idx){return _c("el-row",{key:idx,staticClass:"pB20 input-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(label))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",model:{value:_vm.selectedInputValues[idx],callback:function($$v){_vm.$set(_vm.selectedInputValues,idx,$$v)},expression:"selectedInputValues[idx]"}})],1)],1)})),1)]):_vm._e()],1)},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"setting-header"},[_c("div",{staticClass:"setting-title-block"},[_c("div",{staticClass:"setting-form-title"},[_vm._v("Commissioning")]),_c("div",{staticClass:"heading-description"},[_vm._v(" List of all the devices that are to be mapped ")])])])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("span",{},[_c("i",{staticClass:"fa fa-search",staticStyle:{"font-size":"14px"},attrs:{"aria-hidden":"true"}})])}],createForOfIteratorHelper=__webpack_require__(566347),NewAssetReadingDialog=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(450886),__webpack_require__(670560),__webpack_require__(162506),__webpack_require__(947522),__webpack_require__(425728),__webpack_require__(648324),__webpack_require__(434284),__webpack_require__(188881)),v_infinite_scroll=__webpack_require__(561364),v_infinite_scroll_default=__webpack_require__.n(v_infinite_scroll),FPagination=__webpack_require__(929593),FDialogNew=__webpack_require__(436756),FormMixin=__webpack_require__(674811),ControllerFilter=__webpack_require__(199029),validation=__webpack_require__(990260),Commissioningvue_type_script_lang_js={mixins:[FormMixin/* default */.Z],title:function(){return"Commissioning"},data:function(){return{updateBulk:{categoryId:null,assetId:null,fieldId:null,assetLoading:!1,readingLoading:!1},points:[],poptab:!1,showBulkReadings:!1,listCount:null,selectedController:null,assetReadingFields:[],quickSearchQueries:null,showQuickSearches:!1,selectedInstanceIds:[],loading:!1,instances:[],assets:{},metricsUnits:{},readingMap:{},showAddReadingDialog:!1,selectedTab:"notmapped",subscribing:!1,unsubscribing:!1,selectedAssetId:null,selectedCategoryId:null,tabs:[{key:"notmapped",label:this.$t("setup.controller.notmapped")},{key:"mapped",label:this.$t("setup.controller.mapped")}],showInputDialog:!1,selectedReading:null,selectedInputValues:{},selectedRdm:null,quickSearchQuery:null,showThresholdDialog:!1,canSubscribe:!1,options:[{value:5,label:"Greater than"},{value:6,label:"Less than"},{value:7,label:"Greater than or equals"},{value:8,label:"Less than or equals"},{value:9,label:"Equals"},{value:10,label:"Precentage"}],value:-1}},components:{NewAssetReadingDialog:NewAssetReadingDialog/* default */.Z,VInfiniteScroll:v_infinite_scroll_default(),Pagination:FPagination/* default */.Z,FDialog:FDialogNew/* default */.Z,ControllerFilter:ControllerFilter/* default */.Z},created:function(){this.$store.dispatch("loadAssetCategory")},computed:{assetCategories:function(){return this.$store.state.assetCategory},page:function(){return this.$route.query.page||1},perPage:function(){return"notmapped"===this.selectedTab?100:25},selectedInstances:function(){var _this=this;return this.instances&&this.selectedInstanceIds?this.instances.filter((function(inst){return _this.selectedInstanceIds.includes(inst.id)})):[]}},mounted:function(){this.loadDefaultMetricUnits()},watch:{page:function(newVal,oldVal){oldVal===newVal||this.loading||this.loadInstances(!0)}},methods:{cancel:function(){this.showBulkReadings=!1,this.poptab=!1},onPopoverShow:function(){var categoryId=this.selectedInstances[0].categoryId,isAllCategorySame=this.selectedInstances.reduce((function(a,b){return a===b?a:b})).categoryId===categoryId;this.updateBulk.categoryId=isAllCategorySame?categoryId:null,this.updateBulk.assetId=null,this.updateBulk.fieldId=null},fieldupdate:function(instance){this.$set(instance,"inputValues",null),this.$set(instance,"rdmId",null),this.addPoint(instance);var field=this.readingMap[instance.categoryId][instance.fieldId];field&&field.metricEnum&&this.setDefaultUnit(field.metricEnum._name,instance)},updateCategoryAndAsset:function(){if(this.updateBulk.assetId){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.selectedInstances);try{for(_iterator.s();!(_step=_iterator.n()).done;){var instance=_step.value;this.$set(instance,"resourceId",this.updateBulk.assetId),instance.categoryId&&instance.categoryId!==this.updateBulk.categoryId&&this.$set(instance,"fieldId",null),this.$set(instance,"categoryId",this.updateBulk.categoryId),this.addPoint(instance)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}this.poptab=!1,this.selectedInstanceIds=[]},updateCategoryAndReading:function(){if(this.updateBulk.fieldId){var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(this.selectedInstances);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var instance=_step2.value;this.$set(instance,"fieldId",this.updateBulk.fieldId),instance.categoryId&&instance.categoryId!==this.updateBulk.categoryId&&this.$set(instance,"resourceId",null),this.$set(instance,"categoryId",this.updateBulk.categoryId),this.fieldupdate(instance)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}this.showBulkReadings=!1,this.selectedInstanceIds=[]},quickSearches:function(){var string=this.quickSearchQueries;string&&this.loadInstances()},toggleQuickSearches:function(){var _this2=this;this.showQuickSearches=!this.showQuickSearches,this.showQuickSearches&&this.$nextTick((function(){_this2.$refs.quickSearchQueries.focus()}))},closeSearches:function(){this.toggleQuickSearches(),this.quickSearchQueries=null,this.loadInstances(),this.quickSearches()},toggleSelectAll:function(val){this.selectedInstanceIds=val?this.instances.filter((function(instance){return 2!==instance.subscribeStatus})).map((function(instance){return instance.id})):[]},toggleSelection:function(instance){var idx=this.selectedInstanceIds.indexOf(instance);-1===idx?this.selectedInstanceIds.push(instance):this.selectedInstanceIds.splice(idx,1)},onSubscribeClicked:function(){var booleanInstances=this.selectedInstances.filter((function(inst){return[3,4,5].includes(inst.instanceType)}));booleanInstances.length===this.selectedInstances.length?this.subscribe():this.showThresholdDialog=!0},initSubscribe:function(){if(this.$common.isBacnetController(this.selectedController)||3===this.selectedController.controllerType){var isSub=this.tabs.filter((function(d){return"subscribed"===d.key}));!isSub.length>0&&this.tabs.push({key:"subscribed",label:"Subscribed"}),this.canSubscribe=this.$helpers.isLicenseEnabled("CONTROL_ACTIONS")}else this.tabs.splice(2,1),this.canSubscribe=!1},loadInstancesCount:function(){var _this3=this;if(!(0,validation/* isEmpty */.xb)(this.selectedController)){var url="/v2/instances/count";this.loadData(url,!0).then((function(response){response.data.result.instances&&(_this3.listCount=response.data.result.instances[0].count)}))}},loadData:function(url,count){return"mapped"===this.selectedTab?url+="?configured=true&fetchMapped=true":"subscribed"===this.selectedTab?url+="?subscribed=true&fetchMapped=true":url+="?configured=true&fetchMapped=false",this.quickSearchQueries&&(url+="&search="+this.quickSearchQueries),url+=count?"&controllerId="+this.selectedController.id:"&perPage="+this.perPage+"&page="+this.page,this.$http.get(url)},loadInstances:function(fetchMore){var _this4=this;this.instances=[],(!fetchMore||this.quickSearchQueries&&1===this.page)&&(this.listCount=0,this.$refs["f-page"].reset(),this.loadInstancesCount()),this.loading=!0,this.loadData("/v2/instances/"+this.selectedController.id).then((function(response){0===response.data.responseCode&&(_this4.selectedInstanceIds=[],response.data.result.instances&&(_this4.instances=response.data.result.instances||[],_this4.instances.forEach((function(instance){var reading;response.data.result.readings&&(reading=response.data.result.readings.find((function(reading){return instance.resourceId===reading.resourceId&&instance.fieldId===reading.fieldId}))),instance.categoryId&&(_this4.loadAssets(instance.categoryId),_this4.loadReadings(instance.categoryId),"mapped"===_this4.selectedTab&&reading.field&&_this4.setDefaultUnit(reading.field.metricEnum,instance)),_this4.setRDMValues(reading,instance)})))),_this4.loading=!1})).catch((function(_){_this4.loading=!1}))},setRDMValues:function(reading,instance){reading&&(reading.unit>0&&this.$set(instance,"unit",reading.unit),reading.inputValues&&this.$set(instance,"inputValues",reading.inputValues),this.$set(instance,"rdmId",reading.id))},setDefaultUnit:function(fieldMetric,instance){if(fieldMetric){var orgUnit=this.metricsUnits.orgUnitsList.find((function(d){return fieldMetric===d.metricEnum._name}));orgUnit&&orgUnit.unitEnum&&(instance.defaultUnit=orgUnit.unitEnum.symbol)}},subscribe:function(){var _this5=this;if(this.validateThreshold()){this.showThresholdDialog=!1,this.subscribing=!0;var instances=this.selectedInstances.map((function(instance){var inst={id:instance.id};return instance.threshold&&(inst.thresholdJson=JSON.stringify({operator:instance.operatorValue,threshold:instance.threshold,stepCount:instance.stepCountVal})),inst}));this.$http.post("/v2/instances/subscribe",{instances:instances,controllerId:this.selectedController.id}).then((function(response){_this5.subscribing=!1,0===response.data.responseCode?(_this5.$message.success("Points will be subscribed in a while"),_this5.toggleSelectAll(!1)):_this5.$message.error(response.data.message)})).catch((function(_){_this5.subscribing=!1}))}},unsubscribe:function(){var _this6=this;this.$dialog.confirm({title:"Unsubscribe Instance",htmlMessage:"Are you sure you want to unsubscribe selected instance(s)?",rbDanger:!0,rbLabel:"Proceed"}).then((function(value){value&&(_this6.unsubscribing=!0,_this6.$http.post("/v2/instances/unsubscribe",{ids:_this6.selectedInstanceIds,controllerId:_this6.selectedController.id}).then((function(response){_this6.unsubscribing=!1,0===response.data.responseCode?(_this6.$message.success("Points will be unsubscribed in a while"),_this6.instances=_this6.instances.filter((function(instance){return!_this6.selectedInstanceIds.includes(instance.id)})),_this6.toggleSelectAll(!1)):_this6.$message.error(response.data.message)})).catch((function(_){_this6.unsubscribing=!1})))}))},validateThreshold:function(){var lessThreshold=this.selectedInstances.some((function(inst){return![3,4,5].includes(inst.instanceType)&&10===inst.operatorValue&&(!inst.threshold||inst.threshold<5)}));return!lessThreshold||(this.$message.error("The difference should be greater than or equal to 5 percentage"),!1)},onBulkCategoryChange:function(categoryId){this.loadAssets(categoryId),this.loadReadings(categoryId)},onCategoryChanged:function(instance){this.$set(instance,"resourceId",null),this.$set(instance,"fieldId",null),this.$set(instance,"unit",null),this.$set(instance,"inputValues",null),this.$set(instance,"rdmId",null),this.loadAssets(instance.categoryId),this.loadReadings(instance.categoryId),this.addPoint(instance)},onAssetChanged:function(instance){this.addPoint(instance)},addPoint:function(instance){this.points.find((function(point){return point.id===instance.id}))||this.points.push(instance)},loadAssets:function(categoryId){var _this7=this;return this.assets[categoryId]?this.assets[categoryId]:(this.$set(this.assets,categoryId,[]),this.$util.loadAsset({categoryId:categoryId,selectFields:["name"]}).then((function(response){_this7.$set(_this7.assets,categoryId,(response.assets||[]).map((function(asset){return{name:asset.name,id:asset.id}})))})))},getAsset:function(assetId){var asset;for(var categoryId in this.assets)asset||(asset=this.assets[categoryId].find((function(casset){return casset.id===assetId})));return asset},loadReadings:function(categoryId,fetchNew){var _this8=this;return!fetchNew&&this.readingMap[categoryId]?Promise.resolve():(this.$set(this.readingMap,categoryId,{}),this.$util.loadAssetReadingFields(null,categoryId,!1).then((function(readings){_this8.setReadingMap(readings,categoryId)})))},setReadingMap:function(readings,categoryId){var _this9=this;readings&&readings.forEach((function(reading){_this9.readingMap[categoryId]||_this9.$set(_this9.readingMap,categoryId,{}),_this9.$set(_this9.readingMap[categoryId],reading.fieldId,reading)}))},mapInstance:function(){var _this10=this;this.loading=!0;var points=this.points;
//if (this.selectedTab !== 'notmapped') {
points=this.points.filter((function(point){return point.resourceId&&point.fieldId})),
//}
this.$http.post("/v2/instances/map",{controllerId:this.selectedController.id,instances:points}).then((function(response){0!==response.data.responseCode?(_this10.loading=!1,_this10.$message.error(response.data.message)):(_this10.$message.success("Readings mapped Successfully"),_this10.points=[],_this10.loadInstances())}))},loadDefaultMetricUnits:function(){var _this11=this;this.$http.get("/units/getDefaultMetricUnits").then((function(response){_this11.metricsUnits=response.data||{}}))},isMetricAvailable:function(categoryId,fieldId){if(this.readingMap[categoryId]){var reading=this.readingMap[categoryId][fieldId];return reading&&reading.metricEnum}},updateUnit:function(unit,resourceId,fieldId){var _this12=this;this.$http.post("/v2/reading/update",{readingDataMeta:{resourceId:resourceId,fieldId:fieldId,unit:unit}}).then((function(response){0!==response.data.responseCode&&_this12.$message.error(response.data.message)}))},showAddReading:function(resourceId,categoryId){this.selectedAssetId=resourceId,this.selectedCategoryId=categoryId,this.showAddReadingDialog=!0},showInputReadingDialog:function(instance){var reading=this.readingMap[instance.categoryId][instance.fieldId];if(this.showInputDialog=!0,this.selectedReading=reading,this.selectedInputValues={},this.selectedRdm=instance.rdmId,instance.inputValues)this.selectedInputValues=this.$helpers.cloneObject(instance.inputValues);else if(4===reading.dataType)this.$set(this.selectedInputValues,[0],"0"),this.$set(this.selectedInputValues,[1],"1");else if(8===reading.dataType)for(var idx in reading.enumMap)this.$set(this.selectedInputValues,idx,idx+"")},setInputValue:function(){var _this13=this,values=[];for(var idx in this.selectedInputValues)(this.selectedInputValues[idx]||0===this.selectedInputValues[idx])&&values.push({idx:idx,inputValue:this.selectedInputValues[idx]});this.$http.post("/v2/reading/setinputvalue",{readingId:this.selectedRdm,inputValues:values}).then((function(response){if(0!==response.data.responseCode)_this13.$message.error(response.data.message);else{_this13.$message.success("Values set successfully");var instance=_this13.getInstanceFromReading(_this13.selectedReading);_this13.$set(instance,"inputValues",_this13.inputValues)}}))},
// Getting instance based on rdm value
getInstanceFromReading:function(reading){return this.instances.find((function(inst){return inst.resourceId===reading.resourceId&&inst.fieldId===reading.fieldId}))},onControllerSelected:function(controller){this.selectedController=controller,this.initSubscribe(),this.loadInstances(),this.points=[]},onTabChange:function(){this.points=[],this.loadInstances()}}},commissioning_Commissioningvue_type_script_lang_js=Commissioningvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(commissioning_Commissioningvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,Commissioning=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/21006.js.map