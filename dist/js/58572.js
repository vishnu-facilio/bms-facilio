"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[58572,2372],{
/***/502372:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return SmartMap}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/widget/cards/v2/SmartMap.vue?vue&type=template&id=65806a10
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"dragabale-card height100"},[_vm.loading?_c("shimmer-loading",{staticClass:"map-shimmer"}):_c("div",{staticClass:"height100"},[_c("div",{staticClass:"map-select-box"},[_c("el-select",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"db-filter fc-tag",attrs:{filterable:"",clearable:"","collapse-tags":"",placeholder:"Sites"},on:{change:_vm.applyFilter,clear:_vm.clearFilters},model:{value:_vm.selectedSite,callback:function($$v){_vm.selectedSite=$$v},expression:"selectedSite"}},_vm._l(_vm.sites,(function(site,index){return _c("el-option",{key:index,attrs:{label:site.name,value:site.id}})})),1)],1),_vm.assets&&_vm.assets.length?_c("f-map",{attrs:{markers:_vm.assets,categoryId:_vm.assetCategoryID,category:_vm.assetCategory}}):_vm._e()],1)],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),DashboardFilters=(__webpack_require__(169358),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(450886),__webpack_require__(947522),__webpack_require__(879288),__webpack_require__(670560),__webpack_require__(425728),__webpack_require__(865137),__webpack_require__(648324),__webpack_require__(506319)),DateHelper=__webpack_require__(281230),ShimmerLoading=__webpack_require__(516400),FMAPMixin=__webpack_require__(964509),FMapvue_type_template_id_097f1a05_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"smartmap"},[_vm.mapLoading?_c("div",{staticClass:"mapLoading"},[_c("div",{staticClass:"map-loading-content"},[_vm._v(" Loading... ")])]):_vm._e(),_c("gmap-map",{ref:"mapnew",attrs:{center:_vm.center,zoom:8,options:_vm.mapOptions},on:{click:function($event){return _vm.getMapClickEvent()}}},[_vm.isClicked?_c("gmap-info-window",{attrs:{options:{pixelOffset:{width:-0,height:-40}},position:_vm.currentMarker.location}},[[_c("div",{staticClass:"smartmap-info-window"},[_c("div",{staticClass:"am-header row p15 border-bottom2 pT10 pB10 f12 pB0"},[_c("div",{staticClass:"col-6 text-left bold"},[_vm._v("ASSET DETAIL")]),_c("div",{staticClass:"col-6 text-right"},[_c("i",{staticClass:"el-icon-close pointer f13 bold",on:{click:function($event){_vm.isClicked=!1}}})])]),_c("div",{staticClass:"am-info-row row p15"},[_c("div",{staticClass:"am-info-label  col-4"},[_c("div",{staticClass:"height100"},[_vm.currentMarker.avatarUrl?_c("img",{staticClass:"default-img",attrs:{src:_vm.currentMarker.avatarUrl}}):_c("div",{staticClass:"default-img"})])]),_c("div",{staticClass:"am-info-label  col-8 pL10"},[_c("div",{staticClass:"am-id text-left"},[_vm._v("#"+_vm._s(_vm.currentMarker.id))]),_c("div",{staticClass:"am-label am-subject text-left"},[_vm._v(" "+_vm._s(_vm.currentMarker.name)+" ")]),_c("div",{staticClass:"label-txt-black text-left"},[_vm._v(" "+_vm._s(_vm.currentMarker.category&&_vm.getAssetCategory(_vm.currentMarker.category.id)?_vm.getAssetCategory(_vm.currentMarker.category.id).displayName:"")+" ")])])]),_vm.currentMarker.hasOwnProperty("alarmCount")?[_vm.currentMarker.alarmCount.data&&_vm.currentMarker.alarmCount.data.length?_c("div",{staticClass:"am-info-row row p15 pB0"},[_c("div",{staticClass:"col-12 text-left pB15"},[_vm._v("ALARM DETAIL")]),_vm._l(_vm.currentMarker.alarmCount.data,(function(alarm,index){return[_c("div",{key:index+"1",staticClass:"col-6 am-label am-subject text-left"},[_vm._v(" "+_vm._s(_vm.getAlarmSeverity(alarm.severityId)?_vm.getAlarmSeverity(alarm.severityId).severity:"")+" ")]),_c("div",{key:index+"2",staticClass:"col-6 am-label am-subject text-left"},[_vm._v(" "+_vm._s(alarm.count)+" ")])]}))],2):_vm._e()]:_vm._e(),_c("div",{staticClass:"am-info-row row p15 pT10 pB10"},[_c("div",{staticClass:"col-12"},[_c("div",{staticClass:"mT10"},[_c("el-button",{staticClass:"plain",attrs:{size:"mini"},on:{click:function($event){return _vm.openAsset(_vm.currentMarker)}}},[_vm._v("Open Asset")])],1)])])],2)]],2):_vm._e(),_vm._l(_vm.markers,(function(d,index){return _c("gmap-marker",{key:index,staticClass:"gmarker",attrs:{position:d.location,clickable:!0,draggable:!1,options:_vm.getOptions(d),icon:_vm.getParentIcon(d)},on:{"update:position":function($event){return _vm.$set(d,"location",$event)},click:function($event){return _vm.openSiteWindow(d)}}})}))],2)],1)},FMapvue_type_template_id_097f1a05_staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),vuex_esm=(__webpack_require__(434284),__webpack_require__(634338),__webpack_require__(420629)),router=__webpack_require__(329435),FMapvue_type_script_lang_js={props:["mapheight","markers","categoryId","category"],mixins:[FMAPMixin/* default */.Z],data:function(){return{parentClicked:!1,mapLoading:!1,assetZoom:19,enableCluster:!0,currentMarker:{},currentParentMarker:{},assetAlarmCountData:[],isClicked:!1,ishoverd:!1,center:{lat:25.2048,lng:55.2708},assetsMarkers:[]}},created:function(){this.$store.dispatch("loadAssetCategory")},watch:{markers:function(data){if(data.length>1){var _step,bounds=new window.google.maps.LatLngBounds,_iterator=(0,createForOfIteratorHelper/* default */.Z)(data);try{for(_iterator.s();!(_step=_iterator.n()).done;){var m=_step.value;bounds.extend(m.location)}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.$refs.mapnew.fitBounds(bounds)}}},mounted:function(){if(this.markers.length>1){var self=this;setTimeout((function(){var _step2,bounds=new window.google.maps.LatLngBounds,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(self.markers);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var m=_step2.value;bounds.extend(m.location)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}self.$refs.mapnew.fitBounds(bounds)}),1e3)}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory","getAlarmSeverity"])),{},{mapOptions:function(){var theme=window.localStorage.getItem("theme");return theme&&"black"===theme?{gestureHandling:"cooperative",maxZoom:19,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]}:{gestureHandling:"cooperative",maxZoom:19}}}),methods:{openSiteWindow:function(data){this.isClicked=!0,this.currentMarker=data},fitBounds:function(markers){var self=this;setTimeout((function(){var _step3,bounds=new window.google.maps.LatLngBounds,_iterator3=(0,createForOfIteratorHelper/* default */.Z)(markers);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var m=_step3.value;bounds.extend(m.location)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}self.$refs.mapnew.fitBounds(bounds),self.mapLoading=!1,self.asset=!0}),100)},closeAllInfoWindow:function(){this.isClicked=!1,this.parentClicked=!1},findRoute:function(){if((0,router/* isWebTabsEnabled */.tj)()){var tabType=router/* tabTypes */.VF.CUSTOM,config={type:"portfolio"},_ref=(0,router/* findRouteForTab */.OD)(tabType,{config:config})||{},name=_ref.name;return name?this.$router.resolve({name:name}).href:null}return"/app/home/portfolio"},openAsset:function(_ref2){var site=_ref2.site,building=_ref2.building,parentPath=this.findRoute();parentPath&&this.$router.push({path:"".concat(parentPath,"/site/").concat(site,"/building/").concat(building)}),this.selectedAsset.asset=null},getParentIcon:function(data){if(data)return{url:data.markerUrl,scaledSize:data.marker?{width:50,height:50,f:"20px",b:"px"}:{width:80,height:80,f:"px",b:"px"},origin:(data.marker,{x:0,y:0}),content:""}},getOptions:function(data){if(data)return{pixelOffset:data.marker?{top:-0,bottom:-38}:{width:0,height:0}}}}},components_FMapvue_type_script_lang_js=FMapvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FMapvue_type_script_lang_js,FMapvue_type_template_id_097f1a05_render,FMapvue_type_template_id_097f1a05_staticRenderFns,!1,null,null,null)
/* harmony default export */,FMap=component.exports,d3=__webpack_require__(348727),SmartMapvue_type_script_lang_js={props:["widget","config"],mixins:[DateHelper/* default */.Z,DashboardFilters/* default */.Z,FMAPMixin/* default */.Z],data:function(){return{loading:!1,assets:[],sites:[],fullAssets:[],selectedSite:null,data:{typeName:"swimmingpool"},siteAlarmData:[]}},mounted:function(){this.getParams(),this.loadAssets(),this.loadSites()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategoryByName","getAlarmSeverity"])),{},{typeName:function(){return this.data&&Object.keys(this.data).length&&this.data.typeName?this.data.typeName:1},assetCategory:function(){return this.typeName?this.getAssetCategoryByName(this.typeName):this.getAssetCategoryByName("swimmingpool")},assetCategoryID:function(){return this.assetCategory&&this.assetCategory.id?this.assetCategory.id:null}}),components:{shimmerLoading:ShimmerLoading/* default */.Z,FMap:FMap},methods:{applyFilter:function(){var _this=this;this.assets=this.$helpers.cloneObject(this.fullAssets.filter((function(rt){return rt.siteId===_this.selectedSite})))},clearFilters:function(){this.assets=this.$helpers.cloneObject(this.fullAssets)},loadAssets:function(){var self=this;this.loading=!0;var url="/asset/all?filters=%7B%22category%22%3A%7B%22operatorId%22%3A36%2C%22value%22%3A%5B%22".concat(this.assetCategoryID,"%22%5D%7D%7D&moduleName=asset&includeParentFilter=true");self.$http.get(url).then((function(response){self.assets=response.data.assets.filter((function(rt){return null!==rt.geoLocation})),self.data.assetId&&(self.assets=self.assets.filter((function(rt){return rt.id===self.data.assetId}))),self.loadAssetData()}))},loadAssetData:function(){var self=this,url="/v2/maps/assetAlarm",params={ids:self.assets.map((function(rt){return rt.id})),readingModuleName:self.assets&&self.assets.length&&self.assets[0].moduleName||"energydata",readingFieldNames:["activePowerB"]};self.$http.post(url,params).then((function(response){response.data.result&&self.prepareAssetMarkers(response.data.result),self.loading=!1}))},loadSites:function(){var self=this;this.loading=!0;var url="/campus";self.$http.get(url).then((function(response){self.sites=response.data.records.filter((function(rt){return rt.location&&rt.location.lat&&null!==rt.location.lat&&rt.location.lng&&null!==rt.location.lng}))}))},prepareAssetMarkers:function(data){if(data){var self=this;if(data.assetAlarmCount){var assetCountMap=[],assetAlarmCount=data.assetAlarmCount;this.assets.forEach((function(rt){assetAlarmCount[rt.id]?(rt["alarmCount"]=self.formatAlarmdata(assetAlarmCount[rt.id]),rt.location={lat:Number(rt.geoLocation.split(",")[0]),lng:Number(rt.geoLocation.split(",")[1])},rt.count=rt["alarmCount"]?rt["alarmCount"].total:0,rt.color=rt["alarmCount"]?rt["alarmCount"].color:"#000"):(rt.location={lat:Number(rt.geoLocation.split(",")[0]),lng:Number(rt.geoLocation.split(",")[1])},rt.count=0,rt.color="#000"),assetCountMap.push(rt.count)}));var min=Math.min.apply(Math,assetCountMap),max=Math.max.apply(Math,assetCountMap),opacityScale=d3.scaleLinear().range([0,.5]).domain([min,max]);this.assets.forEach((function(rt){rt.opacity=opacityScale(rt.count)+.5,rt.markerUrl=self.getMapMarkers(rt,1)})),this.fullAssets=this.$helpers.cloneObject(this.assets)}}},formatAlarmdata:function(data){if(data.length){var count=0,maxSeverityId=0;return data.forEach((function(rt){count+=rt.count,rt.severityId>maxSeverityId&&(maxSeverityId=rt.severityId)})),{total:count,color:maxSeverityId?this.getAlarmSeverity(maxSeverityId).color:"#000",data:data}}return{total:0,color:"#000",data:[]}},pereparemapData:function(){var _this2=this,self=this;this.assets.forEach((function(rt){rt.count=_this2.siteAlarmData.find((function(rl){return rl.siteId===rt.siteId}))?_this2.siteAlarmData.find((function(rl){return rl.siteId===rt.siteId})).count:0,rt.color=_this2.siteAlarmData.find((function(rl){return rl.siteId===rt.siteId}))?_this2.siteAlarmData.find((function(rl){return rl.siteId===rt.siteId})).colorCode:"#000",rt.assetCount=_this2.siteAlarmData.find((function(rl){return rl.siteId===rt.siteId}))?_this2.siteAlarmData.find((function(rl){return rl.siteId===rt.siteId})).assetCount:0}));var i=1,opacity=.5/this.assets.length;this.assets=this.assets.sort((function(a,b){return a.count<b.count?-1:1})),this.assets.forEach((function(rt){rt.opacity=opacity*i+.5,rt.markerUrl=self.getMapMarkers(rt,1),i++}))},getParams:function(){this.widget.dataOptions.metaJson&&this.widget.dataOptions.metaJson.length?this.data=JSON.parse(this.widget.dataOptions.metaJson):this.widget.dataOptions.metaJson=JSON.stringify(this.data)}}},v2_SmartMapvue_type_script_lang_js=SmartMapvue_type_script_lang_js,SmartMap_component=(0,componentNormalizer/* default */.Z)(v2_SmartMapvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SmartMap=SmartMap_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/58572.js.map