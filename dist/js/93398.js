(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[93398],{
/***/993398:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return PlannedInventoryServices}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/jobplan/plannedInventory/PlannedInventoryServices.vue?vue&type=template&id=2d90c822&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"p30 white-bg-block"},[_c("div",{staticClass:"inline-flex"},[_c("div",{staticClass:"fc-v1-icon-bg"},[_c("InlineSvg",{attrs:{src:"svgs/service",iconClass:"icon icon-lg fill-white"}})],1),_c("div",{staticClass:"fc-black3-16 mL10 mT12"},[_vm._v(" "+_vm._s(_vm.$t("common.products.services"))+" ")])]),_c("div",{ref:"plannedServicesWidget",staticClass:"inventory-table pT20"},[_vm.plannedServicesloading?_c("table",{staticClass:"width100"},[_c("tr",[_c("td",{staticClass:"iTloading in-no-data",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:!0,size:"80"}})],1)])]):_c("table",{staticClass:"width100 inventory-table"},[_c("thead",[_c("tr",{staticClass:"border-top-none"},[_c("th",{staticClass:"border-top-none tool-header-sticky",staticStyle:{width:"30%"}},[_vm._v(" "+_vm._s(_vm.$t("common.products._service"))+" ")]),_c("th",{staticStyle:{width:"25%"}},[_vm._v(_vm._s(_vm.$t("common._common.description")))]),_c("th",{staticClass:"pR0 border-top-none"},[_vm._v(" "+_vm._s(_vm.$t("common._common._quantity"))+" ")]),_c("th",{staticClass:"text-right width130px border-top-none"},[_vm._v(" "+_vm._s(_vm.$t("common._common.duration_hr"))+" ")]),_c("th",{staticClass:"text-right border-top-none width130px pR20 pL20"},[_vm._v(" "+_vm._s(_vm.$t("common.header._price"))+" ")]),_c("th",{staticClass:"text-right worktool-cost-sticky border-top-none"},[_vm._v(" "+_vm._s(_vm.$t("common.tabs._cost"))+" ")]),_c("th",{staticClass:"width40px worktool-cost-edit-sticky border-top-none"})])]),_vm.plannedInventoryServices.length?_c("tbody",[_vm._l(_vm.plannedInventoryServices,(function(plannedInventoryService,index){return[_c("tr",{key:plannedInventoryService.id,staticClass:"border-top4 border-bottom9 visibility-visible-actions pointer"},[_c("td",{staticClass:"width180px"},[plannedInventoryService.id>-1?_c("div",{staticClass:"pL17"},[_c("div",[_vm._v(" "+_vm._s(_vm.$getProperty(plannedInventoryService,"service.name"))+" ")])]):_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"text"}},[_c("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{"line-height":"0px !important","font-size":"16px !important",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function($event){return _vm.addServices()}},slot:"suffix"})])],1),_c("td",{staticClass:"pL17"},[_vm._v(" "+_vm._s(_vm.$getProperty(plannedInventoryService,"service.description","---"))+" ")]),_c("td",[_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center pL20",attrs:{type:"number"},on:{change:function($event){return _vm.updateQuantity(plannedInventoryService)}},model:{value:plannedInventoryService.quantity,callback:function($$v){_vm.$set(plannedInventoryService,"quantity",$$v)},expression:"plannedInventoryService.quantity"}})],1),_c("td",[_vm.fixedDuration(plannedInventoryService)?_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center pL20",attrs:{type:"number",disabled:""},model:{value:plannedInventoryService.duration,callback:function($$v){_vm.$set(plannedInventoryService,"duration",$$v)},expression:"plannedInventoryService.duration"}}):_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center pL20",attrs:{type:"number"},on:{change:function($event){return _vm.updateDuration(plannedInventoryService)}},model:{value:plannedInventoryService.duration,callback:function($$v){_vm.$set(plannedInventoryService,"duration",$$v)},expression:"plannedInventoryService.duration"}})],1),_c("td",["---"!==_vm.getPrice(plannedInventoryService)?_c("currency",{staticClass:"text-right pR10",attrs:{value:_vm.getPrice(plannedInventoryService)}}):_c("div",{staticClass:"text-center"},[_vm._v(_vm._s("---"))])],1),_c("td",{staticClass:"text-right"},["---"!==_vm.totalCost(plannedInventoryService)?_c("currency",{attrs:{value:_vm.totalCost(plannedInventoryService)}}):_c("div",{staticClass:"text-center"},[_vm._v(_vm._s("---"))])],1),_c("td",{staticClass:"text-right"},[_c("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"el-icon-delete pointer inv-delet-icon visibility-hide-actions pR10 pL10",attrs:{"data-arrow":"true",title:_vm.$t("common.header.delete_service")},on:{click:function($event){return _vm.deletePlannedService(plannedInventoryService,index)}}})])])]}))],2):_c("tbody",[_c("tr",[_c("td",{staticClass:"inventory-td-selected pL20 pT10 pB10",on:{click:function($event){return _vm.addServices()}}},[_vm._v(" "+_vm._s(_vm.$t("common.header.add_service"))+" ")]),_c("td",{staticClass:"pL20"},[_vm._v(" "+_vm._s("---")+" ")]),_c("td",{staticClass:"pT10 pB10"},[_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center pL20",attrs:{placeholder:"",type:"number",disabled:""}})],1),_c("td",{staticClass:"pT10 pB10 text-right"},[_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center mR10",attrs:{placeholder:"",type:"number",disabled:""}})],1),_c("td",{staticClass:"pT10 pB10 fc-grey3-13 text-right"},[_c("currency",{attrs:{value:0}})],1),_c("td",{staticClass:"pT10 pB10 fc-grey3-13 text-right"},[_c("currency",{attrs:{value:0}})],1),_c("td",{staticClass:"pT10 pB10"})])])])]),_vm.plannedServicesloading?_vm._e():_c("div",{staticClass:"item-add"},[_c("div",{staticClass:"green-txt-13 fc-v1-add-txt pointer fL"},[_vm.plannedInventoryServices.length?_c("span",{staticClass:"mR20",on:{click:function($event){return _vm.addServices()}}},[_c("img",{attrs:{src:__webpack_require__(353654)}}),_vm._v(" "+_vm._s(_vm.$t("common.header.add_service"))+" ")]):_vm._e()]),_c("div",{staticClass:"fR inline-flex mR30"},[_c("div",{staticClass:"bold mR60"},[_vm._v(_vm._s(_vm.$t("common.header._total")))]),_c("div",{staticClass:"fc-black3-16 text-right bold pR7"},[_c("currency",{attrs:{value:_vm.servicesTotalCost}})],1)])]),_vm.showAddServicesDialog?_c("AddPlannedServices",{attrs:{moduleName:"jobPlanServices",jobPlanId:_vm.details.id,onClose:function(){return _vm.showAddServicesDialog=!1,_vm.getPlannedServices()}}}):_vm._e()],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),createForOfIteratorHelper=__webpack_require__(566347),InlineSvg=(__webpack_require__(897389),__webpack_require__(648324),__webpack_require__(162506),__webpack_require__(586166)),api=__webpack_require__(32284),AddPlannedServicesvue_type_template_id_951c1fea_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:!0,fullscreen:!1,open:"top","before-close":_vm.onClose,"custom-class":"fc-dialog-up Inventoryaddvaluedialog","append-to-body":!0}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(" "+_vm._s(_vm.$t("common.products.services_list"))+" ")])]),_c("div",{staticClass:"fc-inv-container-body"},[_vm.inventoryListLoading?_c("spinner",{staticClass:"flex-middle justify-content-center flex-direction-column",attrs:{show:_vm.inventoryListLoading,size:"80"}}):_c("table",{staticClass:"setting-list-view-table width100 invent-table-dialog"},[_vm.serviceList.length?_c("thead",[_c("th",{staticClass:"setting-table-th setting-th-text"}),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("common.products.name"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s("Buying Price ("+_vm.$currency+")")+" ")])]):_vm._e(),_vm.serviceList.length?_c("tbody",_vm._l(_vm.serviceList,(function(service){return _c("tr",{key:service.id,staticClass:"tablerow asset-hover-td"},[_c("td",{staticStyle:{width:"10%"}},[_c("el-checkbox",{model:{value:service.checked,callback:function($$v){_vm.$set(service,"checked",$$v)},expression:"service.checked"}})],1),_c("td",[_vm._v(_vm._s(service.name))]),_c("td",[_vm._v(_vm._s(service.buyingPrice||"---"))])])})),0):_c("tbody",[_c("tr",[_c("td",{attrs:{colspan:"100%"}},[_c("div",{staticClass:"flex-middle justify-content-center flex-direction-column"},[_c("inline-svg",{attrs:{src:"svgs/emptystate/inventory",iconClass:"icon text-center icon-100"}}),_c("div",{staticClass:"nowo-label f14 bold"},[_vm._v(" "+_vm._s(_vm.$t("common.products.no_services_present"))+" ")])],1)])])])])],1),_c("div",{staticClass:"modal-dialog-footer-parts-dialog"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.cancel()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",staticStyle:{"margin-left":"0px !important"},attrs:{type:"primary"},on:{click:function($event){return _vm.addService()}}},[_vm._v(_vm._s(_vm.$t("common._common._add")))])],1)])},AddPlannedServicesvue_type_template_id_951c1fea_staticRenderFns=[],defineProperty=__webpack_require__(482482),eventBus=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(450886),__webpack_require__(398011)),AddPlannedServicesvue_type_script_lang_js={name:"AddPlannedServices",props:["onClose","jobPlanId","moduleName","workOrderId"],data:function(){return{inventoryListLoading:!1,serviceList:[]}},created:function(){this.loadServices()},methods:{loadServices:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$fetchAll,list,error,_iterator,_step,inventory;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.inventoryListLoading=!0,_context.next=3,api/* API */.bl.fetchAll("service");case 3:if(_yield$API$fetchAll=_context.sent,list=_yield$API$fetchAll.list,error=_yield$API$fetchAll.error,!error){_context.next=11;break}return _this.$message.error(error||_this.$t("common._common.planned_services_list_error_msg")),_context.abrupt("return",{});case 11:_this.listCount=list.length,_iterator=(0,createForOfIteratorHelper/* default */.Z)(list);try{for(_iterator.s();!(_step=_iterator.n()).done;)inventory=_step.value,inventory.checked=!1}catch(err){_iterator.e(err)}finally{_iterator.f()}_this.serviceList=list,_this.inventoryListLoading=!1;case 16:case"end":return _context.stop()}}),_callee)})))()},cancel:function(){this.onClose()},addService:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var jobPlanId,workOrderId,selectedServices,moduleName,url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(jobPlanId=_this2.jobPlanId,workOrderId=_this2.workOrderId,selectedServices=[],"jobPlanServices"===_this2.moduleName?(selectedServices=_this2.serviceList.filter((function(service){return!0===service.checked})),selectedServices=selectedServices.map((function(service){var _ref=service||{},id=_ref.id,duration=_ref.duration;return{jobPlan:{id:jobPlanId},service:{id:id},quantity:1,duration:duration}}))):"workOrderPlannedServices"===_this2.moduleName&&(selectedServices=_this2.serviceList.filter((function(service){return!0===service.checked})),selectedServices=selectedServices.map((function(service){var _ref2=service||{},id=_ref2.id,duration=_ref2.duration;return{workOrder:{id:workOrderId},service:{id:id},quantity:1,duration:duration}}))),!(selectedServices.length>0)){_context2.next=14;break}return moduleName=_this2.moduleName,url="v3/modules/bulkCreate/".concat(moduleName),params={data:(0,defineProperty/* default */.Z)({},_this2.moduleName,selectedServices),moduleName:_this2.moduleName},_context2.next=9,api/* API */.bl.post(url,params);case 9:_yield$API$post=_context2.sent,error=_yield$API$post.error,error?_this2.$message.error(error.message||_this2.$t("common._common.error_adding_inventory")):(_this2.$message.success(_this2.$t("common._common.added_successfully")),_this2.cancel(),_this2.$emit("save"),eventBus/* eventBus */.Y.$emit("reloadOverallCost")),_context2.next=15;break;case 14:_this2.$message.error(_this2.$t("common._common.select_inventory_error"));case 15:case"end":return _context2.stop()}}),_callee2)})))()}}},plannedInventory_AddPlannedServicesvue_type_script_lang_js=AddPlannedServicesvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(plannedInventory_AddPlannedServicesvue_type_script_lang_js,AddPlannedServicesvue_type_template_id_951c1fea_render,AddPlannedServicesvue_type_template_id_951c1fea_staticRenderFns,!1,null,null,null)
/* harmony default export */,AddPlannedServices=component.exports,validation=__webpack_require__(990260),PlannedInventoryServicesvue_type_script_lang_js={name:"PlannedInventoryServices",components:{InlineSvg:InlineSvg/* default */.Z,AddPlannedServices:AddPlannedServices},props:["details","resizeWidget"],data:function(){return{plannedServicesloading:!1,plannedInventoryServices:[],showAddServicesDialog:!1}},created:function(){this.getPlannedServices()},mounted:function(){this.autoResize()},computed:{servicesTotalCost:function(){var _step,plannedInventoryServices=this.plannedInventoryServices,totalCost=0,_iterator=(0,createForOfIteratorHelper/* default */.Z)(plannedInventoryServices);try{for(_iterator.s();!(_step=_iterator.n()).done;){var service=_step.value,_ref=service||{},cost=_ref.cost;(0,validation/* isEmpty */.xb)(cost)||(totalCost+=cost)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return eventBus/* eventBus */.Y.$emit("servicesTotalCost",totalCost.toFixed(2)),totalCost}},methods:{fixedDuration:function(plannedInventoryService){var paymentTypeEnum=this.$getProperty(plannedInventoryService,"service.paymentTypeEnum");return"FIXED"===paymentTypeEnum},autoResize:function(){var _this=this;this.$nextTick((function(){var container=_this.$refs["plannedServicesWidget"];if(container){var height=container.scrollHeight+180,width=container.scrollWidth;_this.resizeWidget({height:height,width:width})}}))},addServices:function(){this.showAddServicesDialog=!0},getPrice:function(plannedInventoryService){var price=this.$getProperty(plannedInventoryService,"service.buyingPrice");return(0,validation/* isEmpty */.xb)(price)?"---":price},getPlannedServices:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var jobPlanid,params,_yield$API$fetchAll,list,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this2.plannedServicesloading=!0,jobPlanid=_this2.$getProperty(_this2.details,"id"),params={filters:JSON.stringify({jobPlan:{operatorId:36,value:["".concat(jobPlanid)]}})},_context.next=5,api/* API */.bl.fetchAll("jobPlanServices",params);case 5:_yield$API$fetchAll=_context.sent,list=_yield$API$fetchAll.list,error=_yield$API$fetchAll.error,error?_this2.$message.error(error||_this2.$t("common._common.planned_services_list_error_msg")):(_this2.plannedInventoryServices=list,_this2.plannedServicesloading=!1,_this2.autoResize());case 9:case"end":return _context.stop()}}),_callee)})))()},addService:function(){this.showAddServicesDialog=!0},totalCost:function(plannedInventoryService){var quantity=this.$getProperty(plannedInventoryService,"quantity"),price=this.$getProperty(plannedInventoryService,"service.buyingPrice"),duration=this.$getProperty(plannedInventoryService,"duration"),cost=0;return cost=this.fixedDuration(plannedInventoryService)?(0,validation/* isEmpty */.xb)(price)?"---":quantity*price:(0,validation/* isEmpty */.xb)(price)||(0,validation/* isEmpty */.xb)(duration)?"---":quantity*price*duration,"---"!==cost&&(plannedInventoryService.cost=cost),cost},updateQuantity:function(plannedInventoryService){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _ref2,quantity,id,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _ref2=plannedInventoryService||{},quantity=_ref2.quantity,id=_ref2.id,data={quantity:quantity},_context2.next=4,_this3.updatePlannedService(id,data);case 4:case"end":return _context2.stop()}}),_callee2)})))()},updateDuration:function(plannedInventoryService){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _ref3,duration,id,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _ref3=plannedInventoryService||{},duration=_ref3.duration,id=_ref3.id,data={duration:duration},_context3.next=4,_this4.updatePlannedService(id,data);case 4:case"end":return _context3.stop()}}),_callee3)})))()},updatePlannedService:function(id,data){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var _yield$API$updateReco,error,_ref4,quantity,errorMsg,_ref5,_quantity,successMsg;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,api/* API */.bl.updateRecord("jobPlanServices",{id:id,data:data});case 2:_yield$API$updateReco=_context4.sent,error=_yield$API$updateReco.error,error?(_ref4=data||{},quantity=_ref4.quantity,errorMsg=(0,validation/* isEmpty */.xb)(quantity)?_this5.$t("common._common.unable_to_update_duration"):_this5.$t("common._common.unable_to_update_quantity"),_this5.$message.error(error||errorMsg)):(_ref5=data||{},_quantity=_ref5.quantity,successMsg=(0,validation/* isEmpty */.xb)(_quantity)?_this5.$t("common._common.duration_updated_successfully"):_this5.$t("common._common.quantity_updated_successfully"),_this5.$message.success(successMsg),_this5.getPlannedServices(),eventBus/* eventBus */.Y.$emit("reloadOverallCost"));case 5:case"end":return _context4.stop()}}),_callee4)})))()},deletePlannedService:function(plannedInventoryService,index){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var id,_yield$API$deleteReco,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return id=plannedInventoryService.id,_context5.next=3,api/* API */.bl.deleteRecord("jobPlanServices",[id]);case 3:_yield$API$deleteReco=_context5.sent,error=_yield$API$deleteReco.error,error?_this6.$message.error(error||_this6.$t("common._common.error_occurred_delete")):(_this6.plannedInventoryServices.splice(index,1),_this6.$message.success(_this6.$t("common._common.service_del")),eventBus/* eventBus */.Y.$emit("reloadOverallCost"),_this6.autoResize());case 6:case"end":return _context5.stop()}}),_callee5)})))()}}},plannedInventory_PlannedInventoryServicesvue_type_script_lang_js=PlannedInventoryServicesvue_type_script_lang_js,PlannedInventoryServices_component=(0,componentNormalizer/* default */.Z)(plannedInventory_PlannedInventoryServicesvue_type_script_lang_js,render,staticRenderFns,!1,null,"2d90c822",null)
/* harmony default export */,PlannedInventoryServices=PlannedInventoryServices_component.exports},
/***/353654:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"d7f1f315aba97cd14240ee6f3d34465f.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/93398.js.map