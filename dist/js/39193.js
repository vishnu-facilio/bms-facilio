(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[39193],{
/***/604947:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return Spinner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/Spinner.vue?vue&type=template&id=06a81286&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("transition",[_c("svg",{directives:[{name:"show",rawName:"v-show",value:_vm.show,expression:"show"}],staticClass:"spinner",class:{show:_vm.show},attrs:{width:_vm.spinnerSize,height:_vm.spinnerSize,viewBox:"0 0 44 44"}},[_c("circle",{staticClass:"path",style:{stroke:_vm.strokeColor},attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},staticRenderFns=[],Spinnervue_type_script_lang_js={name:"spinner",props:["show","size","colour"],computed:{spinnerSize:function(){return this.size?this.size+"px":"50px"},strokeColor:function(){return this.colour?this.colour:"#fd4b92"}}},components_Spinnervue_type_script_lang_js=Spinnervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_Spinnervue_type_script_lang_js,render,staticRenderFns,!1,null,"06a81286",null)
/* harmony default export */,Spinner=component.exports},
/***/890652:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return MobileFloorPlanViewer}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/MobileFloorPlanViewer.vue?vue&type=template&id=114156ea
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100 relative"},[_c("div",{ref:"floorPlanContainer",staticClass:"floor-plan-builder-container p10 mobilefloorplan"},[_c("canvas",{ref:"floorPlan",attrs:{id:"floorplan-canvas"}})]),_c("floorplansettings",{staticClass:"fp-mobile-viwer-settings",attrs:{refresh:_vm.refresh},on:{action:_vm.handleAction}})],1)},staticRenderFns=[],build=(__webpack_require__(879288),__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(648324),__webpack_require__(169358),__webpack_require__(82154)),build_default=__webpack_require__.n(build),vue_runtime_esm=__webpack_require__(720144),fabric=__webpack_require__(232777),validation=__webpack_require__(990260),OuterAppHelper=__webpack_require__(143979),FloorPlanViewerSettings=__webpack_require__(63706),CanvasSetupMixin=__webpack_require__(233492),FloorPlanActionMixin=__webpack_require__(88421),FloorPlanFiltersMixin=__webpack_require__(891691),FloorPlanValueMixin=__webpack_require__(701758),MobileFloorPlanViewervue_type_script_lang_js={mixins:[OuterAppHelper/* default */.Z,CanvasSetupMixin/* default */.Z,FloorPlanActionMixin/* default */.Z,FloorPlanFiltersMixin/* default */.Z,FloorPlanValueMixin/* default */.Z],data:function(){return{floorPlan:null,floor:null,refresh:!1,leagend:{},controlCategoryList:[],spaceControllableCategoriesMap:[],floorControlCategory:[],spaces:[],flooplans:[],spaceList:[],pubSubWatcherKey:null,wsPingPongInterval:null}},components:{floorplansettings:FloorPlanViewerSettings/* default */.Z},computed:{floorPlanId:function(){var floor=this.floor;return(0,validation/* isEmpty */.xb)(floor)?null:floor.defaultFloorPlanId},floorId:function(){var params=this.$route.params;return(0,validation/* isEmpty */.xb)(params)?null:Number(params.floorId)}},created:function(){this.$store.dispatch("loadSpaceCategory")},mounted:function(){var _this=this;this.loadQData(),this.$store.dispatch("getCurrentAccount").then((function(){_this.setSocketDetails()})),this.$store.dispatch("getFeatureLicenses"),Promise.all([this.getAllCategoryEnum(),this.fetchFloorDetails(),this.fetchFloorSpaces(),this.getFloorControlCategory(),this.loadFloorSpaces()]).then((function(){_this.fetchFloorPlan().then((function(){_this.bindFloorplanData()}))}))},destroyed:function(){this.unSubscribeToLiveData(),this.destroyFloorPlan()},methods:{setSocketDetails:function(){if(this.$account.config&&this.$account.config.ws_endpoint&&(vue_runtime_esm["default"].use(build_default(),this.$account.config.ws_endpoint,{store:this.$store,format:"json",reconnection:!0,
// (Boolean) whether to reconnect automatically (false)
reconnectionDelay:1e4}),null===this.wsPingPongInterval)){var self=this;this.wsPingPongInterval=setInterval((function(){if(self.$socket){var obj={from:0,to:0,content:{ping:"check"}};self.$socket.sendObj(obj)}}),6e4)}},subscribeToLiveData:function(){(0,validation/* isEmpty */.xb)(this.pubSubWatcherKey)||this.unSubscribeToLiveData();var params=this.getSubscriptionParams();(0,validation/* isEmpty */.xb)(params)||(this.pubSubWatcherKey=this.subscribe("readingChange",params,this.loadfloorPlanData()))},unSubscribeToLiveData:function(){this.pubSubWatcherKey&&this.unsubscribe(this.pubSubWatcherKey,"readingChange",this.getSubscriptionParams()),this.pubSubWatcherKey=null},getSubscriptionParams:function(){return{readings:this.subcriptiondata||[]}},loadfloorPlanData:function(){var _this2=this;Promise.all([this.fetchFloorDetails(),this.fetchFloorSpaces(),this.getFloorControlCategory(),this.loadFloorSpaces()]).then((function(){_this2.fetchFloorPlan().then((function(){_this2.setMarkerValue()}))}))},sendToMobile:function(floorplan){window.JSReceiver?window.JSReceiver.sendData(JSON.stringify(floorplan)):this.$route.query&&this.$route.query.media&&"ios"===this.$route.query.media&&(document.location.href="floorplan://"+JSON.stringify(floorplan))},setLeagend:function(){var floorPlan=this.floorPlan;if(!(0,validation/* isEmpty */.xb)(floorPlan)&&floorPlan.leagend){var leagend=JSON.parse(floorPlan.leagend);this.$set(this,"leagend",leagend)}},getAllCategoryEnum:function(){var _this3=this;return this.$http.get("/v2/controlAction/getControllableCategoryList").then((function(_ref){var data=_ref.data;0===data.responseCode&&(_this3.controlCategoryList=data.result.controllableCategories)}))},getFloorControlCategory:function(){var _this4=this;return this.$http.get("/v2/controlAction/getControllableCategories?floorId=".concat(this.floorId)).then((function(_ref2){var data=_ref2.data;0===data.responseCode&&data.result&&(_this4.spaceControllableCategoriesMap=data.result.spaceControllableCategoriesMap)}))},fetchFloorDetails:function(){var _this5=this;return this.$http.get("/v2/pages/floor?id=".concat(this.floorId)).then((function(_ref3){var data=_ref3.data;0===data.responseCode&&_this5.$set(_this5,"floor",data.result.record)}))},fetchFloorPlan:function(){var _this6=this;return this.$http.post("/v2/floorPlan/get",{floorPlan:{id:this.floorPlanId}}).then((function(_ref4){var data=_ref4.data;0===data.responseCode&&(_this6.$set(_this6,"floorPlan",data.result.floorPlan),_this6.setLeagend(data.result.floorPlan))}))},fetchFloorSpaces:function(){var _this7=this;return this.$http.get("/v2/floorPlan/spaces?floorId=".concat(this.floorId)).then((function(_ref5){var data=_ref5.data;0===data.responseCode&&_this7.$set(_this7,"spaces",data.result.spaces)}))},bindFloorplanData:function(){var _this8=this;if(this.canvas=new fabric.fabric.Canvas(this.$refs["floorPlan"],{selection:!1,preserveObjectStacking:!0}),this.floorPlanId){var that=this;this.canvas.loadFromJSON(this.floorPlan.canvas,(function(){that.canvas.backgroundColor=null,
// that.canvasFitToScreen()
that.canvas.renderAll()}),(function(el,element){_this8.applyValue(element),_this8.applyFilters(element),_this8.setUpMobileObjectEvents(element),_this8.setUpViewerProps(element)}))}this.canvas.renderAll(),this.$nextTick((function(){_this8.setFitDimensions(),_this8.$nextTick((function(){_this8.registerNativeEvents(),_this8.setupMobileEvents();try{setTimeout((function(){_this8.subscribeToLiveData()}),2e3)}catch(error){}_this8.fitToResolution()}))}))},setUpMobileObjectEvents:function(obj){var _this9=this;obj.on("mouseup",(function(element){
// if (!self.touchDargEnd) {
//   let { target } = element
//   if (!isEmpty(target) && target.floorplan) {
//     this.sendToMobile(target.floorplan)
//   }
// }
var target=element.target;!(0,validation/* isEmpty */.xb)(target)&&target.floorplan&&_this9.sendToMobile(target.floorplan)}))},setMobileDimensions:function(){var container=this.$refs["floorPlanContainer"];(0,validation/* isEmpty */.xb)(container)||(this.canvas.setHeight(container.offsetHeight),this.canvas.setWidth(container.offsetWidth),this.canvas.calcOffset(),this.canvas.renderAll())},loadFloorSpaces:function(categoryId){var _this10=this;this.floorId&&this.$util.loadSpacesContext(4,null,[{key:"spaceCategory",operator:"is",value:categoryId},{key:"floor",operator:"is",value:this.floorId},{key:"space1",operator:"is empty"},{key:"space2",operator:"is empty"},{key:"space3",operator:"is empty"}]).then((function(response){_this10.spaceList=response.records}))},registerNativeEvents:function(){},destroyFloorPlan:function(){this.canvas=null}}},dashboard_MobileFloorPlanViewervue_type_script_lang_js=MobileFloorPlanViewervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(dashboard_MobileFloorPlanViewervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,MobileFloorPlanViewer=component.exports},
/***/63706:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FloorPlanViewerSettings}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/floorPlan/components/FloorPlanViewerSettings.vue?vue&type=template&id=bbd79dec
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fp-viwer-settings"},[_vm.refresh?_c("el-button",{staticClass:"p12",attrs:{icon:"el-icon-refresh",size:"small",plain:""},on:{click:function($event){return _vm.action("resetPanAndZoom")}}}):_vm._e(),_c("el-popover",{attrs:{placement:"bottom",title:"Views",width:"200",trigger:"click"},model:{value:_vm.popovervisible,callback:function($$v){_vm.popovervisible=$$v},expression:"popovervisible"}},[_c("div",{staticClass:"fp-leagend-header-settings"},[_c("el-select",{staticClass:"fc-input-select fc-input-full-border2 width100",attrs:{placeholder:"Select"},on:{change:function($event){return _vm.action("viewMode",_vm.view)}},model:{value:_vm.view,callback:function($$v){_vm.view=$$v},expression:"view"}},[_vm._l(_vm.viewModes,(function(item){return _c("el-option",{key:item.value,attrs:{label:item.label,value:item.value}})})),343===_vm.$account.org.id||1===_vm.$account.org.id?_c("el-option",{key:213,attrs:{label:"VAV readings",value:"vavreadings"}}):_vm._e(),410===_vm.$account.org.id?_c("el-option",{key:213,attrs:{label:"Custom script",value:"customscript"}}):_vm._e()],2)],1),"readings"===_vm.view?_c("div",{staticClass:"fp-leagend-header-settings"},[_c("p",{staticClass:"fc-input-label-txt pB5 pT5"},[_vm._v("Asset Category")]),_c("el-select",{staticClass:"fc-input-select fc-input-full-border2 width100",attrs:{filterable:"",placeholder:"Select"},on:{change:function($event){return _vm.loadAssetFields()}},model:{value:_vm.heatmapData.assetCategoryId,callback:function($$v){_vm.$set(_vm.heatmapData,"assetCategoryId",$$v)},expression:"heatmapData.assetCategoryId"}},_vm._l(_vm.assetCategory,(function(category,index){return _c("el-option",{key:index,attrs:{label:category.name,value:category.id}})})),1)],1):_vm._e(),"readings"===_vm.view?_c("div",{staticClass:"fp-leagend-header-settings"},[_c("p",{staticClass:"fc-input-label-txt pB5 pT5"},[_vm._v("Asset Field Name")]),_c("el-select",{staticClass:"fc-input-select fc-input-full-border2 width100",attrs:{filterable:"",placeholder:"Select"},on:{change:function($event){return _vm.setReadingFieldModuleName()}},model:{value:_vm.heatmapData.readingFieldName,callback:function($$v){_vm.$set(_vm.heatmapData,"readingFieldName",$$v)},expression:"heatmapData.readingFieldName"}},_vm._l(_vm.assetFields,(function(field,index){return _c("el-option",{key:index,attrs:{label:field.displayName,value:field.name}})})),1)],1):_vm._e(),_vm.$mobile||!_vm.viewMode||_vm.hideSettings?_vm._e():_c("el-button",{staticClass:"p12",attrs:{slot:"reference",icon:"el-icon-setting",size:"small",plain:""},slot:"reference"})],1),_c("el-button-group",{staticClass:"fb-settings-block"},[_c("el-button",{attrs:{icon:"el-icon-plus",size:"small",plain:""},on:{click:function($event){return _vm.action("zoomIn")}}}),_c("el-button",{attrs:{icon:"el-icon-minus",size:"small",plain:""},on:{click:function($event){return _vm.action("zoomOut")}}})],1)],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(420629)),FloorPlanViewerSettingsvue_type_script_lang_js={props:["refresh","viewMode","viewParams","hideSettings"],data:function(){return{popovervisible:!1,heatmapData:{assetCategoryId:null,readingFieldName:null,readingModule:null},assetFields:[],view:"default",viewModes:[{label:"Default",value:"default"},{label:"Maintenance",value:"maintenance"},{label:"Control points",value:"control_points"},{label:"Readings",value:"readings"}]}},created:function(){this.$store.dispatch("loadAssetCategory")},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetCategory:function(state){return state.assetCategory}})),watch:{viewMode:{handler:function(newVal,oldVal){newVal!==oldVal&&(this.view=this.viewMode)}}},mounted:function(){this.viewMode&&(this.view=this.viewMode),this.viewParams&&this.viewParams.assetCategoryId&&(this.heatmapData=this.viewParams,this.loadAssetFields(!0))},methods:{refreshPopover:function(){var _this=this;this.heatmapData={assetCategoryId:null,readingFieldName:null,readingModule:null},this.popovervisible=!1,setTimeout((function(){_this.popovervisible=!0}),100)},openpopover:function(){this.popovervisible=!this.popovervisible},action:function(_action,data){"viewMode"===_action&&"readings"!==data?this.$emit("action",_action,data):"viewMode"===_action?this.refreshPopover():this.$emit("action",_action)},setReadingFieldModuleName:function(){if(this.heatmapData.readingFieldName){var fieldname=this.heatmapData.readingFieldName,fieldobj=this.assetFields.find((function(rt){return rt.name===fieldname}));this.heatmapData.readingModule=fieldobj.module.name,this.$emit("action","viewMode","readings",this.heatmapData)}},loadAssetFields:function(edit){var _this2=this;edit||(this.heatmapData.readingFieldName=null),this.$util.loadAssetReadingFields(-1,this.heatmapData.assetCategoryId).then((function(fields){_this2.assetFields=fields}))}}},components_FloorPlanViewerSettingsvue_type_script_lang_js=FloorPlanViewerSettingsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FloorPlanViewerSettingsvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FloorPlanViewerSettings=component.exports},
/***/324960:
/***/function(){
/* (ignored) */
/***/},
/***/326759:
/***/function(){
/* (ignored) */
/***/},
/***/56272:
/***/function(){
/* (ignored) */
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/39193.js.map