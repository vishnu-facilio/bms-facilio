(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[61238],{
/***/940736:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ControlLogicList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/controls/ControlLogic/ControlLogicList.vue?vue&type=template&id=3c879134
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100"},[_c("div",{staticClass:"position-relative"},[_c("portal",{key:"controllogiclistpage",attrs:{to:"controllogicpagenation",slim:""}},[_c("el-tooltip",{attrs:{effect:"dark",content:_vm.$t("common._common.search"),placement:"left"}},[_c("div",[_c("i",{staticClass:"el-icon-search fc-black-2 f16 pointer fw-bold mR10 control-logic-search",on:{click:function($event){return $event.stopPropagation(),_vm.toggleQuickSearch()}}})])])],1),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.showQuickSearch,expression:"showQuickSearch"}],staticClass:"fc-black-small-txt-12 fc-subheader-right-search control-logic-search-filter"},[_c("new-search",{attrs:{config:_vm.filterConfig,showSearch:_vm.showQuickSearch,defaultFilter:_vm.defaultFilter},on:{hideSearch:function($event){_vm.showQuickSearch=!1}}}),_c("div",{staticClass:"filter-search-close"})],1),null!==_vm.appliedFilters?_c("div",[_c("new-tag",{staticClass:"layout-new-tag",attrs:{config:_vm.filterConfig,filters:_vm.appliedFilters,showFilterAdd:_vm.showAddFilter,showCloseIcon:!0}}),Object.keys(_vm.appliedFilters).length>"0"?_c("div",{staticClass:"clear-filter pointer control-logic-clear-filter",on:{click:function($event){return _vm.resetFilters()}}},[_vm._v(" "+_vm._s(_vm.$t("common._common.clear_all_filters"))+" ")]):_vm._e()],1):_vm._e()],1),-1===_vm.openControlId?_c("div",{staticClass:"fc-list-view p10 pT0 mT10 fc-list-table-container height100vh fc-table-td-height fc-table-viewchooser pB100",class:_vm.$route.query.search?"fc-list-table-search-scroll":""},[_vm.loading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_c("div",[_c("el-table",{staticClass:"control-points-table",staticStyle:{width:"auto"},attrs:{data:_vm.controllogicload,height:"auto",type:"index",index:_vm.indexMethod,fit:!0}},[_c("template",{slot:"empty"},[_c("img",{staticClass:"mT50",attrs:{src:__webpack_require__(15482),width:"100",height:"100"}}),_c("div",{staticClass:"mT10 label-txt-black f14 op6"},[_vm._v(" No Control Points Available. ")])]),_c("el-table-column",{attrs:{label:"ID",fixed:"",width:"150",prop:"id"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("div",{staticClass:"fc-id"},[_vm._v(_vm._s("#"+scope.row.id))])]}}],null,!1,3107646455)}),_c("el-table-column",{attrs:{label:"NAME",fixed:"",width:"300",prop:"id"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("div",{staticClass:"max-width300px textoverflow-ellipsis"},[_vm._v(" "+_vm._s(scope.row.name)+" ")])]}}],null,!1,1564847981)}),_c("el-table-column",{attrs:{label:"CREATED TIME",width:"150",prop:"id"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_vm._v(" "+_vm._s(_vm._f("formatDate")(scope.row.createdTime,!0))+" ")]}}],null,!1,1297557084)}),_c("el-table-column",{attrs:{label:"MODIFIED TIME",width:"150",prop:"id"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_vm._v(" "+_vm._s(_vm._f("formatDate")(scope.row.modifiedTime,!0))+" ")]}}],null,!1,4228802077)}),_c("el-table-column",{attrs:{label:"TYPE",width:"150",prop:"id"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[34===scope.row.ruleType?_c("div",[_c("div",[_vm._v("Reservation")])]):_vm._e(),35===scope.row.ruleType?_c("div",[_c("div",[_vm._v("Rule Based")])]):_vm._e(),36===scope.row.ruleType?_c("div",[_c("div",[_vm._v("Scheduled")])]):_vm._e()]}}],null,!1,1216768166)}),_c("el-table-column",{attrs:{label:"STATUS",width:"250",prop:"id"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("el-switch",{staticClass:"Notification-toggle",attrs:{"active-value":!0,"inactive-value":!1,"active-color":"rgba(57, 178, 194, 0.8)","inactive-color":"#e5e5e5"},on:{change:function($event){return _vm.changestatus(scope.row,scope.row.status)}},model:{value:scope.row.status,callback:function($$v){_vm.$set(scope.row,"status",$$v)},expression:"scope.row.status"}})]}}],null,!1,3935447133)}),_c("el-table-column",{staticClass:"visibility-visible-actions",attrs:{prop:"",label:"",width:"100"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("div",{staticClass:"text-center"},[_c("i",{staticClass:"el-icon-edit pointer visibility-hide-actions",on:{click:function($event){return _vm.editControlRule(scope.row)}}}),_c("i",{staticClass:"el-icon-delete pointer visibility-hide-actions mL10",on:{click:function($event){return _vm.deleteControlRule(scope.row)}}})])]}}],null,!1,577553381)})],2)],1)]):_vm._e(),_vm.controlLogicVisible?_c("new-logic",{attrs:{controlLogic:_vm.selectedControlLogic,visibility:_vm.controlLogicVisible,model:_vm.controllogicload},on:{"update:visibility":function($event){_vm.controlLogicVisible=$event},saved:_vm.onControlLogicCreated}}):_vm._e()],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),validation=(__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(169358),__webpack_require__(670560),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(648324),__webpack_require__(425728),__webpack_require__(162506),__webpack_require__(990260)),NewSearch=__webpack_require__(521816),NewTag=__webpack_require__(588633),NewControlLogicForm=__webpack_require__(706891),vuex_esm=__webpack_require__(420629),ControlLogicListvue_type_script_lang_js={data:function(){return{showAddFilter:!1,showQuickSearch:!1,defaultFilter:"name",filterConfig:{includeParentCriteria:!0,path:"/app/co/cl/",data:{
// fieldId: {
//   label: 'Reading',
//   displayType: 'select',
//   options: {},
//   value: []
// },
// resourceId: {
//   label: 'Asset',
//   displayType: 'select',
//   options: {},
//   value: []
// },
name:{label:"Name",displayType:"string",value:[]},ruleType:{label:"Trigger",displayType:"select",options:{34:"Reservation",35:"Alarms",36:"Schedule"},operatorId:9,value:""}}},controllogicload:[],selectedControlLogic:null,loading:!0,updatelogiclist:[],tableData:[],controlLogicVisible:!1}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({controls:function(state){return state.control.controls}})),{},{openControlId:function(){return this.$route.params.id?parseInt(this.$route.params.id):-1},filters:function(){var $route=this.$route,_ref=$route||{},search=_ref.query.search;return(0,validation/* isEmpty */.xb)(search)?null:JSON.parse(this.$route.query.search)},appliedFilters:function(){var query=this.$route.query,_ref2=query||{},search=_ref2.search;return search?JSON.parse(search):null}}),watch:{filters:{handler:function(newVal,oldVal){newVal!==oldVal&&this.loadControlPoints()}},appliedFilters:{handler:function(newVal,oldVal){if(newVal!==oldVal){var query=this.$route.query,_ref3=query||{},search=_ref3.search;this.$router.push({query:{search:search,includeParentFilter:"true"}})}}}},mounted:function(){this.loadControlPoints()},components:{NewLogic:NewControlLogicForm/* default */.Z,NewSearch:NewSearch/* default */.Z,NewTag:NewTag/* default */.Z},methods:{setOptionsForAssets:function(){var _this=this,url="v2/controlAction/getControllableAssets";this.$http.get(url).then((function(response){200===response.status&&(response.data&&response.data.result&&response.data.result.controllableResources&&response.data.result.controllableResources.forEach((function(asset){_this.filterConfig.data.resourceId.options[asset.id]=asset.name})),_this.setOptionsForResources())}))},onControlLogicCreated:function(){this.loadControlPoints()},setOptionsForResources:function(){var _this2=this,url="v2/controlAction/getControllableAssets";
// data.siteId.options[sit.id] = sit.name
this.$http.get(url).then((function(response){200===response.status&&response.data&&response.data.result&&response.data.result.controllableFields&&response.data.result.controllableFields.forEach((function(field){_this2.filterConfig.data.fieldId.options[field.id]=field.displayName}))}))},toggleQuickSearch:function(){this.showQuickSearch=!this.showQuickSearch},resetFilters:function(){this.$router.push({path:"/app/co/cl/controlpoints",query:""})},loadControlPoints:function(){var _this3=this,filters=this.filters,self=this;self.loading=!0;var url="/v2/controlAction/getControlActionRules";filters&&(url+="?filters=".concat(encodeURIComponent(JSON.stringify(filters)))),this.$http.get(url).then((function(response){200===response.status&&(_this3.controllogicload=response.data.result.workflowRules,self.loading=!1)}))},indexMethod:function(index){return 2*index},editControlRule:function(controlData){this.controlLogicVisible=!0,this.selectedControlLogic=controlData},setdialogShow:function(scopeRow){this.selectedScope=scopeRow},changestatus:function(scopeRow,status){var self=this,queryParams="&status="+scopeRow.status+"&ruleId="+scopeRow.id;self.$http.post("/v2/setup/alarm/rules/status",queryParams).then((function(response){var res=response.data.result;"success"===res.result&&self.$message.success("Switched to "+(!0===res.result?"Sand Box":"Live")+" status successfully.")})).catch((function(error){}))},deleteControlRule:function(scopeRow){var self=this;self.$dialog.confirm({title:"Delete Control Logic",message:"Are you sure you want to delete this control logic?",rbDanger:!0,rbLabel:"Delete"}).then((function(value){value&&self.$http.get("/v2/controlAction/deleteControlActionRule?ruleId=".concat(scopeRow.id)).then((function(response){response.data.result.ruleId?response.data.ruleId.forEach((function(element){var doControls=self.workflowRules.find((function(r){return r.id===element}));doControls&&(self.workflowRules.splice(self.workflowRules.indexOf(doControls),1),self.$message.success(self.$t("Control Logic deleted successfully")))})):self.$message.success(self.$t("Control Logic deleted successfully"))}))}))}}},ControlLogic_ControlLogicListvue_type_script_lang_js=ControlLogicListvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(ControlLogic_ControlLogicListvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ControlLogicList=component.exports},
/***/706891:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return NewControlLogicForm}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/controls/ControlLogic/NewControlLogicForm.vue?vue&type=template&id=199056ba
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:_vm.visibility,width:"50%","before-close":_vm.closeDialog,"append-to-body":!0,"custom-class":"fc-dialog-form fc-dialog-right setup-dialog50 setup-dialog"},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("el-form",{ref:"logicrule",attrs:{model:_vm.controlpoints,"label-position":"top"}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(" "+_vm._s(_vm.isNew?"New Control Logic":"Edit Control Logic")+" ")])])]),_c("div",{staticClass:"new-body-modal"},[_c("el-form-item",{attrs:{label:"Name"}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{autofocus:"",placeholder:"Control Logic Name"},model:{value:_vm.controlpoints.name,callback:function($$v){_vm.$set(_vm.controlpoints,"name",$$v)},expression:"controlpoints.name"}})],1),_c("el-form-item",{attrs:{label:"Execute Based On"}},[_c("el-radio-group",{attrs:{disabled:_vm.disableRadioGroup},on:{change:function($event){return _vm.changeOptions()}},model:{value:_vm.executed,callback:function($$v){_vm.executed=$$v},expression:"executed"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:35}},[_vm._v(" Alarms")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:36}},[_vm._v(" Schedule")]),this.$helpers.isLicenseEnabled("RESOURCE_BOOKING")?_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:34}},[_vm._v(" Reservation")]):_vm._e()],1)],1),_c("div",{directives:[{name:"show",rawName:"v-show",value:35===_vm.executed,expression:"executed === 35"}]},[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{label:"Asset Category"}},[_c("el-select",{staticClass:"width100",attrs:{placeholder:"Select Asset category"},on:{change:_vm.fetchRules},model:{value:_vm.assetcategoryId,callback:function($$v){_vm.assetcategoryId=$$v},expression:"assetcategoryId"}},_vm._l(_vm.assetCategory,(function(category,index){return _c("el-option",{key:index,attrs:{label:category.displayName,value:parseInt(category.id)}})})),1)],1)],1),_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{label:"Rule"}},[_c("el-select",{staticClass:"width100 fc-input-full-border2",attrs:{filterable:"","loading-text":"Loading...",loading:_vm.ruleLoading},on:{change:_vm.rcaRulesDataload},model:{value:_vm.actionTyperule,callback:function($$v){_vm.actionTyperule=$$v},expression:"actionTyperule"}},_vm._l(_vm.rules,(function(rule,index){return _c("el-option",{key:index,attrs:{label:rule.name,value:rule.id}})})),1)],1)],1)],1),_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{label:"Asset"}},[_c("el-select",{staticClass:"width100 fc-input-full-border2",attrs:{filterable:""},model:{value:_vm.ruleMatchedResources,callback:function($$v){_vm.ruleMatchedResources=$$v},expression:"ruleMatchedResources"}},_vm._l(_vm.matchedResources,(function(resource,index){return _c("el-option",{key:index,attrs:{label:resource.name,value:resource.id}})})),1)],1)],1),_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{label:"Rca Rule"}},[_c("el-select",{staticClass:"width100 fc-input-full-border2",attrs:{filterable:"","no-data-text":"No Rca Rule available"},model:{value:_vm.actionRcaRule,callback:function($$v){_vm.actionRcaRule=$$v},expression:"actionRcaRule"}},_vm._l(_vm.rcarules,(function(rcarule,index){return _c("el-option",{key:index,attrs:{label:rcarule.name,value:rcarule.id}})})),1)],1)],1)],1)],1),_c("div",{directives:[{name:"show",rawName:"v-show",value:36===_vm.executed,expression:"executed === 36"}]},[1===_vm.trigger.type?_c("schedule-trigger",{attrs:{trigger:_vm.trigger,hideFields:_vm.hideFields}}):_vm._e()],1),this.$helpers.isLicenseEnabled("RESOURCE_BOOKING")?_c("div",{directives:[{name:"show",rawName:"v-show",value:34===_vm.executed,expression:"executed === 34"}]},[_c("div",{staticClass:"fc-div-bg-border"},[_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Name")]),_c("el-select",{staticClass:"width100",attrs:{filterable:"",disabled:_vm.reservationData.disabled,placeholder:"Select"},model:{value:_vm.reservationData.id,callback:function($$v){_vm.$set(_vm.reservationData,"id",$$v)},expression:"reservationData.id"}},_vm._l(_vm.reservationName,(function(reserv,index){return _c("el-option",{key:index,attrs:{label:reserv.name,value:reserv.id}})})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Date Field")]),_c("el-select",{staticClass:"width300px",attrs:{placeholder:"Select",filterable:""},model:{value:_vm.dateFieldId,callback:function($$v){_vm.dateFieldId=$$v},expression:"dateFieldId"}},_vm._l(_vm.dateFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1)],1),_c("el-col",{staticClass:"pL40",attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.scheduled_type"))+" ")]),_c("el-radio-group",{model:{value:_vm.scheduleType,callback:function($$v){_vm.scheduleType=$$v},expression:"scheduleType"}},[_c("el-radio",{key:2,staticClass:"fc-radio-btn",attrs:{label:2,value:!0}},[_vm._v("On")]),_c("el-radio",{key:3,staticClass:"fc-radio-btn",attrs:{label:3,value:!1}},[_vm._v("After")]),_c("el-radio",{key:1,staticClass:"fc-radio-btn",attrs:{label:1,value:!1}},[_vm._v("Before")])],1)],1)],1),[1,3].includes(parseInt(_vm.scheduleType))?_c("el-row",{staticClass:"mT30",attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Hours")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{clearable:"",filterable:""},model:{value:_vm.dateObject.hours,callback:function($$v){_vm.$set(_vm.dateObject,"hours",$$v)},expression:"dateObject.hours"}},_vm._l(_vm.$constants.HOURS,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1),_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Mins")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{filterable:"",placeholder:"Select"},model:{value:_vm.dateObject.minute,callback:function($$v){_vm.$set(_vm.dateObject,"minute",$$v)},expression:"dateObject.minute"}},_vm._l(_vm.$constants.MINUTES,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1)],1):_vm._e()],1)]):_vm._e(),_c("div",{staticClass:"fc-text-pink text-uppercase mT20"},[_vm._v("Command Action")]),_c("el-collapse",{staticClass:"new-rule-collapse position-relative controllogic-collapse",attrs:{accordion:!0},model:{value:_vm.activeNames,callback:function($$v){_vm.activeNames=$$v},expression:"activeNames"}},_vm._l(_vm.controlaction,(function(action,cindex){return _c("el-collapse-item",{key:cindex,staticClass:"rule-border-blue mT20 position-relative",staticStyle:{"border-left":"1px solid rgb(228, 235, 241)"},attrs:{name:action.name}},[_c("template",{slot:"title"},[_vm._v(" "+_vm._s(action.name)+" ")]),_c("div",{},[_c("el-radio-group",{on:{change:_vm.changecondition},model:{value:action.templateJson.actionType,callback:function($$v){_vm.$set(action.templateJson,"actionType",$$v)},expression:"action.templateJson.actionType"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:1}},[_vm._v("Point")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:2}},[_vm._v("Group")])],1)],1),_c("div",{directives:[{name:"show",rawName:"v-show",value:1===action.templateJson.actionType||-1===action.templateJson.actionType,expression:"\n              action.templateJson.actionType === 1 ||\n                action.templateJson.actionType === -1\n            "}],staticClass:"pT20"},[_c("el-row",[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black"},[_vm._v("Asset")])]),_c("el-col",{attrs:{span:15}},[_c("el-form-item",[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{placeholder:"Select asset"},on:{change:_vm.fetchFields},model:{value:action.templateJson.resource,callback:function($$v){_vm.$set(action.templateJson,"resource",$$v)},expression:"action.templateJson.resource"}},_vm._l(_vm.assets,(function(asset,index){return _c("el-option",{key:index,attrs:{label:asset.name,value:asset.id}})})),1)],1)],1)],1),_c("el-row",{},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black"},[_vm._v("Field")])]),_c("el-col",{attrs:{span:15}},[_c("el-form-item",[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{placeholder:"Select fields"},model:{value:action.templateJson.metric,callback:function($$v){_vm.$set(action.templateJson,"metric",$$v)},expression:"action.templateJson.metric"}},_vm._l(_vm.assetFields[action.templateJson.resource],(function(field,index){return _c("el-option",{key:index,attrs:{label:field.displayName,value:field.id}})})),1)],1)],1)],1),_c("el-row",{},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black"},[_vm._v("Value")])]),_c("el-col",{attrs:{span:15}},[_c("el-form-item",[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{autofocus:"",placeholder:"Enter the value",type:"number"},model:{value:action.templateJson.val,callback:function($$v){_vm.$set(action.templateJson,"val",$$v)},expression:"action.templateJson.val"}})],1)],1)],1),_c("img",{staticClass:"delete-icon pointer",staticStyle:{height:"18px",width:"18px","margin-right":"3px"},attrs:{src:__webpack_require__(385769)},on:{click:function($event){return _vm.deleteaction(cindex)}}})],1),_c("div",{directives:[{name:"show",rawName:"v-show",value:2===action.templateJson.actionType,expression:"action.templateJson.actionType === 2"}],staticClass:"pT20"},[_c("el-row",{},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black"},[_vm._v("Actions Group")])]),_c("el-col",{attrs:{span:15}},[_c("el-form-item",[_c("el-select",{staticClass:"width100 fc-input-full-border2",attrs:{filterable:""},model:{value:action.templateJson.controlActionGroupId,callback:function($$v){_vm.$set(action.templateJson,"controlActionGroupId",$$v)},expression:"action.templateJson.controlActionGroupId"}},_vm._l(_vm.rcagrouplist,(function(grouprule,index){return _c("el-option",{key:index,attrs:{label:grouprule.name,value:grouprule.id}})})),1)],1)],1)],1),_c("el-row",{},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black"},[_vm._v("Value")])]),_c("el-col",{attrs:{span:15}},[_c("el-form-item",[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{autofocus:"",placeholder:"Enter the value",type:"number"},model:{value:action.templateJson.val,callback:function($$v){_vm.$set(action.templateJson,"val",$$v)},expression:"action.templateJson.val"}})],1)],1)],1),_c("img",{staticClass:"delete-icon pointer",staticStyle:{height:"18px",width:"18px","margin-right":"3px"},attrs:{src:__webpack_require__(385769)},on:{click:function($event){return _vm.deleteaction(cindex)}}})],1)],2)})),1),_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{type:"primary"},on:{click:_vm.addaction}},[_vm._v("Add Command")])],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.submitForm()}}},[_vm._v(" "+_vm._s(_vm.saving?"Submitting...":"SAVE"))])],1)])],1)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),esm_typeof=__webpack_require__(103336),objectSpread2=__webpack_require__(595082),TriggerTypeSchedule=(__webpack_require__(169358),__webpack_require__(162506),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(450886),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(648324),__webpack_require__(121472)),vuex_esm=__webpack_require__(420629),PMMixin=__webpack_require__(369087),utility_methods=__webpack_require__(773258),NewControlLogicFormvue_type_script_lang_js={props:["visibility","controlLogic","ruleId","isNew","reservationEditObj"],data:function(){return{hideFields:{skipEvery:!0},
// Reservations
dateFields:[],scheduleType:null,interval:null,dateObject:{days:null,minute:0,hours:0,minu:null},ruleLoading:!1,assetcategoryId:null,dateFieldId:"",time:null,executed:35,id:"",rulefield:{},isEdit:!1,controllogicsingleruleload:[],isFormulaField:!1,controlObj:{},ruleMatchedResources:"",actionRcaRule:"",actionGroupRule:"",assets:[],rules:[],rcarules:[],rcagrouplist:[],actionTyperule:"",reservationName:[],reservationData:{id:"",disabled:!1},assetFields:{},logicaction:{},showControlAction:!0,controlaction:[],activeNames:["actionName0"],isNewControl:!1,controllogicformload:[],resourceQuery:null,isIncludeResource:!1,chooserVisibility:!1,chooserVisibilityAction:!1,resourceType:"asset",saving:!1,loading:!0,updatelogiclist:[],selectedResourceList:[],actionIndex:0,selectedResource:{name:""},formula:{name:"",workflow:null,includedResources:[],frequency:null},trigger:{name:name,type:1,startDate:new Date,startTime:(new Date).getTime(),showSkip:!1,basedOn:"Date",schedule:{times:["00:00"],frequency:1,skipEvery:-1,showSkip:!1,values:[],frequencyType:1,weekFrequency:-1,yearlyDayValue:null,monthValue:-1,yearlyDayOfWeekValues:[]},stopAfter:"never",endTime:new Date,startReading:null,readingFieldId:null,stopAfterReading:"never",endReading:null,readingInterval:null,assignedTo:null,reminders:[],criteria:null},frequencyTypes:[{label:"Do not repeat",value:0}],controlpoints:{name:"",actionTyperule:""},disableRadioGroup:!1,rcaRuleSelectShow:!1}},components:{ScheduleTrigger:TriggerTypeSchedule/* default */.Z},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({isAsset:function(){return"asset"===this.resourceType},isMultiResource:function(){return this.isAsset&&(!this.rule||!Object.keys(this.rule).length||this.rule.assetCategoryId>0)},triggerTypes:function(){var types=[{label:"Schedule",value:1}];return types.splice(1,2),types}},(0,vuex_esm/* mapState */.rn)({assetCategory:function(state){return state.assetCategory}})),{},{selectedRule:function(){var _this=this;return this.actionTyperule?this.rules.find((function(rule){return _this.actionTyperule===rule.id})):null},matchedResources:function(){return this.selectedRule?this.selectedRule.matchedResources:[]},resourceData:function(){return{assetCategory:this.controlpoints.assetCategoryId,isIncludeResource:this.isIncludeResource,selectedResources:Array.isArray(this.selectedResourceList)?this.selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}})):this.selectedResourceList.id}}//   isDateTimeField () {
//   let isDatetime = false
//   this.dateFields.filter(d => {
//     if(d.fieldId === this.dateFieldId){
//       return isDatetime = d.dataTypeEnum._name === 'DATE_TIME'
//     }
//   })
// return isDatetime
// }
}),mounted:function(){this.addaction(),this.getfetchrule(),this.setReservationForOptions(),this.setOptionsForAssets(),this.init(),this.fetchReservationFields(),this.fieldrules(),this.loadrulegroup(),this.reservationEditObj&&this.constructForReservation(),this.controlpoints.interval&&(this.dateObject=this.$helpers.secTodaysHoursMinu(this.interval)),this.$forceUpdate()},watch:{trigger:function(){},isNew:function(){this.init()}},methods:{init:function(){this.isNew?this.controlpoints={name:"",actionTyperule:""}:this.controlpoints=this.controlLogic},closeDialog:function(){this.$emit("update:visibility",!1)},addControllogic:function(){this.controlObj=this.$helpers.cloneObject(this.controlmodel),this.isNewControl=!0,this.visibility=!0},changeOptions:function(){this.$forceUpdate()},changecondition:function(){this.$forceUpdate()},submitForm:function(){var url,_this2=this,self=this;self.saving=!0,self.controlpoints.resourceId||(self.controlpoints.resourceId=-1);var payload=null,context={actions:this.controlaction,name:this.controlpoints.name,id:this.controlpoints.id,resourceId:this.ruleMatchedResources,event:{moduleName:"alarm"}};36===this.executed?(payload={workflowRuleContext:context},payload.workflowRuleContext.schedule=this._data.trigger.schedule,payload.workflowRuleContext.event.activityType=2097152):35===this.executed?(payload={readingAlarmRuleContext:context},this.selectedRule&&(payload.readingAlarmRuleContext.readingRuleGroupId=this.selectedRule.ruleGroupId),payload.readingAlarmRuleContext.event.activityType=3,payload.readingAlarmRuleContext.rcaRuleId=this.actionRcaRule||-1):34===this.executed&&(payload={recordRule:context},delete payload.recordRule.resourceId,payload.recordRule.event.activityType=524288,payload.recordRule.event.moduleName="reservation",payload.recordRule.scheduleType=this.scheduleType,payload.recordRule.parentId=this.reservationData.id,payload.recordRule.dateFieldId=this.dateFieldId,payload.recordRule.ruleType=34,payload.recordRule.interval=60*(60*this.dateObject.hours+this.dateObject.min)),this.controlpoints.id?(url="/v2/controlAction/updateControlActionRule",34===this.executed&&(url="/v2/recordrule/addOrUpdate"),self.$http.post(url,payload).then((function(response){0===response.data.responseCode?(_this2.controlpoints=response.data.result.readingAlarmRuleContext,_this2.controlpoints={name:""},self.$message.success("ControlLogic Edit Successfully"),self.$emit("update:visibility",!1),self.$emit("saved")):self.$message.error(response.data.message)})).catch((function(error){self.$message.error("Unable to Edit")}))):(url="/v2/controlAction/addControlActionRule",34===this.executed&&(url="/v2/recordrule/addOrUpdate"),self.$http.post(url,payload).then((function(response){0===response.data.responseCode?(_this2.controlpoints=response.data.result.readingAlarmRuleContext,_this2.controlpoints={name:""},self.$message.success("ControlLogic Added Successfully"),self.$emit("update:visibility",!1),self.$emit("saved")):self.$message.error(response.data.message),self.saving=!1})).catch((function(error){self.saving=!1,self.$message.error("Unable to Edit")})))},getfetchrule:function(){var _this3=this;if(this.controlLogic){var self=this;self.loading=!0;var url="/v2/controlAction/getControlActionRule?ruleId="+this.controlLogic.id;this.$http.get(url).then((function(response){_this3.controlLogicEdit=response.data.result.workflowRule||null,_this3.setData(response.data.result.workflowRule),self.loading=!1}))}},setData:function(workflowRule){this.executed=workflowRule.moduleName,this.executed=workflowRule.ruleType,this.controlpoints.name=workflowRule.name,this.controlpoints.id=workflowRule.id,this.controlaction=this.decoeactions(workflowRule.actions),this.ruleMatchedResources=workflowRule.resourceId,"35"===this.executed?
// this.assetcategoryId =
this.ruleMatchedResources=workflowRule.resourceId:"34"===this.executed?(this.reservationData.id=workflowRule.parentId,this.reservationData.disabled=!0,this.dateFieldId=workflowRule.dateFieldId,this.scheduleType=workflowRule.scheduleType,this.interval=workflowRule.interval,this.dateObject=this.$helpers.secTodaysHoursMinu(this.interval)):"36"===this.executed&&(this.trigger=workflowRule,this.executed=workflowRule.ruleType),this.ruleMatchedResources=workflowRule.resourceId,this._data.trigger.schedule=workflowRule.schedule},decoeactions:function(actions){var _this4=this;return actions.forEach((function(rt,index){rt.templateJson||(_this4.$set(rt,"templateJson",rt.template),_this4.$set(rt,"name","Command Action ".concat(index+1)))})),actions},rcaRulesDataload:function(ruleId){var _this5=this,self=this;self.loading=!0,this.rcarules=[];var url="/v2/alarm/rules/fetchRule?ruleId=".concat(ruleId);this.$http.get(url).then((function(response){200===response.status&&(response.data.result.alarmRule&&response.data.result.alarmRule.alarmRCARules&&(_this5.rcarules=response.data.result.alarmRule.alarmRCARules),self.loading=!1)}))},showActionAssetChooser:function(index){this.actionIndex=index,this.chooserVisibilityAction=!0},addaction:function(){this.controlaction.push({actionType:18,templateJson:{val:"",resource:null,metric:null,actionType:1,controlActionGroupId:null},name:"Command Action"+(this.controlaction.length+1)})},deleteaction:function(key){this.controlaction.splice(key,1)},onTriggerTypeChange:function(val){this.trigger.schedule=1!=val?null:(0,utility_methods/* deepCloneObject */.kh)(PMMixin/* default */.Z.INITIAL_SCHEDULE)},setOptionsForAssets:function(){var self=this;self.loading=!0;var url="/v2/controlAction/getControllableAssets";this.$http.get(url).then((function(response){200===response.status&&(response.data.result.controllableResources&&(self.assets=[{id:-1,name:"Current Asset"}].concat((0,toConsumableArray/* default */.Z)(response.data.result.controllableResources))),
// this.addaction()
self.loading=!1)}))},fetchFields:function(resourceId){if(!this.assetFields[resourceId]){var self=this;self.loading=!0;var url="/v2/controlAction/getControllableFields?resourceId="+resourceId;this.$http.get(url).then((function(response){200===response.status&&(response.data.result.controllableFields&&self.$set(self.assetFields,resourceId,response.data.result.controllableFields),self.loading=!1)}))}},fieldrules:function(){var self=this;self.loading=!0;var url="/v2/rules/all";this.$http.get(url).then((function(response){200===response.status&&(response.data.result.rules&&(self.rules=response.data.result.rules),self.loading=!1)}))},loadrulegroup:function(){var self=this;self.loading=!0;var url="/v2/controlAction/getControlGroups";this.$http.get(url).then((function(response){200===response.status&&(response.data.result.controlActionGroups&&(self.rcagrouplist=response.data.result.controlActionGroups),self.loading=!1)}))},setReservationForOptions:function(){var self=this;self.loading=!0;var url="/v2/reservations/view/all?parentId";this.$http.get(url).then((function(response){0===response.data.responseCode&&(response.data.result.reservations&&(self.reservationName=response.data.result.reservations),self.loading=!1)}))},fetchReservationFields:function(){var _this6=this;this.$http.get("/module/meta?moduleName=reservation").then((function(response){var tempFields;response.data.meta&&(tempFields=response.data.meta.fields,_this6.dateFields=tempFields.filter((function(d){return"DATE_TIME"===d.dataTypeEnum._name})))}))},constructForReservation:function(){this.reservationEditObj&&(this.executed=34,this.reservationData.id=this.reservationEditObj.id,this.reservationData.disabled=!0,this.disableRadioGroup=!0,this.controlpoints.name=this.reservationEditObj.name+"_Control")},fetchRules:function(assetcategoryId){var _this7=this;this.rules=[];var queryparams={assetCategoryId:{operatorId:36,value:[assetcategoryId+""]}};this.ruleLoading=!0;var url="/v2/rules/all?filters=".concat(encodeURIComponent(JSON.stringify(queryparams)),"&includeParentFilter=true");this.$http.get(url).then((function(response){0===response.data.responseCode&&(_this7.rules=response.data.result.rules,_this7.ruleLoading=!1)})).catch((function(){_this7.ruleLoading=!1}))}}},ControlLogic_NewControlLogicFormvue_type_script_lang_js=NewControlLogicFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(ControlLogic_NewControlLogicFormvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,NewControlLogicForm=component.exports},
/***/385769:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"4a9843791f38c4a28fdf9f0a4584780d.svg";
/***/},
/***/15482:
/***/function(module,__unused_webpack_exports,__webpack_require__){"use strict";module.exports=__webpack_require__.p+"img/noData-light.3b5d6592.png"}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/61238.js.map