"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[7817],{
/***/676474:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return V3LookupFieldWizard}});
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js
var render,staticRenderFns,regeneratorRuntime=__webpack_require__(150124),objectSpread2=__webpack_require__(595082),asyncToGenerator=__webpack_require__(548534),FLookupFieldWizard=(__webpack_require__(648324),__webpack_require__(499751)),api=__webpack_require__(32284),validation=__webpack_require__(990260),V3LookupFieldWizardvue_type_script_lang_js={name:"V3LookupFieldWizard",extends:FLookupFieldWizard["default"],methods:{fetchModulesData:function(){var _arguments=arguments,_this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var skipResetPage,moduleName,_this$filters,filters,perPage,page,_this$withReadings,withReadings,selectedLookupField,_ref,clientCriteria,additionalParams,_yield$API$fetchAll,list,meta,error,totalCount;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return skipResetPage=_arguments.length>0&&void 0!==_arguments[0]&&_arguments[0],moduleName=_this.moduleName,_this$filters=_this.filters,filters=void 0===_this$filters?{}:_this$filters,perPage=_this.perPage,page=_this.page,_this$withReadings=_this.withReadings,withReadings=void 0===_this$withReadings?null:_this$withReadings,selectedLookupField=_this.selectedLookupField,_ref=selectedLookupField||{},clientCriteria=_ref.clientCriteria,additionalParams=_ref.additionalParams,_context.next=5,api/* API */.bl.fetchAll(moduleName,(0,objectSpread2/* default */.Z)({withCount:!0,page:(0,validation/* isEmpty */.xb)(filters)||skipResetPage?page:1,filters:(0,validation/* isEmpty */.xb)(filters)?null:JSON.stringify(filters),perPage:perPage,viewName:"hidden-all",withReadings:withReadings,clientCriteria:(0,validation/* isEmpty */.xb)(clientCriteria)?null:JSON.stringify(clientCriteria)},additionalParams));case 5:_yield$API$fetchAll=_context.sent,list=_yield$API$fetchAll.list,meta=_yield$API$fetchAll.meta,error=_yield$API$fetchAll.error,totalCount=_this.$getProperty(meta,"pagination.totalCount",null),error?_this.$message.error(error.message):((0,validation/* isNullOrUndefined */.le)(list)||_this.$set(_this,"modulesList",list),(0,validation/* isNullOrUndefined */.le)(totalCount)||_this.$set(_this,"totalCount",totalCount)),_this.isSearchDataLoading=!1;case 12:case"end":return _context.stop()}}),_callee)})))()},loadDataCount:function(){}}},components_V3LookupFieldWizardvue_type_script_lang_js=V3LookupFieldWizardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_V3LookupFieldWizardvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,V3LookupFieldWizard=component.exports;
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
},
/***/7817:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return WorkorderHazardPrecaution}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/safetyplan/component/WorkorderHazardPrecaution.vue?vue&type=template&id=5b3c099e&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticStyle:{height:"100%"}},[_vm.isLoading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.isLoading,size:"80"}})],1):[_c("LineItemList",_vm._b({key:_vm.renderKey,ref:"lineItemComponent",staticStyle:{height:"100%"},attrs:{config:_vm.listConfiguration,moduleDisplayName:_vm.moduleDisplayName,moduleName:_vm.moduleName,widgetDetails:_vm.widgetDetails,viewname:_vm.viewname},on:{emptyStateBtn:function(){return _vm.showMsgPopup=!0}},scopedSlots:_vm._u([{key:"footer",fn:function(){return[_c("el-button",{staticClass:"sf-line-item-list-footer-add-btn",attrs:{type:"primary"},on:{click:function(){return _vm.showMsgPopup=!0}}},[_vm._v(" "+_vm._s(_vm.$t("common.safetyPlan.select_precaution"))+" ")])]},proxy:!0}])},"LineItemList",_vm.$attrs,!1),[_c("div",{staticClass:"pL10 pointer marginR-auto",attrs:{slot:"header-additional-actions"},slot:"header-additional-actions"},[_c("FLookupField",{attrs:{disabled:_vm.$validation.isEmpty(_vm.woHazards),model:_vm.selectedHazard,field:_vm.hazardField,hideLookupIcon:!0},on:{"update:model":function($event){_vm.selectedHazard=$event}}})],1)]),_vm.showMsgPopup?_c("el-dialog",{staticClass:"sf-precaution-dialog  agents-dialog fc-dialog-center-container",attrs:{title:_vm.$t("common.safetyPlan.select_hazards"),visible:_vm.showMsgPopup,width:"35%","append-to-body":!0},on:{"update:visible":function($event){_vm.showMsgPopup=$event}}},[_c("FLookupField",{staticClass:"mB60",attrs:{disabled:_vm.$validation.isEmpty(_vm.woHazards),model:_vm.workorderHazard.id,field:Object.assign({},_vm.hazardField,{multiple:!1})},on:{"update:model":function($event){return _vm.$set(_vm.workorderHazard,"id",$event)},showLookupWizard:function(){return _vm.canShowWizard=!0}}}),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function(){return _vm.showMsgPopup=!1}}},[_vm._v(_vm._s(_vm.$t("agent.agent.cancel")))]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:function(){return _vm.isHazardSelected=!0}}},[_vm._v(_vm._s(_vm.$t("common._common._save")))])],1)],1):_vm._e(),_vm.canShowWizard||_vm.isHazardSelected?_c("V3LookupFieldWizard",{attrs:{canShowLookupWizard:_vm.showWizard,selectedLookupField:_vm.wizardField},on:{"update:canShowLookupWizard":function($event){_vm.showWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.showWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}}):_vm._e()]],2)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),LineItemListOld=(__webpack_require__(634338),__webpack_require__(450886),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(666237)),api=__webpack_require__(32284),FLookupField=__webpack_require__(855048),validation=__webpack_require__(990260),V3LookupFieldWizard=__webpack_require__(676474),CustomModuleData=__webpack_require__(689565),eventBus=__webpack_require__(398011),relatedFieldUtil=__webpack_require__(850558),EQUALS_OPERATOR=9,WorkorderHazardPrecautionvue_type_script_lang_js={props:["widget","details"],components:{LineItemList:LineItemListOld/* default */.Z,FLookupField:FLookupField/* default */.Z,V3LookupFieldWizard:V3LookupFieldWizard/* default */.Z},data:function(){return{woHazards:[],isLoading:!1,selectedHazard:null,showMsgPopup:!1,workorderHazard:{hazard:null,id:null},isHazardSelected:!1,canShowWizard:!1}},computed:{moduleName:function(){return"workorderHazardPrecaution"},moduleDisplayName:function(){return"Precautions of"},viewname:function(){return"hidden-all"},showWizard:{set:function(value){this.isHazardSelected=!1,this.canShowWizard=value},get:function(){var canShowWizard=this.canShowWizard,isHazardSelected=this.isHazardSelected;return canShowWizard||isHazardSelected}},wizardField:function(){var _this$workorderHazard,params={isDataLoading:!1,options:[],forceFetchAlways:!0,selectedItems:[]};return this.isHazardSelected?(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},params),{},{lookupModuleName:"precaution",field:{lookupModule:{name:"precaution",displayName:"Precautions"}},multiple:!0,additionalParams:{excludeAvailableWorkOrderHazardPrecautions:null===(_this$workorderHazard=this.workorderHazard)||void 0===_this$workorderHazard?void 0:_this$workorderHazard.id,workorder:this.details.id}}):(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},params),{},{lookupModuleName:"workorderHazard",field:{lookupModule:{name:"hazard",displayName:"Hazards"}},multiple:!1,filters:{workorder:{operatorId:36,value:["".concat(this.details.id)]}}})},filters:function(){var selectedHazard=this.selectedHazard,details=this.details,fieldName="workorderHazard",filterObj={workorder:{operatorId:36,value:["".concat(details.id)]}};if(!(0,validation/* isEmpty */.xb)(selectedHazard)){var hazardIds=this.getStringifyHazards(selectedHazard);filterObj[fieldName]={operatorId:36,value:hazardIds}}return filterObj},editConfig:function(){return{canHideEdit:!0}},deleteConfig:function(){return{canHideDelete:!1}},quickCreateConfig:function(){return{canHideAddBtn:!0}},perPage:function(){return 7},deletePopupDetails:function(){var moduleDisplayName="Precaution";return{title:"".concat(this.$t("custommodules.list.delete")," ").concat(moduleDisplayName),message:"".concat(this.$t("custommodules.list.delete_confirmation")," ").concat(moduleDisplayName,"?"),rbDanger:!0,rbLabel:this.$t("custommodules.list.delete")}},widgetDetails:function(){var widget=this.widget,perPage=this.perPage,_ref=widget||{},relatedList=_ref.relatedList,_ref2=relatedList||{},summaryWidgetName=_ref2.summaryWidgetName,emptyStateText=this.$t("common.safetyPlan.no_precaution_added",{moduleName:"Precautions"});return{perPage:perPage,summaryWidgetName:summaryWidgetName,emptyStateText:emptyStateText,emptyStateBtnList:[{label:"Add Precautions",value:"add_precaution"}]}},listConfiguration:function(){var filters=this.filters,editConfig=this.editConfig,deleteConfig=this.deleteConfig,columnCustomConfig=this.columnCustomConfig,searchAndFilterConfig=this.searchAndFilterConfig,quickCreateConfig=this.quickCreateConfig,deletePopupDetails=this.deletePopupDetails,getViewDetails=this.getViewDetails,getRecordList=this.getRecordList;return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({expand:!1,isSelectionEnabled:!1,isIndexEnabled:!1,filters:filters,mainfieldAction:function(){},canHideFooter:!0,deletePopupDetails:deletePopupDetails,getViewDetails:getViewDetails,getRecordList:getRecordList},editConfig||{}),deleteConfig||{}),columnCustomConfig||{}),quickCreateConfig||{}),searchAndFilterConfig||{}),{},{canEnableMainFieldAction:!1})},renderKey:function(){var selectedHazard=this.selectedHazard;return(0,validation/* isEmpty */.xb)(selectedHazard)?1:selectedHazard.length+selectedHazard[0]},hazardField:function(){var field={isDataLoading:!1,options:[],lookupModuleName:"workorderHazard",field:{lookupModule:{name:"hazard",displayName:"Hazards"}},multiple:!0,forceFetchAlways:!0,placeHolderText:this.$t("common.safetyPlan.all_hazards"),selectedItems:[],filters:{workorder:{operatorId:36,value:["".concat(this.details.id)]}}};return field}},created:function(){this.fetchWorkOrderHazards()},mounted:function(){eventBus/* eventBus */.Y.$on("refresh-sf-precautions",this.refreshList)},watch:{"workorderHazard.id":{handler:function(newVal,oldVal){oldVal!==newVal&&this.setWorkOrderHazard(newVal)},immediate:!0},showMsgPopup:{handler:function(newVal){newVal||this.init()}}},methods:{init:function(){this.canShowWizard=!1,this.showMsgPopup=!1,this.isHazardSelected=!1,this.selectedHazard=null,this.workorderHazard={hazard:null,id:null}},refreshList:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.init(),_context.next=3,_this.fetchWorkOrderHazards();case 3:case"end":return _context.stop()}}),_callee)})))()},setLookupFieldValue:function(props){var _ref3=props||{},field=_ref3.field;this.isHazardSelected?this.setLookupFieldPrecautionValue(field):this.setLookupFieldHazardValue(field)},setLookupFieldHazardValue:function(field){var id=this.$getProperty(field,"selectedItems.0.value",null);this.setWorkOrderHazard(id)},setLookupFieldPrecautionValue:function(field){var details=this.details,workorderHazard=this.workorderHazard,selectedData=this.$getProperty(field,"selectedItems",[]),workorderPrecaution={workorder:{id:details.id},workorderHazard:{id:workorderHazard.id}},result=selectedData.map((function(data){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},workorderPrecaution),{},{precaution:{id:null===data||void 0===data?void 0:data.value}})}));this.saveRecord(result)},getViewDetails:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api/* API */.bl.get("v2/views/".concat(_this2.viewname),{moduleName:"hazardPrecaution"});case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop()}}),_callee2)})))()},getRecordList:function(extraParams){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _this3$details,filter,params,recordList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return filter={workorder:{operatorId:EQUALS_OPERATOR,value:["".concat(null===(_this3$details=_this3.details)||void 0===_this3$details?void 0:_this3$details.id)]}},params=(0,objectSpread2/* default */.Z)({moduleName:"workorderHazardPrecaution",withCount:!0,filters:filter,force:!0,viewname:"hidden-all",perPage:_this3.perPage},extraParams),_context3.next=4,CustomModuleData/* CustomModuleData */.u.fetchAll(params);case 4:if(_context3.t0=_context3.sent,_context3.t0){_context3.next=7;break}_context3.t0=[];case 7:return recordList=_context3.t0,_context3.abrupt("return",recordList.map((function(data){return new CustomModuleData/* CustomModuleData */.u((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},data),{},{hazard:data.workorderHazard.hazard}))})));case 9:case"end":return _context3.stop()}}),_callee3)})))()},saveRecord:function(records){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _this4.isLoading=!0,url="v3/modules/data/bulkCreate",params={data:{workorderHazardPrecaution:records},moduleName:_this4.moduleName,params:{return:!0}},_context4.next=5,api/* API */.bl.post(url,params);case 5:_yield$API$post=_context4.sent,error=_yield$API$post.error,error?_this4.$message.error((null===error||void 0===error?void 0:error.message)||_this4.$t("common.safetyPlan.error_occured")):_this4.$message.success(_this4.$t("common.safetyPlan.precaution_added")),_this4.init(),_this4.isLoading=!1;case 10:case"end":return _context4.stop()}}),_callee4)})))()},setWorkOrderHazard:function(id){var result=(this.woHazards||[]).find((function(hazard){return hazard.id===id})),hazardId=this.$getProperty(result,"hazard.id",null);this.workorderHazard={hazard:hazardId,id:id}},getStringifyHazards:function(selectedHazard){return(0,validation/* isEmpty */.xb)(selectedHazard)?null:selectedHazard.map((function(id){return"".concat(id)}))},fetchWorkOrderHazards:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var details,_ref4,id,relatedFieldName,relatedConfig,params,_yield$API$fetchAllRe,error,list;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return _this5.isLoading=!0,details=_this5.details,_ref4=details||{},id=_ref4.id,relatedFieldName=(0,relatedFieldUtil/* getRelatedFieldName */.C9)("workorder","workorderHazard"),relatedConfig={moduleName:"workorder",id:id,relatedModuleName:"workorderHazard",relatedFieldName:relatedFieldName},params={viewname:"hidden-all",perPage:50},_context5.next=8,api/* API */.bl.fetchAllRelatedList(relatedConfig,params,{force:!0});case 8:_yield$API$fetchAllRe=_context5.sent,error=_yield$API$fetchAllRe.error,list=_yield$API$fetchAllRe.list,error?_this5.$error.message(error.message||"Error Occured"):(0,validation/* isEmpty */.xb)(list)||(_this5.woHazards=list),_this5.isLoading=!1;case 13:case"end":return _context5.stop()}}),_callee5)})))()}}},component_WorkorderHazardPrecautionvue_type_script_lang_js=WorkorderHazardPrecautionvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(component_WorkorderHazardPrecautionvue_type_script_lang_js,render,staticRenderFns,!1,null,"5b3c099e",null)
/* harmony default export */,WorkorderHazardPrecaution=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/7817.js.map