"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[31602],{
/***/736663:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */W$:function(){/* binding */return PlannerTypes}
/* harmony export */});
/* unused harmony exports calendarSettings, timeMetricConstants */
var PlannerTypes={ASSET_PLANNER:1,STAFF_PLANNER:2,SPACE_PLANNER:3}},
/***/801576:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(595082),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(488478),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_18__=(__webpack_require__(879288),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(670560),__webpack_require__(450886),__webpack_require__(434284),__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(947522),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(821552),__webpack_require__(990260)),_facilio_utils_field__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(815872),util_utility_methods__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(773258),src_components_mixins_NewDateHelper__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(105534),viewStateMeta=(__webpack_require__(911790),(0,util_utility_methods__WEBPACK_IMPORTED_MODULE_15__/* .makeObjectNonReactive */.ge)({
//start and end values for each view are maintained
DAY:{operatorID:62,pickerTabName:"D",displayName:"D",start:null,end:null,grouping:"4H",gridLines:"1H",showGridLineHeaders:!0,displayType:"dateTime"},WEEK:{operatorID:63,pickerTabName:"W",displayName:"W",start:null,end:null,grouping:null,gridLines:"W",showGridLineHeaders:!0,displayType:"subject"},MONTH:{operatorID:64,pickerTabName:"M",displayName:"M",start:null,end:null,grouping:null,gridLines:"DAY",showGridLineHeaders:!0,displayType:"dateTime"},YEAR:{operatorID:65,pickerTabName:"Y",displayName:"Y",start:null,end:null,grouping:"MONTH",gridLines:"WEEK",showGridLineHeaders:!0,displayType:"frequency"}}));
/* harmony import */
/* harmony default export */__webpack_exports__.Z={props:{allowUserSettings:{default:!0},defaultSettings:{type:Object},views:{type:Array,default:function(){return["DAY","WEEK","MONTH","YEAR"]}},defaultView:{type:String,default:function(){return this.views[0]}},startRange:{type:Number},isDragDropAllowed:{type:Boolean,default:!0}},data:function(){return{currentView:null,
//DAY/WEEK/MONTH/YEAR,
plannerSettings:null,viewState:{},timeZone:null,showPicker:!1,pickerObj:null,isFullScreen:!1,loading:!0,taskList:[],showSettings:!1,gridColumns:[],groupColumns:[],currentDate:this.$helpers.getOrgMoment().valueOf(),currentDateCol:null,daysInWeek:this.getDaysInWeek()}},
/* Planner/calendar flow
    On create copy set up whatever views passed in props to internal state
    On mount Load settings ,once settings loaded initialize time values etc for the views present
    Emit a initial change event to load data from consuming component
  */
created:function(){this.timeZone=this.$timezone,//needed for picker
this.intiViewStateObj()},mounted:function(){var _this=this;
/* load settings from server and use that to initPlanner
    or if default setting given by user ,use them
    once settings obtained init the planner state and fire a initial change event to load data*/this.allowUserSettings?this.loadSettings().then((function(settingData){_this.plannerSettings=settingData,
//load custom field list to display in legend setting
_this.$http.get("/module/meta?moduleName=workorder").then((function(resp){var _this$legendOptions;_this.customEnumFields=resp.data.meta.fields.filter((function(e){return!e.default})).filter((function(e){return(0,_facilio_utils_field__WEBPACK_IMPORTED_MODULE_14__/* .isEnumField */.Ri)(e)})),(_this$legendOptions=_this.legendOptions).push.apply(_this$legendOptions,(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)(_this.customEnumFields.map((function(e){return{name:e.name,displayName:e.displayName}}))))})),_this.initPlanner()})):this.defaultSettings&&(this.plannerSettings=this.defaultSettings,this.initPlanner())},computed:{currentViewState:function(){return this.viewState[this.currentView]}},methods:{syncTabInQuery:function(){
//sync start and end times of least supported view only ,
this.$router.replace({query:(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)({},this.$route.query),{},{calendarTab:this.currentView,startTime:this.viewState[this.views[0]].start,endTime:this.viewState[this.views[0]].end})})},getDaysInWeek:function(){var weekDaysInLocale=[],dayOfWeek=this.$helpers.getOrgMoment();dayOfWeek.startOf("week");for(var i=0;i<7;i++)weekDaysInLocale.push(dayOfWeek.format("ddd")),dayOfWeek.add(1,"day");return weekDaysInLocale},
/* 4 views ,DAY ,WEEK ,MONTH ,YEAR */
/* Initialize meta for only views chosen by user */
intiViewStateObj:function(){var _this2=this;this.views.forEach((function(view){_this2.$set(_this2.viewState,view,(0,util_utility_methods__WEBPACK_IMPORTED_MODULE_15__/* .deepCloneObject */.kh)(viewStateMeta[view]))})),this.currentView=this.defaultView,
//if user is refreshing persist the view,if view supported in current planner
this.$route.query.calendarTab&&this.views.includes(this.$route.query.calendarTab)&&(this.currentView=this.$route.query.calendarTab)},initPlanner:function(){this.initStateFromSettings(),this.$route.query.startTime?this.setViews(Number.parseInt(this.$route.query.startTime)):
//init planner also called when settings are changed , in that  case alone start time exists when init is done..ie maintain last tab /view range before settings change
this.setViews(this.currentViewState.start?this.currentViewState.start:this.$helpers.getOrgMoment().valueOf()),this.setPicker(),this.syncTabInQuery(),this.emitViewChanged()},
/* For each view that exists(props) copy  settings to internal view state object*/initStateFromSettings:function(){var _this3=this;
//Column meta DS different in planner , so copy values to local state and use
(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_18__/* .isEmpty */.xb)(this.plannerSettings)||this.views.forEach((function(view){_this3.viewState[view].gridLines=_this3.plannerSettings.viewSettings[view].gridLines,_this3.viewState[view].grouping="NONE"==_this3.plannerSettings.viewSettings[view].grouping?null:_this3.plannerSettings.viewSettings[view].grouping,_this3.viewState[view].displayType=_this3.plannerSettings.viewSettings[view].displayType,_this3.viewState[view].gridLinesFormat=_this3.plannerSettings.viewSettings[view].gridLinesFormat,(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_18__/* .isNullOrUndefined */.le)(_this3.plannerSettings.viewSettings[view].showGridLineHeaders)||(_this3.viewState[view].showGridLineHeaders=_this3.plannerSettings.viewSettings[view].showGridLineHeaders)}))},emitViewChanged:function(){this.loading=!0,this.$emit("viewChanged",{start:this.getStartTimeStamp(),end:this.getEndTimeStamp(),interval:this.currentViewState.gridLines,settings:this.plannerSettings})},
/*set all views to given date  */setViews:function(date){this.viewState.DAY&&this.setDay(date),this.viewState.WEEK&&this.setWeek(date),this.viewState.MONTH&&this.setMonth(date),this.viewState.YEAR&&this.setYear(date)},setDay:function(date){this.viewState.DAY.start=this.$helpers.getOrgMoment(date).startOf("day").valueOf(),this.viewState.DAY.end=this.$helpers.getOrgMoment(date).endOf("day").valueOf()},setWeek:function(date){this.viewState.WEEK.start=this.$helpers.getOrgMoment(date).startOf("week").valueOf(),this.viewState.WEEK.end=this.$helpers.getOrgMoment(date).endOf("week").valueOf()},setMonth:function(date){this.viewState.MONTH.start=this.$helpers.getOrgMoment(date).startOf("month").valueOf(),this.viewState.MONTH.end=this.$helpers.getOrgMoment(date).endOf("month").valueOf()},setYear:function(date){this.viewState.YEAR.start=this.$helpers.getOrgMoment(date).startOf("year").valueOf(),this.viewState.YEAR.end=this.$helpers.getOrgMoment(date).endOf("year").valueOf()},
/* ******* */datePickerTabs:function(){var temp={enableByOperationOnId:!0,disableDefaultLabels:!0},enabledTabs=[];return this.views.forEach((function(view){enabledTabs.push(viewStateMeta[view].pickerTabName)})),temp["enabledTabs"]=enabledTabs,temp["loadAdditional"]={year:{period:"start",label:"year",operation:"add",value:4}},temp},
/* need to keep state of all view tabs in sync with picker 2 WAY SYNC */
/* user changes date range view colheader click or view tab click , eg month to week or drill down on a day  in month view*/
setPicker:function(){var _this4=this;this.showPicker=!1,this.pickerObj=src_components_mixins_NewDateHelper__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */.Z.getDatePickerObject(this.currentViewState.operatorID,""+this.currentViewState.start),this.$nextTick((function(){_this4.showPicker=!0}))},
/* User changes range via the pick , now sync the views to picker range */navigateFromPicker:function(event){this.goToRange(event.value[0],event.operationOn.toUpperCase())},
/* Today button , go to range that has today in whichever view is active */todayClicked:function(){this.currentDateCol?
//if current view has today return
this.scrollColToView():(this.setViews(this.$helpers.getOrgMoment()),//init all views to current date
this.setPicker(),this.emitViewChanged())},handleViewTabClick:function(view){this.switchView(view),this.setPicker()},goToRange:function(date,view){
//reset data for all views in sync with specified date
//change current view to desired view
//if view exists drill down , EX , in day view grid interval can be 1 HR , but 1hr can't be shown as a view
this.viewState[view]&&(this.setViews(date),this.switchView(view))},
/*  While switching views  , tab state ie date is not reset ,
      Eg , in month currently viewing jan, week is set to jan 1st week (starting from first sun of week in 1st jan)
      state in both views is now , week 1-7 jan timestamp , month 1-30 timestamp. state is only reset when moving left/right via picker
    */
switchView:function(view){this.currentView=view,this.syncTabInQuery(),
//can be done either by click the view name buttons straight or via column headers
//if column headers go the exact time , else set defaults
this.clearAllSelections(),
//TO DO , move this to the resoure planner hook with same method name
this.emitViewChanged()},generateColumnData:function(){var _this5=this;performance.now();
//initialize a list of   gridLines and  grouplines and
//if grouping is available for view group the gridLines into group lines
this.gridColumns=[];var gridLineTs=this.getStartTimeStamp(),gridLineEndTimeStamp=this.getEndTimeStamp(),gridIndex=0;this.currentDateCol=null;
//create and initialize gridline array
while(gridLineTs<=gridLineEndTimeStamp){var colStart=gridLineTs;gridLineTs=this.getNextTimeStamp(gridLineTs,this.viewState[this.currentView].gridLines);var colEnd=gridLineTs,column={start:colStart,end:colEnd,tasks:[],index:gridIndex,label:this.getHeader(colStart,this.viewState[this.currentView].gridLines,this.viewState[this.currentView].gridLinesFormat)};this.gridColumns[gridIndex]=column,
//mark past dates ,
this.currentDate<=colStart?column.past=!1:column.past=!0,
//find current date column if present within current daterange
this.currentDate>=colStart&&this.currentDate<colEnd&&(this.currentDateCol=column),gridIndex++}
//after gridLines generate grouplines if required , EX, Year view weekly grid and group by month
if(this.viewState[this.currentView].grouping){this.groupColumns=[];
//for weeks grouped by month alone do a bit of special handling but  going to start of first month
var groupLineTs=this.$helpers.getOrgMoment(this.getStartTimeStamp()).startOf(this.viewState[this.currentView].grouping).valueOf(),groupIndex=0,groupEnd=this.getEndTimeStamp();
//create and initialize group array with each entry having groupline start time and empty gridarray
while(groupLineTs<=groupEnd){var groupColStart=groupLineTs;groupLineTs=this.getNextTimeStamp(groupLineTs,this.viewState[this.currentView].grouping);var groupColEnd=groupLineTs;this.groupColumns[groupIndex]={start:groupColStart,gridColumns:[],end:groupColEnd,label:this.getHeader(groupColStart,this.viewState[this.currentView].grouping)},groupIndex++}groupIndex=0,
//columns are put inside the groups based of their start time,for week and monthy grouping when a week spans across months it's put inside it's start month group
this.gridColumns.forEach((function(e){while(e.start>=_this5.groupColumns[groupIndex].end)groupIndex++;//go to correct groupline and insert gridline into it
_this5.groupColumns[groupIndex].gridColumns.push(e)})),
//weekly grid with monthly grouping results in the last group being empty
//check and remove this below
0==this.groupColumns[this.groupColumns.length-1].gridColumns.length&&this.groupColumns.pop(),
//mark the last column in each group as last , //needed for darker css border on each group boundary
this.groupColumns.forEach((function(group){group.gridColumns.forEach((function(gridColumn,gridColIndex){gridColIndex==group.gridColumns.length-1&&(gridColumn.isGroupBoundary=!0)}))}))}},spreadTasksToColumns:function(){var _this6=this,gridIndex=0;
//spread out  task data into multiple columns based on gridlines , put each task in correct columns,
this.taskList.some((function(task){if(task.start>=_this6.gridColumns[_this6.gridColumns.length-1].end)return!0;
//break out of loop when one of the tasks exceeds end column in grid
_this6.formatLabel(task);
//iterate through tasklist list,
//for each task go to the correct grid(column) and insert
while(task.start>=_this6.gridColumns[gridIndex].end)gridIndex++;return _this6.$set(task,"selection",!1),_this6.gridColumns[gridIndex].tasks.push(task),!1}))},
//this is required to handle weekly split alone
getStartTimeStamp:function(){var timeStamp=this.viewState[this.currentView].start;return"WEEK"!=this.viewState[this.currentView].gridLines&&"WEEK"!=this.viewState[this.currentView].grouping||(timeStamp=this.$helpers.getOrgMoment(timeStamp).startOf("week").valueOf()),timeStamp},getEndTimeStamp:function(){var timeStamp=this.viewState[this.currentView].end;return"WEEK"!=this.viewState[this.currentView].gridLines&&"WEEK"!=this.viewState[this.currentView].grouping||(timeStamp=this.$helpers.getOrgMoment(timeStamp).endOf("week").valueOf()),timeStamp},
//methods is used for both column ts next and task drop
//TO DO remove startof call
getNextTimeStamp:function(timeStamp,interval){var count=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;switch(interval){case"WEEK":return this.$helpers.getOrgMoment(timeStamp).add(count,"week").valueOf();case"DAY":return this.$helpers.getOrgMoment(timeStamp).add(count,"day").valueOf();case"MONTH":return this.$helpers.getOrgMoment(timeStamp).add(count,"month").valueOf();case"4H":
//todo make this more generic
return this.$helpers.getOrgMoment(timeStamp).add(4*count,"hours").valueOf();case"1H":return this.$helpers.getOrgMoment(timeStamp).add(count,"hours").valueOf();case".5H":return this.$helpers.getOrgMoment(timeStamp).add(.5*count,"hours").valueOf();case"QUARTER":return this.$helpers.getOrgMoment(timeStamp).startOf("quarter").add(count,"quarter").valueOf()}},getHeader:function(timeStamp,interval,userFormat){var formatMoment=this.$helpers.getOrgMoment(timeStamp),formatString="";if(userFormat)return formatMoment.format(userFormat);switch(interval){case"DAY":
//return "DD";
formatString=formatMoment.format("DD ddd");break;case"WEEK":formatString=formatMoment.format("ww")+" W";break;
//return "D ddd";
case"MONTH":formatString=formatMoment.format("MMM");break;case"4H":formatString=formatMoment.format("h a")+" - "+this.$helpers.getOrgMoment(this.getNextTimeStamp(formatMoment,interval)).format("h a");break;
// return "h a";
case"1H":formatString=formatMoment.format("h a");break;case".5H":formatString=formatMoment.format("h a");break;case"QUARTER":formatString=formatMoment.format("Qo")+" Quarter";break}return formatString},getLabelFormat:function(interval){switch(interval){case"DAY":return"hh a";case"WEEK":
// return "ww";
return"DD ddd";case"MONTH":return"DD ddd";case"1H":return"hh:mm a";case".5H":return"hh:mm a"}}}}},
/***/911790:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(513087),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(862833),Cell=function(){function Cell(rowId,colId,rowIndex,colIndex){(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(this,Cell),this.rowId=rowId,this.colId=colId,this.rowIndex=rowIndex,this.colIndex=colIndex,this.cellID=rowIndex+""+colIndex}return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)(Cell,[{key:"equals",value:function(otherCell){return!!otherCell&&otherCell.cellID==this.cellID}}]),Cell}();
/* harmony import */
/* harmony default export */__webpack_exports__.Z=Cell},
/***/279729:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150124),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(548534),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(595082),vuex__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(169358),__webpack_require__(538077),__webpack_require__(425728),__webpack_require__(420629));
/* harmony import */
/* harmony default export */__webpack_exports__.Z={computed:(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */.Z)({},(0,vuex__WEBPACK_IMPORTED_MODULE_9__/* .mapState */.rn)({ticketCategory:function(state){return state.ticketCategory},ticketPriority:function(state){return state.ticketPriority},ticketType:function(state){return state.ticketType}})),methods:{colorCodeWorkOrders:function(legendAttribute,workorders,timeMetricSettings){var _this=this;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().mark((function _callee(){var legendMap,resp,customField,customFieldName,customFieldEnum;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:
//this.$store.dispatch('loadTicketStatus', 'workorder')
legendMap={},_context.t0=legendAttribute,_context.next="none"===_context.t0?5:"category"===_context.t0?7:"priority"===_context.t0?12:"type"===_context.t0?17:"frequency"===_context.t0?22:"timeMetric"===_context.t0?25:28;break;case 5:return workorders.forEach((function(wo){wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 7:return _context.next=9,_this.$store.dispatch("loadTicketCategory");case 9:return _this.ticketCategory.forEach((function(e,index){legendMap[e.id]={colorIndex:index,name:e.name}})),workorders.forEach((function(wo){wo.category?wo.colorIndex=legendMap[wo.category.id].colorIndex:wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 12:return _context.next=14,_this.$store.dispatch("loadTicketPriority");case 14:return _this.ticketPriority.forEach((function(e,index){legendMap[e.id]={name:e.displayName,colorIndex:index}})),workorders.forEach((function(wo){wo.priority?wo.colorIndex=legendMap[wo.priority.id].colorIndex:wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 17:return _context.next=19,_this.$store.dispatch("loadTicketType");case 19:return _this.ticketType.forEach((function(e,index){legendMap[e.id]={colorIndex:index,name:e.name}})),workorders.forEach((function(wo){wo.type?wo.colorIndex=legendMap[wo.type.id].colorIndex:wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 22:return Object.keys(_this.$constants.FACILIO_FREQUENCY).forEach((function(e,index){legendMap[e]={colorIndex:index,name:_this.$constants.FACILIO_FREQUENCY[e]}})),workorders.forEach((function(wo){wo.frequencyID?wo.colorIndex=legendMap[wo.frequencyID].colorIndex:wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 25:return timeMetricSettings.filter((function(metric){return metric.enabled})).forEach((function(e,index){
//no id feild
legendMap[e.name]={colorIndex:index,name:e.displayName}})),workorders.forEach((function(wo){wo.time?wo.colorIndex=legendMap[wo.time].colorIndex:wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 28:return _context.next=30,_this.$http.get("/module/meta?moduleName=workorder");case 30:return resp=_context.sent,customField=resp.data.meta.fields.find((function(e){return e.name==legendAttribute})),customFieldName=customField.name,customFieldEnum=customField.enumMap,Object.keys(customFieldEnum).forEach((function(e,index){legendMap[e]={colorIndex:index,name:customFieldEnum[e]}})),workorders.forEach((function(wo){wo[customFieldName]?
//pmplanner jobs custom field is a property of wo object
wo.colorIndex=legendMap[wo[customFieldName]].colorIndex:wo.data&&wo.data[customFieldName]?
//in calendar jobs format is   wo{ data:{customFieldName:vale}}
wo.colorIndex=legendMap[wo.data[customFieldName]].colorIndex:wo.colorIndex=-1})),_context.abrupt("return",legendMap);case 38:case"end":return _context.stop()}}),_callee)})))()}}}},
/***/910036:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PlannerAPICalls}});
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js
var regeneratorRuntime=__webpack_require__(150124),objectSpread2=__webpack_require__(595082),asyncToGenerator=__webpack_require__(548534),http=(__webpack_require__(260228),__webpack_require__(212826),__webpack_require__(648324),__webpack_require__(634338),__webpack_require__(821057),__webpack_require__(450886),__webpack_require__(218430)),CalendarConstants=__webpack_require__(736663),validation=__webpack_require__(990260),PlannerApiCalls={getStaffJobs:function(range,siteId,buildingId,teamId,woFilters){return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var url,params,filters,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:
//fetch all workorders for a PM for given duration
return url="/v2/workorders/newcalendar/list/all",params={
// page: 1,
perPage:-1,filters:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},woFilters),{},{
// pm: {
//   operatorId: 36,
//   value: [this.pm.id+""],
// },
//siteId: { operatorId: 36, value: [siteId + ''] },
sourceType:{operatorId:9,value:["5"]},scheduledStart:{operatorId:20,value:[range.start.toString(),range.end.toString()]}}),orderBy:"createdTime",orderType:"desc",includeParentFilter:!0},!(0,validation/* isEmpty */.xb)(siteId)&&siteId>0&&(filters=params.filters,filters=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},filters),{},{siteId:{operatorId:36,value:[siteId+""]}}),params.filters=filters),buildingId&&(params.filters.resource={operatorId:38,value:[buildingId+""]}),teamId&&(params.filters.assignmentGroup={operatorId:36,value:[teamId+""]}),url+="?perPage="+params.perPage+"&filters="+encodeURI(JSON.stringify(params.filters))+"&orderBy="+params.orderBy+"&orderType="+params.orderType+"&includeParentFilter="+params.includeParentFilter,_context.prev=6,_context.next=9,http/* default */.ZP.get(url);case 9:return resp=_context.sent,_context.abrupt("return",resp);case 13:_context.prev=13,_context.t0=_context["catch"](6);case 16:case"end":return _context.stop()}}),_callee,null,[[6,13]])})))()},deleteWorkOrder:function(){var _arguments=arguments;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var url,_len,workorderIDs,_key,reqJSON,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:for(url="workorder/delete",_len=_arguments.length,workorderIDs=new Array(_len),_key=0;_key<_len;_key++)workorderIDs[_key]=_arguments[_key];return reqJSON={id:[].concat(workorderIDs)},_context2.prev=3,_context2.next=6,http/* default */.ZP.post(url,reqJSON);case 6:return resp=_context2.sent,_context2.abrupt("return",resp.data);case 10:throw _context2.prev=10,_context2.t0=_context2["catch"](3),Error("error in workorder delete API");case 14:case"end":return _context2.stop()}}),_callee2,null,[[3,10]])})))()},getBookings:function(spaceList,calEvent){return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var url,filterJson,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return url="v2/reservations/view/all?",filterJson={},filterJson.space={operator:"is",value:spaceList.map((function(e){return e.id+""}))},filterJson.scheduledStartTime={operator:"is before",value:[calEvent.end+""]},filterJson.scheduledEndTime={operator:"is after",value:[calEvent.start+""]},url+="filters=".concat(encodeURIComponent(JSON.stringify(filterJson))),_context3.next=9,http/* default */.ZP.get(url);case 9:return resp=_context3.sent,_context3.abrupt("return",resp.data);case 11:case"end":return _context3.stop()}}),_callee3)})))()},filteredSpaceList:function(spaceFilter){return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var url,filterJson,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return url="space?",filterJson={reservable:{operator:"is",value:["true"]}},filterJson.site={operator:"is",value:[""+spaceFilter.siteId]},
// spaceType:{operator:"=",value:["4"]},
//url+=`siteId=${spaceFilter.siteId}`
spaceFilter.buildingId&&(filterJson.building={operator:"is",value:[""+spaceFilter.buildingId]}),spaceFilter.floorId&&(filterJson.floor={operator:"is",value:[""+spaceFilter.floorId]}),url+="filters=".concat(encodeURIComponent(JSON.stringify(filterJson))),_context4.next=8,http/* default */.ZP.get(url);case 8:return resp=_context4.sent,_context4.abrupt("return",resp.data);case 10:case"end":return _context4.stop()}}),_callee4)})))()},getAllJobs:function(assetSpaceFilter,woFilter,plannerEvent,plannerTypeEnum){return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var params,url,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return params={siteId:assetSpaceFilter.siteId||null,buildingId:assetSpaceFilter.buildingId||null,categoryId:assetSpaceFilter.assetCategoryId||null,
//clearable el select puts '' as empty option
floorId:assetSpaceFilter.floorId||null,dateRange:{startTime:plannerEvent.start,endTime:plannerEvent.end},plannerType:CalendarConstants/* PlannerTypes */.W$[plannerTypeEnum]},woFilter&&(params.filterJson=woFilter),url="/v2/pmplanner/jobs",_context5.prev=3,_context5.next=6,http/* default */.ZP.post(url,params);case 6:return resp=_context5.sent,_context5.abrupt("return",resp.data.result.result);case 11:throw _context5.prev=11,_context5.t0=_context5["catch"](3),Error("Error in fetching PM planner jobs",_context5.t0);case 15:case"end":return _context5.stop()}}),_callee5,null,[[3,11]])})))()},assignStaff:function(woId,userId){return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var url,workorder;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:return url="/v2/pmplanner/jobs/update",workorder={id:woId},workorder.assignedTo={id:userId},_context6.next=5,http/* default */.ZP.post(url,{workorder:workorder}).then((function(resp){}));case 5:_context6.sent;case 6:case"end":return _context6.stop()}}),_callee6)})))()}},PlannerAPICalls=PlannerApiCalls;
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
},
/***/195123:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */$A:function(){/* binding */return getResourcePlaceholder},
/* harmony export */B3:function(){/* binding */return SCOPE_CATEGORY_PLACEHOLDER},
/* harmony export */C7:function(){/* binding */return PUBLISH_STATUS},
/* harmony export */Fl:function(){/* binding */return getCategoryFilter},
/* harmony export */G9:function(){/* binding */return PUBLISHED_STATUS_ICON_HASH},
/* harmony export */Iq:function(){/* binding */return PUBLISHED_STATUS},
/* harmony export */QY:function(){/* binding */return JOB_PLAN_SCOPE},
/* harmony export */Sb:function(){/* binding */return getPlaceholderText},
/* harmony export */UC:function(){/* binding */return FREQUENCY_HASH},
/* harmony export */mO:function(){/* binding */return SCOPE_PLACEHOLDER},
/* harmony export */oL:function(){/* binding */return PUBLISHED_STATUS_ICON_COLOR_HASH}
/* harmony export */});
/* unused harmony export SCOPE_CATEGORY_SINGULAR_PLACEHOLDER */
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(482482),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(756532),__webpack_require__(990260)),dlv__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(226905),dlv__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(dlv__WEBPACK_IMPORTED_MODULE_4__),JOB_PLAN_SCOPE={ASSETS:1,SPACES:2,ASSETCATEGORY:3,SPACECATEGORY:4,BUILDINGS:5,SITES:6,FLOORS:7},SCOPE_CATEGORY_PLACEHOLDER={ASSETS:"Assets",SPACES:"Spaces",ASSETCATEGORY:"Assets",SPACECATEGORY:"Spaces",BUILDINGS:"Buildings",SITES:"Sites",FLOORS:"Floors"},SCOPE_PLACEHOLDER={ASSETS:"Assets",SPACES:"Spaces",ASSETCATEGORY:"Asset Category",SPACECATEGORY:"Space Category",BUILDINGS:"Buildings",SITES:"Sites",FLOORS:"Floors"},SCOPE_CATEGORY_SINGULAR_PLACEHOLDER={ASSETS:"Asset",SPACES:"Space",ASSETCATEGORY:"Asset",SPACECATEGORY:"Space",BUILDINGS:"Building",SITES:"Site",FLOORS:"Floor"},PUBLISH_STATUS={Unpublish:1,Publish:2,Disable:3,"Pending Revision":4,Revised:5},PUBLISHED_STATUS={1:"Unpublished",2:"Published",3:"Disabled",4:"Pending Revision",5:"Revised"},PUBLISHED_STATUS_ICON_HASH={1:"unpublish",2:"published",3:"disabled",4:"pending-revision",5:"revised"},PUBLISHED_STATUS_ICON_COLOR_HASH={unpublish:"#ff5533",published:"#009945",disabled:"#b8c0c6","pending-revision":"#fa942e",revised:"#71818e"},FREQUENCY_HASH={3:"MONTHLY_DATE",4:"MONTHLY_WEEK",5:"ANNUALLY_DATE",6:"ANNUALLY_WEEK",7:"QUARTERLY_DATE",8:"QUARTERLY_WEEK",9:"HALF_YEARLY_DATE",10:"HALF_YEARLY_WEEK"},getResourcePlaceholder=function(pmRecord,isUpperCase,isSingular){var placeholder="Resource";if(!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(pmRecord)){var _ref=pmRecord||{},assignmentTypeEnum=_ref.assignmentTypeEnum;placeholder=isSingular?SCOPE_CATEGORY_SINGULAR_PLACEHOLDER[assignmentTypeEnum]||"Resource":SCOPE_CATEGORY_PLACEHOLDER[assignmentTypeEnum]||"Resource"}return isUpperCase||(placeholder=placeholder.toLowerCase()),placeholder},getPlaceholderText=function(props){var _ref2=props||{},pmRecord=_ref2.pmRecord,text=_ref2.text,isUpperCase=_ref2.isUpperCase,modifyText=_ref2.modifyText,replaceAll=_ref2.replaceAll,isSingular=_ref2.isSingular,resourcePlaceholder=getResourcePlaceholder(pmRecord,isUpperCase,isSingular),replaceableText="Resources";return isUpperCase||(replaceableText="resources",resourcePlaceholder=resourcePlaceholder.toLowerCase()),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(modifyText)||(replaceableText=modifyText),replaceAll?text.replaceAll(replaceableText,resourcePlaceholder):text.replace(replaceableText,resourcePlaceholder)};
/* harmony import */function getCategoryFilter(pmRecord,category){var categoryHash={3:"assetCategory",4:"spaceCategory"},categoryFilter={},selectedCategory=categoryHash[category]||{};if(!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(selectedCategory)){var categoryId=dlv__WEBPACK_IMPORTED_MODULE_4___default()(pmRecord,"".concat(selectedCategory,".id"),null);(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(categoryId)||(categoryFilter=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)({},selectedCategory,{operatorId:54,value:["".concat(categoryId)]}))}return categoryFilter}
/***/},
/***/730347:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */E:function(){/* binding */return getSites},
/* harmony export */x:function(){/* binding */return getBuildings}
/* harmony export */});
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150124),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(595082),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(548534),util_picklist__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(450886),__webpack_require__(961358)),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(990260);
/* harmony import */function getSites(_x){return _getSites.apply(this,arguments)}function _getSites(){return _getSites=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().mark((function _callee(props){var _ref,searchText,filters,sites,params;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _ref=props||{},searchText=_ref.searchText,filters=_ref.filters,sites=[],params={field:{lookupModuleName:"site"}},(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(searchText)?(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(filters)||(params=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)({},params),{},{field:{filters:filters}})):params=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)({},params),{},{searchText:searchText}),_context.next=6,(0,util_picklist__WEBPACK_IMPORTED_MODULE_4__/* .getFieldOptions */._K)(params).then((function(_ref2){var error=_ref2.error,options=_ref2.options;if(!error)return options=(options||[]).map((function(option){var _ref3=option||{},label=_ref3.label,value=_ref3.value;return{id:value,name:label}})),options}));case 6:return sites=_context.sent,_context.abrupt("return",sites);case 8:case"end":return _context.stop()}}),_callee)}))),_getSites.apply(this,arguments)}function getBuildings(_x2){return _getBuildings.apply(this,arguments)}function _getBuildings(){return _getBuildings=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().mark((function _callee2(props){var _ref4,searchText,filters,siteId,buildings,params;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _ref4=props||{},searchText=_ref4.searchText,filters=_ref4.filters,siteId=_ref4.siteId,buildings=[],params={field:{lookupModuleName:"building"}},(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(searchText)||(params=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)({},params),{},{searchText:searchText})),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(filters)||(params=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)({},params),{},{field:{filters:filters}})),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_5__/* .isEmpty */.xb)(siteId)||(params=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)({},params),{},{siteId:siteId})),_context2.next=8,(0,util_picklist__WEBPACK_IMPORTED_MODULE_4__/* .getFieldOptions */._K)(params).then((function(_ref5){var error=_ref5.error,options=_ref5.options;if(!error)return options=(options||[]).map((function(option){var _ref6=option||{},label=_ref6.label,value=_ref6.value;return{id:value,name:label}})),options}));case 8:return buildings=_context2.sent,_context2.abrupt("return",buildings);case 10:case"end":return _context2.stop()}}),_callee2)}))),_getBuildings.apply(this,arguments)}
/***/},
/***/225464:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(554621),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(450886),__webpack_require__(300268),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(336585),__webpack_require__(648324),__webpack_require__(990260)),_facilio_api__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(32284),src_util_helpers_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(778390);
/* harmony import */
/* harmony default export */__webpack_exports__.Z={methods:{serializePayloadForV3:function(data){var model={subject:data.subject,siteId:data.siteId.id},assignment=data.assignment;
// user assignmemt
// console.log({data})
// console.log({model})
return assignment&&assignment.assignedTo&&!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(assignment.assignedTo.id)&&(model.assignedTo=assignment.assignedTo),
// group assignmemt
assignment&&assignment.assignmentGroup&&!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(assignment.assignmentGroup.id)&&(model.assignmentGroup=assignment.assignmentGroup),model},serializedData:function(formData,_formModel){var _this=this,sections=this.formObj.sections,moduleDataId=this.moduleDataId,preFillValueForCreationObj=this.preFillValueForCreationObj,isFileTypeFields=this.isFileTypeFields,_ref=_formModel||{},subFormData=_ref.subFormData,isParentWoFieldAvailable=!1;if(sections.forEach((function(section){var fields=section.fields;(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(fields)||fields.forEach((function(field){var name=field.name,fieldObj=field.field,displayTypeEnum=field.displayTypeEnum,_ref2=fieldObj||{},dataTypeEnum=_ref2.dataTypeEnum,value=_formModel[name];if("NUMBER"!==dataTypeEnum&&"DECIMAL"!==dataTypeEnum||(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(value)&&(value=-99),"MULTI_LOOKUP"===dataTypeEnum&&(value=(value||[]).map((function(currId){return{id:currId}}))),!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(value)&&"TASKS"!==displayTypeEnum)
// To differentiate between system and custom fields
if(fieldObj&&!fieldObj.default)if((0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isObject */.Kn)(value))
// For dropdown custom fields have to fetch the value from id
if((0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(value.id)){if("URL_FIELD"===displayTypeEnum){var _value=_formModel[name],_ref3=_value||{},href=_ref3.href;if((0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(href))_value=null;else{var isValidUrl=href.startsWith("http://",0)||href.startsWith("https://",0);isValidUrl||(_value.href="http://"+href)}formData.workorder.data[name]=_value}}else
// Field data type 7 is lookup field
formData.workorder.data[name]=value.id;else isFileTypeFields.includes(displayTypeEnum)?formData.workorder=_this.fileFieldHandler(formData.workorder,field,value):formData.workorder.data[name]=value;else if("siteId"===name||"URGENCY"===displayTypeEnum)formData.workorder[name]=value.id;else if("assignment"===name)for(var assignmentObj in value)(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(value[assignmentObj].id)||(formData.workorder[assignmentObj]={id:value[assignmentObj].id});else(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isObject */.Kn)(value)&&(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(value.id)?formData.workorder[name]=null:formData.workorder[name]=value;"parentWO"===name&&(isParentWoFieldAvailable=!0)}))})),isParentWoFieldAvailable||(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(moduleDataId)||(formData.workorder["parentWO.id"]=moduleDataId),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(subFormData)||(formData.workorder["subFormData"]=subFormData),!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(preFillValueForCreationObj))for(var _i=0,_Object$entries=Object.entries(preFillValueForCreationObj);_i<_Object$entries.length;_i++){var _Object$entries$_i=(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(_Object$entries[_i],1),key=_Object$entries$_i[0],keyValue=formData.workorder[key];(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(keyValue)||["tenant","resource","serviceRequest"].includes(key)&&(formData.workorder["".concat(key,".id")]=parseInt(preFillValueForCreationObj["".concat(key)]))}return formData},removeBlanks:function(model){for(var key in model){var value=model[key];null!==value&&null!==value.id||delete model[key]}return model.resource&&void 0===model.resource.id&&delete model.resource,model},saveRecord:function(formModel){var _this2=this,isLicenseEnabled=src_util_helpers_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */.ZP.isLicenseEnabled,woV3BetaLicense=isLicenseEnabled("WOV3_BETA");if(this.isSaving=!0,woV3BetaLicense){var tasksString=formModel.tasksString,ticketattachments=formModel.ticketattachments,model=this.serializePayloadForV3(formModel);(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(ticketattachments)||(model["ticketattachments"]=ticketattachments),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(tasksString)||(model["tasksString"]=tasksString);var params={data:model,moduleName:"workorder"};_facilio_api__WEBPACK_IMPORTED_MODULE_10__/* .API */.bl.post("v3/modules/data/create",params).then((function(response){_this2.successHandler(response)})).finally((function(){return _this2.isSaving=!1}))}else{
//console.log('creating wo with v2')
var _tasksString=formModel.tasksString,_ticketattachments=formModel.ticketattachments;delete formModel.ticketattachments,delete formModel.tasksString;var selectedForm=this.selectedForm,formId=(selectedForm||{}).id,formData={workorder:{data:{},formId:formId||-1}};this.isSaving=!0;var serializedData=this.serializedData(formData,formModel);(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(_ticketattachments)||(serializedData["ticketattachments"]=_ticketattachments),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_12__/* .isEmpty */.xb)(_tasksString)||(serializedData["tasksString"]=JSON.stringify(_tasksString)),_facilio_api__WEBPACK_IMPORTED_MODULE_10__/* .API */.bl.post("v2/workorders/add",serializedData).then((function(response){_this2.successHandler(response)})).finally((function(){return _this2.isSaving=!1}))}}}}},
/***/865764:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(488478),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(103336),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(150124),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(548534),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(595082),_PreviewFile__WEBPACK_IMPORTED_MODULE_21__=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(425728),__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(169358),__webpack_require__(450886),__webpack_require__(634338),__webpack_require__(228436),__webpack_require__(865137),__webpack_require__(339772),__webpack_require__(720096)),util_helpers__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(778390),moment_timezone__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(480008),moment_timezone__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_23__),util_util__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(733313),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(990260),vuex__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(420629),src_components_mixins_SpaceCardMixin__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(960170),_workorderTransform__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(112143),util_appUtil__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(843097),_facilio_router__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(329435),util_constant__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(354754),_page_widget_utils_eventBus__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(398011),vue__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(720144),src_pages_setup_organizationSetting_currency_CurrencyUtil_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(15426);
/* harmony import */
/* harmony default export */__webpack_exports__.Z={mixins:[src_components_mixins_SpaceCardMixin__WEBPACK_IMPORTED_MODULE_25__/* ["default"] */.Z,_workorderTransform__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */.Z],created:function(){this.$store.dispatch("loadTicketStatus","workorder"),this.$store.dispatch("loadTicketType"),this.availablePortalApps()},components:{PreviewFile:_PreviewFile__WEBPACK_IMPORTED_MODULE_21__/* ["default"] */.Z},data:function(){return{portalApps:[],selectedPortalApp:[]}},computed:(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */.Z)({},(0,vuex__WEBPACK_IMPORTED_MODULE_32__/* .mapGetters */.Se)(["getTicketStatusByLabel","getCurrentSiteId"])),{},{isNotPortal:function(){var PORTALS=util_constant__WEBPACK_IMPORTED_MODULE_29__/* ["default"] */.Z.appCategory.PORTALS,_getApp=(0,_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .getApp */.wx)(),appCategory=_getApp.appCategory;return appCategory!==PORTALS},recordCurrency:function(){var _ref=this.workorder||{},currencyCode=_ref.currencyCode;return(0,src_pages_setup_organizationSetting_currency_CurrencyUtil_js__WEBPACK_IMPORTED_MODULE_31__/* .getCurrencyForCurrencyCode */.Dg)(currencyCode)}}),methods:{availablePortalApps:function(){var _this=this;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */.Z)().mark((function _callee(){var _yield$loadApps,error,data,applications;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,util_appUtil__WEBPACK_IMPORTED_MODULE_27__/* .loadApps */.jJ)();case 2:_yield$loadApps=_context.sent,error=_yield$loadApps.error,data=_yield$loadApps.data,error?_this.$message.error(error.message||"Error Occured"):(applications=(0,util_appUtil__WEBPACK_IMPORTED_MODULE_27__/* .getFilteredApps */.iN)(data),_this.portalApps=applications.filter((function(app){return"PORTALS"===app.appCategoryEnum}))),_this.portalApps.forEach((function(portal){var obj={appId:portal.id,appSelected:!1,appName:portal.name};_this.selectedPortalApp.push(obj)}));case 7:case"end":return _context.stop()}}),_callee)})))()},updateStatus:function(status){var self=this;if("On Hold"!==status)return"Resolved"===status&&self.workorder.isWorkDurationChangeAllowed?(self.workDurationCallBack=self.setStatusUpdate.bind(self,status),void(self.showWorkDurationDialog=!0)):void self.setStatusUpdate(status);self.rejectWorkOrderDialog()},setStatusUpdate:function(status,actualDuration){var self=this,statusField={id:this.getTicketStatusByLabel(status,"workorder").id,status:status},paramObj={status:statusField},workTimings=[],duration=-1;actualDuration&&(workTimings=actualDuration.workTimings,duration=actualDuration.duration),"Resolved"===status?self.resolveWorkOrder([this.workorder.id],duration,workTimings,statusField):status&&(self.updateWorkOrder([this.workorder.id],paramObj,workTimings),self.$set(self,"workorder.status",statusField))},rejectWorkOrderDialog:function(){var _this2=this,promptObj={title:this.$t("maintenance._workorder.wo_pause_title"),message:this.$t("maintenance._workorder.wo_pause_message"),promptType:"textarea",promptPlaceholder:this.$t("maintenance._workorder.wo_pause_message_area"),rbDanger:!0,rbLabel:this.$t("maintenance._workorder.pause")};this.$dialog.prompt(promptObj).then((function(value){if(null!==value){var newComments={parentModuleLinkName:"ticketnotes",parentId:_this2.workorder.id,body:value,notifyRequester:!1};_this2.setStatusUpdate("On Hold"),_this2.$http.post("v2/notes/add",{note:newComments,module:"ticketnotes",ticketModuleName:"workorder"}).then((function(response){response.data&&0===response.data.responseCode&&(_this2.comments.push(response.data.result.Notes),_this2.reset(),_this2.loadactivitie())}))}}))},formDate:function(time,fomat){return fomat=fomat||"DD-MMM-YYYY",moment_timezone__WEBPACK_IMPORTED_MODULE_23___default()(time).tz(this.$timezone).format(fomat)},fetchWo:function(force){return this.$store.dispatch("workorder/fetchWorkOrder",{id:this.openWorkorderId,force:force})},fetchVendorWo:function(force){return this.$store.dispatch("workorder/fetchVendorWorkOrder",{id:this.openWorkorderId,force:force})},updateEmptyField:function(){"DATE"===this.selectedFieldUpdate.dataTypeEnum||"DATE"===this.selectedFieldUpdate.dataTypeEnum._name||"DATE_TIME"===this.selectedFieldUpdate.dataTypeEnum||"DATE_TIME"===this.selectedFieldUpdate.dataTypeEnum._name?this.$refs.showcustomdatepicker.focus():this.customFieldUpdate=!0},updateCustomFields:function(){var updateCustomfield={};"ENUM"===this.selectedFieldUpdate.dataTypeEnum._name?updateCustomfield[this.selectedFieldUpdate.name]=this.selectedFieldUpdate.enumMap[parseInt(this.selectedFieldValue)]:updateCustomfield[this.selectedFieldUpdate.name]=this.selectedFieldValue,this.updateWorkOrder([this.workorder.id],{data:updateCustomfield}),this.customFieldUpdate=!1},closeUpdateDialog:function(){this.customFieldUpdate=!1},getSiteName:function(siteId){if(this.sites){var s=this.sites.find((function(i){return i.id===siteId}));return s?s.name:"---"}return"---"},openAssetBreakDown:function(assetid,wosubject){this.assetBDSourceDetails.condition=wosubject,this.assetBDSourceDetails.assetid=assetid,this.assetBDSourceDetails.sourceId=this.workorder.id,this.assetBDSourceDetails.sourceType=1,this.showAssetBreakdown=!0},openAsset:function(id){if(id)if((0,_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .isWebTabsEnabled */.tj)()){var _ref2=(0,_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .findRouteForModule */.Jp)("asset",_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .pageTypes */.As.OVERVIEW)||{},name=_ref2.name;name&&this.$router.push({name:name,params:{viewname:"all",id:id}})}else{var url="/app/at/assets/all/"+id+"/overview";this.$router.replace({path:url})}},openPM:function(){if((0,_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .isWebTabsEnabled */.tj)()){var _ref3=(0,_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .findRouteForModule */.Jp)("preventivemaintenance",_facilio_router__WEBPACK_IMPORTED_MODULE_28__/* .pageTypes */.As.OVERVIEW)||{},name=_ref3.name;name&&this.$router.push({name:name,params:{viewname:"all",id:this.workorder.pm.id}})}else this.$router.replace({path:"/app/wo/planned/summary/"+this.workorder.pm.id})},updateSite:function(woId,siteId){var _this3=this;this.$dialog.confirm({title:this.$t("maintenance._workorder.change_site"),message:this.$t("maintenance._workorder.change_site_message"),rbDanger:!0,rbLabel:this.$t("maintenance._workorder.change_site_message_label")}).then((function(value){value&&_this3.updateWorkOrder([woId],{siteId:siteId})}))},setDueDate:function(duedate){this.duedate=-1===duedate?Date.now()-864e5:new Date(duedate)},onChangeDueDate:function(pickVal){this.updateWorkOrderDueDate([this.workorder.id],new Date(pickVal).getTime())},onChangeCustomField:function(pickVal){var updateCustomfield={};updateCustomfield[this.selectedFieldUpdate.name]=new Date(pickVal).getTime(),this.updateWorkOrder([this.workorder.id],{data:updateCustomfield})},back:function(){this.$router.go(-1)},closeAllTask:function(){var ticketId,_this4=this,taskIds=[];for(var idx in this.taskList)for(var idx2 in this.taskList[idx]){var task=this.taskList[idx][idx2];if("OPEN"===task.status.type&&task.isUpdating)return void this.$message({message:this.$t("maintenance._workorder.task_updating"),type:"warning"});ticketId=task.parentTicketId,(null===this.selectedTaskResource||null!==this.selectedTaskResource&&task.resource.id===this.selectedTaskResource&&"OPEN"===task.status.type)&&taskIds.push(this.taskList[idx][idx2].id)}var data={taskIdList:taskIds,parentTicketId:ticketId};null===this.selectedTaskResource?this.$http.post("v2/tasks/closeAllTask",data).then((function(response){if(0===response.data.responseCode){if("Work in Progress"!==_this4.ticketstatusvalue){var statusField=_this4.getTicketStatusByLabel("Work in Progress","workorder"),_ref4=statusField||{},_ref4$id=_ref4.id,statusId=void 0===_ref4$id?-1:_ref4$id;_this4.$set(_this4,"workorder.status.id",statusId)}_this4.loadTasks(),
//this.fetchWo(true) // commented this out, as we're gonna fetch the workorder obj from API, instead of from store
_this4.reloadWorkOrderSummaryToUpdateState(response.data.result)}else _this4.$message.error(response.data.message)})):this.$http.post("/v2/tasks/closeAllTask?resourceId="+this.selectedTaskResource,data).then((function(response){if(0===response.data.responseCode){if("Work in Progress"!==_this4.ticketstatusvalue){var statusField=_this4.getTicketStatusByLabel("Work in Progress"),_ref5=statusField||{},_ref5$id=_ref5.id,statusId=void 0===_ref5$id?-1:_ref5$id;_this4.$set(_this4,"workorder.status.id",statusId)}_this4.loadTasks(),
// this.fetchWo(true) // commented this out, as we're gonna fetch the workorder obj from API, instead of from store
_this4.reloadWorkOrderSummaryToUpdateState(response.data.result)}else _this4.$message.error(response.data.message)}))},loadFields:function(){var _this5=this;this.loading=!0,this.$util.loadModuleMeta("workorder").then((function(meta){_this5.fields=meta.fields,_this5.loading=!1}))},taskStatus:function(task){var _this6=this,completed="OPEN"===task.status.type,data={id:[task.id],task:{id:task.id,parentTicketId:task.parentTicketId,status:{id:completed?this.closedStatusId:this.openStatusId,type:completed?"CLOSED":"OPEN"}}};this.$http.post("v2/tasks/updatestatus",data).then((function(response){if(response.data&&0===response.data.responseCode){if("object"===(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)(response.data)){if(completed?(task.status={id:_this6.closedStatusId,type:"CLOSED"},_this6.$message({message:_this6.$t("maintenance._workorder.task_close_success"),type:"success"})):(task.status={id:_this6.openStatusId,type:"OPEN"},_this6.$message({message:_this6.$t("maintenance._workorder.task_open_success"),type:"success"})),"Work in Progress"!==_this6.ticketstatusvalue){var statusField=_this6.getTicketStatusByLabel("Work in Progress","workorder"),_ref6=statusField||{},_ref6$id=_ref6.id,statusId=void 0===_ref6$id?-1:_ref6$id;_this6.$set(_this6,"workorder.status.id",statusId)}}else _this6.$message({message:_this6.$t("maintenance._workorder.operation_failed"),type:"error"});
//this.fetchWo(true) // commented this out, as we're gonna fetch the workorder obj from API, instead of from store
_this6.forceReloadIfTaskActionExecuted(response);var _ref7=response.data.result||{},_ref7$isTaskActionExe=_ref7.isTaskActionExecuted,isTaskActionExecuted=void 0!==_ref7$isTaskActionExe&&_ref7$isTaskActionExe;isTaskActionExecuted||
// Added this check as forceReloadIfTaskActionExecuted() already has onTransitionSuccess() to reload the page.
_this6.reloadWorkOrderSummaryToUpdateState(response.data.result||{});
// this.$root.$emit('reloadWO')
}else _this6.$message.error(response.data.message)})).catch((function(errorResponse){var defaultMessage=_this6.$t("maintenance._workorder.operation_failed"),_ref8=errorResponse||{},data=_ref8.data,_ref9=data||{},_ref9$message=_ref9.message,message=void 0===_ref9$message?defaultMessage:_ref9$message;_this6.$message.error(message)}))},reloadWorkOrderSummaryToUpdateState:function(response){var _ref10=response||{},_ref10$reloadWorkOrde=_ref10.reloadWorkOrder,reloadWorkOrder=void 0!==_ref10$reloadWorkOrde&&_ref10$reloadWorkOrde;reloadWorkOrder&&_page_widget_utils_eventBus__WEBPACK_IMPORTED_MODULE_30__/* .eventBus */.Y.$emit("refreshWorkOrderPage")},changeTaskStatus:function(task){var _this7=this,_ref11=this.workorder||{},_ref11$preRequestStat=_ref11.preRequestStatus,preRequestStatus=void 0===_ref11$preRequestStat?-1:_ref11$preRequestStat;if(1!==preRequestStatus||4!==preRequestStatus){var isOpen="OPEN"===task.status.type,_ref12=task||{},_ref12$id=_ref12.id,id=void 0===_ref12$id?-1:_ref12$id;if(isOpen&&-1===id)return void this.$message({message:this.$t("maintenance._workorder.please_save_the_task_before_updating_its_status"),type:"warning"});if(isOpen&&1!==task.inputType&&!task.inputValue)return void this.$message({message:this.$t("maintenance._workorder.task_input"),type:"warning"});if(isOpen&&task.isUpdating)return void this.$message({message:this.$t("maintenance._workorder.task_updating"),type:"warning"});isOpen&&this.taskBulkList.length?setTimeout((function(){return _this7.taskStatus(task)}),500):this.taskStatus(task)}},showSpaceAssetChooser:function(){this.visibility=!0},associate:function(selectedObj){this.visibility=!1,this.selectedTask.resource=selectedObj,this.selectedTask.selectedResourceName=selectedObj.name},onReadingChange:function(task,skipValidation){if(task.inputValue)return this.addTask(task,skipValidation)},asyncTaskUpdate:function(){var _this8=this,doValidation=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],skipValidation=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],taskListContext=[],taskBulkListRef=this.taskBulkList;if(this.waitBoolean&&this.taskBulkList&&(this.taskBulkList.filter((function(task){var data={id:task.id,inputValue:task.inputValue,inputValues:task.inputValues,remarks:task.remarks,readingFieldId:task.readingFieldId,attachment:task.attachment};_this8.$helpers.isLicenseEnabled("READING_FIELD_UNITS_VALIDATION")&&(data["readingFieldUnit"]=task.readingFieldUnit),task.inputTime>0&&(data.inputTime=_this8.$helpers.getTimeInOrg(task.inputTime)),3===_this8.readingData&&(data.additionalInfo={isMeterReset:!0,meterResetConsumption:_this8.consumptionData}),taskListContext.push(data)})),taskListContext)){var promise=this.updateTaskList({taskContextList:taskListContext},doValidation,skipValidation);Promise.all([promise]).finally((function(){
/*
                Temporary fix to solve changestatus being called before updatetask command when the input is entered
                and task closed immediately
              */
taskBulkListRef.forEach((function(task){task.isUpdating=!1}))}))}},asyncPreRequestUpdate:function(){var _this9=this,doValidation=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],taskListContext=[],taskBulkListRef=this.taskBulkList;this.waitBoolean&&this.taskBulkList&&(this.taskBulkList.filter((function(task){var data={id:task.id,inputValue:task.inputValue,inputValues:task.inputValues,remarks:task.remarks,readingFieldId:task.readingFieldId,preRequest:!0};task.inputTime>0&&(data.inputTime=_this9.$helpers.getTimeInOrg(task.inputTime)),taskListContext.push(data)})),taskListContext&&this.updatePreRequestList({taskContextList:taskListContext},doValidation).finally((function(){
/*
                Temporary fix to solve changestatus being called before updatetask command when the input is entered
                and task closed immediately
              */
taskBulkListRef.forEach((function(task){task.isUpdating=!1}))})))},updatePreRequestList:function(data){var _this10=this,doValidation=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.taskBulkList=[],this.waitBoolean=!1,this.readingFieldSuggestions=[],this.readingFieldError=null,this.$http.post("v2/tasks/updateAllTask?doValidation=".concat(doValidation),data).then((function(response){if(response.data&&0===response.data.responseCode){if("object"===(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)(response.data.result)){if(_this10.workorder.preRequestStatus=response.data.result.preRequestStatus,_this10.waitBoolean=!0,_this10.noOfUpdatedTAsk=_this10.noOfUpdatedTAsk+response.data.result.rowsUpdated,"undefined"!==typeof response.data.result.error&&response.data.result.error?(data.taskContextList.forEach((function(datum){datum.id in response.data.result.error||(_this10.$set(_this10.errorMap,datum.id,!1),_this10.$set(_this10.errorMessage,datum.id,null))})),Object.assign(_this10.errorQue,response.data.result.error)):data.taskContextList.forEach((function(datum){_this10.$set(_this10.errorMap,datum.id,!1),_this10.$set(_this10.errorMessage,datum.id,null)})),_this10.taskBulkList.length>0)return void _this10.asyncPreRequestUpdate(doValidation);_this10.$message({showClose:!0,message:_this10.noOfUpdatedTAsk+_this10.$t("maintenance._workorder.prerequisite_updated_success"),type:"success"}),_this10.noOfUpdatedTAsk=0,Object.keys(_this10.errorQue).length>0&&_this10.$dialog.confirm({title:_this10.$t("_workoder.add_readings"),message:_this10.$t("_workoder.add_readings_message"),rbDanger:!0,rbLabel:_this10.$t("maintenance._workorder.save")}).then((function(val){var _this11=this;if(val){var tasks=this.newTaskList.map((function(v){return v.taskList})).reduce((function(a,b){return a.concat(b)})).filter((function(v){return v.id in _this11.errorQue})),taskContextList=[];tasks.forEach((function(t){var data={id:t.id,inputValue:t.inputValue,inputValues:t.inputValues,remarks:t.remarks,readingFieldId:t.readingFieldId};taskContextList.push(data)})),this.errorQue={},this.updatePreRequestList({taskContextList:taskContextList},!1)}else Object.keys(this.errorQue).forEach((function(key){_this11.$set(_this11.errorMessage,key,_this11.errorQue[key].message),_this11.$set(_this11.errorMap,key,!0)}));this.errorQue={}})),_this10.taskBulkList=[]}else _this10.$message({showClose:!0,message:_this10.$t("maintenance._workorder.prerequisite_updated_failed"),type:"error"});_this10.loadactivitie()}})).finally((function(){_this10.waitBoolean=!0}))},updateTaskList:function(data){var _this12=this,doValidation=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],skipValidation=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.taskBulkList=[],this.waitBoolean=!1;var apiurl="v2/tasks/updateAllTask?doValidation=".concat(doValidation);this.$helpers.isLicenseEnabled("READING_FIELD_UNITS_VALIDATION")&&(apiurl="v2/tasks/updateAllTask?doValidation=".concat(doValidation,"&skipValidation=").concat(skipValidation),data.taskContextList.length>0&&(this.currentTaskObj=data.taskContextList[0]));var formData=data;
// its assumed that there is only one task that is being saved
if(data.taskContextList[0].attachment){formData=new FormData,formData.append("module",data.taskContextList[0].attachment.module),formData.append("recordId",data.taskContextList[0].attachment.recordId);var attachment=data.taskContextList[0].attachment;delete data.taskContextList[0].attachment,this.$helpers.setFormData("taskContextList",data.taskContextList,formData),attachment.beforeFile&&formData.append("beforeAttachment",attachment.beforeFile,attachment.beforeFileName),attachment.afterFile&&formData.append("afterAttachment",attachment.afterFile,attachment.afterFileName)}return this.$http.post(apiurl,formData).then((function(response){if(response.data&&0===response.data.responseCode){if("object"===(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)(response.data))if(response.data.result.taskErrors)response.data.result.taskErrors.forEach((function(taskError){1==taskError.mode&&1==taskError.failType?(_this12.readingFieldErrorToggle=!0,_this12.readingFieldError=taskError.message,_this12.currentValue=taskError.currentValue,_this12.previousValue=taskError.previousValue):2==taskError.mode&&(_this12.readingFieldSuggestionToggle=!0,_this12.readingFieldSuggestions.push(taskError.message),_this12.suggestedUnits.push(taskError.suggestedUnit))}));else if(response.data.result.requiresRemarks||response.data.result.requiresAttachment){if((0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isArray */.kJ)(data.taskContextList)){var selectedTask,id=data.taskContextList[0].id;_this12.newTaskList.forEach((function(section){if(!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(section.taskList)&&(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isArray */.kJ)(section.taskList)&&!selectedTask&&(selectedTask=section.taskList.find((function(task){return task.id===id})),selectedTask))return _this12.selectedTask=selectedTask,_this12.addTaskRemarksDialog=response.data.result.requiresRemarks,_this12.addAttachmentRequiredDialog=response.data.result.requiresAttachment,void(_this12.showMandatoryInputsDialog=!0)}))}}else{if(_this12.workorder.preRequestStatus=response.data.result.preRequestStatus,_this12.waitBoolean=!0,_this12.noOfUpdatedTAsk=_this12.noOfUpdatedTAsk+response.data.result.rowsUpdated,"undefined"!==typeof response.data.result.error&&response.data.result.error?(data.taskContextList.forEach((function(datum){datum.id in response.data.result.error||(_this12.$set(_this12.errorMap,datum.id,!1),_this12.$set(_this12.errorMessage,datum.id,null))})),Object.assign(_this12.errorQue,response.data.result.error)):data.taskContextList.forEach((function(datum){_this12.$set(_this12.errorMap,datum.id,!1),_this12.$set(_this12.errorMessage,datum.id,null)})),_this12.taskBulkList.length>0)return void _this12.asyncTaskUpdate(doValidation,skipValidation);if(_this12.$message({showClose:!0,message:(_this12.noOfUpdatedTAsk>1?_this12.noOfUpdatedTAsk+" ":"")+_this12.$t("maintenance._workorder.task_updated_success"),type:"success"}),_this12.noOfUpdatedTAsk=0,_this12.readingFieldErrorToggle=!1,_this12.readingFieldSuggestionToggle=!1,_this12.readingData=6,_this12.consumptionData="","Work in Progress"!==_this12.ticketstatusvalue){var statusField=_this12.getTicketStatusByLabel("Work in Progress","workorder"),_ref13=statusField||{},_ref13$id=_ref13.id,statusId=void 0===_ref13$id?-1:_ref13$id;_this12.$set(_this12,"workorder.status.id",statusId)}Object.keys(_this12.errorQue).length>0&&_this12.$dialog.confirm({title:_this12.$t("_workoder.add_readings"),message:_this12.$t("_workoder.add_readings_message"),rbDanger:!0,rbLabel:_this12.$t("maintenance._workorder.save")}).then((function(val){var _this13=this;if(val){var tasks=this.newTaskList.map((function(v){return v.taskList})).reduce((function(a,b){return a.concat(b)})).filter((function(v){return v.id in _this13.errorQue})),taskContextList=[];tasks.forEach((function(t){var data={id:t.id,inputValue:t.inputValue,inputValues:t.inputValues,remarks:t.remarks,readingFieldId:t.readingFieldId};taskContextList.push(data)})),this.errorQue={},this.updateTaskList({taskContextList:taskContextList},!1)}else Object.keys(this.errorQue).forEach((function(key){_this13.$set(_this13.errorMessage,key,_this13.errorQue[key].message),_this13.$set(_this13.errorMap,key,!0)}));this.errorQue={}})),_this12.taskBulkList=[]}else _this12.$message({showClose:!0,message:_this12.$t("maintenance._workorder.task_updated_failed"),type:"error"});_this12.loadactivitie(),
// this.$root.$emit('reloadWO')
_this12.forceReloadIfTaskActionExecuted(response)}else{if(data.taskContextList&&1===data.taskContextList.length){var cl=_this12.$helpers.cloneObject(_this12.taskErrorMap);cl[data.taskContextList[0].id]=response.data.message,_this12.taskErrorMap=cl}_this12.$message({showClose:!0,message:response.data.message,type:"error"})}})).finally((function(){_this12.waitBoolean=!0}))},forceReloadIfTaskActionExecuted:function(response){
// force reload the UI, if isTaskActionExecuted, through WorkFlow
var _ref14=response.data.result||{},isTaskActionExecuted=_ref14.isTaskActionExecuted;isTaskActionExecuted&&this.onTransitionSuccess()},getNextWorkOrderTime:function(){return this.$http.get("/v2/workorders/getNextWorkOrderTime?workOrderId=".concat(this.openWorkorderId))},waitFunc:util_helpers__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */.ZP.debounce((function(){this.taskBulkList.length&&this.asyncTaskUpdate()}),5e3),addTask:function(task,skipValidation){var self=this;if(-1!==task.id)task.isUpdating=!0,this.taskBulkList.push(task),this.asyncTaskUpdate(null,skipValidation);else{var formData={};if(""===task.subject.trim())return void this.$message({message:this.$t("maintenance._workorder.task_title_required"),type:"error"});if((0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(task.resource.id))if((0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(self.workorder.resource))delete task.resource;else{var _self$workorder$resou=self.workorder.resource,id=_self$workorder$resou.id,name=_self$workorder$resou.name;task.resource={id:id,name:name}}if(task.assignedTo||delete task.assignedTo,task.readingFieldId||(task.readingFieldId=-1),"5"===task.inputType||"6"===task.inputType){var taskOptions=[];for(var key in task.options){var option=task.options[key];taskOptions[key]=option.name}task.options=taskOptions}task.parentTicketId=self.workorder.id,formData.task=task,self.$http.post("/task/add",formData).then((function(response){task.id=response.data.taskId,self.tasks.push(task),self.newTask={subject:"",description:"",resource:{id:-1},isReadingTask:!1,readingFieldId:-1,options:[],taskType:-1,enableInput:!1,attachmentRequired:!1,id:-1},self.loadactivitie(),self.$message({message:self.$t("maintenance._workorder.task_added_success"),type:"success"}),
// show the + button back on screen
self.isUserAddingTask=!1,self.onTransitionSuccess()})).catch((function(res){self.$message({message:res.data.message,type:"error"})}))}},addPreRequest:function(task){-1!==task.id&&(task.inputValue=task.inputValue===task.truevalue?"1":"0",task.isUpdating=!0,this.taskBulkList.push(task),this.asyncPreRequestUpdate(),task.inputValue="1"===task.inputValue?task.truevalue:task.falsevalue)},addPreRequesites:function(taskList){var _this14=this;taskList.forEach((function(task){-1!==task.id&&(task.inputValue=task.inputValue===task.truevalue?"1":"0",task.isUpdating=!0,_this14.taskBulkList.push(task))})),this.asyncPreRequestUpdate(),taskList.forEach((function(task){task.inputValue="1"===task.inputValue?task.truevalue:task.falsevalue}))},addTaskOption:function(selectedTask){selectedTask.options.push({name:""})},getPMType:function(type){return this.$store.getters.getTicketTypePickList()[type]},addNewSection:function(){

},
// Adding task with section
addNewTaskToASection:function(sectionId){(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(sectionId)||(
// disable the + button when user is adding a new task
this.isUserAddingTask=!0,
// Add a new task to the section with ID "sectionId"
this.newTask={subject:"",description:"",resource:{id:-1},isReadingTask:!1,readingFieldId:null,options:[],taskType:-1,enableInput:!1,inputType:1,attachmentRequired:!1,status:{type:"OPEN",typeCode:1,id:-1},id:-1,sectionId:sectionId},this.taskList[sectionId]||(this.taskList[sectionId]=[]),this.taskList[sectionId].push(this.newTask),this.showTaskDetails(this.newTask))},
// Adding task without section
addNewTask:function(){
// if (this.selectedTask && this.selectedTask.subject !== '') {
//   this.addTask(this.selectedTask)
// }
// disable the + button when user is adding a new task
this.isUserAddingTask=!0;var lastSection=-1;for(var key in this.taskList)this.taskList.hasOwnProperty(key)&&(-1!==key||-1===key&&1===Object.keys(this.taskList).length)&&(lastSection=key);this.newTask={subject:"",description:"",resource:{id:-1},isReadingTask:!1,readingFieldId:null,options:[],taskType:-1,enableInput:!1,inputType:1,attachmentRequired:!1,status:{type:"OPEN",typeCode:1,id:-1},id:-1,sectionId:lastSection};var taskListCopy=this.taskList;taskListCopy[lastSection]||(taskListCopy[lastSection]=[]),taskListCopy[lastSection].push(this.newTask),this.$set(this,"taskList",{}),this.$set(this,"taskList",taskListCopy),this.showTaskDetails(this.newTask)},checkAndShowTask:function(task){this.showAddTask&&this.showTaskDetails(task)},checkAndShowPreRequest:function(task){this.showAddPreRequest&&this.showPreRequestDetails(task)},checkOptionsLength:function(options){return options.length<=2&&!options.some((function(option){return option.length>10}))},onSelectInput:function(){"2"===this.selectedTask.inputType&&this.fillTaskReadings()},fillTaskReadings:function(){var _this15=this;if(this.selectedTask.resource&&2===this.selectedTask.resource.resourceType&&this.selectedTask.resource.category){var categoryId=this.$getProperty(this,"selectedTask.resource.category.id"),result=util_util__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */.Z.loadAssetReadingFields(null,categoryId,!1);result.then((function(fields){_this15.$set(_this15,"taskReadingFields",fields)}))}else if(this.selectedTask.resource){var parentCategoryId=-1;this.selectedTask.resource.category&&(parentCategoryId=this.selectedTask.resource.category.id);var resourceId=this.$getProperty(this,"selectedTask.resource.id"),_result=util_util__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */.Z.loadSpaceReadingFields(resourceId,!1,parentCategoryId,null);_result.then((function(fields){_this15.$set(_this15,"taskReadingFields",fields)}))}},showTaskDetails:function(task){this.showAddTask=!0,this.selectedTask=task},showPreRequestDetails:function(preRequest){this.showAddPreRequest=!0,this.selectedPreRequest=preRequest},focusCommentBox:function(){this.$refs.commentBoxRef.focus(),this.commentFocus=!0},blurCommentBox:function(e){var itTargetPar=e.path.filter((function(ele){if("commentBoxPar"===ele.id)return!0}));this.newComment.body&&""!==this.newComment.body.trim()||itTargetPar.length||(this.commentFocus=!1)},addComment:function(){if(this.newComment.body){var self=this;self.$http.post("v2/notes/add",{note:self.newComment,module:"ticketnotes",parentModuleName:"workorder"}).then((function(response){response.data&&0===response.data.responseCode&&(self.comments.push(response.data.result.Notes),self.reset(),self.commentFocus=!1,self.$refs["activitiesDiv"]&&self.$refs["activitiesDiv"].loadActivities())}))}},loadactivitie:function(){this.$refs["activitiesDiv"]&&this.$refs["activitiesDiv"].loadActivities()},reset:function(){this.newComment={parentModuleLinkName:"ticketnotes",parentId:this.openWorkorderId,body:null,notifyRequester:!1,selectedPortalApp:this.selectedPortalApp}},loadComments:function(){var self=this;return self.loading=!0,this.$http.get("v2/notes/parent/noteList?module=ticketnotes&parentId="+this.openWorkorderId).then((function(response){response.data&&0===response.data.responseCode&&(self.loading=!1,self.comments=response.data.result.notes?response.data.result.notes:[])})).catch((function(error){error&&(self.loading=!1,self.comments=[])}))},sort:function(arr){for(var len=arr.length,i=len-1;i>=0;i--)for(var j=1;j<=i;j++)if(arr[j-1].seq>arr[j].seq){var temp=arr[j-1];arr[j-1]=arr[j],arr[j]=temp}return arr},loadTasks:function(){var self=this;if(self.loading=!0,this.openWorkorderId>0)return this.$http.get("/v2/tasks/parent/"+this.openWorkorderId).then((function(response){if(response.data&&0===response.data.responseCode){if(self.loading=!1,-1!==response.data.result.tasks[Object.keys(response.data.result.tasks)[0]][0].sequence){var unsorted=[];Object.keys(response.data.result.tasks).forEach((function(key){unsorted.push({secId:key,seq:response.data.result.tasks[key][0].sequence})}));var sorted=self.sort(unsorted),newTaskList=[];sorted.forEach((function(ele){newTaskList.push({sectionId:ele.secId,taskList:response.data.result.tasks[ele.secId]})})),newTaskList=newTaskList.map((function(obj){var tasks=obj.taskList.map((function(task){return task.status&&task.status.id!==self.openStatusId?task.status={type:"CLOSED",typeCode:2,id:self.closedStatusId}:task.status={type:"OPEN",typeCode:1,id:self.openStatusId},-1===task.inputTime&&(task.inputTime=null),self.$set(task,"hours",null),self.$set(task,"minutes",null),task}));return obj.taskList=tasks,obj})),self.newTaskList=newTaskList,self.sequencedData=!0}else self.sequencedData=!1;for(var idx in self.taskList=response.data.result.tasks?response.data.result.tasks:{},self.taskList)for(var idx2 in self.taskList[idx]){self.taskList[idx][idx2].status&&self.taskList[idx][idx2].status.id!==self.openStatusId?self.taskList[idx][idx2].status={type:"CLOSED",typeCode:2,id:self.closedStatusId}:self.taskList[idx][idx2].status={type:"OPEN",typeCode:1,id:self.openStatusId},-1===self.taskList[idx][idx2].inputTime&&(self.taskList[idx][idx2].inputTime=null);var task=self.taskList[idx][idx2];if(task&&task.readingField&&("NUMBER"===task.readingField.dataTypeEnum||"DECIMAL"===task.readingField.dataTypeEnum)&&5===task.readingField.metric&&task.inputValue){var hourMinObj=self.$helpers.secToHoursMinu(task.inputValue);self.$set(task,"hours",hourMinObj.hours?hourMinObj.hours:""),self.$set(task,"minutes",hourMinObj.minute?hourMinObj.minute:"")}var _ref15=self.selectedTask||-1,id=_ref15.id;
// check to update the readingField property so that task details of the newly added task shows up, properly on UI.
id===task.id&&(self.selectedTask=task)}for(var _idx in self.sections=response.data.result.sections?response.data.result.sections:{},
// prerequisite start
self.preRequestList=response.data.result.prerequisites?response.data.result.prerequisites:{},self.preRequestList)for(var _idx2 in self.preRequestList[_idx])self.preRequestList[_idx][_idx2].inputValue="1"===self.preRequestList[_idx][_idx2].inputValue?self.preRequestList[_idx][_idx2].truevalue:"0"===self.preRequestList[_idx][_idx2].inputValue?self.preRequestList[_idx][_idx2].falsevalue:null,self.preRequestList[_idx][_idx2].status&&self.preRequestList[_idx][_idx2].status.id!==self.openStatusId?self.preRequestList[_idx][_idx2].status={type:"CLOSED",typeCode:2,id:self.closedStatusId}:self.preRequestList[_idx][_idx2].status={type:"OPEN",typeCode:1,id:self.openStatusId},-1===self.preRequestList[_idx][_idx2].inputTime&&(self.preRequestList[_idx][_idx2].inputTime=null);self.preRequestSections=response.data.result.prerequisiteSections?response.data.result.prerequisiteSections:{}}})).catch((function(error){error&&(self.loading=!1,self.tasks=[])}))},
// Temp...needs to be sorted in server itself
getSortedTaskList:function(){var _this16=this,sorted=[];if(this.taskList[-1]){var list=this.taskList[-1];this.selectedTaskResource>0&&(list=list.filter((function(task){return task.resource&&task.resource.id===_this16.selectedTaskResource}))),sorted.push({sectionId:-1,taskList:list})}var sections=this.sections;if(!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(sections)){var seqList=Object.keys(sections).map((function(secId){return{secId:secId,sequence:_this16.getSection(secId)}}));sorted.push.apply(sorted,(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(seqList.sort((function(a,b){return a.sequence-b.sequence})).map((function(obj){return{sectionId:obj.secId,taskList:_this16.selectedTaskResource>0?_this16.taskList[obj.secId].filter((function(task){return task.resource&&task.resource.id===_this16.selectedTaskResource})):_this16.taskList[obj.secId]}}))))}return sorted.filter((function(obj){return!(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(obj.taskList)}))},getSection:function(secId){var taskList=this.taskList,_ref16=taskList||{},section=_ref16[secId],task=(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_33__/* .isEmpty */.xb)(section)?{}:section[0];return this.$getProperty(task,"sequence",-1)},closedisplay:function(){this.showAddTask=!1},closedisplayPreRequest:function(){this.showAddPreRequest=!1},ticketstatusvalue:function(id){if(null!==id){var status=this.$store.getters.getTicketStatus(id,"workorder").status;if(status)return status}return""},assignWorkOrder:function(assignedTo,assignmentGroup){var _this17=this,assignObj={};assignObj.id=[this.workorder.id],assignedTo&&(assignObj.assignedTo=assignedTo),assignmentGroup&&(assignObj.assignmentGroup=assignmentGroup),assignObj.status={id:this.getTicketStatusByLabel("Assigned","workorder").id,status:"Assigned"},this.$store.dispatch("workorder/assignWorkOrder",assignObj).then((function(){_this17.$dialog.notify(_this17.$t("maintenance._workorder.wo_assigned_success")),_this17.loadactivitie(),_this17.fetchWo(!0)}))},updateWorkOrderDueDate:function(idList,datetime){var _this18=this,updateObj={id:idList,fields:{dueDate:datetime}};this.$store.dispatch("workorder/updateWorkOrder",updateObj).then((function(){_this18.loading=!0,_this18.$message.success(_this18.$t("maintenance._workorder.wo_duedate_update_success")),_this18.loading=!1,_this18.fetchWo(!0)})).catch((function(){_this18.$message.error("Workorder Due Date updation failed")}))},updateWorkOrder:function(idList,field,actualTimings){var _this19=this,updateObj={id:idList,fields:field,actualTimings:actualTimings};this.workorder.loadTimer=!1,this.$store.dispatch("workorder/updateWorkOrder",updateObj).then((function(){_this19.$message.success(_this19.$t("maintenance._workorder.wo_update_success")),_this19.fetchWo(!0),_this19.loadactivitie()})).catch((function(){_this19.$message.error(_this19.$t("maintenance._workorder.wo_update_failed"))}))},resolveWorkOrder:function(idList,actualWorkDuration,actualTimings){var _this20=this;if(this.checkInputTasksCompletion()){var updateObj={id:idList};actualWorkDuration>0&&(updateObj.actualWorkDuration=actualWorkDuration,updateObj.actualTimings=actualTimings),this.$store.dispatch("workorder/resolve",updateObj).then((function(){_this20.$message.success(_this20.$t("maintenance._workorder.wo_resolved_success")),_this20.loading=!1,_this20.fetchWo(!0),_this20.loadactivitie(),_this20.updateGAEvent("Resolved","Resolve btn")})).catch((function(){_this20.$message.error(_this20.$t("maintenance._workorder.wo_resolved_failed"))}))}},updateGAEvent:function(action,label){try{vue__WEBPACK_IMPORTED_MODULE_34__["default"].prototype.$gtag&&vue__WEBPACK_IMPORTED_MODULE_34__["default"].prototype.$gtag.event("custom_event",{event_category:"Workorder",event_action:action,event_label:label,event_value:1})}catch(e){}},formatTime:function(date,period,enableFormating){if(null===date&&(date=0),date>0){var dateFormat=period||"DD-MM-YYY",today=moment_timezone__WEBPACK_IMPORTED_MODULE_23___default()().tz(this.$timezone).startOf("day").valueOf(),yesterday=moment_timezone__WEBPACK_IMPORTED_MODULE_23___default()().tz(this.$timezone).subtract(1,"day").startOf("day").valueOf();return date>yesterday&&enableFormating&&date<=today?"YESTERDAY":date>today&&enableFormating?"TODAY":moment_timezone__WEBPACK_IMPORTED_MODULE_23___default()(date).tz(this.$timezone).format(dateFormat)}return""},closeWO:function(status){if(this.checkInputTasksCompletion()){if(this.workorder.isWorkDurationChangeAllowed&&"Resolved"!==this.ticketStatusValue)return this.workDurationCallBack=this.closeWorkOrder.bind(this),void(this.showWorkDurationDialog=!0);if(status){var statusField={id:this.getTicketStatusByLabel(status,"workorder").id,status:status};this.$set(this,"workorder.status",statusField)}this.closeWorkOrder()}},closeWorkOrder:function(actualDuration){var _this21=this,paramObj={id:[this.workorder.id]};actualDuration&&-1!==actualDuration.duration&&(paramObj.actualWorkDuration=actualDuration.duration),this.$store.dispatch("workorder/closeWorkOrder",paramObj).then((function(){_this21.$message.success(_this21.$t("maintenance._workorder.wo_closed_success")),_this21.closeSummary(),_this21.updateGAEvent("Closed","close btn"),_this21.fetchWo(!0)})).catch((function(){_this21.$message.error(_this21.$t("maintenance._workorder.wo_close_error_failed"))}))},checkInputTasksCompletion:function(){for(var idx in this.taskList)if(this.taskList.hasOwnProperty(idx)){var check=this.taskList[idx].some((function(task){return"OPEN"===task.status.type}));if(check)return this.$message({message:this.$t("maintenance._workorder.wo_resolved_failed"),type:"warning"}),!1}return!0},closeSummary:function(){this.summoryview=!1;var newpath=this.$route.path.substring(0,this.$route.path.indexOf("/summary/"));this.$router.replace({path:newpath})},download:function(){this.downloadSummary=!0,window.open(window.location.protocol+"//"+window.location.host+"/app/pdf/summarydownloadreport?workorderId="+this.openWorkorderId)},updateTaskChartData:function(){this.workorder&&(this.taskChartData={value:this.workorder.noOfTasks>-1?this.workorder.noOfTasks:0,currentValue:this.workorder.noOfClosedTasks>-1?this.workorder.noOfClosedTasks:0,color:"#9c5fb8,#f87a60",unit:"",centerText:[{label:this.$t("maintenance._workorder.completed")},{label:this.$t("maintenance._workorder.of")+" "+(this.workorder.noOfTasks>-1?this.workorder.noOfTasks:0)+" "+this.$t("maintenance._workorder.tasks")}]})},selectItem:function(item,index){this.selectedInventory=item,this.selectedInventory.index=index,this.loadindividualTrackingList([item])},handeler1:function(item,index){0===item.addedQuantity&&(this.inventoryList[index].checked=!0)},addindIvidualTrackingItem:function(){var _this22=this;this.inventoryList[this.inventoryList.findIndex((function(rt){return rt.id===_this22.selectedInventory.id}))].invidualList=[].concat((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(this.individualItemListwrapper.filter((function(rt){return rt.checked}))),(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(this.selectedInventory.invidualList)),this.selectedInventory=null,this.individualItemList=[]},selectTool:function(tool,index){this.selectedTool=tool,this.selectedTool.index=index,this.loadindividualToolTrackingList([tool])},addindIvidualTrackingTool:function(){var _this23=this;this.toolsList[this.toolsList.findIndex((function(rt){return rt.id===_this23.selectedTool.id}))].invidualList=[].concat((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(this.individualToolListwrapper.filter((function(rt){return rt.checked}))),(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)(this.selectedTool.invidualList)),this.selectedTool=null,this.individualToolList=[]},closeTaskRemarksDialog:function(){this.addTaskRemarksDialog=!1},openWoEditForm:function(){this.editFormVisibilty=!0},isLookupSimpleField:function(field){var _ref17=field||{},displayType=_ref17.displayType;return"LOOKUP_SIMPLE"===displayType},isLookupLocationField:function(field){var _ref18=field||{},displayType=_ref18.displayType;return"GEO_LOCATION"===displayType}}}},
/***/112143:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(595082),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(260228),__webpack_require__(169358),__webpack_require__(990260)),vuex__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(420629);
/* harmony import */
/* harmony default export */__webpack_exports__.Z={computed:(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)({},(0,vuex__WEBPACK_IMPORTED_MODULE_3__/* .mapGetters */.Se)(["getCurrentSiteId"])),methods:{transformFormData:function(data,formData){return data.id=[data.id],(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_4__/* .isEmpty */.xb)(formData)&&(formData={}),formData.siteId=formData.siteId||this.getCurrentSiteId(),(0,_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_4__/* .isEmpty */.xb)(formData.ticketattachments)||(data.ticketattachments=formData.ticketattachments,delete formData.ticketattachments),formData.comment&&(data.comment=formData.comment),formData.notifyRequester&&(data.notifyRequester=formData.notifyRequester,delete formData.notifyRequester),data["workorder"]=Object.keys(formData).reduce((function(res,key){return formData[key]&&(res[key]=formData[key]),res}),{}),data}}}},
/***/866089:
/***/function(__unused_webpack_module,__webpack_exports__){
/* harmony default export */__webpack_exports__.Z={methods:{isWorkOrderEditable:function(){var ORGID=this.$account.org.orgId,ATRE=406;
// WO cannot be edited for ATRE
if(ORGID===ATRE)return!1;
// WO cannot be edited for BFM Technician
var BRIGHT_FM=274,TECHNICIAN=274,ROLEID=this.$account.user.roleId;if(ORGID===BRIGHT_FM&&ROLEID&&ROLEID==TECHNICIAN)return!1;
// Locked & Requested WO cannot be edited
var hasState=this.$getProperty(this.workorder,"moduleState.id",null),isLocked=!!hasState&&this.isStatusLocked(this.workorder.moduleState.id,"workorder"),isRequestedState=this.isRequestedState;return!(!hasState||isLocked||isRequestedState)&&this.$hasPermission("workorder:UPDATE")}}};
/***/},
/***/686918:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony import */var _Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150124),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(548534),_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(595082),vue__WEBPACK_IMPORTED_MODULE_21__=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(720144)),_Spinner__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(604947),src_util_http__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(218430),src_util_helpers__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(778390),moment_timezone__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(480008),moment_timezone__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_8__),util_constant__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(354754),src_util_util__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(733313),src_util_style__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(464889),src_util_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(927698),dlv__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(226905),dlv__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(dlv__WEBPACK_IMPORTED_MODULE_13__),dset__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(444806),src_util_convert__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(276788),src_util_time__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(644227),_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(990260),src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(455344),_facilio_utils_filters__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(638203),vuex__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(420629),src_util_filters__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(273861),util_index__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(948288);
/* harmony import */
// import * as filters from '../util/filters'
/* harmony default export */__webpack_exports__.Z={data:function(){return{loading:!1,outerData:null,localloading:!0}},computed:(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */.Z)({},(0,vuex__WEBPACK_IMPORTED_MODULE_20__/* .mapState */.rn)({account:function(state){return state.account}})),methods:{loadQData:function(){var _this=this;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */.Z)((0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().mark((function _callee(){var account,org,timezone,hasPermission;return(0,_Users_abishekrakavel_Desktop_facilioClient_facilio_client_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.$store.dispatch("getCurrentAccount");case 2:return _context.next=4,_this.$store.dispatch("getFeatureLicenses");case 4:_this.outerData=_this.$route.query,account=_this.account,org=account.org,null!==org&&void 0!==org&&org.timezone&&(timezone=org.timezone,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$timezone=timezone,moment_timezone__WEBPACK_IMPORTED_MODULE_8___default().getDateInOrg=function(date){return moment_timezone__WEBPACK_IMPORTED_MODULE_8___default().tz(moment_timezone__WEBPACK_IMPORTED_MODULE_8___default()(date).format("YYYY-MM-DD HH:mm:ss"),timezone)}),account&&(vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$account=account,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$org=org),null!==org&&void 0!==org&&org.currency&&(vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$currency=org.currency),null!==org&&void 0!==org&&org.dateformat&&(vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$dateformat=org.dateformat||"DD-MMM-YYYY"),null!==org&&void 0!==org&&org.timeformat?vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$timeformat=2===org.timeformat?"hh:mm A":"HH:mm":vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$timeformat="HH:mm",vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$mobile=!1,vue__WEBPACK_IMPORTED_MODULE_21__["default"].filter("htmlToText",_facilio_utils_filters__WEBPACK_IMPORTED_MODULE_17__/* .htmlToText */.s9),vue__WEBPACK_IMPORTED_MODULE_21__["default"].filter("formatPeriod",src_util_filters__WEBPACK_IMPORTED_MODULE_18__.formatPeriod),hasPermission=function(){return!0},vue__WEBPACK_IMPORTED_MODULE_21__["default"].component("spinner",_Spinner__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */.Z),vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$http=src_util_http__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */.ZP,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$constants=util_constant__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$helpers=src_util_helpers__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */.ZP,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$util=src_util_util__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$style=src_util_style__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$common=src_util_common__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$getProperty=dlv__WEBPACK_IMPORTED_MODULE_13___default(),vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$setProperty=dset__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$convert=src_util_convert__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$time=src_util_time__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */.Z,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$hasPermission=hasPermission,vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$dateformat="DD-MMM-YYYY",vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$validation={isEmpty:_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_23__/* .isEmpty */.xb,isBoolean:_facilio_utils_validation__WEBPACK_IMPORTED_MODULE_23__/* .isBoolean */.jn},vue__WEBPACK_IMPORTED_MODULE_21__["default"].prototype.$fieldUtils={isBooleanField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isBooleanField */.Mw,isNumberField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isNumberField */.Z2,isDecimalField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isDecimalField */.No,isEnumField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isEnumField */.Ri,isDateField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isDateField */.y2,isDateTimeField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isDateTimeField */.K,isDateTypeField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isDateTypeField */.S6,isLookupField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isLookupField */.Qf,getDisplayValue:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .getDisplayValue */.UZ,isLookupDropDownField:src_util_field_utils__WEBPACK_IMPORTED_MODULE_16__/* .isLookupDropDownField */.Nz},vue__WEBPACK_IMPORTED_MODULE_21__["default"].use(util_index__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */.Z,{account:account}),_this.localloading=!1;case 32:case"end":return _context.stop()}}),_callee)})))()}}}},
/***/160799:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */t:function(){/* binding */return mapGettersWithLogging}
/* harmony export */});
/* harmony import */__webpack_require__(821057),__webpack_require__(634338),__webpack_require__(434284)
/* harmony import */;var vuex__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(420629),_datadog_browser_rum__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(982216),mapGettersWithLogging=function(getters){
// if datadog is unavailable fallback to vuex `mapGetters` fn
if(!window.dataDogClientId)return(0,vuex__WEBPACK_IMPORTED_MODULE_4__/* .mapGetters */.Se)(getters);
// now the custom errors can be tracked in rum error dashboard
var mappedGetters=(0,vuex__WEBPACK_IMPORTED_MODULE_4__/* .mapGetters */.Se)(getters),loggingGetters={},_loop=function(key){var originalGetter=mappedGetters[key];loggingGetters[key]=function(){return _datadog_browser_rum__WEBPACK_IMPORTED_MODULE_3__/* .datadogRum */.v.addError(new Error("Getting getter '".concat(key,"' from '").concat(this.$options.name,"' component.")),{key:key,componentName:this.$options.name}),originalGetter.call(this)}};for(var key in mappedGetters)_loop(key);return loggingGetters}},
/***/766331:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */g:function(){/* binding */return mapStateWithLogging}
/* harmony export */});
/* harmony import */__webpack_require__(821057),__webpack_require__(634338),__webpack_require__(434284)
/* harmony import */;var vuex__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(420629),_datadog_browser_rum__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(982216),mapStateWithLogging=function(states){
// if datadog is unavailable fallback to vuex `mapState` fn
if(!window.dataDogClientId)return(0,vuex__WEBPACK_IMPORTED_MODULE_4__/* .mapState */.rn)(states);
// now the custom errors can be tracked in rum error dashboard
var mappedStates=(0,vuex__WEBPACK_IMPORTED_MODULE_4__/* .mapState */.rn)(states),loggingStates={},_loop=function(key){var originalGetter=mappedStates[key];loggingStates[key]=function(){return _datadog_browser_rum__WEBPACK_IMPORTED_MODULE_3__/* .datadogRum */.v.addError(new Error("Getting state '".concat(key,"' from '").concat(this.$options.name,"' component.")),{key:key,componentName:this.$options.name}),originalGetter.call(this)}};for(var key in mappedStates)_loop(key);return loggingStates}}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/chunk-common-d572abb7.js.map