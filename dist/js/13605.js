(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[13605],{
/***/574752:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return Avatar}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/Avatar.vue?vue&type=template&id=7f0d5689
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.user||_vm.name?_c("div",{staticClass:"fc-avatar-inline"},[_vm.avatarUrl?_c("img",{staticClass:"fc-avatar",class:_vm.sizeClass,attrs:{src:_vm.avatarUrl,alt:"Profile Avatar"}}):_c("div",{staticClass:"fc-avatar",class:_vm.sizeClass,style:_vm.bgColor},[_vm._v(" "+_vm._s(_vm.trimmedName)+" ")])]):_vm._e()},staticRenderFns=[],objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(564043),__webpack_require__(709873),__webpack_require__(228436),__webpack_require__(450886),__webpack_require__(677049),__webpack_require__(821694),__webpack_require__(420629)),Avatarvue_type_script_lang_js={props:{size:{type:String},user:{type:Object},avatarStyle:{type:Object},color:{type:String},name:{type:Boolean}},data:function(){return{sizeClass:"fc-avatar-"+this.size,fullName:"",trimmedName:null,avatarUrl:null,bgColor:"background-color: "+(this.color?this.color:this.getRandomBgColor())}},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),mounted:function(){var _this=this;if(this.user){var userName="";if(this.user.avatarUrl)this.avatarUrl=this.user.avatarUrl;else if(this.user.id){var userObj=this.users.find((function(user){return user.id===_this.user.id}));userObj&&userObj.avatarUrl&&(this.avatarUrl=userObj.avatarUrl),userObj&&userObj.name&&(userName=userObj.name)}userName=userName||this.user.name,userName&&(this.fullName=userName,this.trimmedName=this.getAvatarName(userName),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))}else this.name&&(this.trimmedName=this.getAvatarName(this.name),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))},watch:{user:function(){var _this2=this;if(this.user.avatarUrl)this.avatarUrl=this.user.avatarUrl;else if(this.user.id){var userObj=this.users.find((function(user){return user.id===_this2.user.id}));userObj&&userObj.avatarUrl?this.avatarUrl=userObj.avatarUrl:this.avatarUrl=null}else this.avatarUrl=null;this.user.name&&(this.fullName=this.user.name,this.trimmedName=this.getAvatarName(this.user.name),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))},"user.name":function(){this.user.name&&(this.fullName=this.user.name,this.trimmedName=this.getAvatarName(this.user.name),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))},"user.avatarUrl":function(){this.user.avatarUrl?this.avatarUrl=this.user.avatarUrl:this.avatarUrl=null},"user.id":function(){var _this3=this;if(this.user.id){var userObj=this.users.find((function(user){return user.id===_this3.user.id}));userObj&&userObj.avatarUrl?this.avatarUrl=userObj.avatarUrl:this.avatarUrl=null}else this.avatarUrl=null}},methods:{getAvatarName:function(name){for(var parts=name.split(/[ -]/),initials="",initialLen=2,count=0,i=0;i<parts.length;i++)if(""!==parts[i].trim()&&(initials+=parts[i].charAt(0),count++,count>=initialLen))break;initials.length<initialLen&&name.length>=initialLen&&(initials=name.trim().substring(0,initialLen));var avatarName=initials.toUpperCase();return avatarName},getRandomBgColor:function(){var colors=["#FFBA51","#34BFA3","#FF2F82","#29D9A7","#ECDC74","#927FED","#FF61A8","#fbf383","#ac4352","#6db1f4"],userKey=this.user.email?this.user.email:this.user.name,userUniqueNum=Array.from(userKey).map((function(letter){return letter.charCodeAt(0)})).reduce((function(current,previous){return previous+current})),colorIndex=userUniqueNum%colors.length,color=colors[colorIndex];return color}}},components_Avatarvue_type_script_lang_js=Avatarvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_Avatarvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,Avatar=component.exports},
/***/426803:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return User}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/avatar/User.vue?vue&type=template&id=c662fbbc
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.userObj?_c("div",{staticClass:"inline"},[_c("div",{staticClass:"fc-avatar-element q-item-division relative-position"},[_c("div",{staticClass:"q-item-side-left q-item-section"},[_vm.showPopover&&-1!==_vm.userObj.id?_c("avatarPopover",{attrs:{user:_vm.userObj,moduleName:_vm.moduleName}},[_c("span",{attrs:{slot:"reference"},slot:"reference"},[_c("avatar",{attrs:{size:_vm.size,user:_vm.userObj,color:_vm.color}})],1)]):_c("span",[_c("avatar",{attrs:{size:_vm.size,user:_vm.userObj,color:_vm.color}})],1)],1),_vm.showLabel?[_vm.user&&_vm.user.id>0||_vm.group&&_vm.group.id>0?_c("div",{staticClass:"wo-team-txt"},[_c("div",{staticClass:"assignment-avatar-name",class:{"color-d":!_vm.user}},[_vm._v(" "+_vm._s(_vm.user&&_vm.user.id>0?_vm.user.name||(_vm.users.find((function(usr){return usr.id===_vm.user.id}))||{}).name:"---")+" ")]),_c("div",{staticClass:"assignment-group-name",class:{"color-d":!_vm.group}},[_vm._v(" "+_vm._s(_vm.group?_vm.group.name||(_vm.$store.getters.getGroup(_vm.group.id)||{}).name:"---")+" ")])]):_c("div",{staticClass:"wo-team-txt",staticStyle:{"padding-top":"7px","font-size":"14px",color:"#aaa","letter-spacing":"0.2px"}},[_vm._v(" ---/--- ")])]:0!=_vm.name?_c("div",[_c("div",[_c("span",{staticClass:"q-item-label d-flex flex-wrap"},[_vm._v(_vm._s(_vm.userObj.name))])])]):_vm._e()],2)]):_vm._e()},staticRenderFns=[],objectSpread2=__webpack_require__(595082),Avatar=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(574752)),AvatarPopovervue_type_template_id_8ef9b9ec_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"avatar-popover-container"},[_c("el-popover",{ref:"popover1",staticStyle:{display:"block",padding:"0"},attrs:{placement:"top-start",trigger:"hover",width:"383",clas:"avatar-popover","popper-class":"avatar-popover",height:_vm.defaultheight,"open-delay":600},model:{value:_vm.popoverShown,callback:function($$v){_vm.popoverShown=$$v},expression:"popoverShown"}},[_c("div",{staticClass:"popover-content-block"},[_c("div",{staticClass:"popover-avatar"},[_c("avatar",{attrs:{size:_vm.size,user:_vm.user,color:_vm.color,showPopover:!1}})],1),_c("div",{staticClass:"popover-avatar-det"},[_c("div",{staticClass:"avatar-name-txt"},[_vm._v(" "+_vm._s(_vm.user.name?_vm.user.name:"----")+" ")]),_c("div",{staticClass:"mail-block"},[_c("img",{staticClass:"envelope-icon",staticStyle:{height:"13px","vertical-align":"middle"},attrs:{src:__webpack_require__(702638)}}),_c("span",{staticClass:"mail-txt"},[_vm._v(_vm._s(_vm.user.email?_vm.user.email:"----")+" ")])]),_c("div",[_c("img",{staticClass:"envelope-icon",staticStyle:{height:"15px"},attrs:{src:__webpack_require__(47424)}}),_c("span",{staticClass:"popover-phone-number"},[_vm._v(" "+_vm._s(_vm.user.mobile?_vm.user.mobile:"----")+" ")])])]),"workorder"===_vm.moduleName?_c("div",{staticClass:"popover-footer"},[_c("ul",[_c("li",{staticClass:"popover-footer-list",on:{click:function($event){return _vm.getOpen("open")}}},[_c("div",{staticClass:"open-result-txt"},[_vm._v(" "+_vm._s(_vm.result.openWorkOrdersCount)+" ")]),_c("div",{staticClass:"result-txt-black"},[_vm._v("OPEN")])]),_c("li",{staticClass:"popover-footer-list border-RL",on:{click:function($event){return _vm.getOpen("overdue")}}},[_c("div",{staticClass:"overdue-result-txt"},[_vm._v(" "+_vm._s(_vm.result.overDueWorkOrdersCount)+" ")]),_c("div",{staticClass:"result-txt-black"},[_vm._v("OVERDUE")])]),_c("li",{staticClass:"popover-footer-list",on:{click:function($event){return _vm.getOpen("duetoday")}}},[_c("div",{staticClass:"dueday-result-txt"},[_vm._v(" "+_vm._s(_vm.result.dueTodayWorkOrdersCount)+" ")]),_c("div",{staticClass:"result-txt-black"},[_vm._v("DUE TODAY")])])])]):_vm._e()]),_c("template",{slot:"reference"},[_vm._t("reference")],2)],2)],1)},AvatarPopovervue_type_template_id_8ef9b9ec_staticRenderFns=[],AvatarPopovervue_type_script_lang_js=(__webpack_require__(670560),__webpack_require__(648324),{props:["size","user","color","name","moduleName"],data:function(){return{defaultheight:"230px",result:{},popoverShown:!1,viewname:""}},components:{Avatar:Avatar["default"]},mounted:function(){
// this.showPopover = this.showpopoverFooter
this.moduleName&&(this.defaultheight="160px")},watch:{popoverShown:function(val){val&&this.userOpenDatas()}},methods:{userOpenDatas:function(){var self=this;self.$http.post("/widget/getUserCardData",{ouid:this.user.id}).then((function(response){200===response.status&&(self.result=response.data.result)}))},getOpen:function(viewName){var filter={assignedTo:{operator:"is",value:[this.user.id+""]}};this.$router.push("/app/wo/orders/"+viewName+"?search="+encodeURIComponent(JSON.stringify(filter)))}}}),components_AvatarPopovervue_type_script_lang_js=AvatarPopovervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_AvatarPopovervue_type_script_lang_js,AvatarPopovervue_type_template_id_8ef9b9ec_render,AvatarPopovervue_type_template_id_8ef9b9ec_staticRenderFns,!1,null,null,null)
/* harmony default export */,AvatarPopover=component.exports,vuex_esm=__webpack_require__(420629),Uservue_type_script_lang_js={created:function(){this.$store.dispatch("loadGroups")},components:{Avatar:Avatar["default"],AvatarPopover:AvatarPopover},props:{size:{type:String},user:{type:Object},avatarStyle:{type:Object},name:{type:Boolean,default:function(){return!0}},showLabel:{type:Boolean},showPopover:{type:Boolean},moduleName:{type:String},group:{type:Object},hovercard:{type:Boolean}},data:function(){return{hoverCardId:"userHoverCardId-"+(this.user?this.user.id:"unkown"),loadHoverCardData:!1,labelStatus:this.hideLabel}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),{},{userObj:function(){var _this=this,hasUser=this.user&&this.user.id>0,user=hasUser?this.$getProperty(this.user,"name")?this.user:this.users.find((function(usr){return usr.id===_this.user.id})):null;return user||{id:-1,name:"Unknown"}},color:function(){return-1!==this.userObj.id?"":this.group?"#c3c3c3":"#e3e3e3"}}),methods:{loadHoverCard:function(){this.loadHoverCardData=!0},hideHoverCard:function(){this.loadHoverCardData=!1}}},avatar_Uservue_type_script_lang_js=Uservue_type_script_lang_js,User_component=(0,componentNormalizer/* default */.Z)(avatar_Uservue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,User=User_component.exports},
/***/613605:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ReportScheduledList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/ReportScheduledList.vue?vue&type=template&id=43d97492&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"full-layout-white height100 scheduled-layout",staticStyle:{height:"calc(100vh - 160px)"}},[_c("div",{staticClass:"header pB20"},[_vm._v(_vm._s(_vm.$t("pivot.active_scheduled_reports")))]),_c("div",{staticClass:"row setting-Rlayout pT20",staticStyle:{"max-height":"calc(100vh - 280px)"}},[_c("div",{staticClass:"col-lg-12 col-md-12"},[_c("table",{staticClass:"setting-list-view-table"},[_vm._m(0),_vm.loading||_vm.v2loading?_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:_vm.loading||_vm.v2loading,size:"80"}})],1)])]):_c("tbody",_vm._l(_vm.reports,(function(info){return _c("tr",{key:info.id,staticClass:"tablerow"},[_c("td",[_vm._v(_vm._s(info.name||info.reportContext.name))]),_c("td",[_vm._v(_vm._s(_vm.$constants.FILE_FORMAT[info.fileFormat]))]),_c("td",[_vm._v(_vm._s(_vm.frequencyType[info.job.schedule.frequencyType]))]),_c("td",[_vm._v(" "+_vm._s(info.job.active&&info.job.executionTime>-1?_vm.$options.filters.formatDate(1e3*info.job.executionTime,"DD-MM-YYYY"):"---")+" ")]),_c("td",[info.userIds.length?_vm._l(info.userIds,(function(id,index){return _c("user-avatar",{directives:[{name:"tippy",rawName:"v-tippy"}],key:index,attrs:{size:"sm",user:_vm.$store.getters.getUser(id),name:!1,title:_vm.$store.getters.getUser(id).name}})})):_vm._e()],2),_c("td",[_vm.hasSchedulePermission?_c("div",{staticClass:"text-left actions",staticStyle:{"margin-top":"-3px","margin-right":"15px","text-align":"center"}},[_c("i",{staticClass:"el-icon-edit pointer",on:{click:function($event){return _vm.editReport(info)}}}),_c("i",{staticClass:"el-icon-delete pointer pL5",on:{click:function($event){return _vm.deleteReport(info.id,info.isV2)}}})]):_vm._e()])])})),0)])])]),_vm.showEditDialog?_c("schedule-report-v2",{attrs:{visibility:_vm.showEditDialog,isEdit:"true",list:_vm.list,model:_vm.selectedModel,moduleName:_vm.currentModule,webtabId:_vm.webTabId,isPivot:_vm.isPivot},on:{"update:visibility":function($event){_vm.showEditDialog=$event},myEvent:_vm.initV2Reports,save:_vm.onReportUpdate}}):_vm._e()],1)},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("thead",[_c("tr",[_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v("NAME")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v("FILE FORMAT")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v("FREQUENCY")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v("NEXT EXECUTION")]),_c("th",{staticClass:"setting-table-th setting-th-text"}),_c("th",{staticClass:"setting-table-th setting-th-text"})])])}],esm_typeof=__webpack_require__(103336),toConsumableArray=__webpack_require__(488478),ReportHelper=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(670560),__webpack_require__(450886),__webpack_require__(947522),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(162506),__webpack_require__(339772),__webpack_require__(507815)),ScheduleReportNew=__webpack_require__(91699),User=__webpack_require__(426803),router=__webpack_require__(329435),ReportTabPermissions=__webpack_require__(902040),ReportScheduledListvue_type_script_lang_js={props:["Name","list","webTabId","isPivot"],mixins:[ReportHelper/* default */.Z,ReportTabPermissions/* default */.Z],components:{ScheduleReportV2:ScheduleReportNew/* default */.Z,UserAvatar:User/* default */.Z},data:function(){return{isCreateScheduleReport:!1,loading:!1,v2loading:!1,reports:[],frequencyType:{0:"Once",1:"Daily",2:"Weekly",3:"Monthly",4:"Monthly",5:"Yearly"},selectedModel:null,showEditDialog:!1}},computed:{currentModule:function(){return(0,router/* isWebTabsEnabled */.tj)()?this.$attrs.moduleName?this.$attrs.moduleName:"":this.getCurrentModule()?this.getCurrentModule().module:""},users:function(){return this.$store.state.users}},mounted:function(){"pivot"!==this.Name&&this.initData(),this.initV2Reports()},methods:{initData:function(){var _this=this;this.loading=!0,this.reports=this.reports.filter((function(report){return report.isV2})),this.$http.post("/v2/report/scheduled/scheduledList",{moduleName:this.currentModule}).then((function(response){var _this$reports;(_this.loading=!1,response.data&&response.data.scheduledReports)&&((_this$reports=_this.reports).push.apply(_this$reports,(0,toConsumableArray/* default */.Z)(response.data.scheduledReports)),_this.setReportInfo(response.data.scheduledReports))}))},initV2Reports:function(){var _this2=this;this.v2loading=!0,this.reports=this.reports.filter((function(report){return!report.isV2})),this.$http.get("/v2/report/scheduled/"+("pivot"===this.Name?"pivot":this.currentModule)).then((function(response){var _this2$reports;(_this2.v2loading=!1,response.data&&0===response.data.responseCode)&&((_this2$reports=_this2.reports).push.apply(_this2$reports,(0,toConsumableArray/* default */.Z)(response.data.result.scheduledReports.map((function(report){return report.isV2=!0,report})))),_this2.setReportInfo(response.data.result.scheduledReports))}))},setReportInfo:function(reports){var _this3=this;reports.forEach((function(report){if(report.userIds=[],report.emailTemplate.workflow.expressions.length>1)for(var i=1;i<report.emailTemplate.workflow.expressions.length;i++){var exp=report.emailTemplate.workflow.expressions[i],userId=exp.criteria.conditions[1].value;report.userIds.push(parseInt(userId))}else{var userMails=report.emailTemplate.originalTemplate.to.split();userMails.forEach((function(mail){var user=_this3.users.find((function(user){return user.email===mail}));user&&report.userIds.push(parseInt(user.id))}))}}))},editReport:function(reportinfo){var info=this.$helpers.cloneObject(reportinfo);info.emailTemplate.originalTemplate.to=info.userIds;var startTime=info.job.executionTime>0?1e3*info.job.executionTime:"";this.selectedModel={schedule:info.job.schedule,startTime:startTime||new Date,format:info.fileFormat,mailJson:info.emailTemplate.originalTemplate,endTime:info.job.endExecutionTime>0?1e3*info.job.endExecutionTime:"",maxCount:info.job.maxExecution>0?info.job.maxExecution:"",reportId:info.reportId,id:info.id,isV2:reportinfo.isV2,scheduled_report_name:info.scheduled_report_name,selected_reportIds:info.selected_reportIds,reportName:info.name},info.emailTemplate.fromID&&""!=info.emailTemplate.fromID&&(this.selectedModel.mailJson["fromID"]=info.emailTemplate.fromID),this.showEditDialog=!0},onReportUpdate:function(info){this.showEditDialog=!1,this.initV2Reports()},deleteReport:function(id,isV2){var _this4=this;this.$dialog.confirm({title:"Delete Schedule",message:"Are you sure you want to delete this schedule?",rbDanger:!0,rbLabel:"Delete"}).then((function(value){var url,params;value&&(isV2?(url="/v2/report/scheduled/delete",params={ids:[id]}):(url="/dashboard/deleteScheduledReport",params={id:[id]}),_this4.$http.post(url,params).then((function(response){200===response.status&&"object"===(0,esm_typeof/* default */.Z)(response.data)?(_this4.$message.success("Schedule deleted succesfully"),_this4.reports.splice(_this4.reports.findIndex((function(report){return report.id})),1)):_this4.$message.error("Schedule deletion failed")})))}))},openCreatePopupForScheduleReport:function(){this.isCreateScheduleReport=!0}}},report_ReportScheduledListvue_type_script_lang_js=ReportScheduledListvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(report_ReportScheduledListvue_type_script_lang_js,render,staticRenderFns,!1,null,"43d97492",null)
/* harmony default export */,ReportScheduledList=component.exports},
/***/91699:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return ScheduleReportNew}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/forms/ScheduleReportNew.vue?vue&type=template&id=4acacb26
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:_vm.visibility,width:"50%","custom-class":"fc-dialog-form fc-dialog-right setup-dialog40 setup-dialog scheduler-form"},on:{"update:visible":function($event){_vm.visibility=$event},close:_vm.close}},[_c("el-form",{ref:"schedule-form",attrs:{model:_vm.scheduleForm,"label-position":"top",rules:_vm.rules}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.schedule_report"))+" ")])])]),_c("div",{staticClass:"new-body-modal enpi-body-modal"},[_c("div",{staticClass:"body-scroll"},[_c("div",{staticClass:"fc-input-label-txt pT20",staticStyle:{clear:"both"}},[_vm._v(" "+_vm._s(_vm.$t("Name"))+" ")]),_c("el-row",[_c("el-col",{staticClass:"fc-input-full-border2 width100",attrs:{span:18}},[_c("el-input",{staticClass:"fc-input-full-border2 width100",attrs:{type:"text"},model:{value:_vm.scheduled_report_name,callback:function($$v){_vm.scheduled_report_name=$$v},expression:"scheduled_report_name"}})],1)],1),_c("el-row",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("Select Reports"))+" ")]),_c("el-col",{attrs:{span:24}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{filterable:"",multiple:"","collapse-tags":"",remote:"","remote-method":function(query){return _vm.searchContent({searchText:query})}},on:{change:_vm.setSelectedOption},model:{value:_vm.selected_reportIds,callback:function($$v){_vm.selected_reportIds=$$v},expression:"selected_reportIds"}},_vm._l(_vm.getReportsOption,(function(report){return _c("el-option",{key:report.id,attrs:{label:report.name,value:report.id,clearable:""}})})),1)],1)],1),_c("FrequencySelector",{ref:"reportFrequencySelector",attrs:{isNew:_vm.isNew},model:{value:_vm.schedule,callback:function($$v){_vm.schedule=$$v},expression:"schedule"}}),_c("div",{staticClass:"pT30 subheader colorPink",staticStyle:{"padding-bottom":"15px","font-weight":"600","text-transform":"uppercase",color:"#333333"}},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.email_this_report"))+" ")]),_c("div",[_c("el-form-item",{attrs:{label:_vm.$t("asset.performance.from")}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"","default-first-option":""},model:{value:_vm.mailJson.fromID,callback:function($$v){_vm.$set(_vm.mailJson,"fromID",$$v)},expression:"mailJson.fromID"}},_vm._l(_vm.senderEmailList,(function(email_address){return _c("el-option",{key:email_address.id,staticClass:"subject",attrs:{label:email_address.email,value:email_address.id}})})),1)],1)],1),_c("div",{staticClass:"fc-input-label-txt",staticStyle:{float:"right"}},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.format"))+" "),_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{"padding-top":"8px"},model:{value:_vm.format,callback:function($$v){_vm.format=$$v},expression:"format"}},_vm._l(_vm.$constants.FILE_FORMAT,(function(label,value){return"Image"!=label&&"PDF"!=label||!_vm.isPivot?_c("el-option",{key:value,attrs:{label:label,value:parseInt(value),"collapse-tags":""}}):_vm._e()})),1)],1)]),_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(_vm._s(_vm.$t("common.products.to")))]),_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"280px",overflow:"scroll"},attrs:{multiple:"","collapse-tags":"",filterable:"","default-first-option":""},model:{value:_vm.mailJson.to,callback:function($$v){_vm.$set(_vm.mailJson,"to",$$v)},expression:"mailJson.to"}},_vm._l(_vm.users,(function(user){return _c("el-option",{key:user.id,attrs:{label:user.name,value:parseInt(user.id)}},[_vm._v(_vm._s(user.name+" ("+user.email+")"))])})),1),_c("div",{staticClass:"fc-input-label-txt pT20",staticStyle:{clear:"both"}},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.subject"))+" ")]),_c("el-row",[_c("el-col",{attrs:{span:18}},[_c("el-input",{attrs:{type:"text"},on:{change:function($event){_vm.messageChanged=!0}},model:{value:_vm.mailJson.subject,callback:function($$v){_vm.$set(_vm.mailJson,"subject",$$v)},expression:"mailJson.subject"}})],1)],1),_c("div",{staticClass:"fc-input-label-txt pT20"},[_vm._v(" "+_vm._s(_vm.$t("setup.approvalprocess.description"))+" ")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input",attrs:{type:"textarea",autosize:{minRows:6,maxRows:6},resize:"none"},on:{change:function($event){_vm.messageChanged=!0}},model:{value:_vm.mailJson.message,callback:function($$v){_vm.$set(_vm.mailJson,"message",$$v)},expression:"mailJson.message"}})],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel button-padding",on:{click:_vm.close}},[_vm._v(_vm._s(_vm.$t("setup.users_management.cancel")))]),_c("el-button",{staticClass:"modal-btn-save button-padding",attrs:{type:"primary",loading:_vm.saving},on:{click:_vm.save}},[_vm._v(" "+_vm._s(_vm.saving?_vm.$t("common.header.scheduling"):_vm.$t("common._common.schedule"))+" ")])],1)])],1)},staticRenderFns=[],defineProperty=__webpack_require__(482482),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),FrequencySelectorvue_type_template_id_a4cccc3e_render=(__webpack_require__(670560),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(260228),__webpack_require__(76265),__webpack_require__(434284),__webpack_require__(659749),__webpack_require__(386544),function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-form",{ref:"frequencyForm",attrs:{rules:_vm.rules,model:_vm.schedule}},[_c("el-row",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.scheduler.frequency"))+" ")]),_c("el-col",{attrs:{span:24}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",on:{change:_vm.resetSchedule},model:{value:_vm.schedule.frequencyType,callback:function($$v){_vm.$set(_vm.schedule,"frequencyType",$$v)},expression:"schedule.frequencyType"}},_vm._l(_vm.frequencyTypeMap,(function(item,key){return _c("el-option",{key:key,attrs:{label:item,value:parseInt(key)}})})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.execution_start"),prop:"startTime"}},[_c("el-date-picker",{staticClass:"form-item fc-input-full-border-select2 date-picker-trigger",staticStyle:{width:"100%"},attrs:{"picker-options":_vm.dateOptions,"float-label":"Start Date",type:_vm.dateType,"suffix-icon":"el-icon-date","value-format":"timestamp"},on:{change:_vm.resetEndDate},model:{value:_vm.schedule.startTime,callback:function($$v){_vm.$set(_vm.schedule,"startTime",$$v)},expression:"schedule.startTime"}})],1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.execution_end"),prop:"endDate"}},[_c("el-date-picker",{staticClass:"form-item fc-input-full-border-select2 date-picker-trigger",staticStyle:{width:"100%"},attrs:{"picker-options":_vm.endDateOptions,"float-label":"End Date",type:_vm.dateType,"suffix-icon":"el-icon-date","value-format":"timestamp",disabled:!_vm.schedule.startTime},model:{value:_vm.schedule.endDate,callback:function($$v){_vm.$set(_vm.schedule,"endDate",$$v)},expression:"schedule.endDate"}})],1)],1)],1),_vm.showMonths?_c("el-row",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.scheduler.execution_end"))+" "+_vm._s(_vm.frequencyTypeMap[_vm.schedule.frequencyType])+" ")]),_c("el-col",[_c("el-select",{staticClass:"fc-input-full-border2 width100",model:{value:_vm.schedule.monthValue,callback:function($$v){_vm.$set(_vm.schedule,"monthValue",$$v)},expression:"schedule.monthValue"}},_vm._l(_vm.monthsMap,(function(month,key){return _c("el-option",{key:parseInt(key),attrs:{value:parseInt(key),label:month}})})),1)],1)],1):_vm._e(),_vm.showDays?_c("el-row",{staticClass:"mT20"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.execution_days"),prop:"values"}},[_c("el-col",{attrs:{span:24}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{multiple:"","collapse-tags":""},model:{value:_vm.schedule.values,callback:function($$v){_vm.$set(_vm.schedule,"values",$$v)},expression:"schedule.values"}},_vm._l(_vm.weekDaysMap,(function(day,key){return _c("el-option",{key:day,attrs:{label:day,value:parseInt(key)}})})),1)],1)],1)],1):_vm._e(),_vm.showBasedOn?_c("el-row",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.scheduler.based_on"))+" ")]),_c("el-col",{staticClass:"mB20",attrs:{span:24}},[_c("el-radio-group",{on:{input:_vm.onBasedOnChange},model:{value:_vm.schedule.basedOn,callback:function($$v){_vm.$set(_vm.schedule,"basedOn",$$v)},expression:"schedule.basedOn"}},_vm._l(_vm.basedOnMap,(function(f,key){return _c("el-radio",{key:key,staticClass:"fc-radio-btn",attrs:{label:f,value:f}})})),1)],1),_vm.isAnnually?_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.months"),prop:"months"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100 fc-tag",attrs:{multiple:"","collapse-tags":""},model:{value:_vm.schedule.months,callback:function($$v){_vm.$set(_vm.schedule,"months",$$v)},expression:"schedule.months"}},_vm._l(_vm.fullMonthsMap,(function(option,key){return _c("el-option",{key:parseInt(key),attrs:{label:option,value:parseInt(key)}})})),1)],1)],1)],1):_vm._e(),"Date"===_vm.schedule.basedOn?_c("el-row",{staticClass:"mT20"},[_c("el-col",[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.execution_date"),prop:"values"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{multiple:!_vm.isAnnually,"collapse-tags":""},model:{value:_vm.schedule.values,callback:function($$v){_vm.$set(_vm.schedule,"values",$$v)},expression:"schedule.values"}},_vm._l(_vm.getNumberRange(31),(function(option,key){return _c("el-option",{key:parseInt(key),attrs:{value:parseInt(key),label:option}})})),1)],1)],1)],1):_vm._e(),"Week"===_vm.schedule.basedOn?_c("el-row",{staticClass:"mT20"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.execute_on"),prop:"values"}},[_c("el-col",{attrs:{span:5}},[_c("el-select",{model:{value:_vm.schedule.weekFrequency,callback:function($$v){_vm.$set(_vm.schedule,"weekFrequency",$$v)},expression:"schedule.weekFrequency"}},_vm._l(_vm.weekListMap,(function(option,key){return _c("el-option",{key:key,attrs:{label:option,value:parseInt(key)}})})),1)],1),_c("el-col",{attrs:{span:19}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{multiple:"","collapse-tags":""},model:{value:_vm.schedule.values,callback:function($$v){_vm.$set(_vm.schedule,"values",$$v)},expression:"schedule.values"}},_vm._l(_vm.weekDaysMap,(function(day,key){return _c("el-option",{key:day,attrs:{label:day,value:parseInt(key)}})})),1)],1)],1)],1):_vm._e()],1):_vm._e(),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{label:_vm.$t("setup.scheduler.execution_time"),prop:"times"}},[_vm.isDaily?_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{multiple:"","multiple-limit":_vm.timeOptionLimit,"collapse-tags":""},model:{value:_vm.schedule.times,callback:function($$v){_vm.$set(_vm.schedule,"times",$$v)},expression:"schedule.times"}},_vm._l(_vm.timeOptionMapforDaily,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1):_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{multiple:"","multiple-limit":_vm.timeOptionLimit,"collapse-tags":""},model:{value:_vm.schedule.times,callback:function($$v){_vm.$set(_vm.schedule,"times",$$v)},expression:"schedule.times"}},_vm._l(_vm.timeOptionMap,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1)])],1)],1),_vm.showRunEvery?_c("el-row",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.scheduler.run_every"))+" ")]),_c("el-col",[_c("el-select",{staticClass:"fc-input-full-border2 width100",model:{value:_vm.schedule.frequency,callback:function($$v){_vm.$set(_vm.schedule,"frequency",$$v)},expression:"schedule.frequency"}},_vm._l(_vm.runEveryOptions,(function(option,key){return _c("el-option",{key:parseInt(key),attrs:{label:option,value:parseInt(key)}})})),1)],1)],1):_vm._e(),_c("el-row",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(_vm._s(_vm.$t("setup.scheduler.skip")))]),_c("el-col",[_c("el-select",{staticClass:"fc-input-full-border2 width100",model:{value:_vm.schedule.skipEvery,callback:function($$v){_vm.$set(_vm.schedule,"skipEvery",$$v)},expression:"schedule.skipEvery"}},_vm._l(_vm.skipEveryMap,(function(item){return _c("el-option",{key:parseInt(item.value),attrs:{label:item.label,value:parseInt(item.value)}})})),1)],1)],1)],1)}),FrequencySelectorvue_type_template_id_a4cccc3e_staticRenderFns=[],cloneDeep=(__webpack_require__(634338),__webpack_require__(150361)),cloneDeep_default=__webpack_require__.n(cloneDeep),schedulerFrequencyUtil=__webpack_require__(98608),initialSchedule={times:["00:00"],startTime:null,endDate:null,skipEvery:-1,frequency:1,values:[],months:[],frequencyType:1,weekFrequency:-1,monthValue:-1,basedOn:"Date"},FrequencySelectorvue_type_script_lang_js={props:["value","isNew"],data:function(){return{timeVal:0,dateOptions:{disabledDate:function(time){var today=new Date,fiveYear=new Date,startData=time.getTime();return today.setHours(0,0,0,0),fiveYear.setFullYear(today.getFullYear()+5),startData<today.getTime()||startData>fiveYear.getTime()}},timeOptionMap:[],timeOptionMapforDaily:[],schedule:cloneDeep_default()(initialSchedule),skipEveryMap:schedulerFrequencyUtil/* skipEveryMap */.$o,weekDaysMap:schedulerFrequencyUtil/* weekDaysMap */.lI,weekListMap:schedulerFrequencyUtil/* weekListMap */.MG,fullMonthsMap:schedulerFrequencyUtil/* fullMonthsMap */.nq,frequencyTypeMap:schedulerFrequencyUtil/* frequencyTypeMap */.wF,monthOfQuarterMap:schedulerFrequencyUtil/* monthOfQuarterMap */.$7,monthOfHalfMap:schedulerFrequencyUtil/* monthOfHalfMap */.C3,basedOnMap:schedulerFrequencyUtil/* basedOnMap */.AJ,frequencyTypes:schedulerFrequencyUtil/* frequencyTypes */.j2,rules:{name:[{required:!0,message:"Name is Mandatory ",trigger:"blur"}],startTime:[{type:"date",required:!0,message:"Execution Start Date is Mandatory ",trigger:"blur"}],months:[{required:!0,message:"Months cannot be empty",trigger:"change"}],values:[{required:!0,message:"Execution Date is Mandatory ",trigger:"change"}],times:[{required:!0,message:"Execution Time is Mandatory ",trigger:"change"}]}}},computed:{endDateOptions:function(){var _ref=this||{},schedule=_ref.schedule,_ref2=schedule||{},startTime=_ref2.startTime;return{disabledDate:function(time){return time.getTime()<startTime}}},showMonths:function(){var _this$frequencyTypes=this.frequencyTypes,QUARTERLY=_this$frequencyTypes.QUARTERLY,HALF_YEARLY=_this$frequencyTypes.HALF_YEARLY,frequencyType=this.schedule.frequencyType;return[QUARTERLY,HALF_YEARLY].includes(frequencyType)},isDaily:function(){var DAILY=this.frequencyTypes.DAILY,frequencyType=this.schedule.frequencyType;return DAILY===frequencyType},showDays:function(){var WEEKLY=this.frequencyTypes.WEEKLY,frequencyType=this.schedule.frequencyType;return frequencyType>=WEEKLY},dateType:function(){var MONTHLY=this.frequencyTypes.MONTHLY,frequencyType=this.schedule.frequencyType;return frequencyType<MONTHLY?"date":"month"},showBasedOn:function(){var MONTHLY=this.frequencyTypes.MONTHLY,frequencyType=this.schedule.frequencyType;return frequencyType>=MONTHLY},showRunEvery:function(){var _this$frequencyTypes2=this.frequencyTypes,DO_NOT_REPEAT=_this$frequencyTypes2.DO_NOT_REPEAT,QUARTERLY=_this$frequencyTypes2.QUARTERLY,HALF_YEARLY=_this$frequencyTypes2.HALF_YEARLY,frequencyType=this.schedule.frequencyType;return![DO_NOT_REPEAT,QUARTERLY,HALF_YEARLY].includes(frequencyType)},timeOptionLimit:function(){var DO_NOT_REPEAT=this.frequencyTypes.DO_NOT_REPEAT,frequencyType=this.schedule.frequencyType;return frequencyType===DO_NOT_REPEAT?1:0},runEveryOptions:function(){for(var _displayNames,_this$frequencyTypes3=this.frequencyTypes,DAILY=_this$frequencyTypes3.DAILY,WEEKLY=_this$frequencyTypes3.WEEKLY,MONTHLY=_this$frequencyTypes3.MONTHLY,ANNUALLY=_this$frequencyTypes3.ANNUALLY,frequencyType=this.schedule.frequencyType,displayNames=(_displayNames={},(0,defineProperty/* default */.Z)(_displayNames,DAILY,"Day"),(0,defineProperty/* default */.Z)(_displayNames,WEEKLY,"Week"),(0,defineProperty/* default */.Z)(_displayNames,MONTHLY,"Month"),(0,defineProperty/* default */.Z)(_displayNames,ANNUALLY,"Year"),_displayNames),freqType=displayNames[frequencyType],freqList={1:freqType},freqRange=frequencyType===ANNUALLY?30:60,i=2;i<=freqRange;i++)freqList[i]="".concat(i," ").concat(freqType,"s");return freqList},monthsMap:function(){var QUARTERLY=this.frequencyTypes.QUARTERLY,frequencyType=this.schedule.frequencyType;return frequencyType===QUARTERLY?this.monthOfQuarterMap:this.monthOfHalfMap},isAnnually:function(){var ANNUALLY=this.frequencyTypes.ANNUALLY,frequencyType=this.schedule.frequencyType;return ANNUALLY===frequencyType}},watch:{schedule:{handler:function(newValue){this.$emit("input",newValue)},deep:!0}},mounted:function(){this.isNew||(this.schedule=cloneDeep_default()(this.value));for(var i=0;i<=23;i++){var time=(i<10?"0"+i:i)+":";this.timeOptionMap.push(time+"00"),this.timeOptionMap.push(time+"30")}for(var _i=0;_i<=23;_i++){var _time=(_i<10?"0"+_i:_i)+":";this.timeOptionMapforDaily.push(_time+"00"),this.timeOptionMapforDaily.push(_time+"15"),this.timeOptionMapforDaily.push(_time+"30"),this.timeOptionMapforDaily.push(_time+"45")}},methods:{resetEndDate:function(){var _ref3=this||{},schedule=_ref3.schedule;this.schedule=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},schedule),{},{endDate:null})},resetSchedule:function(){var _this$frequencyTypes4=this.frequencyTypes,DAILY=_this$frequencyTypes4.DAILY,QUARTERLY=_this$frequencyTypes4.QUARTERLY,HALF_YEARLY=_this$frequencyTypes4.HALF_YEARLY,ANNUALLY=_this$frequencyTypes4.ANNUALLY,frequencyType=this.schedule.frequencyType,months=initialSchedule.months,monthValue=([QUARTERLY,HALF_YEARLY].includes(frequencyType),1),values=frequencyType===DAILY?[]:[1],basedOn="Date";frequencyType===ANNUALLY&&(months=[1],values=1),this.schedule=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},initialSchedule),{},{frequencyType:frequencyType,monthValue:monthValue,values:values,basedOn:basedOn,months:months})},getNumberRange:function(no){for(var list={},startDate=this.$helpers.getOrgMoment("2022-01-01"),i=1;i<=no;i++)list[i]=startDate.format("DDDo"),startDate.add(1,"d");return list},onBasedOnChange:function(){this.schedule.values=[1],"Week"===this.schedule.basedOn&&(this.schedule.weekFrequency=1),"Date"===this.schedule.basedOn&&this.isAnnually&&(this.schedule.values=1)},formValidate:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var valid;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,new Promise((function(resolve){_this.$refs["frequencyForm"].validate((function(valid){resolve(valid)}))}));case 2:return valid=_context.sent,_context.abrupt("return",valid);case 4:case"end":return _context.stop()}}),_callee)})))()}}},scheduler_FrequencySelectorvue_type_script_lang_js=FrequencySelectorvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(scheduler_FrequencySelectorvue_type_script_lang_js,FrequencySelectorvue_type_template_id_a4cccc3e_render,FrequencySelectorvue_type_template_id_a4cccc3e_staticRenderFns,!1,null,null,null)
/* harmony default export */,FrequencySelector=component.exports,debounce=__webpack_require__(23279),debounce_default=__webpack_require__.n(debounce),api=__webpack_require__(32284),validation=__webpack_require__(990260),router=__webpack_require__(329435),vuex_esm=__webpack_require__(420629),EmailModel=__webpack_require__(878833),ScheduleReportNewvue_type_script_lang_js={props:["visibility","report","isEdit","model","moduleName","scheduledReportId","reportname","name","list","webtabId","appId","isPivot"],components:{FrequencySelector:FrequencySelector,EmailModel:EmailModel/* EmailModel */.E},data:function(){return{scheduled_report_name:"Schedule Report",selected_reportIds:[],reports_List:[],checked:!1,params:null,scheduleForm:{startTime:new Date,startHour:["00:00"]},schedule:null,dateOptions:{disabledDate:function(time){var today=new Date,fiveYear=new Date,startData=time.getTime();return today.setHours(0,0,0,0),fiveYear.setFullYear(today.getFullYear()+5),startData<today.getTime()||startData>fiveYear.getTime()}},rules:{},format:1,frequencyObj:null,mailJson:{fromID:null,to:[],subject:"",message:""},endType:"never",endTime:null,maxCount:null,messageChanged:!1,saving:!1,search_report_list:[],senderEmailList:[]}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)("webtabs",{currentTab:function(state){return state.selectedTab}})),{},{users:function(){return this.$store.state.users},isNew:function(){return!(this.isEdit&&this.model)},getReportsOption:function(){return this.search_report_list.length?this.search_report_list:this.reports_List}}),watch:{visibility:function(val){val&&(this.isEdit?this.init():this.scheduleForm.startTime=new Date)}},created:function(){this.initReportOptions(),this.init(),this.getFromAddressList()},methods:{getFromAddressList:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,EmailModel/* EmailModel */.E.getSenderList();case 2:_this.senderEmailList=_context.sent,(0,validation/* isEmpty */.xb)(_this.senderEmailList)||(_this.mailJson.fromID=_this.senderEmailList[0].id);case 4:case"end":return _context.stop()}}),_callee)})))()},getPaginatedParams:function(){return{appId:(0,validation/* isEmpty */.xb)(this.appId)?((0,router/* getApp */.wx)()||{}).id:this.appId,isPivot:!(0,validation/* isEmpty */.xb)(this.isPivot)&&this.isPivot,webTabId:(0,validation/* isEmpty */.xb)(this.webtabId)?(0,validation/* isEmpty */.xb)(this.currentTab)?null:this.currentTab.id:this.webtabId,moduleName:(0,validation/* isEmpty */.xb)(this.moduleName)?"energydata":this.moduleName}},initReportOptions:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var apiUrl,params,_yield$API$get,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return apiUrl="/v3/report/list",params=_this2.getPaginatedParams(),_context2.next=4,api/* API */.bl.get(apiUrl,params);case 4:_yield$API$get=_context2.sent,data=_yield$API$get.data,error=_yield$API$get.error,error||(_this2.reports_List=data.reports);case 8:case"end":return _context2.stop()}}),_callee2)})))()},setSelectedOption:function(){this.search_report_list=[]},init:function(){if(this.isEdit&&this.model){var selectedSchedule=cloneDeep_default()(this.model),_ref=selectedSchedule||{},startTime=_ref.startTime,schedule=_ref.schedule;delete schedule.rolledBackDatesAsList,delete schedule.timeObjects,this.schedule=this.deserialize(schedule,startTime),delete this.schedule.rolledBackDatesAsList,delete this.schedule.timeObjects,this.format=this.model.format,this.mailJson=this.model.mailJson,this.mailJson.to=this.model.mailJson.to,this.model.endTime&&(this.endTime=this.model.endTime),this.model.maxCount&&(this.maxCount=this.model.maxCount),this.maxCount>0?this.endType="after":this.endType=this.endTime>0?"on":"never",(0,validation/* isEmpty */.xb)(this.model.selected_reportIds)?this.selected_reportIds.push(this.model.reportId):this.selected_reportIds=this.model.selected_reportIds,this.scheduled_report_name=(0,validation/* isEmpty */.xb)(this.model.scheduled_report_name)?this.model.reportName:this.model.scheduled_report_name}else(0,validation/* isEmpty */.xb)(this.scheduledReportId)||this.selected_reportIds.push(this.scheduledReportId),(0,validation/* isEmpty */.xb)(null===this||void 0===this?void 0:this.report.id)||this.selected_reportIds.push(this.report.id),this.setInitialMessage(this.frequencyObj)},searchContent:debounce_default()((0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var props,searchText,apiUrl,params,_this3=this,_args3=arguments;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(props=_args3.length>0&&void 0!==_args3[0]?_args3[0]:{},searchText=props.searchText,apiUrl="/v3/report/list",params=this.getPaginatedParams(),(0,validation/* isEmpty */.xb)(searchText)){_context3.next=8;break}return params["searchText"]=searchText,_context3.next=8,api/* API */.bl.get(apiUrl,params).then((function(response){response.error||(_this3.search_report_list=response.data.reports)}));case 8:case"end":return _context3.stop()}}),_callee3,this)}))),500),deserialize:function(schedule,startTime){var DO_NOT_REPEAT=schedulerFrequencyUtil/* frequencyTypes */.j2.DO_NOT_REPEAT,DAILY=schedulerFrequencyUtil/* frequencyTypes */.j2.DAILY,WEEKLY=schedulerFrequencyUtil/* frequencyTypes */.j2.WEEKLY,MONTHLY=schedulerFrequencyUtil/* frequencyTypes */.j2.MONTHLY,QUARTERLY=schedulerFrequencyUtil/* frequencyTypes */.j2.QUARTERLY,HALF_YEARLY=schedulerFrequencyUtil/* frequencyTypes */.j2.HALF_YEARLY,ANNUALLY=schedulerFrequencyUtil/* frequencyTypes */.j2.ANNUALLY,_ref3=schedule||{},frequencyType=_ref3.frequencyType,yearlyDayValue=_ref3.yearlyDayValue,yearlyDayOfWeekValues=_ref3.yearlyDayOfWeekValues,weekFrequency=_ref3.weekFrequency;if(schedule.basedOn=-1===weekFrequency?"Date":"Week",schedule.startTime=startTime||null,![DO_NOT_REPEAT,DAILY,WEEKLY].includes(frequencyType)){var _Date={3:MONTHLY,5:ANNUALLY,7:QUARTERLY,9:HALF_YEARLY},Week={4:MONTHLY,6:ANNUALLY,8:QUARTERLY,10:HALF_YEARLY};schedule.frequencyType="Date"===schedule.basedOn?_Date[frequencyType]:Week[frequencyType]}return ANNUALLY===frequencyType&&(schedule.months=schedule.values,schedule.values=-1!==yearlyDayValue?[yearlyDayValue]:yearlyDayOfWeekValues),schedule},serialize:function(schedule){var _Date2,_Week,scheduleObj=cloneDeep_default()(schedule),_ref4=scheduleObj||{},frequencyType=_ref4.frequencyType,basedOn=_ref4.basedOn,MONTHLY=schedulerFrequencyUtil/* frequencyTypes */.j2.MONTHLY,QUARTERLY=schedulerFrequencyUtil/* frequencyTypes */.j2.QUARTERLY,HALF_YEARLY=schedulerFrequencyUtil/* frequencyTypes */.j2.HALF_YEARLY,ANNUALLY=schedulerFrequencyUtil/* frequencyTypes */.j2.ANNUALLY,Date=(_Date2={},(0,defineProperty/* default */.Z)(_Date2,MONTHLY,3),(0,defineProperty/* default */.Z)(_Date2,ANNUALLY,5),(0,defineProperty/* default */.Z)(_Date2,QUARTERLY,7),(0,defineProperty/* default */.Z)(_Date2,HALF_YEARLY,9),_Date2),Week=(_Week={},(0,defineProperty/* default */.Z)(_Week,MONTHLY,4),(0,defineProperty/* default */.Z)(_Week,ANNUALLY,6),(0,defineProperty/* default */.Z)(_Week,QUARTERLY,8),(0,defineProperty/* default */.Z)(_Week,HALF_YEARLY,10),_Week);return[MONTHLY,QUARTERLY,HALF_YEARLY,ANNUALLY].includes(frequencyType)&&(scheduleObj.frequencyType="Date"===basedOn?Date[frequencyType]:Week[frequencyType]),ANNUALLY===frequencyType&&("Date"===basedOn?scheduleObj.yearlyDayValue=scheduleObj.values:scheduleObj.yearlyDayOfWeekValues=scheduleObj.values,scheduleObj.values=scheduleObj.months,delete scheduleObj.months),delete scheduleObj.startTime,delete scheduleObj.basedOn,scheduleObj},setInitialMessage:function(data){!this.messageChanged&&this.report&&(this.mailJson.message="The following scheduled report from "+this.$getProperty(window.brandConfig,"name","Facilio")+" has been mailed to you by "+this.$account.user.name+"\n\nReport name : "+(this.name?this.reportname:this.report.name)+(this.report.description?"\nDescription: "+this.report.description:"")+"\nFrequency: "+(data?data.label:"")+"\n\nDetailed report is available at \n"+window.location.href+"\n\nRegards, \nTeam "+this.$getProperty(window.brandConfig,"name","Facilio"),this.mailJson.subject=(this.name?this.reportname:this.report.name)+" report scheduled at "+this.$options.filters.formatDate(this.$helpers.getTimeInOrg(this.scheduleForm.startTime)))},close:function(){this.$emit("update:visibility",!1)},save:function(){var _this$selected_report,_this4=this;if(this.mailJson.to.length&&this.mailJson.subject){var self=this,mailTemplate=this.$helpers.cloneObject(this.mailJson);this.$common.setUserMailWorkflow(this.mailJson.to,mailTemplate);var startDate=new Date;startDate.setHours(0,0,0,0);var url,params,data={fileFormat:this.format,reportId:this.isEdit?this.model.reportId:this.report.id,emailTemplate:mailTemplate,scheduleInfo:this.serialize(this.schedule),startTime:this.$helpers.getTimeInOrg(this.schedule.startTime),startDate:startDate,moduleName:"undefined"!=typeof this.moduleName&&null!=this.moduleName?this.moduleName:"energydata",
// TODO needs to get generic way
selected_reportIds:this.selected_reportIds,scheduled_report_name:this.scheduled_report_name};if(this.name&&(data.reportId=this.scheduledReportId),((0,validation/* isEmpty */.xb)(data.reportId)||-1==data.reportId&&null!==this&&void 0!==this&&null!==(_this$selected_report=this.selected_reportIds)&&void 0!==_this$selected_report&&_this$selected_report.length)&&(data.reportId=this.selected_reportIds[0]),"after"===this.endType){if(!(this.maxCount>0))return;data.maxCount=this.maxCount}else if("on"===this.endType){if(!this.endTime)return;if(data.endTime=this.$helpers.getTimeInOrg(this.endTime),data.endTime<data.startTime)return void this.$message({message:this.$t("common.wo_report.end_time_should_greater_start_time"),type:"error"})}this.isEdit?(url="/v3/report/scheduled/update",params={reportInfo:data,ids:[this.model.id]}):(url="/v3/report/scheduled/create",params={reportInfo:data}),this.saving=!0,api/* API */.bl.post(url,params).then((function(response){self.saving=!1,response.error?self.$message({message:_this4.$t("common.wo_report.schedule_failed"),type:"error"}):(self.$message({message:_this4.$t("common.wo_report.schedule_success"),type:"success"}),self.reset(),self.isEdit?response.data.id&&self.$emit("save",response.data.result.id):self.close())})).catch((function(){self.saving=!1})).finally((function(){self.close()})),this.$emit("myEvent")}},reset:function(){this.mailJson.to=[],this.mailJson.subject="",this.mailJson.message="",this.endTime=null,this.maxCount=null,this.endType="never"}}},forms_ScheduleReportNewvue_type_script_lang_js=ScheduleReportNewvue_type_script_lang_js,ScheduleReportNew_component=(0,componentNormalizer/* default */.Z)(forms_ScheduleReportNewvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ScheduleReportNew=ScheduleReportNew_component.exports},
/***/702638:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"763b584b7aa649bd99722d2be3c8036a.svg";
/***/},
/***/47424:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"400bdd76d58614975db74618a6f968ef.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/13605.js.map