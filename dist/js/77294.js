"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[77294],{
/***/21864:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return OutsideClick}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/OutsideClick.vue?vue&type=template&id=6761c108
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.visibility?_c("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:_vm.onOutsideClick,expression:"onOutsideClick"}]},[_vm._t("default")],2):_vm._e()},staticRenderFns=[],OutsideClickvue_type_script_lang_js={props:["visibility"],methods:{onOutsideClick:function(){this.$emit("onOutsideClick"),this.$emit("update:visibility",!1)}}},components_OutsideClickvue_type_script_lang_js=OutsideClickvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_OutsideClickvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,OutsideClick=component.exports},
/***/604947:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return Spinner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/Spinner.vue?vue&type=template&id=06a81286&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("transition",[_c("svg",{directives:[{name:"show",rawName:"v-show",value:_vm.show,expression:"show"}],staticClass:"spinner",class:{show:_vm.show},attrs:{width:_vm.spinnerSize,height:_vm.spinnerSize,viewBox:"0 0 44 44"}},[_c("circle",{staticClass:"path",style:{stroke:_vm.strokeColor},attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},staticRenderFns=[],Spinnervue_type_script_lang_js={name:"spinner",props:["show","size","colour"],computed:{spinnerSize:function(){return this.size?this.size+"px":"50px"},strokeColor:function(){return this.colour?this.colour:"#fd4b92"}}},components_Spinnervue_type_script_lang_js=Spinnervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_Spinnervue_type_script_lang_js,render,staticRenderFns,!1,null,"06a81286",null)
/* harmony default export */,Spinner=component.exports},
/***/178116:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PMPlannerFilter}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMPlannerFilter.vue?vue&type=template&id=da65bbf4
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pm-planner-filter"},[_c("div",{staticClass:"pm-resource-input-search"},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"fc-border-input-div2 pointer",staticStyle:{width:"285px"},on:{click:function($event){$event.stopPropagation(),_vm.showFilter=!0}}},[_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.siteName)+" ")]),_c("div",{staticClass:"fc-grey-text f11"},[_vm._v(" "+_vm._s(_vm.buildingName)+" / "+_vm._s(_vm.selectedFilters.hasOwnProperty("assetCategoryId")?_vm.assetCategoryName:null)+" "+_vm._s(_vm.selectedFilters.hasOwnProperty("teamId")?_vm.teamName:null)+" "+_vm._s(_vm.selectedFilters.hasOwnProperty("floorId")?_vm.floorName:null)+" ")])]),_c("el-button",{staticClass:"pm-search-btn pointer",attrs:{type:"primmary"},on:{click:function($event){_vm.showFilter=!0}}},[_c("InlineSvg",{attrs:{src:"svgs/filter",iconClass:"icon icon-md text-center vertical-baseline"}})],1)],1)]),_vm.showFilter?_c("outside-click",{attrs:{visibility:!0},on:{onOutsideClick:function($event){_vm.showFilter=!1}}},[_c("div",{staticClass:"pm-resource-input-select-con"},[_c("div",{staticClass:"pL20 pR20"},[_c("el-tooltip",{staticClass:"item showfilter-close-icon z-30",attrs:{effect:"dark",content:"Close",placement:"top"}},[_c("i",{staticClass:"el-icon-close pointer",attrs:{"aria-hidden":"true"},on:{click:function($event){_vm.showFilter=!1}}})]),_c("el-row",{staticClass:"pT40"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Site")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",filterable:"",loading:_vm.siteLoading,remote:"","remote-method":_vm.siteRemoteMethod},on:{change:_vm.siteChanged},model:{value:_vm.selectedFilters.siteId,callback:function($$v){_vm.$set(_vm.selectedFilters,"siteId",$$v)},expression:"selectedFilters.siteId"}},_vm._l(_vm.siteList,(function(site){return _c("el-option",{key:site.id,attrs:{label:site.name,value:site.id}})})),1)],1)])],1),_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Building")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{clearable:"",placeholder:"Select",filterable:"",loading:_vm.siteLoading,remote:"","remote-method":_vm.buildingRemoteMethod},on:{change:_vm.buildingChanged},model:{value:_vm.selectedFilters.buildingId,callback:function($$v){_vm.$set(_vm.selectedFilters,"buildingId",$$v)},expression:"selectedFilters.buildingId"}},_vm._l(_vm.buildingsInSite,(function(building){return _c("el-option",{key:building.id,attrs:{label:building.name,value:building.id}})})),1)],1)])],1),_vm.selectedFilters.hasOwnProperty("floorId")?_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Floor")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",clearable:"",filterable:""},model:{value:_vm.selectedFilters.floorId,callback:function($$v){_vm.$set(_vm.selectedFilters,"floorId",$$v)},expression:"selectedFilters.floorId"}},_vm._l(_vm.floorList,(function(floor){return _c("el-option",{key:floor.id,attrs:{label:floor.name,value:floor.id}})})),1)],1)])],1):_vm._e(),_vm.selectedFilters.hasOwnProperty("assetCategoryId")?_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Asset category")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",clearable:"",filterable:""},model:{value:_vm.selectedFilters.assetCategoryId,callback:function($$v){_vm.$set(_vm.selectedFilters,"assetCategoryId",$$v)},expression:"selectedFilters.assetCategoryId"}},_vm._l(_vm.assetCategories,(function(assetCategory){return _c("el-option",{key:assetCategory.id,attrs:{label:assetCategory.displayName,value:assetCategory.id}})})),1)],1)])],1):_vm._e(),_vm.selectedFilters.hasOwnProperty("teamId")?_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Team")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",clearable:"",filterable:""},model:{value:_vm.selectedFilters.teamId,callback:function($$v){_vm.$set(_vm.selectedFilters,"teamId",$$v)},expression:"selectedFilters.teamId"}},_vm._l(_vm.teams,(function(team){return _c("el-option",{key:team.id,attrs:{label:team.name,value:team.id}})})),1)],1)])],1):_vm._e()],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-save width100",attrs:{type:"primary"},on:{click:_vm.handleSave}},[_vm._v("Save")])],1)])]):_vm._e()],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(538077),__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(689730),__webpack_require__(420629)),OutsideClick=__webpack_require__(21864),wo_util=__webpack_require__(730347),debounce=__webpack_require__(23279),debounce_default=__webpack_require__.n(debounce),validation=__webpack_require__(990260),PMPlannerFiltervue_type_script_lang_js={components:{outsideClick:OutsideClick/* default */.Z},
//copy and display filter props, on save , emit changed filter props
created:function(){var _this=this,filterOptions=this.filterOptions;this.$set(this,"selectedFilters",filterOptions),
//this.selectedFilters = this.$helpers.cloneObject(this.filterOptions)
this.siteRemoteMethod=debounce_default()(this.filterSites,500),this.buildingRemoteMethod=debounce_default()(this.filterBuildingsInSite,500),Promise.all([this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadGroups"),this.initResources()]).then((function(){_this.selectedFilters.buildingId&&_this.getFloorList(),_this.setFilterLabels()}))},props:["filterOptions"],computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetCategories:function(state){return state.assetCategory},teams:function(state){return state.groups}})),(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory"])),data:function(){return{buildingName:null,assetCategoryName:null,siteName:null,teamName:null,floorName:null,showFilter:!1,floorList:[],selectedFilters:{},siteList:[],buildings:[],siteLoading:!1,buildingLoading:!1,buildingsInSite:[]}},methods:{initResources:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,wo_util/* getSites */.E)();case 2:return _this2.siteList=_context.sent,_context.next=5,(0,wo_util/* getBuildings */.x)();case 5:_this2.buildings=_context.sent;case 6:case"end":return _context.stop()}}),_callee)})))()},filterSites:function(searchText){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this3.siteLoading=!0,_context2.next=3,(0,wo_util/* getSites */.E)({searchText:searchText});case 3:_this3.siteList=_context2.sent,_this3.siteLoading=!1;case 5:case"end":return _context2.stop()}}),_callee2)})))()},filterBuildingsInSite:function(searchText){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var selectedFilters,_ref,siteId,params;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return selectedFilters=_this4.selectedFilters,_ref=selectedFilters||{},siteId=_ref.siteId,params={siteId:siteId},(0,validation/* isEmpty */.xb)(searchText)||(params=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},params),{},{searchText:searchText})),_this4.buildingLoading=!0,_context3.next=7,(0,wo_util/* getBuildings */.x)(params);case 7:_this4.buildingsInSite=_context3.sent,_this4.buildingLoading=!1;case 9:case"end":return _context3.stop()}}),_callee3)})))()},handleSave:function(){
//on save set new lables in filter UI
this.setFilterLabels(),this.$emit("filterChanged",this.selectedFilters),this.showFilter=!1},siteChanged:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _this5.selectedFilters.buildingId=null,_context4.next=3,_this5.filterBuildingsInSite();case 3:_this5.buildingChanged();case 4:case"end":return _context4.stop()}}),_callee4)})))()},buildingChanged:function(){this.selectedFilters.hasOwnProperty("floorId")&&(this.selectedFilters.floorId=null,this.getFloorList())},getFloorList:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var url,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(_this6.selectedFilters.buildingId){_context5.next=3;break}return _this6.floorList=[],_context5.abrupt("return");case 3:return url="floor?buildingId=".concat(_this6.selectedFilters.buildingId),_context5.next=6,_this6.$http.get(url);case 6:return resp=_context5.sent,_this6.floorList=resp.data.records,_context5.abrupt("return");case 9:case"end":return _context5.stop()}}),_callee5)})))()},setFilterLabels:function(){var _this7=this,site=this.siteList.filter((function(site){return site.id==_this7.selectedFilters.siteId}))||[];if((0,validation/* isEmpty */.xb)(site)||1!=site.length)this.siteName="";else{var _ref2=site[0]||{},name=_ref2.name;this.siteName=name||""}
// Setting Building name
var selectedFilters=this.selectedFilters,buildingsInSite=this.buildingsInSite,_ref3=selectedFilters||{},buildingId=_ref3.buildingId;if((0,validation/* isEmpty */.xb)(buildingId))this.$set(this,"buildingName","All buildings");else{var building=buildingsInSite.find((function(building){return building.id==buildingId})),buildingName=building?building.name:"";
// Truncate the building name if it has more than 25 characters
!(0,validation/* isEmpty */.xb)(buildingName)&&buildingName.length>25&&(buildingName=buildingName.slice(0,25)+"..."),this.$set(this,"buildingName",buildingName)}this.assetCategoryName=this.selectedFilters.assetCategoryId?this.getAssetCategory(this.selectedFilters.assetCategoryId).displayName:"All categories",this.teamName=this.selectedFilters.teamId?this.$store.getters.getGroup(this.selectedFilters.teamId).name:"All teams",this.selectedFilters.floorId?this.getFloorList().then((function(){_this7.floorName=_this7.floorList.find((function(e){return e.id==_this7.selectedFilters.floorId})).name})):this.floorName="All floors"}}},workorder_PMPlannerFiltervue_type_script_lang_js=PMPlannerFiltervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PMPlannerFiltervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMPlannerFilter=component.exports},
/***/738893:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return PMStaffPlanner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMStaffPlanner.vue?vue&type=template&id=661d6748
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"new-planner pm-resource-planner pR15 pL15"},[_c("facilio-resource-planner",{ref:"resourcePlanner",attrs:{plannerType:"STAFF_PLANNER",customizationSettings:_vm.customizationSettings,views:["DAY","WEEK","MONTH"],defaultView:"MONTH",saving:_vm.requestPending,isDragDropAllowed:_vm.enableDragAndDrop,isRowDragRestrict:!1,allowDownload:!0,noDataText:"No workorders"},on:{viewChanged:_vm.handleViewChanged,dropped:_vm.handleDrop},scopedSlots:_vm._u([{key:"taskContent",fn:function(eventProps){return[_c("div",{staticClass:"rp-task-text ellipsis"},[_vm._v(" "+_vm._s(eventProps.event[eventProps.displayType])+" ")])]}},{key:"card",fn:function(slotProps){return[_c("StaffPlannerCard",{attrs:{plannerEvent:slotProps},on:{close:_vm.$refs["resourcePlanner"].handleCardClose,deleteWo:function($event){return _vm.$refs["resourcePlanner"].deleteEvent($event)}}})]}}])},[_c("template",{slot:"resourceSelection"},[_c("div",{staticClass:"width200 fc-input-full-border2 mR10 fc-input-border-remove fc-input-full-border2-bold"},[_vm._v(" Staff ")])]),_c("template",{slot:"plannerLeftTop"},[_c("planner-filter",{attrs:{filterOptions:_vm.assetFilters},on:{filterChanged:_vm.handleFilterChange}})],1),_c("template",{slot:"plannerRightTop"},[_c("planner-legend",{attrs:{legendMap:_vm.legendMap,legendName:_vm.legendName}})],1)],2)],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),objectSpread2=__webpack_require__(595082),FacilioResourcePlanner=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(169358),__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(434284),__webpack_require__(634338),__webpack_require__(450886),__webpack_require__(538077),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(865137),__webpack_require__(425728),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(511982)),PlannerAPICalls=__webpack_require__(910036),PMPlannerFilter=__webpack_require__(178116),vuex_esm=__webpack_require__(420629),StaffPlannerCardvue_type_template_id_60156626_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pm-wo-card"},[_vm.loading?_c("div",{staticClass:"height300 d-flex justify-center align-center"},[_c("spinner",{attrs:{show:!0,size:"80"}})],1):_c("div",[_c("div",{staticClass:"pm-wo-card-header"},[_c("div",{},[_c("span",{staticClass:"fc-black-12 pR10 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatDateFull(_vm.plannerEvent.event.start)))]),_c("span",{staticClass:"separator white-color"},[_vm._v("|")]),_c("span",{staticClass:"fc-black-11 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatTimeFull(_vm.plannerEvent.event.start)))])]),_c("div",{staticClass:"pm-wo-card-header-close",on:{click:function($event){return _vm.$emit("close")}}},[_c("i",{staticClass:"el-icon-close fc-black3-16 fwBold white-color"})]),_c("div",{staticClass:"fc-black3-16 pT10 white-color"},[_vm._v(" "+_vm._s(_vm.workorder.subject)+" ")])]),_c("div",{staticClass:"pm-wo-card-body"},[_c("el-row",{staticClass:"pB30"},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left pT15"},[_vm._v("Assigned To")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left pT15"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.workorder,"assignedTo.name","Unassigned"))+" "+_vm._s(_vm.$getProperty(_vm.workorder,"assignedTo.name",null)?"/"+_vm.$getProperty(_vm.workorder,"assignmentGroup.name","--"):null)+" ")])])],1),_c("el-row",{},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left"},[_vm._v(" "+_vm._s(_vm.resourceTitle)+" ")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.workorder,"resource.name","--"))+" ")])])],1)],1),_c("div",{staticClass:"pm-wo-card-footer display-flex-between-space flex-middle p30 pT10 pB20"},[_c("div",{staticClass:"text-left"},[_c("router-link",{staticClass:"fc-dark-blue3-12 pointer",attrs:{to:_vm.openWoSummary(_vm.plannerEvent.event.id)}},[_vm._v("View Details")])],1),_c("div",{staticClass:"text-right"},[_vm.plannerEvent.col.past?_vm._e():_c("el-button",{staticClass:"fc-btn-icon-delete pointer",on:{click:function($event){return _vm.handleDelete(_vm.plannerEvent.event.id)}}},[_c("i",{staticClass:"el-icon-delete pR10"}),_vm._v(" Delete ")])],1)])])])},StaffPlannerCardvue_type_template_id_60156626_staticRenderFns=[],router=__webpack_require__(329435),Spinner=__webpack_require__(604947),api=__webpack_require__(32284),StaffPlannerCardvue_type_script_lang_js={components:{Spinner:Spinner/* default */.Z},props:["plannerEvent"],data:function(){return{loading:!0,workorder:null}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$get,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,api/* API */.bl.get("/workorder/summary/".concat(_this.plannerEvent.event.id));case 2:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this.$message.error("Error fetching workorder details for ",_this.plannerEvent.id):(_this.workorder=data.workorder,_this.loading=!1);case 6:case"end":return _context.stop()}}),_callee)})))()},methods:{openWoSummary:function(id){if(!(0,router/* isWebTabsEnabled */.tj)())return{name:"wosummarynew",params:{id:id}};var _ref=(0,router/* findRouteForModule */.Jp)("workorder",router/* pageTypes */.As.OVERVIEW)||{},name=_ref.name;return name?this.$router.resolve({name:name,params:{viewname:"all",id:id}}).href:void 0},handleDelete:function(workorderID){var _this2=this;this.$dialog.confirm({title:this.$t("maintenance._workorder.delete_wo"),message:this.$t("maintenance._workorder.delete_wo_body"),rbDanger:!0,rbLabel:this.$t("common._common.delete")}).then((function(confirmDelete){confirmDelete&&(_this2.$emit("deleteWo",workorderID),PlannerAPICalls/* default */.Z.deleteWorkOrder(workorderID).then((function(e){})))}))}},computed:{resourceTitle:function(){
//associated resource field,check if asset or space
return 2===this.plannerEvent.event.resource.resourceType?"Asset":"Space"}}},workorder_StaffPlannerCardvue_type_script_lang_js=StaffPlannerCardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_StaffPlannerCardvue_type_script_lang_js,StaffPlannerCardvue_type_template_id_60156626_render,StaffPlannerCardvue_type_template_id_60156626_staticRenderFns,!1,null,null,null)
/* harmony default export */,StaffPlannerCard=component.exports,LegendHelper=__webpack_require__(279729),PlannerLegend=__webpack_require__(481632),wo_util=__webpack_require__(730347),validation=__webpack_require__(990260),PMStaffPlannervue_type_script_lang_js={mixins:[LegendHelper/* default */.Z],components:{"facilio-resource-planner":FacilioResourcePlanner/* default */.Z,StaffPlannerCard:StaffPlannerCard,plannerFilter:PMPlannerFilter/* default */.Z,plannerLegend:PlannerLegend/* default */.Z},beforeUpdate:function(){},updated:function(){},watch:{appliedWoFilters:function(newVal,oldVal){this.$refs["resourcePlanner"].refreshGrid()},sites:function(newVal,oldVal){if(!(0,validation/* isEmpty */.xb)(newVal)){var assetFilters=this.assetFilters,siteId=assetFilters.siteId;((0,validation/* isEmpty */.xb)(siteId)||siteId<0)&&!(0,validation/* isEmpty */.xb)(newVal[0])&&(this.assetFilters.siteId=newVal[0].id)}}},data:function(){return{
// pmList: []
legendMap:null,customizationSettings:{legendSettings:!0},jobsData:[],staffList:[],storeDepsLoaded:!1,enableDragAndDrop:!0,perPage:15,grouping:!1,assetFilters:{siteId:null,buildingId:null,teamId:null},isGlobalSite:!1,legendColorAttribute:null,legendName:null,requestPending:!1,sites:[]}},created:function(){var _this=this;this.setTitle(this.$t("maintenance.calender.staff_planner")),this.$store.dispatch("view/loadModuleMeta","workorder"),
//wait for store dependencies to load for applying filters
Promise.all([this.$store.dispatch("loadTicketCategory"),this.$store.dispatch("loadTicketType"),this.$store.dispatch("loadSite"),this.$store.dispatch("loadTicketStatus","workorder"),this.$store.dispatch("loadTicketPriority"),this.$store.dispatch("loadUsers")]).then((function(){_this.storeDepsLoaded=!0})),this.$route.query.assetFilters?this.assetFilters=JSON.parse(this.$route.query.assetFilters):(this.assetFilters.siteId=this.getCurrentSiteId(),-1==this.assetFilters.siteId?
//if user in all sites mode , select the first site
(0,validation/* isEmpty */.xb)(this.sites[0])||(this.assetFilters.siteId=this.sites[0].id):this.isGlobalSite=!0,this.setQueryParams())},mounted:function(){},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}
//sites: state => state.site,
})),(0,vuex_esm/* mapGetters */.Se)(["getCurrentSiteId"])),{},{appliedWoFilters:function(){return this.$route.query.search?JSON.parse(this.$route.query.search):null}}),methods:{handleViewChanged:function(e){var _this2=this;this.legendColorAttribute=e.settings.legendSettings[0].name,this.legendName=e.settings.legendSettings[0].displayName,this.fetchSitesList().then((function(){_this2.fetchData(e).then((function(){_this2.colorCodeWorkOrders(_this2.legendColorAttribute,_this2.jobsData).then((function(legend){_this2.legendMap=legend,_this2.renderJobs()}))}))}))},getStaffList:function(){var _this3=this,staffList=[{id:-99,title:"Unassigned",userStatus:!0}].concat((0,toConsumableArray/* default */.Z)(this.users.filter((function(user){
//   if(!user.userStatus)return false
//need to do , show disabled users if they have pending workorders
//based on applied filters check if staff can be included in the final list
var teamCondition=!0;
// if team filter not even applied  always true,  show all  users in final list
_this3.assetFilters.teamId&&(
//if user has teams check if selected team in filter matches
teamCondition=!!user.groups&&user.groups.includes(_this3.assetFilters.teamId));var siteCondition=!0;_this3.assetFilters.siteId&&user.accessibleSpace&&(siteCondition=user.accessibleSpace.includes(_this3.assetFilters.siteId));var buildingCondition=!0;return _this3.assetFilters.buildingId&&user.accessibleSpace&&(buildingCondition=user.accessibleSpace.includes(_this3.assetFilters.siteId)||user.accessibleSpace.includes(_this3.assetFilters.buildingId)),siteCondition&&buildingCondition&&teamCondition})).map((function(user){return{id:user.id,title:user.name,userStatus:user.userStatus}}))));
//need to show all staff ,
//sort workorders in time asc order
return staffList.sort((function(e1,e2){return e1.id-e2.id})),staffList},fetchData:function(e){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var staffJobsResp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,PlannerAPICalls/* default */.Z.getStaffJobs(e,_this4.assetFilters.siteId,_this4.assetFilters.buildingId,_this4.assetFilters.teamId,_this4.appliedWoFilters);case 2:return staffJobsResp=_context.sent,_this4.jobsData=staffJobsResp.data.result.workorders.filter((function(wo){return wo.trigger&&wo.trigger.frequency>0})).map((function(wo){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({start:wo.scheduledStart,frequency:wo.trigger.frequencyEnum.substring(0,1),frequencyID:wo.trigger.frequency},wo),{},{resourceId:_this4.$getProperty(wo,"assignedTo.id",-99)})})).sort((function(e1,e2){return e1.start-e2.start})),//sort workorders in time asc order
// getStaffList is called only after workorders are fetched
_this4.staffList=_this4.getStaffList(_this4.assetFilters.teamId),
//remove disabled users if they don't have any associated WOs in the given time period
_this4.staffList=_this4.staffList.filter((function(user){return!!user.userStatus||_this4.jobsData.find((function(wo){return wo.resourceId==user.id}))})),_context.abrupt("return");case 7:case"end":return _context.stop()}}),_callee)})))()},renderJobs:function(){
//let beforeRenderJobs=performance.now()
this.$refs["resourcePlanner"].renderPlanner(this.jobsData,this.staffList,"resourceId");
//console.warn('time for renderJobs',performance.now()-beforeRenderJobs)
},setQueryParams:function(){this.$router.replace({query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.$route.query),{},{assetFilters:JSON.stringify(this.assetFilters)})})},handleFilterChange:function(changedFilter){this.assetFilters=changedFilter,this.setQueryParams(),this.showFilter=!1,this.$refs["resourcePlanner"].refreshGrid()},handleDrop:function(e){var _this5=this,event=e.event,url="/v2/pmplanner/jobs/update",workorder={id:event.id,assignedTo:{id:event.resourceId},scheduledStart:event.start};this.requestPending=!0,this.$http.post(url,{workorder:workorder}).then((function(resp){_this5.requestPending=!1,event.assignedTo=resp.data.result.workorder.assignedTo,event.assignmentGroup=resp.data.result.workorder.assignmentGroup}))},fetchSitesList:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var sitesList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,(0,wo_util/* getSites */.E)();case 2:sitesList=_context2.sent,_this6.$set(_this6,"sites",sitesList);case 4:case"end":return _context2.stop()}}),_callee2)})))()}}},workorder_PMStaffPlannervue_type_script_lang_js=PMStaffPlannervue_type_script_lang_js,PMStaffPlanner_component=(0,componentNormalizer/* default */.Z)(workorder_PMStaffPlannervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMStaffPlanner=PMStaffPlanner_component.exports},
/***/481632:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PlannerLegend}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PlannerLegend.vue?vue&type=template&id=0ab0791d
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-popover",{attrs:{placement:"bottom-end","popper-class":"planner-legend-popover","visible-arrow":!1}},[_c("div",{staticClass:"planner-legend-container fc-black-color p30 pB15 pT15"},[_c("div",{staticClass:"legend-title fc-black-color f14 bold text-left mB20 text-uppercase"},[_vm._v(" "+_vm._s(_vm.legendName)+" ")]),_c("div",{staticClass:"d-flex legend-2col-cont"},[_c("div",{staticClass:"legend-cont-col1 mR40"},_vm._l(_vm.legendMap,(function(legend,key,index){return(index+1)%2?_c("div",{key:key,staticClass:"planner-legend-item mB15"},[_c("div",{class:[["wo-legend-"+legend.colorIndex],"planner-legend-dot"]}),_c("div",{staticClass:"planner-legend-text"},[_vm._v(_vm._s(legend.name))])]):_vm._e()})),0),_c("div",{staticClass:"`legend`-cont-col2"},_vm._l(_vm.legendMap,(function(legend,key,index){return(index+1)%2?_vm._e():_c("div",{key:key,staticClass:"planner-legend-item mB15"},[_c("div",{class:[["wo-legend-"+legend.colorIndex],"planner-legend-dot"]}),_c("div",{staticClass:"planner-legend-text"},[_vm._v(_vm._s(legend.name))])])})),0)])]),_c("el-button",{staticClass:"mR20 vertical-middle text-left height35 fc-btn-grey-border40",attrs:{slot:"reference"},slot:"reference"},[_c("div",{staticClass:"planner-legend-icon-cont"},[_c("div",{staticClass:"planner-legend-icon-dot ",staticStyle:{background:"#5a6aea"}}),_c("div",{staticClass:"planner-legend-icon-dot ",staticStyle:{background:"#a85aea"}}),_c("div",{staticClass:"planner-legend-icon-dot ",staticStyle:{background:"#ea5ad2"}})])])],1)},staticRenderFns=[],PlannerLegendvue_type_script_lang_js={props:["legendMap","legendName"]},workorder_PlannerLegendvue_type_script_lang_js=PlannerLegendvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PlannerLegendvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PlannerLegend=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/77294.js.map