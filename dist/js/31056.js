"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[31056],{
/***/297157:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return ErrorBanner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/ErrorBanner.vue?vue&type=template&id=3d9e5288
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.hasError?_c("div",{staticClass:"error-block",attrs:{id:"error"}},[_c("p",{staticClass:"error-txt"},[_c("i",{staticClass:"fa fa-info-circle",attrs:{"aria-hidden":"true"}}),_vm._v(" "+_vm._s(_vm.errorMessage?_vm.errorMessage:"Please fill all mandatory fields.")+" ")]),_c("i",{staticClass:"el-icon-close error-close-icon",on:{click:_vm.closeBanner}})]):_vm._e()])},staticRenderFns=[],ErrorBannervue_type_script_lang_js={props:["error","errorMessage"],computed:{hasError:{get:function(){return this.error},set:function(value){this.$emit("update:error",value)}}},methods:{closeBanner:function(){this.hasError=!1,this.$emit("update:errorMessage","")}}},components_ErrorBannervue_type_script_lang_js=ErrorBannervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_ErrorBannervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ErrorBanner=component.exports},
/***/657659:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return HistoricalRunDialog}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/rule/HistoricalRunDialog.vue?vue&type=template&id=1ef2a102&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{visible:_vm.visibility,"append-to-body":!0,"custom-class":"setup-dialog40 setup-dialog breakdown-popup","before-close":_vm.closeDialog},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("error-banner",{attrs:{error:_vm.error,errorMessage:_vm.errorText},on:{"update:error":function($event){_vm.error=$event},"update:errorMessage":function($event){_vm.errorText=$event},"update:error-message":function($event){_vm.errorText=$event}}}),_c("div",{staticClass:"content-section"},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(_vm._s("Historical Run"))])])]),_c("div",{staticClass:"new-body-modal"},[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt pB10"},[_vm._v(_vm._s(_vm.$t("alarm.alarm.asset")))]),_c("el-input",{staticClass:"fc-border-select fc-input-full-border-select2 width100",attrs:{disabled:""},model:{value:_vm.resourceLabel,callback:function($$v){_vm.resourceLabel=$$v},expression:"resourceLabel"}},[_c("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{"line-height":"0px !important","font-size":"16px !important",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function($event){_vm.chooserVisibility=!0}},slot:"suffix"})])],1)],1),_c("el-row",{staticClass:"mT20",attrs:{align:"middle"}},[_c("el-col",{staticClass:"pR10",attrs:{span:24}},[_c("f-date-picker",{attrs:{"start-placeholder":"Start Date","end-placeholder":"End Date","picker-options":_vm.dateOptions,type:"datetimerange"},model:{value:_vm.selectedDate,callback:function($$v){_vm.selectedDate=$$v},expression:"selectedDate"}})],1)],1),_c("div",{staticClass:"fc-grey2 f11 line-height20 fw4 pT10"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.execute_for_30days"))+" ")])],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(_vm._s(_vm.$t("agent.agent.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.isSaving},on:{click:_vm.runThroughRule}},[_vm._v(_vm._s(_vm.isSaving?"Saving...":"SAVE"))])],1)]),_c("space-asset-multi-chooser",{staticClass:"fc-input-full-border-select2",attrs:{visibility:_vm.chooserVisibility,initialValues:_vm.resourceData,query:_vm.resourceQuery,showAsset:!0,disable:!0},on:{associate:_vm.associateResource,"update:visibility":function($event){_vm.chooserVisibility=$event}}})],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),validation=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(634338),__webpack_require__(990260)),ErrorBanner=__webpack_require__(297157),moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),SpaceAssetMultiChooser=__webpack_require__(673362),FDatePicker=__webpack_require__(358551),vuex_esm=__webpack_require__(420629),api=__webpack_require__(32284),HistoricalRunDialogvue_type_script_lang_js={props:["visibility","details"],components:{ErrorBanner:ErrorBanner/* default */.Z,FDatePicker:FDatePicker/* default */.Z,SpaceAssetMultiChooser:SpaceAssetMultiChooser/* default */.Z},data:function(){return{dateOptions:{disabledDate:function(time){var today=new Date;return time.getTime()>today.getTime()}},value1:null,isIncludeResource:!1,resourceQuery:null,selectedResourceList:[],chooserVisibility:!1,startTime:null,endTime:null,error:!1,errorText:"",selectedDate:null,isSaving:!1}},mounted:function(){this.$store.dispatch("loadAssetCategory")},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetCategory:function(state){return state.assetCategory}})),{},{assetCategoryId:function(){var details=this.details,_ref=details||{},moduleName=_ref.moduleName,alarmRule=_ref.alarmRule,assetCategoryId="";return assetCategoryId="newreadingrules"===moduleName?this.$getProperty(details,"assetCategory.id",""):this.$getProperty(alarmRule,"preRequsite.assetCategoryId","-1"),assetCategoryId},ruleId:function(){var details=this.details,_ref2=details||{},moduleName=_ref2.moduleName,alarmRule=_ref2.alarmRule,ruleId=null;return ruleId="newreadingrules"===moduleName?this.$getProperty(details,"id",null):this.$getProperty(alarmRule,"preRequsite.id",null),ruleId},resourceData:function(){return{assetCategory:this.assetCategoryId,isIncludeResource:this.isIncludeResource}},resourceLabel:function(){var _this=this;if(this.assetCategoryId>0){var message,category=this.assetCategory.filter((function(d){return d.id===_this.assetCategoryId})),selectedCount=this.selectedResourceList.length;if(selectedCount){var includeMsg=this.isIncludeResource?"included":"excluded";if(1===selectedCount)return this.selectedResourceList[0].name;message=selectedCount+" "+category[0].name+(selectedCount>1?"s":"")+" "+includeMsg}else message="All "+category[0].name+"s selected";return message}return this.selectedResourceList.id>0?this.selectedResourceList.name:null}}),methods:{validateEndDate:function(){var duration=moment_timezone_default().duration(moment_timezone_default()(this.selectedDate[1]).diff(moment_timezone_default()(this.selectedDate[0])));return duration.get("months")<1&&duration.get("days")<=30},associateResource:function(selectedObj){selectedObj.resourceList&&selectedObj.resourceList.length&&(this.selectedResourceList=selectedObj.resourceList,this.isIncludeResource=selectedObj.isInclude),this.chooserVisibility=!1,this.resourceQuery=null},validation:function(){null===this.fromTime||this.fromTime>1?(this.errorText="Please choose start time",this.error=!0):(null===this.toTime||this.toTime>1)&&(this.errorText="Please choose end time",this.error=!0)},runThroughRule:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var fromTime,toTime,historicalLoggerAssetIds,isInclude,url,_API$post,error,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this2.error=!1,null!==_this2.selectedDate){_context.next=5;break}return _this2.error=!0,_this2.errorText="Please select start and end date ",_context.abrupt("return");case 5:if(fromTime=(0,validation/* isEmpty */.xb)(_this2.selectedDate[0])?-1:_this2.selectedDate[0],toTime=(0,validation/* isEmpty */.xb)(_this2.selectedDate[1])?-1:_this2.selectedDate[1],!_this2.error){_context.next=9;break}return _context.abrupt("return");case 9:if(_this2.isSaving=!0,historicalLoggerAssetIds=[],_this2.selectedResourceList.length>0&&_this2.selectedResourceList.forEach((function(element){historicalLoggerAssetIds.push(element.id)})),isInclude=_this2.isIncludeResource,url="/v2/reading/rule/historicalrun/".concat(_this2.ruleId,"?startTime=").concat(fromTime,"&endTime=").concat(toTime),url+="&isInclude="+isInclude,url+="&isScaledFlow=true",_API$post=api/* API */.bl.post(url,{historicalLoggerAssetIds:historicalLoggerAssetIds}),error=_API$post.error,data=_API$post.data,!error||data){_context.next=21;break}return _this2.$message.error("Error Occurred"),_this2.closeDialog(),_context.abrupt("return");case 21:_this2.closeDialog(),_this2.isSaving=!1;case 23:case"end":return _context.stop()}}),_callee)})))()},closeDialog:function(){this.isSaving=!1,this.$emit("update:visibility",!1)}}},rule_HistoricalRunDialogvue_type_script_lang_js=HistoricalRunDialogvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(rule_HistoricalRunDialogvue_type_script_lang_js,render,staticRenderFns,!1,null,"1ef2a102",null)
/* harmony default export */,HistoricalRunDialog=component.exports},
/***/476543:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return HistoryLog}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/rule/HistoryLog.vue?vue&type=template&id=ed6a8ca4
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"history-log-page"},[_c("div",[_c("portal",{attrs:{to:_vm.tab.name+"-title-section"}},[_c("div",{staticClass:"widget-header d-flex flex-direction-row justify-content-space mB15 mT5"},[_c("div",{staticClass:"flex-middle justify-content-space width100"},[_c("div",{staticClass:"widget-header-name"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.activity_log"))+" ")]),_c("div",{staticClass:"flex-middle justify-end width90"},[_c("div",{staticClass:"fc-dark-blue4 f13 pointer",on:{click:function($event){_vm.showHistoricalDialog=!0}}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.historical_header"))+" ")]),_c("div",{staticClass:"pL10",on:{click:_vm.refresh}},[_c("i",{staticClass:"el-icon-refresh",staticStyle:{"font-weight":"bold","margin-right":"8px","font-size":"14px",color:"#324056",cursor:"pointer"}})])])])])]),_vm.parentLogLoading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.parentLogLoading,size:"80"}})],1):_vm.parentLog&&0!==_vm.parentLog.length?_c("div",{staticClass:"mB10 position-relative pB100 overflow-y-scroll"},[_c("el-row",{staticClass:"history-log-header"},[_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"history-log-header-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.header.assets"))+" ")])]),_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"history-log-header-txt"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.start_end_date"))+" ")])]),_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"history-log-header-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.executed_by"))+" ")])]),_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"history-log-header-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.executed_time"))+" ")])]),_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"history-log-header-txt"},[_vm._v(" "+_vm._s(_vm.$t("alarm.sensor_alarm.alarms"))+" ")])]),_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"history-log-header-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.status"))+" ")])])],1),_c("el-collapse",{staticClass:"history-collapse",attrs:{accordion:!0},on:{change:_vm.handleChange},model:{value:_vm.activeNames,callback:function($$v){_vm.activeNames=$$v},expression:"activeNames"}},_vm._l(_vm.parentLog,(function(parent,index){return _c("el-collapse-item",{key:parent.id,attrs:{name:index,data:parent}},[_c("template",{slot:"title"},[_c("el-row",{staticClass:"history-collapse-header"},[_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"flex-middle pT10"},[_c("i",{staticClass:"el-icon-caret-right"}),_c("i",{staticClass:"el-icon-caret-bottom"}),_c("div",{staticClass:"fc-black-com f13 line-height20"},[_vm._v(" "+_vm._s(parent.noOfResources)+" "+_vm._s(_vm.$t("common.header.assets"))+" ")])])]),_c("el-col",{staticClass:"pB15",attrs:{span:4}},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"fc-grey2 f13 line-height20 fw4"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.start"))+" ")]),_c("div",{staticClass:"fc-black-com f13 pL5 line-height20 fw4"},[_vm._v(" "+_vm._s(_vm.$helpers.formatDateFull(parent.startTime))+" ")])]),_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"fc-grey2 f13 line-height20 fw4"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.end"))+" ")]),_c("div",{staticClass:"fc-black-com f13 pL10 line-height20 fw4"},[_vm._v(" "+_vm._s(_vm.$helpers.formatDateFull(parent.endTime))+" ")])])]),_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"fc-black-com f13 line-height20 fw4"},[_c("span",[_c("avatar",{attrs:{size:"md",user:{name:parent.createdBy?_vm.$store.getters.getUser(parent.createdBy).name:"Unknown"}}}),_vm._v(" "+_vm._s(parent.createdBy?_vm.$store.getters.getUser(parent.createdBy).name:"Unknown")+" ")],1)])]),_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"fc-black-com f13 fw4 line-height20"},[_vm._v(" "+_vm._s(_vm.$helpers.formatDateFull(parent.createdTime))+" ")]),_c("div",{staticClass:"fc-black-com f13 fw4 line-height20"},[_vm._v(" "+_vm._s(_vm.$helpers.formatTimeFull(parent.createdTime))+" ")])]),_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"fc-black-com f13 line-height20 fw4 pT10"},[_vm._v(" "+_vm._s(parent.totalAlarmCount>0?parent.totalAlarmCount+" Occurred":"No occurrence")+" ")])]),_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-black-com f13 bold line-height20 flex-middle fw4 pT10"},[_c("div",[_vm._v(" "+_vm._s(parent.resolvedResourcesCount)+" / "+_vm._s(parent.noOfResources)+" ")]),_c("div",{staticClass:"pL10",class:"f14 line-height20 fw4",style:{color:_vm.$constants.RULE_JOB_STATUS[parent.status].color}},[_vm._v(" "+_vm._s(_vm.$constants.RULE_JOB_STATUS[parent.status].label)+" ")])])])],1)],1),_c("div",[parent.loading?_c("el-row",{staticClass:"history-collapse-child"},[_c("spinner",{attrs:{show:parent.loading,size:"80"}})],1):_c("el-collapse",{staticClass:"history-resource-collapse sub-history-resource-collapse",attrs:{accordion:!0},on:{change:_vm.handleResourceChange},model:{value:_vm.resourceName,callback:function($$v){_vm.resourceName=$$v},expression:"resourceName"}},_vm._l(_vm.childrenMap[parent.id],(function(child,childIndex){return _c("el-collapse-item",{key:child.id+child.resourceId,attrs:{name:childIndex,data:child}},[_c("template",{slot:"title"},[_c("el-row",{staticClass:"history-collapse-child"},[_c("el-col",{attrs:{span:9}},[_c("div",{staticClass:"flex-middle pT10 pL10"},[_c("i",{staticClass:"el-icon-caret-right"}),_c("i",{staticClass:"el-icon-caret-bottom"}),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(child.resourceContext.name)+" ")])])]),_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"hide-v"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.dont_remove"))+" ")])]),_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"hide-v"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.dont_remove"))+" ")])]),_c("el-col",{staticClass:"text-left",attrs:{span:3}},[_c("div",{staticClass:"fc-black-com f13 line-height20 fw4"},[_vm._v(" "+_vm._s(child.alarmCount>0?child.alarmCount+" Occurred":"No occurrence")+" ")])]),_c("el-col",{staticClass:"text-left",attrs:{span:4}},[_c("div",{class:"f14",style:{color:_vm.$constants.CHILD_JOB_STATUS[child.status].color}},[_vm._v(" "+_vm._s(_vm.$constants.CHILD_JOB_STATUS[child.status].label)+" ")])])],1)],1),_c("div",[child.loading?_c("el-row",{staticClass:"history-collapse-child"},[_c("spinner",{attrs:{show:child.loading,size:"80"}})],1):_vm._l(_vm.dateLogMap[child.id],(function(dateLog){return _c("el-row",{key:dateLog.id,staticClass:"sub-history-collapse-child"},[_c("el-col",{attrs:{span:1}},[_c("div",{staticClass:"hide-v"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.dont_remove"))+" ")])]),_c("el-col",{staticClass:"pB15",attrs:{span:5}},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"fc-black-com f13 pL5 line-height20 fw4"},[_vm._v(" "+_vm._s(_vm.$helpers.formatDateFull(dateLog.splitStartTime)+" "+_vm.$helpers.formatTimeFull(dateLog.splitStartTime))+" ")]),_vm._v(" - "),_c("div",{staticClass:"fc-black-com f13 pL10 line-height20 fw4 row"},[_vm._v(" "+_vm._s(_vm.$helpers.formatDateFull(dateLog.splitEndTime)+" "+_vm.$helpers.formatTimeFull(dateLog.splitEndTime))+" ")])])]),_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"hide-v"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.dont_remove"))+" ")])]),dateLog.errorMessage?_c("el-col",{staticClass:"text-left pR",attrs:{span:7}},[_c("div",{staticClass:"fc-black-com f11 line-height20 fw4"},[_vm._v(" "+_vm._s(dateLog.errorMessage)+" ")])]):_c("el-col",{attrs:{span:7}},[_c("div",{staticClass:"hide-v"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.dont_remove"))+" ")])]),_c("el-col",{staticClass:"text-right",attrs:{span:3}}),_c("el-col",{staticClass:"text-left pL30",attrs:{span:4}},[_c("div",{class:"f14",style:{color:_vm.$constants.JOB_STATUS[dateLog.status].color}},[_vm._v(" "+_vm._s(_vm.$constants.JOB_STATUS[dateLog.status].label)+" ")])])],1)}))],2)],2)})),1)],1),_c("div")],2)})),1)],1):_c("div",{staticClass:"mT40 history-empty-state"},[_c("InlineSvg",{attrs:{src:"svgs/emptystate/history",iconClass:"icon text-center icon-xxxxlg emptystate-icon-size"}}),_c("div",{staticClass:"fc-black-dark f18 bold"},[_vm._v(" "+_vm._s(_vm.$t("common._common.no_log_available"))+" ")])],1),_vm.showHistoricalDialog&&!_vm.isNewRule?_c("historical-run-dialog",{attrs:{visibility:_vm.showHistoricalDialog,details:_vm.details},on:{"update:visibility":function($event){_vm.showHistoricalDialog=$event}}}):_vm._e(),_vm.showHistoricalDialog&&_vm.isNewRule?_c("HistoricalRun",{on:{close:function($event){_vm.showHistoricalDialog=!1}}}):_vm._e()],1)])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),Avatar=(__webpack_require__(865137),__webpack_require__(574752)),validation=__webpack_require__(990260),api=__webpack_require__(32284),CreateRuleHistoricalFormvue_type_template_id_2cbca375_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{title:_vm.$t("rule.historical.run_historical"),visible:!0,"append-to-body":!0,"custom-class":"setup-dialog40 rule-historical-popup-dialog bR8","before-close":_vm.closeDialog}},[_c("el-form",{ref:"historyForm",attrs:{"label-position":"top",model:_vm.historyForm,rules:_vm.formRules}},[_c("el-form-item",{attrs:{label:"Asset",prop:"assets"}},[_c("FLookupField",{key:"assets-lookup-field",ref:"assets-lookup-field",attrs:{model:_vm.historyForm.assets,field:_vm.assetField,categoryId:_vm.assetCategoryId},on:{"update:model":function($event){return _vm.$set(_vm.historyForm,"assets",$event)},showLookupWizard:_vm.showLookupWizard}})],1),_c("el-form-item",{attrs:{label:"Actions"}},[_c("el-checkbox",{attrs:{label:_vm.$t("rule.historical.create_alarm"),disabled:""},model:{value:_vm.historyForm.alarm,callback:function($$v){_vm.$set(_vm.historyForm,"alarm",$$v)},expression:"historyForm.alarm"}}),_c("el-checkbox",{attrs:{label:_vm.$t("rule.historical.calculate_fault_impact"),disabled:""},model:{value:_vm.historyForm.impact,callback:function($$v){_vm.$set(_vm.historyForm,"impact",$$v)},expression:"historyForm.impact"}}),_c("el-checkbox",{attrs:{label:_vm.$t("rule.historical.calculate_rca"),disabled:""},model:{value:_vm.historyForm.rca,callback:function($$v){_vm.$set(_vm.historyForm,"rca",$$v)},expression:"historyForm.rca"}})],1),_c("el-form-item",{attrs:{label:"Interval",prop:"dateRange"}},[_c("FddHistoricalDatePicker",{on:{rangeChange:_vm.setDateRange}})],1),_c("el-form-item",{staticClass:"mB10"},[_c("div",{staticClass:"rule-history-log-create-button"},[_c("el-button",{on:{click:_vm.closeDialog}},[_vm._v(" "+_vm._s(_vm.$t("common._common.cancel"))+" ")]),_c("el-button",{attrs:{type:"primary"},on:{click:_vm.onSubmit}},[_vm._v(" "+_vm._s(_vm.$t("common.products.create"))+" ")])],1)])],1),_vm.canShowLookupWizard?_c("div",[_vm.isNewLookupWizardEnabled?_c("LookupWizard",{attrs:{canShowLookupWizard:_vm.canShowLookupWizard,field:_vm.selectedLookupField},on:{"update:canShowLookupWizard":function($event){_vm.canShowLookupWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowLookupWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}}):_c("FLookupFieldWizard",{attrs:{canShowLookupWizard:_vm.canShowLookupWizard,selectedLookupField:_vm.selectedLookupField,categoryId:_vm.assetCategoryId},on:{"update:canShowLookupWizard":function($event){_vm.canShowLookupWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowLookupWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}})],1):_vm._e()],1)},CreateRuleHistoricalFormvue_type_template_id_2cbca375_staticRenderFns=[],toConsumableArray=__webpack_require__(488478),FLookupField=(__webpack_require__(450886),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(891719),__webpack_require__(855048)),FLookupFieldWizard=__webpack_require__(499751),ui_forms=__webpack_require__(141323),FddHistoricalDatePicker=__webpack_require__(748791),CreateRuleHistoricalFormvue_type_script_lang_js={components:{FLookupField:FLookupField/* default */.Z,FLookupFieldWizard:FLookupFieldWizard["default"],FddHistoricalDatePicker:FddHistoricalDatePicker/* default */.Z,LookupWizard:ui_forms/* LookupWizard */.ns},created:function(){this.loadRule()},data:function(){return{ruleList:[],assetCategoryId:null,historyForm:{assets:null,dateRange:null,alarm:!0,rca:!0,impact:!0},assetField:{isDataLoading:!1,options:[],lookupModuleName:"asset",placeHolderText:"".concat(this.$t("rule.historical.assets")),field:{lookupModule:{name:"asset",displayName:"Asset"}},filters:{},multiple:!0},canShowLookupWizard:!1,selectedLookupField:null,formRules:{dateRange:[{required:!0,message:"".concat(this.$t("rule.historical.validate_daterange")),trigger:"blur"}]}}},computed:{ruleId:function(){var _this$$route=this.$route,_this$$route2=void 0===_this$$route?{}:_this$$route,params=_this$$route2.params;return parseInt(this.$getProperty(params,"id"))},isNewLookupWizardEnabled:function(){return this.$helpers.isLicenseEnabled("NEW_LOOKUP_WIZARD")}},methods:{closeDialog:function(){this.$emit("close")},onSubmit:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:_this.$refs["historyForm"].validate((function(valid){valid&&_this.createHistory()}));case 1:case"end":return _context.stop()}}),_callee)})))()},createHistory:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var historyForm,ruleId,_ref,dateRange,assets,url,params,_yield$API$post,data,error,_ref2,success;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return historyForm=_this2.historyForm,ruleId=_this2.ruleId,_ref=historyForm||{},dateRange=_ref.dateRange,assets=_ref.assets,url="v3/readingrule/historical/run",params={recordId:ruleId,assetIds:assets,startTime:dateRange[0],endTime:dateRange[1]},_context2.next=6,api/* API */.bl.post(url,params);case 6:_yield$API$post=_context2.sent,data=_yield$API$post.data,error=_yield$API$post.error,(0,validation/* isEmpty */.xb)(error)?(_ref2=data||{},success=_ref2.success,_this2.$message.success(success),_this2.closeDialog()):_this2.$message.error(error.message);case 10:case"end":return _context2.stop()}}),_callee2)})))()},loadRule:function(){var _arguments=arguments,_this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var force,ruleId,_yield$API$fetchRecor,newreadingrules,_ref3,_ref3$assetCategory,_ref3$assetCategory2,id;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return force=!(_arguments.length>0&&void 0!==_arguments[0])||_arguments[0],ruleId=_this3.ruleId,_context3.prev=2,_context3.next=5,api/* API */.bl.fetchRecord("newreadingrules",{id:ruleId},{force:force});case 5:_yield$API$fetchRecor=_context3.sent,newreadingrules=_yield$API$fetchRecor.newreadingrules,_ref3=newreadingrules||{},_ref3$assetCategory=_ref3.assetCategory,_ref3$assetCategory2=void 0===_ref3$assetCategory?{}:_ref3$assetCategory,id=_ref3$assetCategory2.id,_this3.assetCategoryId=id,_context3.next=14;break;case 11:_context3.prev=11,_context3.t0=_context3["catch"](2),_this3.$message.error(_context3.t0.message);case 14:case"end":return _context3.stop()}}),_callee3,null,[[2,11]])})))()},showLookupWizard:function(field,canShow){this.$set(this,"selectedLookupField",field),this.$set(this,"canShowLookupWizard",canShow)},setLookupFieldValue:function(props){var historyForm=this.historyForm,field=props.field,_ref4=field||{},_ref4$options=_ref4.options,options=void 0===_ref4$options?[]:_ref4$options,_ref4$selectedItems=_ref4.selectedItems,selectedItems=void 0===_ref4$selectedItems?[]:_ref4$selectedItems,selectedItemIds=[];if(!(0,validation/* isEmpty */.xb)(selectedItems))if(selectedItemIds=selectedItems.map((function(item){return item.value})),(0,validation/* isEmpty */.xb)(options))options=(0,toConsumableArray/* default */.Z)(selectedItems);else{var _options,ids=options.map((function(item){return item.value})),newOptions=selectedItems.filter((function(item){return!ids.includes(item.value)}));(_options=options).unshift.apply(_options,(0,toConsumableArray/* default */.Z)(newOptions))}this.$set(historyForm,"assets",selectedItemIds),this.$set(this.selectedLookupField,"options",options)},setDateRange:function(dateObj){this.$set(this.historyForm,"dateRange",dateObj)}}},rule_CreateRuleHistoricalFormvue_type_script_lang_js=CreateRuleHistoricalFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(rule_CreateRuleHistoricalFormvue_type_script_lang_js,CreateRuleHistoricalFormvue_type_template_id_2cbca375_render,CreateRuleHistoricalFormvue_type_template_id_2cbca375_staticRenderFns,!1,null,null,null)
/* harmony default export */,CreateRuleHistoricalForm=component.exports,HistoricalRunDialog=__webpack_require__(657659),HistoryLogvue_type_script_lang_js={props:["widget","groupKey","moduleName","details","fields","primaryFields","layoutParams","resizeWidget","hideTitleSection","activeTab","tab","sectionKey"],components:{Avatar:Avatar["default"],HistoricalRun:CreateRuleHistoricalForm,HistoricalRunDialog:HistoricalRunDialog/* default */.Z},data:function(){return{childrenMap:{},dateLogMap:{},showHistoricalDialog:!1,parentLog:null,parentLogLoading:!1,activeRule:null,activeNames:[],focusParentId:null,resourceName:[],orderType:"desc"}},mounted:function(){this.loadParentLogger()},computed:{ruleId:function(){var details=this.details,_ref=details||{},moduleName=_ref.moduleName,alarmRule=_ref.alarmRule,ruleId=null;return ruleId="newreadingrules"===moduleName?this.$getProperty(details,"id",null):this.$getProperty(alarmRule,"preRequsite.id",null),ruleId},isNewRule:function(){var details=this.details,_ref2=details||{},moduleName=_ref2.moduleName;return"newreadingrules"===moduleName}},methods:{refresh:function(){this.loadParentLogger()},handleChange:function(data){(0,validation/* isEmpty */.xb)(data)||(this.focusParentId=this.parentLog[data].id,this.childrenMap[this.parentLog[data].id]||this.handleNodeClick(this.parentLog[data]))},handleResourceChange:function(data){(0,validation/* isEmpty */.xb)(data)||this.dateLogMap[this.childrenMap[this.focusParentId][data].id]||this.handleResourceApiCall(this.childrenMap[this.focusParentId][data])},loadParentLogger:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var url,_yield$API$get,error,data,message,workflowRuleLoggers;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.parentLogLoading=!0,url="v2/historicalLogger/getWorkflowRuleLoggers?ruleId="+_this.ruleId,_context.next=4,api/* API */.bl.get(url);case 4:_yield$API$get=_context.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?(message=error.message,_this.$message.error(message||"Error Occured")):(workflowRuleLoggers=data.workflowRuleLoggers,_this.parentLog=workflowRuleLoggers,_this.parentLogLoading=!1,_this.parentLog.sort((function(a,b){return a.createdTime>b.createdTime?-1:a.createdTime<b.createdTime?1:0})));case 8:case"end":return _context.stop()}}),_callee)})))()},handleResourceApiCall:function(resourceData){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var url,_yield$API$get2,error,data,message,workflowRuleHistoricalLogs;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return url="v2/historicalLogger/getWorkflowRuleResourceHistoricalLogs?parentRuleResourceId="+resourceData.id,_this2.$set(_this2,"loading",!0),_context2.next=4,api/* API */.bl.get(url);case 4:_yield$API$get2=_context2.sent,error=_yield$API$get2.error,data=_yield$API$get2.data,error?(message=error.message,_this2.$message.error(message||"Error Occured")):(workflowRuleHistoricalLogs=data.workflowRuleHistoricalLogs,_this2.$set(resourceData,"loading",!1),_this2.dateLogMap[resourceData.id]=Object.assign(workflowRuleHistoricalLogs),resourceData.loading=!1,_this2.$forceUpdate());case 8:case"end":return _context2.stop()}}),_callee2)})))()},handleNodeClick:function(nodeData){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var url,_yield$API$get3,error,data,message,workflowRuleResourceLoggers;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return url="v2/historicalLogger/getWorkflowRuleResourceLoggers?parentRuleLoggerId="+nodeData.id,_this3.$set(nodeData,"loading",!0),_context3.next=4,api/* API */.bl.get(url);case 4:_yield$API$get3=_context3.sent,error=_yield$API$get3.error,data=_yield$API$get3.data,error?(message=error.message,_this3.$message.error(message||"Error Occured")):(workflowRuleResourceLoggers=data.workflowRuleResourceLoggers,_this3.$set(nodeData,"loading",!1),_this3.childrenMap[nodeData.id]=Object.assign(workflowRuleResourceLoggers),nodeData.loading=!1);case 8:case"end":return _context3.stop()}}),_callee3)})))()}}},rule_HistoryLogvue_type_script_lang_js=HistoryLogvue_type_script_lang_js,HistoryLog_component=(0,componentNormalizer/* default */.Z)(rule_HistoryLogvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,HistoryLog=HistoryLog_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/31056.js.map