"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[21750],{
/***/685412:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return CommissioningList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/commissioning/CommissioningList.vue?vue&type=template&id=edaebc14
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"full-layout-white height100 user-layout width100"},[_vm._m(0),_c("div",{staticClass:"container-scroll"},[_c("div",{staticClass:"row setting-Rlayout"},[_c("div",{staticClass:"col-lg-12 col-md-12"},[_c("div",{staticClass:"commissioning-tab-container mT20"},[_c("controller-filter",{attrs:{loading:_vm.loading},on:{"update:loading":function($event){_vm.loading=$event},onControllerSelected:_vm.onControllerSelected}},[_c("el-col",{staticClass:"flRight commission-tool-right",attrs:{span:8}},["mapped"===_vm.selectedTab&&_vm.canSubscribe?_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{disabled:!_vm.selectedInstanceIds.length,type:"primary",loading:_vm.subscribing},on:{click:_vm.onSubscribeClicked}},[_vm._v(_vm._s(_vm.subscribing?"Subscribing...":"Subscribe")+" ")]):"subscribed"===_vm.selectedTab?_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{disabled:!_vm.selectedInstanceIds.length,type:"primary",loading:_vm.unsubscribing},on:{click:_vm.unsubscribe}},[_vm._v(_vm._s(_vm.unsubscribing?"Unsubscribing...":"Unsubscribe")+" ")]):_vm._e(),"mapped"===_vm.selectedTab||"notmapped"===_vm.selectedTab?_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",attrs:{type:"primary"},on:{click:function($event){return _vm.mapInstance()}}},[_vm._v("SAVE ALL")]):_vm._e(),_c("div",[_c("el-popover",{attrs:{placement:"right",width:"300",trigger:"click","popper-class":"commission-popover",title:"Update"},on:{show:_vm.cleardata},model:{value:_vm.poptab,callback:function($$v){_vm.poptab=$$v},expression:"poptab"}},[_c("div",{staticClass:"height250 pL10 pR10"},[_c("div",{},[_c("div",{staticClass:"fc-dark-grey-txt14 mB10"},[_vm._v("Category")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",clearable:"",placeholder:"Category"},on:{change:function($event){return _vm.updateAsset()}},model:{value:_vm.updateBulk.categoryvalue,callback:function($$v){_vm.$set(_vm.updateBulk,"categoryvalue",$$v)},expression:"updateBulk.categoryvalue"}},_vm._l(_vm.assetCategories,(function(category,idx){return _c("el-option",{key:idx,attrs:{label:category.name,value:category.id}})})),1)],1),_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-dark-grey-txt14 mB10"},[_vm._v("Asset")])]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{clearable:"",filterable:"",placeholder:"Asset"},model:{value:_vm.updateBulk.assetvalue,callback:function($$v){_vm.$set(_vm.updateBulk,"assetvalue",$$v)},expression:"updateBulk.assetvalue"}},_vm._l(_vm.assets[this.updateBulk.categoryvalue],(function(asset){return _c("el-option",{key:asset.id,attrs:{label:asset.name,value:asset.id}})})),1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_vm._t("footer",(function(){return[_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",attrs:{type:"primary"},on:{click:function($event){_vm.poptab=!1,_vm.cancel()}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.updateCategoryAndAsset}},[_vm._v(_vm._s("SAVE")+" ")])],1)]}))],2),_vm.selectedInstanceIds.length?_c("el-button",{staticClass:"fc-btn-pink-medium-fill mT20 mL20",attrs:{slot:"reference"},on:{click:function($event){_vm.poptab=!0}},slot:"reference"},[_vm._v("MAP ASSET")]):_vm._e()],1)],1),154===_vm.$org.id||133===_vm.$org.id?_c("div",{staticClass:"fc-dark-blue-txt pointer show-instance-txt flRight ",on:{click:function($event){_vm.showByDevice=!_vm.showByDevice}}},[_vm._v(" "+_vm._s(_vm.showByDevice?"Show By Instance":"Show By Device")+" ")]):_vm._e()],1)],1),_c("div",{staticClass:"fR commissioning-search-con"},[_c("pagination",{ref:"f-page",staticClass:"commission-pagenation-con",attrs:{total:_vm.listCount,perPage:_vm.perPage}}),_c("div",{staticClass:"commissioning-search-block"},[_vm.showQuickSearches?_c("div",{staticClass:"row",staticStyle:{"margin-right":"20px"}},[_c("div",{staticClass:"fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper fc-list-search-wrapper-reading relative"},[_c("svg",{staticClass:"search-icon3",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 32 32"}},[_c("title",[_vm._v("search")]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQueries,expression:"quickSearchQueries"}],ref:"quickSearchQueries",staticClass:"quick-search-input6",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQueries},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.quickSearches()},input:function($event){$event.target.composing||(_vm.quickSearchQueries=$event.target.value)}}}),_c("svg",{staticClass:"close-icon6",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.closeSearches}},[_c("title",[_vm._v("close")]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_vm._e(),_c("div",{staticClass:"pointer text-right search-show-hide",on:{click:_vm.toggleQuickSearches}},[_vm._m(1)])])],1),_c("el-tabs",{staticClass:"pT20",on:{"tab-click":function($event){_vm.listCount=null,_vm.totalCount=null,_vm.loadInstances()}},model:{value:_vm.selectedTab,callback:function($$v){_vm.selectedTab=$$v},expression:"selectedTab"}},_vm._l(_vm.tabs,(function(tab){return _c("el-tab-pane",{key:tab.key,attrs:{label:tab.label,name:tab.key}},[_vm.showByDevice?[_c("table",{staticClass:"setting-list-view-table"},[_c("thead",[_c("tr",[_c("th",{staticStyle:{width:"5%",padding:"15px 20px"}},[_c("el-checkbox",{attrs:{value:_vm.selectedInstanceIds.length&&_vm.selectedInstanceIds.length===_vm.instances.length},on:{change:_vm.toggleSelectAll}})],1),_c("th",{staticClass:"setting-table-th setting-th-text",staticStyle:{width:"58%","padding-left":"20px !important"}},[_vm._v(" DEVICE ")]),_c("th",{staticClass:"setting-table-th setting-th-text",staticStyle:{width:"160px","padding-left":"5px !important"}},[_vm._v(" CATEGORY ")]),_c("th",{staticClass:"setting-table-th setting-th-text",staticStyle:{width:"160px","padding-left":"5px !important"}},[_vm._v(" ASSET ")])])])]),_c("v-infinite-scroll",{staticStyle:{"max-height":"80vh","overflow-y":"scroll"},attrs:{loading:_vm.fetchingMore,offset:20},on:{bottom:_vm.loadMore}},[_c("table",{staticClass:"commissioning-list-table"},[_vm.loading?_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1)])]):_vm.instances.length?_c("el-collapse",{tag:"tbody",attrs:{accordion:""},model:{value:_vm.selectedDevice,callback:function($$v){_vm.selectedDevice=$$v},expression:"selectedDevice"}},_vm._l(_vm.deviceInstanceMap,(function(info,device,index){return _c("el-collapse-item",{key:index,tag:"tr",staticClass:"expand-bar-container",attrs:{name:device}},[_c("template",{slot:"title"},[_c("div",{staticClass:"commissioning-list-h inline",staticStyle:{width:"50%","padding-left":"20px"}},[_c("el-checkbox",{attrs:{value:_vm.selectedInstanceIds.indexOf(info.instances[0].id)>=0},on:{change:function($event){return _vm.toggleSelection(info.instances[0].id)}}}),_c("span",{staticStyle:{"padding-left":"20px"}},[_vm._v(_vm._s(info.device))])],1),_c("div",{staticClass:"expand-content-th inline",staticStyle:{width:"213px"}},[_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"160px"},attrs:{filterable:"",placeholder:"Select Category"},on:{change:function($event){return _vm.onCategoryChanged(null,info)}},model:{value:info.categoryId,callback:function($$v){_vm.$set(info,"categoryId",$$v)},expression:"info.categoryId"}},_vm._l(_vm.assetCategories,(function(category,idx){return _c("el-option",{key:idx,attrs:{label:category.name,value:category.id}})})),1)],1),_c("div",{staticClass:"expand-content-th inline",staticStyle:{width:"160px"}},[_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"160px"},attrs:{placeholder:"Select Asset",filterable:""},on:{change:function($event){return _vm.onAssetChanged(null,info)}},model:{value:info.resourceId,callback:function($$v){_vm.$set(info,"resourceId",$$v)},expression:"info.resourceId"}},_vm._l(_vm.assets[info.categoryId],(function(asset){return _c("el-option",{key:asset.id,attrs:{label:asset.name,value:asset.id}})})),1)],1)]),_vm._l(info.instances,(function(instance,idx){return _c("div",{key:idx,staticClass:"units-tr-row"},[_c("div",{staticClass:"units-td-row inline",staticStyle:{width:"20%"}}),_c("div",{staticClass:"units-td-row inline"},[_vm._v(" "+_vm._s(instance.instance)+" ")]),_c("div",{staticClass:"units-td-row inline pR20"},[_c("el-select",{staticClass:"fc-input-full-border-select2 mL20",staticStyle:{width:"160px"},attrs:{filterable:""},on:{change:function($event){return _vm.fieldupdate(null,instance,info)}},model:{value:instance.fieldId,callback:function($$v){_vm.$set(instance,"fieldId",$$v)},expression:"instance.fieldId"}},_vm._l(_vm.readingMap[info.resourceId]||[],(function(reading){return _c("el-option",{key:instance.instance+reading.fieldId,attrs:{label:reading.field.displayName,value:reading.fieldId}})})),1),info.resourceId>0?_c("div",{staticClass:"inline pointer actions",on:{click:function($event){return _vm.showAddReading(info.resourceId,info.categoryId)}}},[_c("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"el-icon-plus",attrs:{title:"Add Reading"}})]):_vm._e(),info.resourceId>0&&instance.fieldId&&[4,8].includes(_vm.readingMap[info.resourceId][instance.fieldId].field.dataType)?_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"actions inline pointer mL10",attrs:{title:"Set Values"},on:{click:function($event){return _vm.showInputReadingDialog(_vm.readingMap[info.resourceId][instance.fieldId])}}},[_c("i",{staticClass:"el-icon-edit-outline"})]):_vm._e()],1),_c("div",{staticClass:"units-td-row inline"},[instance.fieldId&&_vm.isMetricAvailable(info.resourceId,instance.fieldId)?_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"160px"},attrs:{placeholder:instance.defaultUnit,filterable:""},on:{change:function($event){_vm.updateUnit($event,info.resourceId,instance.fieldId),_vm.fieldupdate($event,instance,info)}},model:{value:_vm.readingMap[info.resourceId][instance.fieldId].inputUnit,callback:function($$v){_vm.$set(_vm.readingMap[info.resourceId][instance.fieldId],"inputUnit",$$v)},expression:"\n                                  readingMap[info.resourceId][\n                                    instance.fieldId\n                                  ].inputUnit\n                                "}},_vm._l(_vm.metricsUnits.metricWithUnits[_vm.readingMap[info.resourceId][instance.fieldId].field.metricEnum],(function(unit,index){return _c("el-option",{key:index,attrs:{value:unit.unitId,label:unit.displayName}},[_c("span",{domProps:{innerHTML:_vm._s(unit.displayName+(unit.symbol?" ("+unit.symbol+")":""))}})])})),1):_vm._e()],1)])}))],2)})),1):_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center pT20 pB20",attrs:{colspan:"100%"}},[_vm._v(" No instances available ")])])])],1)])]:_c("v-infinite-scroll",{staticStyle:{"max-height":"80vh","overflow-y":"scroll"},attrs:{loading:_vm.fetchingMore,offset:20},on:{bottom:_vm.loadMore}},[_c("table",{staticClass:"setting-list-view-table instance-mapping"},["subscribed"===_vm.selectedTab?_c("thead",[_c("tr",[_c("th",{staticStyle:{width:"5%",padding:"15px 30px"}},[_c("el-checkbox",{attrs:{value:_vm.selectedInstanceIds.length&&_vm.selectedInstanceIds.length===_vm.instances.filter((function(instance){return 2!==instance.subscribeStatus})).length},on:{change:_vm.toggleSelectAll}})],1),_c("th",{staticClass:"setting-table-th setting-th-text ellipsis",staticStyle:{width:"160px"}},[_vm._v(" INSTANCE NAME ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" INSTANCE NUMBER ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" INSTANCE TYPE ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" ADDED TIME ")]),_vm.canSubscribe?_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" SUBSCRIBE STATUS ")]):_vm._e()])]):_c("thead",[_c("tr",[(_vm.selectedTab,_vm.canSubscribe,_c("th",{staticStyle:{width:"5%",padding:"15px 30px"}},[_c("el-checkbox",{attrs:{value:_vm.selectedInstanceIds.length&&_vm.selectedInstanceIds.length===_vm.instances.filter((function(instance){return 2!==instance.subscribeStatus})).length},on:{change:_vm.toggleSelectAll}})],1)),_c("th",{staticClass:"setting-table-th setting-th-text ellipsis",staticStyle:{width:"160px"}},[_vm._v(" INSTANCE ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" CATEGORY ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" ASSET ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" READING ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" INPUT UNIT ")]),_vm.canSubscribe?_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" SUBSCRIBE STATUS ")]):_vm._e()])]),_vm.loading?_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1)])]):_vm.instances.length?"subscribed"===_vm.selectedTab?_c("tbody",_vm._l(_vm.instances,(function(instance){return _c("tr",{directives:[{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"},{name:"show",rawName:"v-show",value:!_vm.quickSearchQueries||instance.instance.toLowerCase().includes(_vm.quickSearchQueries.toLowerCase()),expression:"\n                          !quickSearchQueries ||\n                            instance.instance\n                              .toLowerCase()\n                              .includes(quickSearchQueries.toLowerCase())\n                        "}],key:instance.id,staticClass:"tablerow"},[_c("td",{staticClass:"text-center"},[_c("el-checkbox",{attrs:{disabled:2===instance.subscribeStatus,value:_vm.selectedInstanceIds.indexOf(instance.id)>=0},on:{change:function($event){return _vm.toggleSelection(instance.id)}}})],1),_c("td",[_vm._v(_vm._s(instance.instance))]),_c("td",[_vm._v(_vm._s(instance.objectInstanceNumber))]),_c("td",[_vm._v(_vm._s(_vm._f("pascalCase")(instance.instanceTypeVal)))]),_c("td",[_vm._v(_vm._s(_vm._f("formatDate")(instance.createdTime)))]),_vm.canSubscribe?_c("td",[_vm._v(" "+_vm._s(_vm.$constants.SUBSCRIBE_STATUS[instance.subscribeStatus])+" ")]):_vm._e()])})),0):_c("tbody",[_vm._l(_vm.instances,(function(instance,idx){return _c("tr",{key:idx,staticClass:"tablerow"},[(_vm.selectedTab,_vm.canSubscribe,_c("td",{staticClass:"text-center"},[_c("el-checkbox",{attrs:{disabled:"notmapped"!==_vm.selectedTab&&2===instance.subscribeStatus,value:_vm.selectedInstanceIds.indexOf(instance.id)>=0},on:{change:function($event){return _vm.toggleSelection(instance.id)}}})],1)),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"min-width180px"},[_c("div",{staticClass:"label-txt3-14"},[_vm._v(" "+_vm._s(instance.instance)+" ")]),_c("div",{staticClass:"label-txt3-12"},[_vm._v(" "+_vm._s(instance.device)+" ")])])]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width160px",attrs:{filterable:"",placeholder:"Select Category"},on:{change:function($event){return _vm.onCategoryChanged(instance)}},model:{value:instance.categoryId,callback:function($$v){_vm.$set(instance,"categoryId",$$v)},expression:"instance.categoryId"}},_vm._l(_vm.assetCategories,(function(category,idx){return _c("el-option",{key:idx,attrs:{label:category.name,value:category.id}})})),1)],1)]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width160px",attrs:{placeholder:"Select Asset",filterable:""},on:{change:function($event){return _vm.onAssetChanged(instance)}},model:{value:instance.resourceId,callback:function($$v){_vm.$set(instance,"resourceId",$$v)},expression:"instance.resourceId"}},_vm._l(_vm.assets[instance.categoryId],(function(asset){return _c("el-option",{key:asset.id,attrs:{label:asset.name,value:asset.id}})})),1)],1)]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px flex-middle"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width160px",attrs:{filterable:"",placeholder:"Select Reading"},on:{change:function($event){return _vm.fieldupdate(null,instance,null)}},model:{value:instance.fieldId,callback:function($$v){_vm.$set(instance,"fieldId",$$v)},expression:"instance.fieldId"}},_vm._l(_vm.readingMap[instance.resourceId]||[],(function(reading){return _c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.readingMap[instance.resourceId],expression:"readingMap[instance.resourceId]"}],key:instance.instance+reading.fieldId,attrs:{label:reading.field.displayName,value:reading.fieldId}})})),1),_c("div",{directives:[{name:"show",rawName:"v-show",value:instance.resourceId>0,expression:"instance.resourceId > 0"},{name:"tippy",rawName:"v-tippy"}],staticClass:"actions inline pointer mL10",attrs:{title:"Add Reading"},on:{click:function($event){return _vm.showAddReading(instance.resourceId,instance.categoryId)}}},[_c("i",{staticClass:"el-icon-plus"})]),instance.resourceId>0&&instance.fieldId&&_vm.readingMap[instance.resourceId]&&_vm.readingMap[instance.resourceId][instance.fieldId]&&[4,8].includes(_vm.readingMap[instance.resourceId][instance.fieldId].field.dataType)?_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"actions inline pointer mL10",attrs:{title:"Set Values"},on:{click:function($event){return _vm.showInputReadingDialog(_vm.readingMap[instance.resourceId][instance.fieldId])}}},[_c("i",{staticClass:"el-icon-edit-outline"})]):_vm._e()],1)]),_c("td",{staticClass:"expand-content-th"},[_c("div",{staticClass:"width200px"},[instance.fieldId&&_vm.isMetricAvailable(instance.resourceId,instance.fieldId)?_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"130px"},attrs:{placeholder:instance.defaultUnit,filterable:""},on:{change:function($event){_vm.updateUnit($event,instance.resourceId,instance.fieldId),_vm.fieldupdate($event,instance,null)}},model:{value:_vm.readingMap[instance.resourceId][instance.fieldId].inputUnit,callback:function($$v){_vm.$set(_vm.readingMap[instance.resourceId][instance.fieldId],"inputUnit",$$v)},expression:"\n                                readingMap[instance.resourceId][\n                                  instance.fieldId\n                                ].inputUnit\n                              "}},_vm._l(_vm.metricsUnits.metricWithUnits[_vm.readingMap[instance.resourceId][instance.fieldId].field.metricEnum],(function(unit,index){return _c("el-option",{key:index,attrs:{value:unit.unitId,label:unit.displayName}},[_c("span",{domProps:{innerHTML:_vm._s(unit.displayName+(unit.symbol?" ("+unit.symbol+")":""))}})])})),1):_c("el-select",{model:{value:instance.temp,callback:function($$v){_vm.$set(instance,"temp",$$v)},expression:"instance.temp"}})],1)]),_c("td",{staticClass:"expand-content-th"},["notmapped"!==_vm.selectedTab?_c("div",{staticClass:"width200px"},[_vm._v(" "+_vm._s(_vm.$constants.SUBSCRIBE_STATUS[instance.subscribeStatus]||"Not Subscribed")+" ")]):_vm._e()])])})),_vm.fetchingMore?_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:_vm.fetchingMore,size:"50"}})],1)]):_vm._e()],2):_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center pT20 pB20",attrs:{colspan:"100%"}},[_vm._v(" No instances available ")])])])])])],2)})),1)],1)])])])]),_vm.showAddReadingDialog?_c("new-asset-reading-dialog",{attrs:{visibility:_vm.showAddReadingDialog,hideFormula:"true",categoryId:_vm.selectedCategoryId},on:{"update:visibility":function($event){_vm.showAddReadingDialog=$event},saved:function($event){return _vm.loadReadings(_vm.selectedAssetId,!0)}}}):_vm._e(),_vm.showThresholdDialog?_c("f-dialog",{attrs:{visible:_vm.showThresholdDialog,title:"Set Threshold Values",width:"30%",maxHeight:"500px",customClass:"threshold-value-dialog",confirmTitle:"Subscribe",stayOnSave:!0},on:{"update:visible":function($event){_vm.showThresholdDialog=$event},save:_vm.subscribe}},[_c("div",{staticClass:"pT10 pB10"},[_c("el-row",{staticClass:"pB20 threshold-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v("Name")]),_c("el-col",{attrs:{span:10}},[_vm._v("Threshold (%)")])],1),_vm._l(_vm.selectedInstances.filter((function(inst){return![3,4,5].includes(inst.instanceType)})),(function(instance){return _c("el-row",{key:instance.id,staticClass:"pB20 threshold-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(instance.instance))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",attrs:{type:"number",min:5},model:{value:instance.threshold,callback:function($$v){_vm.$set(instance,"threshold",$$v)},expression:"instance.threshold"}})],1)],1)}))],2)]):_vm._e(),_vm.showInputDialog?_c("f-dialog",{attrs:{visible:_vm.showInputDialog,title:"Set Input Values",width:"30%",maxHeight:"500px",customClass:"input-value-dialog"},on:{"update:visible":function($event){_vm.showInputDialog=$event},save:_vm.setInputValue}},[4===_vm.selectedReading.field.dataType?_c("div",{staticClass:"pT10 pB10"},[_c("el-row",{staticClass:"pB20 input-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(_vm.selectedReading.field.trueVal||"True"))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",model:{value:_vm.inputValues[1],callback:function($$v){_vm.$set(_vm.inputValues,1,$$v)},expression:"inputValues[1]"}})],1)],1),_c("el-row",{staticClass:"pB20 input-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(_vm.selectedReading.field.falseVal||"False"))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",model:{value:_vm.inputValues[0],callback:function($$v){_vm.$set(_vm.inputValues,0,$$v)},expression:"inputValues[0]"}})],1)],1)],1):_c("div",{staticClass:"pT10 pB10"},_vm._l(_vm.selectedReading.field.enumMap,(function(label,idx){return _c("el-row",{key:idx,staticClass:"pB20 input-value-item",attrs:{gutter:10}},[_c("el-col",{attrs:{span:8}},[_vm._v(_vm._s(label))]),_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"el-input-textbox-full-border",model:{value:_vm.inputValues[idx],callback:function($$v){_vm.$set(_vm.inputValues,idx,$$v)},expression:"inputValues[idx]"}})],1)],1)})),1)]):_vm._e()],1)},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"setting-header"},[_c("div",{staticClass:"setting-title-block"},[_c("div",{staticClass:"setting-form-title"},[_vm._v("Commissioning")]),_c("div",{staticClass:"heading-description"},[_vm._v(" List of all the devices that are to be mapped ")])])])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("span",{},[_c("i",{staticClass:"fa fa-search",staticStyle:{"font-size":"14px"},attrs:{"aria-hidden":"true"}})])}],createForOfIteratorHelper=__webpack_require__(566347),NewAssetReadingDialog=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(670560),__webpack_require__(538077),__webpack_require__(450886),__webpack_require__(162506),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(947522),__webpack_require__(188881)),v_infinite_scroll=__webpack_require__(561364),v_infinite_scroll_default=__webpack_require__.n(v_infinite_scroll),FPagination=__webpack_require__(929593),FDialogNew=__webpack_require__(436756),FormMixin=__webpack_require__(674811),ControllerFilter=__webpack_require__(199029),validation=__webpack_require__(990260),CommissioningListvue_type_script_lang_js={mixins:[FormMixin/* default */.Z],title:function(){return"Commissioning"},data:function(){return{updateBulk:{categoryvalue:null,assetvalue:null},points:[],poptab:!1,listCount:null,totalCount:null,selectedController:null,assetReadingFields:[],quickSearchQueries:null,showQuickSearches:!1,controllers:[],selectedInstanceIds:[],selectedInstances:[],loading:!1,instances:[],deviceInstanceMap:{},selectedDevice:null,assets:{},metricsUnits:{},readingMap:{},showAddReadingDialog:!1,selectedTab:"notmapped",showByDevice:!1,subscribing:!1,unsubscribing:!1,selectedAssetId:null,selectedCategoryId:null,tabs:[{key:"notmapped",label:this.$t("setup.controller.notmapped")},{key:"mapped",label:this.$t("setup.controller.mapped")}],canFetchMore:!1,fetchingMore:!1,showInputDialog:!1,selectedReading:null,inputValues:{},quickSearchQuery:null,showThresholdDialog:!1,canSubscribe:!1,defaultUnit:null}},components:{NewAssetReadingDialog:NewAssetReadingDialog/* default */.Z,VInfiniteScroll:v_infinite_scroll_default(),Pagination:FPagination/* default */.Z,FDialog:FDialogNew/* default */.Z,ControllerFilter:ControllerFilter/* default */.Z},created:function(){this.$store.dispatch("loadAssetCategory")},computed:{assetCategories:function(){return this.$store.state.assetCategory},page:function(){return this.$route.query.page||1},perPage:function(){return"mapped"===this.selectedTab?25:50}},mounted:function(){this.loadDefaultMetricUnits()},watch:{page:function(newVal,oldVal){oldVal===newVal||this.loading||(this.loading=!0,this.loadInstances())},selectedTab:function(newVal,oldVal){oldVal!==newVal&&this.loadInstancesCount(!0)}},methods:{cancel:function(){this.selectedInstanceIds=[]},cleardata:function(){this.updateBulk.categoryvalue=null,this.updateBulk.assetvalue=null},fieldupdate:function(unit,instance,info){var _this=this;instance.unit=unit;var point=this.points.find((function(point){return point.instance===instance.instance}));if(point||(point={},this.points.push(point)),null===info){point.device=instance.device,point.instance=instance.instance,point.categoryId=instance.categoryId,point.resourceId=instance.resourceId,point.fieldId=instance.fieldId,point.unit=instance.unit;var _metric=this.metricsUnits.orgUnitsList.filter((function(d){if(_this.readingMap[instance.resourceId][instance.fieldId].field.metricEnum===d.metricEnum._name)return d}));for(var i in this.metricsUnits.metricWithUnits)if(i===_metric[0].metricEnum._name)for(var j in this.metricsUnits.metricWithUnits[i])this.metricsUnits.metricWithUnits[i][j].unitId===_metric[0].unit&&(instance.defaultUnit=this.metricsUnits.metricWithUnits[i][j].symbol)}else{point.device=info.device,point.instance=instance.instance,point.resourceId=info.resourceId,point.categoryId=info.categoryId,point.fieldId=instance.fieldId,point.unit=instance.unit;var _metric2=this.metricsUnits.orgUnitsList.filter((function(d){if(_this.readingMap[info.resourceId][instance.fieldId].field.metricEnum===d.metricEnum._name)return d}));for(var _i in this.metricsUnits.metricWithUnits)if(_i===_metric2[0].metricEnum._name)for(var _j in this.metricsUnits.metricWithUnits[_i])this.metricsUnits.metricWithUnits[_i][_j].unitId===_metric2[0].unit&&(info.instances[0].defaultUnit=this.metricsUnits.metricWithUnits[_i][_j].symbol)}},updateAsset:function(){var _this2=this;if(this.updateBulk.assetvalue=null,this.showByDevice){var _loop2=function(instance){_this2.selectedInstanceIds.find((function(s){return s===_this2.deviceInstanceMap[instance].instances[0].id}))&&(_this2.deviceInstanceMap[instance].categoryId=_this2.updateBulk.categoryvalue,_this2.deviceInstanceMap[instance].categoryId&&_this2.onCategoryChanged(null,_this2.deviceInstanceMap[instance]))};for(var instance in this.deviceInstanceMap)_loop2(instance)}else{var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.instances);try{var _loop=function(){var instance=_step.value;_this2.selectedInstanceIds.find((function(selectedinstance){return selectedinstance===instance.id}))&&(instance.categoryId=_this2.updateBulk.categoryvalue,instance.categoryId&&_this2.onCategoryChanged(instance),_this2.$forceUpdate())};for(_iterator.s();!(_step=_iterator.n()).done;)_loop()}catch(err){_iterator.e(err)}finally{_iterator.f()}}},updateCategoryAndAsset:function(){var _this3=this;if(this.showByDevice){var _loop4=function(instance){_this3.selectedInstanceIds.find((function(s){return s===_this3.deviceInstanceMap[instance].instances[0].id}))&&(_this3.deviceInstanceMap[instance].resourceId=_this3.updateBulk.assetvalue,_this3.deviceInstanceMap[instance].resourceId&&_this3.onAssetChanged(null,_this3.deviceInstanceMap[instance]))};for(var instance in this.deviceInstanceMap)_loop4(instance)}else{var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(this.instances);try{var _loop3=function(){var instance=_step2.value;_this3.selectedInstanceIds.find((function(selectedinstance){return selectedinstance===instance.id}))&&(instance.resourceId=_this3.updateBulk.assetvalue,instance.resourceId&&_this3.onAssetChanged(instance))};for(_iterator2.s();!(_step2=_iterator2.n()).done;)_loop3()}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}this.poptab=!1,this.selectedInstanceIds=[],this.$forceUpdate()},quickSearches:function(){var string=this.quickSearchQueries;string&&(this.listCount=null,this.loadInstances())},toggleQuickSearches:function(){var _this4=this;this.showQuickSearches=!this.showQuickSearches,this.showQuickSearches&&this.$nextTick((function(){_this4.$refs.quickSearchQueries.focus()}))},closeSearches:function(){this.totalCount=null,this.toggleQuickSearches(),this.quickSearchQueries=null,this.listCount=null,this.loadInstances(),this.quickSearches()},toggleSelectAll:function(val){this.selectedInstanceIds=val?this.instances.filter((function(instance){return 2!==instance.subscribeStatus})).map((function(instance){return instance.id})):[]},toggleSelection:function(instance){var idx=this.selectedInstanceIds.indexOf(instance);-1===idx?this.selectedInstanceIds.push(instance):this.selectedInstanceIds.splice(idx,1)},onSubscribeClicked:function(){var _this5=this;this.selectedInstances=this.instances.filter((function(inst){return _this5.selectedInstanceIds.includes(inst.id)}));var booleanInstances=this.selectedInstances.filter((function(inst){return[3,4,5].includes(inst.instanceType)}));booleanInstances.length===this.selectedInstances.length?this.subscribe():this.showThresholdDialog=!0},loadInstancesCount:function(data){var _this6=this;if(!(0,validation/* isEmpty */.xb)(this.selectedController)){var url="/v2/instances/count?controllerId="+this.selectedController.id;"mapped"===this.selectedTab?url+="&configured=true&fetchMapped=true":"subscribed"===this.selectedTab?url+="&subscribed=true&fetchMapped=true":url+="&configured=true&fetchMapped=false";var params,queryObj={search:this.quickSearchQueries,count:!0};params="count="+queryObj.count,queryObj.search&&(params=params+"&search="+queryObj.search),url=url+"&"+params;var self=this;this.$http.get(url).then((function(response){response.data.result.instances&&((_this6.$route.query.page&data||0===response.data.result.instances[0].count)&&_this6.$router.replace({query:{}}),self.listCount=response.data.result.instances[0].count,_this6.totalCount||(_this6.totalCount=self.listCount))}))}},loadInstances:function(loadMore){var _this7=this;if(this.instances=[],this.$common.isBacnetController(this.selectedController)||3===this.selectedController.controllerType){var isSub=this.tabs.filter((function(d){return"subscribed"===d.key}));!isSub.length>0&&this.tabs.push({key:"subscribed",label:"Subscribed"}),this.canSubscribe=this.$helpers.isLicenseEnabled("CONTROL_ACTIONS")}else this.tabs.splice(2,1),this.canSubscribe=!1;this.listCount?this.quickSearchQueries&&this.$refs["f-page"].reset():(this.$refs["f-page"].reset(),this.loadInstancesCount()),this.loading=!0;var url="/v2/instances/"+this.selectedController.id;"mapped"===this.selectedTab?url+="?configured=true&fetchMapped=true":"subscribed"===this.selectedTab?url+="?subscribed=true&fetchMapped=true":url+="?configured=true&fetchMapped=false";var queryObj={page:this.page,search:this.quickSearchQueries},params="";queryObj.search&&(params=params+"&search="+queryObj.search),url+=params,url+="&perPage="+this.perPage+"&page="+this.page,this.$http.get(url).then((function(response){if(0===response.data.responseCode&&(_this7.selectedInstanceIds=[],response.data.result.instances)){var instances=response.data.result.instances.map((function(instance){return instance.resourceId&&instance.categoryId&&
// temp fix for optitima
_this7.loadAssets(instance.categoryId),instance}));if(_this7.instances=instances,_this7.setReadingMap(response.data.result.readings),_this7.setInstancesByDevices(!loadMore,instances),"mapped"===_this7.selectedTab){var _loop5=function(ins){if(_this7.readingMap){var currentInstance=instances[ins],readingFieldInstance=_this7.readingMap[currentInstance.resourceId]?_this7.readingMap[currentInstance.resourceId][currentInstance.fieldId]:null;if(readingFieldInstance&&readingFieldInstance.field.metricEnum&&null!==readingFieldInstance.field.metricEnum)for(var i in metric=_this7.metricsUnits.orgUnitsList.filter((function(d){if(_this7.readingMap[instances[ins].resourceId][instances[ins].fieldId].field.metricEnum===d.metricEnum._name)return d})),_this7.metricsUnits.metricWithUnits)if(i===metric[0].metricEnum._name)for(var j in _this7.metricsUnits.metricWithUnits[i])_this7.metricsUnits.metricWithUnits[i][j].unitId===metric[0].unit&&(_this7.instances[ins].defaultUnit=_this7.metricsUnits.metricWithUnits[i][j].symbol)}};for(var ins in instances)_loop5(ins)}}_this7.loading=!1})).catch((function(_){_this7.loading=!1}))},subscribe:function(){var _this8=this;if(this.validateThreshold()){this.showThresholdDialog=!1,this.subscribing=!0;var instances=this.selectedInstances.map((function(instance){var inst={id:instance.id};return instance.threshold&&(inst.thresholdJson=JSON.stringify({operator:10,threshold:instance.threshold})),inst}));this.$http.post("/v2/instances/subscribe",{instances:instances,controllerId:this.selectedController.id}).then((function(response){_this8.subscribing=!1,0===response.data.responseCode?(_this8.$message.success("Points will be subscribed in a while"),_this8.toggleSelectAll(!1)):_this8.$message.error(response.data.message)})).catch((function(){_this8.subscribing=!1}))}},unsubscribe:function(){var _this9=this;this.$dialog.confirm({title:"Unsubscribe Instance",htmlMessage:"Are you sure you want to unsubscribe selected instance(s)?",rbDanger:!0,rbLabel:"Proceed"}).then((function(value){value&&(_this9.unsubscribing=!0,_this9.$http.post("/v2/instances/unsubscribe",{ids:_this9.selectedInstanceIds,controllerId:_this9.selectedController.id}).then((function(response){_this9.unsubscribing=!1,0===response.data.responseCode?(_this9.$message.success("Points will be unsubscribed in a while"),_this9.instances=_this9.instances.filter((function(instance){return!_this9.selectedInstanceIds.includes(instance.id)})),_this9.toggleSelectAll(!1)):_this9.$message.error(response.data.message)})).catch((function(){_this9.unsubscribing=!1})))}))},validateThreshold:function(){var lessThreshold=this.selectedInstances.some((function(inst){return![3,4,5].includes(inst.instanceType)&&(!inst.threshold||inst.threshold<5)}));return!lessThreshold||(this.$message.error("The difference should be greater than or equal to 5 percentage"),!1)},setInstancesByDevices:function(reInit,instances){var _this10=this;reInit&&(this.deviceInstanceMap={}),instances.forEach((function(instance){var name=instance.device;_this10.deviceInstanceMap[name]?instance.resourceId&&_this10.deviceInstanceMap[name].resourceId&&instance.resourceId!==_this10.deviceInstanceMap[name].resourceId&&(name=instance.device+"_"+instance.resourceId,_this10.deviceInstanceMap[name]||_this10.$set(_this10.deviceInstanceMap,name,{device:instance.device,resourceId:instance.resourceId>0?instance.resourceId:null,categoryId:instance.categoryId>0?instance.categoryId:null,instances:[]})):_this10.$set(_this10.deviceInstanceMap,name,{device:name,resourceId:instance.resourceId>0?instance.resourceId:null,categoryId:instance.categoryId>0?instance.categoryId:null,instances:[]}),_this10.deviceInstanceMap[name].instances.push(instance)}))},onCategoryChanged:function(instance,info){var categoryId,_this11=this;instance?(this.$set(instance,"resourceId",null),this.$set(instance,"fieldId",null),categoryId=instance.categoryId):(categoryId=info.categoryId,this.$set(info,"resourceId",null),info.instances.forEach((function(inst){_this11.$set(inst,"fieldId",null)}))),this.loadAssets(categoryId)},onAssetChanged:function(instance,info){var resourceId,_this12=this;instance?(this.$set(instance,"fieldId",null),resourceId=instance.resourceId):(resourceId=info.resourceId,info.instances.forEach((function(inst){_this12.$set(inst,"fieldId",null)}))),this.loadReadings(resourceId)},loadAssets:function(categoryId){var _this13=this;if(this.assets[categoryId])return this.assets[categoryId];this.$set(this.assets,categoryId,[]),this.$util.loadAsset({categoryId:categoryId}).then((function(response){_this13.$set(_this13.assets,categoryId,response.assets)}))},loadReadings:function(resourceId,fetchNew){var _this14=this;!fetchNew&&this.readingMap[resourceId]||(this.$set(this.readingMap,resourceId,{}),this.$util.loadLatestReading(resourceId,!1,!0).then((function(readings){_this14.setReadingMap(readings)})))},setReadingMap:function(readings){var _this15=this;readings&&readings.forEach((function(reading){_this15.readingMap[reading.resourceId]||_this15.$set(_this15.readingMap,reading.resourceId,{}),reading.unit>0&&(reading.inputUnit=reading.unit),_this15.$set(_this15.readingMap[reading.resourceId],reading.fieldId,reading)}))},mapInstance:function(){var _this16=this;this.loading=!0,this.$http.post("/v2/instances/map",{controllerId:this.selectedController.id,instances:this.points}).then((function(response){0!==response.data.responseCode?(_this16.loading=!1,_this16.$message.error(response.data.message)):(_this16.$message.success("Readings Added Successfully"),_this16.points=[],_this16.loadInstances())}))},loadDefaultMetricUnits:function(){var _this17=this;this.$http.get("/units/getDefaultMetricUnits").then((function(response){_this17.metricsUnits=response.data||{}}))},isMetricAvailable:function(resourceId,fieldId){if(this.readingMap[resourceId]){var reading=this.readingMap[resourceId][fieldId];return reading&&reading.field.metricEnum}},updateUnit:function(unit,resourceId,fieldId){var _this18=this;this.$http.post("/v2/reading/update",{readingDataMeta:{resourceId:resourceId,fieldId:fieldId,unit:unit}}).then((function(response){0!==response.data.responseCode&&_this18.$message.error(response.data.message)}))},showAddReading:function(resourceId,categoryId){this.selectedAssetId=resourceId,this.selectedCategoryId=categoryId,this.showAddReadingDialog=!0},showInputReadingDialog:function(reading){if(this.showInputDialog=!0,this.selectedReading=reading,this.inputValues={},reading.inputValues)this.inputValues=this.$helpers.cloneObject(reading.inputValues);else if(4===reading.field.dataType)this.$set(this.inputValues,[0],"0"),this.$set(this.inputValues,[1],"1");else if(8===reading.field.dataType)for(var idx in reading.field.enumMap)this.$set(this.inputValues,idx,idx+"")},setInputValue:function(){var _this19=this,values=[];for(var idx in this.inputValues)(this.inputValues[idx]||0===this.inputValues[idx])&&values.push({idx:idx,inputValue:this.inputValues[idx]});this.$http.post("/v2/reading/setinputvalue",{readingId:this.selectedReading.id,inputValues:values}).then((function(response){0!==response.data.responseCode?_this19.$message.error(response.data.message):(_this19.$message.success("Values set successfully"),_this19.$set(_this19.selectedReading,"inputValues",_this19.inputValues))}))},loadMore:function(){this.canFetchMore&&this.loadInstances(!0)},onControllerSelected:function(controller){this.selectedController=controller,this.listCount=null,this.totalCount=null,this.loadInstances()}}},commissioning_CommissioningListvue_type_script_lang_js=CommissioningListvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(commissioning_CommissioningListvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,CommissioningList=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/21750.js.map