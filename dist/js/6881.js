"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[6881,39947],{
/***/939947:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return SmartNewMap}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/widget/cards/v2/SmartNewMap.vue?vue&type=template&id=1c902aa0
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"dragabale-card height100"},[_vm.loading?_c("shimmer-loading",{staticClass:"map-shimmer"}):_c("div",{staticClass:"height100"},[_c("div",{staticClass:"map-select-box"}),_vm.result&&_vm.result.length?_c("f-map",{attrs:{markers:_vm.result,data:_vm.data}}):_vm._e()],1)],1)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),DashboardFilters=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(879288),__webpack_require__(450886),__webpack_require__(648324),__webpack_require__(169358),__webpack_require__(506319)),DateHelper=__webpack_require__(281230),colors=__webpack_require__(519898),ShimmerLoading=__webpack_require__(516400),FSmartMapvue_type_template_id_4ca506fd_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"smartmap"},[_vm.mapLoading?_c("div",{staticClass:"mapLoading"},[_c("div",{staticClass:"map-loading-content"},[_vm._v(" Loading... ")])]):_vm._e(),_c("gmap-map",{ref:"mapnew",attrs:{center:_vm.center,zoom:8,options:_vm.mapOptions},on:{click:function($event){return _vm.getMapClickEvent()}}},[_vm.isClicked?_c("gmap-info-window",{attrs:{options:{pixelOffset:{width:-0,height:-40}},position:_vm.currentMarker.location}},[[_c("div",{staticClass:"smartmap-info-window"},[_c("div",{staticClass:"am-header row p15 border-bottom2 pT10 pB10 f12 pB0"},[_c("div",{staticClass:"col-6 text-left bold uppercase"},[_vm._v(" "+_vm._s(_vm.data.module)+" DETAIL ")]),_c("div",{staticClass:"col-6 text-right"},[_c("i",{staticClass:"el-icon-close pointer f13 bold",on:{click:function($event){_vm.isClicked=!1}}})])]),_c("div",{staticClass:"am-info-row row p15"},[_c("div",{staticClass:"am-info-label  col-4"},[_c("div",{staticClass:"height100"},[_vm.currentMarker.avatarUrl?_c("img",{staticClass:"default-img",attrs:{src:_vm.currentMarker.avatarUrl}}):_c("div",{staticClass:"default-img"})])]),_c("div",{staticClass:"am-info-label  col-8 pL10"},[_c("div",{staticClass:"am-id text-left"},[_vm._v("#"+_vm._s(_vm.currentMarker.id))]),_c("div",{staticClass:"am-label am-subject text-left"},[_vm._v(" "+_vm._s(_vm.currentMarker.name)+" ")]),_vm.markerValueMap[_vm.data.markerValue.type]?_c("div",{staticClass:"am-label am-subject text-left"},[_vm._v(" "+_vm._s(_vm.markerValueMap[_vm.data.markerValue.type])),_c("span",{staticClass:"pL5"},[_vm._v(_vm._s(_vm.currentMarker.markerValue))])]):_vm._e(),_c("div",{staticClass:"label-txt-black text-left"},[_vm._v(" "+_vm._s(_vm.currentMarker.category&&_vm.getAssetCategory(_vm.currentMarker.category.id)?_vm.getAssetCategory(_vm.currentMarker.category.id).displayName:"")+" ")])])]),_vm.currentMarker.hasOwnProperty("alarmCount")?[_vm.currentMarker.alarmCount.data&&_vm.currentMarker.alarmCount.data.length?_c("div",{staticClass:"am-info-row row p15 pB0"},[_c("div",{staticClass:"col-12 text-left pB15"},[_vm._v("ALARM DETAIL")]),_vm._l(_vm.currentMarker.alarmCount.data,(function(alarm,index){return[_c("div",{key:index+"1",staticClass:"col-6 am-label am-subject text-left"},[_vm._v(" "+_vm._s(_vm.getAlarmSeverity(alarm.severityId)?_vm.getAlarmSeverity(alarm.severityId).severity:"")+" ")]),_c("div",{key:index+"2",staticClass:"col-6 am-label am-subject text-left"},[_vm._v(" "+_vm._s(alarm.count)+" ")])]}))],2):_vm._e()]:_vm._e(),_c("div",{staticClass:"am-info-row row p15 pT10 pB10"},[_c("div",{staticClass:"col-12"},[_c("div",{staticClass:"mT10"},[_c("el-button",{staticClass:"plain",attrs:{size:"mini"},on:{click:function($event){return _vm.jumpToModule(_vm.data.module,_vm.currentMarker)}}},[_vm._v("View all")])],1)])])],2)]],2):_vm._e(),_vm._l(_vm.markers,(function(d,index){return _c("gmap-marker",{key:index,staticClass:"gmarker",attrs:{position:d.location,clickable:!0,draggable:!1,options:_vm.getOptions(d),icon:_vm.getParentIcon(d)},on:{"update:position":function($event){return _vm.$set(d,"location",$event)},click:function($event){return _vm.openSiteWindow(d)}}})}))],2)],1)},FSmartMapvue_type_template_id_4ca506fd_staticRenderFns=[],objectSpread2=__webpack_require__(595082),createForOfIteratorHelper=__webpack_require__(566347),FMAPMixin=__webpack_require__(964509),JumpToHelper=__webpack_require__(921466),vuex_esm=__webpack_require__(420629),FSmartMapvue_type_script_lang_js={props:["mapheight","markers","categoryId","category","data"],mixins:[FMAPMixin/* default */.Z,JumpToHelper/* default */.Z],data:function(){return{markerValueMap:{noOfWorkorders:"No of Workorders",noOfAlarms:"No of Alarms",reading:"Reading",noOfAssets:"No of Assets"},parentClicked:!1,mapLoading:!1,assetZoom:19,enableCluster:!0,currentMarker:{},currentParentMarker:{},assetAlarmCountData:[],isClicked:!1,ishoverd:!1,center:{lat:25.2048,lng:55.2708},assetsMarkers:[]}},created:function(){this.$store.dispatch("loadAssetCategory")},watch:{markers:function(data){if(data.length>1){var _step,bounds=new window.google.maps.LatLngBounds,_iterator=(0,createForOfIteratorHelper/* default */.Z)(data);try{for(_iterator.s();!(_step=_iterator.n()).done;){var m=_step.value;bounds.extend(m.location)}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.$refs.mapnew.fitBounds(bounds)}}},mounted:function(){if(this.markers.length>1){var self=this;setTimeout((function(){var _step2,bounds=new window.google.maps.LatLngBounds,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(self.markers);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var m=_step2.value;bounds.extend(m.location)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}self.$refs.mapnew.fitBounds(bounds)}),1e3)}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory","getAlarmSeverity"])),{},{mapOptions:function(){var theme=window.localStorage.getItem("theme");return theme&&"black"===theme?{gestureHandling:"cooperative",maxZoom:19,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]}:{gestureHandling:"cooperative",maxZoom:19}}}),methods:{openSiteWindow:function(data){this.isClicked=!0,this.currentMarker=data},fitBounds:function(markers){var self=this;setTimeout((function(){var _step3,bounds=new window.google.maps.LatLngBounds,_iterator3=(0,createForOfIteratorHelper/* default */.Z)(markers);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var m=_step3.value;bounds.extend(m.location)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}self.$refs.mapnew.fitBounds(bounds),self.mapLoading=!1,self.asset=!0}),100)},closeAllInfoWindow:function(){this.isClicked=!1,this.parentClicked=!1},getParentIcon:function(data){if(data)return{url:data.markerUrl,scaledSize:data.marker?{width:50,height:50,f:"20px",b:"px"}:{width:80,height:80,f:"px",b:"px"},origin:(data.marker,{x:0,y:0}),content:""}},getOptions:function(data){if(data)return{pixelOffset:data.marker?{top:-0,bottom:-38}:{width:0,height:0}}}}},components_FSmartMapvue_type_script_lang_js=FSmartMapvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FSmartMapvue_type_script_lang_js,FSmartMapvue_type_template_id_4ca506fd_render,FSmartMapvue_type_template_id_4ca506fd_staticRenderFns,!1,null,null,null)
/* harmony default export */,FSmartMap=component.exports,d3=__webpack_require__(348727),SmartNewMapvue_type_script_lang_js={props:["widget","config"],mixins:[DateHelper/* default */.Z,DashboardFilters/* default */.Z,FMAPMixin/* default */.Z],data:function(){return{backupdata:[],gaugeData:{meta:{baseValue:0,targetValue:0,color:"#1ce6e5,#ecb0c8"},value:{needMax:"usetarget"}},data:{style:{color:"red",bgcolor:"pink"},unitString:""},style:{bgcolor:"#fff",color:"#000"},result:null,domRerender:!0,predefineColors:colors/* default */.Z.readingcardColors,loading:!1}},mounted:function(){this.loadCardData()},components:{shimmerLoading:ShimmerLoading/* default */.Z,FMap:FSmartMap},computed:{mode:function(){return!(!this.$route.query||!this.$route.query.create||"edit"!==this.$route.query.create)||!(!this.$route.query||!this.$route.query.create||"new"!==this.$route.query.create)},getScale:function(){return this.$style.responsiveScale(200,200,1,this.currentWidth,this.currentHeight)},currentWidth:function(){return this.$el&&this.$el.clientWidth?this.$el.clientWidth:200},currentHeight:function(){return this.$el&&this.$el.clientHeight?this.$el.clientHeight:200},getStyle:function(){return"background:"+this.style.bgcolor+";color:"+this.style.color}},watch:{dashboardDateFilter:{handler:function(newData,oldData){newData&&this.refresh()}}},methods:{refresh:function(){this.updateCard()},loadCardData:function(){this.getParams(),this.loadWorkflow()},loadWorkflow:function(){var self=this;this.$util.getWorkFlowResult(107,[this.data]).then((function(response){response.locations&&self.perparedata(response.locations)}))},perparedata:function(data){var self=this;if("asset"===this.data.module){data.forEach((function(rt){var geoLocation=rt.location;rt.location={lat:Number(geoLocation.split(",")[0]),lng:Number(geoLocation.split(",")[1])},rt.count=rt.markerValue}));var assetCountMap=data.map((function(rt){return rt.markerValue})),min=Math.min.apply(Math,(0,toConsumableArray/* default */.Z)(assetCountMap)),max=Math.max.apply(Math,(0,toConsumableArray/* default */.Z)(assetCountMap)),opacityScale=d3.scaleLinear().range([0,.5]).domain([min,max]);data.forEach((function(rt){rt.opacity=opacityScale(rt.count)+.5,rt.markerUrl=self.getMapMarkers(rt,1)})),this.result=this.$helpers.cloneObject(data),this.backupdata=this.$helpers.cloneObject(data)}else{data.forEach((function(rt){rt.count=rt.markerValue}));var _assetCountMap=data.map((function(rt){return rt.markerValue})),_min=Math.min.apply(Math,(0,toConsumableArray/* default */.Z)(_assetCountMap)),_max=Math.max.apply(Math,(0,toConsumableArray/* default */.Z)(_assetCountMap)),_opacityScale=d3.scaleLinear().range([0,.5]).domain([_min,_max]);data.forEach((function(rt){rt.opacity=_opacityScale(rt.count)+.5,rt.markerUrl=self.getMapMarkers(rt,1)})),this.result=this.$helpers.cloneObject(data),this.backupdata=this.$helpers.cloneObject(data)}},updateCard:function(){var self=this,params=null;params={workflow:{expressions:this.widget.dataOptions.data&&this.widget.dataOptions.data.expressions?this.widget.dataOptions.data.expressions:[],workflowUIMode:1},staticKey:"kpiCard"},this.loading=!0,self.getParams(),self.$http.post("dashboard/getCardData",params).then((function(response){self.getData(response.data.cardResult),self.loading=!1})).catch((function(error){self.loading=!1}))},setColor:function(mode,color){"bg"===mode?this.style.bgcolor=color:"color"===mode&&(this.style.color=color),this.domRerender=!1,this.domRerender=!0,this.setParams()},getParams:function(){this.widget.dataOptions.data?(this.widget.dataOptions.metaJson=JSON.stringify(this.widget.dataOptions.data),this.data=this.widget.dataOptions.data):this.widget.id>-1&&this.widget.dataOptions.metaJson&&(this.data=JSON.parse(this.widget.dataOptions.metaJson)),this.widget.hasOwnProperty("widgetVsWorkflowContexts")&&this.widget.widgetVsWorkflowContexts.length&&this.widget.widgetVsWorkflowContexts[0].workflow&&(this.data["v2Script"]=this.widget.widgetVsWorkflowContexts[0].workflow["v2Script"],this.data["workflowV2String"]=this.widget.widgetVsWorkflowContexts[0].workflow["workflowV2String"]),this.setParams()},setParams:function(){this.data&&!this.data.style?this.data.style={color:this.color,bgcolor:this.bgcolor}:this.style=this.data.style,this.widget.dataOptions.metaJson=JSON.stringify(this.data)},getData:function(data){data.hasOwnProperty("result")?(this.result=data,this.gaugeData=this.resultToGaugeData(data)):this.gaugeData={}},formatData:function(result){return result&&result.result?result.result.value?Number(result.result.value):Number(result.result):result},getUnit:function(result){return result&&result.result&&result.result.unit?result.result.unit:""},resultToGaugeData:function(data){if(data)return{meta:{baseValue:this.formatData(data),targetValue:this.data.targetConstant||0,color:"#1ce6e5,#ecb0c8",fieldObj:this.data.fieldObj||{unit:this.getUnit(data)}},value:{needMax:"usetarget"}};this.gaugeData}}},v2_SmartNewMapvue_type_script_lang_js=SmartNewMapvue_type_script_lang_js,SmartNewMap_component=(0,componentNormalizer/* default */.Z)(v2_SmartNewMapvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SmartNewMap=SmartNewMap_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/6881.js.map