"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[20861],{
/***/39381:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ReadingKpiTemplates}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/kpi/ReadingKpiTemplates.vue?vue&type=template&id=430bb50a&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("CommonListLayout",{attrs:{moduleName:"formulaField",getPageTitle:function(){return"Reading KPI List"}},scopedSlots:_vm._u([{key:"views",fn:function(){return[_c("KpiViews")]},proxy:!0},{key:"header",fn:function(){return[!_vm.showSearch&&_vm.totalCount>0?[_c("pagination",{staticClass:"pL15 fc-black-small-txt-12",attrs:{total:_vm.totalCount,perPage:50}}),_c("span",{staticClass:"separator"},[_vm._v("|")])]:_vm._e(),_vm.isFilterOptionsLoading?_vm._e():_c("search",{attrs:{config:_vm.filterConfig,moduleName:_vm.filterConfig.moduleName,defaultFilter:"name",includeAllMetaFields:!1}}),_vm.showSearch?_vm._e():[_c("span",{staticClass:"separator"},[_vm._v("|")]),_c("div",{staticClass:"pL10"},[_c("button",{staticClass:"fc-create-btn outline-none",staticStyle:{"margin-top":"-10px"},on:{click:function($event){return _vm.createKpi()}}},[_vm._v(" "+_vm._s(_vm.$t("common.products.new_kpi"))+" ")])])]]},proxy:!0}])},[_c("div",{staticClass:"fc-list-view p10 pT0 mT10 fc-list-table-container height100vh fc-table-td-height fc-table-viewchooser pB100"},[_c("div",[_c("tags",{attrs:{disableSaveFilters:!0}})],1),_vm.loading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm.$validation.isEmpty(_vm.kpiList)?_c("div",{staticClass:"width100 text-center empty-container pB30 pT30"},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/emptystate/kpi",iconClass:"icon icon-256"}}),_c("div",{staticClass:"f18 bold",staticStyle:{"margin-bottom":"7px"}},[_vm._v(" "+_vm._s(_vm.$t("common.products.no_kpis_found"))+" ")]),_c("div",{staticClass:"f12 grey-text2"},[_vm._v(" "+_vm._s(_vm.$t("common.header.you_dont_seem_to_have_kpis_created_view"))+" ")])],1):_c("el-table",{key:"KPIlist",staticClass:"kpi-list fc-list-eltable",staticStyle:{width:"100%"},attrs:{data:_vm.kpiList,height:"auto","row-class-name":"tablerow-edit-delete-icon"}},[_c("el-table-column",{attrs:{label:_vm.$t("common.products._name")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("div",{staticClass:"q-item-label",staticStyle:{"margin-top":"1px","letter-spacing":"0.3px"},on:{click:function($event){return _vm.opensummary(kpi.row.id)}}},[_vm._v(" "+_vm._s(kpi.row.name)+" ")])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common.category")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("span",[_vm._v(_vm._s(_vm.getKpiCategoryById(kpi.row.kpiCategory)?_vm.getKpiCategoryById(kpi.row.kpiCategory).name:"---"))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common._space_asset")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(_vm.getResourceName(scope.row)?_vm.getResourceName(scope.row):""))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common.frequency")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(scope.row.frequency?_vm.frequencyTypes[scope.row.frequency]:"---"))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common.products.status")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("el-switch",{attrs:{"active-color":"rgba(57, 178, 194, 0.8)","inactive-color":"#e5e5e5"},on:{change:function($event){return _vm.toggleStatus(kpi.row)}},model:{value:kpi.row.active,callback:function($$v){_vm.$set(kpi.row,"active",$$v)},expression:"kpi.row.active"}})]}}])}),_c("el-table-column",{attrs:{width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("div",{staticClass:"d-flex justify-content-center"},[_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"hover-actions-view outline-none",attrs:{title:_vm.$t("common._common.edit")},on:{click:function($event){return _vm.editKpi(kpi.row)}}},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/edit",iconClass:"icon icon-sm mR25 icon-edit"}})],1),_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"hover-actions-view",attrs:{title:_vm.$t("common._common.delete")},on:{click:function($event){return _vm.openDeleteDialog(kpi.row.id)}}},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/delete",iconClass:"icon icon-sm icon-remove"}})],1)])]}}])})],1)],1),_vm.showCreationForm?_c("new-kpi",{attrs:{isNew:_vm.isNew,kpi:_vm.selectedKPI},on:{onSave:function($event){return _vm.loadData()},onClose:function($event){_vm.showCreationForm=!1}}}):_vm._e(),_c("el-dialog",{staticClass:"fieldchange-Dialog pB15 fc-dialog-center-container kpi-list",attrs:{visible:_vm.canShowDialog,width:"30%",title:"Warning","custom-class":"dialog-header-padding","append-to-body":!0,"show-close":!1,"before-close":function(){return _vm.canShowDialog=!1}}},[_c("div",{staticClass:"pB40 pT10 break-word height180",domProps:{innerHTML:_vm._s(_vm.$t("kpi.kpi.warning_message"))}}),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){_vm.canShowDialog=!1}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save delete-dialog",attrs:{type:"primary"},on:{click:function($event){return _vm.removeKpi("/v2/kpi/delete")}}},[_vm._v(_vm._s(_vm.$t("common._common.delete")))])],1)])],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),validation=(__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(169358),__webpack_require__(648324),__webpack_require__(634338),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(425728),__webpack_require__(339772),__webpack_require__(990260)),vuex_esm=__webpack_require__(420629),FPagination=__webpack_require__(929593),DeprecatedCommonLayout=__webpack_require__(714218),Search=__webpack_require__(718452),Tags=__webpack_require__(482912),AddKpi=__webpack_require__(169251),kpiViews=__webpack_require__(294438),picklist=__webpack_require__(961358),api=__webpack_require__(32284),router=__webpack_require__(329435),ReadingKpiTemplatesvue_type_script_lang_js={name:"KPIList",components:{Pagination:FPagination/* default */.Z,CommonListLayout:DeprecatedCommonLayout/* default */.Z,Search:Search/* default */.Z,Tags:Tags/* default */.Z,NewKpi:AddKpi/* default */.Z,KpiViews:kpiViews/* default */.Z},data:function(){return{kpiList:[],perPage:50,loading:!0,isNew:!1,selectedKPI:null,totalCount:null,showCreationForm:!1,isFilterOptionsLoading:!0,kpiIdToDelete:null,canShowDialog:!1,filterConfig:{moduleName:"formulaField",path:"/app/em/kpi/",includeParentCriteria:!0,excludeModuleStateField:!0,data:{name:{label:this.$t("common.products.name"),displayType:"string",value:""},kpiCategory:{label:this.$t("common._common.category"),displayType:"select",options:{},value:null},siteId:{label:this.$t("common.products.site"),options:{},value:null,displayType:"select",key:"siteId"},assetCategoryId:{label:this.$t("common._common.asset_category"),displayType:"select",options:{},value:null}},availableColumns:["name","kpiCategory","siteId","assetCategoryId"],fixedCols:["name"],saveView:!1}}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.$store.dispatch("loadKpiCategories");case 2:return _context.next=4,_this.init();case 4:return _context.next=6,_this.loadFilterOptions();case 6:case"end":return _context.stop()}}),_callee)})))()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({showSearch:function(state){return state.search.active}})),(0,vuex_esm/* mapGetters */.Se)({getKpiCategoryById:"getKpiCategoryById"})),{},{assetCategoryList:function(){return this.$store.state.assetCategory},frequencyTypes:function(){var types=this.$helpers.cloneObject(this.$constants.FACILIO_FREQUENCY);return types["8"]="Hourly",types},page:function(){return this.$route.query.page||1},filters:function(){var $route=this.$route,_ref=$route||{},search=_ref.query.search;return(0,validation/* isEmpty */.xb)(search)?null:JSON.parse(this.$route.query.search)}}),watch:{filters:{handler:function(newVal,oldVal){newVal!==oldVal&&this.init()}},page:function(){this.init()}},methods:{init:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this2.loading=!0,_context2.next=3,_this2.loadData();case 3:return _context2.next=5,_this2.loadKPICount();case 5:_this2.loading=!1;case 6:case"end":return _context2.stop()}}),_callee2)})))()},loadData:function(){var parsedFilters,_this3=this,url="/v2/kpi/list?type=1&page=".concat(this.page,"&perPage=50&"),filters=this.filters,filterObj=(0,objectSpread2/* default */.Z)({},filters),resource=filterObj.resource,params={};return(0,validation/* isEmpty */.xb)(filterObj)||(filterObj.resource&&delete filterObj.resource,parsedFilters=encodeURIComponent(JSON.stringify(filterObj))),(0,validation/* isEmpty */.xb)(parsedFilters)||(url="".concat(url,"filters=").concat(parsedFilters,"&")),(0,validation/* isEmpty */.xb)(resource)||(params.resource=resource[0].value),url=Object.keys(params).reduce((function(res,key){return res+=key+"="+params[key]+"&",res}),url),this.$http.get(url).then((function(_ref2){var data=_ref2.data;0===data.responseCode&&(_this3.kpiList=data.result.formulaList)}))},loadKPICount:function(){var _this4=this,url="/v2/kpi/count?type=1&fetchCount=true";return(0,validation/* isEmpty */.xb)(this.page)||(url+="&page=".concat(this.page,"&perPage=").concat(this.perPage)),this.$http.get(url).then((function(_ref3){var data=_ref3.data;0===data.responseCode&&(_this4.totalCount=data.result.count)})).catch((function(){_this4.totalCount=null}))},loadFilterOptions:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$getFieldOption,error,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this5.isFilterOptionsLoading=!0,_context3.next=3,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:"kpiCategory",skipDeserialize:!0}});case 3:_yield$getFieldOption=_context3.sent,error=_yield$getFieldOption.error,options=_yield$getFieldOption.options,error?_this5.$message.error(error.message||"Error Occured"):(_this5.$set(_this5.filterConfig.data,"kpiCategory",(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},_this5.filterConfig.data.kpiCategory),{},{options:options})),_this5.isFilterOptionsLoading=!1);case 7:case"end":return _context3.stop()}}),_callee3)})))()},onClick:function(row,col){col.label&&(this.selectedKPI=row,this.opensummary(row.id))},opensummary:function(id){if((0,router/* isWebTabsEnabled */.tj)()){var _ref4=(0,router/* findRouteForTab */.OD)(router/* pageTypes */.As.READING_KPI_SUMMARY)||{},name=_ref4.name;this.$router.push({name:name,params:{id:id},query:this.$route.query})}else this.$router.push({path:"/app/em/kpi/reading/templates/"+id+"/overview",query:this.$route.query})},getResourceName:function(KPI){if(!(0,validation/* isEmpty */.xb)(KPI.matchedResourcesIds)){if(KPI.assetCategoryId>0){var message,selectedCount,categoryName=this.getCategoryName(KPI.assetCategoryId);if(KPI.includedResources&&KPI.includedResources.length&&(selectedCount=KPI.includedResources.length),selectedCount){if(1===selectedCount)return KPI.matchedResources[0].name;message=selectedCount+" "+categoryName+"s"}else message="All "+categoryName+"s";return message}var firstResource=KPI.matchedResources[Object.keys(KPI.matchedResources)[0]];return 1===KPI.matchedResources.length?firstResource.name:1===firstResource.resourceType?"Some Spaces":"Some Assets"}return"---"},getCategoryName:function(categoryId){if(categoryId>0&&this.assetCategoryList){var category=this.assetCategoryList.find((function(category){return category.id===categoryId}));if(category)return category.name}},createKpi:function(){this.isNew=!0,this.selectedKPI=null,this.showCreationForm=!0},editKpi:function(kpi){-1===kpi.siteId&&(kpi.siteId=null),this.isNew=!1,this.selectedKPI=kpi,this.showCreationForm=!0},openDeleteDialog:function(kpiId){this.kpiIdToDelete=kpiId,this.canShowDialog=!0},removeKpi:function(url){var _this6=this;this.$http.post(url,{id:this.kpiIdToDelete}).then((function(_ref5){var data=_ref5.data;0===data.responseCode?(_this6.$message.success(_this6.$t("common.header.kpi_deleted_successfully")),_this6.loadData()):_this6.$message.error(_this6.$t("common.header.kpi_could_not_be_deleted"))})).finally((function(){_this6.kpiIdToDelete=null,_this6.canShowDialog=!1}))},toggleStatus:function(kpiObj){var _this7=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var _ref6,active,id,_yield$API$post,error,index;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _ref6=kpiObj||{},active=_ref6.active,id=_ref6.id,_context4.next=3,api/* API */.bl.post("v2/kpi/status",{status:active,ruleId:id});case 3:_yield$API$post=_context4.sent,error=_yield$API$post.error,error?(_this7.$message.error(error.message||"Status Update Failed"),index=_this7.kpiList.findIndex((function(kpi){return id===kpi.id})),-1!==index&&_this7.$set(_this7.kpiList,index,(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},kpiObj),{},{active:!active}))):_this7.$message.success("Status Updated Successfully");case 6:case"end":return _context4.stop()}}),_callee4)})))()}}},kpi_ReadingKpiTemplatesvue_type_script_lang_js=ReadingKpiTemplatesvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(kpi_ReadingKpiTemplatesvue_type_script_lang_js,render,staticRenderFns,!1,null,"430bb50a",null)
/* harmony default export */,ReadingKpiTemplates=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/20861.js.map