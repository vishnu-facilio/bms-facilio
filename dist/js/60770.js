"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[60770],{
/***/720096:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PreviewFile}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/PreviewFile.vue?vue&type=template&id=447c7e89
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.currentFile?_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.show,expression:"show"}],staticClass:"preview-file"},[_c("div",{staticClass:"top-toolbar"},[_c("div",{staticClass:"a-top-toolbar"},[_c("div",{staticClass:"file-name word-break-keep"},[_vm._v(" "+_vm._s(_vm.currentFile.fileName)+" ")]),_c("div",{staticClass:"top-toolbar-icon-right flex align-center"},[_vm.currentFile.contentType.includes("image")?[_c("div",{staticClass:"flex-middle pL15"},[_vm.showOriginalImage?_c("div",{staticClass:"fc-white-14 word-break-keep pointer",on:{click:_vm.showOriginalPhoto}},[_vm._v(" "+_vm._s(_vm.$t("common._common.view_original"))+" ")]):_vm._e(),_vm.showCompressedImage?_c("div",{staticClass:"fc-white-14 word-break-keep pointer",on:{click:_vm.showCompressedPhoto}},[_vm._v(" "+_vm._s(_vm.$t("common._common.view_default"))+" ")]):_vm._e()]),_c("div",{staticClass:"download-icon round flex-middle pL15",on:{click:function($event){return _vm.downloadAttachment(_vm.currentFile)}}},[_c("i",{staticClass:"el-icon-download op8",staticStyle:{color:"#ffff"}})])]:_vm._e(),_vm.currentFile.contentType.includes("pdf")?[_c("div",{staticClass:"download-icon round flex-middle pL15",on:{click:function($event){return _vm.downloadAttachment(_vm.currentFile)}}},[_c("i",{staticClass:"el-icon-download op8",staticStyle:{color:"#ffff"}})])]:_vm._e(),_vm.showDeleteOption()?_c("div",{staticClass:"flex-middle pL15",on:{click:function($event){return _vm.deletePreview()}}},[_c("inline-svg",{staticClass:"pointer edit-icon-color close vertical-text-top",attrs:{src:"svgs/delete",iconClass:"icon icon-md"}})],1):_vm._e(),_c("div",{staticClass:"pL15"},[_c("i",{staticClass:"el-icon-close close",on:{click:_vm.closePreview}})])],2)])]),_vm.currentFileIndex>0?_c("a",{staticClass:"el-icon-arrow-left prev",staticStyle:{"font-size":"30px"},on:{click:function($event){return _vm.plusSlides(-1)}}}):_vm._e(),_vm.currentFileIndex<_vm.files.length-1?_c("a",{staticClass:"el-icon-arrow-right next",staticStyle:{"font-size":"30px"},on:{click:function($event){return _vm.plusSlides(1)}}}):_vm._e(),_c("div",{staticClass:"preview-content"},[_vm.currentFile.contentType.includes("image")?[_vm.compressedImage?_c("img",{staticClass:"content",staticStyle:{"box-shadow":"none"},attrs:{src:_vm.$prependBaseUrl(_vm.currentFile.previewUrl)}}):_vm.originalImage?_c("img",{staticClass:"content original",staticStyle:{"box-shadow":"none"},attrs:{src:_vm.$prependBaseUrl(_vm.currentFile.previewUrl+"?fetchOriginal=true")}}):_vm._e()]:_vm.currentFile.contentType.includes("pdf")?_c("div",{staticClass:"width100 height-100"},[_c("iframe",{staticClass:"fc-preview-pdf",attrs:{src:_vm.$prependBaseUrl(_vm.currentFile.previewUrl),height:"100%",width:"100%"}})]):_vm.isVideoSupported(_vm.currentFile.contentType)?_c("div",{staticClass:"width100 height-100 fc-preview-video"},[_c("video",{attrs:{controls:""}},[_c("source",{attrs:{src:_vm.$prependBaseUrl(_vm.$getProperty(_vm.currentFile,"downloadUrl",null)),type:_vm.$getProperty(_vm.currentFile,"contentType")}}),_vm._v(" "+_vm._s(_vm.$t("common._common.browser_not_supported"))+" ")])]):_c("div",{staticClass:"no-preview"},[_c("div",{staticClass:"flex justify-center pT24"},[_c("inline-svg",{staticClass:"d-flex",attrs:{src:_vm.getFileIcon(_vm.currentFile),iconClass:"icon icon-60 overlay"}})],1),_c("div",{staticClass:"f14 pT12 pB12"},[_vm._v("No preview available")]),_c("div",{staticClass:"download-button"},[_c("a",{staticClass:"flex flex-row",staticStyle:{color:"#ffff"},on:{click:function($event){return _vm.downloadAttachment(_vm.currentFile)}}},[_c("div",[_vm._v("Download")])])])])],2),_vm.exportDownloadUrl?_c("iframe",{staticStyle:{display:"none"},attrs:{src:_vm.exportDownloadUrl}}):_vm._e()]):_vm._e()},staticRenderFns=[],validation=(__webpack_require__(339772),__webpack_require__(260228),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(228436),__webpack_require__(990260)),PreviewFilevue_type_script_lang_js={props:["previewFile","files","visibility","showDelete","isLockedState","isTaskClosed"],data:function(){return{show:!0,previewUrl:null,currentFileIndex:0,currentFile:null,imageMargin:null,exportDownloadUrl:null,originalImage:!1,compressedImage:!0,showOriginalImage:!0,showCompressedImage:!1}},destroyed:function(){window.removeEventListener("keyup",this.handler)},mounted:function(){window.addEventListener("keyup",this.handler),this.preloadImages()},watch:{},computed:{},methods:{handler:function(){
// If escape key is pressed...
27===event.keyCode?this.closePreview():37===event.keyCode?this.plusSlides(-1):39===event.keyCode&&this.plusSlides(1)},preloadImages:function(){this.currentFile=this.previewFile?this.previewFile:this.files[0],this.currentFileIndex=this.files.indexOf(this.currentFile)},plusSlides:function(n){var index=this.currentFileIndex+n;index<0&&(index=0),index>=this.files.length&&(index=this.files.length-1),this.currentFileIndex=index,this.currentFile=this.files[index]},closePreview:function(){this.$emit("update:visibility",!1)},deletePreview:function(){var currentFile=this.currentFile;this.$emit("onDelete",currentFile)},downloadAttachment:function(file){var _this=this,_ref=file||{},url=_ref.downloadUrl;this.exportDownloadUrl&&(this.exportDownloadUrl=null),this.$nextTick((function(){_this.exportDownloadUrl=url}))},showOriginalPhoto:function(){this.originalImage=!0,this.showCompressedImage=!0,this.showOriginalImage=!1,this.compressedImage=!1},showCompressedPhoto:function(){this.showCompressedImage=!1,this.originalImage=!1,this.showOriginalImage=!0,this.compressedImage=!0},getFileIcon:function(attachment){var contentType=attachment.contentType,FILE_TYPE_ICONS=this.$constants.FILE_TYPE_ICONS,selectedIndex=FILE_TYPE_ICONS.findIndex((function(icons){var fileTypes=icons.fileTypes;return fileTypes.some((function(type){return contentType.includes(type)}))}));return(0,validation/* isEmpty */.xb)(selectedIndex)?FILE_TYPE_ICONS[0].path:FILE_TYPE_ICONS[selectedIndex].path},isVideoSupported:function(contentType){contentType=contentType||"";var supportedTypes=["video/webm","video/mp4","video/ogg"];return supportedTypes.includes(contentType.trim().toLowerCase())},showDeleteOption:function(){var showDelete=this.showDelete,isLockedState=this.isLockedState,isTaskClosed=this.isTaskClosed;return showDelete&&!isLockedState&&!isTaskClosed}}},components_PreviewFilevue_type_script_lang_js=PreviewFilevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_PreviewFilevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PreviewFile=component.exports},
/***/760770:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return AttachmentPreview}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/community/components/AttachmentPreview.vue?vue&type=template&id=b23b7be4&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pL30 pR30 d-flex flex-direction-column"},[_vm._m(0),_c("div",{ref:"attachment-container",class:["d-flex mT10 mB30",_vm.$validation.isEmpty(_vm.attachments)&&"justify-content-center"]},[_vm.loading?[_c("div",{staticClass:"text-center"},[_c("spinner",{attrs:{show:_vm.loading}})],1)]:_vm.$validation.isEmpty(_vm.attachments)?[_c("div",{staticClass:"d-flex flex-direction-column justify-content-container mB20",staticStyle:{"max-height":"80px"}},[_c("inline-svg",{staticClass:"vertical-middle self-center",attrs:{src:"svgs/community-empty-state/attachments",iconClass:"icon empty-notes mR5"}}),_c("div",{staticClass:"empty-notes-desc f13 pL10 self-center"},[_vm._v(" "+_vm._s(_vm.$t("common._common.no_attachments"))+" ")])],1)]:[_vm._l(_vm.previewAttachments,(function(attachment,index){return[attachment.contentType.includes("image")?[_c("div",{key:_vm.details.id+index+attachment.id,staticClass:"fc-avatar-square image-preview cursor-pointer",style:_vm.getOverlayStyle(attachment),on:{click:function($event){return _vm.openAttachmentsPreview(!0,attachment)}}},[_vm.canShowOverlay(index)?_c("div",{staticClass:"image-overlay"},[_c("span",{staticClass:"overlay-count f24"},[_vm._v("+"+_vm._s(_vm.hiddenAttachmentCount))])]):_vm._e()])]:[_c("div",{key:_vm.details.id+index+attachment.id,staticClass:"position-relative cursor-pointer",on:{click:function($event){return _vm.openAttachmentsPreview(!0,attachment)}}},[_vm.canShowOverlay(index)?_c("div",{staticClass:"overlay-count f24"},[_vm._v(" +"+_vm._s(_vm.hiddenAttachmentCount)+" ")]):_vm._e(),_c("div",{class:["file-icon flex flex-row",_vm.canShowOverlay(index)&&"svg-overlay"]},[_c("InlineSvg",{staticClass:"d-flex ",attrs:{src:_vm.getFileIcon(attachment),iconClass:"icon icon-40"}})],1)])]]}))]],2),_vm.visibility?_c("preview-file",{attrs:{visibility:_vm.visibility,previewFile:_vm.previewFile,files:_vm.attachments},on:{"update:visibility":function($event){_vm.visibility=$event}}}):_vm._e()],1)},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"widget-topbar"},[_c("div",{staticClass:"widget-title mL0"},[_vm._v("Attachments")])])}],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),PreviewFile=(__webpack_require__(689730),__webpack_require__(339772),__webpack_require__(260228),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(720096)),api=__webpack_require__(32284),validation=__webpack_require__(990260),AttachmentPreviewvue_type_script_lang_js={name:"AttachmentPreview",props:["moduleName","details","attachmentsModuleName"],components:{PreviewFile:PreviewFile/* default */.Z},data:function(){return{loading:!1,attachments:[],visibility:!1,previewFile:null,maxCount:4}},created:function(){this.loadAttachments()},computed:{previewAttachments:function(){var attachments=this.attachments,maxCount=this.maxCount;return attachments.slice(0,maxCount+1)},hiddenAttachmentCount:function(){var _this$attachments=this.attachments,_this$attachments2=void 0===_this$attachments?{}:_this$attachments,length=_this$attachments2.length,maxCount=this.maxCount;return Math.abs(length-maxCount)}},methods:{loadAttachments:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$get,error,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.loading=!0,_context.next=3,api/* API */.bl.get("/attachment",{module:_this.attachmentsModuleName,recordId:_this.details.parentId?_this.details.parentId:_this.details.id});case 3:_yield$API$get=_context.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?(_this.loading=!1,_this.attachments=[]):_this.attachments=data.attachments?data.attachments:[],_this.loading=!1;case 8:case"end":return _context.stop()}}),_callee)})))()},openAttachmentsPreview:function(fileAttached,image){var attachments=this.attachments;attachments.length>0&&(this.visibility=!0,this.previewFile=fileAttached?image:attachments[0])},getFileIcon:function(attachment){var contentType=attachment.contentType,FILE_TYPE_ICONS=this.$constants.FILE_TYPE_ICONS,selectedIndex=FILE_TYPE_ICONS.findIndex((function(icons){var fileTypes=icons.fileTypes;return fileTypes.some((function(type){return contentType.includes(type)}))}));return(0,validation/* isEmpty */.xb)(selectedIndex)?FILE_TYPE_ICONS[0].path:FILE_TYPE_ICONS[selectedIndex].path},getOverlayStyle:function(attachment){var url=this.$prependBaseUrl(attachment.previewUrl);return"background-image: url(".concat(url,")")},canShowOverlay:function(index){var maxCount=this.maxCount,hiddenAttachmentCount=this.hiddenAttachmentCount;return index===maxCount&&hiddenAttachmentCount>1}}},components_AttachmentPreviewvue_type_script_lang_js=AttachmentPreviewvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_AttachmentPreviewvue_type_script_lang_js,render,staticRenderFns,!1,null,"b23b7be4",null)
/* harmony default export */,AttachmentPreview=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/60770.js.map