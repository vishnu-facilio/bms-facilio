"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[37820],{
/***/607842:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return upload_2}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./node_modules/vue-image-crop-upload/upload-2.vue?vue&type=template&id=258c767c
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.value,expression:"value"}],staticClass:"vue-image-crop-upload"},[_c("div",{staticClass:"vicp-wrap"},[_c("div",{staticClass:"vicp-close",on:{click:_vm.off}},[_c("i",{staticClass:"vicp-icon4"})]),_c("div",{directives:[{name:"show",rawName:"v-show",value:1==_vm.step,expression:"step == 1"}],staticClass:"vicp-step1"},[_c("div",{staticClass:"vicp-drop-area",on:{dragleave:_vm.preventDefault,dragover:_vm.preventDefault,dragenter:_vm.preventDefault,click:_vm.handleClick,drop:_vm.handleChange}},[_c("i",{directives:[{name:"show",rawName:"v-show",value:1!=_vm.loading,expression:"loading != 1"}],staticClass:"vicp-icon1"},[_c("i",{staticClass:"vicp-icon1-arrow"}),_c("i",{staticClass:"vicp-icon1-body"}),_c("i",{staticClass:"vicp-icon1-bottom"})]),_c("span",{directives:[{name:"show",rawName:"v-show",value:1!==_vm.loading,expression:"loading !== 1"}],staticClass:"vicp-hint"},[_vm._v(_vm._s(_vm.lang.hint))]),_c("span",{directives:[{name:"show",rawName:"v-show",value:!_vm.isSupported,expression:"!isSupported"}],staticClass:"vicp-no-supported-hint"},[_vm._v(_vm._s(_vm.lang.noSupported))]),1==_vm.step?_c("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileinput",attrs:{type:"file"},on:{change:_vm.handleChange}}):_vm._e()]),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.hasError,expression:"hasError"}],staticClass:"vicp-error"},[_c("i",{staticClass:"vicp-icon2"}),_vm._v(" "+_vm._s(_vm.errorMsg)+" ")]),_c("div",{staticClass:"vicp-operate"},[_c("a",{on:{click:_vm.off,mousedown:_vm.ripple}},[_vm._v(_vm._s(_vm.lang.btn.off))])])]),2==_vm.step?_c("div",{staticClass:"vicp-step2"},[_c("div",{staticClass:"vicp-crop"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticClass:"vicp-crop-left"},[_c("div",{staticClass:"vicp-img-container"},[_c("img",{ref:"img",staticClass:"vicp-img",style:_vm.sourceImgStyle,attrs:{src:_vm.sourceImgUrl,draggable:"false"},on:{drag:_vm.preventDefault,dragstart:_vm.preventDefault,dragend:_vm.preventDefault,dragleave:_vm.preventDefault,dragover:_vm.preventDefault,dragenter:_vm.preventDefault,drop:_vm.preventDefault,touchstart:_vm.imgStartMove,touchmove:_vm.imgMove,touchend:_vm.createImg,touchcancel:_vm.createImg,mousedown:_vm.imgStartMove,mousemove:_vm.imgMove,mouseup:_vm.createImg,mouseout:_vm.createImg}}),_c("div",{staticClass:"vicp-img-shade vicp-img-shade-1",style:_vm.sourceImgShadeStyle}),_c("div",{staticClass:"vicp-img-shade vicp-img-shade-2",style:_vm.sourceImgShadeStyle})]),_c("div",{staticClass:"vicp-range"},[_c("input",{attrs:{type:"range",step:"1",min:"0",max:"100"},domProps:{value:_vm.scale.range},on:{mousemove:_vm.zoomChange}}),_c("i",{staticClass:"vicp-icon5",on:{mousedown:_vm.startZoomSub,mouseout:_vm.endZoomSub,mouseup:_vm.endZoomSub}}),_c("i",{staticClass:"vicp-icon6",on:{mousedown:_vm.startZoomAdd,mouseout:_vm.endZoomAdd,mouseup:_vm.endZoomAdd}})]),_vm.noRotate?_vm._e():_c("div",{staticClass:"vicp-rotate"},[_c("i",{on:{click:_vm.rotateImg}},[_vm._v("↻")])])]),_c("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticClass:"vicp-crop-right"},[_c("div",{staticClass:"vicp-preview"},[_vm.noSquare?_vm._e():_c("div",{staticClass:"vicp-preview-item"},[_c("img",{style:_vm.previewStyle,attrs:{src:_vm.createImgUrl}}),_c("span",[_vm._v(_vm._s(_vm.lang.preview))])]),_vm.noCircle?_vm._e():_c("div",{staticClass:"vicp-preview-item vicp-preview-item-circle"},[_c("img",{style:_vm.previewStyle,attrs:{src:_vm.createImgUrl}}),_c("span",[_vm._v(_vm._s(_vm.lang.preview))])])])])]),_c("div",{staticClass:"vicp-operate"},[_c("a",{on:{click:function($event){return _vm.setStep(1)},mousedown:_vm.ripple}},[_vm._v(_vm._s(_vm.lang.btn.back))]),_c("a",{staticClass:"vicp-operate-btn",on:{click:_vm.prepareUpload,mousedown:_vm.ripple}},[_vm._v(_vm._s(_vm.lang.btn.save))])])]):_vm._e(),3==_vm.step?_c("div",{staticClass:"vicp-step3"},[_c("div",{staticClass:"vicp-upload"},[_c("span",{directives:[{name:"show",rawName:"v-show",value:1===_vm.loading,expression:"loading === 1"}],staticClass:"vicp-loading"},[_vm._v(_vm._s(_vm.lang.loading))]),_c("div",{staticClass:"vicp-progress-wrap"},[_c("span",{directives:[{name:"show",rawName:"v-show",value:1===_vm.loading,expression:"loading === 1"}],staticClass:"vicp-progress",style:_vm.progressStyle})]),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.hasError,expression:"hasError"}],staticClass:"vicp-error"},[_c("i",{staticClass:"vicp-icon2"}),_vm._v(" "+_vm._s(_vm.errorMsg)+" ")]),_c("div",{directives:[{name:"show",rawName:"v-show",value:2===_vm.loading,expression:"loading === 2"}],staticClass:"vicp-success"},[_c("i",{staticClass:"vicp-icon3"}),_vm._v(" "+_vm._s(_vm.lang.success)+" ")])]),_c("div",{staticClass:"vicp-operate"},[_c("a",{on:{click:function($event){return _vm.setStep(2)},mousedown:_vm.ripple}},[_vm._v(_vm._s(_vm.lang.btn.back))]),_c("a",{on:{click:_vm.off,mousedown:_vm.ripple}},[_vm._v(_vm._s(_vm.lang.btn.close))])])]):_vm._e(),_c("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"canvas",attrs:{width:_vm.width,height:_vm.height}})])])},staticRenderFns=[],language=__webpack_require__(342971),mimes=__webpack_require__(560421),data2blob=__webpack_require__(646979),effectRipple=__webpack_require__(321279),upload_2vue_type_script_lang_js={props:{
// 域，上传文件name，触发事件会带上（如果一个页面多个图片上传控件，可以做区分
field:{type:String,default:"avatar"},
// 原名key，类似于id，触发事件会带上（如果一个页面多个图片上传控件，可以做区分
ki:{default:0},
// 显示该控件与否
value:{default:!0},
// 上传地址
url:{type:String,default:""},
// 其他要上传文件附带的数据，对象格式
params:{type:Object,default:null},
//Add custom headers
headers:{type:Object,default:null},
// 剪裁图片的宽
width:{type:Number,default:200},
// 剪裁图片的高
height:{type:Number,default:200},
// 不显示旋转功能
noRotate:{type:Boolean,default:!0},
// 不预览圆形图片
noCircle:{type:Boolean,default:!1},
// 不预览方形图片
noSquare:{type:Boolean,default:!1},
// 单文件大小限制
maxSize:{type:Number,default:10240},
// 语言类型
langType:{type:String,default:"zh"},
// 语言包
langExt:{type:Object,default:null},
// 图片上传格式
imgFormat:{type:String,default:"png"},
// 图片背景 jpg情况下生效
imgBgc:{type:String,default:"#fff"},
// 是否支持跨域
withCredentials:{type:Boolean,default:!1},method:{type:String,default:"POST"}},data(){let that=this,{imgFormat:imgFormat,langType:langType,langExt:langExt,width:width,height:height}=that,isSupported=!0,allowImgFormat=["jpg","png"],tempImgFormat=-1===allowImgFormat.indexOf(imgFormat)?"jpg":imgFormat,lang=language/* default */.Z[langType]?language/* default */.Z[langType]:language/* default */.Z["en"],mime=mimes/* default */.Z[tempImgFormat];
// 规范图片格式
return that.imgFormat=tempImgFormat,langExt&&Object.assign(lang,langExt),"function"!=typeof FormData&&(isSupported=!1),{
// 图片的mime
mime:mime,
// 语言包
lang:lang,
// 浏览器是否支持该控件
isSupported:isSupported,
// 浏览器是否支持触屏事件
isSupportTouch:document.hasOwnProperty("ontouchstart"),
// 步骤
step:1,//1选择文件 2剪裁 3上传
// 上传状态及进度
loading:0,//0未开始 1正在 2成功 3错误
progress:0,
// 是否有错误及错误信息
hasError:!1,errorMsg:"",
// 需求图宽高比
ratio:width/height,
// 原图地址、生成图片地址
sourceImg:null,sourceImgUrl:"",createImgUrl:"",
// 原图片拖动事件初始值
sourceImgMouseDown:{on:!1,mX:0,//鼠标按下的坐标
mY:0,x:0,//scale原图坐标
y:0},
// 生成图片预览的容器大小
previewContainer:{width:100,height:100},
// 原图容器宽高
sourceImgContainer:{// sic
width:240,height:184},
// 原图展示属性
scale:{zoomAddOn:!1,//按钮缩放事件开启
zoomSubOn:!1,//按钮缩放事件开启
range:1,//最大100
x:0,y:0,width:0,height:0,maxWidth:0,maxHeight:0,minWidth:0,//最宽
minHeight:0,naturalWidth:0,//原宽
naturalHeight:0}}},computed:{
// 进度条样式
progressStyle(){let{progress:progress}=this;return{width:progress+"%"}},
// 原图样式
sourceImgStyle(){let{scale:scale,sourceImgMasking:sourceImgMasking}=this,top=scale.y+sourceImgMasking.y+"px",left=scale.x+sourceImgMasking.x+"px";return{top:top,left:left,width:scale.width+"px",height:scale.height+"px"}},
// 原图蒙版属性
sourceImgMasking(){let{width:width,height:height,ratio:ratio,sourceImgContainer:sourceImgContainer}=this,sic=sourceImgContainer,sicRatio=sic.width/sic.height,// 原图容器宽高比
x=0,y=0,w=sic.width,h=sic.height,scale=1;return ratio<sicRatio&&(scale=sic.height/height,w=sic.height*ratio,x=(sic.width-w)/2),ratio>sicRatio&&(scale=sic.width/width,h=sic.width/ratio,y=(sic.height-h)/2),{scale:scale,// 蒙版相对需求宽高的缩放
x:x,y:y,width:w,height:h}},
// 原图遮罩样式
sourceImgShadeStyle(){let{sourceImgMasking:sourceImgMasking,sourceImgContainer:sourceImgContainer}=this,sic=sourceImgContainer,sim=sourceImgMasking,w=sim.width==sic.width?sim.width:(sic.width-sim.width)/2,h=sim.height==sic.height?sim.height:(sic.height-sim.height)/2;return{width:w+"px",height:h+"px"}},previewStyle(){let{width:width,height:height,ratio:ratio,previewContainer:previewContainer}=this,pc=previewContainer,w=pc.width,h=pc.height,pcRatio=w/h;return ratio<pcRatio&&(w=pc.height*ratio),ratio>pcRatio&&(h=pc.width/ratio),{width:w+"px",height:h+"px"}}},watch:{value(newValue){newValue&&1!=this.loading&&this.reset()}},methods:{
// 点击波纹效果
ripple(e){(0,effectRipple/* default */.Z)(e)},
// 关闭控件
off(){setTimeout((()=>{this.$emit("input",!1),3==this.step&&2==this.loading&&this.setStep(1)}),200)},
// 设置步骤
setStep(no){
// 延时是为了显示动画效果呢，哈哈哈
setTimeout((()=>{this.step=no}),200)},
/* 图片选择区域函数绑定
		 ---------------------------------------------------------------*/
preventDefault(e){return e.preventDefault(),!1},handleClick(e){1!==this.loading&&e.target!==this.$refs.fileinput&&(e.preventDefault(),document.activeElement!==this.$refs&&this.$refs.fileinput.click())},handleChange(e){if(e.preventDefault(),1!==this.loading){let files=e.target.files||e.dataTransfer.files;this.reset(),this.checkFile(files[0])&&this.setSourceImg(files[0])}},
/* ---------------------------------------------------------------*/
// 检测选择的文件是否合适
checkFile(file){let that=this,{lang:lang,maxSize:maxSize}=that;
// 仅限图片
return-1===file.type.indexOf("image")?(that.hasError=!0,that.errorMsg=lang.error.onlyImg,!1):
// 超出大小
!(file.size/1024>maxSize)||(that.hasError=!0,that.errorMsg=lang.error.outOfSize+maxSize+"kb",!1)},
// 重置控件
reset(){let that=this;that.loading=0,that.hasError=!1,that.errorMsg="",that.progress=0},
// 设置图片源
setSourceImg(file){this.$emit("src-file-set",file.name,file.type,file.size);let that=this,fr=new FileReader;fr.onload=function(e){that.sourceImgUrl=fr.result,that.startCrop()},fr.readAsDataURL(file)},
// 剪裁前准备工作
startCrop(){let that=this,{width:width,height:height,ratio:ratio,scale:scale,sourceImgUrl:sourceImgUrl,sourceImgMasking:sourceImgMasking,lang:lang}=that,sim=sourceImgMasking,img=new Image;img.src=sourceImgUrl,img.onload=function(){let nWidth=img.naturalWidth,nHeight=img.naturalHeight,nRatio=nWidth/nHeight,w=sim.width,h=sim.height,x=0,y=0;
// 图片像素不达标
if(nWidth<width||nHeight<height)return that.hasError=!0,that.errorMsg=lang.error.lowestPx+width+"*"+height,!1;ratio>nRatio&&(h=w/nRatio,y=(sim.height-h)/2),ratio<nRatio&&(w=h*nRatio,x=(sim.width-w)/2),scale.range=0,scale.x=x,scale.y=y,scale.width=w,scale.height=h,scale.minWidth=w,scale.minHeight=h,scale.maxWidth=nWidth*sim.scale,scale.maxHeight=nHeight*sim.scale,scale.naturalWidth=nWidth,scale.naturalHeight=nHeight,that.sourceImg=img,that.createImg(),that.setStep(2)}},
// 鼠标按下图片准备移动
imgStartMove(e){
// 支持触摸事件，则鼠标事件无效
if(e.preventDefault(),this.isSupportTouch&&!e.targetTouches)return!1;let et=e.targetTouches?e.targetTouches[0]:e,{sourceImgMouseDown:sourceImgMouseDown,scale:scale}=this,simd=sourceImgMouseDown;simd.mX=et.screenX,simd.mY=et.screenY,simd.x=scale.x,simd.y=scale.y,simd.on=!0},
// 鼠标按下状态下移动，图片移动
imgMove(e){
// 支持触摸事件，则鼠标事件无效
if(e.preventDefault(),this.isSupportTouch&&!e.targetTouches)return!1;let et=e.targetTouches?e.targetTouches[0]:e,{sourceImgMouseDown:{on:on,mX:mX,mY:mY,x:x,y:y},scale:scale,sourceImgMasking:sourceImgMasking}=this,sim=sourceImgMasking,nX=et.screenX,nY=et.screenY,dX=nX-mX,dY=nY-mY,rX=x+dX,rY=y+dY;on&&(rX>0&&(rX=0),rY>0&&(rY=0),rX<sim.width-scale.width&&(rX=sim.width-scale.width),rY<sim.height-scale.height&&(rY=sim.height-scale.height),scale.x=rX,scale.y=rY)},
// 顺时针旋转图片
rotateImg(e){let{sourceImg:sourceImg,scale:{naturalWidth:naturalWidth,naturalHeight:naturalHeight}}=this,width=naturalHeight,height=naturalWidth,canvas=this.$refs.canvas,ctx=canvas.getContext("2d");canvas.width=width,canvas.height=height,ctx.clearRect(0,0,width,height),ctx.fillStyle="rgba(0,0,0,0)",ctx.fillRect(0,0,width,height),ctx.translate(width,0),ctx.rotate(90*Math.PI/180),ctx.drawImage(sourceImg,0,0,naturalWidth,naturalHeight);let imgUrl=canvas.toDataURL(mimes/* default */.Z["png"]);this.sourceImgUrl=imgUrl,this.startCrop()},
// 按钮按下开始放大
startZoomAdd(e){let that=this,{scale:scale}=that;function zoom(){if(scale.zoomAddOn){let range=scale.range>=100?100:++scale.range;that.zoomImg(range),setTimeout((function(){zoom()}),60)}}scale.zoomAddOn=!0,zoom()},
// 按钮松开或移开取消放大
endZoomAdd(e){this.scale.zoomAddOn=!1},
// 按钮按下开始缩小
startZoomSub(e){let that=this,{scale:scale}=that;function zoom(){if(scale.zoomSubOn){let range=scale.range<=0?0:--scale.range;that.zoomImg(range),setTimeout((function(){zoom()}),60)}}scale.zoomSubOn=!0,zoom()},
// 按钮松开或移开取消缩小
endZoomSub(e){let{scale:scale}=this;scale.zoomSubOn=!1},zoomChange(e){this.zoomImg(e.target.value)},
// 缩放原图
zoomImg(newRange){let that=this,{sourceImgMasking:sourceImgMasking,sourceImgMouseDown:sourceImgMouseDown,scale:scale}=this,{maxWidth:maxWidth,maxHeight:maxHeight,minWidth:minWidth,minHeight:minHeight,width:width,height:height,x:x,y:y,range:range}=scale,sim=sourceImgMasking,
// 蒙版宽高
sWidth=sim.width,sHeight=sim.height,
// 新宽高
nWidth=minWidth+(maxWidth-minWidth)*newRange/100,nHeight=minHeight+(maxHeight-minHeight)*newRange/100,
// 新坐标（根据蒙版中心点缩放）
nX=sWidth/2-nWidth/width*(sWidth/2-x),nY=sHeight/2-nHeight/height*(sHeight/2-y);
// 判断新坐标是否超过蒙版限制
nX>0&&(nX=0),nY>0&&(nY=0),nX<sWidth-nWidth&&(nX=sWidth-nWidth),nY<sHeight-nHeight&&(nY=sHeight-nHeight),
// 赋值处理
scale.x=nX,scale.y=nY,scale.width=nWidth,scale.height=nHeight,scale.range=newRange,setTimeout((function(){scale.range==newRange&&that.createImg()}),300)},
// 生成需求图片
createImg(e){let that=this,{imgFormat:imgFormat,imgBgc:imgBgc,mime:mime,sourceImg:sourceImg,scale:{x:x,y:y,width:width,height:height},sourceImgMasking:{scale:scale}}=that,canvas=that.$refs.canvas,ctx=canvas.getContext("2d");e&&(
// 取消鼠标按下移动状态
that.sourceImgMouseDown.on=!1),canvas.width=that.width,canvas.height=that.height,ctx.clearRect(0,0,that.width,that.height),ctx.fillStyle="png"==imgFormat?"rgba(0,0,0,0)":imgBgc,ctx.fillRect(0,0,that.width,that.height),ctx.drawImage(sourceImg,x/scale,y/scale,width/scale,height/scale),that.createImgUrl=canvas.toDataURL(mime)},prepareUpload(){let{url:url,createImgUrl:createImgUrl,field:field,ki:ki}=this;this.$emit("crop-success",createImgUrl,field,ki),"string"==typeof url&&url?this.upload():this.off()},
// 上传图片
upload(){let that=this,{lang:lang,imgFormat:imgFormat,mime:mime,url:url,params:params,headers:headers,field:field,ki:ki,createImgUrl:createImgUrl,withCredentials:withCredentials,method:method}=this,fmData=new FormData;fmData.append(field,(0,data2blob/* default */.Z)(createImgUrl,mime),field+"."+imgFormat),
// 添加其他参数
"object"==typeof params&&params&&Object.keys(params).forEach((k=>{fmData.append(k,params[k])}));
// 监听进度回调
const uploadProgress=function(event){event.lengthComputable&&(that.progress=100*Math.round(event.loaded)/event.total)};
// 上传文件
that.reset(),that.loading=1,that.setStep(3),new Promise((function(resolve,reject){let client=new XMLHttpRequest;client.open(method,url,!0),client.withCredentials=withCredentials,client.onreadystatechange=function(){4===this.readyState&&(200===this.status||201===this.status?resolve(JSON.parse(this.responseText)):reject(this.status))},client.upload.addEventListener("progress",uploadProgress,!1),//监听进度
// 设置header
"object"==typeof headers&&headers&&Object.keys(headers).forEach((k=>{client.setRequestHeader(k,headers[k])})),client.send(fmData)})).then((
// 上传成功
function(resData){that.value&&(that.loading=2,that.$emit("crop-upload-success",resData,field,ki))}),(
// 上传失败
function(sts){that.value&&(that.loading=3,that.hasError=!0,that.errorMsg=lang.fail,that.$emit("crop-upload-fail",sts,field,ki))}))}},created(){
// 绑定按键esc隐藏此插件事件
document.addEventListener("keyup",(e=>{!this.value||"Escape"!=e.key&&27!=e.keyCode||this.off()}))}},vue_image_crop_upload_upload_2vue_type_script_lang_js=upload_2vue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(vue_image_crop_upload_upload_2vue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,upload_2=component.exports},
/***/574752:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return Avatar}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/Avatar.vue?vue&type=template&id=7f0d5689
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.user||_vm.name?_c("div",{staticClass:"fc-avatar-inline"},[_vm.avatarUrl?_c("img",{staticClass:"fc-avatar",class:_vm.sizeClass,attrs:{src:_vm.avatarUrl,alt:"Profile Avatar"}}):_c("div",{staticClass:"fc-avatar",class:_vm.sizeClass,style:_vm.bgColor},[_vm._v(" "+_vm._s(_vm.trimmedName)+" ")])]):_vm._e()},staticRenderFns=[],objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(564043),__webpack_require__(709873),__webpack_require__(228436),__webpack_require__(450886),__webpack_require__(677049),__webpack_require__(821694),__webpack_require__(420629)),Avatarvue_type_script_lang_js={props:{size:{type:String},user:{type:Object},avatarStyle:{type:Object},color:{type:String},name:{type:Boolean}},data:function(){return{sizeClass:"fc-avatar-"+this.size,fullName:"",trimmedName:null,avatarUrl:null,bgColor:"background-color: "+(this.color?this.color:this.getRandomBgColor())}},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),mounted:function(){var _this=this;if(this.user){var userName="";if(this.user.avatarUrl)this.avatarUrl=this.user.avatarUrl;else if(this.user.id){var userObj=this.users.find((function(user){return user.id===_this.user.id}));userObj&&userObj.avatarUrl&&(this.avatarUrl=userObj.avatarUrl),userObj&&userObj.name&&(userName=userObj.name)}userName=userName||this.user.name,userName&&(this.fullName=userName,this.trimmedName=this.getAvatarName(userName),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))}else this.name&&(this.trimmedName=this.getAvatarName(this.name),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))},watch:{user:function(){var _this2=this;if(this.user.avatarUrl)this.avatarUrl=this.user.avatarUrl;else if(this.user.id){var userObj=this.users.find((function(user){return user.id===_this2.user.id}));userObj&&userObj.avatarUrl?this.avatarUrl=userObj.avatarUrl:this.avatarUrl=null}else this.avatarUrl=null;this.user.name&&(this.fullName=this.user.name,this.trimmedName=this.getAvatarName(this.user.name),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))},"user.name":function(){this.user.name&&(this.fullName=this.user.name,this.trimmedName=this.getAvatarName(this.user.name),this.bgColor="background-color: "+(this.color?this.color:this.getRandomBgColor()))},"user.avatarUrl":function(){this.user.avatarUrl?this.avatarUrl=this.user.avatarUrl:this.avatarUrl=null},"user.id":function(){var _this3=this;if(this.user.id){var userObj=this.users.find((function(user){return user.id===_this3.user.id}));userObj&&userObj.avatarUrl?this.avatarUrl=userObj.avatarUrl:this.avatarUrl=null}else this.avatarUrl=null}},methods:{getAvatarName:function(name){for(var parts=name.split(/[ -]/),initials="",initialLen=2,count=0,i=0;i<parts.length;i++)if(""!==parts[i].trim()&&(initials+=parts[i].charAt(0),count++,count>=initialLen))break;initials.length<initialLen&&name.length>=initialLen&&(initials=name.trim().substring(0,initialLen));var avatarName=initials.toUpperCase();return avatarName},getRandomBgColor:function(){var colors=["#FFBA51","#34BFA3","#FF2F82","#29D9A7","#ECDC74","#927FED","#FF61A8","#fbf383","#ac4352","#6db1f4"],userKey=this.user.email?this.user.email:this.user.name,userUniqueNum=Array.from(userKey).map((function(letter){return letter.charCodeAt(0)})).reduce((function(current,previous){return previous+current})),colorIndex=userUniqueNum%colors.length,color=colors[colorIndex];return color}}},components_Avatarvue_type_script_lang_js=Avatarvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_Avatarvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,Avatar=component.exports},
/***/604947:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return Spinner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/Spinner.vue?vue&type=template&id=06a81286&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("transition",[_c("svg",{directives:[{name:"show",rawName:"v-show",value:_vm.show,expression:"show"}],staticClass:"spinner",class:{show:_vm.show},attrs:{width:_vm.spinnerSize,height:_vm.spinnerSize,viewBox:"0 0 44 44"}},[_c("circle",{staticClass:"path",style:{stroke:_vm.strokeColor},attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},staticRenderFns=[],Spinnervue_type_script_lang_js={name:"spinner",props:["show","size","colour"],computed:{spinnerSize:function(){return this.size?this.size+"px":"50px"},strokeColor:function(){return this.colour?this.colour:"#fd4b92"}}},components_Spinnervue_type_script_lang_js=Spinnervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_Spinnervue_type_script_lang_js,render,staticRenderFns,!1,null,"06a81286",null)
/* harmony default export */,Spinner=component.exports},
/***/476432:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return EditProfile}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/personalsettings/EditProfile.vue?vue&type=template&id=a270e4da
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable120-y100 mB30 editprofile-portal-container p40"},[_c("div",{staticClass:"setup-modal-title"},[_vm._v(" "+_vm._s(_vm.$t("setup.setup_profile.edit_profile"))+" ")]),_vm.isLoading?_c("div",{staticClass:"loading-container d-flex"},[_c("Spinner",{attrs:{show:_vm.isLoading}})],1):_c("el-form",{ref:"profileForm",staticClass:"mT10",attrs:{model:_vm.user,"label-width":"120px","label-position":"top",rules:_vm.rules}},[_c("div",{staticClass:"row"},[_c("div",{staticClass:"col-lg-12 col-md-12 fc-modal-sub-title mT20"},[_vm._v(" "+_vm._s(_vm.$t("setup.setup_profile.general_info"))+" ")]),_c("div",{staticClass:"col-lg-6 col-md-6 mT10"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.full_name")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width90",model:{value:_vm.user.name,callback:function($$v){_vm.$set(_vm.user,"name",$$v)},expression:"user.name"}})],1),_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.email")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width90",attrs:{disabled:""},model:{value:_vm.user.email,callback:function($$v){_vm.$set(_vm.user,"email",$$v)},expression:"user.email"}})],1),_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.timezone")}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width90",attrs:{placeholder:"Select a timezone"},model:{value:_vm.user.timezone,callback:function($$v){_vm.$set(_vm.user,"timezone",$$v)},expression:"user.timezone"}},_vm._l(_vm.timezoneList,(function(timeZone,index){return _c("el-option",{key:timeZone.value+"-"+index,attrs:{label:timeZone.label,value:timeZone.value}})})),1)],1),_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.language")}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width90",attrs:{placeholder:"Select language"},model:{value:_vm.user.language,callback:function($$v){_vm.$set(_vm.user,"language",$$v)},expression:"user.language"}},_vm._l(_vm.languageList,(function(language,index){return _c("el-option",{key:language.value+"-"+index,attrs:{label:language.label,value:language.value}})})),1)],1)],1),_c("div",{staticClass:"col-lg-6 col-md-6"},[_c("div",{staticClass:"logo-upload",staticStyle:{"text-align":"center","padding-top":"15px"}},[_c("div",{staticClass:"companylogocontainer"},[_c("Avatar",{attrs:{size:"shuge",user:_vm.account.user}}),_c("div",{staticClass:"fc-avatar-actions mT20 mR3"},[_c("a",{on:{click:_vm.toggleShow}},[_vm._v(_vm._s(_vm.$t("setup.setup_profile.upload_change")))]),_vm.account.user.avatarUrl?_c("span",{staticClass:"separator"},[_vm._v("|")]):_vm._e(),_vm.account.user.avatarUrl?_c("a",{on:{click:_vm.deleteProfilePhoto}},[_vm._v(_vm._s(_vm.$t("setup.setup_profile.photo_delete")))]):_vm._e()]),_c("photo-upload",{attrs:{langType:"en",field:"user.avatar",withCredentials:!0,width:120,height:120,params:_vm.params,headers:_vm.headers,url:_vm.avatarUploadUrl,"img-format":"png"},on:{"crop-success":_vm.avatarCropSuccess,"crop-upload-success":_vm.avatarCropUploadSuccess,"crop-upload-fail":_vm.avatarCropUploadFail},model:{value:_vm.showAvatarUpload,callback:function($$v){_vm.showAvatarUpload=$$v},expression:"showAvatarUpload"}})],1)])]),_c("div",{staticClass:"col-lg-12 col-md-12 fc-modal-sub-title mT20"},[_vm._v(" "+_vm._s(_vm.$t("setup.setup_profile.contact_info"))+" ")]),_c("div",{staticClass:"col-lg-3 col-md-3 mT10"},[_c("div",{staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{prop:"phone",label:_vm.$t("setup.setup_profile.phone")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width80",model:{value:_vm.user.phone,callback:function($$v){_vm.$set(_vm.user,"phone",$$v)},expression:"user.phone"}})],1)],1)]),_c("div",{staticClass:"col-lg-3 col-md-3 mT10"},[_c("div",{staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{prop:"mobile",label:_vm.$t("setup.setup_profile.mobile")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width80",model:{value:_vm.user.mobile,callback:function($$v){_vm.$set(_vm.user,"mobile",$$v)},expression:"user.mobile"}})],1)],1)]),_c("div",{staticClass:"col-lg-12 col-md-12 fc-modal-sub-title mT20"},[_vm._v(" "+_vm._s(_vm.$t("setup.setup_profile.address_info"))+" ")]),_c("div",{staticClass:"col-lg-6 col-md-6 mT10"},[_c("div",{staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.street")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width90",model:{value:_vm.user.street,callback:function($$v){_vm.$set(_vm.user,"street",$$v)},expression:"user.street"}})],1)],1),_c("div",{staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.city")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width90",model:{value:_vm.user.city,callback:function($$v){_vm.$set(_vm.user,"city",$$v)},expression:"user.city"}})],1)],1)]),_c("div",{staticClass:"col-lg-12 col-md-12"}),_c("div",{staticClass:"col-lg-3 col-md-4"},[_c("div",{staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.state")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width90",model:{value:_vm.user.state,callback:function($$v){_vm.$set(_vm.user,"state",$$v)},expression:"user.state"}})],1)],1)]),_c("div",{staticClass:"col-lg-3 col-md-2"},[_c("div",{staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.zipcode")}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width80",model:{value:_vm.user.zip,callback:function($$v){_vm.$set(_vm.user,"zip",$$v)},expression:"user.zip"}})],1)],1)]),_c("div",{staticClass:"col-lg-12 col-md-12"}),_c("div",{staticClass:"col-lg-6 col-md-6"},[_c("el-form-item",{attrs:{label:_vm.$t("setup.setup_profile.country")}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width90",attrs:{placeholder:"Select language"},model:{value:_vm.user.country,callback:function($$v){_vm.$set(_vm.user,"country",$$v)},expression:"user.country"}},_vm._l(_vm.countryList,(function(language,index){return _c("el-option",{key:index,attrs:{label:language.label,value:language.value}})})),1)],1)],1),_vm.canShowNotificationSettings?_c("div",{staticClass:"col-lg-12 col-md-12 fc-modal-sub-title mT20"},[_vm._v(" "+_vm._s(_vm.$t("setup.setup_profile.notification_settings"))+" ")]):_vm._e(),_vm.canShowNotificationSettings?_c("div",{staticClass:"col-lg-6 col-md-6 mT10"},_vm._l(_vm.notificationSettings,(function(setting,settingIdx){return _c("div",{key:"notification-setting"+setting.notificationType,staticClass:"form-input mB10"},[_c("el-form-item",{attrs:{label:_vm.notificationToggleDescription[setting.notificationType]}},[_c("el-checkbox",{attrs:{value:!setting.disabled},on:{change:function(val){return _vm.toggleSettingSwitch(val,settingIdx)}}})],1)],1)})),0):_vm._e(),_c("div",{staticClass:"col-lg-12 col-md-12 mT30"},[_c("el-button",{staticClass:"btn btn--primary setup-el-btn pL60 pR60 mT20",attrs:{loading:_vm.saving},on:{click:_vm.saveProfile}},[_vm._v(" "+_vm._s(_vm.saving?_vm.$t("common._common._saving"):_vm.$t("common._common._save"))+" ")])],1)])])],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),timezones=(__webpack_require__(821057),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(887315)),countries=__webpack_require__(587207),Avatar=__webpack_require__(574752),upload_2=__webpack_require__(607842),vuex_esm=__webpack_require__(420629),validation=__webpack_require__(990260),constant=__webpack_require__(354754),api=__webpack_require__(32284),baseUrl=__webpack_require__(420499),helpers=__webpack_require__(778390),Spinner=__webpack_require__(604947),EditProfilevue_type_script_lang_js={data:function(){return{submit:!1,showAvatarUpload:!1,params:{userId:0},headers:{},avatarUploadUrl:null,isLoading:!1,avatarDataUrl:"",timezoneList:timezones/* default */.Z,countryList:countries/* default */.Z,languageList:constant/* default */.Z.languages,notificationSettings:[],user:{name:null,email:null,timezone:null,language:null,street:null,city:null,state:null,zip:null,country:null,phone:null,mobile:null,uid:-1},saving:!1,rules:{mobile:[{validator:function(rule,mobile,callback){(0,validation/* isEmpty */.xb)(mobile)||(0,helpers/* isValidPhoneNumber */.yf)(mobile)?callback():callback(new Error("Please enter valid mobile number"))},trigger:"blur"}],phone:[{validator:function(rule,phone,callback){var isValid=(0,validation/* isEmpty */.xb)(phone)||"+"==phone;isValid||(0,helpers/* isValidPhoneNumber */.yf)(phone)?callback():callback(new Error("Please enter valid phone number"))},trigger:"blur"}]},notificationToggleDescription:{COMMENT_MENTION_EMAIL:"Email Notification for Comment Mentions",COMMENT_MENTION_IN_APP:"In App Notification for Comment Mentions"}}},title:function(){return"Edit Profile"},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({account:function(state){return state.account}})),{},{isNewCommentsEnabled:function(){return this.$helpers.isLicenseEnabled("NEW_COMMENTS")},canShowNotificationSettings:function(){var isNewCommentsEnabled=this.isNewCommentsEnabled,notificationSettings=this.notificationSettings;return isNewCommentsEnabled&&!(0,validation/* isEmpty */.xb)(notificationSettings)}}),created:function(){var _this=this,isNewCommentsEnabled=this.isNewCommentsEnabled;isNewCommentsEnabled&&this.getAllNotificationPreferences();var timezone=null;this.account.user.timezone&&(timezone=this.timezoneList.find((function(timezone){return timezone.value===_this.account.user.timezone})));var language=null;this.account.user.language&&(language=this.languageList.find((function(language){return language.value===_this.account.user.language})));var country=null;this.account.user.country&&(country=this.countryList.find((function(country){return country.value===_this.account.user.country}))),this.params.userId=this.account.user.uid;var user=this.account.user,name=user.name,email=user.email,phone=user.phone,mobile=user.mobile,street=user.street,state=user.state,city=user.city,zip=user.zip,uid=user.uid;this.user={name:name,uid:uid||-1,email:email,phone:phone,mobile:mobile,street:street,state:state,city:city,zip:zip,language:language?language.value:null,timezone:timezone?timezone.value:null,country:country?country.value:null};
// avatar upload url
var baseURL=(0,baseUrl/* getBaseURL */.BS)();this.avatarUploadUrl="".concat(baseURL,"/settings/users/avatar/upload");var csrf=this.$cookie.get("fc.csrfToken");(0,validation/* isEmpty */.xb)(csrf)||(this.headers["X-CSRF-Token"]=csrf)},components:{Avatar:Avatar["default"],PhotoUpload:upload_2/* default */.Z,Spinner:Spinner/* default */.Z},methods:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapActions */.nv)({updateUserAvatarUrl:"updateUserAvatarUrl"})),{},{close:function(){alert("close dialog")},getAllNotificationPreferences:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$get,data,error,peopleNotificationSettingsList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this2.isLoading=!0,_context.next=3,api/* API */.bl.get("/account/getNotificationPreferences");case 3:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error||(peopleNotificationSettingsList=data.peopleNotificationSettingsList,_this2.notificationSettings=peopleNotificationSettingsList),_this2.isLoading=!1;case 8:case"end":return _context.stop()}}),_callee)})))()},saveProfile:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var notificationSettings;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:notificationSettings=_this3.notificationSettings,_this3.$refs["profileForm"].validate(function(){var _ref=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(valid){var userObj,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(valid){_context2.next=2;break}return _context2.abrupt("return",!1);case 2:return _this3.saving=!0,userObj=_this3.$helpers.cloneObject(_this3.user),_context2.next=6,api/* API */.bl.post("/account/update",{user:userObj,peopleNotificationSettingsList:notificationSettings});case 6:_yield$API$post=_context2.sent,error=_yield$API$post.error,error?(_this3.$message.error(error.message||"Error Occured"),_this3.$emit("close",!0)):(_this3.$message.success(_this3.$t("setup.setup_profile.user_profile_details")),_this3.$helpers.delay(1e3).then((function(){return location.reload()}))),_this3.saving=!1;case 10:case"end":return _context2.stop()}}),_callee2)})));return function(_x){return _ref.apply(this,arguments)}}());case 2:case"end":return _context3.stop()}}),_callee3)})))()},deleteProfilePhoto:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var value,user,id,uid,_yield$API$post2,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_this4.$dialog.confirm({title:_this4.$t("setup.setup_profile.header_delete_avatar"),message:_this4.$t("setup.setup_profile.avatar_delete_confirmation"),rbDanger:!0,rbLabel:_this4.$t("common._common.delete")});case 2:if(value=_context4.sent,!value){_context4.next=11;break}return user=_this4.account.user,id=user.id,uid=user.uid,_context4.next=8,api/* API */.bl.post("/settings/users/avatar/delete",{userId:uid});case 8:_yield$API$post2=_context4.sent,error=_yield$API$post2.error,error?_this4.$message.error(error.message||"Error Occured"):(_this4.updateUserAvatarUrl({id:id,avatarUrl:null}),_this4.account.user.avatarUrl=null);case 11:case"end":return _context4.stop()}}),_callee4)})))()},toggleShow:function(){this.showAvatarUpload=!this.showAvatarUpload},avatarCropSuccess:function(avatarDataUrl){this.avatarDataUrl=avatarDataUrl},avatarCropUploadSuccess:function(jsonData){this.updateUserAvatarUrl({id:this.account.user.id,avatarUrl:jsonData.avatarUrl}),this.account.user.avatarUrl=jsonData.avatarUrl},avatarCropUploadFail:function(){this.$message.error("Avatar upload fail")},toggleSettingSwitch:function(value,settingIdx){var setting=this.notificationSettings[settingIdx]||{};setting.disabled=!value,this.$set(this.notificationSettings,settingIdx,setting)}})},personalsettings_EditProfilevue_type_script_lang_js=EditProfilevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(personalsettings_EditProfilevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,EditProfile=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/37820.js.map