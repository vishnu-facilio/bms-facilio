"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[11288],{
/***/611288:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return AlarmSummaryCard}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/alarms/AlarmSummaryCard.vue?vue&type=template&id=2491a038&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"p30 d-flex flex-direction-column"},[_c("div",{staticClass:"f12 bold text-uppercase mB10 fc-black-13 text-left letter-spacing1"},[_vm._v(" "+_vm._s(_vm.$t("common._common.fdd_alarms"))+" ")]),_c("div",{staticClass:"f45 fc-black-com pointer"},[_c("div",{on:{click:function($event){return _vm.goToView("fdd")}}},[_vm._v(_vm._s(_vm.activeAlarmCount||0))])]),_c("hr",{staticClass:"separator-line width100 mT60"}),_c("div",{staticClass:"f12 bold text-uppercase mB10 fc-black-13 text-left letter-spacing1"},[_vm._v(" "+_vm._s(_vm.$t("common._common.bms_alarms"))+" ")]),_c("div",{staticClass:"f45 fc-black-com pointer"},[_c("div",{on:{click:function($event){return _vm.goToView("bms")}}},[_vm._v(_vm._s(_vm.activeBmsAlarmCount||0))])])])},staticRenderFns=[],validation=(__webpack_require__(648324),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(990260)),router=__webpack_require__(329435),api=__webpack_require__(32284),AlarmSummaryCardvue_type_script_lang_js={props:["details","layoutParams","hideTitleSection","activeTab","widget","resizeWidget"],mounted:function(){this.loadCount(),this.loadAlarmRuleDatails(),this.loadBmsAlarmCount()},data:function(){return{activeAlarmCount:null,alarm:null,alarmDuration:null,activeBmsAlarmCount:null}},methods:{goToView:function(type){var filters={resource:[{operatorId:36,value:["".concat(this.details.id)]}]},query={includeParentFilter:!0,search:JSON.stringify(filters)},path="/app/fa/faults/active";if("bms"===type&&(path="/app/fa/bmsalarms/bmsActive"),(0,router/* isWebTabsEnabled */.tj)()){var moduleName=this.$helpers.isLicenseEnabled("NEW_ALARMS")?"newreadingalarm":"alarm",viewname="active";"bms"===type&&(moduleName="bmsalarm",viewname="bmsActive");var _ref=(0,router/* findRouteForModule */.Jp)(moduleName,router/* pageTypes */.As.LIST)||{},name=_ref.name;name&&this.$router.push({name:name,params:{viewname:viewname},query:query})}else this.$router.push({path:path,query:query})},loadCount:function(){var _this=this,filters=encodeURIComponent(JSON.stringify({resource:{operatorId:36,value:[this.details.id+""]}})),url="";url=this.$helpers.isLicenseEnabled("NEW_ALARMS")?"/v2/readingalarms/view/active?fetchCount=true&filters=".concat(filters,"&includeParentFilter=true"):"/v2/alarms/view/active?isCount=true&filters=".concat(filters,"&includeParentFilter=true"),this.$http.get(url).then((function(response){0===response.data.responseCode?_this.activeAlarmCount=(0,validation/* isEmpty */.xb)(response.data.result.count)?null:response.data.result.count:
// TODO handle errors
_this.activeAlarmCount=null})).catch((function(){
// TODO handle errors
_this.activeAlarmCount=null}))},loadBmsAlarmCount:function(){var _this2=this,queryParam={viewName:"bmsActive",includeParentFilter:!0,moduleName:"bmsalarm"};queryParam.filters=JSON.stringify({resource:{operatorId:36,value:[this.details.id+""]}});var url="";url="/v3/modules/data/count",api/* API */.bl.get(url,queryParam).then((function(response){var _ref2=response||{},error=_ref2.error,data=_ref2.data;if((0,validation/* isEmpty */.xb)(error)){var _ref3=data||{},count=_ref3.count;_this2.activeBmsAlarmCount=count}}))},loadAlarmRuleDatails:function(){var workFlowId,_this3=this;workFlowId=this.$helpers.isLicenseEnabled("NEW_ALARMS")?5:6,this.$util.getdefaultWorkFlowResult(workFlowId,this.details.id).then((function(response){_this3.loading=!1,_this3.alarm=(0,validation/* isEmpty */.xb)(response.commonRule)?"":response.commonRule,response.duration>0&&(_this3.alarmDuration=response.durationInSeconds)})).catch((function(){_this3.loading=!1}))},loadCommonAlarmDetails:function(){var _this4=this,params={workflow:{expressions:[{name:"commonAlarmDetails",fieldName:"subject",moduleName:"alarm",criteria:{pattern:"(1)",conditions:{1:{fieldName:"resource",operatorId:36,sequence:"1",value:this.details.id}}},groupBy:"entityId",orderByFieldName:"count(*)",sortBy:"desc",limit:1}]}};this.$http.post("/v2/executeworkflow",params).then((function(response){0===response.data.responseCode?_this4.alarm=(0,validation/* isEmpty */.xb)(response.data.result.workflowResult)?"":response.data.result.workflowResult[0]:
// TODO handle errors
_this4.alarm=null})).catch((function(){
// TODO handle errors
_this4.alarm=null}))},loadCommonAlarmDuration:function(){var _this5=this,params={workflow:{expressions:[{name:"a",fieldName:"clearedTime",moduleName:"alarm",aggregateString:"sum",criteria:{pattern:"(1 and 2 and 3)",conditions:{1:{fieldName:"resource",operatorId:36,sequence:"1",value:this.details.id},2:{fieldName:"clearedTime",operatorId:2,sequence:"2"},3:{fieldName:"createdTime",operatorId:28,sequence:"3"}}}},{name:"b",fieldName:"createdTime",moduleName:"alarm",aggregateString:"sum",criteria:{pattern:"(1 and 2 and 3)",conditions:{1:{fieldName:"resource",operatorId:36,sequence:"1",value:this.details.id},2:{fieldName:"clearedTime",operatorId:2,sequence:"2"},3:{fieldName:"createdTime",operatorId:28,sequence:"3"}}}}],resultEvaluator:"(a-b)/1000"}};this.$http.post("/v2/executeworkflow",params).then((function(response){0===response.data.responseCode?(0,validation/* isEmpty */.xb)(response.data.result.workflowResult)?_this5.alarmDuration=null:_this5.alarmDuration=response.data.result.workflowResult:
// TODO handle errors
_this5.alarmDuration=null})).catch((function(){
// TODO handle errors
_this5.alarmDuration=null}))}}},alarms_AlarmSummaryCardvue_type_script_lang_js=AlarmSummaryCardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(alarms_AlarmSummaryCardvue_type_script_lang_js,render,staticRenderFns,!1,null,"2491a038",null)
/* harmony default export */,AlarmSummaryCard=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/11288.js.map