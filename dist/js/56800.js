"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[56800],{
/***/856800:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return SmartTableWrapper}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/widget/cards/v2/SmartTableWrapper.vue?vue&type=template&id=4da322f1
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:" height100"},[_c("div",{staticClass:"fc-widget-header fc-datatable-header-1"},[_c("div",{staticClass:"fc-header fL"},[_vm._v(" "+_vm._s(_vm.data&&_vm.data.tableName?_vm.data.tableName:"TABLE")+" ")])]),_c("div",{staticClass:"table-filters-section pT5"},[_vm.rerenderdatefilter?_vm._e():_c("new-date-picker",{staticClass:"filter-field fR",staticStyle:{"margin-left":"auto"},attrs:{zone:_vm.$timezone,dateObj:_vm.dateObj},on:{"update:dateObj":function($event){_vm.dateObj=$event},"update:date-obj":function($event){_vm.dateObj=$event},date:_vm.changeDateFilter}}),_vm.data&&_vm.data.filters?[_vm.data.filters.building?_c("div",{staticClass:"fR fc-table-filters-section-select"},[_c("el-select",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"db-filter fc-tag",attrs:{filterable:"",clearable:"","collapse-tags":"",placeholder:"Select Building"},on:{change:_vm.applyFilter},model:{value:_vm.updateParams.buildingId,callback:function($$v){_vm.$set(_vm.updateParams,"buildingId",$$v)},expression:"updateParams.buildingId"}},_vm._l(_vm.buildings,(function(building,index){return _c("el-option",{key:index,attrs:{label:building.name,value:building.id}})})),1)],1):_vm._e(),_vm.data.filters&&_vm.data.filters.Assetcategory?_c("div",{staticClass:"fR fc-table-filters-section-select"},[_c("el-select",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"db-filter fc-tag",attrs:{filterable:"",clearable:"","collapse-tags":"",placeholder:"Select Asset category"},on:{change:_vm.applyFilter},model:{value:_vm.updateParams.Assetcategory,callback:function($$v){_vm.$set(_vm.updateParams,"Assetcategory",$$v)},expression:"updateParams.Assetcategory"}},_vm._l(_vm.category,(function(cat,index){return _c("el-option",{key:index,attrs:{label:cat.label,value:cat.value}})})),1)],1):_vm._e()]:_vm._e()],2),_vm.loading?_c("shimmer-loading",{staticClass:"map-shimmer"}):_c("div",{staticClass:"height100 smart-table-wrapper"},[_vm.tablererender?_vm._e():[_c("el-table",{staticClass:"smart-table",attrs:{id:"smart-table"+(_vm.widget&&_vm.widget.id?"-"+_vm.widget.id:"-1"),border:"",data:_vm.elTableResult,fit:!1,"span-method":_vm.objectSpanMethod,height:_vm.height},on:{"header-dragend":_vm.setColWidth}},[_vm._l(_vm.data.columns,(function(config,index){return[_c("el-table-column",{key:index,attrs:{prop:config.key,label:config.label,width:config.width},scopedSlots:_vm._u([{key:"header",fn:function(){return[_c("div",{staticClass:"smart-table-header-th row p0 inline width100 align-center relative visibility-visible-actions position-relative"},[_c("div",{staticClass:"width100 p0 flex-middle line-height-normal"},[_c("div",{staticClass:"headerlabel width100"},[_vm._v(_vm._s(config.label))])]),_c("div",{staticClass:"smart-table-actions pointer",on:{click:function($event){_vm.visibility=!0,_vm.selectcolumn=config}}},[!_vm.mode||"TEXT"!==config.datatype&&"NUMBER"!==config.datatype?_vm._e():_c("i",{staticClass:"el-icon-caret-bottom fR condition-icon visibility-hide-actions"})])])]},proxy:!0},{key:"default",fn:function(scope){return[_c("conditional-value",{staticClass:"smart-td-cell",style:_vm.getStyleObj(_vm.formatLabel(scope.row[config.key],config),config.conditionalFormatting,config),attrs:{value:_vm.formatLabel(scope.row[config.key],config),conditionalFormatting:config.conditionalFormatting||[]}})]}}],null,!0)})]}))],2)],_vm.visibility?_c("el-dialog",{attrs:{"custom-class":"f-kfi-card-builder fc-dialog-center-container kpi-map-setup-dilaog","append-to-body":!0,visible:_vm.visibility,width:"50%",title:"KPI CARD","before-close":_vm.closedialog},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("span",{staticClass:"dialog-footer",attrs:{slot:"title"},slot:"title"},[_c("span",{staticClass:"kpi-card-header"},[_vm._v("SMART TABLE SETTINGS")])]),_c("div",{staticStyle:{height:"500px"}},[_c("smart-table-settings",{attrs:{data:_vm.data,column:_vm.selectcolumn}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.closedialog}},[_vm._v("Close")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:function($event){return _vm.save()}}},[_vm._v("OK")])],1)]):_vm._e()],2)],1)},staticRenderFns=[],ShimmerLoading=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(634338),__webpack_require__(450886),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(186466),__webpack_require__(725906),__webpack_require__(339772),__webpack_require__(879288),__webpack_require__(538077),__webpack_require__(670560),__webpack_require__(648324),__webpack_require__(169358),__webpack_require__(762795),__webpack_require__(413383),__webpack_require__(516400)),SmartTableSettings=__webpack_require__(100385),NewConditionalValue=__webpack_require__(152073),criteriaHelper=__webpack_require__(292296),NewDateHelper=__webpack_require__(105534),NewDatePicker=__webpack_require__(900773),moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),SmartTableWrappervue_type_script_lang_js={props:["widget","config"],mixins:[criteriaHelper/* default */.Z],data:function(){return{rerenderdatefilter:!1,dateObj:NewDateHelper/* default */.Z.getDatePickerObject(22),category:[{label:"All Assets",value:"ALL"},{label:"Chiller",value:"Chiller"},{label:"AHU",value:"AHU"},{label:"Primary Pump",value:"Primary Pump"},{label:"Secondary Pump",value:"Secondary Pump"},{label:"FAHU",value:"FAHU"},{label:"Cooling Tower",value:"Cooling Tower"},{label:"Condenser Pump",value:"Condenser Pump"}],updateParams:{buildingId:null,Assetcategory:null,startTime:NewDateHelper/* default */.Z.getDatePickerObject(22).value[0],endTime:NewDateHelper/* default */.Z.getDatePickerObject(22).value[1]},nameSpace:null,tablererender:!1,visibility:!1,selectcolumn:null,selectedfunction:null,height:"",loading:!0,result:null,elTableResult:[],data:null,tableConfig:{},categoryReading:{Chiller:"chillerreading",AHU:"ahureading",FAHU:"fahureading","Cooling Tower":"coolingtowerreading","Primary Pump":"chillerprimarypumpreading","Secondary Pump":"chillersecondarypumpreading","Condenser Pump":"chillercondenserpumpreading",ALL:null}}},watch:{"config.height":{handler:function(newData,oldData){this.getClientProps()}}},computed:{mode:function(){return!(!this.$route.query||!this.$route.query.create||"edit"!==this.$route.query.create)||!(!this.$route.query||!this.$route.query.create||"new"!==this.$route.query.create)},buildings:function(){return this.data&&this.data.filters&&this.data.filters.outOfScopeBuilding?[{name:"Key Tower A",id:1271170},{name:"Key Tower B",id:1271989},{name:"Scotia Plaza Office",id:1270886},{name:"Scotia Plaza Residence",id:1271017},{name:"YLS Towers",id:1270140}]:[{name:"Heard Building",id:1269536},{name:"Luhrs Tower",id:1270227},{name:"Key Tower A",id:1271170},{name:"Key Tower B",id:1271989},{name:"Scotia Plaza Office",id:1270886},{name:"Scotia Plaza Residence",id:1271017},{name:"YLS Towers",id:1270140},{name:"Azure Building",id:1270641},{name:"Whiteacre Tower",id:1270464},{name:"Bridgestone Tower",id:1270843},{name:"Monroe Tower",id:1269918},{name:"Heron Building",id:1270943}]}},created:function(){this.$store.dispatch("loadBuildings")},mounted:function(){var _this=this;this.loadNameSpaceList(),this.getClientProps(),this.getParams(),this.loadCardData(),this.rerenderdatefilter=!0,this.data.datefilterId&&(this.dateObj=NewDateHelper/* default */.Z.getDatePickerObject(this.data.datefilterId),this.updateParams={buildingId:null,startTime:NewDateHelper/* default */.Z.getDatePickerObject(this.data.datefilterId).value[0],endTime:NewDateHelper/* default */.Z.getDatePickerObject(this.data.datefilterId).value[1],Assetcategory:null}),setTimeout((function(){_this.rerenderdatefilter=!1}),500)},components:{shimmerLoading:ShimmerLoading/* default */.Z,SmartTableSettings:SmartTableSettings/* default */.Z,ConditionalValue:NewConditionalValue/* default */.Z,NewDatePicker:NewDatePicker/* default */.Z},methods:{applyFilter:function(){var updateParams=this.updateParams;this.updateScript(updateParams)},changeDateFilter:function(datefilter){this.updateParams.startTime=datefilter.value[0],this.updateParams.endTime=datefilter.value[1],this.updateScript(this.updateParams)},updateScript:function(params){var _this2=this;this.data.functionId&&(this.selectedfunction=[].concat.apply([],this.nameSpace.map((function(rt){return rt.functions}))).find((function(rt){return rt.id===_this2.data.functionId}))),this.data&&this.data.filters&&this.data.filters.Assetcategory&&this.updateParams.Assetcategory?this.data.workflowV2String='Map test () {\n            params = {};\n            params["startTime"] = '.concat(params.startTime,';\n            params["endTime"] = ').concat(params.endTime,';\n            params["resourceId"] = ').concat(params.buildingId||null,';\n            params["category"] = "').concat(params.Assetcategory||null,'";\n            params["categoryReading"] = "').concat(this.categoryReading[params.Assetcategory]||null,'";\n\n            table = new NameSpace("tabledata");\n            result = table.').concat(this.selectedfunction.name,'(params);\n            log "" + result;\n            return result;\n          }'):this.data.functionId&&this.selectedfunction?this.data.workflowV2String='Map test () {\n        params = {};\n        params["startTime"] = '.concat(params.startTime,';\n        params["endTime"] = ').concat(params.endTime,';\n        params["resourceId"] = ').concat(params.buildingId||null,';\n\n        table = new NameSpace("tabledata");\n        result = table.').concat(this.selectedfunction.name,'(params);\n        log "" + result;\n        return result;\n      }'):this.data.workflowV2String='Map test () {\n        params = {};\n        params["startTime"] = '.concat(params.startTime,';\n        params["endTime"] = ').concat(params.endTime,';\n        params["resourceId"] = ').concat(params.buildingId||null,';\n\n        table = new NameSpace("tabledata");\n        result = table.pmScore(params);\n        log "" + result;\n        return result;\n      }'),this.loadCardData()},getStyleObj:function(value,conditionalFormatting,config){var _this3=this,self=this;if(conditionalFormatting&&conditionalFormatting.length){var style={};return conditionalFormatting.forEach((function(rt){var operator=null;operator=Object.values(self.$constants.OPERATORS[config.datatype]).find((function(rl){return rl.operatorId===rt.critera.operatorId})),operator&&_this3.criteriaValidate(value,rt.critera.value,operator._name,config.datatype)&&(style={color:rt.style.color,"background-color":rt.style.bgcolor},rt.action.blink&&(style.animation="blinker 1s linear infinite"))})),style}return{}},save:function(){var _this4=this;this.setParams(),this.closedialog(),this.tablererender=!0,setTimeout((function(){_this4.tablererender=!1}),150)},closedialog:function(){this.visibility=!1,this.selectcolumn=null},getClientProps:function(){var _this5=this;this.$nextTick((function(){_this5.$el?_this5.height=_this5.$el.clientHeight-110:_this5.height=""}))},setColWidth:function(currentWidth,preWidth,celldata){if(celldata&&celldata.label){var index=this.data.columns.findIndex((function(rt){return rt.label===celldata.label}));this.data.columns[index].width=currentWidth}this.setParams()},refresh:function(){this.getParams(),this.loadCardData()},formatLabel:function(label,config){if(config&&"DATE"===config.datatype){var sec=Number(label);return this.toHHMMSS(sec)}return label},toHHMMSS:function(sec){var sec_num=parseInt(sec,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;// don't forget the second param
return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),hours>1?"00"!==minutes?hours+" hrs "+minutes+" mins":hours+" hrs ":"00"!==seconds?minutes+" mins"+seconds+" secs":minutes+" mins"},objectSpanMethod:function(_ref){_ref.row,_ref.column;var rowIndex=_ref.rowIndex,columnIndex=_ref.columnIndex;return this.tableConfig[columnIndex][rowIndex]},perpareElTableResult:function(result){return result.data?result.data:[]},getData:function(result){this.result=result.result,this.elTableResult=this.perpareElTableResult(result.result),this.getTableOptions(this.elTableResult),this.elTableResult=this.tempFormatingData(this.elTableResult,this.tableConfig)},tempFormatingData:function(result,config){return config[4],result},getTableOptions:function(result){var config={},res=result,mergeRuleList={};this.data.columns.forEach((function(rt,index){config[index]={};var list=[];rt.merge?(rt.mergeKey&&mergeRuleList[rt.mergeKey]?list=mergeRuleList[rt.mergeKey]:result.forEach((function(rl,idx){var cou={};cou["key"]=rl[rt.key],cou["value"]=res.filter((function(rx){return rx[rt.key]===rl[rt.key]})).length,list.findIndex((function(r){return r.key===cou.key}))>-1?list.push({key:rl[rt.key],value:0}):list.push(cou)})),result.forEach((function(rl,idx){var d={rowspan:list[idx].value,colspan:1};config[index][idx]=d}))):result.forEach((function(rl,idx){var d={rowspan:1,colspan:1};config[index][idx]=d})),mergeRuleList[rt.key]=list})),this.tableConfig=config},getParams:function(){this.widget.dataOptions.data?(this.widget.dataOptions.metaJson=JSON.stringify(this.widget.dataOptions.data),this.data=this.widget.dataOptions.data,this.setParams()):this.widget.id>-1&&this.widget.dataOptions.metaJson&&(this.data=JSON.parse(this.widget.dataOptions.metaJson),this.setParams())},setParams:function(){this.data&&!this.data.style?this.data.style={color:this.color,bgcolor:this.bgcolor}:this.style=this.data.style,this.widget.dataOptions.metaJson=JSON.stringify(this.data)},loadCardData:function(){var self=this,params=null;params={workflow:{isV2Script:!0,workflowV2String:this.data.workflowV2String},staticKey:"kpiCard"},this.loading=!0,self.$http.post("dashboard/getCardData",params).then((function(response){if(self.data.columns.find((function(rt){return"outOfSchedule"===rt.key}))){var result=self.specialHandling(response.data.cardResult);self.getData(result)}else if(self.data.columns.find((function(rt){return"outOfSchedulecat"===rt.key}))){var _result=self.specialHandling2(response.data.cardResult);self.getData(_result)}else self.getData(response.data.cardResult);self.loading=!1})).catch((function(error){self.loading=!1}))},specialHandling2:function(result){var _this6=this,data=result.result.data,actualReadingList=null;return data.forEach((function(rt){var readings=[],operatingHours=rt.outOfScheduleRaw.flat();operatingHours.forEach((function(op){readings=rt.readings.flat().filter((function(rl){if(rl.day===op.dayOfWeek&&op.startTimeAsLocalTime&&op.endTimeAsLocalTime&&(op.startTimeAsLocalTime.hour>new Date(rl.ttime).getHours()||new Date(rl.ttime).getHours()>op.endTimeAsLocalTime.hour))return rl}))})),actualReadingList=_this6.calaculateDuration(readings),_this6.$set(rt,"outOfSchedulecat",actualReadingList)})),data=data.filter((function(rt){return null!==rt.outOfSchedulecat})),data.forEach((function(rt,index){rt.a=index+1})),result.data=data,this.$set(result.result,"data",data),result},specialHandling:function(result){var _this7=this,data=result.result.data,actualReadingList=null;return data.forEach((function(rt){var readings=[],operatingHours=rt.outOfScheduleRaw;operatingHours.forEach((function(op){readings=readings.concat(rt.readings).filter((function(rl){if(rl.day===op.dayOfWeek&&op.startTimeAsLocalTime&&op.endTimeAsLocalTime&&(op.startTimeAsLocalTime.hour>new Date(rl.ttime).getHours()||new Date(rl.ttime).getHours()>op.endTimeAsLocalTime.hour))return rl}))})),actualReadingList=_this7.calaculateDuration(readings),_this7.$set(rt,"outOfSchedule",actualReadingList)})),data=data.filter((function(rt){return null!==rt.outOfSchedule})),data.forEach((function(rt,index){rt.a=index+1})),result.data=data,this.$set(result.result,"data",data),result},calaculateDuration:function(readings){if(readings&&readings.length){var durationMins=10,durationMins1=15,durationMins2=20,firstIndex=readings[0].ttime,firstIndexDuration=Number(moment_timezone_default()(firstIndex).format("HHmm")),duration=0;readings.forEach((function(rt,index){var currentTime=Number(moment_timezone_default()(rt.ttime).format("HHmm"));currentTime!==firstIndexDuration&&(currentTime-firstIndexDuration!==durationMins&&currentTime-firstIndexDuration!==durationMins1&&currentTime-firstIndexDuration!==durationMins2||!(rt.runStatus||rt.pumpRunStatus||rt.runstatus)||(duration+=currentTime-firstIndexDuration),firstIndexDuration=Number(moment_timezone_default()(readings[index].ttime).format("HHmm")))}));var hours=duration/60,rhours=Math.floor(hours),minutes=60*(hours-rhours),rminutes=Math.round(minutes);return 0!==duration?rhours+" hour(s) "+rminutes+" minute(s)":null}return null},loadNameSpaceList:function(){var _this8=this;this.$http.get("/v2/workflow/getNameSpaceListWithFunctions").then((function(response){_this8.nameSpace=response.data.result.workflowNameSpaceList?response.data.result.workflowNameSpaceList:[]})).catch((function(){_this8.functions=[]}))}}},v2_SmartTableWrappervue_type_script_lang_js=SmartTableWrappervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(v2_SmartTableWrappervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SmartTableWrapper=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/56800.js.map