"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[94667],{
/***/394667:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return TaxList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/tax/TaxList.vue?vue&type=template&id=a303d402
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100 d-flex flex-direction-column overflow-hidden"},[_c("div",{staticClass:"setting-header2"},[_c("div",{staticClass:"setting-title-block"},[_c("div",{staticClass:"setting-form-title"},[_vm._v(" "+_vm._s(_vm.$t("quotation.common.tax_rates"))+" ")]),_c("div",{staticClass:"heading-description"},[_vm._v(" "+_vm._s(_vm.$t("quotation.common.list_tax_rates"))+" ")])]),_c("div",{staticClass:"fc-multi-dropdown-btn"},[_c("el-dropdown",{attrs:{trigger:"click"},on:{command:function(type){return _vm.openNewTaxForm(type)}}},[_c("el-button",{attrs:{type:"primary"}},[_vm._v(" "+_vm._s(_vm.$t("common._common._new"))),_c("i",{staticClass:"el-icon-arrow-down pL10 font-black"})]),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[_c("el-dropdown-item",{key:"1",attrs:{command:1}},[_vm._v(_vm._s(_vm.$t("quotation.common.tax")))]),_c("el-dropdown-item",{key:"2",attrs:{command:2}},[_vm._v(_vm._s(_vm.$t("quotation.common.tax_group")))])],1)],1)],1)]),_c("div",{staticClass:"m30 mT10 height100"},[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.isLoading,expression:"isLoading"}],ref:"associateTaxTable",staticClass:"setup-tax-table",attrs:{data:_vm.allTaxList,height:"calc(100vh - 170px)","row-key":"index","tree-props":{children:"childTaxes"}}},[_vm._v(" > "),_c("template",{slot:"empty"},[_vm._v(" "+_vm._s(_vm.$t("common._common.no_tax_available"))+" ")]),_c("el-table-column",{attrs:{sortable:"",label:_vm.$t("common.products.tax_name"),prop:"name"}}),_c("el-table-column",{attrs:{sortable:"",label:_vm.$t("common.products.rate"),prop:"rate"}}),_c("el-table-column",{attrs:{sortable:"",label:_vm.$t("common._common.type"),prop:"type"},scopedSlots:_vm._u([{key:"default",fn:function(data){return[_vm._v(" "+_vm._s(_vm._f("pascalCase")(data.row.typeEnum))+" ")]}}])}),_c("el-table-column",{staticClass:"visibility-visible-actions",attrs:{width:"130"},scopedSlots:_vm._u([{key:"default",fn:function(data){return[_c("div",{staticClass:"text-center"},[_c("span",{on:{click:function($event){return _vm.openEditTaxForm(data.row)}}},[_c("inline-svg",{staticClass:"edit-icon-color visibility-hide-actions",attrs:{src:"svgs/edit",iconClass:"icon icon-sm mR5 icon-edit"}})],1)])]}}])})],2)],1),_vm.formVisibility?_c("TaxForm",{attrs:{visibility:_vm.formVisibility,record:_vm.selectedRecord,type:_vm.formType,individualTaxes:_vm.individualTaxes},on:{"update:visibility":function($event){_vm.formVisibility=$event},saved:_vm.loadAllTaxes}}):_vm._e()],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),api=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(538077),__webpack_require__(32284)),TaxFormvue_type_template_id_137b0da5_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-dialog",{attrs:{visible:_vm.visibility,"before-close":_vm.closeForm,"append-to-body":!0,title:"Tax","custom-class":"fc-dialog-center-container f-webform-right-dialog f-webform-center-dialog"},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("div",{staticClass:"height500"},[_vm.isEdit?_c("div",{staticClass:"fc-warning-tag-1 flex-middle justify-content-center mB10"},[_c("inline-svg",{attrs:{src:"svgs/alert",iconClass:"icon text-left icon-sm fill-yellow vertical-text-top"}}),_c("div",{staticClass:"pL10 break-word text-align-center"},[_vm._v(" "+_vm._s(_vm.$t("common.dialog.updating_tax_mark_excisting_inactive"))+" ")])],1):_vm._e(),_c("el-form",{ref:"tax_form",attrs:{model:_vm.taxData,rules:_vm.validationRules,"label-position":"top"}},[_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{staticClass:"mB10",attrs:{prop:"name",label:1===_vm.type?_vm.$t("quotation.common.tax_name"):_vm.$t("quotation.common.tax_group_name"),required:!0}},[_c("el-input",{staticClass:"width100 fc-input-full-border2",attrs:{autofocus:!0},model:{value:_vm.taxData.name,callback:function($$v){_vm.$set(_vm.taxData,"name",$$v)},expression:"taxData.name"}})],1)],1)],1),1===_vm.type?_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{staticClass:"mB10",attrs:{prop:"rate",required:!0,label:_vm.$t("quotation.common.tax_rate")+"(%)"}},[_c("el-input",{staticClass:"width100 fc-input-full-border2",attrs:{type:"number"},model:{value:_vm.taxData.rate,callback:function($$v){_vm.$set(_vm.taxData,"rate",$$v)},expression:"taxData.rate"}})],1)],1)],1):2===_vm.type?_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt pB5"},[_vm._v(" "+_vm._s(_vm.$t("quotation.common.associate_taxes"))+" ")]),_c("el-table",{ref:"associateTaxTable",staticClass:"setup-tax-table",attrs:{data:_vm.individualTaxList,height:"293","empty-text":_vm.$t("common.products.no_taxes_available")},on:{"selection-change":_vm.taxSelectionChange}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{sortable:"",label:_vm.$t("common.products.tax_name"),prop:"name"}}),_c("el-table-column",{attrs:{sortable:"",label:_vm.$t("common.products.rate"),prop:"rate"}})],1)],1)],1):_vm._e()],1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeForm()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{loading:_vm.isSaving,type:"primary"},on:{click:function($event){return _vm.validateData()}}},[_vm._v(_vm._s(_vm.$t("common._common._save")))])],1)])],1)},TaxFormvue_type_template_id_137b0da5_staticRenderFns=[],validation=(__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(670560),__webpack_require__(879288),__webpack_require__(821057),__webpack_require__(450886),__webpack_require__(990260)),TaxFormvue_type_script_lang_js={props:["visibility","record","type","individualTaxes"],data:function(){return{taxData:{name:null,rate:null,childTaxes:[],id:null},isSaving:!1,validationRules:{name:[{required:!0,message:this.$t("common._common.please_enter_tax_name"),trigger:"blur"}]},selectedRecords:[],selectedRecordsId:[],individualTaxList:[]}},mounted:function(){this.individualTaxList=this.$helpers.cloneObject(this.individualTaxes||[]),this.fillData()},computed:{isEdit:function(){return!(0,validation/* isEmpty */.xb)(this.record)}},methods:{fillData:function(){var _this=this;if(1===this.type&&this.$setProperty(this.validationRules,"rate",[{validator:function(rule,value,callback){return _this.validateTaxRate({value:value,callback:callback})},trigger:blur}]),!(0,validation/* isEmpty */.xb)(this.record)){var tax=this.$helpers.cloneObject(this.record);this.$setProperty(this,"taxData.name",tax.name),this.$setProperty(this,"taxData.rate",tax.rate),this.$setProperty(this,"taxData.id",tax.id);var type=tax.type;if(2===type){var childTaxes=tax.childTaxes;this.$nextTick((function(){_this.$refs["associateTaxTable"]&&childTaxes.forEach((function(row){_this.$refs["associateTaxTable"].toggleRowSelection(_this.individualTaxList.find((function(tax){return tax.id===row.id}),!0))}))}))}}},closeForm:function(){this.$emit("update:visibility",!1)},validateData:function(){var _this2=this;this.$refs["tax_form"].validate((function(valid){if(valid){if(2===_this2.type){if(_this2.selectedRecordsId.length<2)return void _this2.$message.error(_this2.$t("common.dialog.select_atleast_two_taxes_to_associate"));_this2.selectedRecordsId.forEach((function(id){return _this2.taxData.childTaxes.push({id:id})}))}_this2.saveData()}else _this2.$message.error("Error Occurred")}))},validateTaxRate:function(_ref){var value=_ref.value,callback=_ref.callback,val=Number(value);!(0,validation/* isNumber */.hj)(val)||val>100||val<0?callback(new Error(this.$t("common.header.please_input_a_valid_rate"))):callback()},taxSelectionChange:function(records){this.selectedRecords=records,this.selectedRecordsId=records.map((function(val){return val.id}))},saveData:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var record,_yield$API$createReco,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return record=_this3.$helpers.cloneObject(_this3.taxData),(0,validation/* isEmpty */.xb)(_this3.type)||(record["type"]=_this3.type),record["isActive"]=!0,_this3.isSaving=!0,_context.next=6,api/* API */.bl.createRecord("tax",{data:record});case 6:_yield$API$createReco=_context.sent,error=_yield$API$createReco.error,error?_this3.$message.error(error.message||_this3.$t("common.wo_report.unable_to_save_tax")):(_this3.$message.success(record.id>0?_this3.$t("common.products.tax_updated_successfully"):_this3.$t("common.products.tax_added_successfully")),_this3.$emit("saved"),_this3.closeForm()),_this3.isSaving=!1;case 10:case"end":return _context.stop()}}),_callee)})))()}}},tax_TaxFormvue_type_script_lang_js=TaxFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(tax_TaxFormvue_type_script_lang_js,TaxFormvue_type_template_id_137b0da5_render,TaxFormvue_type_template_id_137b0da5_staticRenderFns,!1,null,null,null)
/* harmony default export */,TaxForm=component.exports,TaxListvue_type_script_lang_js={components:{TaxForm:TaxForm},data:function(){return{formVisibility:!1,selectedRecord:null,formType:"",allTaxList:[],individualTaxes:[],isLoading:!1}},created:function(){this.loadAllTaxes()},methods:{openNewTaxForm:function(formType){this.selectedRecord=null,this.formType=formType,this.formVisibility=!0},openEditTaxForm:function(record){this.selectedRecord=record,this.formType=record.type,this.formVisibility=!0},loadAllTaxes:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$fetchAll,_yield$API$fetchAll$l,list,error,_error$message,message,index;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.isLoading=!0,_context.next=3,api/* API */.bl.fetchAll("tax",{withCount:!1,viewName:"active"});case 3:_yield$API$fetchAll=_context.sent,_yield$API$fetchAll$l=_yield$API$fetchAll.list,list=void 0===_yield$API$fetchAll$l?[]:_yield$API$fetchAll$l,error=_yield$API$fetchAll.error,error?(_error$message=error.message,message=void 0===_error$message?_this.$t("common._common.error_occured_while_fetching_tax_list"):_error$message,_this.$message.error(message)):(index=1,!(0,validation/* isEmpty */.xb)(list)&&(0,validation/* isArray */.kJ)(list)&&(list.forEach((function(item){_this.$setProperty(item,"index",index++),!(0,validation/* isEmpty */.xb)(item.childTaxes)&&(0,validation/* isArray */.kJ)(item.childTaxes)&&item.childTaxes.forEach((function(child){_this.$setProperty(child,"index",index++)}))})),_this.allTaxList=list,_this.individualTaxes=list.filter((function(t){return 1===t.type})))),_this.isLoading=!1;case 9:case"end":return _context.stop()}}),_callee)})))()},disableTax:function(record){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var recordId,isActive,_yield$API$updateReco,error,message;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return recordId=record.id,isActive=record.isActive,_context2.next=4,api/* API */.bl.updateRecord("tax",{id:recordId,data:{isActive:isActive}});case 4:_yield$API$updateReco=_context2.sent,error=_yield$API$updateReco.error,error?(message=error.message,_this2.$message.error(message)):(_this2.loadAllTaxes(),_this2.$message.success(_this2.$t("common.products.tax_updated_successfully")));case 7:case"end":return _context2.stop()}}),_callee2)})))()}}},tax_TaxListvue_type_script_lang_js=TaxListvue_type_script_lang_js,TaxList_component=(0,componentNormalizer/* default */.Z)(tax_TaxListvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,TaxList=TaxList_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/94667.js.map