"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[47942],{
/***/247942:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FNewAnalyticModularReport}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/analytics/components/FNewAnalyticModularReport.vue?vue&type=template&id=4a06f9d1
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"analytics-section"},[_vm.hideHeader?_vm.showPeriodSelect&&!_vm.noData?_c("div",{staticClass:"chart-icon pointer pB8 el-popover__reference",staticStyle:{"margin-left":"10px",position:"absolute"}},[_vm.showPeriodSelect&&!0!==_vm.serverConfig.isCustomDateField?_c("div",{},[_c("el-select",{staticClass:"period-select width100 fwidget-report-period-select",attrs:{placeholder:_vm.$t("common.products.select_aggregation")},model:{value:_vm.serverConfig.xField.aggr,callback:function($$v){_vm.$set(_vm.serverConfig.xField,"aggr",$$v)},expression:"serverConfig.xField.aggr"}},_vm._l(_vm.timeAggregators,(function(item,itemIdx){return _c("el-option",{key:itemIdx,attrs:{label:item.displayName,value:item.value}})})),1)],1):_vm._e()]):_vm._e():_c("div",{staticClass:"report-graph-header"},[_vm.showDatePicker?_c("div",{staticClass:"new-analytics-filter-section",staticStyle:{"text-align":"center"}},[_c("new-date-picker",{ref:"datePicker",staticClass:"filter-field date-filter-comp",attrs:{zone:_vm.$timezone,dateObj:_vm.dateObj?_vm.dateObj:_vm.serverConfig.dateFilter},on:{date:_vm.setDateFilter}})],1):_vm._e(),_vm.showDatePicker&&!0!==_vm.serverConfig.isCustomDateField?_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border-select2 fR width140px mR50",attrs:{placeholder:_vm.$t("common.products.select_aggregation")},model:{value:_vm.serverConfig.xField.aggr,callback:function($$v){_vm.$set(_vm.serverConfig.xField,"aggr",$$v)},expression:"serverConfig.xField.aggr"}},_vm._l(_vm.timeAggregators,(function(item,itemIdx){return _c("el-option",{key:itemIdx,attrs:{label:item.displayName,value:item.value}})})),1)],1):_vm._e()]),_vm.showUserFilter?_c("div",[_c("ModularUserFilterRender",{attrs:{filterConfiguration:_vm.cloneArray(_vm.serverConfig.userFilters)},on:{emitChangedValue:_vm.setUserFilter}})],1):_vm._e(),_vm.loading?_c("spinner",{staticClass:"analytics-spinner",attrs:{show:_vm.loading,size:"80"}}):_vm.failed?_c("div",{staticStyle:{"margin-top":"30px",opacity:"0.7","font-size":"13px",padding:"50px","line-height":"25px","text-align":"center"}},[_c("div",[_vm._v(_vm._s(_vm.$t("home.dashboard.data_loading_failed")))])]):_vm.noData?_c("div",{staticStyle:{"margin-top":"30px","font-size":"13px",padding:"50px","line-height":"25px","text-align":"center"}},[_c("inline-svg",{attrs:{src:"svgs/emptystate/reportlist",iconClass:"icon text-center icon-100"}}),_c("div",{staticClass:"nowo-label f13"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.empty_data"))+" "),_vm.resultObject&&_vm.resultObject.dateRange?_c("span",{staticClass:"bold"},[_vm._v(_vm._s(_vm._f("formatPeriod")(_vm.resultObject.dateRange.value,"MMM DD, YYYY")))]):_vm._e()])],1):_c("div",[!_vm.serverConfig.hideChart&&_vm.reportObject?_c("div",[_c("div",[_vm.isHeatMap?_c("FNewHeatMap",{ref:"heatmap",attrs:{config:_vm.serverConfig,width:_vm.chartDimensions&&_vm.chartDimensions.width?_vm.chartDimensions.width:null,height:_vm.chartDimensions&&_vm.chartDimensions.height?_vm.chartDimensions.height:null,resultObject:_vm.resultObject,reportObject:_vm.reportObject,hidecharttypechanger:_vm.hidecharttypechanger}}):_vm.isWorkPlaceTreeMap?_c("FWorkPlaceTreeMap",{ref:"workplacetreemap",attrs:{config:_vm.serverConfig,width:_vm.chartDimensions&&_vm.chartDimensions.width?_vm.chartDimensions.width:_vm.$el.clientWidth?_vm.$el.clientWidth:null,height:_vm.chartDimensions&&_vm.chartDimensions.height?_vm.chartDimensions.height:null,resultObject:_vm.resultObject,reportObject:_vm.reportObject}}):_vm.$mobile?_c("f-mobile-chart",{ref:"newChart",attrs:{alarms:null,resultObj:_vm.resultObject,height:_vm.height||null,width:_vm.width||null,data:_vm.reportObject.data,options:_vm.reportObject.options,dateRange:_vm.reportObject.dateRange,mergeOption:_vm.mergeOption,hidecharttypechanger:_vm.hidecharttypechanger}}):_vm._e(),_vm.isHeatMap||_vm.isWorkPlaceTreeMap?_vm._e():_c("f-new-chart",{ref:"newChart",attrs:{showWidgetLegends:!(!_vm.reportObject||!_vm.reportObject.options)&&_vm.reportObject.options.widgetLegend.show,data:_vm.reportObject.data,options:_vm.reportObject.options,alarms:null,dateRange:_vm.reportObject.dateRange,resultObj:_vm.resultObject,height:_vm.height||null,width:_vm.width||null,mergeOption:_vm.mergeOption,hidecharttypechanger:_vm.hidecharttypechanger,isWidget:_vm.isWidget},on:{drilldown:_vm.drilldown}}),!_vm.reportObject||"undefined"!==typeof _vm.hideTabs&&!1!==_vm.hideTabs?_vm._e():_c("div",[!1===_vm.reportObject.options.settings.chart&&!1===_vm.loading&&!1===_vm.failed?_c("modular-new-tabular-report",{ref:"newTable",staticClass:"new-analytics-table",attrs:{reportObject:_vm.resultObject,reportConfig:_vm.reportObject}}):_vm._e(),!0===_vm.reportObject.options.settings.chart&&!1===_vm.loading&&!1===_vm.failed?_c("el-tabs",{staticClass:"report-tab",model:{value:_vm.activeReportTab,callback:function($$v){_vm.activeReportTab=$$v},expression:"activeReportTab"}},[_c("el-tab-pane",{attrs:{label:"Tabular Report",name:"tabular"}},[_vm.serverConfig.hidetabular?_vm._e():_c("modular-new-tabular-report",{ref:"newTable",staticClass:"new-analytics-table",attrs:{moduleName:_vm.module.moduleName,reportObject:_vm.resultObject,reportConfig:_vm.reportObject}})],1),_c("el-tab-pane",{attrs:{label:_vm.$t("home.dashboard.underlying")+" "+_vm.getModuleString,name:"underlying"}},[_c("underlying-workorders",{ref:"underlyingWorkOrders",attrs:{module:_vm.module,reportObject:_vm.reportObject,resultObject:_vm.resultObject}})],1)],1):_vm._e()],1)],1)]):_vm._e()])],1)},staticRenderFns=[],esm_typeof=__webpack_require__(103336),NewDatePicker=(__webpack_require__(434284),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(169358),__webpack_require__(648324),__webpack_require__(506203),__webpack_require__(670560),__webpack_require__(976801),__webpack_require__(900773)),FNewChart=__webpack_require__(875963),FMobileChart=__webpack_require__(242208),FNewHeatMap=__webpack_require__(283938),NewDataFormatHelper=__webpack_require__(804911),ModularNewTabularReport=__webpack_require__(340737),NewDateHelper=__webpack_require__(105534),UnderlyingWorkorders=__webpack_require__(722784),ModularAnalyticmixin=__webpack_require__(795e3),modularUserFilter=__webpack_require__(884900),ModularUserFilterRender=__webpack_require__(955220),FWorkPlaceTreeMapvue_type_template_id_13d4f1bc_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"wp-conatiner",attrs:{id:"wp-conatiner"}},[_vm.data&&_vm.data.children?_c("el-container",{ref:"wp-chart-conatiner",staticClass:"wp-chart-conatiner"},_vm._l(_vm.sortedTreeData,(function(d,index){return _c("div",{key:index,staticClass:"mB20 ct-continer"},[_vm.data.children.length>1?_c("div",{key:"name-"+index,staticClass:"treemap-floor-header self-center",on:{click:function($event){return _vm.getFloor(d.key)}}},[_c("div",{staticClass:"justify-content-space flex-middle"},[_c("div",[_vm._v(" "+_vm._s(""+d.name)+" ")]),_c("span",{staticClass:"f13 wp-secondary-text-color"},[_c("inline-svg",{staticStyle:{top:"2px"},attrs:{src:"svgs/desk2",iconClass:"icon text-center fp-icon-inside icon-sm"}}),_vm._v(_vm._s(d.totalDesk)+" ")],1)])]):_vm._e(),_vm.renderTreeMap?_c("FNewTreeMap",{key:index,attrs:{data:d,width:_vm.clientWidth,height:_vm.treemapHeight,options:_vm.options},on:{floor:_vm.getFloor,rendred:function(){return _vm.treeMapRendred(index)}}}):_vm._e()],1)})),0):_vm._e()],1)},FWorkPlaceTreeMapvue_type_template_id_13d4f1bc_scoped_true_staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),FNewTreeMapvue_type_template_id_5522fc20_render=(__webpack_require__(947522),__webpack_require__(879288),__webpack_require__(634338),__webpack_require__(865137),function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"F-New-Treemap",attrs:{id:"TreeMap_"+_vm.getRandomInt}})}),FNewTreeMapvue_type_template_id_5522fc20_staticRenderFns=[],d3=(__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(348727)),tooltip=__webpack_require__(460895),uuid=__webpack_require__(455877),FNewTreeMapvue_type_script_lang_js={props:["data","width","height","options"],mounted:function(){this.draw(),this.$emit("rendred")},computed:{getRandomInt:function(){return(0,uuid.v4)()},sizeBasedSort:function(){var _this$options;return!(null===(_this$options=this.options)||void 0===_this$options||null===(_this$options=_this$options.sort)||void 0===_this$options||!_this$options.size)},showHeader:function(){var _this$options2;return null===(_this$options2=this.options)||void 0===_this$options2||!_this$options2.hideHeader},tileName:function(){var _this$options3;return null!==(_this$options3=this.options)&&void 0!==_this$options3&&_this$options3.tileName?this.options.tileName:"treemapResquarify"},showTooltip:function(){return this.options.showTooltip}},methods:{getContrastYIQ:function(hexcolor){if(hexcolor.indexOf("#")<0)return"#324049";hexcolor=hexcolor.replace("#","");var r=parseInt(hexcolor.substr(0,2),16),g=parseInt(hexcolor.substr(2,2),16),b=parseInt(hexcolor.substr(4,2),16),yiq=(299*r+587*g+114*b)/1e3;return yiq>=128?"#324049":"#fff"},parentMouseOver:function(){},onclickHandle:function(d){var _d$parent;null!==d&&void 0!==d&&null!==(_d$parent=d.parent)&&void 0!==_d$parent&&null!==(_d$parent=_d$parent.data)&&void 0!==_d$parent&&_d$parent.key&&this.$emit("floor",d.parent.data.key)},childMouseOver:function(d){var _d$data,tooltipData=[{label:d.data.mode,value:d.id},{label:d.data.sizePoint,value:d.value}],tooltipConfig={position:{left:d3.event.pageX,top:d3.event.pageY},data:tooltipData,color:null!==(_d$data=d.data)&&void 0!==_d$data&&_d$data.color?d.data.color:"gray"};this.showTooltip&&tooltip/* default */.Z.showTooltip(tooltipConfig)},specialHandle:function(data){
// empty data should come in last so we ingnored the size is alway in last
var newChildren=[],emptyChildren={};return null!==data&&void 0!==data&&data.children&&(data.children.forEach((function(rt){-1!==rt.key?newChildren.push(rt):emptyChildren=rt})),this.$set(this.data,"children",[].concat(newChildren,[emptyChildren]))),data},draw:function(){var data=this.data,height=this.height,width=this.width,tileName=this.tileName;data=this.specialHandle(data);var transitioning,treemap,svg,grandparent,self=this,margin={top:0,right:0,bottom:0,left:0},formatNumber=d3.format(",d"),x=d3.scaleLinear().domain([0,width]).range([0,width]),y=d3.scaleLinear().domain([0,height-margin.top-margin.bottom]).range([0,height-margin.top-margin.bottom]);function updateDrillDown(){if(svg)svg.selectAll("*").remove();else{var svgWidth=width-margin.left-margin.right;svg=d3.select("#TreeMap_".concat(self.getRandomInt)).append("svg").attr("width",svgWidth).attr("height",height-margin.bottom-margin.top).style("margin-left",-margin.left+"px").style("margin.right",-margin.right+"px").append("g").attr("transform","translate("+margin.left+","+margin.top+")").style("shape-rendering","crispEdges"),self.showHeader&&(grandparent=svg.append("g").attr("class","fc-grandparent"),grandparent.append("rect").attr("y",-margin.top).attr("width",width).attr("height",margin.top),grandparent.append("text").attr("x",6).attr("y",6-margin.top).attr("dy",".75em")),treemap=d3.treemap(),"treemapResquarify"===tileName?treemap.tile(d3[tileName].ratio(height/width*.5*(1+Math.sqrt(5)))):treemap.tile(d3[tileName]),treemap.size([width,height]).round(!1).paddingInner(1)}var root=d3.hierarchy(data).eachBefore((function(d){
// d.id = (d.parent ? d.parent.id + ' > ' : '') + d.data.name
d.id=d.data.name})).sum((function(d){return d.value}));self.sizeBasedSort&&root.sort((function(a,b){return b.height-a.height||b.value-a.value})),initialize(root),accumulate(root),layout(root),treemap(root),display(root)}function initialize(root){root.x=root.y=0,root.x1=width,root.y1=height,root.depth=0}
// Aggregate the values for internal nodes. This is normally done by the
// treemap layout, but not here because of our custom implementation.
// We also take a snapshot of the original children (_children) to avoid
// the children being overwritten when when layout is computed.
function accumulate(d){
// eslint-disable-next-line no-cond-assign
return(d._children=d.children)?d.value=d.children.reduce((function(p,v){return p+accumulate(v)}),0):d.value}
// Compute the treemap layout recursively such that each group of siblings
// uses the same size (1×1) rather than the dimensions of the parent cell.
// This optimizes the layout for the current zoom state. Note that a wrapper
// object is created for the parent node for each group of siblings so that
// the parent’s dimensions are not discarded as we recurse. Since each group
// of sibling was laid out in 1×1, we must rescale to fit using absolute
// coordinates. This lets us use a viewport to zoom.
function layout(d){d._children&&d._children.forEach((function(c){c.x0=d.x0+c.x0*d.x1,c.y0=d.y0+c.y0*d.y1,c.x1*=d.x1-d.x0,c.y1*=d.y1-d.y0,c.parent=d,layout(c)}))}function display(d){self.showHeader&&grandparent.datum(d.parent).on("click",transition).on("mouseover",(function(data1){self.parentMouseOver(data1)})).select("text").text(name(d));var g1=svg.insert("g",".grandparent").datum(d).attr("class","depth"),g=g1.selectAll("g").data(d._children).enter().append("g");g.filter((function(d){return d._children})).classed("children",!0).on("click",transition).on("mouseover",(function(child){self.parentMouseOver(child)}));var children=g.selectAll(".child").data((function(d){return d._children||[d]})).enter().append("g");children.append("rect").attr("class","child").call(rect).append("title").text((function(d){return d.data.name+" ("+formatNumber(d.value)+")"})),children.append("text").attr("class","ctext").text((function(d){return d.data.name})).call(text2),g.append("rect").attr("class","parent").call(rect);var t=g.append("text").attr("class","ptext").attr("dy",".75em").style("fill",(function(d){var _d$data2;return null!==(_d$data2=d.data)&&void 0!==_d$data2&&_d$data2.color?self.getContrastYIQ(d.data.color):"#d9d9d9"}));function transition(d){if(!transitioning&&d){transitioning=!0;var g2=display(d),t1=g1.transition().duration(750),t2=g2.transition().duration(750);
// Update the domain only after entering new elements.
//x.domain([d.x0, d.x0 + d.x1]);
//y.domain([d.y0, d.y0 + d.y1]);
x.domain([d.x0,d.x0+(d.x1-d.x0)]),y.domain([d.y0,d.y0+(d.y1-d.y0)]),
// Enable anti-aliasing during the transition.
svg.style("shape-rendering",null),
// Draw child nodes on top of parent nodes.
svg.selectAll(".depth").sort((function(a,b){return a.depth-b.depth})),
// Fade-in entering text.
g2.selectAll("text").style("fill-opacity",0),
// Transition to the new view.
t1.selectAll(".ptext").call(text).style("fill-opacity",0).style("fill",(function(d){var _d$data4;return null!==(_d$data4=d.data)&&void 0!==_d$data4&&_d$data4.color?d.data.color:"#d9d9d9"})),t2.selectAll(".ptext").call(text).style("fill-opacity",1).style("fill",(function(d){var _d$data5;return null!==(_d$data5=d.data)&&void 0!==_d$data5&&_d$data5.color?d.data.color:"#d9d9d9"})),t1.selectAll(".ctext").call(text2).style("fill-opacity",0).style("fill",(function(d){var _d$data6;return null!==(_d$data6=d.data)&&void 0!==_d$data6&&_d$data6.color?d.data.color:"#d9d9d9"})),t2.selectAll(".ctext").call(text2).style("fill-opacity",1).style("fill",(function(d){var _d$data7;return null!==(_d$data7=d.data)&&void 0!==_d$data7&&_d$data7.color?d.data.color:"#d9d9d9"})),t1.selectAll("rect").call(rect),t2.selectAll("rect").call(rect),
// Remove the old node when the transition is finished.
t1.remove().on("end",(function(){svg.style("shape-rendering","crispEdges"),transitioning=!1}))}}return t.append("tspan").text((function(d){return d.data.name})),t.append("tspan").attr("dy","1.2em").text((function(d){return formatNumber(d.value)})),t.call(text),g.selectAll("rect").style("fill",(function(d){var _d$data3;return null!==(_d$data3=d.data)&&void 0!==_d$data3&&_d$data3.color?d.data.color:"#d9d9d9"})).on("mouseover",(function(childs){self.childMouseOver(childs)})).on("click",(function(childs){self.onclickHandle(childs)})).on("mouseout",(function(){tooltip/* default */.Z.hideTooltip()})),g}function text(text){text.selectAll("tspan").attr("x",(function(d){return x(d.x0)+6})),text.attr("x",(function(d){return x(d.x0)+6})).attr("y",(function(d){return y(d.y0)+3})).style("opacity",(function(d){var w=x(d.x1)-x(d.x0);return this.getComputedTextLength()<w-6?1:0}))}function text2(text){text.attr("x",(function(d){return x(d.x1)-this.getComputedTextLength()-6})).attr("y",(function(d){return y(d.y1)-6})).style("opacity",(function(d){var w=x(d.x1)-x(d.x0);return this.getComputedTextLength()<w-6?1:0}))}function rect(rect){rect.attr("x",(function(d){return x(d.x0)})).attr("y",(function(d){return y(d.y0)})).attr("width",(function(d){var w=x(d.x1)-x(d.x0);return w})).attr("height",(function(d){var h=y(d.y1)-y(d.y0);return h}))}function name(d){var _d$data8,_d$data9;return d.parent?name(d.parent)+" / "+(null!==(_d$data8=d.data)&&void 0!==_d$data8&&_d$data8.name?d.data.name:"")+" ("+formatNumber(d.value)+")":(null!==(_d$data9=d.data)&&void 0!==_d$data9&&_d$data9.name?d.data.name:"")+" ("+formatNumber(d.value)+")"}updateDrillDown()}}},components_FNewTreeMapvue_type_script_lang_js=FNewTreeMapvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FNewTreeMapvue_type_script_lang_js,FNewTreeMapvue_type_template_id_5522fc20_render,FNewTreeMapvue_type_template_id_5522fc20_staticRenderFns,!1,null,null,null)
/* harmony default export */,FNewTreeMap=component.exports,api=__webpack_require__(32284),ReportDataUtil=__webpack_require__(760396),eventBus=__webpack_require__(398011),vuex_esm=__webpack_require__(420629),router=__webpack_require__(329435),orderBy=__webpack_require__(875472),orderBy_default=__webpack_require__.n(orderBy),FWorkPlaceTreeMapvue_type_script_lang_js={mixins:[ReportDataUtil/* default */.Z],props:["resultObject","reportObject","config","width","height"],components:{FNewTreeMap:FNewTreeMap},created:function(){this.$store.dispatch("loadTicketStatus","desks")},data:function(){return{departments:[],renderTreeMap:!1,data:null,switchcomp:!1,clientHeight:500,clientWidth:500,departmentInfo:{},children:[],sortedChildren:[],floorsList:[],tilesList:[{label:"Resquarify tree",value:"treemapResquarify"},{label:"Binary tree",value:"treemapBinary"},{label:"Dice tree",value:"treemapDice"},{label:"Slice tree",value:"treemapSlice"},{label:"Slice Dice tree",value:"treemapSliceDice"}]}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getTicketStatus"])),{},{sortedTreeData:function(){var _this=this,data=[];return this.data.children.forEach((function(d){var sortedlist=orderBy_default()(d.children,["value"],["desc"]),newData=d;_this.$set(newData,"children",sortedlist),data.push(newData)})),data},treemapHeight:function(){var _this$data,offset=20;if(null!==(_this$data=this.data)&&void 0!==_this$data&&_this$data.children&&this.data.children.length){var hight=this.clientHeight/this.data.children.length,finalheight=hight-offset;return finalheight>57?finalheight:57}return 100-offset},querryTileName:function(){var _this$$route;return(null===(_this$$route=this.$route)||void 0===_this$$route||null===(_this$$route=_this$$route.query)||void 0===_this$$route?void 0:_this$$route.tile)||"treemapBinary"},floorVsLevels:function(){var _this2=this,levels={};return this.floorsList.forEach((function(rt){_this2.$set(levels,rt.id,rt.floor.floorlevel)})),levels},options:function(){return{hideHeader:!0,tileName:this.querryTileName,showTooltip:!!this.floorId}},buildingId:function(){var _this$$route2;return null!==(_this$$route2=this.$route)&&void 0!==_this$$route2&&null!==(_this$$route2=_this$$route2.params)&&void 0!==_this$$route2&&_this$$route2.buildingId?Number(this.$route.params.buildingId):null},floorId:function(){var _this$$route3;return null!==(_this$$route3=this.$route)&&void 0!==_this$$route3&&null!==(_this$$route3=_this$$route3.params)&&void 0!==_this$$route3&&_this$$route3.floorId?Number(this.$route.params.floorId):null},colorMap:function(){var _this3=this,dataMap={};return this.departments&&this.departments.length&&this.departments.forEach((function(rt){_this3.$set(dataMap,rt.id,rt.color)})),dataMap}}),mounted:function(){this.init()},methods:{loadFloor:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var buildingId,floorId,filter,url,params,_yield$API$get,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(buildingId=_this4.buildingId,floorId=_this4.floorId,!buildingId||floorId){_context.next=10;break}return filter={building:{operatorId:36,value:[buildingId+""]},indoorFloorPlanId:{operatorId:2}},url="/v2/module/data/list",params={moduleName:"floor",viewName:"hidden-all",orderBy:"floorlevel",orderType:"desc",filters:JSON.stringify(filter)},_context.next=7,api/* API */.bl.get(url,params);case 7:_yield$API$get=_context.sent,data=_yield$API$get.data,data&&(_this4.floorsList=data.moduleDatas);case 10:case"end":return _context.stop()}}),_callee)})))()},sortedChildrenList:function(children){var newChildrenList=[];return this.floorsList.forEach((function(floor){var dataChild=children[floor.id];dataChild&&newChildrenList.push(dataChild)})),newChildrenList},treeMapRendred:function(index){this.data.children.length-1===index&&eventBus/* eventBus */.Y.$emit("heatmapLoaded",{departmentInfo:this.departmentInfo})},findRoute:function(){if((0,router/* isWebTabsEnabled */.tj)()){var tabType=router/* tabTypes */.VF.CUSTOM,config={type:"workplace-analytics"},_ref=(0,router/* findRouteForTab */.OD)(tabType,{config:config})||{},name=_ref.name;return name?this.$router.resolve({name:name}).href:null}return"/app/wp/workplacetreemap"},getFloor:function(floorId){var parentPath=this.findRoute();parentPath&&this.$router.push({path:"".concat(parentPath,"/").concat(this.buildingId,"/").concat(floorId)})},aggValue:function(children){var _this5=this,value=0;return children&&children.length&&children.forEach((function(rt){rt.children?value=_this5.aggValue(rt.children):value+=rt.value})),value},switchCompoent:function(){this.switchcomp=!this.switchcomp},prepareData:function(){var _this6=this;return new Promise((function(resolve){if(
/// to be removed
// eslint-disable-next-line vue/no-mutating-props
_this6.reportObject.options.type="treemap",_this6.data=_this6.formatToWorkplaceTreeMap(_this6.resultObject.reportData.data),_this6.floorId){var _data=_this6.sortedData(_this6.data.children).reverse();_this6.data.children=_this6.$helpers.cloneObject(_data)}else{_this6.children={},_this6.data.children.forEach((function(child){_this6.$set(_this6.children,child.key,child)}));var data=_this6.sortedChildrenList(_this6.children).reverse();_this6.data.children=_this6.$helpers.cloneObject(data)}_this6.$set(_this6.reportObject,"treeMapData",_this6.data),resolve()}))},sortedData:function(items){return items.sort((function(a,b){return a.key-b.key}))},getLookupMap:function(resultObject){var _resultObject$report,result={};if(null!==resultObject&&void 0!==resultObject&&null!==(_resultObject$report=resultObject.report)&&void 0!==_resultObject$report&&_resultObject$report.dataPoints&&resultObject.report.dataPoints.length){var _dataPoint$xAxis,dataPoint=resultObject.report.dataPoints[0];null!==dataPoint&&void 0!==dataPoint&&null!==(_dataPoint$xAxis=dataPoint.xAxis)&&void 0!==_dataPoint$xAxis&&_dataPoint$xAxis.lookupMap&&(result["X"]=dataPoint.xAxis.lookupMap),null!==dataPoint&&void 0!==dataPoint&&dataPoint.groupByFields&&dataPoint.groupByFields.length&&dataPoint.groupByFields.forEach((function(rt){rt.lookupMap&&(result[rt.alias]=rt.lookupMap)}))}return result},formatToWorkplaceTreeMap:function(data){var _this7=this,lookupMap=this.getLookupMap(this.resultObject),occupiedList=[],departmentInfo=this.departmentInfo;
//value = (this.getTicketStatus(id, 'asset') || {}).displayName
return data.forEach((function(floor){var dep=floor.department;if(dep){var occupiedDataMap={},occupiedData=[],vacantMap={},vacentCount=0,vacantData=[],totalDesk=0;_this7.$set(departmentInfo,floor.X,{}),dep.forEach((function(rt){var departmentId=rt.department;""===departmentId&&(departmentId=-1);var d=departmentInfo[floor.X][departmentId];if(d||_this7.$set(departmentInfo[floor.X],departmentId,{}),rt.moduleState&&rt.moduleState.length&&rt.moduleState[0]){var moduleStateData=rt.moduleState[0];"Occupied"===lookupMap["moduleState"][moduleStateData.moduleState]?(_this7.$set(occupiedDataMap,departmentId,{value:moduleStateData.Id}),_this7.$set(departmentInfo[floor.X],departmentId,(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},d),{occupied:moduleStateData.Id})),-1===departmentId?occupiedData.push({name:"No department",key:-2,value:moduleStateData.Id,color:"#000",sizePoint:"Number of Desks",mode:"Department"}):occupiedData.push({name:lookupMap["department"]?lookupMap["department"][departmentId]:"No department",key:departmentId,value:moduleStateData.Id,color:_this7.colorMap[departmentId]||"#000",sizePoint:"Number of Desks",mode:"Department"})):"Vacant"===lookupMap["moduleState"][moduleStateData.moduleState]&&(_this7.$set(vacantMap,departmentId,{value:moduleStateData.Id}),_this7.$set(departmentInfo[floor.X],departmentId,(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},d),{vacant:moduleStateData.Id})),vacentCount+=moduleStateData.Id,vacantData.push({name:lookupMap["department"]?lookupMap["department"][departmentId]:"",key:departmentId,value:moduleStateData.Id,color:_this7.colorMap[departmentId]||"#d9d9d9",sizePoint:"Number of Desks",mode:"Department"})),totalDesk+=moduleStateData.Id}})),occupiedData.push({name:"Empty",key:-1,value:vacentCount,color:"#d9d9d9",sizePoint:"Number of Desks",mode:"Department"}),occupiedList.push({name:lookupMap["X"][floor.X],key:floor.X,totalDesk:totalDesk,children:occupiedData})}})),{name:"No of Desks",children:occupiedList}},init:function(){var _this8=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_this8.loadFloor();case 2:return _this8.calClientHeight(),_this8.calClientWidth(),_context2.next=6,_this8.loadDepartment();case 6:return _context2.next=8,_this8.prepareData();case 8:return _context2.next=10,_this8.render();case 10:case"end":return _context2.stop()}}),_callee2)})))()},calClientHeight:function(){var _document$getElementB;this.clientHeight=null!==(_document$getElementB=document.getElementById("wp-conatiner"))&&void 0!==_document$getElementB&&_document$getElementB.clientHeight?document.getElementById("wp-conatiner").clientHeight:500},calClientWidth:function(){var _document$getElementB2;this.clientWidth=null!==(_document$getElementB2=document.getElementById("wp-conatiner"))&&void 0!==_document$getElementB2&&_document$getElementB2.clientWidth?document.getElementById("wp-conatiner").clientWidth:500},render:function(){var _this9=this;return new Promise((function(resolve){_this9.renderTreeMap=!1,_this9.$nextTick((function(){_this9.renderTreeMap=!0,resolve()}))}))},getMode:function(mode){switch(parseInt(mode)){case 4:return"Time";case 6:return"Site";case 7:return"Building";case 8:return"Asset";default:return""}},loadDepartment:function(){var _this10=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var params;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return params={moduleName:"department"},_context3.next=3,api/* API */.bl.get("v2/module/data/list",params).then((function(_ref2){var data=_ref2.data;data&&(_this10.departments=data.moduleDatas)}));case 3:return _context3.abrupt("return",_context3.sent);case 4:case"end":return _context3.stop()}}),_callee3)})))()}}},workplaceAnalytics_FWorkPlaceTreeMapvue_type_script_lang_js=FWorkPlaceTreeMapvue_type_script_lang_js,FWorkPlaceTreeMap_component=(0,componentNormalizer/* default */.Z)(workplaceAnalytics_FWorkPlaceTreeMapvue_type_script_lang_js,FWorkPlaceTreeMapvue_type_template_id_13d4f1bc_scoped_true_render,FWorkPlaceTreeMapvue_type_template_id_13d4f1bc_scoped_true_staticRenderFns,!1,null,"13d4f1bc",null)
/* harmony default export */,FWorkPlaceTreeMap=FWorkPlaceTreeMap_component.exports,validation=__webpack_require__(990260),deepmerge=__webpack_require__(708634),FNewAnalyticModularReportvue_type_script_lang_js={props:["serverConfig","baseLines","module","reportid","savedReport","height","width","mergeOption","hideTabs","defaultChartType","hideHeader","hidecharttypechanger","config","isWidget","showPeriodSelect","hideUserFilter"],mixins:[NewDataFormatHelper/* default */.Z,ModularAnalyticmixin/* default */.Z,modularUserFilter/* default */.Z],components:{NewDatePicker:NewDatePicker/* default */.Z,FNewChart:FNewChart/* default */.Z,
// FMultiChart,
ModularNewTabularReport:ModularNewTabularReport/* default */.Z,FMobileChart:FMobileChart/* default */.Z,
// FChartSettings,
ModularUserFilterRender:ModularUserFilterRender/* default */.Z,UnderlyingWorkorders:UnderlyingWorkorders/* default */.Z,FNewHeatMap:FNewHeatMap/* default */.Z,FWorkPlaceTreeMap:FWorkPlaceTreeMap},data:function(){return{moduleName:null,moduleDisplayName:null,moduleId:null,moduleResourceField:null,dateObj:null,showDatePicker:!1,showTabularReport:!0,loading:!0,
// dateField: {},
failed:!1,reportObject:null,noData:!1,resultObject:null,activeReportTab:"tabular",chartDimensions:{width:980,height:800},timeAggregators:[{displayName:this.$t("common.wo_report.high_res"),label:"highres",value:0,selected:!1,field_Id:0},{displayName:this.$t("common.wo_report.hourly"),label:"hourly",value:20,selected:!1,field_Id:1},{displayName:this.$t("common._common.daily"),label:"daily",value:12,selected:!1,field_Id:2},{displayName:this.$t("common._common.weekly"),label:"weekly",value:11,selected:!1,field_Id:3},{displayName:this.$t("common._common.monthly"),label:"monthly",value:10,selected:!1,field_Id:4},{displayName:this.$t("common.products.quarterly"),label:"quarterly",value:25,selected:!1,field_Id:5},{displayName:this.$t("common.header.hour_of_day"),label:"hour_of_day",value:19,selected:!1,field_Id:7},{displayName:this.$t("common.header.day_of_week"),label:"day_of_week",value:17,selected:!1,field_Id:8},{displayName:this.$t("common.header.day_of_month"),label:"day_of_month",value:18,selected:!1,field_Id:6}]}},created:function(){this.module&&(this.moduleName=this.module["moduleName"],this.moduleDisplayName=this.module["moduleDisplayName"],this.moduleId=this.module["moduleId"],this.moduleResourceField=this.module["resourceField"])},mounted:function(){"undefined"!==typeof this.reportid&&null!==this.reportid?this.loadFromReportId():this.init()},watch:{serverConfig:{handler:function(newData,oldData){this.initApiCall()},deep:!0},isHeatMap:{handler:function(newData,oldData){newData!==oldData&&this.initApiCall()},immediate:!0}},computed:{showUserFilter:function(){var serverConfig=this.serverConfig,hideUserFilter=this.hideUserFilter;return!hideUserFilter&&!(null===serverConfig||void 0===serverConfig||!serverConfig.userFilters||0===serverConfig.userFilters.length)},isHeatMap:function(){return!(!this.reportObject||!this.reportObject.options||"heatmap"!=this.reportObject.options.type)},isWorkPlaceTreeMap:function(){var _this$reportObject;return!(!this.defaultChartType||"treemap"!==this.defaultChartType)||!(null===(_this$reportObject=this.reportObject)||void 0===_this$reportObject||null===(_this$reportObject=_this$reportObject.options)||void 0===_this$reportObject||!_this$reportObject.type||"treemap"!=this.reportObject.options.type)},isGroupByCrossModule:function(){if(null!==this.resultObject.report.dataPoints[0].groupByFields){var groupField=this.resultObject.report.dataPoints[0].groupByFields[0];return!(groupField.field.module.name===this.resultObject.report.module.name||this.resultObject.report.module.extendModule&&groupField.field.module.name===this.resultObject.report.module.extendModule.name)}return!1},isXFieldCrossModule:function(){var xAxis=this.resultObject.report.dataPoints[0].xAxis;return!(xAxis.field.module.name===this.resultObject.report.module.name||this.resultObject.report.module.extendModule&&xAxis.field.module.name===this.resultObject.report.module.extendModule.name)},getModuleString:function(){var _this=this;if(this.resultObject.report.module&&this.resultObject.report.module.name&&"newreadingalarm"===this.resultObject.report.module.name)return"Alarms";if(-1!==this.resultObject.report.moduleType&&this.resultObject.moduleTypes&&0!==this.resultObject.moduleTypes.length){var moduleName=this.resultObject.moduleTypes.filter((function(type){return type.type===_this.resultObject.report.moduleType}))[0].displayName;return moduleName}return null!==this.moduleDisplayName?this.moduleDisplayName:this.resultObject.report.module.name+"s"}},methods:{cloneArray:function(arrayToClone){return Array.isArray(arrayToClone)?JSON.parse(JSON.stringify(arrayToClone)):[]},setUserFilter:function(val){this.$set(this.serverConfig,"userFilters",val)},drilldown:function(val){this.$servicePortal||this.isXFieldCrossModule||this.isGroupByCrossModule||this.handleBasicDrillDown(val,this.resultObject,this.reportObject)},setDateFilter:function(dateFilter){if(this.serverConfig.xField&&"undefined"!==typeof this.showDatePicker&&!0===this.showDatePicker){this.dateObj=dateFilter;var dateField={};dateField["operator"]=dateFilter.operatorId,dateField["field_id"]=!0===this.serverConfig.isTime?this.serverConfig.xField.field_id:this.serverConfig.dateField.field_id,!0===this.serverConfig.isTime&&!0===this.serverConfig.xField.nullFieldId?(dateField["fieldName"]=dateField.field_id,dateField["field_id"]=-1):!1===this.serverConfig.isTime&&-1===dateField.field_id&&(dateField["fieldName"]=this.serverConfig.dateField.fieldName),dateField["module_id"]=!0===this.serverConfig.isCustomDateField?this.module.meta.fieldMeta.customDateField:this.module.meta.fieldMeta.xField,49===dateFilter.operatorId||50===dateFilter.operatorId||51===dateFilter.operatorId?dateField["date_value"]=Math.abs(dateFilter.offset)+"":20===dateFilter.operatorId?dateField["date_value"]=dateFilter.value.join(","):dateField["date_value"]=dateFilter.value[0]+"",this.$set(this.serverConfig,"dateField",dateField)}else this.$set(this.serverConfig,"dateField",null)},init:function(){this.initApiCall()},resize:function(){this.$refs["newChart"]&&this.$refs["newChart"].resize(),this.$refs["multiChart"]&&this.$refs["multiChart"].resize(),this.$refs["newTable"]&&this.$refs["newTable"].resize()},loadFromReportId:function(){var _this2=this;this.loading=!0,this.failed=!1,this.noData=!1,this.reportid&&api/* API */.bl.put("/v3/report/execute",{reportId:parseInt(this.reportid),moduleName:this.moduleName}).then((function(_ref){var data=_ref.data;
// if (response.data.result.reportData.data.length === 0) {
//   this.noData = true
//   this.loading = false
// } else {
_ref.error;if(data.error)_this2.loading=!1,_this2.failed=!0;else{var result=_this2.specialHandler(data),dateOperator=result.report.dateOperator,datePickerObject=null;
// time handling for report (special handling)
-1!==dateOperator&&(datePickerObject=NewDateHelper/* default */.Z.getDatePickerObject(dateOperator,result.report.dateValue)),datePickerObject&&(result.dateRange=datePickerObject);var report=_this2.prepareReport(result);report["report"]=result.report,// added for emailReportDependency
report.options.type||(report.options.type="bar"),
// this.showDatePicker = true
_this2.loading=!1,_this2.$emit("reportLoaded",null,result)}}))},initApiCall:function(){var _this3=this;this.loading=!0,this.failed=!1;var chartType=null;this.$refs["underlyingWorkOrders"]&&this.$refs["underlyingWorkOrders"].rerender(),this.reportObject&&"heatmap"===this.reportObject.options.type&&(!1===this.serverConfig.isTime||this.serverConfig.groupBy&&!(0,validation/* isEmpty */.xb)(this.serverConfig.groupBy))&&(this.reportObject.options.type="bar"),this.reportObject?chartType=this.reportObject.options.type:(0,validation/* isEmpty */.xb)(this.defaultChartType)||(chartType=this.defaultChartType),!0===this.serverConfig.isCustomDateField||!0===this.serverConfig.isTime?this.showDatePicker=!0:this.showDatePicker=!1;var baselines,woparams={xField:this.serverConfig.xField,yField:this.serverConfig.yField?this.serverConfig.yField:null,dateField:this.serverConfig.dateField&&(this.serverConfig.isTime||this.serverConfig.isCustomDateField)?this.serverConfig.dateField:null,groupBy:this.serverConfig.groupBy?this.serverConfig.groupBy:null,criteria:this.serverConfig.criteria?this.serverConfig.criteria:null,having:this.serverConfig.having?this.serverConfig.having:null,sortFields:this.serverConfig.sortFields?this.serverConfig.sortFields:null,sortOrder:this.serverConfig.sortOrder?this.serverConfig.sortOrder:null,limit:this.serverConfig.limit?this.serverConfig.limit:null,userFilters:this.serverConfig.userFilters?this.serverConfig.userFilters:null,moduleType:this.serverConfig.moduleType?this.serverConfig.moduleType:null,moduleName:this.$helpers.isLicenseEnabled("NEW_ALARMS")&&"alarm"===this.moduleName?"alarmoccurrence":this.moduleName};if(this.serverConfig.baseLine&&Array.isArray(this.serverConfig.baseLine)&&this.serverConfig.baseLine.length){if(this.serverConfig.baseLine[0]>0){var bl={};bl.baseLineId=this.serverConfig.baseLine[0],this.serverConfig.baseLine.length>1&&(bl.adjustType=this.serverConfig.baseLine[1]);var blList=[];blList.push(bl),baselines=blList}}else this.serverConfig.baseLine&&this.serverConfig.baseLine>0&&(baselines=[{baseLineId:this.serverConfig.baseLine}]);baselines&&(woparams.baseLines=JSON.stringify(baselines)),210===this.$org.id&&woparams.dateField&&[541010,541011].includes(woparams.dateField.field_id)&&(woparams.dateField["allowFutureData"]=!0),this.reportObject&&this.reportObject.options?woparams.chartState=JSON.stringify(this.reportObject.options):this.savedReport&&this.savedReport.chartState&&"heatmap"===this.savedReport.chartState.type&&(woparams.chartState=JSON.stringify(this.savedReport.chartState)),woparams.moduleName&&api/* API */.bl.post("/v3/report/fetch_data",woparams,{force:!0}).then((function(resp,error){var _this3$reportObject,_this3$savedReport;null!==_this3.moduleDisplayName&&resp&&resp.data&&(resp.data.moduleDisplayName=_this3.moduleDisplayName);var report_chart_state=null;null!==_this3&&void 0!==_this3&&null!==(_this3$reportObject=_this3.reportObject)&&void 0!==_this3$reportObject&&_this3$reportObject.options&&(report_chart_state=JSON.stringify(_this3.reportObject.options)),null!==_this3&&void 0!==_this3&&null!==(_this3$savedReport=_this3.savedReport)&&void 0!==_this3$savedReport&&_this3$savedReport.chartState&&(report_chart_state=JSON.stringify(_this3.savedReport.chartState));var result=_this3.specialHandler(resp.data,report_chart_state);0===result.reportData.data.length?_this3.noData=!0:_this3.noData=!1,result.mode=_this3.serverConfig.mode,result.dateRange=_this3.dateObj?_this3.dateObj:_this3.serverConfig["dateFilter"],result.xAggr=result.report.xAggr;var localChartType=null;if(result.report&&result.report.chartState){var state=JSON.parse(result.report.chartState);localChartType=state.type}_this3.reportObject&&(result.report.chartState=_this3.reportObject.options),"heatmap"===localChartType&&(result.report.chartState.type?result.report.chartState.type="heatmap":(result.report.chartState=JSON.parse(result.report.chartState),result.report.chartState.type=localChartType)),"undefined"!==typeof _this3.savedReport&&null!==_this3.savedReport&&null===_this3.reportObject&&(result.report.chartState=_this3.savedReport.chartState);var robj=_this3.prepareReport(result);if(robj["report"]=result.report,// added for emailReportDependency
_this3.handleAxisChartState(robj,_this3.resultObject,result),"heatmap"===localChartType?robj.options.type=localChartType:!chartType||Object.hasOwnProperty("isSystemGroup")&&!1!==robj.options.isSystemGroup?"stackedbar"!==robj.options.type&&(robj.options.type="bar"):robj.options.type=chartType,!_this3.reportObject&&_this3.savedReport&&_this3.savedReport.chartState)if("object"===(0,esm_typeof/* default */.Z)(_this3.savedReport.chartState))robj.options.type=_this3.savedReport.chartState.type;else{var chartState=JSON.parse(_this3.savedReport.chartState);robj.options.type=chartState.type}robj.options["isTime"]=_this3.serverConfig.isTime,_this3.serverConfig.customizeC3&&robj.options&&(robj.options["customizeC3"]=_this3.serverConfig.customizeC3),_this3.serverConfig.customizeChartOptions&&robj.options&&(robj.options=deepmerge/* default */.Z.objectAssignDeep(robj.options,_this3.serverConfig.customizeChartOptions)),_this3.reportObject=robj,_this3.resultObject=result,_this3.loading=!1,_this3.$emit("reportLoaded",_this3.reportObject,_this3.resultObject)}))}}},components_FNewAnalyticModularReportvue_type_script_lang_js=FNewAnalyticModularReportvue_type_script_lang_js,FNewAnalyticModularReport_component=(0,componentNormalizer/* default */.Z)(components_FNewAnalyticModularReportvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FNewAnalyticModularReport=FNewAnalyticModularReport_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/47942.js.map