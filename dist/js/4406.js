"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[4406],{
/***/904406:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return DashboardRules}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/new-dashboard/rules/DashboardRules.vue?vue&type=template&id=39441daa&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.isDashboardRulesEnabled?_c("div",{staticClass:"dashboard-rules-container"},[_c("div",{staticClass:"action-btn setting-page-btn create-button"},[_vm._m(0),_c("div",[_c("el-button",{staticClass:"plain f13",staticStyle:{height:"42px !important"},attrs:{size:"medium"},on:{click:function($event){return _vm.$router.back()}}},[_vm._v(" CANCEL ")]),_c("el-button",{staticClass:"setup-el-btn",attrs:{type:"primary"},on:{click:_vm.openForm}},[_vm._v(" ADD RULES ")])],1)]),_vm.loading?_c("div",{staticClass:"flex-middle height-100"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_c("div",{staticClass:"container-scroll mT30 pB30 p20"},[_c("el-table",{staticClass:"form-list-table overflow-y-scroll ",attrs:{data:_vm.dashboardRuleList,height:"100%","header-cell-style":{background:"#f3f1fc"},"empty-text":"No rules is added"}},[_c("el-table-column",{attrs:{prop:"name",label:"Name",width:"260"}}),_c("el-table-column",{attrs:{prop:"desc",label:"Description",width:"290"}}),_c("el-table-column",{attrs:{label:"Trigger Widget",width:"370"},scopedSlots:_vm._u([{key:"default",fn:function(dashboardRule){return[_vm._v(" "+_vm._s(_vm.getTargetWidgetName(dashboardRule.row.trigger_widgets[0])||"---")+" ")]}}],null,!1,1732716339)}),_c("el-table-column",{attrs:{label:"Status",width:"300"},scopedSlots:_vm._u([{key:"default",fn:function(dashboardRule){return[_c("el-switch",{staticClass:"Notification-toggle",attrs:{"active-color":"rgba(57, 178, 194, 0.8)","inactive-color":"#e5e5e5"},on:{change:function(){_vm.enableDisabledRule(dashboardRule)}},model:{value:dashboardRule.row.status,callback:function($$v){_vm.$set(dashboardRule.row,"status",$$v)},expression:"dashboardRule.row.status"}})]}}],null,!1,2845981347)}),_c("el-table-column",{attrs:{fixed:"right"},scopedSlots:_vm._u([{key:"default",fn:function(dashboardRule){return[_c("div",{staticClass:" d-flex"},[_c("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"el-icon-edit pointer visibility-hide-actions mL10",attrs:{"data-arrow":"true",title:"Edit Rule"},on:{click:function($event){return _vm.editRule(dashboardRule.row.id)}}}),_c("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"el-icon-delete pointer visibility-hide-actions mL10",attrs:{"data-arrow":"true",title:"Delete Rule"},on:{click:function($event){return _vm.deleteRuleConfirm(dashboardRule.row.id)}}})])]}}],null,!1,3314502487)})],1)],1),_vm.openRulesForm?_c("DashboardRulesForm",{attrs:{isNew:_vm.isNew,currentDashboard:_vm.currentDashboardDetails,currentDashboardTab:_vm.currentDashboardTab,triggerWidgetList:_vm.triggerWidgetList,presentDashboardRule:_vm.presentDashboardRule},on:{closeDialog:_vm.closeForm,createdRule:_vm.loadRulesList}}):_vm._e()],1):_c("div",[_vm._v(" Please enable license for dashboard rules ")])])},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("p",{staticClass:"setting-form-title text-capitalize dashboard-heading"},[_vm._v(" Dashboard Rules ")]),_c("p",{staticClass:"heading-description text-capitalize"},[_vm._v("Description")])])}],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),DashboardRulesFormvue_type_template_id_599122e2_render=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(879288),__webpack_require__(450886),__webpack_require__(434284),__webpack_require__(425728),function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"1999"},attrs:{visible:!0,fullscreen:!0,"append-to-body":!0,"custom-class":"fc-dialog-form fc-dialog-right custom-rule-dialog setup-dialog40 setup-dialog dashboard-rules-form"}},[_vm.loading?_c("div",{staticClass:"flex-middle height-100"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_c("el-form",{ref:"ruleForm",attrs:{model:_vm.dashboardRules,rules:_vm.rules,"label-position":"top"}},[_c("div",{staticClass:"new-header-container mR30 pL30 new-header-modal new-header-text"},[_c("div",{staticClass:"setup-modal-title"},[_vm._v(" "+_vm._s(_vm.isNew?"Edit":"Create")+" ")])]),_c("div",{staticClass:"new-body-modal pL30 pR30"},[_c("el-row",[_c("el-form-item",[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" Dashboard Name ")]),_c("el-input",{staticClass:"width100 pR20 fc-input-full-border2",attrs:{placeholder:"Enter the name",autofocus:!0,disabled:!0},model:{value:_vm.dashboardName,callback:function($$v){_vm.dashboardName=$$v},expression:"dashboardName"}})],1)],1),_vm.dashboardTabName?_c("el-row",[_c("el-form-item",[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" Dashboard Tab Name ")]),_c("el-input",{staticClass:"width100 pR20 fc-input-full-border2",attrs:{placeholder:"Enter the name",autofocus:!0,disabled:!0},model:{value:_vm.dashboardTabName,callback:function($$v){_vm.dashboardTabName=$$v},expression:"dashboardTabName"}})],1)],1):_vm._e(),_c("el-row",[_c("el-form-item",{attrs:{prop:"name"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" Rule Name ")]),_c("el-input",{staticClass:"width100 pR20 fc-input-full-border2",attrs:{placeholder:"Enter the name",autofocus:!0},model:{value:_vm.dashboardRules.name,callback:function($$v){_vm.$set(_vm.dashboardRules,"name",$$v)},expression:"dashboardRules.name"}})],1)],1),_c("el-row",[_c("el-form-item",[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" Description ")]),_c("el-input",{staticClass:"fc-input-full-border-select2 width100",attrs:{"min-rows":1,placeholder:"Enter description",type:"textarea",autosize:{minRows:2,maxRows:4},resize:"none"},model:{value:_vm.dashboardRules.desc,callback:function($$v){_vm.$set(_vm.dashboardRules,"desc",$$v)},expression:"dashboardRules.desc"}})],1)],1),_c("p",{staticClass:"fc-modal-sub-title"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.execute_on"))+" ")]),_c("p",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.notify_rule_executed"))+" ")]),_c("el-row",{staticClass:"mb10"},[_c("el-col",{attrs:{span:14}},[_c("el-form-item",{staticClass:"mb10",attrs:{label:"Trigger Type"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{placeholder:"On Field Update",filterable:""},model:{value:_vm.dashboardRules.trigger_type,callback:function($$v){_vm.$set(_vm.dashboardRules,"trigger_type",$$v)},expression:"dashboardRules.trigger_type"}},_vm._l(_vm.triggerTypeList,(function(triggerTypeName,triggerType){return _c("el-option",{key:"actionType-"+triggerType,attrs:{label:triggerTypeName,value:parseInt(triggerType)}})})),1)],1)],1)],1),2==_vm.dashboardRules.trigger_type?_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:14}},[_c("el-form-item",{staticClass:"mB10",attrs:{label:"Trigger Widget",required:!0}},[_c("el-select",{staticClass:"fc-input-full-border2 width100 fc-tag",attrs:{placeholder:"Select the field",filterable:"",multiple:!1,"collapse-tags":""},on:{change:_vm.currentWidgetSelected},model:{value:_vm.triggerWidget,callback:function($$v){_vm.triggerWidget=$$v},expression:"triggerWidget"}},_vm._l(_vm.triggerWidgetList,(function(targetWidget,triggerType){return _c("el-option",{key:"actionType-"+triggerType,attrs:{label:targetWidget.label,value:targetWidget.value}})})),1),_c("div",{staticStyle:{display:"flex","flex-direction":"column","line-height":"25px"}},[_vm.triggerWidgetLinkName?_c("span",{staticStyle:{opacity:"0.7"}},[_vm._v(_vm._s("widgetId : #"+_vm.triggerWidget))]):_vm._e(),_vm.triggerWidgetLinkName?_c("span",{staticStyle:{opacity:"0.7"}},[_vm._v(_vm._s("placeholder : ${"+_vm.triggerWidgetLinkName+"}"))]):_vm._e()])],1)],1)],1):_vm._e(),_vm.loadingCriteria?_c("div",{staticClass:"flex-middle height-100"},[_c("spinner",{attrs:{show:_vm.loadingCriteria,size:"80"}})],1):_c("el-row",{staticClass:"mT30"},[_vm.showCriteriaBuilder?_c("div",{staticClass:"mB20"},[_c("label",{staticClass:"fc-modal-sub-title"},[_vm._v(_vm._s(_vm.$t("forms.rules.criteria")))]),_c("el-switch",{staticClass:"Notification-toggle mL30",attrs:{"active-color":"rgba(57, 178, 194, 0.8)","inactive-color":"#e5e5e5"},model:{value:_vm.isCriteriaBuilderRequired,callback:function($$v){_vm.isCriteriaBuilderRequired=$$v},expression:"isCriteriaBuilderRequired"}})],1):_vm._e(),_vm.isCriteriaBuilderRequired?_c("el-col",{attrs:{span:24}},[_c("div",[_c("div",{staticClass:"fc-sub-title-desc"},[_vm._v(" "+_vm._s(_vm.$t("forms.rules.specify_criteria"))+" ")])]),_c("el-form-item",[_vm.loadingCriteria?_vm._e():_c("CriteriaBuilder",{attrs:{moduleName:_vm.moduleName},model:{value:_vm.criteria,callback:function($$v){_vm.criteria=$$v},expression:"criteria"}}),_c("div",{staticClass:"line-height18"},[_vm.isCriteriaConditionEmpty?_c("p",{staticClass:"label-txt-red"},[_vm._v(" Please add valid criteria ")]):_vm._e()])],1)],1):_vm._e()],1),_c("div",[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.approvalprocess.action"))+" ")]),_c("p",{staticClass:"small-description-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.set_corresponding_rule"))+" ")]),_c("DashboardRulesActionConfigure",{attrs:{widgets:_vm.triggerWidgetList,type:1,preExistingRule:_vm.preExistingRule,dashboardRules:_vm.dashboardRules.actions,triggerWidgetPlaceholders:_vm.triggerWidgetPlaceholders},on:{actions:_vm.actions}}),_c("DashboardRulesActionConfigure",{attrs:{type:2,preExistingRule:_vm.preExistingRule,dashboardRules:_vm.dashboardRules.actions},on:{actions:_vm.actions}}),_c("DashboardRulesActionConfigure",{attrs:{type:3,preExistingRule:_vm.preExistingRule,dashboardRules:_vm.dashboardRules.actions},on:{actions:_vm.actions}}),_c("DashboardRulesActionConfigure",{attrs:{type:5,preExistingRule:_vm.preExistingRule,dashboardRules:_vm.dashboardRules.actions},on:{actions:_vm.actions}})],1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[_c("el-button",{staticClass:"modal-btn-cancel text-uppercase",on:{click:function($event){return _vm.closeFormDialog()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.saveRules()}}},[_vm._v(" "+_vm._s(_vm.saving?_vm.$t("common._common._saving"):_vm.$t("common._common._save"))+" ")])],1)],1)])],1)}),DashboardRulesFormvue_type_template_id_599122e2_staticRenderFns=[],objectSpread2=__webpack_require__(595082),dist=(__webpack_require__(670560),__webpack_require__(538077),__webpack_require__(795765),__webpack_require__(821552),__webpack_require__(634338),__webpack_require__(191853)),api=__webpack_require__(32284),validation=__webpack_require__(990260),DashboardRulesActionConfigurevue_type_template_id_5a8411be_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"dashboard-action-config"},[_c("el-row",{staticClass:"pT20 pB20"},[_c("el-col",{attrs:{span:10}},[_c("p",{staticClass:"details-Heading"},[_vm._v(_vm._s(_vm.name))]),_c("p",{staticClass:"small-description-txt2 width65 break-word"},[_vm._v(" "+_vm._s(_vm.description)+" ")])]),_c("el-col",{staticClass:"flex items-center",attrs:{span:10}},[_vm.isActionConfigure?_c("div",{staticClass:"pR10 configured-green f13 border-right2"},[_vm._v(" "+_vm._s(_vm.$t("forms.rules.configured"))+" ")]):_c("el-button",{staticClass:"small-border-btn",attrs:{type:"button"},on:{click:_vm.configureAction}},[_vm._v(_vm._s(_vm.isActionConfigure?"Configured":"Configure"))]),_vm.isActionConfigure?_c("span",{staticClass:"mL10"},[_c("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"el-icon-edit pointer",attrs:{title:_vm.$t("forms.rules.edit_actions")},on:{click:_vm.configureAction}}),_c("span",{staticClass:"mL10 reset-txt pointer",on:{click:_vm.reset}},[_vm._v(_vm._s(_vm.$t("forms.rules.reset")))])]):_vm._e()],1)],1),_vm.opendiaglog?_c("el-dialog",{staticClass:"fc-dialog-center-container ",attrs:{visible:_vm.opendiaglog,title:"ACTIONS","custom-class":"action-configure-dialog","append-to-body":!0,width:"70%"},on:{"update:visible":function($event){_vm.opendiaglog=$event}}},[_vm.openUrl?_c("DashboardUrl",{attrs:{presentAction:_vm.presentAction},on:{actions:_vm.actions,closeUrl:_vm.closeDialog}}):_vm._e(),_vm.openSection?_c("ShowHideSection",{attrs:{presentAction:_vm.presentAction,sectionsList:_vm.sectionsList},on:{closeSection:_vm.closeDialog,actions:_vm.actions}}):_vm._e(),_vm.isScriptEditor?_c("DashboardScript",{attrs:{script_action:_vm.presentAction},on:{closeScript:_vm.closeDialog,actions:_vm.actions}}):_vm._e(),_vm.isFilter?_c("DashboardActionFilter",{attrs:{widgets:_vm.widgets,presentAction:_vm.presentAction,preExistingRule:_vm.preExistingRule,triggerWidgetPlaceholders:_vm.triggerWidgetPlaceholders},on:{actions:_vm.actions,closeFilter:_vm.closeDialog}}):_vm._e()],1):_vm._e()],1)},DashboardRulesActionConfigurevue_type_template_id_5a8411be_staticRenderFns=[],slicedToArray=__webpack_require__(554621),DashboardActionUrlvue_type_template_id_65880142_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-input",{staticClass:"width100 pR20 fc-input-full-border2",attrs:{placeholder:"Please input"},model:{value:_vm.url,callback:function($$v){_vm.url=$$v},expression:"url"}},[_c("template",{slot:"prepend"},[_vm._v("URL")])],2),_c("span",{staticClass:"modal-dialog-footer row",attrs:{slot:"footer"},slot:"footer"},[_c("el-button",{staticClass:"col-6 modal-btn-cancel",on:{click:function($event){return _vm.close()}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"col-6 modal-btn-save",attrs:{type:"primary"},on:{click:function($event){return _vm.save()}}},[_vm._v("Ok")])],1)],1)},DashboardActionUrlvue_type_template_id_65880142_staticRenderFns=[],DashboardActionUrlvue_type_script_lang_js={props:["presentAction"],data:function(){return{url:null,isSaved:!1,urlActionList:{type:2,actionType:"url",action_meta:{actionId:-1,action_detail:{url:null}},target_widgets:null}}},created:function(){if(!(0,validation/* isEmpty */.xb)(this.presentAction)){var _ref=this.presentAction||{},action_meta=_ref.action_meta,action_detail=action_meta.action_detail,url=action_detail.url;this.url=url}},methods:{save:function(){this.isSaved=!0;var _ref2=this||{},urlActionList=_ref2.urlActionList;(0,validation/* isEmpty */.xb)(this.presentAction)||(urlActionList=this.presentAction,void 0===urlActionList.id&&(urlActionList.id=-1)),urlActionList.action_meta.action_detail.url=this.url,this.$emit("actions",urlActionList,{})},close:function(){var url;if(!(0,validation/* isEmpty */.xb)(this.presentAction)){var _ref3=this||{},presentAction=_ref3.presentAction,action_meta=presentAction.action_meta,action_detail=action_meta.action_detail;url=action_detail.url}(0,validation/* isEmpty */.xb)(this.url)||!this.isSaved&&(0,validation/* isEmpty */.xb)(url)?this.$emit("closeUrl",!1):this.$emit("closeUrl",!0)}}},rules_DashboardActionUrlvue_type_script_lang_js=DashboardActionUrlvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(rules_DashboardActionUrlvue_type_script_lang_js,DashboardActionUrlvue_type_template_id_65880142_render,DashboardActionUrlvue_type_template_id_65880142_staticRenderFns,!1,null,null,null)
/* harmony default export */,DashboardActionUrl=component.exports,DashboardActionShowHideSectionvue_type_template_id_01d5cc6a_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-row",[_c("el-col",{attrs:{span:14}},[_c("el-form-item",{staticClass:"mB10",attrs:{prop:"fieldId",label:"Show Section"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100 fc-tag",attrs:{placeholder:"Select the field",filterable:"",multiple:!0,"collapse-tags":""},on:{change:_vm.showSection},model:{value:_vm.showField,callback:function($$v){_vm.showField=$$v},expression:"showField"}},_vm._l(_vm.showSectionsList,(function(sections,type){return _c("el-option",{key:"actionType-"+type,attrs:{label:sections.sectionName,value:sections.id}})})),1)],1)],1)],1),_c("el-row",[_c("el-col",{attrs:{span:14}},[_c("el-form-item",{staticClass:"mB10",attrs:{prop:"fieldId",label:"Hide Section"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100 fc-tag",attrs:{placeholder:"Select the field",filterable:"",multiple:!0,"collapse-tags":""},on:{change:_vm.hideSection},model:{value:_vm.hideField,callback:function($$v){_vm.hideField=$$v},expression:"hideField"}},_vm._l(_vm.hideSectionsList,(function(sections,type){return _c("el-option",{key:"actionType-"+type,attrs:{label:sections.sectionName,value:sections.id}})})),1)],1)],1)],1),_c("span",{staticClass:"modal-dialog-footer row",attrs:{slot:"footer"},slot:"footer"},[_c("el-button",{staticClass:"col-6 modal-btn-cancel",on:{click:function($event){return _vm.close()}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"col-6 modal-btn-save",attrs:{type:"primary"},on:{click:function($event){return _vm.save()}}},[_vm._v("Ok")])],1)],1)},DashboardActionShowHideSectionvue_type_template_id_01d5cc6a_staticRenderFns=[],DashboardActionShowHideSectionvue_type_script_lang_js={props:{sectionsList:{default:function(){return[]},type:Array},presentAction:{default:function(){},type:Object}},data:function(){return{showField:null,hideField:null,hideSectionsList:null,showSectionsList:null,isSaved:!1,showSectionActionList:{type:3,actionType:"show_section",action_meta:{actionId:-1,action_detail:{section_ids:null}},target_widgets:null},hideSectionActionList:{type:4,actionType:"hide_section",action_meta:{actionId:-1,action_detail:{section_ids:null}},target_widgets:null}}},created:function(){this.hideSectionsList=this.presentSectionsList,this.showSectionsList=this.presentSectionsList,(0,validation/* isEmpty */.xb)(this.presentAction)||(this.existingAction(),this.isSaved=!0)},methods:{existingAction:function(){var _ref=this||{},presentAction=_ref.presentAction,_ref2=presentAction||{},showSection=_ref2.showSection,_ref3=presentAction||{},hideSection=_ref3.hideSection;(0,validation/* isEmpty */.xb)(showSection)||(0,validation/* isEmpty */.xb)(hideSection)?(0,validation/* isEmpty */.xb)(showSection)?(this.hideSectionActionList=hideSection,void 0===this.hideSectionActionList.id&&(this.hideSectionActionList.id=-1)):(this.showSectionActionList=showSection,void 0===this.showSectionActionList.id&&(this.showSectionActionList.id=-1)):(this.showSectionActionList=showSection,this.hideSectionActionList=hideSection,void 0===this.showSectionActionList.id&&(this.showSectionActionList.id=-1),void 0===this.hideSectionActionList.id&&(this.hideSectionActionList.id=-1));var _ref4=this||{},showSectionActionList=_ref4.showSectionActionList,hideSectionActionList=_ref4.hideSectionActionList,_ref5=showSectionActionList||{},showAction_meta=_ref5.action_meta,_ref6=showAction_meta||{},showAction_detail=_ref6.action_detail,_ref7=showAction_detail||{},showSecIds=_ref7.section_ids,_ref8=hideSectionActionList||{},action_meta=_ref8.action_meta,_ref9=action_meta||{},action_detail=_ref9.action_detail,_ref10=action_detail||{},hideSecIds=_ref10.section_ids;this.$set(this,"showField",showSecIds),this.$set(this,"hideField",hideSecIds),
// this.showField = this.showSectionActionList.action_meta.action_detail.section_ids
// this.hideField = this.hideSectionActionList.action_meta.action_detail.section_ids
(0,validation/* isEmpty */.xb)(this.showField)||this.showSection(),(0,validation/* isEmpty */.xb)(this.hideField)||this.hideSection()},close:function(){(0,validation/* isEmpty */.xb)(this.showField)&&(0,validation/* isEmpty */.xb)(this.hideField)||!this.isSaved?this.$emit("closeSection",!1):this.$emit("closeSection",!0)},save:function(){var emptyCase={},_ref11=this||{},showField=_ref11.showField,_ref12=this||{},hideField=_ref12.hideField,_ref13=this||{},showSectionActionList=_ref13.showSectionActionList,_ref14=this||{},hideSectionActionList=_ref14.hideSectionActionList;(0,validation/* isEmpty */.xb)(showField)||(0,validation/* isEmpty */.xb)(hideField)?(0,validation/* isEmpty */.xb)(showField)?(0,validation/* isEmpty */.xb)(hideField)||this.$emit("actions",emptyCase,hideSectionActionList):this.$emit("actions",showSectionActionList,emptyCase):this.$emit("actions",showSectionActionList,hideSectionActionList),this.isSaved=!0},showSection:function(){var _this=this,SectionsList=this.presentSectionsList.filter((function(section){var value=_this.showField.find((function(i){return i===section.id}));return void 0===value&&section}));this.$set(this,"hideSectionsList",SectionsList),(0,validation/* isEmpty */.xb)(this.showField)||this.$set(this.showSectionActionList.action_meta.action_detail,"section_ids",this.showField)},hideSection:function(){var _this2=this,SectionsList=this.presentSectionsList.filter((function(section){var value=_this2.hideField.find((function(i){return i===section.id}));return void 0===value&&section}));this.$set(this,"showSectionsList",SectionsList),(0,validation/* isEmpty */.xb)(this.hideField)||this.$set(this.hideSectionActionList.action_meta.action_detail,"section_ids",this.hideField)}},computed:{presentSectionsList:function(){return this.sectionsList.filter((function(i){return i||!1}))}}},rules_DashboardActionShowHideSectionvue_type_script_lang_js=DashboardActionShowHideSectionvue_type_script_lang_js,DashboardActionShowHideSection_component=(0,componentNormalizer/* default */.Z)(rules_DashboardActionShowHideSectionvue_type_script_lang_js,DashboardActionShowHideSectionvue_type_template_id_01d5cc6a_render,DashboardActionShowHideSectionvue_type_template_id_01d5cc6a_staticRenderFns,!1,null,null,null)
/* harmony default export */,DashboardActionShowHideSection=DashboardActionShowHideSection_component.exports,DashboardActionScriptvue_type_template_id_92525d10_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"functions-editor-container"},[_c("div",{staticClass:"editor-container"},[_c("script-editor",{attrs:{scriptClass:"script-editor-container",diff:""},model:{value:_vm.scriptData,callback:function($$v){_vm.scriptData=$$v},expression:"scriptData"}})],1),_c("div",{staticClass:"modal-dialog-footer",staticStyle:{"z-index":"900"}},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.close}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.save}},[_vm._v(" Save ")])],1)])},DashboardActionScriptvue_type_template_id_92525d10_scoped_true_staticRenderFns=[],setup=__webpack_require__(572552),DashboardActionScriptvue_type_script_lang_js={components:{ScriptEditor:setup/* ScriptEditor */.Y},props:["script_action"],data:function(){return{actionObj:null,isSaved:!1,scriptData:""}},created:function(){this.init()},methods:{init:function(){(0,validation/* isEmpty */.xb)(this.script_action)||(this.scriptData=this.script_action.action_meta.script)},save:function(){if(""!=this.scriptData){var list={type:5,actionType:"script_action",action_meta:{actionId:-1,action_detail:{}},target_widgets:[]};list.action_meta.script=this.scriptData,this.$emit("actions",list,{})}else this.$message.error("Script is Empty")},close:function(){(0,validation/* isEmpty */.xb)(this.scriptData)?this.$emit("closeScript",!1):this.$emit("closeScript",!0)}}},rules_DashboardActionScriptvue_type_script_lang_js=DashboardActionScriptvue_type_script_lang_js,DashboardActionScript_component=(0,componentNormalizer/* default */.Z)(rules_DashboardActionScriptvue_type_script_lang_js,DashboardActionScriptvue_type_template_id_92525d10_scoped_true_render,DashboardActionScriptvue_type_template_id_92525d10_scoped_true_staticRenderFns,!1,null,"92525d10",null)
/* harmony default export */,DashboardActionScript=DashboardActionScript_component.exports,DashboardActionFiltervue_type_template_id_09645fd3_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-row",[_c("el-col",{attrs:{span:14}},[_c("el-form-item",{staticClass:"mB10",attrs:{prop:"fieldId",label:"Target Widget"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100 fc-tag",attrs:{placeholder:"Select the field",filterable:"",multiple:!0,"collapse-tags":""},on:{change:_vm.loadWidgetDetails,"visible-change":_vm.dropDownVisibiltyChanged},model:{value:_vm.selectedWidgetList,callback:function($$v){_vm.selectedWidgetList=$$v},expression:"selectedWidgetList"}},_vm._l(_vm.widgets,(function(widget,type){return _c("el-option",{key:"actionType-"+type,attrs:{label:widget.label,value:widget}})})),1)],1)],1)],1),_c("div",{staticClass:"filter-criteri-builder"},[_vm.loadingCriteriaBuilder?_c("div",{staticClass:"flex-middle height-100"},[_c("spinner",{attrs:{show:_vm.loadingCriteriaBuilder,size:"80"}})],1):_vm._e(),_vm._l(_vm.recordWidget,(function(widget,index){return _c("div",{key:index},[_c("el-form",[_c("el-form-item",{staticClass:"widget-criteria-label",attrs:{label:widget.label}}),"READING_REPORT"===widget.reportType?_c("div",_vm._l(widget.dataPoints,(function(dataPoint,dataPointIndex){return _c("el-form-item",{key:dataPointIndex,staticClass:"mB10",attrs:{prop:"fieldId",label:""+dataPoint.display_label}},[_c("CriteriaBuilder",{key:index+", "+dataPointIndex,attrs:{moduleName:dataPoint.module,showValueType:!0,customValues:_vm.customValues},model:{value:_vm.dashboardRules["criteria_"+widget.value+"_dataPoint_"+dataPoint.label],callback:function($$v){_vm.$set(_vm.dashboardRules,"criteria_"+widget.value+"_dataPoint_"+dataPoint.label,$$v)},expression:"\n                dashboardRules[\n                  `criteria_${widget.value}_dataPoint_${dataPoint.label}`\n                ]\n              "}})],1)})),1):_c("div",[_c("el-form-item",{staticClass:"mB10",attrs:{prop:"fieldId"}},[_c("CriteriaBuilder",{key:""+index,attrs:{moduleName:widget.module,showValueType:!0,customValues:_vm.customValues},model:{value:_vm.dashboardRules["criteria_"+widget.value],callback:function($$v){_vm.$set(_vm.dashboardRules,"criteria_"+widget.value,$$v)},expression:"dashboardRules['criteria_' + widget.value]"}})],1)],1)],1)],1)}))],2),_c("span",{staticClass:"modal-dialog-footer row",attrs:{slot:"footer"},slot:"footer"},[_c("el-button",{staticClass:"col-6 modal-btn-cancel",on:{click:function($event){return _vm.close()}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"col-6 modal-btn-save",attrs:{type:"primary"},on:{click:function($event){return _vm.checkCriteriaValidation()}}},[_vm._v("Ok")])],1)],1)},DashboardActionFiltervue_type_template_id_09645fd3_scoped_true_staticRenderFns=[],lodash=(__webpack_require__(564043),__webpack_require__(322462),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(496486)),DashboardActionFiltervue_type_script_lang_js={props:{widgets:{},presentAction:{},preExistingRule:{type:Boolean,default:!1},triggerWidgetPlaceholders:{}},components:{CriteriaBuilder:dist/* CriteriaBuilder */.IP},computed:{},data:function(){return{dummy:{},criteriaBuilderloaded:!0,dashboardRules:{},lookupModuleFieldsList:[],selectedWidgetList:null,showwidget:!1,recordWidget:null,loadingCriteriaBuilder:!1,isSaved:!1,filterActionList:{type:1,actionType:"filter",action_meta:{action_detail:{}},target_widgets:null},customValues:[{allowCreate:!0,options:[],label:"Field",value:"fields",matcher:function(value){var regexArray=String(value).match(/\$\{(.*?)\}/);return!(0,validation/* isEmpty */.xb)(regexArray)}}]}},watch:{recordWidget:function(widgets){var _this=this,rules={};widgets.forEach((function(widget){var dataPoints=widget.dataPoints;if((0,validation/* isEmpty */.xb)(dataPoints)){var key="criteria_".concat(widget.value);(0,validation/* isEmpty */.xb)(_this.dashboardRules[key])?rules[key]={}:rules[key]=(0,lodash.cloneDeep)(_this.dashboardRules[key])}else dataPoints.forEach((function(dataPoint){var key="criteria_".concat(widget.value,"_dataPoint_").concat(dataPoint.label);(0,validation/* isEmpty */.xb)(_this.dashboardRules[key])?rules[key]={}:rules[key]=(0,lodash.cloneDeep)(_this.dashboardRules[key])}))})),this.$set(this,"dashboardRules",(0,lodash.cloneDeep)(rules))}},created:function(){var _this2=this;
// this.getLookupModuleFieldsList()
if((0,validation/* isEmpty */.xb)(this.triggerWidgetPlaceholders)||(this.customValues[0].options=this.triggerWidgetPlaceholders),!(0,validation/* isEmpty */.xb)(this.presentAction)&&!(0,validation/* isEmpty */.xb)(this.presentAction.target_widgets)){this.isSaved=!0;var getWidgets=function(){var targetWidgets=_this2.presentAction.target_widgets;if(_this2.preExistingRule){var widgets=[];return targetWidgets.map((function(targetWidget){return _this2.widgets.find((function(widget){return targetWidget.target_widget_id===widget.value}))})).forEach((function(widget){-1==widgets.indexOf(widget)&&widgets.push(widget)})),widgets}return targetWidgets.map((function(targetWidget){return _this2.widgets.find((function(widget){return targetWidget.target_widget_id===widget.value}))}))};this.selectedWidgetList=getWidgets(),this.filterActionList=(0,lodash.cloneDeep)(this.presentAction),void 0===this.filterActionList.id&&(this.filterActionList.id=-1),this.loadWidgetDetails(),this.fillvalue()}},methods:{updateCriteria:function(newVal,value){this.dashboardRules["criteria"+value]=newVal},
// async getLookupModuleFieldsList() {
//   let {
//     data: { modules },
//   } = await API.get('/v2/report/getDataModuleList', {
//     moduleName: 'workorder',
//   })
//   this.lookupModuleFieldsList = modules
//   console.log(this.lookupModuleFieldsList)
// },
loadWidgetDetails:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var promises;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this3.loadingCriteriaBuilder=!0,promises=_this3.selectedWidgetList.map(function(){var _ref=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(widget){var _yield$API$get,data,_ref2,module,_ref2$report$dataPoin,_ref2$report$dataPoin2,dataTypeEnum,fields,lookupModule,list,_yield$API$put,_data,dataPoints,getDataPoint;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(!("reportId"in widget)||"READING_REPORT"===(null===widget||void 0===widget?void 0:widget.reportType)){_context.next=16;break}return _context.next=5,api/* API */.bl.get("v3/report/execute",{reportId:widget.reportId});case 5:return _yield$API$get=_context.sent,data=_yield$API$get.data,_ref2=data||{},module=_ref2.module,_ref2$report$dataPoin=(0,slicedToArray/* default */.Z)(_ref2.report.dataPoints,1),_ref2$report$dataPoin2=_ref2$report$dataPoin[0].xAxis,dataTypeEnum=_ref2$report$dataPoin2.dataTypeEnum,fields=_ref2$report$dataPoin2.module.fields,lookupModule=_ref2$report$dataPoin2.field.lookupModule,list={},list.module="LOOKUP"==dataTypeEnum?lookupModule.name:module.name,list.label=widget.label,list.value=widget.value,(0,validation/* isEmpty */.xb)(fields)||(_this3.lookupModuleFieldsList=fields),_context.abrupt("return",list||null);case 16:if(!("reportId"in widget)||"READING_REPORT"!==(null===widget||void 0===widget?void 0:widget.reportType)){_context.next=27;break}return _context.next=20,api/* API */.bl.put("v3/report/reading/view?reportId="+(null===widget||void 0===widget?void 0:widget.reportId),{newFormat:!0});case 20:return _yield$API$put=_context.sent,_data=_yield$API$put.data,dataPoints=_data.report.dataPoints,getDataPoint=function(){return dataPoints.map((function(dataPoint){return{moduleName:dataPoint.xAxis.moduleName,parentModuleName:"asset",
// Hardcode.
label:dataPoint.aliases.actual,display_label:dataPoint.name,module:"asset"};
// const obj = {}
// obj.moduleName
// const {
//   yAxis: { moduleName },
// } = datapoint
// module = 'asset'
// return data
// const { data } = await API.get('v2/state/list?parentModuleName=' + 'asset')
// console.log('data', data)
// return data
}))},_context.abrupt("return",{label:widget.label,reportType:"READING_REPORT",dataPoints:getDataPoint(),value:widget.value});case 27:return _context.abrupt("return",widget);case 29:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()),_context2.next=4,Promise.all(promises);case 4:_this3.recordWidget=_context2.sent,_this3.loadingCriteriaBuilder=!1;case 7:case"end":return _context2.stop()}}),_callee2)})))()},fillvalue:function(){var _this4=this;this.criteriaBuilderloaded=!1;var getTriggerWidgets=function(){var targetWidgets=_this4.presentAction.target_widgets;if(_this4.preExistingRule){var widgets=[],getWidget=function(widgetId){return widgets.find((function(widget){return widget.target_widget_id==widgetId}))};return targetWidgets.forEach((function(targetWidget){var criteria=targetWidget.criteria,_targetWidget$moduleN=targetWidget.moduleName,moduleName=void 0===_targetWidget$moduleN?"asset":_targetWidget$moduleN,target_widget_id=targetWidget.target_widget_id,actionId=targetWidget.actionId;if("dataPointMeta"in targetWidget){var _targetWidget$dataPoi=targetWidget.dataPointMeta,datapoint_link=_targetWidget$dataPoi.datapoint_link,parentModuleName=_targetWidget$dataPoi.parentModuleName,widget=getWidget(target_widget_id);widget?widget.dataPointList.push({datapoint_link:datapoint_link,criteria:criteria,parentModuleName:parentModuleName,moduleName:moduleName}):widgets.push({actionId:actionId,target_widget_id:target_widget_id,dataPointList:[{datapoint_link:datapoint_link,criteria:criteria,parentModuleName:parentModuleName,moduleName:moduleName}]})}else widgets.push({criteria:criteria,actionId:actionId,moduleName:moduleName,target_widget_id:target_widget_id})})),widgets}return targetWidgets},rules={},triggerWidgets=getTriggerWidgets();triggerWidgets.forEach((function(targetWidget){if("dataPointList"in targetWidget){var dataPointList=targetWidget.dataPointList,target_widget_id=targetWidget.target_widget_id;dataPointList.forEach((function(dataPoint){var _dataPoint$criteria=dataPoint.criteria,criteria=void 0===_dataPoint$criteria?{}:_dataPoint$criteria,datapoint_link=dataPoint.datapoint_link,key="criteria_".concat(target_widget_id,"_dataPoint_").concat(datapoint_link);rules[key]=(0,lodash.cloneDeep)(criteria)}))}else{var _targetWidget$criteri=targetWidget.criteria,criteria=void 0===_targetWidget$criteri?{}:_targetWidget$criteri,_target_widget_id=targetWidget.target_widget_id,key="criteria_".concat(_target_widget_id);rules[key]=(0,lodash.cloneDeep)(criteria)}})),this.dashboardRules=(0,lodash.cloneDeep)(rules),this.$nextTick((function(){_this4.criteriaBuilderloaded=!0}))},dropDownVisibiltyChanged:function(val){val||(0,validation/* isEmpty */.xb)(this.recordWidget)||(this.showwidget=!0)},isValidCriteria:function(criteria){if(!criteria.conditions)return!1;var conditions=criteria.conditions;for(var key in conditions)if(Number.isInteger(Number.parseInt(key))){var condition=conditions[key];if((0,validation/* isEmpty */.xb)(condition)||(0,validation/* isEmpty */.xb)(condition.operatorId)||(0,validation/* isEmpty */.xb)(condition.fieldName))return!1}return!0},checkCriteriaValidation:function(){var isAllValid=!0;outer:for(var j=0;j<(null===this||void 0===this||null===(_this$recordWidget=this.recordWidget)||void 0===_this$recordWidget?void 0:_this$recordWidget.length);j++){var _this$recordWidget,widget=this.recordWidget[j],_dataPoints=widget.dataPoints;if((0,validation/* isEmpty */.xb)(_dataPoints)){var _key="criteria_".concat(widget.value),_criteria=this.dashboardRules[_key];if((0,validation/* isEmpty */.xb)(_criteria))continue;var _isValidCriteria=this.isValidCriteria(this.dashboardRules[_key]);if(!_isValidCriteria){this.$message.error("Please add valid criteria for the widget ".concat(widget.label,".")),isAllValid=!1;break outer}}else for(var i=0;i<_dataPoints.length;i++){var dataPoint=_dataPoints[i],key="criteria_".concat(widget.value,"_dataPoint_").concat(dataPoint.label),criteria=this.dashboardRules[key];if(!(0,validation/* isEmpty */.xb)(criteria)){var isValidCriteria=this.isValidCriteria(criteria);if(!isValidCriteria){this.$message.error("Please add valid criteria for widget ".concat(widget.label," and data point ").concat(dataPoint.label)),isAllValid=!1;break outer}}}}isAllValid&&this.save()},save:function(){var _this5=this,filterActionList=(0,lodash.cloneDeep)(this.filterActionList);(0,validation/* isEmpty */.xb)(this.recordWidget)?filterActionList.target_widgets=null:filterActionList.target_widgets=this.recordWidget.map((function(widget){var target={},dataPoints=widget.dataPoints;if((0,validation/* isEmpty */.xb)(dataPoints)){var key="criteria_".concat(widget.value),criteria=_this5.dashboardRules[key];if((0,validation/* isEmpty */.xb)(criteria))return!1;target.criteria=_this5.dashboardRules[key]}else target["dataPointList"]=dataPoints.map((function(dataPoint){var obj={};obj["datapoint_link"]=dataPoint.label;var key="criteria_".concat(widget.value,"_dataPoint_").concat(dataPoint.label),criteria=_this5.dashboardRules[key];return!(0,validation/* isEmpty */.xb)(criteria)&&(obj["criteria"]=_this5.dashboardRules[key],obj["parentModuleName"]=dataPoint.moduleName,obj["moduleName"]="asset",obj)})).filter((function(obj){return!1!==obj}));return target.actionId=-1,target.target_widget_id=widget.value,target.moduleName=widget.module,target})),this.$emit("actions",filterActionList,{})},close:function(){var _ref3=this||{},filterActionList=_ref3.filterActionList,target_widgets=filterActionList.target_widgets;
// !isEmpty(this.recordWidget) &&
!(0,validation/* isEmpty */.xb)(target_widgets)&&this.isSaved?this.$emit("closeFilter",!0):this.$emit("closeFilter",!1),this.isSaved=!1}}},rules_DashboardActionFiltervue_type_script_lang_js=DashboardActionFiltervue_type_script_lang_js,DashboardActionFilter_component=(0,componentNormalizer/* default */.Z)(rules_DashboardActionFiltervue_type_script_lang_js,DashboardActionFiltervue_type_template_id_09645fd3_scoped_true_render,DashboardActionFiltervue_type_template_id_09645fd3_scoped_true_staticRenderFns,!1,null,"09645fd3",null)
/* harmony default export */,DashboardActionFilter=DashboardActionFilter_component.exports,ACTION_TYPE_HASH={1:"Filter",2:"Support Url",3:"Show Section/Hide Section",5:"Execute Script"},DashboardRulesActionConfigurevue_type_script_lang_js={props:["preExistingRule","description","type","widgets","dashboardRules","triggerWidgetPlaceholders"],components:{DashboardUrl:DashboardActionUrl,ShowHideSection:DashboardActionShowHideSection,DashboardScript:DashboardActionScript,DashboardActionFilter:DashboardActionFilter},data:function(){return{sectionsList:[],name:null,isActionConfigure:!1,openUrl:!1,opendiaglog:!1,openSection:!1,isScriptEditor:!1,actionType:ACTION_TYPE_HASH,isFilter:!1,presentAction:null}},created:function(){this.getSections(),this.name=this.actionType[this.type],this.existingAction()},computed:{dashboardLinkName:function(){var _this$$route,_ref=null!==(_this$$route=this.$route)&&void 0!==_this$$route?_this$$route:{},dashboardLinkName=_ref.params.dashboardlink;return dashboardLinkName}},methods:{getSections:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _ref2,dashboardLinkName,_yield$API$get,_yield$API$get$data$d,widgets;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _ref2=null!==_this&&void 0!==_this?_this:{},dashboardLinkName=_ref2.dashboardLinkName,_context.next=3,api/* API */.bl.get("v3/dashboard/"+dashboardLinkName);case 3:_yield$API$get=_context.sent,_yield$API$get$data$d=(0,slicedToArray/* default */.Z)(_yield$API$get.data.dashboardJson,1),widgets=_yield$API$get$data$d[0].children,_this.sectionsList=widgets.map((function(_ref3){var widget=_ref3.widget;if("section"==widget.type){var _ref4=null!==widget&&void 0!==widget?widget:{},name=_ref4.name,description=_ref4.desc,id=_ref4.id;return{sectionName:name,description:description,id:id}}return!1}));case 7:case"end":return _context.stop()}}),_callee)})))()},existingAction:function(){var _this2=this;if(!(0,validation/* isEmpty */.xb)(this.dashboardRules)){
// this.presentAction = this.dashboardRules.find(action => {
//   if (action.type === this.type) {
//     this.isActionConfigure = true
//     return action
//   } else return false
// })
var showType=0,hideType=0;3===this.type&&(showType=3,hideType=4,this.presentAction={showSection:{},hideSection:{}}),this.dashboardRules.forEach((function(action){action.type===showType?(_this2.presentAction.showSection=action,_this2.isActionConfigure=!0):action.type===hideType?(_this2.presentAction.hideSection=action,_this2.isActionConfigure=!0):action.type===_this2.type?(_this2.presentAction=action,_this2.isActionConfigure=!0):_this2.presentAction=null}))}},configureAction:function(){
// this.isActionConfigure = true
this.opendiaglog=!0,2==this.type?this.openUrl=!0:3==this.type?this.openSection=!0:5==this.type?this.isScriptEditor=!0:1==this.type&&(this.isFilter=!0)},reset:function(){1===this.type?this.presentAction.target_widgets=null:2===this.type?this.presentAction.action_meta.action_detail.url=null:3===this.type?((0,validation/* isEmpty */.xb)(this.presentAction.showSection)||(0,validation/* isEmpty */.xb)(this.presentAction.hideSection)||(this.presentAction.showSection.action_meta.action_detail.section_ids=null,this.presentAction.hideSection.action_meta.action_detail.section_ids=null,this.$emit("actions",this.presentAction.showSection,this.presentAction.hideSection)),(0,validation/* isEmpty */.xb)(this.presentAction.showSection)||(this.presentAction.showSection.action_meta.action_detail.section_ids=null,this.$emit("actions",this.presentAction.showSection,{})),(0,validation/* isEmpty */.xb)(this.presentAction.hideSection)||(this.presentAction.hideSection.action_meta.action_detail.section_ids=null,this.$emit("actions",{},this.presentAction.hideSection))):5===this.type&&(this.presentAction.action_meta.script=null),this.isActionConfigure=!1,3!==this.type&&this.$emit("actions",this.presentAction,{})},actions:function(val,val1){var value;this.presentAction=val,value=1===this.type?val.target_widgets:2===this.type?val.action_meta.action_detail.url:3!==this.type||(0,validation/* isEmpty */.xb)(val)?3!==this.type||(0,validation/* isEmpty */.xb)(val1)?5!==this.type||(0,validation/* isEmpty */.xb)(val)?null:val.action_meta.script:val1.action_meta.action_detail.section_ids:val.action_meta.action_detail.section_ids,this.isActionConfigure=!0,(0,validation/* isEmpty */.xb)(value)&&(this.isActionConfigure=!1),3===this.type&&(this.presentAction={},this.presentAction.showSection=val,this.presentAction.hideSection=val1),this.$emit("actions",val,val1),this.opendiaglog=!1},closeDialog:function(val){this.opendiaglog=!1,this.isActionConfigure=val}// close() {
//   this.isActionConfigure = false
//   this.isScriptEditor = false
// },
}},rules_DashboardRulesActionConfigurevue_type_script_lang_js=DashboardRulesActionConfigurevue_type_script_lang_js,DashboardRulesActionConfigure_component=(0,componentNormalizer/* default */.Z)(rules_DashboardRulesActionConfigurevue_type_script_lang_js,DashboardRulesActionConfigurevue_type_template_id_5a8411be_render,DashboardRulesActionConfigurevue_type_template_id_5a8411be_staticRenderFns,!1,null,null,null)
/* harmony default export */,DashboardRulesActionConfigure=DashboardRulesActionConfigure_component.exports,TRIGGER_TYPES={1:"Form on load",2:"On widget update"},DashboardRulesFormvue_type_script_lang_js={props:["isNew","currentDashboard","currentDashboardTab","triggerWidgetList","presentDashboardRule"],components:{CriteriaBuilder:dist/* CriteriaBuilder */.IP,DashboardRulesActionConfigure:DashboardRulesActionConfigure},data:function(){return{dashboardRules:{status:!0,id:-1,trigger_type:2,trigger_widgets:[{criteria:null,trigger_widget_id:null,moduleName:null}],actions:[]},triggerWidgetPlaceholders:[],loadingCriteria:!1,triggerWidgetLinkName:null,triggerTypeList:TRIGGER_TYPES,moduleName:null,showCriteriaBuilder:!1,isCriteriaBuilderRequired:!1,dashboardName:null,triggerWidget:null,dashboardTabName:null,dashboardTabId:null,criteria:null,saving:!1,loading:!1,isCriteriaConditionEmpty:!1,rules:{name:[{required:!0,message:"Please enter a rule name",trigger:"blur"}]}}},created:function(){this.loadDashboard(),this.isNew&&(this.loading=!0),this.init()},watch:{presentDashboardRule:function(){this.presentDashboardRule&&(this.dashboardRules=this.presentDashboardRule,this.loadPresentDashboardRule(this.presentDashboardRule))}},computed:{preExistingRule:function(){return!(0,validation/* isEmpty */.xb)(this.presentDashboardRule)}},methods:{init:function(){this.currentDashboardTab&&(this.dashboardTabName=this.currentDashboardTab.name,this.dashboardRules.dashboardTabId=this.currentDashboardTab.id)},loadPresentDashboardRule:function(dashboardrule){(0,validation/* isEmpty */.xb)(dashboardrule.trigger_widgets)?dashboardrule.trigger_widgets=[{criteria:null,trigger_widget_id:null,moduleName:null}]:(this.triggerWidget=dashboardrule.trigger_widgets[0].trigger_widget_id,this.criteria=dashboardrule.trigger_widgets[0].criteria,(0,validation/* isEmpty */.xb)(this.criteria)||(this.isCriteriaBuilderRequired=!0)),this.currentWidgetSelected("edit"),this.loading=!1},actions:function(val,val1){var _this=this,added=!0;(0,validation/* isEmpty */.xb)(this.dashboardRules.actions)?this.dashboardRules.actions.push(val,val1):(this.dashboardRules.actions.map((function(action){return action.type===val.type&&1===action.type?(action.target_widgets=val.target_widgets,!0):action.type===val.type&&2===action.type?(action.action_meta.action_detail.url=val.action_meta.action_detail.url,!0):action.type===val.type&&3===action.type?(action.action_meta.action_detail.section_ids=val.action_meta.action_detail.section_ids,!0):action.type===val.type&&5===action.type?(action.action_meta.script=val.action_meta.script,!0):!(void 0!==val.id||!added)&&(_this.dashboardRules.actions.push(val),added=!1,!0)})),added=!0,this.dashboardRules.actions.map((function(action){return action.type===val1.type&&4===action.type?(action.action_meta.action_detail.section_ids=val1.action_meta.action_detail.section_ids,!0):!(void 0!==val1.id||!added)&&(_this.dashboardRules.actions.push(val1),added=!1,!0)}))),
// console.log(this.dashboardRules.actions)
this.dashboardRules.actions=this.dashboardRules.actions.filter((function(action){return void 0!==action&&((1===action.type&&null!==action.target_widgets||2===action.type&&null!==action.action_meta.action_detail.url||3===action.type&&null!==action.action_meta.action_detail.section_ids||4===action.type&&null!==action.action_meta.action_detail.section_ids||5===action.type&&null!==action.action_meta.script)&&action)}))},isValidCriteria:function(criteria){if(!criteria.conditions)return!1;var conditions=criteria.conditions;for(var key in conditions)if(Number.isInteger(Number.parseInt(key))){var condition=conditions[key];if((0,validation/* isEmpty */.xb)(condition)||(0,validation/* isEmpty */.xb)(condition.operatorId)||(0,validation/* isEmpty */.xb)(condition.fieldName))return!1}return!0},saveRules:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(_this2.isCriteriaBuilderRequired&&(_this2.isCriteriaConditionEmpty=!_this2.isValidCriteria(_this2.criteria)),_this2.isCriteriaConditionEmpty&&_this2.isCriteriaBuilderRequired){_context2.next=5;break}return _this2.isCriteriaBuilderRequired||(_this2.criteria=null),_context2.next=5,_this2.$refs["ruleForm"].validate(function(){var _ref=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(valid){var dashboardRules,params,url,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(!valid){_context.next=15;break}return _this2.saving=!0,dashboardRules=_this2.dashboardRules,(0,validation/* isEmpty */.xb)(_this2.triggerWidget)||(dashboardRules.trigger_widgets[0].trigger_widget_id=_this2.triggerWidget,dashboardRules.trigger_widgets[0].criteria=_this2.criteria,dashboardRules.trigger_widgets[0].moduleName=_this2.moduleName),(0,validation/* isEmpty */.xb)(_this2.triggerWidget)&&(dashboardRules.trigger_widgets=null),params={},params.dashboard_rule=dashboardRules,url=_this2.isNew?"/v3/dashboard/rule/update":"/v3/dashboard/rule/create",_context.next=10,api/* API */.bl.post(url,params);case 10:_yield$API$post=_context.sent,error=_yield$API$post.error,error?_this2.$message.error(error.message||"Error Occured"):_this2.isNew?_this2.$message.success("Rule updated successfully."):_this2.$message.success("Rule added successfully."),_this2.saving=!1,_this2.$emit("createdRule");case 15:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}());case 5:case"end":return _context2.stop()}}),_callee2)})))()},closeFormDialog:function(){this.$emit("closeDialog")},loadDashboard:function(){var currentDashboard=this.currentDashboard,id=currentDashboard.id;this.dashboardName=currentDashboard.label,this.dashboardRules.dashboardId=id},currentWidgetSelected:function(type){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var selectedWidget,url,_yield$API$get,data,_data$placeholders,fields,moduleFields,placeHolders,_yield$API$get2,_data,_ref2,module;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(_this3.loadingCriteria=!0,"edit"!==type&&(_this3.criteria=null),selectedWidget=_this3.triggerWidgetList.find((function(widget){return widget.value===_this3.triggerWidget&&(_this3.triggerWidgetLinkName=(0,validation/* isEmpty */.xb)(widget.linkName)?null:widget.linkName,widget)})),(0,validation/* isEmpty */.xb)(selectedWidget.module)||(0,validation/* isEmpty */.xb)(selectedWidget)||"FILTER"!=selectedWidget.widgetType){_context3.next=15;break}return url="v3/placeholders/"+selectedWidget.module,_context3.next=7,api/* API */.bl.get(url);case 7:_yield$API$get=_context3.sent,data=_yield$API$get.data,_data$placeholders=data.placeholders,fields=_data$placeholders.fields,moduleFields=_data$placeholders.moduleFields,_this3.options=fields,_this3.options.forEach((function(field,index){var module=field.module;if(!(0,validation/* isEmpty */.xb)(module)){var children=moduleFields[module];_this3.options[index]=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},field),{},{children:children})}})),placeHolders=[],_this3.options.forEach((function(option){var children=option.children;children?children.forEach((function(field){placeHolders.push({label:field.displayName+"("+selectedWidget.module+"("+option.module+"))",value:_this3.setTriggerPlaceHolders(field,selectedWidget.linkName+".value",option.name)})})):placeHolders.push({label:option.displayName+"("+selectedWidget.module+")",value:_this3.setTriggerPlaceHolders(option,selectedWidget.linkName+".value")})})),_this3.triggerWidgetPlaceholders=placeHolders;case 15:if((0,validation/* isEmpty */.xb)(selectedWidget)){_context3.next=29;break}if((0,validation/* isEmpty */.xb)(selectedWidget.reportId)){_context3.next=25;break}return _context3.next=19,api/* API */.bl.get("v3/report/execute",{reportId:selectedWidget.reportId});case 19:_yield$API$get2=_context3.sent,_data=_yield$API$get2.data,_ref2=_data||{},module=_ref2.module,_this3.moduleName=module.name,_context3.next=26;break;case 25:_this3.moduleName=selectedWidget.module;case 26:_this3.showCriteriaBuilder=!0,_context3.next=30;break;case 29:_this3.showCriteriaBuilder=!1;case 30:_this3.$nextTick((function(){_this3.loadingCriteria=!1}));case 31:case"end":return _context3.stop()}}),_callee3)})))()},setTriggerPlaceHolders:function(childOption,module,parentField){var placeholderString;if((0,validation/* isEmpty */.xb)(childOption.children))return placeholderString=(0,validation/* isEmpty */.xb)(parentField)?"".concat(childOption.name):"".concat(parentField,".").concat(childOption.name),placeholderString="${".concat(module,".").concat(placeholderString,"}"),placeholderString}}},rules_DashboardRulesFormvue_type_script_lang_js=DashboardRulesFormvue_type_script_lang_js,DashboardRulesForm_component=(0,componentNormalizer/* default */.Z)(rules_DashboardRulesFormvue_type_script_lang_js,DashboardRulesFormvue_type_template_id_599122e2_render,DashboardRulesFormvue_type_template_id_599122e2_staticRenderFns,!1,null,null,null)
/* harmony default export */,DashboardRulesForm=DashboardRulesForm_component.exports,cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),DashboardRulesvue_type_script_lang_js={components:{DashboardRulesForm:DashboardRulesForm},data:function(){return{openRulesForm:!1,dashboardRuleList:null,loading:!1,isNew:!1,currentDashboardDetails:null,currentDashboardTab:null,dashboardId:null,triggerWidgetList:[],widgets:null,presentDashboardRule:{}}},created:function(){this.loadWidgetsList()},computed:{isDashboardRulesEnabled:function(){var _this$$helpers$isLice;return null!==(_this$$helpers$isLice=this.$helpers.isLicenseEnabled("DASHBOARD_ACTION"))&&void 0!==_this$$helpers$isLice&&_this$$helpers$isLice}},methods:{dashboardTabId:function(){return(0,validation/* isEmpty */.xb)(this.$route.query)||(0,validation/* isEmpty */.xb)(this.$route.query.tabId)?null:this.$route.query.tabId},enableDisabledRule:function(_ref){var _this=this,rule=_ref.row;api/* API */.bl.post("/v3/dashboard/rule/update",{dashboard_rule:rule}).then((function(_ref2){var error=_ref2.error;_ref2.data;(0,validation/* isEmpty */.xb)(error)||(
// API failed, reset optimistic update.
_this.$message.error(error.message),rule.status=!rule.status)}))},loadWidgetsList:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var currentDashboardLinkName,_yield$API$get,data,error,_ref3,dashboardJson;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this2.loading=!0,currentDashboardLinkName=_this2.$route.params.dashboardlink,_context.next=4,api/* API */.bl.get("/dashboard/".concat(currentDashboardLinkName));case 4:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error||(_ref3=data||{},dashboardJson=_ref3.dashboardJson,(0,validation/* isEmpty */.xb)(dashboardJson)||(_this2.currentDashboardDetails=dashboardJson[0],_this2.dashboardId=dashboardJson[0].id,_this2.dashboardTabId()&&(_this2,_this2.currentDashboardDetails.tabs.forEach((function(tab){tab.id==Number(_this2.dashboardTabId())&&(_this2.currentDashboardTab=cloneDeep_default()(tab))}))),_this2.getTargetWidgetsList()));case 8:case"end":return _context.stop()}}),_callee)})))()},getTargetWidgetsList:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var dashboardId,url,_yield$API$get2,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return dashboardId=_this3.dashboardId,url="/v3/dashboard/rule/widgets/"+dashboardId,_this3.dashboardTabId()&&(url="/v3/dashboard/rule/widgets/tab/"+_this3.dashboardTabId()),_context2.next=5,api/* API */.bl.get(url);case 5:_yield$API$get2=_context2.sent,data=_yield$API$get2.data,_this3.widgets=data.widgets,_this3.triggerWidgetList=_this3.widgets.map((function(widget){var _widget$field,widgetDetails={};if("FILTER"==widget.widgetType)widgetDetails.label=widget.label,widgetDetails.value=widget.id,widgetDetails.module=(0,validation/* isEmpty */.xb)(widget.moduleName)?null===widget||void 0===widget||null===(_widget$field=widget.field)||void 0===_widget$field||null===(_widget$field=_widget$field.module)||void 0===_widget$field?void 0:_widget$field.name:widget.moduleName;else if("CHART"==widget.widgetType)widgetDetails.label=widget.headerText,widgetDetails.value=widget.id,widgetDetails.reportType=widget.reportType,widgetDetails.reportId=widget.newReportId;else if("CARD"==widget.widgetType){var _widget$cardParams;widgetDetails.label=widget.cardParams.title,widgetDetails.value=widget.id,widgetDetails.module=null===(_widget$cardParams=widget.cardParams)||void 0===_widget$cardParams||null===(_widget$cardParams=_widget$cardParams.reading)||void 0===_widget$cardParams?void 0:_widget$cardParams.moduleName}else"LIST_VIEW"==widget.widgetType&&(widgetDetails.label=widget.headerText,widgetDetails.value=widget.id,widgetDetails.module=widget.moduleName);return(0,validation/* isEmpty */.xb)(widget.linkName)||(0,validation/* isEmpty */.xb)(widgetDetails)||(widgetDetails.linkName=widget.linkName),widgetDetails.widgetType=widget.widgetType,widgetDetails})),_this3.loadRulesList();case 10:case"end":return _context2.stop()}}),_callee2)})))()},loadRulesList:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var dashboardId,url,_yield$API$get3,data,error,_ref4,dashboard_rule;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this4.openRulesForm=!1,dashboardId=_this4.dashboardId,url="/v3/dashboard/rule/".concat(dashboardId,"/list"),_this4.dashboardTabId()&&(url=url+"/"+_this4.dashboardTabId()),_context3.next=6,api/* API */.bl.get(url);case 6:_yield$API$get3=_context3.sent,data=_yield$API$get3.data,error=_yield$API$get3.error,error?_this4.$message.error(error.message||"Error Occured"):(_ref4=data||{},dashboard_rule=_ref4.dashboard_rule,_this4.dashboardRuleList=dashboard_rule),_this4.loading=!1;case 11:case"end":return _context3.stop()}}),_callee3)})))()},openForm:function(){this.openRulesForm=!0,this.isNew=!1,this.presentDashboardRule={}},closeForm:function(){this.openRulesForm=!1},getTargetWidgetName:function(triggerWidget){var _ref5=triggerWidget||{},trigger_widget_id=_ref5.trigger_widget_id,triggerWidgetName=this.triggerWidgetList.find((function(widget){return widget.value===trigger_widget_id})),_ref6=triggerWidgetName||{},label=_ref6.label;return label},editRule:function(id){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var url,_yield$API$get4,error,data,_ref7,dashboard_rule;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _this5.openRulesForm=!0,_this5.isNew=!0,url="/v3/dashboard/rule/"+id,_context4.next=5,api/* API */.bl.get(url);case 5:_yield$API$get4=_context4.sent,error=_yield$API$get4.error,data=_yield$API$get4.data,error?_this5.$message.error(error.message||"Error Occured"):(_ref7=data||{},dashboard_rule=_ref7.dashboard_rule,_this5.presentDashboardRule=dashboard_rule);case 9:case"end":return _context4.stop()}}),_callee4)})))()},deleteRuleConfirm:function(id){var _this6=this,dialogObj={title:"Delete Rule",htmlMessage:"Are you sure want to delete rule?",rbDanger:!0,rbLabel:"Confirm"};this.$dialog.confirm(dialogObj).then((function(value){value&&_this6.deleteRule(id)}))},deleteRule:function(id){var _this7=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var url,_yield$API$delete,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return url="/v3/dashboard/rule/delete/"+id,_context5.next=3,api/* API */.bl.delete(url);case 3:_yield$API$delete=_context5.sent,error=_yield$API$delete.error,error?_this7.$message.error(error.message||"Error Occured"):_this7.$message.success("Rule deleted successfully."),_this7.loadRulesList();case 7:case"end":return _context5.stop()}}),_callee5)})))()}}},rules_DashboardRulesvue_type_script_lang_js=DashboardRulesvue_type_script_lang_js,DashboardRules_component=(0,componentNormalizer/* default */.Z)(rules_DashboardRulesvue_type_script_lang_js,render,staticRenderFns,!1,null,"39441daa",null)
/* harmony default export */,DashboardRules=DashboardRules_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/4406.js.map