"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[55150],{
/***/655150:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return RuleAssetsNAlarm}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/rule/RuleAssetsNAlarm.vue?vue&type=template&id=f8e76362
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"p30"},[_vm.loading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm.values?_c("div",{staticClass:"f14"},[_c("div",{staticClass:"fc-black-13 text-uppercase text-left bold"},[_vm._v(" "+_vm._s(_vm.$t("common.header.assets"))+" ")]),_c("div",{staticClass:"flex-middle flex-row pB30 border-bottom3 pT10 pointer",on:{click:function($event){return _vm.openAssets()}}},[_c("div",{staticClass:"mR15 summary-widget-icon-bg tarquish"},[_c("InlineSvg",{attrs:{src:"svgs/asset1",iconClass:"icon icon-md fc-white-color text-center vertical-baseline"}})],1),_c("div",{staticClass:"fc-black-14 pR20 text-left"},[_c("span",{domProps:{innerHTML:_vm._s(_vm.resourceLabels)}})])]),_c("div",{staticClass:"fc-black-13 pT30 text-uppercase text-left bold"},[_vm._v(" "+_vm._s(_vm.$t("common.header.faults"))+" ")]),_c("div",{staticClass:"flex-middle flex-row pT10 pointer",on:{click:function($event){_vm.values.activeAlarms>0&&_vm.openAlarm(!0)}}},[_c("div",{staticClass:"mR15 summary-widget-icon-bg red"},[_c("InlineSvg",{attrs:{src:"svgs/alarm",iconClass:"icon icon-md fc-white-color text-center vertical-baseline"}})],1),_c("div",{staticClass:"fc-black-14 text-left pR20 line-height20"},[_vm.values.activeAlarms>0?_c("span",{staticClass:"fc-black-14 text-left bold"},[_vm._v(_vm._s(_vm.values.activeAlarms))]):_c("span",{staticClass:"fc-black-14"},[_vm._v(_vm._s(_vm.$t("common.products.no"))+" ")]),_c("span",{staticClass:"fc-black-14"},[_vm._v(" "+_vm._s(_vm.$t("asset.assets.active_faults")))])])]),_c("div",{staticClass:"flex-middle flex-row pT20 pointer",on:{click:function($event){_vm.values.alarmRuleThisWeek>0&&_vm.openAlarm()}}},[_c("div",{staticClass:"mR15 summary-widget-icon-bg orange"},[_c("InlineSvg",{staticStyle:{"padding-top":"3px","padding-left":"2px"},attrs:{src:"svgs/calendar",iconClass:"icon icon-md fc-white-color text-center"}})],1),_c("div",{staticClass:"fc-black-14 text-left pR20 line-height20"},[_vm.values.alarmRuleThisWeek>0?_c("span",{staticClass:"bold"},[_vm._v(" "+_vm._s(_vm.values.alarmRuleThisWeek)+" ")]):_c("span",{staticClass:"fc-black-14"},[_vm._v(_vm._s(_vm.$t("common.products.no"))+" ")]),_c("span",{staticClass:"fc-black-14"},[_vm._v(_vm._s(_vm.$t("rule.create.faults_this_week")))]),_c("span",{staticClass:"bold"},[_vm._v(" "+_vm._s(_vm.values.alarmRuleThisWeek>0?" across "+_vm.values.alarmThisWeekResources.length+" Assets":"")+" ")])])])]):_vm._e()])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),InlineSvg=(__webpack_require__(260228),__webpack_require__(76265),__webpack_require__(648324),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(434284),__webpack_require__(634338),__webpack_require__(450886),__webpack_require__(586166)),vuex_esm=__webpack_require__(420629),api=__webpack_require__(32284),validation=__webpack_require__(990260),router=__webpack_require__(329435),RuleAssetsNAlarmvue_type_script_lang_js={components:{InlineSvg:InlineSvg/* default */.Z},props:["details"],data:function(){return{loading:!1,values:null,category:null,assetCount:null,selectedResourceList:null}},created:function(){this.$store.dispatch("loadAssetCategory")},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory"])),{},{resourceLabels:function(){return this.resourceLabel()},ruleId:function(){var details=this.details,_ref=details||{},moduleName=_ref.moduleName,alarmRule=_ref.alarmRule,ruleId=null;return ruleId="newreadingrules"===moduleName?this.$getProperty(details,"id",null):this.$getProperty(alarmRule,"preRequsite.id",null),ruleId},assetCategoryId:function(){var details=this.details,_ref2=details||{},moduleName=_ref2.moduleName,alarmRule=_ref2.alarmRule,assetCategoryId="";if("newreadingrules"===moduleName){var _ref3=details||{},assetCategory=_ref3.assetCategory;assetCategoryId=this.$getProperty(assetCategory,"id","")}else{var _ref4=alarmRule||{},preRequsite=_ref4.preRequsite,_ref5=preRequsite||{},ruleAssetCategoryId=_ref5.assetCategoryId;assetCategoryId=ruleAssetCategoryId||-1}return assetCategoryId},specificAssets:function(){var _ref6=this||{},details=_ref6.details,_ref7=details||{},assets=_ref7.assets;return assets}}),mounted:function(){this.loadAlarmDetails()},methods:{loadAlarmDetails:function(){var _this=this;this.loading=!0;var workFlowId=null,ruleId=this.ruleId;workFlowId=this.$helpers.isLicenseEnabled("NEW_ALARMS")?50:102,this.$util.getdefaultWorkFlowResult(workFlowId,ruleId).then((function(d){_this.values=d,_this.loading=!1}))},loadAssetCount:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var url,query,filterString,_yield$API$get,data,error,assetCount;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return url="asset/assetCount?viewName=all&count=true",query={category:{operatorId:36,value:[JSON.stringify(_this2.category.id)]}},filterString=encodeURIComponent(JSON.stringify(query)),url=url+"&filters="+filterString,_context.next=6,api/* API */.bl.get(url);case 6:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error||(assetCount=data.assetCount,_this2.assetCount=assetCount);case 10:case"end":return _context.stop()}}),_callee)})))()},openAssets:function(){var values=[],url="/app/at/assets/all?search=",filterObj=null;if(this.selectedResourceList?(this.selectedResourceList.forEach((function(element){values.push("".concat(element.id))})),filterObj={id:[{operatorId:36,value:values}]},url+=encodeURIComponent(JSON.stringify(filterObj))):(0,validation/* isEmpty */.xb)(this.specificAssets)?(filterObj={category:{operatorId:36,value:[JSON.stringify(this.category.id)]}},url+=encodeURIComponent(JSON.stringify(filterObj))):(this.specificAssets&&this.specificAssets.forEach((function(element){values.push("".concat(element))})),filterObj={id:{operatorId:36,value:values}},url+=encodeURIComponent(JSON.stringify(filterObj))),(0,router/* isWebTabsEnabled */.tj)()){var filter=JSON.stringify(filterObj),_findRouteForModule=(0,router/* findRouteForModule */.Jp)("asset",router/* pageTypes */.As.LIST),name=_findRouteForModule.name;name&&this.$router.push({name:name,params:{viewname:"all"},query:{search:filter}})}else this.$router.push({path:url})},openAlarm:function(isActive){var url="/app/fa/faults/",filterObj=null;if(isActive?(filterObj={rule:{operatorId:36,value:[JSON.stringify(this.ruleId)]}},url+="active?&includeParentFilter=true&search="+encodeURIComponent(JSON.stringify(filterObj))):(filterObj={rule:{operatorId:36,value:[JSON.stringify(this.ruleId)]},lastOccurredTime:{operatorId:31}},url+="all?search="+encodeURIComponent(JSON.stringify(filterObj))),(0,router/* isWebTabsEnabled */.tj)()){var filter=JSON.stringify(filterObj),_findRouteForModule2=(0,router/* findRouteForModule */.Jp)("newreadingalarm",router/* pageTypes */.As.LIST),name=_findRouteForModule2.name;name&&this.$router.push({name:name,params:{viewname:isActive?"active":"all"},query:{search:filter}})}else this.$router.push({path:url})},resourceLabel:function(){var _ref8=this||{},details=_ref8.details,category=_ref8.category,_ref9=details||{},matchedassetcount=_ref9.matchedassetcount,_ref10=category||{},name=_ref10.name;if(this.assetCategoryId>0&&(this.category=this.getAssetCategory(this.assetCategoryId)),(0,validation/* isEmpty */.xb)(this.specificAssets)){var ids=this.$getProperty(this,"details.matchedassetids");if(ids&&(this.selectedResourceList=ids.map((function(id){return{id:id}}))),this.loadAssetCount(),ids&&this.assetCount!==matchedassetcount)return 0===matchedassetcount?"No  ".concat(name):"".concat(matchedassetcount," ").concat(name," included");var _str=this.assetCount>1?" Assets":"Asset";return"All ".concat(name," ( ").concat(this.assetCount," ").concat(_str," )")}this.assetCount=this.specificAssets.length;var str=str=this.assetCount>1?" Assets":" Asset";return"Specific Assets -\n          ".concat(this.category.name,"\n          (\n          ").concat(this.assetCount,"\n          ").concat(str,"\n          )")}// resourceLabel() {
//   let isIncludeResource
//   // let selectedResourceList
//   if (this.details.alarmRule.preRequsite.assetCategoryId > 0) {
//     this.category = this.getAssetCategory(
//       this.details.alarmRule.preRequsite.assetCategoryId
//     )
//     if (
//       this.details.alarmRule.preRequsite.includedResources &&
//       this.details.alarmRule.preRequsite.includedResources.length
//     ) {
//       isIncludeResource = true
//       this.selectedResourceList = this.details.alarmRule.preRequsite.includedResources.map(
//         id => ({ id: id })
//       )
//     } else if (this.details.alarmRule.preRequsite.excludedResources) {
//       this.selectedResourceList = this.details.alarmRule.preRequsite.excludedResources.map(
//         id => ({ id: id })
//       )
//     }
//     let message
//     let selectedCount = this.details.alarmRule.preRequsite.excludedResources
//       ? this.details.alarmRule.preRequsite.excludedResources
//       : this.details.alarmRule.preRequsite.includedResources
//       ? this.details.alarmRule.preRequsite.includedResources
//       : null
//     if (selectedCount) {
//       let includeMsg = isIncludeResource ? 'included' : 'excluded'
//       message =
//         selectedCount.length +
//         ' ' +
//         this.category.name +
//         (selectedCount > 1 ? 's' : '') +
//         ' ' +
//         includeMsg
//     } else {
//       message = 'All ' + this.category.name
//       this.loadAssetCount()
//     }
//     return message ? `${message}` : `--`
//   }
//   return null
// },
}},rule_RuleAssetsNAlarmvue_type_script_lang_js=RuleAssetsNAlarmvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(rule_RuleAssetsNAlarmvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,RuleAssetsNAlarm=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/55150.js.map