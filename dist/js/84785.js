"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[84785],{
/***/584785:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return Publish}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/pm/create/pages/Publish.vue?vue&type=template&id=ef4eeeaa&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"publish-container"},[_vm.isPlannerListLoading?_c("div",{staticClass:"width100"},[_c("div",{staticClass:"d-flex mT50 planner-body"},[_c("spinner",{attrs:{show:_vm.isPlannerListLoading}})],1)]):[_c("div",{class:_vm.publishDescClass},[_vm.canShowWarning?_c("i",{staticClass:"fa fa-exclamation-triangle mR10 f18",attrs:{"aria-hidden":"true"}}):_vm._e(),_vm._v(" "+_vm._s(_vm.publishDescription)+" ")]),_c("div",{staticClass:"publish-sub-container"},[_c("div",{staticClass:"section-heading mB10 mT20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.summary"))+" ")]),_vm.$validation.isEmpty(_vm.plannerList)?_c("div",{staticClass:"planner-empty-state pm-content-width"},[_c("inline-svg",{attrs:{src:"svgs/emptystate/readings-empty",iconClass:"icon text-center icon-xxxxlg"}}),_c("div",{staticClass:"empty-state-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm.no_planner"))+" ")])],1):_c("div",{staticClass:"planner-list-container"},_vm._l(_vm.plannerList,(function(planner){return _c("div",{key:planner.id,staticClass:"summary-item-container"},[_c("div",{staticClass:"summary-header"},[_vm._v(_vm._s(planner.name))]),_c("div",{staticClass:"summary-container"},[_c("div",{staticClass:"summary-field-container mR50"},[_c("span",{staticClass:"summary-field-label"},[_vm._v(_vm._s(_vm.$t("maintenance.pm.trigger_frequency"))+": ")]),_c("span",{staticClass:"summary-field-value"},[_vm._v(" "+_vm._s(_vm.getFrequency(planner)))])]),_c("div",{staticClass:"summary-field-container"},[_c("span",{staticClass:"summary-field-label"},[_vm._v(_vm._s(_vm.getFormattedText(_vm.$t("maintenance.pm.resource_count")))+": ")]),_c("span",{staticClass:"summary-field-value"},[_vm._v(" "+_vm._s(_vm.getResourceCount(planner)))])])]),_vm.$validation.isEmpty(_vm.getErrorMessage(planner))?_vm._e():_c("div",{staticClass:"planner-error-msg"},[_vm._v(" "+_vm._s(_vm.getErrorMessage(planner))+" ")])])})),0)])]],2)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),validation=(__webpack_require__(169358),__webpack_require__(976801),__webpack_require__(648324),__webpack_require__(450886),__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(990260)),api=__webpack_require__(32284),pm_utils=__webpack_require__(195123),router=__webpack_require__(329435),Publishvue_type_script_lang_js={props:["pmProps","disableButton"],data:function(){return{plannerList:[],isPlannerListLoading:!1,moduleName:"pmPlanner",pmRecord:{},canShowWarning:!1}},created:function(){this.init()},computed:{publishDescClass:function(){var canShowWarning=this.canShowWarning;return canShowWarning?"publish-warning":"publish-description"},publishDescription:function(){var canShowWarning=this.canShowWarning;return canShowWarning?this.$t("maintenance.pm.publish_warning_msg"):this.$t("maintenance.pm.publish_desc")}},methods:{init:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.loadPm();case 2:_this.loadPlanners();case 3:case"end":return _context.stop()}}),_callee)})))()},loadPm:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var moduleName,_ref,pmProps,id,_yield$API$fetchRecor,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this2.isPlannerListLoading=!0,moduleName="plannedmaintenance",_ref=_this2||{},pmProps=_ref.pmProps,id=pmProps.id,_context2.next=6,api/* API */.bl.fetchRecord(moduleName,{id:id},{force:!0});case 6:_yield$API$fetchRecor=_context2.sent,data=_yield$API$fetchRecor[moduleName],error=_yield$API$fetchRecor.error,(0,validation/* isEmpty */.xb)(error)?_this2.pmRecord=data:_this2.$message.error(error.message||"Error occured while fetching planned maintenance"),_this2.isPlannerListLoading=!1;case 11:case"end":return _context2.stop()}}),_callee2)})))()},getFrequency:function(planner){var schedule=this.$getProperty(planner,"trigger.schedule"),facilioFrequency=this.$getProperty(this,"$constants.FACILIO_FREQUENCY");if(!(0,validation/* isEmpty */.xb)(schedule)){schedule=JSON.parse(schedule);var _ref2=schedule||{},frequencyType=_ref2.frequencyType;return["MONTHLY_DATE","MONTHLY_WEEK"].includes(pm_utils/* FREQUENCY_HASH */.UC[frequencyType])?frequencyType=3:["QUARTERLY_DATE","QUARTERLY_WEEK"].includes(pm_utils/* FREQUENCY_HASH */.UC[frequencyType])?frequencyType=4:["HALF_YEARLY_DATE","HALF_YEARLY_WEEK"].includes(pm_utils/* FREQUENCY_HASH */.UC[frequencyType])?frequencyType=5:["ANNUALLY_DATE","ANNUALLY_WEEK"].includes(pm_utils/* FREQUENCY_HASH */.UC[frequencyType])&&(frequencyType=6),facilioFrequency[frequencyType]?facilioFrequency[frequencyType]:frequencyType}return this.$t("maintenance.pm.not_defined")},getResourceCount:function(planner){var _ref3=planner||{},resourceCount=_ref3.resourceCount;return resourceCount||0},getErrorMessage:function(planner){var plannerfrequency=this.getFrequency(planner),resourceCount=this.getResourceCount(planner);return"Not Defined"!==plannerfrequency||resourceCount?"Not Defined"===plannerfrequency?this.$t("maintenance.pm.planner_freq_empty"):resourceCount?"":this.getFormattedText(this.$t("maintenance.pm.planner_resource_empty"),!1,!0):this.getFormattedText(this.$t("maintenance.pm.planner_trigger_empty"),!1,!0)},loadPlanners:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _ref4,moduleName,pmProps,_ref5,id,params,filters,_yield$API$fetchAll,list,error,promises,result;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this3.isPlannerListLoading=!0,_ref4=_this3||{},moduleName=_ref4.moduleName,pmProps=_ref4.pmProps,_ref5=pmProps||{},id=_ref5.id,params={},(0,validation/* isEmpty */.xb)(id)||(filters=JSON.stringify({pmId:{operatorId:9,value:["".concat(id)]}}),params=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},params),{},{filters:filters})),_context3.next=7,api/* API */.bl.fetchAll(moduleName,params,{force:!0});case 7:if(_yield$API$fetchAll=_context3.sent,list=_yield$API$fetchAll.list,error=_yield$API$fetchAll.error,!(0,validation/* isEmpty */.xb)(error)){_context3.next=18;break}return promises=list.map((function(planner){return _this3.loadPlanner(planner)})),_context3.next=14,Promise.all(promises);case 14:return result=_context3.sent,_this3.plannerList=result,_context3.next=18,_this3.canShowWarningBanner();case 18:_this3.isPlannerListLoading=!1;case 19:case"end":return _context3.stop()}}),_callee3)})))()},loadPlanner:function(planner){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var _ref6,moduleName,_ref7,id,_yield$API$fetchRecor2,record,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _ref6=_this4||{},moduleName=_ref6.moduleName,_ref7=planner||{},id=_ref7.id,_context4.next=4,api/* API */.bl.fetchRecord(moduleName,{id:id},{force:!0});case 4:if(_yield$API$fetchRecor2=_context4.sent,record=_yield$API$fetchRecor2[moduleName],error=_yield$API$fetchRecor2.error,!(0,validation/* isEmpty */.xb)(error)){_context4.next=11;break}return _context4.abrupt("return",(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},planner),record));case 11:return _context4.abrupt("return",planner);case 12:case"end":return _context4.stop()}}),_callee4)})))()},canShowWarningBanner:function(){var _this5=this,plannerList=this.plannerList;plannerList.forEach((function(planner){var canShowWrng=!1,_ref8=planner||{},trigger=_ref8.trigger,_ref8$resourceCount=_ref8.resourceCount,resourceCount=void 0===_ref8$resourceCount?null:_ref8$resourceCount,_ref9=trigger||{},schedule=_ref9.schedule;if(canShowWrng=(0,validation/* isEmpty */.xb)(schedule)||(0,validation/* isEmpty */.xb)(resourceCount),canShowWrng)return _this5.canShowWarning=canShowWrng,void _this5.$emit("update:disableButton",canShowWrng)}))},onSave:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var _ref10,pmProps,viewname,_ref11,pmId,_yield$API$post,error,params,_ref12,name;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return _ref10=_this6||{},pmProps=_ref10.pmProps,viewname=_ref10.viewname,_ref11=pmProps||{},pmId=_ref11.id,_context5.next=4,api/* API */.bl.post("/v3/plannedmaintenance/publish",{pmId:pmId});case 4:_yield$API$post=_context5.sent,error=_yield$API$post.error,(0,validation/* isEmpty */.xb)(error)?(_this6.$message.success(_this6.$t("maintenance.pm.published_successfully")),params={id:pmId,viewname:(0,validation/* isEmpty */.xb)(viewname)?"all":viewname},(0,router/* isWebTabsEnabled */.tj)()?(_ref12=(0,router/* findRouteForModule */.Jp)("plannedmaintenance",router/* pageTypes */.As.OVERVIEW)||{},name=_ref12.name,name&&_this6.$router.push({name:name,params:params})):_this6.$router.push({name:"pm-summary",params:params})):_this6.$message.error(error.message||"Error occured");case 7:case"end":return _context5.stop()}}),_callee5)})))()},onCancel:function(){var _ref13=this||{},$route=_ref13.$route,_ref14=$route||{},query=_ref14.query;this.$router.push({path:"",query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},query),{},{tab:"planner"})})},getFormattedText:function(text,isUpperCase,isSingular){var _ref15=this||{},pmRecord=_ref15.pmRecord;return(0,pm_utils/* getPlaceholderText */.Sb)({pmRecord:pmRecord,text:text,isUpperCase:isUpperCase,isSingular:isSingular})}}},pages_Publishvue_type_script_lang_js=Publishvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(pages_Publishvue_type_script_lang_js,render,staticRenderFns,!1,null,"ef4eeeaa",null)
/* harmony default export */,Publish=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/84785.js.map