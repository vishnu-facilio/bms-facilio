"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[37710],{
/***/676474:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return V3LookupFieldWizard}});
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js
var render,staticRenderFns,regeneratorRuntime=__webpack_require__(150124),objectSpread2=__webpack_require__(595082),asyncToGenerator=__webpack_require__(548534),FLookupFieldWizard=(__webpack_require__(648324),__webpack_require__(499751)),api=__webpack_require__(32284),validation=__webpack_require__(990260),V3LookupFieldWizardvue_type_script_lang_js={name:"V3LookupFieldWizard",extends:FLookupFieldWizard["default"],methods:{fetchModulesData:function(){var _arguments=arguments,_this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var skipResetPage,moduleName,_this$filters,filters,perPage,page,_this$withReadings,withReadings,selectedLookupField,_ref,clientCriteria,additionalParams,_yield$API$fetchAll,list,meta,error,totalCount;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return skipResetPage=_arguments.length>0&&void 0!==_arguments[0]&&_arguments[0],moduleName=_this.moduleName,_this$filters=_this.filters,filters=void 0===_this$filters?{}:_this$filters,perPage=_this.perPage,page=_this.page,_this$withReadings=_this.withReadings,withReadings=void 0===_this$withReadings?null:_this$withReadings,selectedLookupField=_this.selectedLookupField,_ref=selectedLookupField||{},clientCriteria=_ref.clientCriteria,additionalParams=_ref.additionalParams,_context.next=5,api/* API */.bl.fetchAll(moduleName,(0,objectSpread2/* default */.Z)({withCount:!0,page:(0,validation/* isEmpty */.xb)(filters)||skipResetPage?page:1,filters:(0,validation/* isEmpty */.xb)(filters)?null:JSON.stringify(filters),perPage:perPage,viewName:"hidden-all",withReadings:withReadings,clientCriteria:(0,validation/* isEmpty */.xb)(clientCriteria)?null:JSON.stringify(clientCriteria)},additionalParams));case 5:_yield$API$fetchAll=_context.sent,list=_yield$API$fetchAll.list,meta=_yield$API$fetchAll.meta,error=_yield$API$fetchAll.error,totalCount=_this.$getProperty(meta,"pagination.totalCount",null),error?_this.$message.error(error.message):((0,validation/* isNullOrUndefined */.le)(list)||_this.$set(_this,"modulesList",list),(0,validation/* isNullOrUndefined */.le)(totalCount)||_this.$set(_this,"totalCount",totalCount)),_this.isSearchDataLoading=!1;case 12:case"end":return _context.stop()}}),_callee)})))()},loadDataCount:function(){}}},components_V3LookupFieldWizardvue_type_script_lang_js=V3LookupFieldWizardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_V3LookupFieldWizardvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,V3LookupFieldWizard=component.exports;
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
},
/***/437710:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return WorkAssetLineItem}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/safetyplan/sp/WorkAssetLineItem.vue?vue&type=template&id=708da8ab&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticStyle:{height:"100%"}},[_vm.isLoading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.isLoading,size:"80"}})],1):[_c("LineItemList",_vm._b({ref:"lineItemComponent",staticStyle:{height:"100%"},attrs:{config:_vm.listConfiguration,moduleDisplayName:_vm.moduleDisplayName,moduleName:_vm.moduleName,widgetDetails:_vm.widgetDetails,viewname:"hidden-all"},on:{emptyStateBtn:_vm.showWizard},scopedSlots:_vm._u([{key:"footer",fn:function(){return[_c("el-button",{staticClass:"line-item-list-footer-add-btn",attrs:{type:"primary"},on:{click:function($event){return _vm.showWizard()}}},[_vm._v(" "+_vm._s(_vm.$t("common.safetyPlan.select_workAsset"))+" ")])]},proxy:!0}])},"LineItemList",_vm.$attrs,!1)),_vm.showMsgPopup?_c("WorkAssetForm",{key:_vm.showMsgPopup,attrs:{details:_vm.details,availableAssets:_vm.availableAssets,availableSpaces:_vm.availableSpaces,moduleDisplayName:_vm.moduleDisplayName},on:{getWorkAssetHazards:_vm.getWorkAssetHazards,closeDialog:_vm.closeDialog}}):_vm._e()]],2)},staticRenderFns=[],defineProperty=__webpack_require__(482482),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),LineItemListOld=(__webpack_require__(648324),__webpack_require__(450886),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(976801),__webpack_require__(666237)),V3LookupFieldWizard=__webpack_require__(676474),api=__webpack_require__(32284),eventBus=__webpack_require__(398011),validation=__webpack_require__(990260),FLookupField=__webpack_require__(855048),WorkAssetFormvue_type_template_id_65698a58_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-form",[_c("el-dialog",{staticClass:"agents-dialog fc-dialog-center-container dialog-padding",staticStyle:{"z-index":"9999999999"},attrs:{title:_vm.$t("common.safetyPlan.workAssets"),visible:_vm.showMsgPopup,width:"40%","append-to-body":!0},on:{"update:visible":function($event){_vm.showMsgPopup=$event}}},[_c("div",{staticClass:"label-txt-black line-height24 height300 overflow-y-scroll pB50"},[_c("el-form-item",{attrs:{prop:"asset",label:"Asset"}},[_c("FLookupField",{attrs:{model:_vm.selectedAsset,field:_vm.assetField,disabled:!_vm.$validation.isEmpty(_vm.selectedSpace)},on:{"update:model":function($event){_vm.selectedAsset=$event},showLookupWizard:function($event){return _vm.openCloseWizard("asset",!0)}}})],1),_c("el-form-item",{attrs:{prop:"space",label:"Space"}},[_c("FLookupField",{attrs:{model:_vm.selectedSpace,disabled:!_vm.$validation.isEmpty(_vm.selectedAsset),field:_vm.spaceField},on:{"update:model":function($event){_vm.selectedSpace=$event},showLookupWizard:function($event){return _vm.openCloseWizard("space",!0)}}})],1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){return _vm.showDialog(!1)}}},[_vm._v(_vm._s(_vm.$t("agent.agent.cancel")))]),_c("el-button",{staticClass:"modal-btn-save f13",attrs:{disabled:!_vm.selectedAsset&&!_vm.selectedSpace},on:{click:function($event){return _vm.saveRecord()}}},[_vm._v(_vm._s(_vm.$t("common.failure_class.save")))])],1)])],1),_vm.canShowWizard?_c("V3LookupFieldWizard",{attrs:{canShowLookupWizard:_vm.canShowWizard,selectedLookupField:_vm.wizardField},on:{"update:canShowLookupWizard":function($event){_vm.canShowWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowWizard=$event},setLookupFieldValue:_vm.setLookUpValue}}):_vm._e()],1)},WorkAssetFormvue_type_template_id_65698a58_staticRenderFns=[],WorkAssetFormvue_type_script_lang_js={props:["details","availableAssets","availableSpaces","moduleDisplayName"],components:{V3LookupFieldWizard:V3LookupFieldWizard/* default */.Z,FLookupField:FLookupField/* default */.Z},data:function(){return{canShowWizard:!1,wizardField:null,selectedAsset:null,selectedSpace:null,selectedModule:null,showMsgPopup:!0}},computed:{assetField:function(){var _this$details,_ref=this||{},availableAssets=_ref.availableAssets,field={isDataLoading:!1,options:[],lookupModuleName:"asset",field:{lookupModule:{name:"asset",displayName:"Asset"}},multiple:!1,forceFetchAlways:!0,selectedItems:[],filters:{siteId:{operatorId:9,value:["".concat(null===(_this$details=this.details)||void 0===_this$details?void 0:_this$details.siteId)]}}};if(availableAssets.length){var _ref2=field||{},filters=_ref2.filters,_ref3=filters||{},id=_ref3.id;field=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},field),{},{filters:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},filters),{},{id:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},id),{},{operatorId:37,value:availableAssets})})})}return field},spaceField:function(){var _this$details2,availableSpaces=this.availableSpaces,field={isDataLoading:!1,options:[],lookupModuleName:"basespace",field:{lookupModule:{name:"basespace",displayName:"Space"}},multiple:!1,forceFetchAlways:!0,selectedItems:[],filters:{siteId:{operatorId:9,value:["".concat(null===(_this$details2=this.details)||void 0===_this$details2?void 0:_this$details2.siteId)]}}};return(0,validation/* isEmpty */.xb)(availableSpaces)||(field["filters"]["id"]={operatorId:37,value:this.availableSpaces}),field}},watch:{showMsgPopup:{handler:function(oldVal,newVal){oldVal!=newVal&&this.$emit("closeDialog")}}},methods:{init:function(){this.selectedSpace=null,this.selectedAsset=null,this.wizardField=null},openCloseWizard:function(moduleName,canShow){["asset","space"].includes(moduleName)?(this.wizardField="asset"===moduleName?this.assetField:this.spaceField,this.selectedModule=moduleName,this.canShowWizard=canShow):this.canShowWizard=!1},setLookUpValue:function(selectedValue){var selectedModule=this.selectedModule,field=this.$getProperty(selectedValue,"field"),selectedData=this.$getProperty(field,"selectedItems");if(!(0,validation/* isEmpty */.xb)(selectedData)){var data=selectedData[0];"asset"===selectedModule?this.selectedAsset=null===data||void 0===data?void 0:data.value:"space"===selectedModule&&(this.selectedSpace=null===data||void 0===data?void 0:data.value)}this.openCloseWizard(!1)},showDialog:function(canShow){this.init(),canShow||(this.canShowWizard=canShow),this.$emit("closeDialog")},saveRecord:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var moduleDisplayName,selectedAsset,selectedSpace,safetyPlanId,successMsg,data,response,_ref4,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(moduleDisplayName=_this.moduleDisplayName,selectedAsset=_this.selectedAsset,selectedSpace=_this.selectedSpace,safetyPlanId=_this.details.id,successMsg="".concat(moduleDisplayName," added successfully!"),!selectedAsset&&!selectedSpace){_context.next=12;break}return data={asset:{id:selectedAsset},space:{id:selectedSpace},safetyPlan:{id:safetyPlanId}},_this.isSaving=!0,_context.next=8,api/* API */.bl.createRecord("workAsset",{data:data});case 8:response=_context.sent,_ref4=response||{},error=_ref4.error,_this.isSaving=!1,error?_this.$message.error((null===error||void 0===error?void 0:error.message)||_this.$t("common.safetyPlan.error_occured")):(successMsg&&_this.$message.success(successMsg),_this.showDialog(!1),(0,validation/* isEmpty */.xb)(selectedAsset)?_this.$emit("getWorkAssetHazards",selectedSpace,"space"):_this.$emit("getWorkAssetHazards",selectedAsset,"asset"));case 12:case"end":return _context.stop()}}),_callee)})))()}}},sp_WorkAssetFormvue_type_script_lang_js=WorkAssetFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(sp_WorkAssetFormvue_type_script_lang_js,WorkAssetFormvue_type_template_id_65698a58_render,WorkAssetFormvue_type_template_id_65698a58_staticRenderFns,!1,null,null,null)
/* harmony default export */,WorkAssetForm=component.exports,EQUALS_OPERATOR=9,WorkAssetLineItemvue_type_script_lang_js={props:["widget","details"],components:{LineItemList:LineItemListOld/* default */.Z,V3LookupFieldWizard:V3LookupFieldWizard/* default */.Z,FLookupField:FLookupField/* default */.Z,WorkAssetForm:WorkAssetForm},data:function(){return{isLoading:!1,parentModuleName:null,showMsgPopup:!1,availableAssets:[],availableSpaces:[]}},computed:{moduleName:function(){return"workAsset"},moduleDisplayName:function(){return"Work Assets"},filters:function(){var details=this.details,id=details.id,filterObj={};return filterObj["safetyPlan"]={operatorId:36,value:["".concat(id)]},filterObj},editConfig:function(){return{canHideEdit:!0}},deleteConfig:function(){return{canHideDelete:!1}},quickCreateConfig:function(){return{canHideAddBtn:!0}},searchAndFilterConfig:function(){return{canHideSearch:!0,canHideFilter:!1}},listConfiguration:function(){var filters=this.filters,editConfig=this.editConfig,deleteConfig=this.deleteConfig,searchAndFilterConfig=this.searchAndFilterConfig,quickCreateConfig=this.quickCreateConfig;return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({expand:!1,isSelectionEnabled:!1,isIndexEnabled:!1,filters:filters,mainfieldAction:function(){},canHideFooter:!0},editConfig||{}),deleteConfig||{}),quickCreateConfig||{}),searchAndFilterConfig||{}),{},{canEnableMainFieldAction:!1})},widgetDetails:function(){var moduleDisplayName=this.moduleDisplayName,emptyStateText=this.$t("common.safetyPlan.no_workasset_added",{moduleName:moduleDisplayName});return{perPage:7,emptyStateText:emptyStateText,emptyStateBtnList:[{label:"Add Work Asset",value:"add_work_asset"}]}}},methods:{init:function(){this.selectedSpace=null,this.selectedAsset=null,this.wizardField=null},showWizard:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var component,workAssets;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:component=_this.$refs["lineItemComponent"],component&&(workAssets=component.recordList,_this.getAvailableSpaceAndAssetIds(workAssets)),_this.showMsgPopup=!0;case 3:case"end":return _context.stop()}}),_callee)})))()},closeDialog:function(){this.showMsgPopup=!1},getWorkAssetHazards:function(selectedData,moduleName){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var filter,params,_yield$API$fetchAll,list,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this2.isLoading=!0,filter=(0,defineProperty/* default */.Z)({},moduleName,{operatorId:EQUALS_OPERATOR,value:["".concat(selectedData)]}),params={withCount:!0,filters:JSON.stringify(filter)},_context2.next=5,api/* API */.bl.fetchAll("".concat(moduleName,"Hazard"),params,{force:!0});case 5:_yield$API$fetchAll=_context2.sent,list=_yield$API$fetchAll.list,error=_yield$API$fetchAll.error,error||(0,validation/* isEmpty */.xb)(list)||_this2.addSpecialModuleHazards(list),_this2.isLoading=!1;case 10:case"end":return _context2.stop()}}),_callee2)})))()},addSpecialModuleHazards:function(list){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var safetyPlanId,safetyPlanHazards,safetyPlanHazardList,url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(safetyPlanId=_this3.$getProperty(_this3,"details.id",null),(0,validation/* isEmpty */.xb)(list)){_context3.next=16;break}return safetyPlanHazards=list.map((function(data){var _data$hazard=data.hazard,hazard=void 0===_data$hazard?{}:_data$hazard,_ref=hazard||{},_ref$id=_ref.id,id=void 0===_ref$id?0:_ref$id;return(0,validation/* isEmpty */.xb)(id)?null:{safetyPlan:{id:safetyPlanId},hazard:{id:id}}})),safetyPlanHazardList=safetyPlanHazards.filter((function(data){return!(0,validation/* isEmpty */.xb)(data)})),url="v3/modules/data/bulkCreate",params={data:{safetyPlanHazard:safetyPlanHazardList},moduleName:"safetyPlanHazard",params:{safetyPlan:safetyPlanId}},_context3.next=8,api/* API */.bl.post(url,params);case 8:if(_yield$API$post=_context3.sent,error=_yield$API$post.error,!error){_context3.next=14;break}_this3.$message.error(error.message||"Error Occured"),_context3.next=16;break;case 14:return _context3.next=16,eventBus/* eventBus */.Y.$emit("refresh-hazards");case 16:case"end":return _context3.stop()}}),_callee3)})))()},getAvailableSpaceAndAssetIds:function(workAssets){this.availableAssets=(workAssets||[]).filter((function(woAsset){var _woAsset$asset;return!(0,validation/* isEmpty */.xb)(null===woAsset||void 0===woAsset||null===(_woAsset$asset=woAsset.asset)||void 0===_woAsset$asset?void 0:_woAsset$asset.id)})).map((function(woAsset){var _woAsset$asset2;return"".concat(null===woAsset||void 0===woAsset||null===(_woAsset$asset2=woAsset.asset)||void 0===_woAsset$asset2?void 0:_woAsset$asset2.id)})),this.availableSpaces=(workAssets||[]).filter((function(woAsset){var _woAsset$space;return!(0,validation/* isEmpty */.xb)(null===woAsset||void 0===woAsset||null===(_woAsset$space=woAsset.space)||void 0===_woAsset$space?void 0:_woAsset$space.id)})).map((function(woAsset){var _woAsset$space2;return"".concat(null===woAsset||void 0===woAsset||null===(_woAsset$space2=woAsset.space)||void 0===_woAsset$space2?void 0:_woAsset$space2.id)}))},refreshList:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var component;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:component=_this4.$refs["lineItemComponent"],component&&component.loadRecords(!0);case 2:case"end":return _context4.stop()}}),_callee4)})))()},getParentModuleName:function(){var pageModuleName=this.$attrs.moduleName,baseSpaces=["site","building","floor","space"];baseSpaces.includes(pageModuleName)?this.parentModuleName="space":this.parentModuleName=pageModuleName},closeWizard:function(){this.$set(this.wizardField,"selectedItems",[]),this.canShowWizard=!1}}},sp_WorkAssetLineItemvue_type_script_lang_js=WorkAssetLineItemvue_type_script_lang_js,WorkAssetLineItem_component=(0,componentNormalizer/* default */.Z)(sp_WorkAssetLineItemvue_type_script_lang_js,render,staticRenderFns,!1,null,"708da8ab",null)
/* harmony default export */,WorkAssetLineItem=WorkAssetLineItem_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/37710.js.map