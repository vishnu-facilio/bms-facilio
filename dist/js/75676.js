"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[75676],{
/***/775676:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return FTags}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/newapp/components/search/FTags.vue?vue&type=template&id=95d4d26a
var FSearchTagMixin_render,FSearchTagMixin_staticRenderFns,render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.$validation.isEmpty(_vm.tagsArr)?_vm._e():_c("div",{staticClass:"tags-container"},[_vm._l(_vm.tagsArr,(function(tag,index){return _c("el-tag",{key:index,staticClass:"tag"},[_c("div",{staticClass:"pR3"},[_vm._v(_vm._s(_vm.getTagName(tag)))]),_c("div",{staticClass:"pR3"},[_vm._v(_vm._s(tag.operatorDisplayName))]),_c("div",{staticClass:"pR5 truncate-text"},[_vm._v(" "+_vm._s(tag.valueStr)+" ")]),_vm.hideClose?_vm._e():_c("InlineSvg",{staticClass:"d-flex",attrs:{src:"svgs/close-circled",iconClass:"icon icon-xs self-center mR5 cursor-pointer close-icon"},nativeOn:{click:function($event){return _vm.clearFilter(tag)}}})],1)})),_vm.hideActionBtn?_vm._e():_c("div",{staticClass:"tags-action"},[_c("div",{staticClass:"tags-clear",on:{click:_vm.resetFilters}},[_vm._v(" "+_vm._s(_vm.$t("filters.tags.clear_all"))+" ")]),_vm.canSaveView?_c("div",{staticClass:"tags-save"},[_vm.isSystemView?_c("span",{on:{click:function($event){return _vm.savingView("new")}}},[_vm._v(_vm._s(_vm.$t("filters.tags.save_view")))]):_c("el-dropdown",{on:{command:_vm.savingView}},[_c("span",{staticClass:"el-dropdown-link"},[_vm._v(" "+_vm._s(_vm.$t("filters.tags.save_view_as"))),_c("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[_c("el-dropdown-item",{staticClass:"text-capitalize",attrs:{command:"new"}},[_vm._v(_vm._s(_vm.$t("filters.tags.save_as_new")))]),_c("el-dropdown-item",{staticClass:"text-capitalize",attrs:{command:"edit"}},[_vm._v(_vm._s(_vm.$t("filters.tags.save_to_existing")))])],1)],1)],1):_vm._e()])],2)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),defineProperty=__webpack_require__(482482),slicedToArray=__webpack_require__(554621),objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),isEqual=(__webpack_require__(976801),__webpack_require__(634338),__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(450886),__webpack_require__(538077),__webpack_require__(336585),__webpack_require__(169358),__webpack_require__(919649),__webpack_require__(85415),__webpack_require__(648324),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(843843),__webpack_require__(879288),__webpack_require__(564043),__webpack_require__(322462),__webpack_require__(618446)),isEqual_default=__webpack_require__.n(isEqual),validation=__webpack_require__(990260),vuex_esm=(__webpack_require__(61514),__webpack_require__(420629)),FSearchTagMixinvue_type_script_lang_js={computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)("search",{fields:function(state){return state.searchableFields}})),{},{appliedFilters:function(){var $route=this.$route,hideQuery=this.hideQuery,filterList=this.filterList,_ref=$route||{},search=_ref.query.search;return hideQuery?filterList:(0,validation/* isEmpty */.xb)(search)?null:JSON.parse(this.$route.query.search)}}),methods:{isLookupField:function(field){var _ref2=field||{},displayType=_ref2.displayType;return["LOOKUP_SIMPLE"].includes(displayType)},isLookupPopupField:function(field){var _ref3=field||{},displayType=_ref3.displayType;return["LOOKUP_POPUP"].includes(displayType)},isMultiLookupField:function(field){var _ref4=field||{},displayType=_ref4.displayType;return["MULTI_LOOKUP_SIMPLE"].includes(displayType)}}},search_FSearchTagMixinvue_type_script_lang_js=FSearchTagMixinvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(search_FSearchTagMixinvue_type_script_lang_js,FSearchTagMixin_render,FSearchTagMixin_staticRenderFns,!1,null,null,null)
/* harmony default export */,FSearchTagMixin=component.exports,utility_methods=__webpack_require__(773258),api=__webpack_require__(32284),router=__webpack_require__(329435),routeUtil=__webpack_require__(405759),TimeFormatMixin=__webpack_require__(128143),cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),dateTimeOperator={84:"Month",85:"Day of Week",101:"Day of Month",102:"Day of Year",103:"Hours of Day",106:"Before N Days",107:"After N Days",108:"Week of Year"},FTagsvue_type_script_lang_js={name:"fTags",props:["showOnlyExisting","hideActionBtn","hideClose","hideSaveView","hideQuery","filterList"],mixins:[FSearchTagMixin],data:function(){return{tagsArr:[],operatorsList:[],simpleFilters:{},oneLevelFilters:{},advancedFields:[],oneLevelFields:[],cachedModule:{}}},created:function(){this.init()},watch:{appliedFilters:function(newVal,oldVal){isEqual_default()(newVal,oldVal)||this.constructTags(newVal)},filterList:{handler:function(newVal){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:(0,validation/* isEmpty */.xb)(newVal)||_this.constructTags(newVal);case 1:case"end":return _context.stop()}}),_callee)})))()},deep:!0},fields:function(newVal,oldVal){if(!isEqual_default()(newVal,oldVal)){var appliedFilters=this.appliedFilters;this.constructTags(appliedFilters)}},moduleName:{handler:function(val){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var appliedFilters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(appliedFilters=_this2.appliedFilters,(0,validation/* isEmpty */.xb)(val)){_context2.next=5;break}return _context2.next=4,_this2.loadFields();case 4:_this2.constructTags(appliedFilters);case 5:case"end":return _context2.stop()}}),_callee2)})))()},immediate:!0},operatorsList:{handler:function(newVal){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var appliedFilters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:(0,validation/* isEmpty */.xb)(newVal)||(appliedFilters=_this3.appliedFilters,_this3.constructTags(appliedFilters));case 1:case"end":return _context3.stop()}}),_callee3)})))()}}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)({getOperatorsList:"getOperatorsList"})),(0,vuex_esm/* mapState */.rn)("view",{currentViewDetail:function(state){return state.currentViewDetail}})),(0,vuex_esm/* mapState */.rn)("search",{currentModuleName:function(state){return state.currentModuleName}})),{},{canSaveView:function(){var _this$hideSaveView=this.hideSaveView,hideSaveView=void 0!==_this$hideSaveView&&_this$hideSaveView,currentViewDetail=this.currentViewDetail;return!hideSaveView&&!(0,validation/* isEmpty */.xb)(currentViewDetail)},isSystemView:function(){var currentViewDetail=this.currentViewDetail,isDefault=currentViewDetail.isDefault;return!!isDefault},existingFilters:function(){var currentViewDetail=this.currentViewDetail,filters=currentViewDetail.filters;return filters},moduleName:function(){var currentViewDetail=this.currentViewDetail,moduleName=currentViewDetail.moduleName;return this.$attrs.moduleName||this.currentModuleName||moduleName},orgCurrency:function(){var $account=this.$account,data=$account.data,currencyInfo=data.currencyInfo,_ref=currencyInfo||{},displaySymbol=_ref.displaySymbol;return displaySymbol}}),methods:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapActions */.nv)({loadOperators:"loadOperators",editView:"view/editView"})),{},{init:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_this4.loadGroupViewsList(),_this4.loadOperators().then((function(){var operatorsList=_this4.getOperatorsList();_this4.$set(_this4,"operatorsList",operatorsList)}));case 2:case"end":return _context4.stop()}}),_callee4)})))()},isLookupTypeField:function(field){var _ref2=field||{},displayType=_ref2.displayType;return["LOOKUP_SIMPLE","MULTI_LOOKUP_SIMPLE"].includes(displayType)},isLookupPopupField:function(field){var _ref3=field||{},displayType=_ref3.displayType;return["LOOKUP_POPUP"].includes(displayType)},getTagName:function(tag){var fieldDisplayName=tag.fieldDisplayName,parentDisplayName=tag.parentDisplayName;return(0,validation/* isEmpty */.xb)(parentDisplayName)?fieldDisplayName:"".concat(parentDisplayName,"/").concat(fieldDisplayName)},loadFields:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var moduleName,url,oneLevelUrl,_yield$Promise$all,_yield$Promise$all2,advancedFieldResponse,oneLevelFieldResponse,advancedFieldData,advancedFieldError,oneLevelFieldData,oneLevelFieldError,_ref4,_ref4$message,message,_ref5,advancedFields,_ref6,fields,_ref7,lookupModuleFields,moduleFields,oneLevelFields;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return moduleName=_this5.moduleName,url="/v2/fields/advancedFilter/".concat(moduleName),oneLevelUrl="/v2/fields/advancedFilter/drilldown/".concat(moduleName,"?OneLevelFields=true"),_context5.next=5,Promise.all([api/* API */.bl.get(url),api/* API */.bl.get(oneLevelUrl)]);case 5:_yield$Promise$all=_context5.sent,_yield$Promise$all2=(0,slicedToArray/* default */.Z)(_yield$Promise$all,2),advancedFieldResponse=_yield$Promise$all2[0],oneLevelFieldResponse=_yield$Promise$all2[1],advancedFieldData=advancedFieldResponse.data,advancedFieldError=advancedFieldResponse.error,oneLevelFieldData=oneLevelFieldResponse.data,oneLevelFieldError=oneLevelFieldResponse.error,advancedFieldError||oneLevelFieldError?(_ref4=oneLevelFieldError||advancedFieldError||{},_ref4$message=_ref4.message,message=void 0===_ref4$message?"Error occured":_ref4$message,_this5.$message.error(message)):(_ref5=advancedFieldData||{},advancedFields=_ref5.fields,_this5.advancedFields=advancedFields.map((function(field){return _this5.isLookupPopupField(field)||_this5.isLookupTypeField(field)?(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},field),{},{multiple:!0,canShowCriteria:!1}):field})),_ref6=oneLevelFieldData||{},fields=_ref6.fields,_ref7=fields||{},lookupModuleFields=_ref7.lookupModuleFields,moduleFields=_ref7.moduleFields,oneLevelFields=moduleFields.filter((function(field){return!(0,validation/* isEmpty */.xb)(field.lookupModuleName)})),oneLevelFields=oneLevelFields.map((function(field){var lookupModuleName=field.lookupModuleName,children=lookupModuleFields[lookupModuleName];return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},field),{},{children:children,canShowChildren:!1})})),_this5.oneLevelFields=oneLevelFields);case 12:case"end":return _context5.stop()}}),_callee5)})))()},loadGroupViewsList:function(){var _this6=this,moduleName=this.moduleName;this.isLoading=!0;var data={moduleName:moduleName};this.$store.dispatch("view/loadGroupViews",data).then((function(){_this6.isLoading=!1}))},constructTags:function(filters){var _this7=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var operatorsList,showOnlyExisting,existingFilters,oneLevelFields,fields,constructedOneLevelFilter,copiedFilters,oneLevelFilters,oneLevelModules,simpleFilters,clonedFilter,existingOneLevelFilters,updatedOneLevelfilters,existingOneLevelModules,tagsArr,list,tags,labelMeta,lookupFieldsArr,_loop,_i,_Object$entries;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context7){while(1)switch(_context7.prev=_context7.next){case 0:if(operatorsList=_this7.operatorsList,showOnlyExisting=_this7.showOnlyExisting,existingFilters=_this7.existingFilters,oneLevelFields=_this7.oneLevelFields,fields=_this7.fields,constructedOneLevelFilter={},(0,validation/* isEmpty */.xb)(fields)||(_this7.advancedFields=fields.map((function(field){return _this7.isLookupPopupField(field)||_this7.isLookupTypeField(field)?(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},field),{},{multiple:!0,canShowCriteria:!1}):field}))),!(0,validation/* isEmpty */.xb)(filters)){_context7.next=5;break}return _context7.abrupt("return");case 5:return copiedFilters=cloneDeep_default()(filters),oneLevelFilters=copiedFilters["oneLevelLookup"]||{},oneLevelFilters=Object.entries(oneLevelFilters).reduce((function(acc,curr){var _curr=(0,slicedToArray/* default */.Z)(curr,2),parentLookup=_curr[0],childFilters=_curr[1];return childFilters=childFilters.map((function(filters){var criteriaValue=filters.criteriaValue;return criteriaValue})),(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},acc),{},(0,defineProperty/* default */.Z)({},parentLookup,childFilters))}),{}),_this7.oneLevelFilters=oneLevelFilters,constructedOneLevelFilter=oneLevelFilters,oneLevelModules=Object.keys(oneLevelFilters),oneLevelModules=(0,toConsumableArray/* default */.Z)(new Set(oneLevelModules)),_context7.next=14,_this7.populateOneLevelModules(oneLevelModules);case 14:if(delete copiedFilters["oneLevelLookup"],_this7.simpleFilters=copiedFilters,!showOnlyExisting){_context7.next=30;break}return simpleFilters=Object.entries(existingFilters).filter((function(obj){var _obj=(0,slicedToArray/* default */.Z)(obj,2),value=_obj[1];if(Array.isArray(value)){var child=value.filter((function(obj){return 35!=obj.operatorId}));return child.length>0}return 35!=value.operatorId})),simpleFilters=simpleFilters.map((function(obj){var _obj2=(0,slicedToArray/* default */.Z)(obj,2),key=_obj2[0],value=_obj2[1];if(Array.isArray(value)){var updatedValue=value.filter((function(filter){return 35!=filter.operatorId}));return[key,updatedValue[0]]}return obj})),_this7.simpleFilters=Object.fromEntries(simpleFilters),clonedFilter=JSON.parse(JSON.stringify(existingFilters)),existingOneLevelFilters=Object.entries(clonedFilter).filter((function(obj){var _obj3=(0,slicedToArray/* default */.Z)(obj,2),value=_obj3[1];if(Array.isArray(value)){var child=value.filter((function(obj){return 35==obj.operatorId}));return child.length>0}return 35==(null===value||void 0===value?void 0:value.operatorId)})),existingOneLevelFilters=existingOneLevelFilters.map((function(obj){var _obj4=(0,slicedToArray/* default */.Z)(obj,2),key=_obj4[0],value=_obj4[1];if(Array.isArray(value)){var updatedValue=value.filter((function(filter){return 35==filter.operatorId}));return updatedValue=updatedValue.map((function(obj){return obj.value})),[key,updatedValue]}if(35==(null===value||void 0===value?void 0:value.operatorId)){var filterValue=value.value,_Object$keys=Object.keys(filterValue),_Object$keys2=(0,slicedToArray/* default */.Z)(_Object$keys,1),firstKey=_Object$keys2[0];return[key,[(0,defineProperty/* default */.Z)({},firstKey,filterValue[firstKey])]]}return obj})),updatedOneLevelfilters=Object.fromEntries(existingOneLevelFilters),_this7.oneLevelFilters=updatedOneLevelfilters,constructedOneLevelFilter=updatedOneLevelfilters,existingOneLevelModules=Object.keys(constructedOneLevelFilter),existingOneLevelModules=(0,toConsumableArray/* default */.Z)(new Set(existingOneLevelModules)),_context7.next=30,_this7.populateOneLevelModules(existingOneLevelModules);case 30:if(tagsArr=[],(0,validation/* isEmpty */.xb)(_this7.simpleFilters)||(0,validation/* isEmpty */.xb)(operatorsList)||(0,validation/* isEmpty */.xb)(_this7.advancedFields)){_context7.next=39;break}if(list=_this7.getTagsList(_this7.simpleFilters,_this7.advancedFields),tags=list.tagsArr,labelMeta=list.labelMeta,lookupFieldsArr=list.lookupFieldsArr,tagsArr=tags,(0,validation/* isEmpty */.xb)(labelMeta)){_context7.next=39;break}return _context7.next=38,_this7.fetchLookupLabels({labelMeta:labelMeta,lookupFieldsArr:lookupFieldsArr,tagsArr:tagsArr,fields:_this7.advancedFields,appliedFilters:_this7.simpleFilters});case 38:tagsArr=_context7.sent;case 39:if((0,validation/* isEmpty */.xb)(constructedOneLevelFilter)||(0,validation/* isEmpty */.xb)(operatorsList)||(0,validation/* isEmpty */.xb)(oneLevelFields)){_context7.next=47;break}_loop=(0,regeneratorRuntime/* default */.Z)().mark((function _loop(){var _Object$entries$_i,key,value,childFilters,_oneLevelFields$find,lookupModuleName,displayName,list,oneLevelChildTags,labelMeta,lookupFieldsArr,oneLevelTags;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:if(_Object$entries$_i=(0,slicedToArray/* default */.Z)(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1],childFilters={},childFilters=(0,validation/* isArray */.kJ)(value)?value.reduce((function(acc,curr){var _Object$keys3=Object.keys(curr),_Object$keys4=(0,slicedToArray/* default */.Z)(_Object$keys3,1),firstKey=_Object$keys4[0];return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},acc),{},(0,defineProperty/* default */.Z)({},firstKey,curr[firstKey]))}),{}):value,_oneLevelFields$find=oneLevelFields.find((function(field){return field.name===key})),lookupModuleName=_oneLevelFields$find.lookupModuleName,displayName=_oneLevelFields$find.displayName,list=_this7.getTagsList(childFilters,_this7.cachedModule[lookupModuleName]),oneLevelChildTags=list.tagsArr,labelMeta=list.labelMeta,lookupFieldsArr=list.lookupFieldsArr,(0,validation/* isEmpty */.xb)(labelMeta)){_context6.next=10;break}return _context6.next=9,_this7.fetchLookupLabels({labelMeta:labelMeta,lookupFieldsArr:lookupFieldsArr,tagsArr:oneLevelChildTags,fields:_this7.cachedModule[lookupModuleName],appliedFilters:childFilters});case 9:oneLevelChildTags=_context6.sent;case 10:oneLevelTags=oneLevelChildTags.map((function(tag){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},tag),{},{parentFieldName:key,parentDisplayName:displayName})})),tagsArr=[].concat((0,toConsumableArray/* default */.Z)(tagsArr),(0,toConsumableArray/* default */.Z)(oneLevelTags));case 12:case"end":return _context6.stop()}}),_loop)})),_i=0,_Object$entries=Object.entries(constructedOneLevelFilter);case 42:if(!(_i<_Object$entries.length)){_context7.next=47;break}return _context7.delegateYield(_loop(),"t0",44);case 44:_i++,_context7.next=42;break;case 47:_this7.$set(_this7,"tagsArr",tagsArr);case 48:case"end":return _context7.stop()}}),_callee6)})))()},populateOneLevelModules:function(oneLevelModules){var _this8=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee7(){var oneLevelFields,lookupModuleNames,response,i,lookupModuleName,data,_oneLevelFields;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context8){while(1)switch(_context8.prev=_context8.next){case 0:if(oneLevelFields=_this8.oneLevelFields,!(0,validation/* isEmpty */.xb)(oneLevelFields)){_context8.next=3;break}return _context8.abrupt("return");case 3:if((0,validation/* isEmpty */.xb)(oneLevelModules)){_context8.next=9;break}return lookupModuleNames=oneLevelModules.map((function(fieldName){var field=oneLevelFields.find((function(field){return field.name===fieldName})),lookupModuleName=field.lookupModuleName;return lookupModuleName})),_context8.next=7,Promise.all(lookupModuleNames.map((function(lookupModuleName){return api/* API */.bl.get("/v2/filter/advanced/fields/".concat(lookupModuleName))})));case 7:for(i in response=_context8.sent,lookupModuleNames)lookupModuleName=lookupModuleNames[i],data=response[i].data,_oneLevelFields=data.fields,_this8.cachedModule[lookupModuleName]=_oneLevelFields;case 9:case"end":return _context8.stop()}}),_callee7)})))()},getTagsList:function(filters,fields){var _this9=this,tagsArr=[],labelMeta={},lookupFieldsArr=[];return Object.entries(filters).forEach((function(_ref9){var _ref10=(0,slicedToArray/* default */.Z)(_ref9,2),key=_ref10[0],value=_ref10[1],tagObj={},valueStr="",_ref11=value||{},valueArr=_ref11.value,operatorId=_ref11.operatorId,selectedField=_this9.getSelectedField({fields:fields,fieldName:key}),isLookupField=_this9.isLookupField(selectedField)||_this9.isLookupPopupField(selectedField)||_this9.isMultiLookupField(selectedField),selectedOperator=_this9.getSelectedOperator({selectedField:selectedField,operatorId:operatorId});isLookupField&&(labelMeta=_this9.constructLabelMeta({selectedField:selectedField,lookupFieldsArr:lookupFieldsArr,labelMeta:labelMeta,valueArr:valueArr,selectedOperator:selectedOperator}));var operatorDisplayName=_this9.getOperatorDisplayName({operator:selectedOperator}),isDefaultOperator=!(0,validation/* isEmpty */.xb)(selectedOperator.defaultValue),fieldDisplayName=selectedField.displayName;isDefaultOperator||(valueStr=_this9.getValueString({valueArr:valueArr,selectedField:selectedField,isLookupField:isLookupField,operator:selectedOperator})),tagObj={fieldName:key,fieldDisplayName:fieldDisplayName,operatorDisplayName:operatorDisplayName,valueStr:valueStr},"drillDownPattern"!=key&&tagsArr.push(tagObj)})),{tagsArr:tagsArr,labelMeta:labelMeta,lookupFieldsArr:lookupFieldsArr}},constructLabelMeta:function(props){var selectedField=props.selectedField,lookupFieldsArr=props.lookupFieldsArr,labelMeta=props.labelMeta,valueArr=props.valueArr,_props$selectedOperat=props.selectedOperator,selectedOperator=void 0===_props$selectedOperat?{}:_props$selectedOperat,name=this.getLookupModuleName({field:selectedField,operator:selectedOperator});
// Have to construct the label meta keys from lookup module name
// either from the operator or from the field
lookupFieldsArr.push(selectedField);var selectedModule=labelMeta[name];if((0,validation/* isEmpty */.xb)(selectedModule))labelMeta[name]=valueArr||[];else{var ids=labelMeta[name];labelMeta[name]=ids.concat(valueArr)}return labelMeta},fetchLookupLabels:function(props){var _this10=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee8(){var labelMeta,lookupFieldsArr,tagsArr,fields,appliedFilters,_yield$API$post,data,error,_error$message,message,_ref12,label;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context9){while(1)switch(_context9.prev=_context9.next){case 0:return labelMeta=props.labelMeta,lookupFieldsArr=props.lookupFieldsArr,tagsArr=props.tagsArr,fields=props.fields,appliedFilters=props.appliedFilters,_context9.next=3,api/* API */.bl.post("/v2/picklist/label",{labelMeta:labelMeta});case 3:return _yield$API$post=_context9.sent,data=_yield$API$post.data,error=_yield$API$post.error,error?(_error$message=error.message,message=void 0===_error$message?"Error Occurred":_error$message,_this10.$message.error(message)):(_ref12=data||{},label=_ref12.label,tagsArr=tagsArr.map((function(tag){var fieldName=tag.fieldName,valueStr=tag.valueStr,lookupField=lookupFieldsArr.find((function(field){return field.name===fieldName}));if(lookupField){
// Have to get the value labels from lookup module name
// either from the operator or from the field
var field=_this10.getSelectedField({fields:fields,fieldName:fieldName}),currentFiter=appliedFilters[fieldName],operatorId=currentFiter.operatorId,operator=_this10.getSelectedOperator({selectedField:field,operatorId:operatorId}),name=_this10.getLookupModuleName({operator:operator,field:field}),moduleLabels=label[name]||[],labelStr=_this10.constructLabelString(valueStr,moduleLabels);tag.valueStr=labelStr}return tag}))),_context9.abrupt("return",tagsArr);case 8:case"end":return _context9.stop()}}),_callee8)})))()},getLookupModuleName:function(_ref13){var operator=_ref13.operator,field=_ref13.field,fieldLookupModule=this.$getProperty(field,"lookupModule.name"),operatorLookupModule=this.$getProperty(operator,"lookupModule.name");return(0,validation/* isEmpty */.xb)(operatorLookupModule)?fieldLookupModule:operatorLookupModule},getSelectedField:function(props){var fields=props.fields,fieldName=props.fieldName,selectedField=(fields||[]).find((function(field){return field.name===fieldName}));return selectedField||{}},getOperatorDisplayName:function(props){var operator=props.operator,_ref14=operator||{},tagDisplayName=_ref14.tagDisplayName,displayName=_ref14.displayName,operatorId=_ref14.operatorId;return[dateTimeOperator[operatorId]].includes(displayName)?"is":tagDisplayName||displayName},getSelectedOperator:function(props){var operatorsList=this.operatorsList,operatorId=props.operatorId,selectedField=props.selectedField,_ref15=selectedField||{},dataType=_ref15.dataType,_ref15$operators=_ref15.operators,operators=void 0===_ref15$operators?[]:_ref15$operators,selectedOperator=operatorsList[dataType]||[];return(0,validation/* isEmpty */.xb)(operators)||(selectedOperator=selectedOperator.concat(operators)),selectedOperator.find((function(operator){return operator.operatorId===operatorId}))||{}},getValueString:function(props){var _this11=this,valueArr=props.valueArr,selectedField=props.selectedField,isLookupField=props.isLookupField,operator=props.operator,operatorId=operator.operatorId,operatorDisplayName=operator.displayName;if(!(0,validation/* isEmpty */.xb)(valueArr)){var valueStr="",isPicklistOrBoolean=this.isPicklistOrBoolean(selectedField),isDateTypeField=this.isDateTypeField(selectedField),isCurrencyField=this.isCurrencyField(selectedField),isTimeField=this.isTimeField(selectedField);if(isDateTypeField){if(valueStr=valueArr.reduce((function(acc,value,index){if([dateTimeOperator[operatorId]].includes(operatorDisplayName)){if([106,107,84,85].includes(operatorId))if(84===operatorId){var currentMonth=(_this11.$constants.MONTHS||[]).filter((function(month){return(null===month||void 0===month?void 0:month.value)==value})).map((function(month){return null===month||void 0===month?void 0:month.label}));acc+="".concat(currentMonth)}else acc+=85===operatorId?"".concat(_this11.$constants.WEEK_DAYS[value]):value;else acc+="".concat(value).concat(1==value?"st":2==value?"nd":3==value?"rd":"th");return acc+=index!==valueArr.length-1?", ":" ",acc}var dateStr=_this11.$options.filters.formatDate(Number(value),!0,!1);return(0,validation/* isEmpty */.xb)(acc)?"".concat(dateStr):"".concat(acc,", ").concat(dateStr)}),""),[dateTimeOperator[operatorId]].includes(operatorDisplayName))if([106,107].includes(operatorId)){var operatorIdKey={106:"Before",107:"After"};valueStr="".concat(operatorIdKey[operatorId]||""," ").concat(valueStr," days")}else[84,85].includes(operatorId)||(valueStr+="".concat(operatorDisplayName))}else if(isPicklistOrBoolean){var options=selectedField.options;(0,validation/* isEmpty */.xb)(options)||(valueStr=this.constructLabelString(valueArr,options))}else{if(isLookupField)return valueArr;if(isCurrencyField){var orgCurrency=this.orgCurrency;valueStr=2===valueArr.length?"".concat(orgCurrency," ").concat(valueArr[0],", ").concat(orgCurrency," ").concat(valueArr[1]):"".concat(orgCurrency," ").concat(valueArr[0])}else{if(isTimeField)return(0,TimeFormatMixin/* getFormatedTime */.$)(valueArr[0]);valueStr=valueArr.reduce((function(acc,value){return(0,validation/* isEmpty */.xb)(acc)?"".concat(value):"".concat(acc,", ").concat(value)}),"")}}return'"'.concat(valueStr,'"')}return""},isCurrencyField:function(field){var _ref16=field||{},dataType=_ref16.dataType;return"CURRENCY_FIELD"===dataType},isTimeField:function(field){var _ref17=field||{},dataType=_ref17.dataType,displayType=_ref17.displayType;return"NUMBER"===dataType&&"TIME"===displayType},constructLabelString:function(){var valueArr=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],options=arguments.length>1?arguments[1]:void 0,valueStr="";return(0,validation/* isArray */.kJ)(valueArr)&&(valueStr=valueArr.reduce((function(acc,value){var _ref18=options.find((function(option){return String(option.value)===value}))||{},_ref18$label=_ref18.label,label=void 0===_ref18$label?"Invalid":_ref18$label;return(0,validation/* isEmpty */.xb)(acc)?"".concat(label):"".concat(acc,", ").concat(label)}),"")),valueStr},isDateTypeField:function(field){var _ref19=field||{},displayType=_ref19.displayType;return["DATETIME","DATE"].includes(displayType)},isPicklistOrBoolean:function(field){var _ref20=field||{},displayType=_ref20.displayType;return["SELECTBOX","DECISION_BOX"].includes(displayType)},resetFilters:function(){var hideQuery=this.hideQuery,filterList=this.filterList;this.$store.dispatch("search/resetFilters"),this.tagsArr=[],hideQuery&&!(0,validation/* isEmpty */.xb)(filterList)&&this.$emit("resetFilters")},savingView:function(command){var currentViewDetail=this.currentViewDetail,moduleName=this.moduleName,$route=this.$route,_ref21=$route||{},_ref21$query=_ref21.query,query=void 0===_ref21$query?{}:_ref21$query,_ref22=currentViewDetail||{},viewname=_ref22.name,appId=((0,router/* getApp */.wx)()||{}).id;if("edit"===command)this.openConfirmDialog();else if("new"===command)if((0,router/* isWebTabsEnabled */.tj)()){var _ref23=(0,router/* findRouteForModule */.Jp)(moduleName,router/* pageTypes */.As.VIEW_CREATION)||{},name=_ref23.name;name&&this.$router.push({name:name,query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},query||{}),{},{appId:appId,saveAsNew:!0,viewname:viewname})})}else{var _ref24=(0,routeUtil/* findRouterForModuleInApp */.E)(moduleName,router/* pageTypes */.As.VIEW_CREATION)||{},_name=_ref24.name;_name&&this.$router.push({name:_name,params:{moduleName:moduleName},query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},query||{}),{},{appId:appId,saveAsNew:!0,viewname:viewname})})}},openConfirmDialog:function(){var _this12=this;this.$dialog.confirm({title:this.$t("viewsmanager.views.edit_view"),message:this.$t("filters.views.confirm_edit"),rbDanger:!0,rbLabel:this.$t("common._common.edit")}).then((function(value){value&&_this12.saveFiltersInExistingView()}))},saveFiltersInExistingView:function(){var _this13=this,currentViewDetail=this.currentViewDetail,moduleName=this.moduleName,existingFilters=this.existingFilters,appliedFilters=this.appliedFilters,_ref25=currentViewDetail||{},name=_ref25.name,id=_ref25.id,data={moduleName:moduleName,view:{includeParentCriteria:!0,name:name,id:id}},finalFilterObj={};(0,validation/* isEmpty */.xb)(existingFilters)||(finalFilterObj=(0,objectSpread2/* default */.Z)({},this.existingFilters)),(0,validation/* isEmpty */.xb)(appliedFilters)||(finalFilterObj=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},finalFilterObj),appliedFilters)),(0,validation/* isEmpty */.xb)(finalFilterObj)||(data.view.filtersJson=JSON.stringify(finalFilterObj)),this.editView(data).then((function(data){var view=data.view,_ref26=view||{},name=_ref26.name;_this13.$router.push({params:{viewname:name},query:{}});var msg=_this13.$t("filters.views.edit_success");_this13.$message.success(msg)})).catch((function(error){var message=error.message;_this13.$message.error(message)}))},clearFilter:function(tag){var appliedFilters=this.appliedFilters,hideQuery=this.hideQuery,filterList=this.filterList,filters=(0,utility_methods/* deepCloneObject */.kh)(appliedFilters)||{},isPivotPatternPresent=filters["drillDownPattern"];if(!(0,validation/* isEmpty */.xb)(isPivotPatternPresent)){delete filters["drillDownPattern"];for(var newFilter={},regex=/([-]+1)+$/,_i2=0,_Object$keys5=Object.keys(filters);_i2<_Object$keys5.length;_i2++){var key=_Object$keys5[_i2],isDuplicateField=String(key).match(regex);(0,validation/* isEmpty */.xb)(isDuplicateField)&&(newFilter[key]=filters[key])}filters=newFilter}var fieldName=tag.fieldName,parentFieldName=tag.parentFieldName;if((0,validation/* isEmpty */.xb)(parentFieldName))delete filters[fieldName];else{var filter=filters["oneLevelLookup"],parentFilter=filter[parentFieldName];parentFilter=parentFilter.filter((function(filterObj){var criteriaValue=filterObj.criteriaValue,_Object$keys6=Object.keys(criteriaValue),_Object$keys7=(0,slicedToArray/* default */.Z)(_Object$keys6,1),name=_Object$keys7[0];return name!==fieldName})),(0,validation/* isEmpty */.xb)(parentFilter)?delete filter[parentFieldName]:filter[parentFieldName]=parentFilter}if(hideQuery&&!(0,validation/* isEmpty */.xb)(filterList))this.$emit("updateFilters",{filters:filters});else{var keys=Object.keys(filters);1==keys.length&&"oneLevelLookup"===keys[0]&&(0,validation/* isEmpty */.xb)(filters["oneLevelLookup"])?(this.$store.dispatch("search/resetFilters"),this.tagsArr=[]):(0,validation/* isEmpty */.xb)(filters)||this.$store.dispatch("search/applyFilters",filters)}}})},search_FTagsvue_type_script_lang_js=FTagsvue_type_script_lang_js,FTags_component=(0,componentNormalizer/* default */.Z)(search_FTagsvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FTags=FTags_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/75676.js.map