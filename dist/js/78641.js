"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[78641,32686,80865,53021],{
/***/987612:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return TransitionButtons}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/stateflow/TransitionButtons.vue?vue&type=template&id=cca90304&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"display-flex",class:_vm.rootClass},[_vm.hasTransitionBtns?_c("div",{staticClass:"d-flex"},[_c("div",{staticClass:"stateflow-btn-wrapper mL10"},[_c("async-button",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{buttonType:"primary",buttonClass:_vm.asyncBtnClassName,disable:_vm.transitions.featured[0].scheduled,clickAction:_vm.startTransition,actionParams:[_vm.transitions.featured[0]],disabled:_vm.isDisabled,"data-test-selector":_vm.transitions.featured[0].name,title:""+_vm.transitions.featured[0].name,loading:_vm.firstBtnLoading}},[_vm._v(" "+_vm._s(_vm.transitions.featured[0].name)+" ")])],1),_vm.hasDropDownBtns?_c("div",{staticClass:"mL10"},[_c("el-dropdown",{staticClass:"pointer stateflow-btn-wrapper",attrs:{"split-button":"","data-test-selector":_vm.transitions.featured[1].name,disabled:_vm.isDisabled},on:{click:function($event){return _vm.initiateDropdownTransition(_vm.transitions.featured[1])},command:_vm.initiateDropdownTransition}},[_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"transition-btn-name",attrs:{title:""+_vm.transitions.featured[1].name}},[_vm.dropdownLoading?_c("span",[_c("i",{staticClass:"el-icon-loading"}),_vm._v(" "+_vm._s(_vm.$t("common._common.loading"))+" ")]):_c("span",[_vm._v(_vm._s(_vm.transitions.featured[1].name))])]),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},_vm._l(_vm.transitions.dropdown,(function(transition,index){return _c("el-dropdown-item",{key:index,attrs:{command:transition,disabled:_vm.isDisabled,"data-test-selector":transition.name}},[_vm._v(" "+_vm._s(transition.name)+" ")])})),1)],1)],1):_vm.hasOnly2Btns?_c("div",{staticClass:"stateflow-btn-wrapper mL10"},[_c("async-button",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{buttonClass:_vm.asyncBtnClassName,disable:_vm.transitions.featured[1].scheduled,clickAction:_vm.startTransition,actionParams:[_vm.transitions.featured[1]],disabled:_vm.isDisabled,"data-test-selector":_vm.transitions.featured[1].name,title:""+_vm.transitions.featured[1].name,loading:_vm.lastBtnLoading}},[_vm._v(" "+_vm._s(_vm.transitions.featured[1].name)+" ")])],1):_vm._e()]):_vm._e(),_vm.canShowForm?_c("TransitionForm",_vm._b({},"TransitionForm",_vm.transitionFormProps,!1)):_vm._e(),_vm.showConfirmationDialog?_c("ConfirmationDialog",{attrs:{transition:_vm.selectedTransition,confirmations:_vm.confirmationDialogs,onConfirm:_vm.continueTransition,onCancel:_vm.cancelTransition}}):_vm._e()],1)},staticRenderFns=[],defineProperty=__webpack_require__(482482),objectSpread2=__webpack_require__(595082),slicedToArray=__webpack_require__(554621),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),api=(__webpack_require__(865137),__webpack_require__(976801),__webpack_require__(689730),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(336585),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(32284)),AsyncButton=__webpack_require__(303514),TransitionForm=__webpack_require__(323796),TransitionConfirmationsvue_type_template_id_08a79305_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{visible:_vm.dialogVisible,title:_vm.activeDialog.title,width:"540px","custom-class":"confirmation-dialog","append-to-body":"","close-on-click-modal":!1,"before-close":_vm.activeDialog.cancel},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c("div",{staticClass:"message-block"},[_vm._v(" "+_vm._s(_vm.activeDialog.message)+" ")]),_c("div",{staticClass:"dialog-footer"},[_c("el-button",{staticClass:"btn btn--secondary cancel-btn",attrs:{type:"button"},on:{click:_vm.activeDialog.cancel}},[_vm._v(" Cancel ")]),_c("el-button",{staticClass:"btn btn--primary btn--danger delete-btn",attrs:{type:"button",disabled:_vm.loadingOnConfirm,loading:_vm.loadingOnConfirm},on:{click:_vm.activeDialog.proceed}},[_vm._v(" Confirm ")])],1)])},TransitionConfirmationsvue_type_template_id_08a79305_staticRenderFns=[],TransitionConfirmationsvue_type_script_lang_js={props:["confirmations","onConfirm","onCancel"],data:function(){return{dialogVisible:!1,activeDialog:null,currentIndex:0,loadingOnConfirm:!1}},watch:{confirmations:{handler:"startConfirmation",immediate:!0}},methods:{startConfirmation:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var confirmations,currentIndex,delay,dialog,dialogObj;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:confirmations=_this.confirmations,currentIndex=_this.currentIndex,delay=_this.$helpers.delay,dialog=confirmations[currentIndex],dialogObj={title:dialog.name,message:dialog.message,proceed:function(){var _proceed=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(currentIndex!==confirmations.length-1){_context.next=9;break}return _this.loadingOnConfirm=!0,_context.next=4,_this.onConfirm();case 4:_this.loadingOnConfirm=!1,_this.dialogVisible=!1,_this.currentIndex=0,_context.next=12;break;case 9:_this.currentIndex+=1,_this.dialogVisible=!1,delay(200).then((function(){return _this.startConfirmation()}));case 12:case"end":return _context.stop()}}),_callee)})));function proceed(){return _proceed.apply(this,arguments)}return proceed}(),cancel:function(){var _cancel=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_this.dialogVisible=!1,_this.currentIndex=0,_this.onCancel();case 3:case"end":return _context2.stop()}}),_callee2)})));function cancel(){return _cancel.apply(this,arguments)}return cancel}()},_this.activeDialog=dialogObj,_this.$nextTick((function(){return _this.dialogVisible=!0}));case 5:case"end":return _context3.stop()}}),_callee3)})))()}}},stateflow_TransitionConfirmationsvue_type_script_lang_js=TransitionConfirmationsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionConfirmationsvue_type_script_lang_js,TransitionConfirmationsvue_type_template_id_08a79305_render,TransitionConfirmationsvue_type_template_id_08a79305_staticRenderFns,!1,null,null,null)
/* harmony default export */,TransitionConfirmations=component.exports,validation=__webpack_require__(990260),cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),TransitionButtonsUtils=__webpack_require__(982072),TransitionButtonsvue_type_script_lang_js={props:["moduleName","record","updateFn","updateUrl","transformFn","transitionFilter","buttonClass","disabled","hideNotifications"],components:{AsyncButton:AsyncButton/* default */.Z,TransitionForm:TransitionForm/* default */.Z,ConfirmationDialog:TransitionConfirmations},created:function(){this.fetchAvailableStates()},data:function(){return{stateTransitions:null,loading:!1,canShowForm:!1,selectedTransition:null,dataForCurrentTransition:null,confirmationDialogs:null,showConfirmationDialog:!1,dropdownLoading:!1,selectedTransitionActions:null,firstBtnLoading:!1,lastBtnLoading:!1}},computed:{isV3:function(){var moduleName=this.moduleName,updateUrl=this.updateUrl;return!(0,validation/* isEmpty */.xb)(moduleName)&&(0,validation/* isEmpty */.xb)(updateUrl)},transitions:function(){if((0,validation/* isEmpty */.xb)(this.stateTransitions))return null;var transitions=(0,toConsumableArray/* default */.Z)(this.stateTransitions).sort((function(first,second){
// sorts array in ascending order but placing all '-1' values at the end
return[-1,0,3].includes(first.buttonType)?1:[-1,0,3].includes(second.buttonType)?-1:first.buttonType-second.buttonType}));return{featured:transitions.slice(0,2)||[],dropdown:transitions.slice(2)||[]}},shouldCreateModuleRecord:function(){var _this$selectedTransit=this.selectedTransition,selectedTransition=void 0===_this$selectedTransit?{}:_this$selectedTransit,_ref=selectedTransition||{},_ref$dialogType=_ref.dialogType,dialogType=void 0===_ref$dialogType?null:_ref$dialogType,formModuleName=_ref.formModuleName;return!(0,validation/* isEmpty */.xb)(dialogType)&&!(0,validation/* isEmpty */.xb)(formModuleName)&&2===dialogType},shouldCreateNotes:function(){var _ref2=this.selectedTransition||{},form=_ref2.form;return 5===this.$getProperty(form,"module.type",null)},rootClass:function(){return""},isDisabled:function(){var loading=this.loading,disabled=this.disabled,dropdownLoading=this.dropdownLoading,firstBtnLoading=this.firstBtnLoading,lastBtnLoading=this.lastBtnLoading;return loading||disabled||dropdownLoading||firstBtnLoading||lastBtnLoading},hasTransitionBtns:function(){var _ref3=this.transitions||{},featured=_ref3.featured;return!(0,validation/* isEmpty */.xb)(featured)},hasDropDownBtns:function(){var _ref4=this.transitions||{},featured=_ref4.featured,dropdown=_ref4.dropdown;return this.hasTransitionBtns&&!(0,validation/* isEmpty */.xb)(dropdown)&&featured.length>1&&dropdown.length>0},hasOnly2Btns:function(){var _ref5=this.transitions||{},featured=_ref5.featured;return this.hasTransitionBtns&&featured.length>1},asyncBtnClassName:function(){var buttonClass=this.buttonClass,isDisabled=this.isDisabled;return"".concat(buttonClass," ").concat(isDisabled&&"disabled"," transition-btn-name")},transitionFormProps:function(){var selectedTransition=this.selectedTransition,record=this.record,shouldCreateModuleRecord=this.shouldCreateModuleRecord,saveDataForTransition=this.saveDataForTransition,cancelTransition=this.cancelTransition,isV3=this.isV3,_ref6=selectedTransition||{},moduleName=_ref6.moduleName,formId=_ref6.formId,_ref7=record||{},recordId=_ref7.id;return{moduleName:moduleName,recordId:recordId,formId:formId,record:record,isV3:isV3,transition:selectedTransition,isExternalModule:shouldCreateModuleRecord,saveAction:saveDataForTransition,closeAction:cancelTransition}}},watch:{moduleName:function(newVal,oldVal){newVal!==oldVal&&this.fetchAvailableStates()},record:function(newVal,oldVal){newVal!==oldVal&&this.fetchAvailableStates({force:!0})}},methods:{refresh:function(){this.fetchAvailableStates()},fetchAvailableStates:function(){var _arguments=arguments,_this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _ref8,_ref8$force,force,_yield$API$get,data,error,_ref9,_ref9$currentState,currentState,_ref9$states,states;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _ref8=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:{},_ref8$force=_ref8.force,force=void 0!==_ref8$force&&_ref8$force,_this.loading=!0,_context.next=4,api/* API */.bl.get("/v2/statetransition/getAvailableState",{moduleName:_this.moduleName,id:_this.record.id},{force:force});case 4:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this.stateTransitions=null:(_ref9=data||{},_ref9$currentState=_ref9.currentState,currentState=void 0===_ref9$currentState?null:_ref9$currentState,_ref9$states=_ref9.states,states=void 0===_ref9$states?[]:_ref9$states,currentState&&_this.$emit("currentState",currentState.id),(0,validation/* isEmpty */.xb)(_this.transitionFilter)||(0,validation/* isEmpty */.xb)(_this.states)||(states=states.filter(_this.transitionFilter)),_this.stateTransitions=states||[]),_this.loading=!1;case 9:case"end":return _context.stop()}}),_callee)})))()},startTransition:function(transition){var _ref10=this.transitions||{},featured=_ref10.featured;if(!this.dropdownLoading&&!(0,validation/* isEmpty */.xb)(featured)){var _ref11=featured[0]||{},firstTransitionId=_ref11.id,_ref12=featured[1]||{},lastTransitionId=_ref12.id,_ref13=transition||{},currentTransitionId=_ref13.id;this.firstBtnLoading=currentTransitionId===firstTransitionId,this.lastBtnLoading=currentTransitionId===lastTransitionId}var NOT_CONFIGURED=TransitionButtonsUtils/* actionStatusFlag */.Zj.NOT_CONFIGURED,YET_TO_START=TransitionButtonsUtils/* actionStatusFlag */.Zj.YET_TO_START;return this.selectedTransitionActions=Object.entries(TransitionButtonsUtils/* transitionBtnActions */._M||{}).reduce((function(actionList,_ref14){var _ref15=(0,slicedToArray/* default */.Z)(_ref14,2),action=_ref15[0],transKey=_ref15[1];return actionList[action]=(0,validation/* isEmpty */.xb)(transition[transKey])?NOT_CONFIGURED:YET_TO_START,actionList}),{}),this.selectedTransition=cloneDeep_default()(transition),this.startTransitionProcess()},startTransitionProcess:function(){var selectedTransitionActions=this.selectedTransitionActions,selectedTransition=this.selectedTransition,YET_TO_START=TransitionButtonsUtils/* actionStatusFlag */.Zj.YET_TO_START,IN_PROCESS=TransitionButtonsUtils/* actionStatusFlag */.Zj.IN_PROCESS,FAILED=TransitionButtonsUtils/* actionStatusFlag */.Zj.FAILED,isAnyActionFailed=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.some((function(action){return selectedTransitionActions[action]===FAILED})),currentRunningProcess=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.some((function(action){return selectedTransitionActions[action]===IN_PROCESS}));if(!isAnyActionFailed&&!currentRunningProcess){var nextProcessToStart=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.find((function(action){return selectedTransitionActions[action]===YET_TO_START}))||null;return(0,validation/* isEmpty */.xb)(nextProcessToStart)?this.continueTransition():(this.$set(this.selectedTransitionActions,nextProcessToStart,IN_PROCESS),"FORM"===nextProcessToStart?(this.showStateFlowForm(),Promise.resolve()):"CONFIRMATION"===nextProcessToStart?this.checkConfirmations(selectedTransition):void 0)}},saveDataForTransition:function(formData){return this.dataForCurrentTransition=cloneDeep_default()(formData),this.$set(this.selectedTransitionActions,"FORM",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),this.closeStateFlowForm(),this.startTransitionProcess()},checkConfirmations:function(transition){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var moduleName,record,params,dataForCurrentTransition,formData,_yield$API$post,error,data,validConfirmationDialogs;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return moduleName=_this2.moduleName,record=_this2.record,params={id:record.id,moduleName:moduleName,transitionId:transition.id},dataForCurrentTransition=_this2.dataForCurrentTransition,(0,validation/* isEmpty */.xb)(transition.formId)||(0,validation/* isEmpty */.xb)(dataForCurrentTransition)||(formData=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},dataForCurrentTransition),dataForCurrentTransition.data||{}),delete formData.data,params["data"]=formData),_context2.next=6,api/* API */.bl.post("v2/statetransition/confirmationDialogs",params);case 6:if(_yield$API$post=_context2.sent,error=_yield$API$post.error,data=_yield$API$post.data,!error){_context2.next=14;break}_this2.defaultResponseHandler({error:error}),_this2.cancelTransition(),_context2.next=22;break;case 14:if(validConfirmationDialogs=data.validConfirmationDialogs,(0,validation/* isEmpty */.xb)(validConfirmationDialogs)){_context2.next=20;break}_this2.confirmationDialogs=validConfirmationDialogs,_this2.showConfirmationDialog=!0,_context2.next=22;break;case 20:return _this2.$set(_this2.selectedTransitionActions,"CONFIRMATION",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),_context2.abrupt("return",_this2.startTransitionProcess());case 22:case"end":return _context2.stop()}}),_callee2)})))()},proceedAfterConfirmation:function(){this.$set(this.selectedTransitionActions,"CONFIRMATION",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),this.startTransitionProcess()},initiateDropdownTransition:function(transition){this.dropdownLoading=!0,this.startTransition(transition)},continueTransition:function(){var selectedTransition=this.selectedTransition,_this$dataForCurrentT=this.dataForCurrentTransition,formData=void 0===_this$dataForCurrentT?null:_this$dataForCurrentT;return this.transitionToState(formData,selectedTransition)},cancelTransition:function(){this.selectedTransition=null,this.dataForCurrentTransition=null,this.confirmationDialogs=null,this.dropdownLoading=!1,this.firstBtnLoading=!1,this.lastBtnLoading=!1,this.selectedTransitionActions=null,this.closeStateFlowForm(),this.closeConfirmationDialogs()},getParams:function(_ref16){var formData=_ref16.formData,transition=_ref16.transition,moduleName=this.moduleName,record=this.record,_ref17=record||{},id=_ref17.id,_ref18=transition||{},stateTransitionId=_ref18.id,formId=_ref18.formId,formModuleName=_ref18.formModuleName,serializedFormData=formData;if(this.shouldCreateModuleRecord&&(serializedFormData={relations:(0,defineProperty/* default */.Z)({},formModuleName,[{data:[(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formData),{},{formId:formId})]}])}),this.shouldCreateNotes||!this.isV3){var firstArg={moduleName:moduleName,id:id,stateTransitionId:stateTransitionId},secondArg=this.isV3||this.shouldCreateNotes?null:formData;return this.transformFn(firstArg,secondArg)}return{id:id,stateTransitionId:stateTransitionId,data:serializedFormData||{}}},transitionToState:function(formData,transition){var _this3=this;(0,validation/* isEmpty */.xb)(transition)&&(transition=this.selectedTransition);var url=this.getUrl(transition),params=this.getParams({formData:formData,transition:transition}),defaultResponseHandler=this.defaultResponseHandler,updateFn=this.updateFn,moduleName=this.moduleName,record=this.record;if(this.isV3){if(!(0,validation/* isEmpty */.xb)(updateFn)&&(0,validation/* isFunction */.mf)(updateFn))return updateFn(moduleName,params).then(defaultResponseHandler);var _ref19=record||{},recordId=_ref19.id,_url="v3/action/".concat(moduleName,"/").concat(recordId,"/transition");return api/* API */.bl.patch(_url,params).then(defaultResponseHandler)}return api/* API */.bl.post(url,params).then(function(){var _ref21=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(_ref20){var error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:error=_ref20.error,error?defaultResponseHandler({error:error}):_this3.shouldCreateNotes||_this3.shouldCreateModuleRecord?_this3.v2SubModuleHandler(formData,transition).then((function(){return defaultResponseHandler({})})).catch((function(){
// Edge case where transition is success but record creation fails
_this3.fetchAvailableStates({force:!0}),_this3.$emit("transitionSuccess"),defaultResponseHandler({error:{}})})):defaultResponseHandler({});case 2:case"end":return _context3.stop()}}),_callee3)})));return function(_x){return _ref21.apply(this,arguments)}}())},v2SubModuleHandler:function(formData,transition){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var shouldCreateNotes,shouldCreateModuleRecord,formModuleName;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(shouldCreateNotes=_this4.shouldCreateNotes,shouldCreateModuleRecord=_this4.shouldCreateModuleRecord,formModuleName=transition.formModuleName,!shouldCreateNotes){_context4.next=6;break}return _context4.abrupt("return",_this4.createNoteForModule(formModuleName,formData,transition));case 6:if(!shouldCreateModuleRecord){_context4.next=8;break}return _context4.abrupt("return",_this4.createRecordForModule(formModuleName,formData,transition));case 8:case"end":return _context4.stop()}}),_callee4)})))()},createNoteForModule:function(moduleName,formData){var _this5=this;return new Promise((function(resolve,reject){api/* API */.bl.post("v2/notes/add",{module:moduleName,ticketModuleName:_this5.moduleName,note:{parentId:_this5.record.id,notifyRequester:!1,body:formData.body}}).then((function(_ref22){var error=_ref22.error;error?reject():resolve()}))}))},createRecordForModule:function(moduleName,formData,transition){var data,_ref23=this.record||{},_ref23$siteId=_ref23.siteId,siteId=void 0===_ref23$siteId?null:_ref23$siteId,formId=transition.formId||null,form=transition.form,isCustomModule=this.$getProperty(form,"module.custom",!1);if(isCustomModule)data=(0,objectSpread2/* default */.Z)({moduleName:moduleName,withLocalId:!1},this.constructCustomModuleData({},formData,transition));else
// TODO MOVE to v3
if("workpermit"===moduleName){var datum=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formData),{},{ticket:{id:this.record.id}});(0,validation/* isEmpty */.xb)(siteId)||(datum.siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(datum.formId=formId),data={workPermitRecords:[datum]}}else{var formObj=this.constructWoModuleData(formData,transition);data={workorder:(0,objectSpread2/* default */.Z)({},formObj)},moduleName="workorders"}var url=isCustomModule?"v2/module/data/add":"/v2/".concat(moduleName,"/add");return new Promise((function(resolve,reject){api/* API */.bl.post(url,data).then((function(_ref24){var error=_ref24.error;error?reject():resolve()}))}))},constructCustomModuleData:function(returnObj,data,transition){var _this6=this;
// Remove once v3 is done for custom modules
if(returnObj["moduleData"]={},data){data.comment&&(returnObj.comment=data.comment,delete data.comment),returnObj["moduleData"]=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},returnObj["moduleData"]),data);var _ref25=this.record||{},_ref25$siteId=_ref25.siteId,siteId=void 0===_ref25$siteId?null:_ref25$siteId,formId=transition.formId||null;!(0,validation/* isEmpty */.xb)(siteId)&&(0,validation/* isEmpty */.xb)(returnObj["moduleData"].siteId)&&(returnObj["moduleData"].siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(returnObj["moduleData"].formId=formId)}var formFields=this.$getProperty(transition,"form.fields")||[],currentModuleLookupField=formFields.find((function(field){return field.lookupModuleName===_this6.moduleName}));return currentModuleLookupField&&(returnObj["moduleData"].data=returnObj["moduleData"].data||{},returnObj["moduleData"].data[currentModuleLookupField.name]=this.record.id),returnObj},constructWoModuleData:function(data,transition){var _this7=this,formData=(0,objectSpread2/* default */.Z)({},data),_ref26=this.record||{},_ref26$siteId=_ref26.siteId,siteId=void 0===_ref26$siteId?null:_ref26$siteId,formId=transition.formId||null;
// Remove once v3 is done for workorders, handle it through relations
!(0,validation/* isEmpty */.xb)(siteId)&&(0,validation/* isEmpty */.xb)(formData.siteId)&&(formData.siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(formData.formId=formId);var formFields=this.$getProperty(transition,"form.fields")||[],currentModuleLookupField=formFields.find((function(field){var fieldObj=field.field;return field.lookupModuleName===_this7.moduleName&&!fieldObj.default}));return currentModuleLookupField&&(formData.data=formData.data||{},formData.data[currentModuleLookupField.name]={id:this.record.id}),Object.keys(formData).forEach((function(name){var value=formData[name];(0,validation/* isObject */.Kn)(value)&&-99===value.id&&(formData[name]=null)})),formData},defaultResponseHandler:function(){var _this8=this,_ref27=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},error=_ref27.error,delay=this.$helpers.delay,$message=this.$message;error?this.$emit("transitionFailure"):(this.fetchAvailableStates({force:!0}),this.$emit("transitionSuccess")),this.cancelTransition(),this.hideNotifications||(error?$message.error(error.message||this.$t("maintenance._workorder.state_update_failed")):delay(200).then((function(){$message.success(_this8.$t("maintenance._workorder.state_update_success"))})))},closeStateFlowForm:function(){this.canShowForm=!1},showStateFlowForm:function(){this.canShowForm=!0},closeConfirmationDialogs:function(){this.showConfirmationDialog=!1},getUrl:function(transition){return(0,validation/* isFunction */.mf)(this.updateUrl)?this.updateUrl(transition):this.updateUrl}}},stateflow_TransitionButtonsvue_type_script_lang_js=TransitionButtonsvue_type_script_lang_js,TransitionButtons_component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionButtonsvue_type_script_lang_js,render,staticRenderFns,!1,null,"cca90304",null)
/* harmony default export */,TransitionButtons=TransitionButtons_component.exports},
/***/649458:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ApprovalList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/approval/ApprovalList.vue?vue&type=template&id=4685a459
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100"},[_c("div",{staticClass:"layout container"},[_c("div",{staticClass:"height100"},[-1===_vm.openWorkorderId?_c("div",{staticClass:"row height100"},[_c("div",{staticClass:"col-12"},[_c("div",{staticClass:"height100 p10"},[_vm.showQuickSearch?_vm._e():_c("div",{staticClass:"row"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.selectedWorkorders.length,expression:"selectedWorkorders.length"}],staticClass:"col-12 fc-wo-requests-actions"},[_c("div",{staticClass:"pull-left"},[_c("div",{staticClass:"action-btn-slide btn-block"},[_c("q-checkbox",{staticClass:"wo-check-box mR10",attrs:{color:"secondary"},model:{value:_vm.selectAll,callback:function($$v){_vm.selectAll=$$v},expression:"selectAll"}}),_c("button",{staticClass:"btn btn--tertiary",class:{disabled:_vm.actions.delete.loading},on:{click:function($event){return _vm.deleteWorkOrder(_vm.selectedWorkorders)}}},[_vm.actions.delete.loading?_vm._e():_c("i",{staticClass:"fa fa-ban b-icon"}),_vm.actions.delete.loading?_c("i",{staticClass:"fa fa-circle-o-notch b-icon fa-spin",attrs:{"aria-hidden":"true"}}):_vm._e(),_vm._v(" "+_vm._s(_vm.$t("common._common.delete"))+" ")])],1)])])]),_vm.showQuickSearch?_c("div",{staticClass:"row"},[_c("div",{staticClass:"col-12 fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper relative"},[_c("svg",{staticClass:"search-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"}},[_c("title",[_vm._v(_vm._s(_vm.$t("common._common.search")))]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQuery,expression:"quickSearchQuery"}],ref:"quickSearchQuery",staticClass:"quick-search-input",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQuery},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.quickSearch.apply(null,arguments)},input:function($event){$event.target.composing||(_vm.quickSearchQuery=$event.target.value)}}}),_c("svg",{staticClass:"close-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.hideQuickSearchBox}},[_c("title",[_vm._v(_vm._s(_vm.$t("common._common.close")))]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_vm._e(),_vm.loading?_c("div",{staticClass:"full-layout-white height100 text-center"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_c("div",{staticClass:"full-layout-white height100"},[_vm.workorders.length?_c("div",{staticClass:"scrollable130-y100 fc-full-border"},_vm._l(_vm.workorders,(function(workorder){return _c("div",{key:workorder.id,staticClass:"row workorder-entry",class:{checkselected:_vm.isSelected(workorder.id),selected:_vm.openWorkorderId===workorder.id}},[_c("div",{staticClass:"col-5 errorClass",staticStyle:{"padding-left":"20px"},on:{click:function($event){return _vm.openSummaryView(workorder.id)}}},[_c("div",{staticClass:"q-item q-item-division relative-position"},["Closed"!==workorder.status.status?_c("q-checkbox",{staticClass:"workorderCheckbox",attrs:{val:workorder.id,color:"secondary"},model:{value:_vm.selectedWorkorders,callback:function($$v){_vm.selectedWorkorders=$$v},expression:"selectedWorkorders"}}):_c("q-checkbox",{staticClass:"workorderCheckbox",attrs:{color:"secondary",disable:""},model:{value:_vm.selectedWorkorders,callback:function($$v){_vm.selectedWorkorders=$$v},expression:"selectedWorkorders"}}),_c("div",{staticClass:"q-item-side q-item-side-left q-item-section text-primary",staticStyle:{"margin-left":"9px"}},[_c("user-avatar",{attrs:{size:"md",user:workorder.requestedBy,showPopover:!0,name:!1}})],1),_c("div",{staticClass:"q-item-main q-item-section"},[_c("div",{staticClass:"q-item-label display-flex"},[_c("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",animation:"shift-away",arrow:!0},expression:"{\n                              placement: 'top',\n                              animation: 'shift-away',\n                              arrow: true,\n                            }"}],staticClass:"ellipsis fc-list-subject max-width300px",attrs:{title:workorder.subject}},[_vm._v(" "+_vm._s(workorder.subject)+" ")]),workorder.urgency>0?_c("div",{staticClass:"fc-tag-urgent mL10",style:{background:_vm.urgencyColorCode[workorder.urgency]}},[_vm._v(" "+_vm._s(_vm.$constants.WO_URGENCY[workorder.urgency])+" ")]):_vm._e()]),_c("div",{staticClass:"q-item-sublabel ellipsis fc-list-desc"},[_vm._v(" "+_vm._s(workorder.description)+" ")]),_c("div",{staticClass:"q-item-label wo-requester width500px"},[_c("div",{staticClass:"ellipsis fc-id"},[_vm._v(" #"+_vm._s(workorder.serialNumber)+" ")]),workorder.sourceType?[_c("span",{staticClass:"separator"},[_vm._v("|")]),_c("div",{staticStyle:{color:"#2ea2b2","padding-right":"5px"}},[2===workorder.sourceType?_c("i",{staticClass:"fa fa-envelope-o"}):10===workorder.sourceType?_c("i",{staticClass:"f14 fa fa-globe"}):1===workorder.sourceType?_c("i",{staticClass:"f14 el-icon-service approval-el-icon-service"}):4===workorder.sourceType?_c("i",{staticClass:"f14 el-icon-bell approval-el-icon-bell"}):5===workorder.sourceType?_c("i",{staticClass:"f14 el-icon-date approval-el-icon-date"}):_vm._e()]),workorder.requester?_c("div",{staticClass:"worker-name pT0",staticStyle:{"padding-right":"8px",color:"#8ca1ad"}},[_vm._v(" "+_vm._s(workorder.requester.id>0?workorder.requester.name:"---")+" ")]):_vm._e()]:_vm._e(),workorder.resource&&workorder.resource.id>0?_c("div",{staticClass:"fc-grey2-text12"},[_c("span",{staticClass:"separator"},[_vm._v("|")]),1===workorder.resource.resourceType?_c("img",{staticClass:"mR5",staticStyle:{height:"12px",width:"14px"},attrs:{src:__webpack_require__(572902)}}):_c("img",{staticClass:"mR5",staticStyle:{height:"12px",width:"14px"},attrs:{src:__webpack_require__(30684)}}),_vm._v(" "+_vm._s(workorder.resource.name)+" ")]):_vm._e()],2)])],1)]),_c("div",{staticClass:"col-1",on:{click:function($event){return _vm.openSummaryView(workorder.id)}}}),_c("div",{staticClass:"col-6"},[workorder.moduleState&&workorder.moduleState.id>0?_c("approve-reject",{staticClass:"approve-btn-hover mR50",attrs:{record:workorder,moduleName:"workorder",transformFn:_vm.transformFormData,updateUrl:"/v2/workorders/update",approveClass:"work-approve-btn",rejectClass:"work-reject-btn",onHover:!0},on:{transitionSuccess:_vm.onFormSaved}}):_vm._e(),_c("div",{staticClass:"q-item q-item-division relative-position fR mR100 hover-hide",staticStyle:{width:"203px","max-width":"210px","padding-top":"0"}},[_c("div",{staticClass:"q-item-main q-item-section"},[workorder.priority?_c("span",{staticClass:"q-item-label",staticStyle:{color:"#999"}}):_vm._e(),_c("span",{staticClass:"q-item-label mT10 show"},[workorder.priority?_c("i",{staticClass:"fa fa-circle prioritytag mR10",style:{color:_vm.getTicketPriority(workorder.priority.id).colour},attrs:{"aria-hidden":"true"}}):_vm._e(),_vm._v(_vm._s(workorder.priority&&workorder.priority.id>0?_vm.getTicketPriority(workorder.priority.id).displayName:"---"))]),_c("div",{staticClass:"creted-time mT10"},[_c("i",{staticClass:"fa fa-clock-o fc-due-date-clock",staticStyle:{"padding-right":"5px","font-size":"15px"}}),_c("span",{staticStyle:{"font-size":"13px"}},[_vm._v(" Created "+_vm._s(_vm._f("fromNow")(workorder.createdTime))+" ")])])])])],1)])})),0):_c("div",{staticClass:"row container nowor"},[_c("div",{staticClass:"justify-center nowo height80vh flex-middle"},[_c("div",[_c("inline-svg",{attrs:{src:"svgs/emptystate/approval",iconClass:"icon text-center icon-xxxxlg"}}),_c("div",{staticClass:"nowo-label"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.no_request"))+" ")])],1)])])])])])]):_c("div",{staticClass:"fc-column-view height100"},[_c("div",{staticClass:"row fc-column-view-title height100"},[_c("div",{staticClass:"col-4 fc-approval-view-left height100"},[_vm.showQuickSearch?_vm._e():_c("div",{staticClass:"row container col-header"},[_vm.selectedWorkorders.length?_c("div",{staticClass:"col-12"},[_c("div",{staticClass:"pull-left"},[_c("q-checkbox",{staticClass:"wo-check-box",attrs:{color:"secondary"},model:{value:_vm.selectAll,callback:function($$v){_vm.selectAll=$$v},expression:"selectAll"}})],1),_c("div",{staticClass:"inline",staticStyle:{"padding-left":"10px","margin-top":"-1px"}},[_c("div",{staticClass:"action-btn-slide btn-block"},[_c("button",{staticClass:"btn btn--tertiary",class:{disabled:_vm.actions.delete.loading},on:{click:function($event){return _vm.deleteWorkOrder(_vm.selectedWorkorders)}}},[_vm.actions.delete.loading?_vm._e():_c("i",{staticClass:"fa fa-ban b-icon"}),_vm.actions.delete.loading?_c("i",{staticClass:"fa fa-circle-o-notch b-icon fa-spin",attrs:{"aria-hidden":"true"}}):_vm._e(),_vm._v(" "+_vm._s(_vm.$t("common._common.delete"))+" ")])])])]):_c("div",{staticClass:"col-12"},[_c("div",{staticClass:"pull-left"},[_c("q-checkbox",{staticClass:"wo-check-box",attrs:{color:"secondary"},model:{value:_vm.selectAll,callback:function($$v){_vm.selectAll=$$v},expression:"selectAll"}}),_c("el-dropdown",{staticClass:"approval-list-dropdown",on:{command:function($event){return _vm.$router.push({path:"/app/wo/approvals/wr/"+$event})}}},[_c("span",{staticClass:"el-dropdown-link pointer"},[_vm._v(" "+_vm._s(_vm.currentViewDetail.displayName)),_c("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),_c("el-dropdown-menu",{staticClass:"wo-dropdownmenu",attrs:{slot:"dropdown"},slot:"dropdown"},_vm._l(_vm.views,(function(view,idx){return view.name!==_vm.currentViewDetail.name?_c("el-dropdown-item",{key:idx,attrs:{command:view.name}},[_vm._v(" "+_vm._s(view.displayName)+" ")]):_vm._e()})),1)],1)],1)])]),_vm.showQuickSearch?_c("div",{staticClass:"row"},[_c("div",{staticClass:"col-12 fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper relative"},[_c("svg",{staticClass:"search-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"}},[_c("title",[_vm._v(_vm._s(_vm.$t("common._common.search")))]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQuery,expression:"quickSearchQuery"}],ref:"quickSearchQuery",staticClass:"quick-search-input",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQuery},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.quickSearch.apply(null,arguments)},input:function($event){$event.target.composing||(_vm.quickSearchQuery=$event.target.value)}}}),_c("svg",{staticClass:"close-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.hideQuickSearchBox}},[_c("title",[_vm._v(_vm._s(_vm.$t("common._common.close")))]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_vm._e(),_c("div",{staticClass:"row fc-column-view-records height100"},[_c("table",{staticClass:"fc-list-view-table",staticStyle:{height:"100%","overflow-y":"scroll",display:"block","padding-bottom":"120px"}},[_vm.workorders.length?_c("tbody",_vm._l(_vm.workorders,(function(workorder,index){return _c("tr",{key:index,staticClass:"approval-inner-list",class:{checkselected:_vm.isSelected(workorder.id),selected:_vm.openWorkorderId===workorder.id}},[_c("td",{staticStyle:{width:"2%"}},["Closed"!==workorder.status.status?_c("q-checkbox",{staticClass:"wo-check-box pL3",attrs:{val:workorder.id,color:"secondary"},model:{value:_vm.selectedWorkorders,callback:function($$v){_vm.selectedWorkorders=$$v},expression:"selectedWorkorders"}}):_c("q-checkbox",{staticClass:"wo-check-box",attrs:{color:"secondary",disable:""},model:{value:_vm.selectedWorkorders,callback:function($$v){_vm.selectedWorkorders=$$v},expression:"selectedWorkorders"}})],1),_c("td",{staticClass:"text-left width90 pL5",on:{click:function($event){return _vm.openSummaryView(workorder.id)}}},[_c("div",{staticClass:"relative-position"},[_c("div",{staticStyle:{width:"10%",float:"left"}},[_c("user-avatar",{attrs:{size:"md",user:workorder.requestedBy,showPopover:!0,name:!1}})],1),_c("div",{staticClass:"q-item-main q-item-section"},[_c("div",{staticClass:"q-item-label primary-field workRequest-heading"},[_vm._v(" "+_vm._s(workorder.subject)+" ")]),_c("div",{staticClass:"request-hours fc-grey2-text12 fR pT8"},[_c("i",{staticClass:"fa fa-clock-o fc-due-date-clock mR5"}),_vm._v(" "+_vm._s(_vm._f("fromNow")(workorder.createdTime))+" ")]),_c("div",{staticClass:"row",staticStyle:{"padding-top":"5px","align-items":"center","padding-left":"5px"}},[_c("div",{staticClass:"ellipsis fc-id"},[_vm._v(" #"+_vm._s(workorder.serialNumber)+" ")]),workorder.sourceType?[_c("span",{staticClass:"separator"},[_vm._v("|")]),_c("div",{staticStyle:{color:"#2ea2b2","padding-right":"5px"}},[2===workorder.sourceType?_c("i",{staticClass:"fa fa-envelope-o"}):10===workorder.sourceType?_c("i",{staticClass:"f14 fa fa-globe"}):1===workorder.sourceType?_c("i",{staticClass:"f14 el-icon-service approval-el-icon-service"}):4===workorder.sourceType?_c("i",{staticClass:"f14 el-icon-bell approval-el-icon-bell"}):5===workorder.sourceType?_c("i",{staticClass:"f14 el-icon-date approval-el-icon-date"}):_vm._e()])]:_vm._e()],2)])])])])})),0):_vm._e()])])]),_c("div",{staticClass:"col-8 fc-column-view-right-approval"},[_c("div",{attrs:{slot:"right"},slot:"right"},[_c("router-view",{attrs:{name:"summary"}})],1)])])])])])])},staticRenderFns=[],objectSpread2=__webpack_require__(595082),User=(__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(169358),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(648324),__webpack_require__(670560),__webpack_require__(857267),__webpack_require__(162506),__webpack_require__(228436),__webpack_require__(538077),__webpack_require__(425728),__webpack_require__(426803)),vuex_esm=__webpack_require__(420629),ApproveReject=__webpack_require__(600675),validation=__webpack_require__(990260),quasar_esm=__webpack_require__(641358),workorderTransform=__webpack_require__(112143),log_map_state=__webpack_require__(766331),ApprovalListvue_type_script_lang_js={mixins:[workorderTransform/* default */.Z],data:function(){return{loading:!0,selectedWorkorders:[],selectAll:!1,showFilter:!1,showName:"",emptyName:{name:"Unknow"},actions:{approve:{loading:!1},reject:{loading:!1},delete:{loading:!1}},sortConfig:{orderBy:{label:"Recent",value:"recent"},list:[{label:"Recent",value:"recent"},{label:"Oldest",value:"oldest"}]},sortValue:{orderBy:{label:"Recent",value:"createdTime"},orderType:"desc"},showQuickSearch:!1,quickSearchQuery:null,urgencyColorCode:{1:"#7fa5ff",2:"#f56837",3:"#e65244"}}},title:function(){return this.$options.filters.viewName(this.currentView)},created:function(){this.$store.dispatch("loadTicketCategory"),this.$store.dispatch("loadTicketPriority")},mounted:function(){this.loadApprovals(),this.loadApprovalCounts()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({workorders:function(){return this.$store.state.workorder.workorders},canEdit:function(){var moduleId=this.$getProperty(this.workorder,"moduleState.id",null);return!(0,validation/* isEmpty */.xb)(moduleId)&&!this.$store.getters.isStatusLocked(this.workorder.moduleState.id,"workorder")},includeParentFilter:function(){return this.$route.query.includeParentFilter&&("true"===this.$route.query.includeParentFilter||!0===this.$route.query.includeParentFilter)},openWorkorderId:function(){return this.$route.params.id?parseInt(this.$route.params.id):-1},currentView:function(){return this.$route.params.viewname?this.$route.params.viewname:"all"},filters:function(){return this.$route.query.search?JSON.parse(this.$route.query.search):null},page:function(){return this.$route.query.page||1},canShowFilteredFields:function(){var _this=this,canShow=!1;return this.filters&&Object.keys(this.filters).forEach((function(key){_this.filters[key].value.length&&(canShow=!0)})),canShow},showCreateNewDialog:function(){return!!this.$route.query.create}},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users},ticketcategory:function(state){return state.ticketCategory},ticketpriority:function(state){return state.ticketPriority},views:function(state){return state.view.views},currentViewDetail:function(state){return state.view.currentViewDetail}})),(0,log_map_state/* mapStateWithLogging */.g)({spaces:function(state){return state.spaces}})),(0,vuex_esm/* mapGetters */.Se)(["getTicketPriority"])),methods:{resetSelectAll:function(){this.selectedWorkorders=[],this.selectAll=!1},loadApprovals:function(){var _this2=this,queryObj={viewname:this.currentView,page:this.page,filters:this.filters,orderBy:this.sortValue.orderBy.value,orderType:this.sortValue.orderType,search:this.quickSearchQuery,includeParentFilter:this.includeParentFilter,isNew:!0};this.loading=!0,this.$store.dispatch("workorder/fetchApproval",queryObj).then((function(response){_this2.loading=!1})).catch((function(error){error&&(_this2.loading=!1)})),this.setTitle(this.$options.filters.viewName(this.currentView))},loadApprovalCounts:function(){var params,_this3=this,queryObj={viewname:this.currentView,filters:this.filters,search:this.quickSearchQuery,criteriaIds:this.$route.query.criteriaIds,includeParentFilter:this.includeParentFilter,count:!0},url="/v2/approvals/view/count?viewName="+queryObj.viewname;params="count="+queryObj.count,queryObj.filters&&(params=params+"&filters="+encodeURIComponent(JSON.stringify(queryObj.filters))),queryObj.search&&(params=params+"&search="+queryObj.search),queryObj.criteriaIds&&(params=params+"&criteriaIds="+queryObj.criteriaIds),queryObj.includeParentFilter&&(params=params+"&includeParentFilter="+queryObj.includeParentFilter),url=url+"&"+params,this.$http.get(url).then((function(response){_this3.listcount=response.data.woCount,_this3.$emit("syncCount",response.data.result.workorderscount)})).catch((function(error){}))},openSummaryView:function(id){this.$router.push({path:"/app/wo/approvals/wr/"+this.$route.params.viewname+"/summary/"+id})},deleteWorkOrder:function(idList){var _this4=this;this.$dialog.confirm({title:this.$t("maintenance._workorder.delete_wo"),message:this.$t("maintenance._workorder.delete_wo_body"),rbDanger:!0,rbLabel:this.$t("common._common.delete")}).then((function(value){value&&(_this4.actions.delete.loading=!0,_this4.$store.dispatch("workorder/deleteWorkOrder",{id:idList}).then((function(){_this4.actions.delete.loading=!1,_this4.$dialog.notify(_this4.$t("maintenance._workorder.wo_delete_success")),_this4.resetSelectAll()})))}))},filterApplied:function(filterData){var currentFilter=this.filters?this.filters:{};Object.keys(filterData).forEach((function(key){currentFilter[key]=Object.assign({},filterData[key])})),this.$router.replace({query:{search:JSON.stringify(currentFilter)}})},clearFiters:function(){this.$router.replace({path:this.$route.path,query:{}})},removeFilterField:function(fl,index){fl.value.splice(index,1),this.$router.replace({path:this.$route.path,query:{search:JSON.stringify(this.filters)}})},closeFilterDialog:function(){this.showFilter=!1},isSelected:function(id){for(var x in this.selectedWorkorders)if(this.selectedWorkorders[x]===id)return!0;return!1},notify:function(eventName){quasar_esm/* Toast */.FN.create('Event "'.concat(eventName,'" was triggered.'))},updateSort:function(sorting){"recent"===sorting.orderBy.value?(this.sortValue.orderBy.label="Recent",this.sortValue.orderBy.value="createdTime",this.sortValue.orderType="desc"):(this.sortValue.orderBy.label="Oldest",this.sortValue.orderBy.value="createdTime",this.sortValue.orderType="asc"),this.loadApprovals()},showQuickSearchBox:function(){this.showQuickSearch=!0},hideQuickSearchBox:function(){this.showQuickSearch=!1,this.quickSearchQuery&&this.quickSearchQuery.trim().length>0&&(this.quickSearchQuery=null,this.loadApprovals())},quickSearch:function(){this.quickSearchQuery&&this.quickSearchQuery.trim().length>0&&this.loadApprovals()},onFormSaved:function(){this.loadApprovals()}},watch:{currentView:function(newVal,oldVal){oldVal!==newVal&&(this.loadApprovals(),this.loadApprovalCounts())},filters:function(newVal){this.loadApprovals(),this.loadApprovalCounts()},selectAll:function(val){var _this5=this;val?(this.selectedWorkorders=[],this.workorders.filter((function(workorder){_this5.selectedWorkorders.push(workorder.id)}))):this.selectedWorkorders.length===this.workorders.length&&(this.selectedWorkorders=[])},selectedWorkorders:function(){this.selectedWorkorders.length!==this.workorders.length&&(this.selectAll=!1)},page:function(newVal,oldVal){oldVal===newVal||this.loading||this.loadApprovals()},workorders:function(){var _this6=this;if(this.openWorkorderId>0)if(this.workorders.length){var wo=this.workorders.find((function(workorder){return workorder.id===_this6.openWorkorderId}));if(!wo){var _newpath=this.$route.path.substring(0,this.$route.path.indexOf("/summary/"));_newpath+="/summary/"+this.workorders[0].id,this.$router.replace({path:_newpath})}}else{var newpath=this.$route.path.substring(0,this.$route.path.indexOf("/summary/"));this.$router.replace({path:newpath})}}},components:{QCheckbox:quasar_esm/* QCheckbox */.UZ,UserAvatar:User/* default */.Z,ApproveReject:ApproveReject/* default */.Z},filters:{viewName:function(name){return"open"===name?"Open Work Requests":"all"===name?"All Work Requests":"rejected"===name?"Rejected Work Requests":"Approval"}}},approval_ApprovalListvue_type_script_lang_js=ApprovalListvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(approval_ApprovalListvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ApprovalList=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/78641.js.map