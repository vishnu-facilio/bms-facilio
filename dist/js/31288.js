(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[31288,10500,77294,85305],{
/***/21864:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return OutsideClick}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/OutsideClick.vue?vue&type=template&id=6761c108
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.visibility?_c("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:_vm.onOutsideClick,expression:"onOutsideClick"}]},[_vm._t("default")],2):_vm._e()},staticRenderFns=[],OutsideClickvue_type_script_lang_js={props:["visibility"],methods:{onOutsideClick:function(){this.$emit("onOutsideClick"),this.$emit("update:visibility",!1)}}},components_OutsideClickvue_type_script_lang_js=OutsideClickvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_OutsideClickvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,OutsideClick=component.exports},
/***/604947:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return Spinner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/Spinner.vue?vue&type=template&id=06a81286&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("transition",[_c("svg",{directives:[{name:"show",rawName:"v-show",value:_vm.show,expression:"show"}],staticClass:"spinner",class:{show:_vm.show},attrs:{width:_vm.spinnerSize,height:_vm.spinnerSize,viewBox:"0 0 44 44"}},[_c("circle",{staticClass:"path",style:{stroke:_vm.strokeColor},attrs:{fill:"none","stroke-width":"4","stroke-linecap":"round",cx:"22",cy:"22",r:"20"}})])])},staticRenderFns=[],Spinnervue_type_script_lang_js={name:"spinner",props:["show","size","colour"],computed:{spinnerSize:function(){return this.size?this.size+"px":"50px"},strokeColor:function(){return this.colour?this.colour:"#fd4b92"}}},components_Spinnervue_type_script_lang_js=Spinnervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_Spinnervue_type_script_lang_js,render,staticRenderFns,!1,null,"06a81286",null)
/* harmony default export */,Spinner=component.exports},
/***/631153:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return PmPlannerpdf}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/pdf/PmPlannerpdf.vue?vue&type=template&id=6e7d503c
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"header-sidebar-hide pm-planner-pdf-page",class:{"header-sidebar-hide":"pdf/pmPlannerpdf"===_vm.$route.path}},[_vm.loading?_vm._e():_c("div",{staticClass:"pm-planner-pdf-con"},[_c("div",{staticClass:"pm-pdf-header"},[_c("div",{staticClass:"flex-middle justify-content-space"},[_c("div",{staticClass:"customer-logo"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.$org.logoUrl,expression:"$org.logoUrl"}]},[_c("img",{staticStyle:{width:"100px"},attrs:{src:_vm.$org.logoUrl}})])]),_c("div",{staticClass:"pm-pdf-heading text-center"},[_vm._v(" PM Calendar "+_vm._s(_vm.currentRangeTitle)+" ")]),_vm._m(0)])]),_c("div",{staticClass:"flex-middle justify-content-center pB20"},[_vm.assetFilters.hasOwnProperty("siteId")?_c("div",{staticClass:"fc-black-com f12 bold"},[_vm._v(" Site : "),_c("span",{staticClass:"fc-black-com f12 fw4"},[_vm._v(_vm._s(_vm.site))])]):_vm._e(),_vm.assetFilters.hasOwnProperty("buildingId")?_c("div",{staticClass:"fc-black-com f12 bold pL30"},[_vm._v(" Building : "),_c("span",{staticClass:"fc-black-com f12 fw4"},[_vm._v(_vm._s(_vm.building))])]):_vm._e(),_vm.assetFilters.hasOwnProperty("assetCategoryId")?_c("div",{staticClass:"fc-black-com bold f12 pL30"},[_vm._v(" Category : "),_c("span",{staticClass:"fc-black-com f12 fw4"},[_vm._v(_vm._s(_vm.category))])]):_vm._e(),_vm.assetFilters.hasOwnProperty("teamId")?_c("div",{staticClass:"fc-black-com bold f12 pL30"},[_vm._v(" Team : "),_c("span",{staticClass:"fc-black-com f12 fw4"},[_vm._v(_vm._s(_vm.team))])]):_vm._e(),_vm.assetFilters.hasOwnProperty("floorId")?_c("div",{staticClass:"fc-black-com bold f12 pL30"},[_vm._v(" Floor : "),_c("span",{staticClass:"fc-black-com f12 fw4"},[_vm._v(_vm._s(_vm.floor))])]):_vm._e(),_vm.trigger?_c("div",{staticClass:"fc-black-com f12 bold pL30"},[_vm._v(" Trigger : "),_c("span",{staticClass:"fc-black-com f12 fw4"},[_vm._v(_vm._s(_vm.trigger))])]):_vm._e()]),_vm.isSinglePM?_vm._e():_c(_vm.plannerType,{tag:"component"}),_vm.isSinglePM&&_vm.pmMetaLoaded?_c("pm-summary-planner",{attrs:{pm:_vm.pmMeta,isStaffPlanner:_vm.isStaffPlanner}}):_vm._e()],1)])},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"facil-logo"},[_c("img",{staticStyle:{width:"80px"},attrs:{src:__webpack_require__(117524)}})])}],objectSpread2=__webpack_require__(595082),PMAssetPlanner=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(169358),__webpack_require__(434284),__webpack_require__(821552),__webpack_require__(879288),__webpack_require__(466372)),PMStaffPlanner=__webpack_require__(738893),PMSpacePlanner=__webpack_require__(246905),PmSummaryPlannerView=__webpack_require__(132120),vuex_esm=__webpack_require__(420629),PmPlannerpdfvue_type_script_lang_js={created:function(){var _this=this;this.isSinglePM=null!=this.$route.query.pmId,this.isStaffPlanner=this.$route.query.staff,this.isSinglePM&&this.$http.get("/workorder/preventiveMaintenanceSummary?id="+parseInt(this.$route.query.pmId)).then((function(resp){_this.pmMeta=resp.data.preventivemaintenance,_this.pmMetaLoaded=!0})),this.$route.query.triggerId&&(this.trigger=decodeURIComponent(this.$route.query.triggerName)),this.$route.query.pmSubject&&(this.trigger=decodeURIComponent(this.$route.query.pmSubject)),
//when sites/buildings etc are removed from account api , need to dispatch those too
Promise.all([this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadBuildings"),this.$store.dispatch("loadSites"),this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadGroups")]).then((function(e){_this.loading=!1,_this.$route.query.assetFilters&&(
//set assetFilters only after all store data loaded, to avoid nullpointer on computed props
_this.assetFilters=JSON.parse(_this.$route.query.assetFilters),_this.setFilterNames())})),this.plannerType=this.$route.query.plannerType},props:[],components:{ASSET_PLANNER:PMAssetPlanner["default"],STAFF_PLANNER:PMStaffPlanner["default"],SPACE_PLANNER:PMSpacePlanner["default"],pmSummaryPlanner:PmSummaryPlannerView/* default */.Z},data:function(){return{loading:!0,isSinglePM:!1,isStaffPlanner:!1,pmMetaLoaded:!1,pmMeta:null,trigger:null,subject:null,assetFilters:{},plannerType:null,floor:null,team:null}},methods:{
//for floor and team
setFilterNames:function(){var _this2=this;if(this.assetFilters.hasOwnProperty("teamId")&&(this.assetFilters.teamId?this.team=this.$store.getters.getGroup(this.assetFilters.teamId).name:this.team="All teams"),this.assetFilters.hasOwnProperty("floorId"))if(this.assetFilters.floorId){var url="floor/"+this.assetFilters.floorId;this.$http.get(url).then((function(resp){_this2.floor=resp.data.record.name}))}else this.floor="All floors"}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory"])),{},{category:function(){return this.assetFilters&&this.assetFilters.assetCategoryId?this.getAssetCategory(this.assetFilters.assetCategoryId).name:"All"},site:function(){if(this.assetFilters&&this.assetFilters.siteId)return this.$store.getters.getSite(this.assetFilters.siteId).name},building:function(){return this.assetFilters&&this.assetFilters.buildingId?this.$store.getters.getBuildingNameById(this.assetFilters.buildingId):this.isSinglePM?void 0:"All ";
//for all pm no building filter implies all ,for single , dont even mention building
},currentRangeTitle:function(){var startTime=Number.parseInt(this.$route.query.startTime),endTime=Number.parseInt(this.$route.query.endTime);switch(this.$route.query.calendarTab){case"YEAR":return this.$helpers.getOrgMoment(startTime).format("YYYY");case"MONTH":return this.$helpers.getOrgMoment(startTime).format("MMMM")+"  "+this.$helpers.getOrgMoment(startTime).format("YYYY");case"WEEK":return this.$helpers.getOrgMoment(startTime).format("MMMM")+"  "+this.$helpers.getOrgMoment(startTime).format("DD")+" - "+this.$helpers.getOrgMoment(endTime).format("DD")+" "+this.$helpers.getOrgMoment(endTime).format("MMMM");case"DAY":return this.$helpers.getOrgMoment(startTime).format("DD-MMMM-YYYY");default:return null}}})},pdf_PmPlannerpdfvue_type_script_lang_js=PmPlannerpdfvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(pdf_PmPlannerpdfvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PmPlannerpdf=component.exports},
/***/466372:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return PMAssetPlanner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMAssetPlanner.vue?vue&type=template&id=7c981642
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"new-planner pm-resource-planner pR15 pL15"},[_c("facilio-resource-planner",{ref:"resourcePlanner",attrs:{plannerType:"ASSET_PLANNER",isServerRows:!0,customizationSettings:_vm.customizationSettings,paginate:_vm.paginate,pageSize:_vm.perPage,defaultView:"YEAR",resourceGrouping:_vm.grouping,saving:_vm.requestPending,isPMAssetPlanner:!0,isDragDropAllowed:_vm.enableDragAndDrop,allowDownload:!0,noDataText:"No workorders"},on:{viewChanged:_vm.handleViewChanged,dropped:_vm.handleDrop},scopedSlots:_vm._u([{key:"taskContent",fn:function(eventProps){return[_c("div",{staticClass:"rp-task-text ellipsis"},[_vm._v(" "+_vm._s(eventProps.event[eventProps.displayType])+" ")])]}},{key:"card",fn:function(slotProps){return[_c("pm-wo-card",{attrs:{plannerEvent:slotProps,allowStaffReAssign:!0},on:{close:_vm.$refs["resourcePlanner"].handleCardClose,deleteWo:function($event){return _vm.$refs["resourcePlanner"].deleteEvent($event)}}})]}}])},[_c("template",{slot:"plannerLeftTop"},[_c("planner-filter",{attrs:{filterOptions:_vm.assetFilters},on:{filterChanged:_vm.handleFilterChange}})],1),_c("template",{slot:"plannerRightTop"},[_c("planner-legend",{attrs:{legendMap:_vm.legendMap,legendName:_vm.legendName}})],1)],2)],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),FacilioResourcePlanner=(__webpack_require__(169358),__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(538077),__webpack_require__(762795),__webpack_require__(413383),__webpack_require__(947522),__webpack_require__(865137),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(511982)),LegendHelper=__webpack_require__(279729),PlannerLegend=__webpack_require__(481632),PlannerAPICalls=__webpack_require__(910036),PMPlannerFilter=__webpack_require__(178116),vuex_esm=__webpack_require__(420629),PMWoCard=__webpack_require__(801825),wo_util=__webpack_require__(730347),PMAssetPlannervue_type_script_lang_js={mixins:[LegendHelper/* default */.Z],props:["disablePaginate"],components:{"facilio-resource-planner":FacilioResourcePlanner/* default */.Z,PmWoCard:PMWoCard/* default */.Z,plannerFilter:PMPlannerFilter/* default */.Z,plannerLegend:PlannerLegend/* default */.Z},beforeUpdate:function(){},updated:function(){},watch:{appliedWoFilters:function(newVal,oldVal){this.$refs["resourcePlanner"].refreshGrid()}},data:function(){return{
// pmList: []
// jobsData: [],
customizationSettings:{columnSettings:!0,legendSettings:!0,calendarSettings:!0},legendMap:null,storeDepsLoaded:!1,enableDragAndDrop:!1,paginate:!0,perPage:15,grouping:!1,assetFilters:{siteId:null,assetCategoryId:null,buildingId:null},isGlobalSite:!1,legendColorAttribute:null,legendName:null,requestPending:!1,siteList:[],buildings:[]}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.initResources();case 2:_this.setTitle(_this.$t("maintenance.calender.asset_planner")),
//temp for debugging purposes
// *********************
null!=_this.$route.query.paginate&&(_this.paginate=JSON.parse(_this.$route.query.paginate)),_this.disablePaginate&&(_this.paginate=!1),null!=_this.$route.query.perPage&&(_this.perPage=JSON.parse(_this.$route.query.perPage)),
// *********************
_this.$route.query.assetFilters?_this.assetFilters=JSON.parse(_this.$route.query.assetFilters):(_this.assetFilters.siteId=_this.getCurrentSiteId(),-1==_this.assetFilters.siteId?
//if user in all sites mode , select the first site
_this.assetFilters.siteId=_this.siteList[0].id:_this.isGlobalSite=!0,_this.setQueryParams());case 7:case"end":return _context.stop()}}),_callee)})))()},mounted:function(){},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getCurrentSiteId"])),{},{appliedWoFilters:function(){return this.$route.query.search?JSON.parse(this.$route.query.search):null}}),methods:{initResources:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,(0,wo_util/* getSites */.E)();case 2:return _this2.siteList=_context2.sent,_context2.next=5,(0,wo_util/* getBuildings */.x)();case 5:_this2.buildings=_context2.sent;case 6:case"end":return _context2.stop()}}),_callee2)})))()},handleViewChanged:function(e){var _this3=this;this.legendColorAttribute=e.settings.legendSettings[0].name,this.legendName=e.settings.legendSettings[0].displayName,this.plannerSettings=e.settings,this.grouping=e.settings.columnSettings.find((function(e){return"categoryName"==e.name})).enabled;
//if atleast one draggable column is enabled enable drag and drop in pm planner
var enabledMetrics=e.settings.timeMetricSettings.filter((function(e){return e.enabled}));1==enabledMetrics.length&&"planned"==enabledMetrics[0].name||"due"==enabledMetrics[0].name?this.enableDragAndDrop=!0:this.enableDragAndDrop=!1,this.fetchPMJobs(e).then((function(){_this3.colorCodeWorkOrders(_this3.legendColorAttribute,_this3.jobsData.data.flat(),enabledMetrics).then((function(legend){_this3.legendMap=legend,_this3.renderJobs()}))}))},fetchPMJobs:function(e){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var pmResp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,PlannerAPICalls/* default */.Z.getAllJobs(_this4.assetFilters,_this4.appliedWoFilters,e,"ASSET_PLANNER");case 2:
// console.log('jobs data  stored in comp is ',this.jobsData)
return pmResp=_context3.sent,
//sort each row based on time
pmResp.data.forEach((function(row){row.forEach((function(e){e.colorIndex=-1,e.frequencyID=e.frequency,//save frequency ID ie 1,2,4 in id field and actualy string in frequency field
e.frequency=_this4.$constants.FACILIO_FREQUENCY[e.frequency].substring(0,1)})),row.sort((function(e1,e2){return e1.start-e2.start}))})),_this4.jobsData=pmResp,_context3.abrupt("return");case 6:case"end":return _context3.stop()}}),_callee3)})))()},renderJobs:function(){
//let beforeRenderJobs=performance.now()
this.$refs["resourcePlanner"].renderPlannerNew(this.jobsData.resourceHeaders,this.jobsData.resourceTitles,this.jobsData.data);
//console.warn('time for renderJobs',performance.now()-beforeRenderJobs)
},setQueryParams:function(){this.$router.replace({query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.$route.query),{},{assetFilters:JSON.stringify(this.assetFilters)})})},handleFilterChange:function(changedFilter){this.assetFilters=changedFilter,this.setQueryParams(),this.showFilter=!1,this.$refs["resourcePlanner"].refreshGrid()},handleDrop:function(e){var _this5=this,wo=e.event,url="/v2/pmplanner/jobs/update",workorder={id:wo.id};if("planned"==wo.time)workorder.scheduledStart=wo.start;else{if("due"!=wo.time)return;workorder.dueDate=wo.start}this.requestPending=!0,this.$http.post(url,{workorder:workorder}).then((function(resp){_this5.requestPending=!1}))}}},workorder_PMAssetPlannervue_type_script_lang_js=PMAssetPlannervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PMAssetPlannervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMAssetPlanner=component.exports},
/***/178116:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PMPlannerFilter}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMPlannerFilter.vue?vue&type=template&id=da65bbf4
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pm-planner-filter"},[_c("div",{staticClass:"pm-resource-input-search"},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"fc-border-input-div2 pointer",staticStyle:{width:"285px"},on:{click:function($event){$event.stopPropagation(),_vm.showFilter=!0}}},[_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.siteName)+" ")]),_c("div",{staticClass:"fc-grey-text f11"},[_vm._v(" "+_vm._s(_vm.buildingName)+" / "+_vm._s(_vm.selectedFilters.hasOwnProperty("assetCategoryId")?_vm.assetCategoryName:null)+" "+_vm._s(_vm.selectedFilters.hasOwnProperty("teamId")?_vm.teamName:null)+" "+_vm._s(_vm.selectedFilters.hasOwnProperty("floorId")?_vm.floorName:null)+" ")])]),_c("el-button",{staticClass:"pm-search-btn pointer",attrs:{type:"primmary"},on:{click:function($event){_vm.showFilter=!0}}},[_c("InlineSvg",{attrs:{src:"svgs/filter",iconClass:"icon icon-md text-center vertical-baseline"}})],1)],1)]),_vm.showFilter?_c("outside-click",{attrs:{visibility:!0},on:{onOutsideClick:function($event){_vm.showFilter=!1}}},[_c("div",{staticClass:"pm-resource-input-select-con"},[_c("div",{staticClass:"pL20 pR20"},[_c("el-tooltip",{staticClass:"item showfilter-close-icon z-30",attrs:{effect:"dark",content:"Close",placement:"top"}},[_c("i",{staticClass:"el-icon-close pointer",attrs:{"aria-hidden":"true"},on:{click:function($event){_vm.showFilter=!1}}})]),_c("el-row",{staticClass:"pT40"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Site")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",filterable:"",loading:_vm.siteLoading,remote:"","remote-method":_vm.siteRemoteMethod},on:{change:_vm.siteChanged},model:{value:_vm.selectedFilters.siteId,callback:function($$v){_vm.$set(_vm.selectedFilters,"siteId",$$v)},expression:"selectedFilters.siteId"}},_vm._l(_vm.siteList,(function(site){return _c("el-option",{key:site.id,attrs:{label:site.name,value:site.id}})})),1)],1)])],1),_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Building")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{clearable:"",placeholder:"Select",filterable:"",loading:_vm.siteLoading,remote:"","remote-method":_vm.buildingRemoteMethod},on:{change:_vm.buildingChanged},model:{value:_vm.selectedFilters.buildingId,callback:function($$v){_vm.$set(_vm.selectedFilters,"buildingId",$$v)},expression:"selectedFilters.buildingId"}},_vm._l(_vm.buildingsInSite,(function(building){return _c("el-option",{key:building.id,attrs:{label:building.name,value:building.id}})})),1)],1)])],1),_vm.selectedFilters.hasOwnProperty("floorId")?_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Floor")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",clearable:"",filterable:""},model:{value:_vm.selectedFilters.floorId,callback:function($$v){_vm.$set(_vm.selectedFilters,"floorId",$$v)},expression:"selectedFilters.floorId"}},_vm._l(_vm.floorList,(function(floor){return _c("el-option",{key:floor.id,attrs:{label:floor.name,value:floor.id}})})),1)],1)])],1):_vm._e(),_vm.selectedFilters.hasOwnProperty("assetCategoryId")?_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Asset category")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",clearable:"",filterable:""},model:{value:_vm.selectedFilters.assetCategoryId,callback:function($$v){_vm.$set(_vm.selectedFilters,"assetCategoryId",$$v)},expression:"selectedFilters.assetCategoryId"}},_vm._l(_vm.assetCategories,(function(assetCategory){return _c("el-option",{key:assetCategory.id,attrs:{label:assetCategory.displayName,value:assetCategory.id}})})),1)],1)])],1):_vm._e(),_vm.selectedFilters.hasOwnProperty("teamId")?_c("el-row",{staticClass:"pT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v("Team")]),_c("div",{},[_c("el-select",{staticClass:"fc-input-full-border2 width100 pT10",attrs:{placeholder:"Select",clearable:"",filterable:""},model:{value:_vm.selectedFilters.teamId,callback:function($$v){_vm.$set(_vm.selectedFilters,"teamId",$$v)},expression:"selectedFilters.teamId"}},_vm._l(_vm.teams,(function(team){return _c("el-option",{key:team.id,attrs:{label:team.name,value:team.id}})})),1)],1)])],1):_vm._e()],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-save width100",attrs:{type:"primary"},on:{click:_vm.handleSave}},[_vm._v("Save")])],1)])]):_vm._e()],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(538077),__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(689730),__webpack_require__(420629)),OutsideClick=__webpack_require__(21864),wo_util=__webpack_require__(730347),debounce=__webpack_require__(23279),debounce_default=__webpack_require__.n(debounce),validation=__webpack_require__(990260),PMPlannerFiltervue_type_script_lang_js={components:{outsideClick:OutsideClick/* default */.Z},
//copy and display filter props, on save , emit changed filter props
created:function(){var _this=this,filterOptions=this.filterOptions;this.$set(this,"selectedFilters",filterOptions),
//this.selectedFilters = this.$helpers.cloneObject(this.filterOptions)
this.siteRemoteMethod=debounce_default()(this.filterSites,500),this.buildingRemoteMethod=debounce_default()(this.filterBuildingsInSite,500),Promise.all([this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadGroups"),this.initResources()]).then((function(){_this.selectedFilters.buildingId&&_this.getFloorList(),_this.setFilterLabels()}))},props:["filterOptions"],computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetCategories:function(state){return state.assetCategory},teams:function(state){return state.groups}})),(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory"])),data:function(){return{buildingName:null,assetCategoryName:null,siteName:null,teamName:null,floorName:null,showFilter:!1,floorList:[],selectedFilters:{},siteList:[],buildings:[],siteLoading:!1,buildingLoading:!1,buildingsInSite:[]}},methods:{initResources:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,wo_util/* getSites */.E)();case 2:return _this2.siteList=_context.sent,_context.next=5,(0,wo_util/* getBuildings */.x)();case 5:_this2.buildings=_context.sent;case 6:case"end":return _context.stop()}}),_callee)})))()},filterSites:function(searchText){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this3.siteLoading=!0,_context2.next=3,(0,wo_util/* getSites */.E)({searchText:searchText});case 3:_this3.siteList=_context2.sent,_this3.siteLoading=!1;case 5:case"end":return _context2.stop()}}),_callee2)})))()},filterBuildingsInSite:function(searchText){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var selectedFilters,_ref,siteId,params;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return selectedFilters=_this4.selectedFilters,_ref=selectedFilters||{},siteId=_ref.siteId,params={siteId:siteId},(0,validation/* isEmpty */.xb)(searchText)||(params=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},params),{},{searchText:searchText})),_this4.buildingLoading=!0,_context3.next=7,(0,wo_util/* getBuildings */.x)(params);case 7:_this4.buildingsInSite=_context3.sent,_this4.buildingLoading=!1;case 9:case"end":return _context3.stop()}}),_callee3)})))()},handleSave:function(){
//on save set new lables in filter UI
this.setFilterLabels(),this.$emit("filterChanged",this.selectedFilters),this.showFilter=!1},siteChanged:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _this5.selectedFilters.buildingId=null,_context4.next=3,_this5.filterBuildingsInSite();case 3:_this5.buildingChanged();case 4:case"end":return _context4.stop()}}),_callee4)})))()},buildingChanged:function(){this.selectedFilters.hasOwnProperty("floorId")&&(this.selectedFilters.floorId=null,this.getFloorList())},getFloorList:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var url,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(_this6.selectedFilters.buildingId){_context5.next=3;break}return _this6.floorList=[],_context5.abrupt("return");case 3:return url="floor?buildingId=".concat(_this6.selectedFilters.buildingId),_context5.next=6,_this6.$http.get(url);case 6:return resp=_context5.sent,_this6.floorList=resp.data.records,_context5.abrupt("return");case 9:case"end":return _context5.stop()}}),_callee5)})))()},setFilterLabels:function(){var _this7=this,site=this.siteList.filter((function(site){return site.id==_this7.selectedFilters.siteId}))||[];if((0,validation/* isEmpty */.xb)(site)||1!=site.length)this.siteName="";else{var _ref2=site[0]||{},name=_ref2.name;this.siteName=name||""}
// Setting Building name
var selectedFilters=this.selectedFilters,buildingsInSite=this.buildingsInSite,_ref3=selectedFilters||{},buildingId=_ref3.buildingId;if((0,validation/* isEmpty */.xb)(buildingId))this.$set(this,"buildingName","All buildings");else{var building=buildingsInSite.find((function(building){return building.id==buildingId})),buildingName=building?building.name:"";
// Truncate the building name if it has more than 25 characters
!(0,validation/* isEmpty */.xb)(buildingName)&&buildingName.length>25&&(buildingName=buildingName.slice(0,25)+"..."),this.$set(this,"buildingName",buildingName)}this.assetCategoryName=this.selectedFilters.assetCategoryId?this.getAssetCategory(this.selectedFilters.assetCategoryId).displayName:"All categories",this.teamName=this.selectedFilters.teamId?this.$store.getters.getGroup(this.selectedFilters.teamId).name:"All teams",this.selectedFilters.floorId?this.getFloorList().then((function(){_this7.floorName=_this7.floorList.find((function(e){return e.id==_this7.selectedFilters.floorId})).name})):this.floorName="All floors"}}},workorder_PMPlannerFiltervue_type_script_lang_js=PMPlannerFiltervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PMPlannerFiltervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMPlannerFilter=component.exports},
/***/246905:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return PMSpacePlanner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMSpacePlanner.vue?vue&type=template&id=18e88092
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"new-planner pm-resource-planner pR15 pL15"},[_c("facilio-resource-planner",{ref:"resourcePlanner",attrs:{plannerType:"SPACE_PLANNER",isServerRows:!0,customizationSettings:_vm.customizationSettings,paginate:_vm.paginate,pageSize:_vm.perPage,defaultView:"YEAR",resourceGrouping:_vm.grouping,saving:_vm.requestPending,isPMAssetPlanner:!0,isDragDropAllowed:_vm.enableDragAndDrop,allowDownload:!0,noDataText:"No workorders"},on:{viewChanged:_vm.handleViewChanged,dropped:_vm.handleDrop},scopedSlots:_vm._u([{key:"taskContent",fn:function(eventProps){return[_c("div",{staticClass:"rp-task-text ellipsis"},[_vm._v(" "+_vm._s(eventProps.event[eventProps.displayType])+" ")])]}},{key:"card",fn:function(slotProps){return[_c("pm-wo-card",{attrs:{plannerEvent:slotProps,allowStaffReAssign:!0},on:{close:_vm.$refs["resourcePlanner"].handleCardClose,deleteWo:function($event){return _vm.$refs["resourcePlanner"].deleteEvent($event)}}})]}}])},[_c("template",{slot:"plannerLeftTop"},[_c("planner-filter",{attrs:{filterOptions:_vm.assetFilters},on:{filterChanged:_vm.handleFilterChange}})],1),_c("template",{slot:"plannerRightTop"},[_c("planner-legend",{attrs:{legendMap:_vm.legendMap,legendName:_vm.legendName}})],1)],2)],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),FacilioResourcePlanner=(__webpack_require__(169358),__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(538077),__webpack_require__(762795),__webpack_require__(413383),__webpack_require__(947522),__webpack_require__(865137),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(511982)),LegendHelper=__webpack_require__(279729),PlannerLegend=__webpack_require__(481632),PlannerAPICalls=__webpack_require__(910036),PMPlannerFilter=__webpack_require__(178116),vuex_esm=__webpack_require__(420629),PMWoCard=__webpack_require__(801825),PMSpacePlannervue_type_script_lang_js={mixins:[LegendHelper/* default */.Z],props:["disablePaginate"],components:{"facilio-resource-planner":FacilioResourcePlanner/* default */.Z,PmWoCard:PMWoCard/* default */.Z,plannerFilter:PMPlannerFilter/* default */.Z,plannerLegend:PlannerLegend/* default */.Z},beforeUpdate:function(){},updated:function(){},watch:{appliedWoFilters:function(newVal,oldVal){this.$refs["resourcePlanner"].refreshGrid()}},data:function(){return{
// pmList: []
// jobsData: [],
customizationSettings:{columnSettings:!0,legendSettings:!0,calendarSettings:!0},legendMap:null,storeDepsLoaded:!1,enableDragAndDrop:!1,paginate:!0,perPage:15,grouping:!1,assetFilters:{siteId:null,buildingId:null,floorId:null},isGlobalSite:!1,legendColorAttribute:null,legendName:null,requestPending:!1}},created:function(){this.$store.dispatch("loadSite"),this.setTitle(this.$t("maintenance.calender.space_planner")),
//temp for debugging purposes
// *********************
null!=this.$route.query.paginate&&(this.paginate=JSON.parse(this.$route.query.paginate)),this.disablePaginate&&(this.paginate=!1),null!=this.$route.query.perPage&&(this.perPage=JSON.parse(this.$route.query.perPage)),
// *********************
this.$route.query.assetFilters?this.assetFilters=JSON.parse(this.$route.query.assetFilters):(this.assetFilters.siteId=this.getCurrentSiteId(),-1==this.assetFilters.siteId?
//if user in all sites mode , select the first site
this.assetFilters.siteId=this.sites[0].id:this.isGlobalSite=!0,this.setQueryParams())},mounted:function(){},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({buildings:function(state){return state.buildings},sites:function(state){return state.site}})),(0,vuex_esm/* mapGetters */.Se)(["getCurrentSiteId"])),{},{appliedWoFilters:function(){return this.$route.query.search?JSON.parse(this.$route.query.search):null}}),methods:{handleViewChanged:function(e){var _this=this;this.legendColorAttribute=e.settings.legendSettings[0].name,this.legendName=e.settings.legendSettings[0].displayName,this.plannerSettings=e.settings,this.grouping=e.settings.columnSettings.find((function(e){return"categoryName"==e.name})).enabled;
//if atleast one draggable column is enabled enable drag and drop in pm planner
var enabledMetrics=e.settings.timeMetricSettings.filter((function(e){return e.enabled}));1==enabledMetrics.length&&"planned"==enabledMetrics[0].name||"due"==enabledMetrics[0].name?this.enableDragAndDrop=!0:this.enableDragAndDrop=!1,this.fetchPMJobs(e).then((function(){_this.colorCodeWorkOrders(_this.legendColorAttribute,_this.jobsData.data.flat(),enabledMetrics).then((function(legend){_this.legendMap=legend,_this.renderJobs()}))}))},fetchPMJobs:function(e){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var pmResp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,PlannerAPICalls/* default */.Z.getAllJobs(_this2.assetFilters,_this2.appliedWoFilters,e,"SPACE_PLANNER");case 2:
// console.log('jobs data  stored in comp is ',this.jobsData)
return pmResp=_context.sent,
//sort each row based on time
pmResp.data.forEach((function(row){row.forEach((function(e){e.colorIndex=-1,e.frequencyID=e.frequency,//save frequency ID ie 1,2,4 in id field and actualy string in frequency field
e.frequency=_this2.$constants.FACILIO_FREQUENCY[e.frequency].substring(0,1)})),row.sort((function(e1,e2){return e1.start-e2.start}))})),_this2.jobsData=pmResp,_context.abrupt("return");case 6:case"end":return _context.stop()}}),_callee)})))()},renderJobs:function(){
//let beforeRenderJobs=performance.now()
this.$refs["resourcePlanner"].renderPlannerNew(this.jobsData.resourceHeaders,this.jobsData.resourceTitles,this.jobsData.data);
//console.warn('time for renderJobs',performance.now()-beforeRenderJobs)
},setQueryParams:function(){this.$router.replace({query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.$route.query),{},{assetFilters:JSON.stringify(this.assetFilters)})})},handleFilterChange:function(changedFilter){this.assetFilters=changedFilter,this.setQueryParams(),this.showFilter=!1,this.$refs["resourcePlanner"].refreshGrid()},handleDrop:function(e){var _this3=this,wo=e.event,url="/v2/pmplanner/jobs/update",workorder={id:wo.id};if("planned"==wo.time)workorder.scheduledStart=wo.start;else{if("due"!=wo.time)return;workorder.dueDate=wo.start}this.requestPending=!0,this.$http.post(url,{workorder:workorder}).then((function(resp){_this3.requestPending=!1}))}}},workorder_PMSpacePlannervue_type_script_lang_js=PMSpacePlannervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PMSpacePlannervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMSpacePlanner=component.exports},
/***/738893:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return PMStaffPlanner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMStaffPlanner.vue?vue&type=template&id=661d6748
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"new-planner pm-resource-planner pR15 pL15"},[_c("facilio-resource-planner",{ref:"resourcePlanner",attrs:{plannerType:"STAFF_PLANNER",customizationSettings:_vm.customizationSettings,views:["DAY","WEEK","MONTH"],defaultView:"MONTH",saving:_vm.requestPending,isDragDropAllowed:_vm.enableDragAndDrop,isRowDragRestrict:!1,allowDownload:!0,noDataText:"No workorders"},on:{viewChanged:_vm.handleViewChanged,dropped:_vm.handleDrop},scopedSlots:_vm._u([{key:"taskContent",fn:function(eventProps){return[_c("div",{staticClass:"rp-task-text ellipsis"},[_vm._v(" "+_vm._s(eventProps.event[eventProps.displayType])+" ")])]}},{key:"card",fn:function(slotProps){return[_c("StaffPlannerCard",{attrs:{plannerEvent:slotProps},on:{close:_vm.$refs["resourcePlanner"].handleCardClose,deleteWo:function($event){return _vm.$refs["resourcePlanner"].deleteEvent($event)}}})]}}])},[_c("template",{slot:"resourceSelection"},[_c("div",{staticClass:"width200 fc-input-full-border2 mR10 fc-input-border-remove fc-input-full-border2-bold"},[_vm._v(" Staff ")])]),_c("template",{slot:"plannerLeftTop"},[_c("planner-filter",{attrs:{filterOptions:_vm.assetFilters},on:{filterChanged:_vm.handleFilterChange}})],1),_c("template",{slot:"plannerRightTop"},[_c("planner-legend",{attrs:{legendMap:_vm.legendMap,legendName:_vm.legendName}})],1)],2)],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),objectSpread2=__webpack_require__(595082),FacilioResourcePlanner=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(169358),__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(434284),__webpack_require__(634338),__webpack_require__(450886),__webpack_require__(538077),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(865137),__webpack_require__(425728),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(511982)),PlannerAPICalls=__webpack_require__(910036),PMPlannerFilter=__webpack_require__(178116),vuex_esm=__webpack_require__(420629),StaffPlannerCardvue_type_template_id_60156626_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pm-wo-card"},[_vm.loading?_c("div",{staticClass:"height300 d-flex justify-center align-center"},[_c("spinner",{attrs:{show:!0,size:"80"}})],1):_c("div",[_c("div",{staticClass:"pm-wo-card-header"},[_c("div",{},[_c("span",{staticClass:"fc-black-12 pR10 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatDateFull(_vm.plannerEvent.event.start)))]),_c("span",{staticClass:"separator white-color"},[_vm._v("|")]),_c("span",{staticClass:"fc-black-11 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatTimeFull(_vm.plannerEvent.event.start)))])]),_c("div",{staticClass:"pm-wo-card-header-close",on:{click:function($event){return _vm.$emit("close")}}},[_c("i",{staticClass:"el-icon-close fc-black3-16 fwBold white-color"})]),_c("div",{staticClass:"fc-black3-16 pT10 white-color"},[_vm._v(" "+_vm._s(_vm.workorder.subject)+" ")])]),_c("div",{staticClass:"pm-wo-card-body"},[_c("el-row",{staticClass:"pB30"},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left pT15"},[_vm._v("Assigned To")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left pT15"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.workorder,"assignedTo.name","Unassigned"))+" "+_vm._s(_vm.$getProperty(_vm.workorder,"assignedTo.name",null)?"/"+_vm.$getProperty(_vm.workorder,"assignmentGroup.name","--"):null)+" ")])])],1),_c("el-row",{},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left"},[_vm._v(" "+_vm._s(_vm.resourceTitle)+" ")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.workorder,"resource.name","--"))+" ")])])],1)],1),_c("div",{staticClass:"pm-wo-card-footer display-flex-between-space flex-middle p30 pT10 pB20"},[_c("div",{staticClass:"text-left"},[_c("router-link",{staticClass:"fc-dark-blue3-12 pointer",attrs:{to:_vm.openWoSummary(_vm.plannerEvent.event.id)}},[_vm._v("View Details")])],1),_c("div",{staticClass:"text-right"},[_vm.plannerEvent.col.past?_vm._e():_c("el-button",{staticClass:"fc-btn-icon-delete pointer",on:{click:function($event){return _vm.handleDelete(_vm.plannerEvent.event.id)}}},[_c("i",{staticClass:"el-icon-delete pR10"}),_vm._v(" Delete ")])],1)])])])},StaffPlannerCardvue_type_template_id_60156626_staticRenderFns=[],router=__webpack_require__(329435),Spinner=__webpack_require__(604947),api=__webpack_require__(32284),StaffPlannerCardvue_type_script_lang_js={components:{Spinner:Spinner/* default */.Z},props:["plannerEvent"],data:function(){return{loading:!0,workorder:null}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$get,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,api/* API */.bl.get("/workorder/summary/".concat(_this.plannerEvent.event.id));case 2:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this.$message.error("Error fetching workorder details for ",_this.plannerEvent.id):(_this.workorder=data.workorder,_this.loading=!1);case 6:case"end":return _context.stop()}}),_callee)})))()},methods:{openWoSummary:function(id){if(!(0,router/* isWebTabsEnabled */.tj)())return{name:"wosummarynew",params:{id:id}};var _ref=(0,router/* findRouteForModule */.Jp)("workorder",router/* pageTypes */.As.OVERVIEW)||{},name=_ref.name;return name?this.$router.resolve({name:name,params:{viewname:"all",id:id}}).href:void 0},handleDelete:function(workorderID){var _this2=this;this.$dialog.confirm({title:this.$t("maintenance._workorder.delete_wo"),message:this.$t("maintenance._workorder.delete_wo_body"),rbDanger:!0,rbLabel:this.$t("common._common.delete")}).then((function(confirmDelete){confirmDelete&&(_this2.$emit("deleteWo",workorderID),PlannerAPICalls/* default */.Z.deleteWorkOrder(workorderID).then((function(e){})))}))}},computed:{resourceTitle:function(){
//associated resource field,check if asset or space
return 2===this.plannerEvent.event.resource.resourceType?"Asset":"Space"}}},workorder_StaffPlannerCardvue_type_script_lang_js=StaffPlannerCardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_StaffPlannerCardvue_type_script_lang_js,StaffPlannerCardvue_type_template_id_60156626_render,StaffPlannerCardvue_type_template_id_60156626_staticRenderFns,!1,null,null,null)
/* harmony default export */,StaffPlannerCard=component.exports,LegendHelper=__webpack_require__(279729),PlannerLegend=__webpack_require__(481632),wo_util=__webpack_require__(730347),validation=__webpack_require__(990260),PMStaffPlannervue_type_script_lang_js={mixins:[LegendHelper/* default */.Z],components:{"facilio-resource-planner":FacilioResourcePlanner/* default */.Z,StaffPlannerCard:StaffPlannerCard,plannerFilter:PMPlannerFilter/* default */.Z,plannerLegend:PlannerLegend/* default */.Z},beforeUpdate:function(){},updated:function(){},watch:{appliedWoFilters:function(newVal,oldVal){this.$refs["resourcePlanner"].refreshGrid()},sites:function(newVal,oldVal){if(!(0,validation/* isEmpty */.xb)(newVal)){var assetFilters=this.assetFilters,siteId=assetFilters.siteId;((0,validation/* isEmpty */.xb)(siteId)||siteId<0)&&!(0,validation/* isEmpty */.xb)(newVal[0])&&(this.assetFilters.siteId=newVal[0].id)}}},data:function(){return{
// pmList: []
legendMap:null,customizationSettings:{legendSettings:!0},jobsData:[],staffList:[],storeDepsLoaded:!1,enableDragAndDrop:!0,perPage:15,grouping:!1,assetFilters:{siteId:null,buildingId:null,teamId:null},isGlobalSite:!1,legendColorAttribute:null,legendName:null,requestPending:!1,sites:[]}},created:function(){var _this=this;this.setTitle(this.$t("maintenance.calender.staff_planner")),this.$store.dispatch("view/loadModuleMeta","workorder"),
//wait for store dependencies to load for applying filters
Promise.all([this.$store.dispatch("loadTicketCategory"),this.$store.dispatch("loadTicketType"),this.$store.dispatch("loadSite"),this.$store.dispatch("loadTicketStatus","workorder"),this.$store.dispatch("loadTicketPriority"),this.$store.dispatch("loadUsers")]).then((function(){_this.storeDepsLoaded=!0})),this.$route.query.assetFilters?this.assetFilters=JSON.parse(this.$route.query.assetFilters):(this.assetFilters.siteId=this.getCurrentSiteId(),-1==this.assetFilters.siteId?
//if user in all sites mode , select the first site
(0,validation/* isEmpty */.xb)(this.sites[0])||(this.assetFilters.siteId=this.sites[0].id):this.isGlobalSite=!0,this.setQueryParams())},mounted:function(){},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}
//sites: state => state.site,
})),(0,vuex_esm/* mapGetters */.Se)(["getCurrentSiteId"])),{},{appliedWoFilters:function(){return this.$route.query.search?JSON.parse(this.$route.query.search):null}}),methods:{handleViewChanged:function(e){var _this2=this;this.legendColorAttribute=e.settings.legendSettings[0].name,this.legendName=e.settings.legendSettings[0].displayName,this.fetchSitesList().then((function(){_this2.fetchData(e).then((function(){_this2.colorCodeWorkOrders(_this2.legendColorAttribute,_this2.jobsData).then((function(legend){_this2.legendMap=legend,_this2.renderJobs()}))}))}))},getStaffList:function(){var _this3=this,staffList=[{id:-99,title:"Unassigned",userStatus:!0}].concat((0,toConsumableArray/* default */.Z)(this.users.filter((function(user){
//   if(!user.userStatus)return false
//need to do , show disabled users if they have pending workorders
//based on applied filters check if staff can be included in the final list
var teamCondition=!0;
// if team filter not even applied  always true,  show all  users in final list
_this3.assetFilters.teamId&&(
//if user has teams check if selected team in filter matches
teamCondition=!!user.groups&&user.groups.includes(_this3.assetFilters.teamId));var siteCondition=!0;_this3.assetFilters.siteId&&user.accessibleSpace&&(siteCondition=user.accessibleSpace.includes(_this3.assetFilters.siteId));var buildingCondition=!0;return _this3.assetFilters.buildingId&&user.accessibleSpace&&(buildingCondition=user.accessibleSpace.includes(_this3.assetFilters.siteId)||user.accessibleSpace.includes(_this3.assetFilters.buildingId)),siteCondition&&buildingCondition&&teamCondition})).map((function(user){return{id:user.id,title:user.name,userStatus:user.userStatus}}))));
//need to show all staff ,
//sort workorders in time asc order
return staffList.sort((function(e1,e2){return e1.id-e2.id})),staffList},fetchData:function(e){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var staffJobsResp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,PlannerAPICalls/* default */.Z.getStaffJobs(e,_this4.assetFilters.siteId,_this4.assetFilters.buildingId,_this4.assetFilters.teamId,_this4.appliedWoFilters);case 2:return staffJobsResp=_context.sent,_this4.jobsData=staffJobsResp.data.result.workorders.filter((function(wo){return wo.trigger&&wo.trigger.frequency>0})).map((function(wo){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({start:wo.scheduledStart,frequency:wo.trigger.frequencyEnum.substring(0,1),frequencyID:wo.trigger.frequency},wo),{},{resourceId:_this4.$getProperty(wo,"assignedTo.id",-99)})})).sort((function(e1,e2){return e1.start-e2.start})),//sort workorders in time asc order
// getStaffList is called only after workorders are fetched
_this4.staffList=_this4.getStaffList(_this4.assetFilters.teamId),
//remove disabled users if they don't have any associated WOs in the given time period
_this4.staffList=_this4.staffList.filter((function(user){return!!user.userStatus||_this4.jobsData.find((function(wo){return wo.resourceId==user.id}))})),_context.abrupt("return");case 7:case"end":return _context.stop()}}),_callee)})))()},renderJobs:function(){
//let beforeRenderJobs=performance.now()
this.$refs["resourcePlanner"].renderPlanner(this.jobsData,this.staffList,"resourceId");
//console.warn('time for renderJobs',performance.now()-beforeRenderJobs)
},setQueryParams:function(){this.$router.replace({query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.$route.query),{},{assetFilters:JSON.stringify(this.assetFilters)})})},handleFilterChange:function(changedFilter){this.assetFilters=changedFilter,this.setQueryParams(),this.showFilter=!1,this.$refs["resourcePlanner"].refreshGrid()},handleDrop:function(e){var _this5=this,event=e.event,url="/v2/pmplanner/jobs/update",workorder={id:event.id,assignedTo:{id:event.resourceId},scheduledStart:event.start};this.requestPending=!0,this.$http.post(url,{workorder:workorder}).then((function(resp){_this5.requestPending=!1,event.assignedTo=resp.data.result.workorder.assignedTo,event.assignmentGroup=resp.data.result.workorder.assignmentGroup}))},fetchSitesList:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var sitesList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,(0,wo_util/* getSites */.E)();case 2:sitesList=_context2.sent,_this6.$set(_this6,"sites",sitesList);case 4:case"end":return _context2.stop()}}),_callee2)})))()}}},workorder_PMStaffPlannervue_type_script_lang_js=PMStaffPlannervue_type_script_lang_js,PMStaffPlanner_component=(0,componentNormalizer/* default */.Z)(workorder_PMStaffPlannervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMStaffPlanner=PMStaffPlanner_component.exports},
/***/801825:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PMWoCard}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PMWoCard.vue?vue&type=template&id=e0a5ff46
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pm-wo-card"},[_c("div",{staticClass:"pm-wo-card-header"},[_c("div",{},[_c("span",{staticClass:"fc-black-12 pR10 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatDateFull(_vm.plannerEvent.event.start)))]),_c("span",{staticClass:"separator white-color"},[_vm._v("|")]),_c("span",{staticClass:"fc-black-11 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatTimeFull(_vm.plannerEvent.event.start)))])]),_c("div",{staticClass:"pm-wo-card-header-close",on:{click:function($event){return _vm.$emit("close")}}},[_c("i",{staticClass:"el-icon-close fc-black3-16 fwBold white-color"})]),_c("div",{staticClass:"fc-black3-16 pT10 white-color"},[_vm._v(" "+_vm._s(_vm.plannerEvent.event.subject)+" ")])]),_c("div",{staticClass:"pm-wo-card-body"},[_c("el-row",{staticClass:"pB30"},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left pT15"},[_vm._v("Assigned To")])]),_c("el-col",{attrs:{span:14}},[_vm.allowStaffReAssign?_c("div",{staticClass:"fc-black-13 text-left"},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:_vm.plannerEvent.col.past},on:{change:_vm.reAssignStaff},model:{value:_vm.woAssignedTo,callback:function($$v){_vm.woAssignedTo=$$v},expression:"woAssignedTo"}},_vm._l(_vm.staffList,(function(staff){return _c("el-option",{key:staff.id,attrs:{label:staff.name,value:staff.id}})})),1)],1):_c("div",{staticClass:"fc-black-13 text-left pT15"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.plannerEvent.event,"assignedTo.name","Unassigned"))+" "+_vm._s(_vm.$getProperty(_vm.plannerEvent.event,"assignedTo.name",null)?"/"+_vm.$getProperty(_vm.plannerEvent.event,"assignmentGroup.name","--"):null)+" ")])])],1),_c("el-row",{},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left"},[_vm._v(" "+_vm._s(_vm.getResourceTitle())+" ")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v(" "+_vm._s(_vm.plannerEvent.event.asset||_vm.plannerEvent.event.space||_vm.plannerEvent.event.resource.name)+" ")])])],1)],1),_c("div",{staticClass:"pm-wo-card-footer display-flex-between-space flex-middle p30 pT10 pB20"},[_c("div",{staticClass:"text-left"},[_c("router-link",{staticClass:"fc-dark-blue3-12 pointer",attrs:{to:_vm.openWoSummary(_vm.plannerEvent.event.id)}},[_vm._v("View Details")])],1),_c("div",{staticClass:"text-right"},[_vm.plannerEvent.col.past?_vm._e():_c("el-button",{staticClass:"fc-btn-icon-delete pointer",on:{click:function($event){return _vm.handleDelete(_vm.plannerEvent.event.id)}}},[_c("i",{staticClass:"el-icon-delete pR10"}),_vm._v(" Delete ")])],1)])])},staticRenderFns=[],objectSpread2=__webpack_require__(595082),PlannerAPICalls=(__webpack_require__(434284),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(425728),__webpack_require__(891719),__webpack_require__(910036)),vuex_esm=__webpack_require__(420629),router=__webpack_require__(329435),PMWoCardvue_type_script_lang_js={props:["plannerEvent","allowStaffReAssign"],data:function(){return{woAssignedTo:null}},created:function(){this.$store.dispatch("loadUsers"),this.plannerEvent.event.assignedTo&&this.plannerEvent.event.assignedTo.id?this.woAssignedTo=this.plannerEvent.event.assignedTo.id:this.woAssignedTo=null},methods:{openWoSummary:function(id){if(!(0,router/* isWebTabsEnabled */.tj)())return{name:"wosummarynew",params:{id:id}};var _ref=(0,router/* findRouteForModule */.Jp)("workorder",router/* pageTypes */.As.OVERVIEW)||{},name=_ref.name;return name?this.$router.resolve({name:name,params:{viewname:"all",id:id}}).href:void 0},getResourceTitle:function(){return this.plannerEvent.event.asset?"Asset":this.plannerEvent.event.space?"Space":
//associated resource field,check if asset or space
2===this.plannerEvent.event.resource.resourceType?"Asset":1===this.plannerEvent.event.resource.resourceType?"Space":void 0},handleDelete:function(workorderID){var _this=this;this.$dialog.confirm({title:this.$t("maintenance._workorder.delete_wo"),message:this.$t("maintenance._workorder.delete_wo_body"),rbDanger:!0,rbLabel:this.$t("common._common.delete")}).then((function(confirmDelete){confirmDelete&&(_this.$emit("deleteWo",workorderID),PlannerAPICalls/* default */.Z.deleteWorkOrder(workorderID).then((function(e){})))}))},reAssignStaff:function(){
//mutate original event and make api call
this.plannerEvent.event.assignedTo={id:this.woAssignedTo},PlannerAPICalls/* default */.Z.assignStaff(this.plannerEvent.event.id,this.woAssignedTo)}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),{},{
//filter users based on assigment group on workorder, if no group show all users in dropdown
staffList:function(){var _this2=this,assignmentGroup=this.plannerEvent.event.assignmentGroup?this.plannerEvent.event.assignmentGroup.id:null,activeUsers=this.users.filter((function(user){return user.userStatus}));//show only active users to reassign to
return assignmentGroup&&(activeUsers=activeUsers.filter((function(user){return!!user.groups&&-1!=user.groups.indexOf(assignmentGroup)}))),
//if current  assignee not in  staff list  , (may have been disabled after assignment ), fetch from overall list and push in front
this.woAssignedTo&&null==activeUsers.find((function(user){return user.id==_this2.woAssignedTo}))&&activeUsers.unshift(this.$store.getters.getUser(this.woAssignedTo)),activeUsers}})},workorder_PMWoCardvue_type_script_lang_js=PMWoCardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PMWoCardvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PMWoCard=component.exports},
/***/481632:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PlannerLegend}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/PlannerLegend.vue?vue&type=template&id=0ab0791d
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-popover",{attrs:{placement:"bottom-end","popper-class":"planner-legend-popover","visible-arrow":!1}},[_c("div",{staticClass:"planner-legend-container fc-black-color p30 pB15 pT15"},[_c("div",{staticClass:"legend-title fc-black-color f14 bold text-left mB20 text-uppercase"},[_vm._v(" "+_vm._s(_vm.legendName)+" ")]),_c("div",{staticClass:"d-flex legend-2col-cont"},[_c("div",{staticClass:"legend-cont-col1 mR40"},_vm._l(_vm.legendMap,(function(legend,key,index){return(index+1)%2?_c("div",{key:key,staticClass:"planner-legend-item mB15"},[_c("div",{class:[["wo-legend-"+legend.colorIndex],"planner-legend-dot"]}),_c("div",{staticClass:"planner-legend-text"},[_vm._v(_vm._s(legend.name))])]):_vm._e()})),0),_c("div",{staticClass:"`legend`-cont-col2"},_vm._l(_vm.legendMap,(function(legend,key,index){return(index+1)%2?_vm._e():_c("div",{key:key,staticClass:"planner-legend-item mB15"},[_c("div",{class:[["wo-legend-"+legend.colorIndex],"planner-legend-dot"]}),_c("div",{staticClass:"planner-legend-text"},[_vm._v(_vm._s(legend.name))])])})),0)])]),_c("el-button",{staticClass:"mR20 vertical-middle text-left height35 fc-btn-grey-border40",attrs:{slot:"reference"},slot:"reference"},[_c("div",{staticClass:"planner-legend-icon-cont"},[_c("div",{staticClass:"planner-legend-icon-dot ",staticStyle:{background:"#5a6aea"}}),_c("div",{staticClass:"planner-legend-icon-dot ",staticStyle:{background:"#a85aea"}}),_c("div",{staticClass:"planner-legend-icon-dot ",staticStyle:{background:"#ea5ad2"}})])])],1)},staticRenderFns=[],PlannerLegendvue_type_script_lang_js={props:["legendMap","legendName"]},workorder_PlannerLegendvue_type_script_lang_js=PlannerLegendvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workorder_PlannerLegendvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PlannerLegend=component.exports},
/***/132120:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PmSummaryPlannerView}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/preventive/v1/PmSummaryPlannerView.vue?vue&type=template&id=477e7ebc
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pm-resource-planner pm-summary-planner"},[_c("facilio-resource-planner",{ref:"resourcePlanner",attrs:{plannerType:"ASSET_PLANNER",views:_vm.isStaffPlanner?_vm.staffViews:_vm.assetViews,defaultView:_vm.isStaffPlanner?"WEEK":"YEAR",isPMAssetPlanner:"asset"==this.resourceKey||"space"==this.resourceKey,isRowDragRestrict:"asset"==this.resourceKey||"space"==this.resourceKey,saving:_vm.requestPending,allowDownload:!0,noDataText:"No workorders"},on:{ready:function($event){_vm.loaded=!0},viewChanged:_vm.handleViewChange,dropped:_vm.handleDrop},scopedSlots:_vm._u([_vm.loaded?{key:"card",fn:function(slotProps){return[_c("div",{staticClass:"pm-wo-card"},[_c("div",{staticClass:"pm-wo-card-header"},[_c("div",{},[_c("span",{staticClass:"fc-black-12 pR10 white-color"},[_vm._v(" "+_vm._s(_vm.$helpers.formatDateFull(slotProps.event.start))+" ")]),_c("span",{staticClass:"separator white-color"},[_vm._v("|")]),_c("span",{staticClass:"fc-black-11 white-color"},[_vm._v(_vm._s(_vm.$helpers.formatTimeFull(slotProps.event.start)))])]),_c("div",{staticClass:"pm-wo-card-header-close",on:{click:_vm.$refs["resourcePlanner"].handleCardClose}},[_c("i",{staticClass:"el-icon-close fc-black3-16 fwBold white-color"})]),_c("div",{staticClass:"fc-black3-16 pT10 white-color"},[_vm._v(" "+_vm._s(slotProps.event.subject)+" ")])]),_c("div",{staticClass:"pm-wo-card-body"},[_c("el-row",{staticClass:"pB30"},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left pT15"},[_vm._v("Assigned To")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left"},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:slotProps.col.past},on:{change:function($event){return _vm.handleStaffChange(slotProps.event,$event)}},model:{value:slotProps.event.staff,callback:function($$v){_vm.$set(slotProps.event,"staff",$$v)},expression:"slotProps.event.staff"}},_vm._l(_vm.resources.staff,(function(staff){return _c("el-option",{key:staff.id,attrs:{label:staff.title,value:staff.id}})})),1)],1)])],1),_c("el-row",{},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"fc-black-13 fwBold text-left"},[_vm._v("Asset/Space")])]),_c("el-col",{attrs:{span:14}},[_c("div",{staticClass:"fc-black-13 text-left"},[_vm._v(" "+_vm._s(_vm.getResourceDetails(slotProps.event.id))+" ")])])],1)],1),_c("div",{staticClass:"pm-wo-card-footer display-flex-between-space flex-middle p30 pT10 pB20"},[_c("div",{staticClass:"text-left"},[_c("router-link",{staticClass:"fc-dark-blue3-12 pointer",attrs:{to:_vm.redirectToWO(slotProps.event.id)}},[_vm._v(" View Details ")])],1),_c("div",{staticClass:"text-right"},[slotProps.col.past?_vm._e():_c("el-button",{staticClass:"fc-btn-icon-delete pointer",on:{click:function($event){return _vm.handleDelete(slotProps.event.id)}}},[_c("i",{staticClass:"el-icon-delete pR10"}),_vm._v(" Delete")])],1)])])]}}:null,{key:"taskContent",fn:function(eventProps){return[_c("div",{staticClass:"rp-task-text ellipsis"},[_vm._v(" "+_vm._s(eventProps.event[eventProps.displayType])+" ")])]}}],null,!0)},[_c("template",{slot:"resourceSelection"},[_c("div",{staticClass:"width200 fc-input-full-border2 mR10 fc-input-border-remove fc-input-full-border2-bold mL8"},[_vm._v(" "+_vm._s(_vm.resourceMeta[_vm.resourceKey].name)+" ")])]),_c("template",{slot:"plannerLeftTop"},[_c("el-select",{staticClass:"width200 fc-input-full-border2 mR10",attrs:{trigger:"click"},on:{change:_vm.triggerChanged},model:{value:_vm.selectedTrigger,callback:function($$v){_vm.selectedTrigger=$$v},expression:"selectedTrigger"}},_vm._l(_vm.triggerOptions,(function(trigger,index){return _c("el-option",{key:index,attrs:{label:trigger.name,value:trigger.id}})})),1)],1)],2)],1)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),objectSpread2=__webpack_require__(595082),PlannerAPICalls=(__webpack_require__(434284),__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(450886),__webpack_require__(891719),__webpack_require__(425728),__webpack_require__(634338),__webpack_require__(212826),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(865137),__webpack_require__(186466),__webpack_require__(910036)),FacilioResourcePlanner=__webpack_require__(511982),vuex_esm=__webpack_require__(420629),router=__webpack_require__(329435),PmSummaryPlannerViewvue_type_script_lang_js={components:{"facilio-resource-planner":FacilioResourcePlanner/* default */.Z},props:{pm:{type:Object},isStaffPlanner:{type:Boolean}},data:function(){return{loaded:!1,assetViews:["WEEK","MONTH","YEAR"],staffViews:["DAY","WEEK","MONTH"],isJobApi:!0,workorders:[],resourceKey:"staff",resourceType:null,selectedTrigger:null,triggerOptions:[],resources:{
// asset: [],
// space: [],
staff:this.getStaffList()},resourceMeta:{staff:{name:"Staff"}},requestPending:!1}},mounted:function(){this.getTriggerOptions()},created:function(){this.$store.dispatch("loadUsers")},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),methods:{redirectToWO:function(id){if(!(0,router/* isWebTabsEnabled */.tj)())return{path:"/app/wo/orders/summary/".concat(id)};var _ref=(0,router/* findRouteForModule */.Jp)("workorder",router/* pageTypes */.As.OVERVIEW)||{},name=_ref.name;return name?{name:name,params:{viewname:"all",id:id}}:void 0},setQueryParams:function(){this.$router.replace({query:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.$route.query),{},{triggerId:this.selectedTrigger,pmId:this.pm.id,pmSubject:encodeURIComponent(this.pm.name),triggerName:encodeURIComponent(this.getTriggerName(this.selectedTrigger)),assetFilters:JSON.stringify({siteId:this.pm.siteId,assetCategoryId:this.pm.assetCategoryId,buildingId:null})})})},handleDelete:function(workorderID){var _this=this;PlannerAPICalls/* default */.Z.deleteWorkOrder(workorderID).then((function(){_this.$refs["resourcePlanner"].deleteEvent(workorderID)}))},refresh:function(){this.$refs["resourcePlanner"].refreshGrid()},getFilteredEventList:function(){var _this2=this;return"ALL"==this.selectedTrigger?this.workorders:this.workorders.filter((function(e){return e.triggerID==_this2.selectedTrigger}))},getTriggerOptions:function(){
//clone trigger options from PM object and use for select box
this.triggerOptions=this.$helpers.cloneObject(this.pm.triggers).filter((function(e){return 1==e.triggerExecutionSource})).map((function(e){return{id:e.id,name:e.name,frequency:e.frequencyEnum}})),this.triggerOptions.length>1&&this.triggerOptions.unshift({id:-1,name:"All Triggers",frequency:null}),this.$route.query.triggerId?
//if trigger id present in query param persist
this.selectedTrigger=this.$route.query.triggerId:(
//set default trigger , select 1st trigger id , if more than 1 trigger select all as default
this.selectedTrigger=this.triggerOptions[0].id,this.triggerOptions.length>1&&(this.selectedTrigger=-1),this.setQueryParams())},getTriggerName:function(triggerId){return-1==triggerId?"All Triggers":this.triggerOptions.find((function(t){return t.id==triggerId})).name},triggerChanged:function(){this.setQueryParams(),this.$refs["resourcePlanner"].refreshGrid()},handleDrop:function(e){var _this3=this;this.requestPending=!0;var url="/v2/pmplanner/jobs/update",newAssignTo=e.destinationCell.rowId,reqJson={workorder:{id:e.event.id,scheduledStart:e.event.start}};
//for staff view alone we can drag drop across rows
// Same comp used for staff and asset planner ,if staff plan ,reassign the assignedTo Id to row Id(staffId=>rowID here)
"staff"==this.resourceKey&&(reqJson.workorder.assignedTo={id:newAssignTo}),this.$http.post(url,reqJson).then((function(){_this3.requestPending=!1}))},handleStaffChange:function(event,newAssignToID){var _this4=this;
//staff reassigned from outside planner component .
//need to make api call here and sync the planner view when in staff mode
this.requestPending=!0;var url="/v2/pmplanner/jobs/update",reqJson={workorder:{id:event.id,scheduledStart:event.start,assignedTo:{id:newAssignToID}}};this.$http.post(url,reqJson).then((function(){"staff"==_this4.resourceKey&&_this4.$refs["resourcePlanner"].reAssignResource(event.id,newAssignToID),_this4.requestPending=!1}))},resourceChanged:function(){var _this5=this;
//call handler aysnchronously , as select box close hangs due to long task
setTimeout((function(){_this5.$refs["resourcePlanner"].changeResource(_this5.resources[_this5.resourceKey],_this5.resourceKey,"asset"==_this5.resourceKey||"space"==_this5.resourceKey)}),0)},handleViewChange:function(e){this.currentRange=e,this.$emit("viewChanged",e),this.fetchData(e)},getStaffList:function(){
//need to show all staff ,
/*computed property isnt available when this runs,so accessing this.users fails
        TO DO , fix the data model to not have stafflist like this
       */
var staffList=[{id:-99,title:"Unassigned"}].concat((0,toConsumableArray/* default */.Z)(this.$store.state.users.map((function(user){return{id:user.id,title:user.name}}))));return this.sortResources(staffList,"id"),staffList},fetchData:function(range){var _this6=this,url="/v2/workorders/newcalendar/list/all",params={
// page: 1,
perPage:-1,filters:{pm:{operatorId:36,value:[this.pm.id+""]},scheduledStart:{operatorId:20,value:[range.start.toString(),range.end.toString()]}},orderBy:"scheduledStart",orderType:"desc",includeParentFilter:!0};
//fetch all workorders for a PM for given duration
url+="?perPage="+params.perPage+"&filters="+encodeURI(JSON.stringify(params.filters))+"&orderBy="+params.orderBy+"&orderType="+params.orderType+"&includeParentFilter="+params.includeParentFilter,this.$http.get(url).then((function(resp){_this6.setData(resp)}))},setData:function(response){var _this7=this,workorders=[],assets={},spaces={};
//asset and spaces for the set of workorders
response.data.result.workorders.forEach((function(e){
// console.log(e.trigger.id)
//skip workorders without a trigger (created via execute now)
if(e.trigger&&(
//TO DO , move filter to server
-1==_this7.selectedTrigger||e.trigger.id==_this7.selectedTrigger)){var wo={start:e.scheduledStart,subject:e.subject,staff:e.assignedTo?e.assignedTo.id:-99,
//assigned staff id
id:e.id,triggerID:e.trigger.id,frequency:_this7.getFrequency(e.trigger.id)},mappedResource=e.resource;
//mapped resource can be a site or space
1==mappedResource.resourceType?(
//space
spaces[mappedResource.id]={id:mappedResource.id,title:mappedResource.name},wo.space=mappedResource.id):2==mappedResource.resourceType&&(
//asset
wo.asset=mappedResource.id,assets[mappedResource.id]={id:mappedResource.id,title:mappedResource.name}),workorders.push(wo)}})),
//redundant client sorting
workorders.sort((function(e1,e2){return e1.start-e2.start})),this.workorders=workorders,
// this.eventList=this.getFilteredEventList()
//Pm is mapped either to asset or space,only push valid option inside select box
this.$helpers.isEmpty(assets)||(this.$set(this.resources,"asset",Object.values(assets)),this.sortResources(this.resources["asset"],"id"),this.$set(this.resourceMeta,"asset",{name:"Assets"}),this.resourceType="asset",this.isStaffPlanner||(this.resourceKey="asset")),this.$helpers.isEmpty(spaces)||(this.$set(this.resources,"space",Object.values(spaces)),this.sortResources(this.resources["space"],"id"),this.$set(this.resourceMeta,"space",{name:"Spaces"}),this.resourceType="space",this.isStaffPlanner||(this.resourceKey="space")),this.refreshPlanner()},sortResources:function(resourceList,key){resourceList.sort((function(e1,e2){return e1[key]-e2[key]}))},refreshPlanner:function(){
//prevent unneeded reactivity overhead by cloning object
this.$refs["resourcePlanner"].renderPlanner(this.workorders,0==this.workorders.length?[]:this.resources[this.resourceKey],
//planner uses no data state only when resources and tasks are empty
this.resourceKey)},getFrequency:function(triggerID){var trigger=this.pm.triggers.find((function(e){return e.id==triggerID}));return trigger.frequencyEnum.substring(0,1)},
//find workorder from wo list , get staff/asset id from wo and get full details from resourceList
findWorkOrder:function(id){return this.workorders.find((function(e){return e.id==id}))},getStaffTitle:function(staffID){var staff=this.resources.staff.find((function(e){return e.id==staffID}));return staff.title},getResourceDetails:function(workorderID){var _this8=this;if(null!=workorderID){var workorder=this.findWorkOrder(workorderID),resource=this.resources[this.resourceType].find((function(e){return e.id==workorder[_this8.resourceType]}));return resource.title}}}},v1_PmSummaryPlannerViewvue_type_script_lang_js=PmSummaryPlannerViewvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(v1_PmSummaryPlannerViewvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PmSummaryPlannerView=component.exports},
/***/117524:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"10a53ccbae023b46b9211d3725c2236a.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/31288.js.map