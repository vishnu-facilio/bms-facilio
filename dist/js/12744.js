"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[12744],{
/***/712744:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FReport}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/components/FReport.vue?vue&type=template&id=3c323314
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.loading?_c("spinner",{staticClass:"mT15",staticStyle:{margin:"0 auto"},attrs:{show:_vm.loading,size:"80"}}):_vm.showChartOnly?_c("f-chart",{ref:"fchart",attrs:{width:_vm.configData.width,height:_vm.configData.height,type:_vm.report.options.type,data:_vm.report.data,options:_vm.report.options,alarms:_vm.report.alarms,config:_vm.config}}):_c("div",{staticClass:"fc-report",class:{"report-setting-class":_vm.report&&!_vm.report.options.is_highres_data&&_vm.report.data.length>=2}},[_c("div",{staticClass:"fc-report-section",class:{"second-class":!_vm.showDatepicker}},[_c("div",{staticClass:"fc-report-filter row header"},[_vm.previewReportContext?_vm._e():_c("div",{staticClass:"chart-select",class:{noreportdata:!_vm.report.data.length}},[_vm.report.datefilter&&_vm.showDatepicker?_c("date",{staticClass:"filter-field date-filter-comp",attrs:{mills:_vm.getMills(_vm.report.datefilter.operatorId,_vm.report.datefilter).time,filter:_vm.getMills(_vm.report.datefilter.operatorId,_vm.report.datefilter).filter,dateObj:_vm.report.datefilter,reportId:_vm.config.id},on:{data:_vm.setDateFilter}}):_vm._e(),_vm.currentChartType?_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"filter-field change-chart-select",attrs:{title:_vm.$t("home.dashboard.change_chart"),"data-placement":"top","data-arrow":"true"}},[_c("span",{staticClass:"q-item-label"},[_c("span",{staticClass:"chart-icon",staticStyle:{position:"relative"}},[_c("chart-icon",{attrs:{icon:_vm.currentChartType.ct}})],1),_c("q-popover",{ref:"charttypepopover"},[_c("q-list",{staticClass:"scroll",staticStyle:{"min-width":"150px"},attrs:{link:""}},_vm._l(_vm.chartType.availableChartTypes,(function(ctype,index){return ctype.disabled?_vm._e():_c("q-item",{key:index,on:{click:function($event){_vm.changeChartType(ctype),_vm.$refs.charttypepopover.close()}}},[_c("span",{staticClass:"chart-icon",staticStyle:{"margin-right":"5px"}},[_c("chart-icon",{attrs:{icon:ctype.ct}})],1),_c("span",{staticClass:"chart-label"},[_vm._v(_vm._s(ctype.label))])])})),1)],1)],1)]):_vm._e(),!_vm.isReadOnly&&(_vm.config&&_vm.config.isAutoRefreshEnabled||_vm.report&&_vm.report.data.length>=2&&!_vm.report.options.is_highres_data)?_c("div",{staticClass:"report-table-setting-icon"},[_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"fc-theme-color",staticStyle:{display:"inline-block",cursor:"pointer",top:"-3px"},attrs:{title:"Settings","data-arrow":"true"}},[_c("el-popover",{ref:"popover2",attrs:{"popper-class":"report-settings-popover",placement:"bottom",title:"Settings",width:"400",trigger:"click"},model:{value:_vm.reportSettingsPopover,callback:function($$v){_vm.reportSettingsPopover=$$v},expression:"reportSettingsPopover"}},[_c("f-report-settings",{attrs:{report:_vm.report,config:_vm.config},on:{close:function($event){return _vm.closeSettingsPopover()},save:function($event){return _vm.saveSettingsPopover()}}})],1),_c("i",{directives:[{name:"popover",rawName:"v-popover:popover2",arg:"popover2"}],staticClass:"fa fa-cog"})],1)]):_vm._e()],1),_vm.previewReportContext?_c("div",[_vm.currentChartType?_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"filter-field change-chart-select chat-icon-align",attrs:{title:_vm.$t("home.dashboard.change_chart"),"data-placement":"top","data-arrow":"true"}},[_c("span",{staticClass:"q-item-label"},[_c("span",{staticClass:"chart-icon"},[_c("chart-icon",{attrs:{icon:_vm.currentChartType.ct}})],1),_c("q-popover",{ref:"charttypepopover"},[_c("q-list",{staticClass:"scroll",staticStyle:{"min-width":"150px"},attrs:{link:""}},_vm._l(_vm.chartType.availableChartTypes,(function(ctype,index){return ctype.disabled?_vm._e():_c("q-item",{key:index,on:{click:function($event){_vm.changeChartType(ctype),_vm.$refs.charttypepopover.close()}}},[_c("span",{staticClass:"chart-icon",staticStyle:{"margin-right":"5px"}},[_c("chart-icon",{attrs:{icon:ctype.ct}})],1),_c("span",{staticClass:"chart-label"},[_vm._v(_vm._s(ctype.label))])])})),1)],1)],1)]):_vm._e()]):_vm._e(),_c("div",{staticStyle:{clear:"both"}})]),_c("div",{staticClass:"fc-underline"}),_vm.filterApplying?_c("div",{staticClass:"fchart-overlay"}):_vm._e(),_c("div",{staticClass:"self-center fchart-section"},[!_vm.loading&&_vm.failed?_c("div",[_vm._v(" "+_vm._s(_vm.$t("common._common.load_data_failed"))+" ")]):_vm.report.data.length?"timeseries"===_vm.report.options.type||"tabular"===_vm.report.options.type?_c("f-timeseries",{ref:"fTimeseriesChart",attrs:{width:_vm.configData.width,height:_vm.configData.height,data:_vm.report.data,alarms:_vm.report.alarms}}):"matrix"===_vm.report.options.type?_c("f-tabular-data",{ref:"tabulardata",attrs:{data:_vm.report.data,options:_vm.report.options}}):_c("f-chart",{ref:"fchart",attrs:{width:_vm.configData.width,height:_vm.configData.height,type:_vm.report.options.type,data:_vm.report.data,data2:_vm.report.data1,options:_vm.report.options,alarms:_vm.report.alarms,config:_vm.config},on:{drilldown:_vm.handleDrillDown}}):_c("div",{staticStyle:{"margin-top":"50px","font-size":"13px",padding:"50px","line-height":"25px"}},[_c("inline-svg",{attrs:{src:"svgs/emptystate/reportlist",iconClass:"icon text-center icon-xxxlg"}}),_c("div",{staticClass:"text-center nowo-label f13 line-height20"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.empty_data"))+" "),_vm.time&&_vm.time.length?_c("span",{staticClass:"bold"},[_vm._v(_vm._s(_vm._f("formatDate")(_vm.time[0],"MMM DD, YYYY"))+" - "+_vm._s(_vm._f("formatDate")(_vm.time[1],"MMM DD, YYYY")))]):_vm._e()])],1)],1)])])},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),esm_typeof=__webpack_require__(103336),FChart=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(169358),__webpack_require__(670560),__webpack_require__(564043),__webpack_require__(648324),__webpack_require__(506203),__webpack_require__(708237)),tooltip=__webpack_require__(460895),FTimeseries=__webpack_require__(130325),chartIcon=__webpack_require__(588),moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),formatter=__webpack_require__(676240),FTabularData=__webpack_require__(478542),DatePicker=__webpack_require__(106537),colors=__webpack_require__(519898),ReportUtil=__webpack_require__(86254),ChartType=__webpack_require__(28341),FReportSettings=__webpack_require__(674322),JumpToHelper=__webpack_require__(921466),quasar_esm=__webpack_require__(641358),FReportvue_type_script_lang_js={props:["config","currentDateFilter","print","showChartOnly","currentEMFilter","previewReportContext","getReportUtil"],mixins:[ReportUtil/* default */.Z,ChartType/* default */.Z,JumpToHelper/* default */.Z],components:{FChart:FChart/* default */.Z,QPopover:quasar_esm/* QPopover */.oe,QList:quasar_esm/* QList */.tu,QItem:quasar_esm/* QItem */.ry,ChartIcon:chartIcon/* default */.Z,FTimeseries:FTimeseries/* default */.Z,FTabularData:FTabularData/* default */.Z,date:DatePicker/* default */.Z,FReportSettings:FReportSettings/* default */.Z},filters:{subMeterName:function(meterId,subMeters){if(subMeters){var meter=subMeters.find((function(sb){return sb.id===meterId}));if(meter)return meter.name}return""}},data:function(){return{filterApplying:!1,loading:!0,mounted:!0,failed:!1,time:null,filterName:"D",reportContext:null,reportFieldLabelMap:null,report:null,chartType:null,reportContextModel:null,availableBaseLines:[],comparisions:[],energyMeterFilter:{buildingId:"",serviceId:"",subMeterId:",",readingField:""},subMeters:[],meterList:null,dateOperators2:[{index:0,label:"Today",trimLabel:"D",value:22,uptoNowValue:43,timestamp:[moment_timezone_default()().startOf("day").valueOf(),moment_timezone_default()().endOf("day").valueOf()]},{index:1,label:"This Week",trimLabel:"W",value:31,uptoNowValue:47,timestamp:[moment_timezone_default()().startOf("week").valueOf(),moment_timezone_default()().endOf("week").valueOf()]},{index:2,label:"This Month",trimLabel:"M",value:28,uptoNowValue:48,timestamp:[moment_timezone_default()().startOf("month").valueOf(),moment_timezone_default()().endOf("month").valueOf()]},{index:3,label:"This Year",trimLabel:"Y",value:44,uptoNowValue:46,timestamp:[moment_timezone_default()().startOf("year").valueOf(),moment_timezone_default()().endOf("year").valueOf()]},{index:4,label:"Last N displayUnkownValueAs",trimLabel:"C",value:49,uptoNowValue:49,timestamp:[moment_timezone_default()().startOf("day").valueOf(),moment_timezone_default()().endOf("day").valueOf()]},{index:5,label:"Last N displayUnkownValueAs",trimLabel:"C",value:42,uptoNowValue:42,timestamp:[moment_timezone_default()().startOf("day").valueOf(),moment_timezone_default()().endOf("day").valueOf()]},{index:6,label:"Last N displayUnkownValueAs",trimLabel:"C",value:50,uptoNowValue:50,timestamp:[moment_timezone_default()().startOf("day").valueOf(),moment_timezone_default()().endOf("day").valueOf()]},{index:7,label:"Last N displayUnkownValueAs",trimLabel:"C",value:51,uptoNowValue:51,timestamp:[moment_timezone_default()().startOf("day").valueOf(),moment_timezone_default()().endOf("day").valueOf()]},{index:8,label:"Range",trimLabel:"R",value:100,uptoNowValue:100,timestamp:[moment_timezone_default()().startOf("year").valueOf(),moment_timezone_default()().endOf("year").valueOf()]},{index:9,label:"Yesterday",option:"D",value:25,days:"30",uptoNowValue:25,timestamp:[moment_timezone_default()().subtract(1,"day").startOf("day").valueOf(),moment_timezone_default()().subtract(1,"day").endOf("day").valueOf()]},{index:10,label:"Last month",trimLabel:"M",value:27,uptoNowValue:48,timestamp:[moment_timezone_default()().subtract(1,"month").startOf("month").valueOf(),moment_timezone_default()().subtract(1,"month").endOf("month").valueOf()]},{index:11,label:"Last Week",trimLabel:"W",value:30,uptoNowValue:47,timestamp:[moment_timezone_default()().subtract(1,"week").startOf("eek").valueOf(),moment_timezone_default()().subtract(1,"week").endOf("week").valueOf()]},{index:12,label:"yesterday",option:"D",value:25,uptoNowValue:43,timestamp:[moment_timezone_default()().subtract(1,"day").startOf("day").valueOf(),moment_timezone_default()().subtract(1,"day").endOf("day").valueOf()]}],value:"",previewOnly:!1,reportSettingsPopover:!1}},created:function(){this.$store.dispatch("loadEnergyMeters")},mounted:function(){this.mounted=!0,this.previewReportContext&&(this.previewOnly=!0),this.initData()},computed:{isReadOnly:function(){return!!(this.config&&this.config.currentDashboard&&this.config.currentDashboard.readOnly)},showDatepicker:function(){return!(this.config&&this.config.layoutConfig&&this.config.layoutConfig.hideleagend)},appliedDateFilter:function(){return this.$route.query.daterange?JSON.parse(this.$route.query.daterange):null},currentChartType:function(){return this.isReadOnly?null:this.chartType?this.chartType.chartType:null},configData:function(){return this.config},styleAObj:function(){return"padding-left:"+this.config.width/20+"px;padding-right:"+this.config.width/20+"px;"},reportFilters:function(){return this.$route.query.filters?this.$route.query.filters:null},buildingId:function(){return this.config&&this.config.currentDashboard?this.config.currentDashboard.buildingId:!this.$route.params||"chilleroverview"===this.$route.params.dashboardlink&&"chillerplant"===this.$route.params.dashboardlink?null:this.$route.params.buildingid},siteId:function(){return this.config&&this.config.currentDashboard?this.config.currentDashboard.siteId:this.$route.params&&"sitedashboard"===this.$route.params.dashboardlink?this.$route.params.buildingid:null},chillerId:function(){return this.config&&this.config.currentDashboard?this.config.currentDashboard.chillerId:!this.$route.params||"chillers"!==this.$route.params.dashboardlink&&"chillerplant"!==this.$route.params.dashboardlink?null:this.$route.params.buildingid}},watch:{config:{handler:function(newData,oldData){newData&&oldData?newData.id!==oldData.id&&this.initData():this.initData()},deep:!0},time:{handler:function(newData,oldData){this.$emit("update:currentDateFilter",newData)},immediate:!0},energyMeterFilter:{handler:function(newData,oldData){this.$emit("update:currentEMFilter",newData)},immediate:!0},print:{handler:function(newData,oldData){this.printing()}},reportFilters:{handler:function(newData,oldData){this.reportFilters&&this.initData()},immediate:!0}},methods:{getMills:function(id,datefilter){var self=this,options={},time=[];id=43===id||22===id?22:47===id||31===id?31:48===id||28===id?28:46===id||44===id?44:42===id?42:49===id?49:50===id?50:51===id?51:25===id?25:27===id?27:25===id?25:30===id?30:null===datefilter.operatorId&&datefilter.endTime&&datefilter.startTime?100:22;var mills1=(0,esm_typeof/* default */.Z)(this.operaterIdTOmills(id));if(void 0!==mills1){var data=self.operaterIdTOmills(id);time=42===id||49===id||50===id||51===id?this.time:data.timestamp,options.filter=data.trimLabel}else time=[moment_timezone_default()().startOf("day").valueOf(),moment_timezone_default()().endOf("day").valueOf()];return 100===id&&datefilter.startTime&&datefilter.endTime&&(time=[moment_timezone_default()(datefilter.startTime).tz(this.$timezone).valueOf(),moment_timezone_default()(datefilter.endTime).tz(this.$timezone).valueOf()]),options.time=time,options},operaterIdTOmills:function(id){return this.dateOperators2.find((function(sb){return sb.value===id}))},operaterIdUpTOmills:function(id){return this.dateOperators2.find((function(sb){return sb.uptoNowValue===id}))},refresh:function(){this.initData()},initData:function(){var url,params,self=this;if(self.loading=!0,self.comparisions=[],self.getParameter(),self.$emit("onload",null),self.previewOnly)url="dashboard/getData?moduleName="+self.previewReportContext.moduleName,params={reportContext:self.previewReportContext.reportContext};else{if(url="/dashboard/getData",params={reportId:self.config.id},self.$route.params&&self.$route.params.reportid&&self.$route.query.reportSpaceFilterContext){var querry=JSON.parse(self.$route.query.reportSpaceFilterContext);querry.buildingid&&(params.reportSpaceFilterContext={buildingId:parseInt(querry.buildingid)})}if(self.$route.params&&"buildingdashboard"===self.$route.params.dashboardlink)params.reportSpaceFilterContext={buildingId:parseInt(self.buildingId)};else if(self.$route.query&&self.$route.query.reportSpaceFilterContext&&self.$route.query.reportSpaceFilterContext){var _querry=JSON.parse(self.$route.query.reportSpaceFilterContext);_querry.buildingId?params.reportSpaceFilterContext={buildingId:parseInt(_querry.buildingid)}:_querry.chillerId&&(params.reportSpaceFilterContext={chillerId:parseInt(_querry.chillerId)})}this.appliedDateFilter&&(params.dateFilter=this.appliedDateFilter),self.buildingId&&(params.reportSpaceFilterContext={buildingId:parseInt(self.buildingId)}),self.siteId&&(params.reportSpaceFilterContext={siteId:parseInt(self.siteId)}),self.chillerId&&(params.reportSpaceFilterContext={chillerId:parseInt(self.chillerId)}),self.reportFilters&&(params.filters=self.reportFilters)}self.$http.post(url,params).then((function(response){var reportObj={};if(self.meterList=response.data.meterIds,self.filterName=self.dateOperatorSetFilter(response.data.reportContext&&response.data.reportContext.dateFilter?response.data.reportContext.dateFilter.operatorId:22,self.dateOperators2),response.data.reportContext.dateFilter&&self.setTime(response.data.reportContext.dateFilter.operatorId,!0,response.data.reportContext.dateFilter.value,response.data.reportContext),reportObj.options=self.prepareReportOptions(response.data,self.time,self.filterName),reportObj.alarms=self.prepareRelatedAlarms(response.data.readingAlarms,response.data.reportContext,reportObj.options),reportObj.datefilter=self.prepareDateFilter(response.data.reportContext),response.data.reportContext.reportSpaceFilterContext||response.data.reportContext.energyMeter){var meterFilter={buildingId:"",serviceId:"",subMeterId:",",readingField:""};response.data.reportContext.energyMeter&&(meterFilter=response.data.reportContext.energyMeter),response.data.reportContext.reportSpaceFilterContext&&(meterFilter.buildingId=response.data.reportContext.reportSpaceFilterContext.buildingId),self.energyMeterFilter=meterFilter,self.loadSubMeters()}else self.energyMeterFilter=null;response.data&&response.data.booleanResultGrouping&&response.data.booleanResultGrouping.length?(reportObj.data2=self.prepareBooleanReportData(response.data.booleanResultGrouping,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff),reportObj.options.booleanchart=!0,reportObj.options.booleanKey=self.prepareBooleanKey(response.data.booleanResultOptions,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff),reportObj.options.booleanKey1=response.data.booleanResultOptions,reportObj.data=self.prepareReportData(response.data.reportData,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff)):reportObj.data=self.prepareReportData(response.data.reportData,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff),reportObj.baselines=response.data.reportContext.baseLineContexts?response.data.reportContext.baseLineContexts:[];var dataList=[],colorMap={};if(colorMap[response.data.reportContext.id]=reportObj.options.color||colors/* default.default */.Z["default"][0],reportObj.options.color=colorMap[response.data.reportContext.id],"tabular"!==reportObj.options.type){var isLine=response.data.reportContext.baseLineContexts&&response.data.reportContext.baseLineContexts.length,lineOrArea=isLine?"line":"area";if(dataList.push({title:reportObj.options.entityName?reportObj.options.entityName:reportObj.options.y1axis.title,type:lineOrArea,options:reportObj.options,data:reportObj.data,data2:reportObj.data2}),response.data.reportContext.comparingReportContexts&&response.data.reportContext.comparingReportContexts.length||response.data.reportContext.baseLineContexts&&response.data.reportContext.baseLineContexts.length){var reportParamList=[];if(response.data.reportContext.baseLineContexts){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(response.data.reportContext.baseLineContexts);try{for(_iterator.s();!(_step=_iterator.n()).done;){var baseline=_step.value,prms={reportId:response.data.reportContext.id,baseLineId:baseline.id,baseLineName:baseline.name};if(self.buildingId&&(prms.reportSpaceFilterContext={buildingId:parseInt(self.buildingId)}),self.siteId&&(prms.reportSpaceFilterContext={siteId:parseInt(self.siteId)}),self.chillerId&&(params.reportSpaceFilterContext={chillerId:parseInt(self.chillerId)}),self.reportFilters&&(prms.filters=self.reportFilters),"tabular"!==reportObj.options.type&&reportParamList.push(prms),self.comparisions.push({type:"baseline",name:baseline.name,id:baseline.id}),response.data.reportContext.comparingReportContexts){var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(response.data.reportContext.comparingReportContexts);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var compReport=_step2.value;compReport.excludeBaseline||reportParamList.push({reportId:compReport.id,legendMode:compReport.legendMode?compReport.legendMode._name:"",baseLineId:baseline.id,baseLineName:baseline.name})}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}if(response.data.reportContext.comparingReportContexts){var _step3,_iterator3=(0,createForOfIteratorHelper/* default */.Z)(response.data.reportContext.comparingReportContexts);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _compReport=_step3.value;reportParamList.push({reportId:_compReport.id,legendMode:_compReport.legendMode?_compReport.legendMode._name:""}),self.comparisions.push({type:"comparision",name:_compReport.name,id:_compReport.id})}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}var index=0;self.loadData(reportParamList,index,dataList,colorMap,lineOrArea).then((function(response){reportObj.data=dataList,reportObj.multi=!0,self.reportContext=response.data.reportContext,self.reportFieldLabelMap=response.data.reportFieldLabelMap,self.getWidgetChartType()&&(reportObj.options.type=self.getWidgetChartType()),self.report=self.combineReportData(reportObj),self.chartType=self.getChartType(self.report),"regression"===self.report.options.type?self.$emit("onload",reportObj):self.$emit("onload",self.report),self.failed=!1,self.loading=!1}))}else reportObj.data=dataList,reportObj.multi=!0,self.reportContext=response.data.reportContext,self.reportFieldLabelMap=response.data.reportFieldLabelMap,self.getWidgetChartType()&&(reportObj.options.type=self.getWidgetChartType()),self.report=self.combineReportData(reportObj),self.chartType=self.getChartType(self.report),"regression"===self.report.options.type?self.$emit("onload",reportObj):self.$emit("onload",self.report),self.failed=!1,self.loading=!1}else self.$emit("onload",reportObj,response.data)})).catch((function(error){error&&(self.failed=!0,self.loading=!1)})),self.sendReportutil()},getParameter:function(){},sendReportutil:function(){var self=this,data={previewReportContext:self.previewReportContext,chartType:self.chartType};self.$emit("reportUtil",data)},loadSubMeters:function(){},getWidgetChartType:function(){return this.config&&this.config.widget&&this.config.widget.dataOptions.chartType?this.config.widget.dataOptions.chartType:null},applyDateFilter:function(isHeatMap,isCombo){var dateFilterQuery="";if(this.report.datefilter&&(20===this.report.datefilter.operatorId?this.report.datefilter.dateRange&&2===this.report.datefilter.dateRange.length&&(dateFilterQuery=this.report.datefilter.dateRange[0].getTime()+","+this.report.datefilter.dateRange[1].getTime()):dateFilterQuery=this.report.datefilter.operatorId),""!==dateFilterQuery||this.energyMeterFilter){var buildingId,self=this,url="/dashboard/getData",params={};if(params.reportId=self.config.id,dateFilterQuery&&(params.dateFilter=this.time),isHeatMap&&(params.isHeatMap=!0),null!==self.energyMeterFilter&&(self.energyMeterFilter.buildingId=self.energyMeterFilter.buildingId?parseInt(self.energyMeterFilter.buildingId):null,self.energyMeterFilter.serviceId=self.energyMeterFilter.serviceId?parseInt(self.energyMeterFilter.serviceId):null,self.energyMeterFilter.subMeterId=self.energyMeterFilter.subMeterId?parseInt(self.energyMeterFilter.subMeterId):null,params.energyMeterFilter=self.energyMeterFilter,self.energyMeterFilter&&self.energyMeterFilter.buildingId&&(params.reportSpaceFilterContext={buildingId:parseInt(self.energyMeterFilter.buildingId)})),self.buildingId)buildingId=self.energyMeterFilter&&self.energyMeterFilter.buildingId?parseInt(self.energyMeterFilter.buildingId):parseInt(self.buildingId),params.reportSpaceFilterContext={buildingId:parseInt(buildingId)};else self.siteId?params.reportSpaceFilterContext={siteId:parseInt(self.siteId)}:self.chillerId&&(params.reportSpaceFilterContext={chillerId:parseInt(self.chillerId)});self.reportFilters&&(params.filters=self.reportFilters),
// + '?' + qs.stringify(params)
self.filterApplying=!0,self.$http.post(url,params).then((function(response){self.meterList=response.data.meterIds;var reportObj={};reportObj.options=self.prepareReportOptions(response.data,self.time,self.filterName),isCombo&&(reportObj.options.is_combo=isCombo),reportObj.alarms=self.prepareRelatedAlarms(response.data.readingAlarms,response.data.reportContext,reportObj.options),reportObj.options.type=self.report.options.type,reportObj.datefilter=self.report.datefilter,response.data&&response.data.booleanResultGrouping&&response.data.booleanResultGrouping.length?(reportObj.data=self.prepareReportData(response.data.reportData,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff),reportObj.options.booleanchart=!0,reportObj.options.booleanKey=self.prepareBooleanKey(response.data.booleanResultOptions,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff),reportObj.options.booleanKey1=response.data.booleanResultOptions,reportObj.data2=self.prepareBooleanReportData(response.data.booleanResultGrouping,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff)):reportObj.data=self.prepareReportData(response.data.reportData,response.data.reportContext,reportObj.options,"y1axis",response.data.baseLineComparisionDiff);var dataList=[],colorMap={};colorMap[response.data.reportContext.id]=reportObj.options.color||colors/* default.default */.Z["default"][0],reportObj.options.color=colorMap[response.data.reportContext.id];var isLine=response.data.reportContext.baseLineContexts&&response.data.reportContext.baseLineContexts.length,lineOrArea=isLine?"line":"area";if(dataList.push({title:reportObj.options.entityName?reportObj.options.entityName:reportObj.options.y1axis.title,type:lineOrArea,options:reportObj.options,data:reportObj.data,data2:reportObj.data2}),response.data.reportContext.comparingReportContexts&&response.data.reportContext.comparingReportContexts.length||response.data.reportContext.baseLineContexts&&response.data.reportContext.baseLineContexts.length){var reportParamList=[];if(response.data.reportContext.baseLineContexts){var _step4,_iterator4=(0,createForOfIteratorHelper/* default */.Z)(response.data.reportContext.baseLineContexts);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var baseline=_step4.value;if("tabular"!==response.data.reportContext.chartType&&reportParamList.push({reportId:response.data.reportContext.id,baseLineId:baseline.id,baseLineName:baseline.name,energyMeterFilter:self.energyMeterFilter?self.energyMeterFilter:null,reportSpaceFilterContext:{buildingId:self.energyMeterFilter&&self.energyMeterFilter.buildingId?self.energyMeterFilter.buildingId:null}}),response.data.reportContext.comparingReportContexts){var _step5,_iterator5=(0,createForOfIteratorHelper/* default */.Z)(response.data.reportContext.comparingReportContexts);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var compReport=_step5.value;compReport.excludeBaseline||reportParamList.push({reportId:compReport.id,legendMode:compReport.legendMode?compReport.legendMode._name:"",baseLineId:baseline.id,baseLineName:baseline.name,energyMeterFilter:self.energyMeterFilter?self.energyMeterFilter:null,reportSpaceFilterContext:{buildingId:self.energyMeterFilter&&self.energyMeterFilter.buildingId?self.energyMeterFilter.buildingId:null}})}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}if(response.data.reportContext.comparingReportContexts){var _step6,_iterator6=(0,createForOfIteratorHelper/* default */.Z)(response.data.reportContext.comparingReportContexts);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _compReport2=_step6.value;reportParamList.push({reportId:_compReport2.id,legendMode:_compReport2.legendMode?_compReport2.legendMode._name:""})}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}var index=0;self.loadData(reportParamList,index,dataList,colorMap,lineOrArea).then((function(response){reportObj.data=dataList,reportObj.multi=!0,self.reportContext=response.data.reportContext,self.reportFieldLabelMap=response.data.reportFieldLabelMap,self.report=self.combineReportData(reportObj),self.$emit("onload",self.report),self.filterApplying=!1,self.failed=!1,self.loading=!1}))}else reportObj.data=dataList,reportObj.multi=!0,self.reportContext=response.data.reportContext,self.reportFieldLabelMap=response.data.reportFieldLabelMap,self.report=self.combineReportData(reportObj),self.$emit("onload",self.report),self.filterApplying=!1,self.failed=!1,self.loading=!1})).catch((function(error){error&&(self.failed=!0,self.loading=!1)}))}},loadData:function(reportParamList,index,dataList,colorMap,lineOrArea){var self=this,params=reportParamList[index];return params.energyMeterFilter=self.energyMeterFilter?self.energyMeterFilter:null,params.reportSpaceFilterContext={buildingId:self.energyMeterFilter&&self.energyMeterFilter.buildingId?self.energyMeterFilter.buildingId:null},params.dateFilter=self.time,new Promise((function(resolve,reject){self.$http.post("/dashboard/getData",params).then((function(response){var options=self.prepareReportOptions(response.data,self.time,self.filterName),data=[],data2=[];response.data&&response.data.booleanResultGrouping&&response.data.booleanResultGrouping.length?(data=self.prepareReportData(response.data.reportData,response.data.reportContext,options,"y1axis",response.data.baseLineComparisionDiff),options.booleanchart=!0,options.booleanKey=self.prepareBooleanKey(response.data.booleanResultOptions,response.data.reportContext,options,"y1axis",response.data.baseLineComparisionDiff),options.booleanKey1=response.data.booleanResultOptions,data2=self.prepareBooleanReportData(response.data.booleanResultGrouping,response.data.reportContext,options,"y1axis",response.data.baseLineComparisionDiff)):data=self.prepareReportData(response.data.reportData,response.data.reportContext,options,"y1axis",response.data.baseLineComparisionDiff);var colorKey=response.data.reportContext.id;params.baseLineId&&(options.dashed=!0,colorKey+=colorKey+"_"+params.baseLineId),colorMap[colorKey]||(colorMap[colorKey]=options.color||colors/* default.default */.Z["default"][index+1]),options.color=colorMap[colorKey];var title=response.data.reportContext.name;params.baseLineName&&(title=params.baseLineName);var chartType=response.data.reportContext.reportChartType?response.data.reportContext.reportChartType.name:null;(!chartType||"line"!==chartType&&"area"!==chartType)&&(chartType=lineOrArea),dataList.push({title:response.data.entityName?response.data.entityName:title,type:chartType,options:options,data:data,data2:data2}),index+1<reportParamList.length?self.loadData(reportParamList,index+1,dataList,colorMap,lineOrArea).then((function(response){resolve(response)})):resolve(response)})).catch((function(error){reject(error)}))}))},changeChartType:function(ctype){var needToReload="heatMap"===this.report.options.type||"timeseries"===this.report.options.type||this.report.options.is_combo;if(!ctype.disabled){this.report.options.type=ctype.ct,ctype.sct&&(this.report.options.type1=ctype.sct);var self=this,formdata={};formdata.chartType=this.report.options.type,this.report.options.type1&&(formdata.secChartType=this.report.options.type1);var params={};params.reportId=self.report.options.id,params.chartType=this.report.options.type,this.config&&this.config.widget&&(params.widgetId=this.config.widget.id,params.isReportUpdateFromDashboard=!!this.config.isReportUpdateFromDashboard&&this.config.isReportUpdateFromDashboard),this.report.options.type1&&(params.secChartType=this.report.options.type1),self.$http.post("dashboard/updateChartType",params),"heatMap"===this.report.options.type?self.applyDateFilter(!0):"timeseries"===this.report.options.type?self.applyDateFilter():"combo"===this.report.options.type?self.applyDateFilter(!1,!0):needToReload&&self.applyDateFilter()}},selectBuilding:function(building){this.energyMeterFilter.buildingId=building,this.energyMeterFilter.serviceId=null,this.energyMeterFilter.subMeterId=null,this.loadSubMeters()},selectMeter:function(meter){this.energyMeterFilter.subMeterId=meter;
// this.energyMeterFilter.serviceId = null
},selectService:function(service){this.energyMeterFilter.serviceId=service,this.energyMeterFilter.subMeterId=null,this.loadSubMeters()},selectDateOperator:function(operator,data){this.filterName="D"===data?"D":"W"===data?"W":"M"===data?"M":"Y"===data?"Y":"D",this.report.datefilter.operatorId=operator,this.setTime()},setTime:function(operatorId,doNotApply,value,reportContext){var dontapply=!1;operatorId||(
// dontapply = true
// operatorId = this.report.datefilter.operatorId
operatorId=100);var self=this,startTime=null,endTime=null;if(self.timeCounter=0,this.filterName=45===operatorId?"Y":this.dateOperatorId(operatorId,this.dateOperators2),"D"===this.filterName)25===operatorId?(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter-1,"day").startOf("day"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter-1,"day").endOf("day")):(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"day").startOf("day"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"day").endOf("day"));else if("W"===this.filterName)30===operatorId?(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter-1,"week").startOf("week"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter-1,"week").endOf("week")):(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"week").startOf("week"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"week").endOf("week"));else if("M"===this.filterName)27===operatorId?(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter-1,"month").startOf("month"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter-1,"month").endOf("month")):(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"month").startOf("month"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"month").endOf("month"));else if("Y"===this.filterName)45===operatorId&&(self.timeCounter=self.timeCounter-1),startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"year").startOf("year"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"year").endOf("year");else if("C"===this.filterName){var time=this.getNimes(operatorId,value);startTime=time[0],endTime=time[1]}else"R"===this.filterName?(startTime=reportContext.dateFilter.startTime,endTime=reportContext.dateFilter.endTime):(startTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"day").startOf("day"),endTime=moment_timezone_default()().tz(this.$timezone).add(self.timeCounter,"day").endOf("day"));"R"===this.filterName?this.time=[startTime,endTime]:this.time=[startTime.valueOf(),endTime.valueOf()],dontapply&&this.applyDateFilter()},dateOperatorId:function(id,operators){if(operators){var oprter=operators.find((function(op){return op.value===id||op.uptoNowValue===id}));if(oprter)return oprter.trimLabel}return"---"},getNimes:function(id,value){var val,time;return value&&(val=parseInt(value)),time=42===id?[moment_timezone_default()().tz(this.$timezone).subtract(val-1,"hour").startOf("hour").valueOf(),moment_timezone_default()().tz(this.$timezone).endOf("hour").valueOf()]:49===id?[moment_timezone_default()().tz(this.$timezone).subtract(val-1,"day").startOf("day").valueOf(),moment_timezone_default()().tz(this.$timezone).endOf("day").valueOf()]:50===id?[moment_timezone_default()().tz(this.$timezone).subtract(val-1,"week").startOf("week").valueOf(),moment_timezone_default()().tz(this.$timezone).endOf("week").valueOf()]:51===id?[moment_timezone_default()().tz(this.$timezone).subtract(val-1,"month").startOf("month").valueOf(),moment_timezone_default()().tz(this.$timezone).endOf("month").valueOf()]:[moment_timezone_default()().tz(this.$timezone).subtract(0,"hour").startOf("hour").valueOf(),moment_timezone_default()().tz(this.$timezone).endOf("hour").valueOf()],time},dateOperatorSetFilter:function(id,operators){if(operators){var oprter=operators.find((function(op){return op.value===id})),oprter2=operators.find((function(op){return op.uptoNowValue===id}));return oprter||oprter2?oprter?oprter.trimLabel:oprter2.trimLabel:"D"}return"D"},printing:function(){setTimeout((function(){window.print()}),1e3)},removeComparision:function(comp){var self=this;"baseline"===comp.type?self.updateBaseLine(null):self.$http.post("/dashboard/deleteReport",{reportId:comp.id}).then((function(response){self.initData()}))},updateBaseLine:function(baseline){var self=this,reportId=this.config.id,formdata={reportId:reportId};formdata.baseLines=baseline?[{id:baseline.id}]:[],self.$http.post("/baseline/updateReportBaseLines",formdata).then((function(response){self.$message({message:"Baseline updated successfully!",type:"success"}),self.initData()}))},handleDrillDown:function(data){var self=this;this.isReadOnly||("workorder"===this.reportContext.xAxisField.field.module.name||"alarm"===this.reportContext.xAxisField.field.module.name?self.handleTicketsDrilldown(self.reportContext.xAxisField.field.module.name,data):self.handleReadingsDrilldown(self.reportContext.xAxisField.field.module.name,data),tooltip/* default */.Z.hideTooltip())},handleTicketsDrilldown:function(moduleName,data){var _step7,self=this,filters={},dateFilterField=null,_iterator7=(0,createForOfIteratorHelper/* default */.Z)(data);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var d=_step7.value,formatConfig=formatter/* default */.ZP.getDateFormatConfig(d.axis);if(!d.axis.field.fieldId||d.axis.field.fieldId<0)return;var fieldName=self.reportFieldLabelMap[d.axis.field.name]||d.axis.field.name;if("date"===d.axis.datatype||"date_time"===d.axis.datatype)dateFilterField=d.axis.field.fieldId,filters[fieldName]={operatorId:20,value:[moment_timezone_default()(d.data.orgLabel).tz(this.$timezone).startOf(formatConfig.period).valueOf()+"",moment_timezone_default()(d.data.orgLabel).tz(this.$timezone).endOf(formatConfig.period).valueOf()+""]};else{var operatorId=36;"string"===d.axis.datatype&&(operatorId=3),d.data.orig_label&&(filters[fieldName]={operatorId:operatorId,value:[d.data.orig_label+""]})}}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}if(this.reportContext.dateFilter&&this.reportContext.dateFilter.fieldId!==dateFilterField&&(filters[this.reportContext.dateFilter.field.name]={operatorId:20,value:[this.time[0]+"",this.time[1]+""]}),this.$route.query.filters){var dashboardFilters=JSON.parse(this.$route.query.filters);filters=this.$helpers.extend(filters,dashboardFilters)}if(Object.keys(filters).length){var url="/app/wo/orders/open";"alarm"===moduleName&&(url="/app/fa/faults/active");var query={includeParentFilter:!0};if(query.search=JSON.stringify(filters),this.reportContext&&this.reportContext.reportCriteriaContexts){var _step8,criteriaId=[],_iterator8=(0,createForOfIteratorHelper/* default */.Z)(this.reportContext.reportCriteriaContexts);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var criteria=_step8.value;criteriaId.push(criteria.criteriaId)}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}query.criteriaIds=criteriaId.join(",")}this.$router.push({path:url,query:query})}},handleReadingsDrilldown:function(moduleName,data){if("heatMap"===this.reportContext.reportChartType.name){var parentId=parseInt(this.meterList[0]);this.jumpReadingToAnalytics(parentId,this.reportContext.y1AxisField.field.id,{operatorId:62,value:data.chartData.orgLabel+""},20,3)}},setDateFilter:function(fulldate){this.$emit("dateFilterUpdated",fulldate),"W"===fulldate.filterName?(this.time[0]=moment_timezone_default()(fulldate.time[0]).tz(this.$timezone).valueOf(),this.time[1]=moment_timezone_default()(fulldate.time[1]).tz(this.$timezone).valueOf()):this.time=fulldate.time,this.filterName=fulldate.filterName;var value=this.getOperatorId(fulldate.filterName);this.report.datefilter.operatorId=value.value,this.applyDateFilter()},getOperatorId:function(name){return name&&("R"===name||"C"===name)?this.dateOperators2.find((function(n){return"Y"===n.trimLabel})):this.dateOperators2.find((function(n){return n.trimLabel===name}))},closeSettingsPopover:function(){this.reportSettingsPopover=!1},saveSettingsPopover:function(){this.$refs["fchart"]&&this.$refs["fchart"].rerender(),this.reportSettingsPopover=!1}}},components_FReportvue_type_script_lang_js=FReportvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FReportvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FReport=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/12744.js.map