"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[90746],{
/***/684756:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return NewReadingsImport}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/module-import/NewReadingsImport.vue?vue&type=template&id=12459a19&scoped=true
var render=function(){var this$1=this,_vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.$hasPermission("asset:IMPORT")||_vm.$hasPermission("space:IMPORT")?_c("div",{staticClass:"asset-import-page"},[_vm.showBanner?_c("div",{staticClass:"info-banner"},[_vm._v(" Asset reading import will be available only in "),_c("span",{staticClass:"pointer link-text-2",on:{click:_vm.goToAppDownload}},[_vm._v("Facilio dataloader")])]):_vm._e(),_c("div",{staticClass:"asset-import-main-con"},[_c("div",{staticClass:"asset-import-lCol"},[_c("div",{staticClass:"asset-import-lList"},[_c("ul",[_c("li",{staticClass:"label-txt-black pointer"},[_c("div",{class:_vm.uploadPage?"dot-active-pink":"dot-inactive-grey"}),_vm._v(" Upload ")]),_c("li",{staticClass:"label-txt-black pointer"},[_c("div",{class:_vm.fieldMapping?"dot-active-pink":"dot-inactive-grey"}),_vm._v(" Field Mapping ")]),_c("li",{staticClass:"label-txt-black pointer"},[_c("div",{class:_vm.dataValidation?"dot-active-pink":"dot-inactive-grey"}),_vm._v(" Data Validation ")]),_c("li",{staticClass:"label-txt-black pointer"},[_c("div",{class:_vm.finalUpload?"dot-active-pink":"dot-inactive-grey"}),_vm._v(" Finish ")])])])]),_c("div",{staticClass:"asset-import-rCol"},[_c("div",{staticClass:"fc__layout__align pB20"},[_c("div",{staticClass:"heading-black22 line line-height0"},[_vm._v(" "+_vm._s("Readings Import")+" ")]),_c("div",{staticClass:"fc-dark-blue4-12 pointer line-height0",on:{click:function($event){_vm.historyPageVisibility=!0}}},[_vm._v(" Show Import History ")])]),_c("div",{staticClass:"asset-import-main-bg"},[_vm.uploadPage?_c("reading-import-setting",{attrs:{importMode:"2",importProcessContext:_vm.importProcessContext},on:{"update:importProcessContext":function($event){_vm.importProcessContext=$event},"update:import-process-context":function($event){_vm.importProcessContext=$event},proceed:_vm.moveToFieldMapping}}):_vm._e(),_vm.fieldMapping?_c("import-reading",{attrs:{importProcessContext:_vm.importProcessContext},on:{hideBanner:function(value){this$1.showBanner=value},setTimeFormat:function(data){_vm.timeFormat=data},moveToValidation:_vm.moveToValidation,begin:_vm.moveToBegin,"update:importProcessContext":function($event){_vm.importProcessContext=$event},"update:import-process-context":function($event){_vm.importProcessContext=$event}}}):_vm._e(),_vm.dataValidation?_c("data-validation",{attrs:{timeColumnDateFormat:_vm.timeFormat,dataValidation:_vm.dataValidation,parseError:_vm.parseError,importProcessContext:_vm.importProcessContext},on:{"update:dataValidation":function($event){_vm.dataValidation=$event},"update:data-validation":function($event){_vm.dataValidation=$event},"update:importProcessContext":function($event){_vm.importProcessContext=$event},"update:import-process-context":function($event){_vm.importProcessContext=$event},finishValidation:_vm.finishValidation,begin:_vm.moveToBegin}}):_vm._e(),_vm.finalUpload?_c("final-upload",{attrs:{importProcessContext:_vm.importProcessContext},on:{finalDone:_vm.finalDone,"update:importProcessContext":function($event){_vm.importProcessContext=$event},"update:import-process-context":function($event){_vm.importProcessContext=$event}}}):_vm._e()],1)])]),_vm.historyPageVisibility?_c("import-history",{attrs:{visibility:_vm.historyPageVisibility,historyMeta:{importMode:2}},on:{"update:visibility":function($event){_vm.historyPageVisibility=$event},showUpload:_vm.toggleHistoryPage,continueImport:function(data){return _vm.continueImport(data)}}}):_vm._e()],1):_vm._e()},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),ImportHistory=(__webpack_require__(169358),__webpack_require__(821057),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(670560),__webpack_require__(477572)),ReadingImportSettingvue_type_template_id_4b3d22e4_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"fc-black-12 text-left bold text-uppercase letter-spacing1"},[_vm._v(" IMPORT SETTINGS ")]),_c("div",{staticClass:"fc-heading-border-width43 mT10 height2px"}),_c("div",{staticClass:"import-file-body border-bottom6"},[_vm.attachments&&_vm.attachments.length>0?_c("div",{staticClass:"pT40 pB40"},_vm._l(_vm.attachments,(function(attachment){return _c("el-row",{key:attachment.attachmentId},[_c("el-col",{attrs:{span:20}},[_c("el-col",{attrs:{span:1}},[_c("InlineSvg",{attrs:{src:"svgs/fileupload-xls",iconClass:"icon icon-xlg vertical-middle"}})],1),_c("el-col",{attrs:{span:19}},[_c("div",{staticClass:"pL20"},[_c("div",{staticClass:"this-center show text-left fc-black-16 textoverflow-ellipsis max-width300px"},[_vm._v(" "+_vm._s(attachment.fileName)+" ")]),_c("div",{staticClass:"fc-grey3-text14"},[_vm._v(" "+_vm._s(_vm._f("prettyBytes")(attachment.fileSize))+" ")])])])],1),_c("el-col",{staticClass:"text-right",attrs:{span:4}},[_c("div",{staticClass:"fc-warning2-12 pointer",on:{click:function($event){return _vm.deleteAttachment()}}},[_vm._v(" Remove ")])])],1)})),1):_c("form",{staticClass:"pT20 pB40",attrs:{enctype:"multipart/form-data",novalidate:""}},[_c("div",{staticClass:"dropbox"},[_c("input",{staticClass:"input-file z-10",attrs:{type:"file",accept:".xls, .xlsx"},on:{change:function($event){return _vm.filesChange($event.target.files[0])}}}),_c("div",{staticClass:"upload-parent"},[_c("div",{staticClass:"upload-folder-box"},[_c("InlineSvg",{attrs:{src:"svgs/folder-open",iconClass:"icon z-index1 icon-xxxl vertical-middle"}})],1)]),_vm._m(0)])])]),_c("div",{staticClass:"asset-import-rCol-fields pT20 pB40"},[_c("div",[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"label-txt-black"},[_vm._v(" Import and create from scratch for any space or asset ")]),_c("div",{staticClass:"mT20"},[_c("el-radio-group",{on:{change:_vm.subModuleToggler},model:{value:_vm.baseModule,callback:function($$v){_vm.baseModule=$$v},expression:"baseModule"}},[_vm.$hasPermission("space:IMPORT")?_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"space"}},[_vm._v("Space")]):_vm._e(),_vm.$hasPermission("asset:IMPORT")?_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"asset",disabled:_vm.showAsset}},[_vm._v("Asset")]):_vm._e()],1)],1),_c("el-row",{staticClass:"mT20",attrs:{gutter:20}},[_vm.subModuleToggle?_c("el-col",{attrs:{span:12}},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{filterable:"",clearable:"",placeholder:"Select"},model:{value:_vm.choosenModule,callback:function($$v){_vm.choosenModule=$$v},expression:"choosenModule"}},_vm._l(_vm.fillSubModules(),(function(item,index1){return _c("el-option",{key:index1,attrs:{label:item.label,value:item.name}})})),1)],1):_vm._e(),_vm.choosenModule&&"site"===_vm.choosenModule.toLowerCase()?_c("el-col",{attrs:{span:12}},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{filterable:"",clearable:"",placeholder:""},model:{value:_vm.subModuleFilter,callback:function($$v){_vm.subModuleFilter=$$v},expression:"subModuleFilter"}},_vm._l(_vm.fillSubModuleFilter(),(function(subModule,subModuleIndex){return _c("el-option",{key:subModuleIndex,attrs:{label:subModule.label,value:subModule.name}})})),1)],1):_vm._e()],1)],1),_c("el-col",{attrs:{span:1}},[_c("div",{staticClass:"import-sepration-line"})]),_c("el-col",{attrs:{span:11}},[_c("div",{staticClass:"label-txt-black"},[_vm._v("Choose from Template")]),_c("div",{staticClass:"mT20"},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{filterable:"",clearable:"",placeholder:"Select"},model:{value:_vm.choosenTemplateId,callback:function($$v){_vm.choosenTemplateId=$$v},expression:"choosenTemplateId"}},_vm._l(_vm.userTemplateList,(function(template,index){return _c("el-option",{key:index,staticClass:"visibility-visible-actions",attrs:{value:template.id,label:template.templateName}},[_c("span",{staticClass:"fL"},[_vm._v(_vm._s(template.templateName))]),_c("span",{staticClass:"select-float-right-text13"},[_c("i",{staticClass:"el-icon-delete visibility-hide-actions",on:{click:function($event){return $event.stopPropagation(),_vm.deleteTemplate(template)}}})])])})),1)],1)])],1)],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"fc-full-btn-fill-green f13",attrs:{loading:_vm.loading},on:{click:_vm.nextButton}},[_vm._v(" Proceed to next "),_c("img",{staticClass:"fR",attrs:{src:__webpack_require__(936658),width:"17px"}})])],1)])},ReadingImportSettingvue_type_template_id_4b3d22e4_staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("p",[_vm._v(" Drag and drop file(s) here "),_c("br"),_vm._v("or click to browse ")])}],createForOfIteratorHelper=__webpack_require__(566347),ImportHelper=(__webpack_require__(538077),__webpack_require__(434284),__webpack_require__(648324),__webpack_require__(162506),__webpack_require__(638557)),filters=__webpack_require__(638203),validation=__webpack_require__(990260),ReadingImportSettingvue_type_script_lang_js={props:["module","importMode","importProcessContext"],mixins:[ImportHelper/* default */.Z],data:function(){return{loading:!0,categoryId:-1,attachments:[],uploadFile:null,baseModule:"space",subModuleToggle:!1,templateList:null,choosenModule:null,space:[{label:"Site",name:"site"},{label:"Building",name:"building"},{label:"Floor",name:"floor"},{label:"Space",name:"space"}],subModuleFilter:null,choosenTemplateId:null,choosenTemplate:null,userTemplateList:[],showAsset:!0}},created:function(){var _this=this;this.$store.dispatch("loadAssetCategory").then((function(){_this.subModuleToggler()})),this.$hasPermission("space:IMPORT")?this.baseModule="space":this.$hasPermission("asset:IMPORT")&&(this.baseModule="asset"),this.loading=!0,this.$http("/v2/importTemplate/getnames").then((function(response){_this.templateList=response.data.result.importTemplateContext,_this.userTemplateList=(response.data.result.importTemplateContext||[]).filter((function(template){return template.templateName})),_this.loading=!1}))},mounted:function(){var _this$$route$query;"true"===(null===(_this$$route$query=this.$route.query)||void 0===_this$$route$query?void 0:_this$$route$query.assetreading)&&(this.showAsset=!1,this.baseModule="asset")},computed:{computedModule:function(){if("space"===this.baseModule)return this.choosenModule;for(var j in this.assets)this.assets[j].name===this.choosenModule&&(this.categoryId=this.assets[j].id);return"asset"},moduleMeta:function(){var temp={};return this.subModuleFilter&&(temp["subModuleFilter"]=this.subModuleFilter),temp["baseModule"]=this.baseModule,temp["module"]=this.$getProperty(this.importProcessContext,"module.name",""),(0,validation/* isEmpty */.xb)(this.choosenTemplateId)?"asset"===this.baseModule?(temp["moduleForClient"]=this.choosenModule,temp["parentId"]=this.categoryId):temp["moduleForClient"]=this.choosenModule:(temp["moduleForClient"]=this.moduleInfo.moduleForClient,""!==temp["moduleName"]&&(temp["moduleName"]=this.moduleInfo.moduleName),temp["parentId"]=this.choosenTemplate.moduleJSON.parentId),temp}},methods:{fillSubModuleFilter:function(){return this.choosenModule&&"site"===this.choosenModule.toLowerCase()?[{label:"Weather",name:"weather"},{label:"Daily Weather",name:"weatherDaily"},{label:"Psychrometric",name:"psychrometric"},{label:"Cooling degree days",name:"cdd"},{label:"Heating degree days",name:"hdd"},{label:"WDD",name:"wdd"}]:[]},filesChange:function(selectedFile){if((selectedFile||{}).size<2097152){this.uploadFile=selectedFile;var fileEntry={attachmentId:-1,fileName:selectedFile.name,fileSize:selectedFile.size,prettyFileSize:(0,filters/* prettyBytes */.Hi)(selectedFile.size),contentType:selectedFile.type,status:null,error:null};this.attachments.push(fileEntry)}else this.$message.error("File size limit exceeded (Max File Size is 2MB)")},addAttachment:function(){var _this2=this,formData=new FormData;"asset"===this.computedModule&&formData.append("assetCategory",this.categoryId),formData.append("moduleName",this.computedModule),formData.append("fileUpload",this.uploadFile),formData.append("importMode",this.importMode),formData.append("moduleMeta",JSON.stringify(this.moduleMeta)),this.choosenTemplateId&&formData.append("templateId",this.choosenTemplateId),this.loading=!0,this.$http.post("/v2/import/upload",formData).then((function(response){response.data&&(_this2.loading=!1,0!==response.data.responseCode?_this2.$message.error(response.data.message):(_this2.$emit("update:importProcessContext",response.data.result.importProcessContext),_this2.$message.success("File Uploaded Successfully"),_this2.$emit("proceed")))})).catch((function(error){_this2.loading=!1,_this2.$message.error(error)}))},deleteAttachment:function(){this.attachments.splice(0,1)},nextButton:function(){this.validateForNext()&&this.addAttachment()},validateForNext:function(){var _this3=this;if(this.attachments&&0===this.attachments.length)return this.$message.error({showClose:!0,message:"Please Upload a File to Proceed"}),!1;if((0,validation/* isEmpty */.xb)(this.choosenTemplateId)){if((0,validation/* isEmpty */.xb)(this.baseModule)||(0,validation/* isEmpty */.xb)(this.choosenModule))return this.$message.error({showClose:!0,message:"Please choose a module to proceed."}),!1}else this.choosenTemplate=this.templateList.find((function(i){return i.id===_this3.choosenTemplateId})),this.moduleInfo=JSON.parse(this.choosenTemplate.module),this.choosenModule=this.moduleInfo.subModule,this.baseModule=this.moduleInfo.baseModule,this.moduleInfo.subModuleFilter&&(this.subModuleFilter=this.moduleInfo.subModuleFilter);return!0},subModuleToggler:function(){if(this.subModuleToggle=!0,this.choosenModule=null,"space"===this.baseModule&&(this.subModuleFilter=null),"asset"===this.baseModule){this.assets=[];var _step,assetCategoryList=this.$store.state.assetCategory,_iterator=(0,createForOfIteratorHelper/* default */.Z)(assetCategoryList);try{for(_iterator.s();!(_step=_iterator.n()).done;){var assetCategory=_step.value,temp={};temp["label"]=assetCategory.displayName,temp["name"]=assetCategory.name,temp["id"]=assetCategory.id,this.assets.push(temp)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}},fillSubModules:function(){return"space"===this.baseModule?this.space:this.assets},deleteTemplate:function(template){var _this4=this;template.save=1,this.$http.post("/v2/importTemplate/deletetemplate",{importTemplateContext:template}).then((function(_ref){var _ref$data=_ref.data,responseCode=_ref$data.responseCode,message=_ref$data.message;if(0!==responseCode)throw new Error(message);var userTemplateList=_this4.userTemplateList;_this4.userTemplateList=userTemplateList.filter((function(tm){return tm.id!=template.id})),_this4.choosenTemplateId=null,_this4.$message.success("Template deleted successfully")})).catch((function(_ref2){var message=_ref2.message;_this4.$message.error(message)}))}}},readings_ReadingImportSettingvue_type_script_lang_js=ReadingImportSettingvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(readings_ReadingImportSettingvue_type_script_lang_js,ReadingImportSettingvue_type_template_id_4b3d22e4_render,ReadingImportSettingvue_type_template_id_4b3d22e4_staticRenderFns,!1,null,null,null)
/* harmony default export */,ReadingImportSetting=component.exports,DataValidation=__webpack_require__(50381),ReadingFieldMappingvue_type_template_id_f1da04b4_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"import-field-mapping-body"},[_c("div",{staticClass:"fc-black-12 text-left bold text-uppercase letter-spacing1"},[_vm._v(" FIELD MAPPING ")]),_c("div",{staticClass:"fc-heading-border-width43 mT10 height2px"}),_c("div",{staticClass:"height100 pT20"},[_c("div",[_c("div",{staticClass:"border-bottom13 pB25"},[_c("span",{staticClass:"fR import-template-save-txt pointer",on:{click:_vm.toggleTemplateDialog}},[_vm._v("Save this as Template")])])]),_c("div",[_c("el-row",{staticClass:"mT40",attrs:{disabled:_vm.lockAssetName,gutter:30}},[_c("el-col",{attrs:{span:10}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"single"},on:{change:_vm.loadSpecificModules},model:{value:_vm.radio,callback:function($$v){_vm.radio=$$v},expression:"radio"}},[_vm._v(_vm._s(_vm.getOptionLabel("single")))]),_c("div",{staticClass:"import-radio-description"},[_vm._v(" Map points to a single asset ")])],1),_c("el-col",{attrs:{span:12}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"multiple"},on:{change:_vm.loadReadingsForAllModule},model:{value:_vm.radio,callback:function($$v){_vm.radio=$$v},expression:"radio"}},[_vm._v(_vm._s(_vm.getOptionLabel("multiple")))]),_c("div",{staticClass:"import-radio-description"},[_vm._v(" Map points to a multiple assets ")])],1)],1),"single"===_vm.radio?_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:8}},[_c("div",{staticClass:"pT30 fc-input-label-txt"},[_vm._v("Name")])]),_c("el-col",{attrs:{span:12}},[_c("el-select",{staticClass:"mT20 fc-input-full-border2",attrs:{disabled:_vm.lockAssetName,filterable:"",placeholder:"Select"},on:{change:_vm.loadReadingsForSpecificModule},model:{value:_vm.parentId,callback:function($$v){_vm.parentId=$$v},expression:"parentId"}},_vm._l(_vm.moduleNameList,(function(sub,index){return _c("el-option",{key:index,attrs:{label:sub.name,value:sub.id}})})),1)],1)],1):_vm._e(),"multiple"===_vm.radio?_c("div",[_c("el-row",{staticClass:"mT40"},[_c("el-col",{attrs:{span:8}},[_c("div",{staticClass:"mT10 fc-input-label-txt"},[_vm._v("Identity Column")])]),_c("el-col",{staticClass:"el-select-block",attrs:{span:12}},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{multiple:"",filterable:"","collapse-tags":"","default-first-option":"",placeholder:"Select Identity column"},on:{"remove-tag":_vm.clearIdentityColumns},model:{value:_vm.uniqueColumn,callback:function($$v){_vm.uniqueColumn=$$v},expression:"uniqueColumn"}},_vm._l(_vm.filteredColumnHeadings,(function(item,index1){return _c("el-option",{key:index1,attrs:{label:item,value:item}})})),1),_c("span")],1)],1),_vm._l(_vm.uniqueMap||[],(function(column,index2){return _c("el-row",{key:index2,staticClass:"mT20"},[_c("el-col",{attrs:{span:8}},[_c("div",{staticClass:"mT10 fc-input-label-txt"},[_vm._v(_vm._s(column))])]),_c("el-col",{attrs:{span:12}},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{clearable:"",filterable:"",placeholder:"Select"},on:{clear:function($event){return _vm.clearIdentityColumns(column)}},model:{value:_vm.uniqueMappingValues[column],callback:function($$v){_vm.$set(_vm.uniqueMappingValues,column,$$v)},expression:"uniqueMappingValues[column]"}},_vm._l(_vm.importProcessContext.fields,(function(value,index3){return _c("el-option",{key:index3,attrs:{label:_vm.importProcessContext.facilioFieldMapping[value]?_vm.importProcessContext.facilioFieldMapping[value].displayName:value,value:value}})})),1)],1)],1)}))],2):_vm._e(),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:8}},[_c("div",{staticClass:"mT10 label-txt-red"},[_vm._v("Time")])]),_c("el-col",{attrs:{span:8}},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{clearable:"",filterable:"",placeholder:"Select Time column"},on:{change:_vm.getDateFormatForTimeColumn},model:{value:_vm.timeMapping,callback:function($$v){_vm.timeMapping=$$v},expression:"timeMapping"}},_vm._l(_vm.filteredColumnHeadings,(function(column1,index4){return _c("el-option",{key:index4,attrs:{clearable:"",label:column1,value:column1}})})),1)],1),_c("el-col",{attrs:{span:8}},[null!=_vm.timeMappingDateFormats?_c("el-select",{staticClass:"fc-input-full-border2",attrs:{placeholder:_vm.timeMappingDateFormats[0]},model:{value:_vm.timeMappingDateFormatString,callback:function($$v){_vm.timeMappingDateFormatString=$$v},expression:"timeMappingDateFormatString"}},_vm._l(_vm.timeMappingDateFormats,(function(dateFormat,dateFormatIndex){return _c("el-option",{key:dateFormatIndex,attrs:{label:dateFormat,value:dateFormat}})})),1):_vm._e()],1)],1)],1),_vm.showReadings?_c("div",{staticClass:"mT40"},[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.tableDataLoading,expression:"tableDataLoading"}],staticClass:"import-table width100",attrs:{data:_vm.columnHeading,height:"410"}},[_c("template",{slot:"empty"},[_c("div",{staticClass:"mT50"},[_c("img",{attrs:{src:__webpack_require__(15482),width:"100",height:"100"}}),_c("div",{staticClass:"mT10 label-txt-black f14"},[_vm._v(" No field mapping available ")])])]),_c("el-table-column",{attrs:{prop:"name",label:"COLUMNS",width:"single"===_vm.radio?150:300},scopedSlots:_vm._u([{key:"default",fn:function(field){return[_c("div",{staticClass:"label-txt-black"},[_vm._v(_vm._s(field.row.heading))])]}}],null,!1,1007420390)}),_c("el-table-column",{attrs:{label:"READINGS",width:"single"===_vm.radio?250:300},scopedSlots:_vm._u([{key:"default",fn:function(field){return[_c("el-select",{staticClass:"fc-input-full-border-select2",class:["single"===_vm.radio?"width170px":"import-select-width"],attrs:{clearable:"",filterable:"",placeholder:"Select"},on:{change:function($event){return _vm.getDateFormat(field.row.heading)}},model:{value:_vm.fieldMappingValues[field.row.heading],callback:function($$v){_vm.$set(_vm.fieldMappingValues,field.row.heading,$$v)},expression:"fieldMappingValues[field.row.heading]"}},_vm._l(Object.keys(_vm.readingsList),(function(reading,index6){return _c("el-option",{key:index6,attrs:{value:Object.keys(_vm.readingsList)[index6],label:_vm.readingsList[Object.keys(_vm.readingsList)[index6]].displayName}})})),1),_vm.dateToggles[field.row.heading].dateToggle?_c("el-tooltip",{staticClass:"item",attrs:{content:"Choose a date format",effect:"dark",placement:"right-start"}},[_c("el-popover",{attrs:{trigger:"click",width:"200",placement:"right"},model:{value:_vm.dateToggles[field.row.heading].datePopoverToggle,callback:function($$v){_vm.$set(_vm.dateToggles[field.row.heading],"datePopoverToggle",$$v)},expression:"dateToggles[field.row.heading].datePopoverToggle"}},[_vm._l(field.row.dateFormats,(function(columnDateFormat,columnDateFormatIndex){return _c("div",{key:columnDateFormatIndex,staticClass:"date-format pointer pB10",class:{active:_vm.dateFormatMapping[field.row.heading]===columnDateFormat},on:{click:function($event){return _vm.setDateFormat(field.row.heading,columnDateFormat)}}},[_vm._v(" "+_vm._s(columnDateFormat)+" ")])})),_vm.dateToggles[field.row.heading].dateToggle?_c("i",{staticClass:"el-icon-date",class:{"fc-red3":!_vm.dateFormatMapping[field.row.heading]},attrs:{slot:"reference"},on:{click:function($event){return _vm.toggleDateFormatPopover(field.row.heading)}},slot:"reference"}):_vm._e()],2)],1):_vm._e()]}}],null,!1,4129203756)}),_c("el-table-column",{attrs:{label:"SAMPLE DATA"},scopedSlots:_vm._u([{key:"default",fn:function(field){return[_c("div",{staticClass:"fc-grey3-text14"},[_vm._v(_vm._s(field.row.sample))])]}}],null,!1,3962291958)}),"single"===_vm.radio?_c("el-table-column",{attrs:{label:"INPUT UNIT",width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(field){return[_c("div",{staticClass:"fc-grey3-text14"},[_vm._v(" "+_vm._s(_vm.getInputUnit(_vm.fieldMappingValues[field.row.heading]))+" ")])]}}],null,!1,3380589903)}):_vm._e(),"single"===_vm.radio?_c("el-table-column",{attrs:{label:"DISPLAY UNIT",width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(field){return[_c("div",{staticClass:"fc-grey3-text14"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.readingsList,_vm.fieldMappingValues[field.row.heading]+".unit"))+" ")])]}}],null,!1,3745141497)}):_vm._e()],2)],1):_c("div",[_vm._m(0)])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.goBacktoBeginning}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{loading:_vm.loading,type:"primary"},on:{click:_vm.beginDataValidation}},[_vm._v(" Proceed to next "),_c("img",{staticClass:"fR",attrs:{src:__webpack_require__(936658),width:"17px"}})])],1),_c("div",[_c("el-dialog",{attrs:{visible:_vm.newTemplateDialog,fullscreen:!1,open:"top",width:"30%",title:_vm.$t("setup.setupLabel.add_template"),"append-to-body":!0,"custom-class":"fc-dialog-center-container"},on:{"update:visible":function($event){_vm.newTemplateDialog=$event}}},[_c("div",{staticClass:"height200"},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Template Name")]),_c("div",[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{placeholder:_vm.$t("common._common.enter_name")},model:{value:_vm.templateName,callback:function($$v){_vm.templateName=$$v},expression:"templateName"}})],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){_vm.newTemplateDialog=!1}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.loading},on:{click:_vm.checkForName}},[_vm._v("DONE")])],1)])],1)])},ReadingFieldMappingvue_type_template_id_f1da04b4_staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"text-align-center mT40 border-top6"},[_c("img",{staticClass:"mT50",attrs:{src:__webpack_require__(15482),width:"100",height:"100"}})])}],api=(__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(689730),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(947522),__webpack_require__(32284)),utils_field=__webpack_require__(815872),ReadingFieldMappingvue_type_script_lang_js={props:["importProcessContext"],mixins:[ImportHelper/* default */.Z],data:function(){return{tableDataLoading:!1,loading:!1,lockAssetName:!1,dateToggles:{},saveToggle:!0,existingTemplateNames:[],templateName:"",newTemplateDialog:!1,showReadings:!1,timeMapping:"",timeMappingDateFormatString:"",timeMappingDateFormats:[],dateFormatMapping:{},uniqueColumn:[],moduleName:null,uniqueMappingValues:{},fieldMappingValues:{},importTemplateContext:null,moduleNameList:{},uniqueMappingColumns:[],readingsList:{},templateCheck:!0,parentId:null,moduleMap:null,radio:"single",template:null,moduleMeta:null,templateList:null,unitIdVsObjMap:{},recordFieldIdVsRDM:{}}},computed:{filteredColumnHeadings:function(){var columns=[];if(this.importProcessContext){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.importProcessContext.columnHeadings);try{for(_iterator.s();!(_step=_iterator.n()).done;){var column=_step.value;(0,validation/* isEmpty */.xb)(column)||columns.push(column)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return columns}return[]},columnHeading:function(){var columnHeadings=[];if(""===this.timeMapping){for(var index in this.importProcessContext.columnHeadings)if(!(0,validation/* isEmpty */.xb)(this.importProcessContext.columnHeadings[index])&&!this.uniqueMap.includes(this.importProcessContext.columnHeadings[index])){var temp={};temp["heading"]=this.importProcessContext.columnHeadings[index],temp["sample"]=this.importProcessContext.firstRow[this.importProcessContext.columnHeadings[index]],temp["dateFormats"]=[],columnHeadings.push(temp)}}else for(var _index in this.importProcessContext.columnHeadings)if(!(0,validation/* isEmpty */.xb)(this.importProcessContext.columnHeadings[_index])&&this.importProcessContext.columnHeadings[_index]!==this.timeMapping&&!this.uniqueMap.includes(this.importProcessContext.columnHeadings[_index])){var _temp={};_temp["heading"]=this.importProcessContext.columnHeadings[_index],_temp["sample"]=this.importProcessContext.firstRow[this.importProcessContext.columnHeadings[_index]],_temp["dateFormats"]=[],columnHeadings.push(_temp)}return columnHeadings},uniqueMap:function(){if(0!==this.uniqueMappingColumns.length)return this.uniqueMappingColumns;var temp=[];if(0!==this.uniqueColumn.length)for(var index in this.uniqueColumn)temp.push(this.uniqueColumn[index]);return temp},computedModuleName:function(){var temp={};if(0===Object.keys(this.uniqueMappingValues).length)if(temp["baseModule"]=this.moduleMeta["baseModule"],temp["subModule"]=this.moduleMeta["module"],temp["subModuleFilter"]=this.moduleMeta.subModuleFilter?this.moduleMeta.subModuleFilter:"","asset"===this.moduleMeta["baseModule"])for(var key in temp["moduleForClient"]=this.moduleMeta.moduleForClient,this.moduleNameList)this.moduleNameList[key].id===this.parentId&&(temp["moduleName"]=this.moduleNameList[key].name,temp["parentId"]=this.moduleNameList[key].id);else for(var _key in temp["parentId"]=this.parentId,this.moduleNameList)this.moduleNameList[_key].id===this.parentId&&(temp["moduleName"]=this.moduleNameList[_key].name);else temp["baseModule"]=this.moduleMeta["baseModule"],temp["subModule"]=this.moduleMeta["module"],temp["parentId"]=this.moduleMeta["parentId"],temp["moduleForClient"]=this.moduleMeta.moduleForClient,temp["subModuleFilter"]=this.moduleMeta.subModuleFilter?this.moduleMeta.subModuleFilter:"";return temp}},mounted:function(){this.$emit("hideBanner",!1)},created:function(){var _this=this;this.moduleMeta=this.$getProperty(this.importProcessContext,"importJobMetaJson.moduleInfo"),this.$store.dispatch("loadAssetCategory"),this.createDateToggles(),this.loadDefaultUnitMetrics(),this.$http("/v2/importTemplate/getnames").then((function(_ref){var _ref$data=_ref.data,responseCode=_ref$data.responseCode,result=_ref$data.result,message=_ref$data.message;if(0!==responseCode)throw new Error(message);var importTemplateContext=result.importTemplateContext;_this.templateList=importTemplateContext;var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(importTemplateContext||[]);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var template=_step2.value;_this.existingTemplateNames.push(template.templateName)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}_this.loadData()})).catch((function(_ref2){var message=_ref2.message;_this.$message.error(message)}))},methods:{loadData:function(){var _this2=this;if((0,validation/* isEmpty */.xb)(this.importProcessContext.templateId)||(this.template=this.templateList.find((function(i){return i.id===_this2.importProcessContext.templateId}))),(0,validation/* isEmpty */.xb)(this.template))this.loadSpecificModules();else{if("{}"!==this.template.fieldMappingString){var fieldMapping=JSON.parse(this.template.fieldMappingString);for(var keys in Object.keys(fieldMapping)){var field=Object.keys(fieldMapping)[keys],columnName=fieldMapping[Object.keys(fieldMapping)[keys]];"sys__ttime"===field?this.timeMapping=columnName:this.fieldMappingValues[columnName]=field}}if("{}"!==this.template.uniqueMappingString){var uniqueMapping=JSON.parse(this.template.uniqueMappingString);for(var _keys in Object.keys(uniqueMapping)){var _field=Object.keys(uniqueMapping)[_keys],_columnName=uniqueMapping[Object.keys(uniqueMapping)[_keys]];this.uniqueMappingValues[_columnName]=_field,this.uniqueMappingColumns.push(_columnName),this.uniqueColumn.push(_columnName)}this.radio="multiple"}if("{}"!==this.template.templateMeta){var templateMeta=JSON.parse(this.template.templateMeta),dateFormats=templateMeta["dateFormats"];for(var dateFormatColumn in dateFormats)dateFormatColumn===this.timeMapping?"TimeStamp"===dateFormats[dateFormatColumn]?(this.timeMappingDateFormats=null,this.timeMappingDateFormatString="TimeStamp"):this.timeMappingDateFormatString=dateFormats[this.timeMapping]:"TimeStamp"===dateFormats[dateFormatColumn]?(this.$set(this.dateFormatMapping,dateFormatColumn,dateFormats[dateFormatColumn]),this.$set(this.dateToggles[dateFormatColumn],"dateToggle",!1)):(this.$set(this.dateFormatMapping,dateFormatColumn,dateFormats[dateFormatColumn]),this.$set(this.dateToggles[dateFormatColumn],"dateToggle",!0))}if("multiple"!==this.radio){var moduleInfo=JSON.parse(this.template.module);this.parentId=moduleInfo.parentId,this.radio="single"}this.lockAssetName=!0,this.loadSpecificModules(),this.saveToggle=!0,this.templateCheck=!1,this.$nextTick((function(){_this2.showReadings=!0}))}},getOptionLabel:function(mode){var temp="single"===mode?"Single ":"Multiple ";return temp+=this.moduleMeta&&"space"===this.moduleMeta.baseModule?"Space":"Asset",temp},clearIdentityColumns:function(columnName){this.uniqueColumn.includes(columnName)?""===this.uniqueMappingValues[columnName]&&delete this.uniqueMappingValues[columnName]:delete this.uniqueMappingValues[columnName]},createDateToggles:function(){for(var index in this.columnHeading){var columnName=this.columnHeading[index].heading,temp={dateToggle:!1,datePopoverToggle:!1};this.$set(this.dateToggles,columnName,temp)}},setDateFormat:function(columnHeading,dateFormat){this.$set(this.dateFormatMapping,columnHeading,dateFormat),this.$set(this.dateToggles[columnHeading],"datePopoverToggle",!1)},getDateFormatForTimeColumn:function(){if(""===this.timeMapping)this.timeMapping="",this.timeMappingDateFormatString="",this.timeMappingDateFormats=[];else{var temp=this.getDateFormats(this.importProcessContext.firstRow[this.timeMapping]);null===temp?(temp=[],temp.push("Incompatible format"),this.timeMappingDateFormats=temp):1===temp.length&&"TimeStamp"===temp[0]?(this.timeMappingDateFormats=null,this.timeMappingDateFormatString="TimeStamp"):this.timeMappingDateFormats=temp.slice()}},getDateFormat:function(columnName){if(""===this.fieldMappingValues[columnName]||null===this.fieldMappingValues[columnName]){for(var key in this.dateToggles[columnName].dateToggle=!1,this.dateToggles[columnName].datePopoverToggle=!1,delete this.fieldMappingValues[columnName],delete this.dateFormatMapping[columnName],this.columnHeading)if(this.columnHeading[key].heading===columnName){this.columnHeading[key].dateFormats=[];break}}else if(this.isDateOrDateTimeField(this.fieldMappingValues[columnName]))for(var _key2 in this.columnHeading)if(this.columnHeading[_key2].heading===columnName){var temp=this.getDateFormats(this.importProcessContext.firstRow[columnName]);null===temp?(this.columnHeading[_key2].dateFormats.push("Incompatible Format"),this.$set(this.dateToggles[columnName],"dateToggle",!0)):1===temp.length?"TimeStamp"===temp[0]?(this.$set(this.dateToggles[columnName],"dateToggle",!1),this.$set(this.dateFormatMapping,columnName,"TimeStamp")):(this.columnHeading[_key2].dateFormats=temp,this.$set(this.dateFormatMapping,columnName,temp[0]),this.$set(this.dateToggles[columnName],"dateToggle",!0)):(this.columnHeading[_key2].dateFormats=temp,this.$set(this.dateToggles[columnName],"dateToggle",!0))}
// check if the selected field is a date field
},isDateOrDateTimeField:function(fieldName){var field=this.readingsList[fieldName]||{};return!(0,validation/* isEmpty */.xb)(field)&&((0,utils_field/* isDateField */.y2)(field)||(0,utils_field/* isDateTimeField */.K)(field))},goBacktoBeginning:function(){this.$emit("begin",0)},checkForName:function(){this.existingTemplateNames.includes(this.templateName)?this.$message.error({showClose:!0,message:"Template name needs to be unique"}):this.newTemplateDialog=!1},loadSpecificModules:function(){var _this3=this;if("asset"===this.moduleMeta["baseModule"]){var assetCategory=this.$store.state.assetCategory,id=0;for(var assetIndex in assetCategory){var category=assetCategory[assetIndex];category.name.toLowerCase()===this.moduleMeta.moduleForClient.toLowerCase()&&(id=category.id)}var filter={category:{operator:"is",value:[id+""]}};this.$http.get("/asset/all?filters="+encodeURIComponent(JSON.stringify(filter))).then((function(response){var assets=response.data.assets;_this3.moduleNameList={};for(var i=0;i<assets.length;i++){var asset=assets[i];_this3.moduleNameList[asset.id]=asset}null!==_this3.template&&("single"===_this3.radio?_this3.loadReadingsForSpecificModule():_this3.loadReadingsForAllModule())}))}else this.$http.post("/reading/getallspacetypereadings",{spaceType:this.moduleMeta["module"]+"s"}).then((function(response){_this3.moduleMap=response.data.moduleMap;var keys=Object.keys(response.data.spaces);_this3.moduleNameList={};for(var i=0;i<keys.length;i++){var details=response.data.spaces[keys[i]];_this3.moduleNameList[details.name]=details}null!==_this3.template&&("single"===_this3.radio?_this3.loadReadingsForSpecificModule():_this3.loadReadingsForAllModule())}))},loadReadingsForSpecificModule:function(){var _this4=this;if(this.readingsList={},"asset"===this.moduleMeta["baseModule"]){var categoryId=0;for(var key in this.moduleNameList){var entry=this.moduleNameList[key];entry.id===this.parentId&&(categoryId=entry.category.id)}this.tableDataLoading=!0,Promise.all([this.loadRDM(),this.loadAssetReadings(categoryId)]).finally((function(){_this4.tableDataLoading=!1}))}else Promise.all([this.loadRDM(),this.loadSpaceReadings()]).finally((function(){_this4.tableDataLoading=!1}))},loadReadingsForAllModule:function(){var _this5=this;this.readingsList={},"asset"===this.moduleMeta["baseModule"]?this.$http("/reading/getassetreadings?excludeEmptyFields=false&parentCategoryId="+this.moduleMeta["parentId"]).then((function(response){for(var tempObject={},j=0;j<response.data.length;j++)tempObject[j]=response.data[j];for(var moduleMapKey in _this5.moduleMap=tempObject,_this5.moduleMap){var temp=_this5.moduleMap[moduleMapKey];if(0!==temp.length)for(var fields=temp.fields,_j=0;_j<fields.length;_j++){var tempModule={};tempModule["name"]=temp.name,fields[_j].module=tempModule,_this5.$set(_this5.readingsList,temp.name+"__"+fields[_j].name,fields[_j])}}_this5.showReadings=!0})):this.$http.post("/reading/getallspacetypereadings",{spaceType:this.moduleMeta["module"]+"s"}).then((function(response){for(var moduleMapKey in _this5.moduleMap=response.data.moduleMap,_this5.moduleMap){var temp=_this5.moduleMap[moduleMapKey];if(0!==temp.length)for(var i=0;i<temp.length;i++)for(var fields=temp[i].fields,j=0;j<fields.length;j++){var tempModule={};tempModule["name"]=temp[i].name,fields[j].module=tempModule,_this5.readingsList[temp[i].name+"__"+fields[j].name]=fields[j]}}_this5.moduleMeta.hasOwnProperty("subModuleFilter")&&_this5.filterForSubModuleFields(),_this5.showReadings=!0}))},populateImportProcessContext:function(data){for(var keys=Object.keys(data),i=0;i<keys.length;i++)for(var fields=Object.keys(data[keys[i]].fields),j=0;j<fields.length;j++){var temp=data[keys[i]].fields[j],module={};module["name"]=data[keys[i]].name,temp["module"]=module,this.readingsList[module.name+"__"+temp.name]=temp}this.moduleMeta.hasOwnProperty("subModuleFilter")&&this.filterForSubModuleFields(),this.$forceUpdate()},filterForSubModuleFields:function(){var finalFields={};for(var field in this.readingsList){var fieldNameSplit=field.split("__");fieldNameSplit&&0!==fieldNameSplit.length&&fieldNameSplit[0]===this.moduleMeta.subModuleFilter&&(finalFields[field]=this.readingsList[field])}this.readingsList=finalFields},checkForDateMapsBeforeImport:function(){if(""===this.timeMappingDateFormatString)return!1;for(var key in this.dateToggles){var column=this.dateToggles[key];if(column.dateToggle){if("undefined"!==typeof this.dateFormatMapping[key]&&null!==this.dateFormatMapping[key])continue;return!1}}return!0},beginDataValidation:function(){var _this6=this;if(this.importProcessContext.importMode=2,this.checkForDateMapsBeforeImport()){var fieldMapping={},uniqueMapping={};for(var keys in this.$set(this.dateFormatMapping,this.timeMapping,this.timeMappingDateFormatString),null!==this.timeMapping&&(fieldMapping["sys__ttime"]=this.timeMapping),Object.keys(this.fieldMappingValues)){var columnName=Object.keys(this.fieldMappingValues)[keys],field=this.fieldMappingValues[columnName];fieldMapping[field]=columnName}for(var _keys2 in Object.keys(this.uniqueMappingValues)){var _columnName2=Object.keys(this.uniqueMappingValues)[_keys2],_field2=this.uniqueMappingValues[_columnName2];uniqueMapping[_field2]=_columnName2}if(null!==this.template){if(!this.templateCheck){this.template.fieldMappingString=JSON.stringify(fieldMapping),this.template.uniqueFieldMappingString=JSON.stringify(uniqueMapping);var templateMeta=this.template.templateMeta;if(null===templateMeta){var temp={};temp["dateFormats"]=this.dateFormatMapping,this.template.templateMeta=JSON.stringify(temp)}else{var tempMeta=JSON.parse(this.template.templateMeta);tempMeta["dateFormats"]=this.dateFormatMapping,this.template.templateMeta=JSON.stringify(tempMeta)}this.saveImportTemplate("updateTemplate",this.template)}}else this.loading=!0,this.$http("/v2/importTemplate/getnewtemplate").then((function(response){_this6.importTemplateContext=response.data.result.importTemplateContext,_this6.importTemplateContext.fieldMappingString=JSON.stringify(fieldMapping),_this6.importTemplateContext.uniqueMappingString=JSON.stringify(uniqueMapping);var temp={};temp["dateFormats"]=_this6.dateFormatMapping,_this6.importTemplateContext.templateMeta=JSON.stringify(temp),_this6.templateCheck||(_this6.importTemplateContext.save=1),_this6.importTemplateContext.templateName=_this6.templateName,_this6.importTemplateContext.module=JSON.stringify(_this6.computedModuleName),_this6.saveImportTemplate("save",_this6.importTemplateContext)})).catch((function(_ref3){var message=_ref3.message;_this6.loading=!1,_this6.$message.error(message)}))}else this.$message.error("Please map all date fields to a format before importing")},saveImportTemplate:function(mode,templateContext){var _this7=this;this.loading=!0,this.$http.post("/v2/importTemplate/"+mode,{importTemplateContext:templateContext}).then((function(response){_this7.importProcessContext.templateId=response.data.result.templateId,_this7.$http.post("/import/beginimportvalidation",{importProcessContext:_this7.importProcessContext}).then((function(response){_this7.loading=!1,200===response.status&&(_this7.$emit("moveToValidation",!0),_this7.$emit("setTimeFormat",_this7.timeMappingDateFormatString),_this7.$emit("update:importProcessContext",response.data.importProcessContext))})).catch((function(error){_this7.$message("Unable to begin Import validation"),_this7.loading=!0,_this7.$emit("moveToValidation",!1)}))}))},toggleTemplateDialog:function(){this.newTemplateDialog=!this.newTemplateDialog},loadSpaceReadings:function(){var _this8=this;return this.$http.get("/reading/getspacespecificreadings?parentId=".concat(this.parentId,"&excludeEmptyFields=false")).then((function(response){_this8.populateImportProcessContext(response.data),_this8.showReadings=!0}))},loadAssetReadings:function(categoryId){var _this9=this;return this.$http.get("/reading/getassetreadings?excludeEmptyFields=false&parentCategoryId=".concat(categoryId)).then((function(response){for(var tempObject={},j=0;j<response.data.length;j++)tempObject[j]=response.data[j];for(var moduleMapKey in _this9.moduleMap=tempObject,_this9.moduleMap){var temp=_this9.moduleMap[moduleMapKey];if(0!==temp.length)for(var fields=temp.fields,_j2=0;_j2<fields.length;_j2++){var tempModule={};tempModule["name"]=temp.name,fields[_j2].module=tempModule,_this9.$set(_this9.readingsList,temp.name+"__"+fields[_j2].name,fields[_j2])}}_this9.showReadings=!0}))},loadRDM:function(){var _this10=this;return this.recordFieldIdVsRDM={},this.$util.loadLatestReading(this.parentId,!1).then((function(fields){fields.forEach((function(field){_this10.$setProperty(_this10.recordFieldIdVsRDM,"".concat(field.fieldId),field)}))}))},getInputUnit:function(moduleKey){var fieldObj=this.$getProperty(this.readingsList,"".concat(moduleKey),null),siUnitId=this.$getProperty(fieldObj,"metricEnum.siUnitId",-1);if(!(0,validation/* isEmpty */.xb)(fieldObj)){var rdmObj=this.$getProperty(this.recordFieldIdVsRDM,"".concat(fieldObj.id),null);if(!(0,validation/* isEmpty */.xb)(rdmObj)&&!(0,validation/* isEmpty */.xb)(rdmObj.unit)){var symbol=this.$getProperty(this.unitIdVsObjMap,"".concat(rdmObj.unit,".symbol"));if(!(0,validation/* isEmpty */.xb)(symbol))return symbol}}return this.$getProperty(this.unitIdVsObjMap,"".concat(siUnitId,".symbol"),"")},loadDefaultUnitMetrics:function(){var _this11=this;this.unitIdVsObjMap={},api/* API */.bl.get("v2/getReadingFieldUnits").then((function(_ref4){var error=_ref4.error,data=_ref4.data;if(error){var message=error.message;_this11.$message.error(message||"Error occured while fetching field units")}else{var metricsWithUnits=_this11.$getProperty(data,"readingFieldUnits.MetricsWithUnits",{});Object.keys(metricsWithUnits).forEach((function(key){metricsWithUnits[key].forEach((function(obj){_this11.$setProperty(_this11.unitIdVsObjMap,"".concat(obj.unitId),obj)}))}))}}))}}},readings_ReadingFieldMappingvue_type_script_lang_js=ReadingFieldMappingvue_type_script_lang_js,ReadingFieldMapping_component=(0,componentNormalizer/* default */.Z)(readings_ReadingFieldMappingvue_type_script_lang_js,ReadingFieldMappingvue_type_template_id_f1da04b4_render,ReadingFieldMappingvue_type_template_id_f1da04b4_staticRenderFns,!1,null,null,null)
/* harmony default export */,ReadingFieldMapping=ReadingFieldMapping_component.exports,FinalUpload=__webpack_require__(753144),router=__webpack_require__(329435),NewReadingsImportvue_type_script_lang_js={mixins:[ImportHelper/* default */.Z],data:function(){return{showBanner:!0,historyPageVisibility:!1,uploadPage:!0,fieldMapping:!1,dataValidation:!1,finalUpload:!1,importProcessContext:null,timeFormat:null,parseError:{visibility:!1,errorMessage:""}}},components:{ImportHistory:ImportHistory/* default */.Z,ReadingImportSetting:ReadingImportSetting,ImportReading:ReadingFieldMapping,DataValidation:DataValidation/* default */.Z,FinalUpload:FinalUpload/* default */.Z},title:function(){return"Readings Import"},created:function(){this.init()},mounted:function(){var _this$$route$query;"true"===(null===(_this$$route$query=this.$route.query)||void 0===_this$$route$query?void 0:_this$$route$query.assetreading)&&(this.showBanner=!1)},methods:{init:function(){var hasPermission=!1;if((0,router/* isWebTabsEnabled */.tj)()){var _findTab=(0,router/* findTab */.DU)(router/* tabTypes */.VF.MODULE,{moduleName:"asset"}),tabId=_findTab.tabId,groupId=_findTab.groupId;(0,validation/* isEmpty */.xb)(tabId)||(hasPermission=this.$hasPermission("asset:IMPORT",tabId),hasPermission&&(this.$store.dispatch("webtabs/setTabGroup",groupId),this.$store.dispatch("webtabs/setTab",tabId)))}else hasPermission=this.$hasPermission("asset:IMPORT")||this.$hasPermission("space:IMPORT");hasPermission||this.$message.error("Permission Denied")},toggleHistoryPage:function(){this.historyPageVisibility=!this.historyPageVisibility},moveToFieldMapping:function(){this.fieldMapping=!0,this.uploadPage=!1,this.dataValidation=!1,this.finalUpload=!1},moveToValidation:function(){this.uploadPage=!1,this.fieldMapping=!1,this.dataValidation=!0,this.finalUpload=!1,this.interval=setInterval(this.checkStatus,4e4)},finishValidation:function(validationBoolean){validationBoolean&&(this.dataValidation=!1,this.loadFinal(this.importProcessContext))},loadFinal:function(data){this.importProcessContext=data.importProcessContext?data.importProcessContext:data,this.dataValidation=!1,this.finalUpload=!0},moveToBegin:function(){this.$router.go(this.$route.path)},finalDone:function(){this.finalUpload=!1,this.uploadPage=!0,this.importProcessContext=this.initialImportContext},continueImport:function(importContext){var _this=this;this.historyPageVisibility=!this.historyPageVisibility,this.importProcessContext=importContext,1===importContext.status?(this.importProcessContext.firstRow=JSON.parse(this.importProcessContext.firstRowString),this.moveToFieldMapping()):5===importContext.status?this.importProcessContext.templateId&&this.$http.post("/v2/importTemplate/fetchTemplateForId",{templateId:this.importProcessContext.templateId}).then((function(_ref){var _ref$data=_ref.data,responseCode=_ref$data.responseCode,result=_ref$data.result,message=_ref$data.message;if(0!==responseCode)throw new Error(message);var importTemplateContext=result.importTemplateContext;_this.setTimeFormatFromTemplate(importTemplateContext),_this.dataValidation=!0,_this.uploadPage=!1,_this.fieldMapping=!1,_this.finalUpload=!1})).catch((function(_ref2){var message=_ref2.message;_this.$message.error(message)})):6===importContext.status&&(this.dataValidation=!0,this.uploadPage=!1,this.fieldMapping=!1,this.finalUpload=!1)},setTimeFormatFromTemplate:function(template){var fieldMapping=JSON.parse(template.fieldMappingString);for(var keys in Object.keys(fieldMapping)){var field=Object.keys(fieldMapping)[keys],columnName=fieldMapping[Object.keys(fieldMapping)[keys]];"sys__ttime"===field&&(this.timeFormat=this.$getProperty(template,"templateMetaJSON.dateFormats.".concat(columnName),"Timestamp"))}},goToAppDownload:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$API$get,data,error,appList,appObj;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,api/* API */.bl.get("/v2/application/list");case 2:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this2.$message.error(error.message||"Error Occured"):(appList=(null===data||void 0===data?void 0:data.application)||[],appObj=appList.find((function(value){return"dataloader"===value.linkName})),_this2.$router.push("/app/setup/general/portal/summary/".concat(appObj.id)));case 6:case"end":return _context.stop()}}),_callee)})))()}}},module_import_NewReadingsImportvue_type_script_lang_js=NewReadingsImportvue_type_script_lang_js,NewReadingsImport_component=(0,componentNormalizer/* default */.Z)(module_import_NewReadingsImportvue_type_script_lang_js,render,staticRenderFns,!1,null,"12459a19",null)
/* harmony default export */,NewReadingsImport=NewReadingsImport_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/90746.js.map