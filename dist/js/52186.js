"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[52186],{
/***/352186:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return Imagecard}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/widget/cards/Imagecard.vue?vue&type=template&id=6a5c236b
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.localLoading?_vm._e():_c("div",{staticClass:"dragabale-card imagecard"},[_vm.url&&_vm.scaledSize&&_vm.imageAreas?[_c("img",{staticClass:"card-img",attrs:{usemap:"#"+_vm.imagecardData.photoId,src:_vm.url,width:_vm.scaledSize.width,height:_vm.scaledSize.height}}),_c("map",{attrs:{name:_vm.imagecardData.photoId}},_vm._l(_vm.imageAreas,(function(area,index){return _c("area",{key:index,attrs:{shape:area.type,coords:_vm.getAreaCoords(area),alt:area.link.alt},on:{click:function($event){return _vm.openArea(area)}}})})),0)]:_vm.url&&_vm.scaledSize?_c("img",{class:{"old-card-img":_vm.isOldImage},attrs:{src:_vm.url,width:_vm.scaledSize.width,height:_vm.scaledSize.height}}):_vm._e()],2)},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),Imagecardvue_type_script_lang_js=(__webpack_require__(169358),__webpack_require__(670560),__webpack_require__(737960),{props:["widget","config"],data:function(){return{imagecardData:null,imageAreas:null,url:null,loading:!1,oldScaledSize:null,scaledSize:null,isOldImage:!1,localLoading:!1}},mounted:function(){this.widget&&this.widget.dataOptions&&this.widget.dataOptions.imagecardData?(this.imagecardData=this.widget.dataOptions.imagecardData?this.widget.dataOptions.imagecardData:null,this.url=this.widget.dataOptions.imagecardData.url?this.widget.dataOptions.imagecardData.url:null,this.imagecardData&&this.imagecardData.options||(this.isOldImage=!0),this.setImageAreas(),this.loadImage()):this.loadCardData()},watch:{"config.width":function(){this.loadImage()},"config.height":function(){this.loadImage()},"config.editwidget":{
// need to be removed
handler:function(newData,oldData){if(this.widget.id>-1&&this.config.selectedWidgetId===this.widget.id&&newData!==oldData&&(this.localLoading=!0,this.widget.dataOptions&&this.widget.dataOptions.metaJson)){this.imagecardData=JSON.parse(this.widget.dataOptions.metaJson);var oldScaledSize=this.imagecardData&&this.imagecardData.options&&this.imagecardData.options.imageMeta&&this.imagecardData.options.imageMeta.scaledSize?this.imagecardData.options.imageMeta.scaledSize:this.oldScaledSize;this.setImageAreas(),this.resizeMap(oldScaledSize,this.scaledSize)}},deep:!0},widget:{handler:function(newData,oldData){if(this.widget.dataOptions&&this.widget.dataOptions.metaJson){this.localLoading=!0,this.imagecardData=JSON.parse(this.widget.dataOptions.metaJson);var oldScaledSize=this.imagecardData&&this.imagecardData.options&&this.imagecardData.options.imageMeta&&this.imagecardData.options.imageMeta.scaledSize?this.imagecardData.options.imageMeta.scaledSize:this.oldScaledSize;this.setImageAreas(),this.resizeMap(oldScaledSize,this.scaledSize)}},deep:!0}},methods:{loadCardData:function(){var self=this,params={widgetId:this.widget.id};self.loading=!0,self.$http.post("dashboard/getCardData",params).then((function(response){response.data.cardResult.widget&&response.data.cardResult.widget.metaJson?(self.imagecardData=JSON.parse(response.data.cardResult.widget.metaJson),self.setImageAreas()):self.isOldImage=!0,self.url=response.data.cardResult&&response.data.cardResult.result?response.data.cardResult.result:null,self.loadImage(),self.loading=!1})).catch((function(error){}))},setImageAreas:function(){if(this.imagecardData&&this.imagecardData.options&&this.imagecardData.options.areas&&this.imagecardData.options.areas.length){var _step,areaList=[],_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.imagecardData.options.areas);try{for(_iterator.s();!(_step=_iterator.n()).done;){var area=_step.value;areaList.push({x:area.x,y:area.y,width:area.width,height:area.height,link:area.link})}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.imageAreas=areaList}else this.imagecardData&&this.imagecardData.options&&this.imagecardData.options.areas&&0===this.imagecardData.options.areas.length&&(this.imageAreas=[]);this.localLoading=!1},loadImage:function(){var _this=this,scaleSize={width:this.$el.offsetWidth,height:this.$el.offsetHeight};if(scaleSize.width||(scaleSize.width=this.config.actualWidth),scaleSize.height||(scaleSize.height=this.config.actualHeight),this.imagecardData&&this.imagecardData.options&&this.imagecardData.options.imageMeta){var originalSize=this.imagecardData.options.imageMeta.originalSize;this.oldScaledSize=this.scaledSize?this.scaledSize:this.imagecardData.options.imageMeta.scaledSize,this.scaledSize=this.scaleImage(scaleSize,originalSize),this.resizeMap(this.oldScaledSize,this.scaledSize)}else{var temp=new Image;temp.src=this.url,temp.onload=function(){_this.scaledSize=_this.scaleImage(scaleSize,{width:_this.width,height:_this.height})}}},getAreaCoords:function(area){return area.x+","+area.y+","+(area.x+area.width)+","+(area.y+area.height)},openArea:function(area){if(this.$mobile){if(this.$mobile&&"url"===area.link.type){var drillDowndata={path:area.link.url,type:"url"};this.$helpers.sendToMobile(drillDowndata)}}else if("popup"===area.link.target&&this.$popupView)this.$popupView.openPopup(area.link);else{var urlToLoad=null;"url"===area.link.type?urlToLoad=area.link.url:"report"===area.link.type?urlToLoad=window.location.origin+"/app/em/reports/newview/"+area.link.reportId:"dashboard"===area.link.type&&(urlToLoad=window.location.origin+"/app/em/newdashboard/"+area.link.dashboardId),urlToLoad&&window.open(urlToLoad,area.link.target)}},scaleImage:function(scaleSize,originalSize){var maxWidth=scaleSize.width,maxHeight=scaleSize.height,ratio=0,width=originalSize.width,height=originalSize.height;
// Check if the current width is larger than the max
return width>maxWidth&&(ratio=maxWidth/width,height*=ratio,// Reset height to match scaled image
width*=ratio),
// Check if current height is larger than max
height>maxHeight&&(ratio=maxHeight/height,// get ratio for scaling image
width*=ratio,// Reset width to match scaled image
height*=ratio),{width:width,height:height}},resizeMap:function(oldSize,newSize){if(this.imageAreas){var oldWidth=oldSize&&oldSize.width?oldSize.width:null,newWidth=newSize&&newSize.width?newSize.width:null,oldHeight=oldSize&&oldSize.height?oldSize.height:null,newHeight=newSize&&newSize.height?newSize.height:null;if(oldWidth&&newWidth&&oldHeight&&newHeight){var _step2,wPercent=newSize.width/oldSize.width,hPercent=newSize.height/oldSize.height,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(this.imageAreas);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var rect=_step2.value;rect.x=rect.x*wPercent,rect.width=rect.width*wPercent,rect.y=rect.y*hPercent,rect.height=rect.height*hPercent}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}}}}),cards_Imagecardvue_type_script_lang_js=Imagecardvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(cards_Imagecardvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,Imagecard=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/52186.js.map