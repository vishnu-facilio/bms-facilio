"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[13185],{
/***/813185:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return WeatherTable}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/site/WeatherTable.vue?vue&type=template&id=6c7c5e65&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{ref:"hourly-weather-table",staticClass:"site-weather-table"},[_c("div",{staticClass:"site-weather-table-header p20 pT15 pB15 border-bottom14"},[_c("p",{staticClass:"f18 bold mB0"},[_vm._v(" "+_vm._s(_vm.$t("space.sites.weather.hourly_forecast"))+" ")])]),_c("div",{staticClass:"site-weather-table-body height100"},[_vm.isLoading?_c("div",{staticClass:"loading-container d-flex justify-content-center height100"},[_c("spinner",{attrs:{show:_vm.isLoading}})],1):_vm.$validation.isEmpty(_vm.weatherDataTimeList)?_c("div",{staticClass:"analytics-report-empty-state height100 fc-align-center-column"},[_c("inline-svg",{attrs:{src:"svgs/emptystate/reportlist",iconClass:"icon text-center icon-200"}}),_c("div",{staticClass:"nowo-label f13"},[_vm._v(" "+_vm._s(_vm.$t("space.sites.weather.no_table_data"))+" ")])],1):[_vm.$validation.isEmpty(_vm.weatherDataTimeList)?_vm._e():_c("el-collapse",{ref:"el-collapse-container",attrs:{accordion:""},on:{change:_vm.handleRowClick},model:{value:_vm.activeRow,callback:function($$v){_vm.activeRow=$$v},expression:"activeRow"}},_vm._l(_vm.weatherDataTimeList,(function(time,index){return _c("el-collapse-item",{key:index,attrs:{name:index}},[_c("template",{slot:"title"},[_c("div",{staticClass:"site-weather-table-row-header height100 width100"},[_vm.activeRow!==index?_c("el-row",{staticClass:"flex-middle",attrs:{gutter:40}},[_c("el-col",{attrs:{span:3}},[_c("div",{staticClass:"time"},[_vm._v(_vm._s(_vm.getFormatedTime(time)))])]),_c("el-col",{attrs:{span:6}},[_c("div",{staticClass:"weather-summary flex-middle"},[_c("fc-icon",{attrs:{group:"default",name:_vm.getCurrentWeatherData(time,"icon"),size:"20"}}),_c("p",{staticClass:"inline-block f14 fw4 m0 pL10 truncate-text"},[_vm._v(" "+_vm._s(_vm.getCurrentWeatherData(time,"summary"))+" ")])],1)]),_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"temperature flex-middle"},[_c("fc-icon",{attrs:{group:"default",name:"temp",size:"20"}}),_c("p",{staticClass:"inline-block f14 fw4 m0 pL10 truncate-text"},[_vm._v(" "+_vm._s(_vm.getCurrentWeatherData(time,"temperature"))+" ")])],1)]),_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"wind-speed flex-middle"},[_c("fc-icon",{attrs:{group:"default",name:"wind",size:"20"}}),_c("p",{staticClass:"inline-block f14 fw4 m0 pL10 truncate-text"},[_vm._v(" "+_vm._s(_vm.getCurrentWeatherData(time,"windSpeed"))+" ")])],1)]),_c("el-col",{attrs:{span:5}},[_c("div",{staticClass:"humidity flex-middle"},[_c("fc-icon",{attrs:{group:"default",name:"humidity",size:"20"}}),_c("p",{staticClass:"inline-block f14 fw4 m0 pL10 truncate-text"},[_vm._v(" "+_vm._s(_vm.getCurrentWeatherData(time,"humidity"))+" ")])],1)])],1):[_c("div",{staticClass:"height100 width100 flex"},[_c("div",[_c("fc-icon",{staticClass:"mT10",attrs:{group:"default",name:_vm.getCurrentWeatherData(time,"icon"),size:"40",color:"#3ab2c2"}})],1),_c("div",{staticClass:"mL20 flex-center-vH"},[_c("p",{staticClass:"m0 f14 fw4 primary-font"},[_vm._v(" "+_vm._s(_vm.getFormatedTime(time))+" ")]),_c("p",{staticClass:"m0 f16 bold primary-font"},[_vm._v(" "+_vm._s(_vm.getCurrentWeatherData(time,"summary"))+" ")])])])]],2)]),_c("div",{staticClass:"site-weather-table-row-expand"},_vm._l(_vm.requiredReadingFields,(function(reading,index){return _c("div",{key:index,staticClass:"temperature weather-content-box"},[_c("div",{staticClass:"reading-name-row"},[_c("fc-icon",{staticClass:"inline-block height20 facilio-icon-cont",attrs:{group:"default",name:reading.icon,size:"18"}}),_c("p",{staticClass:"inline-block f14 fw4 m0 pL10"},[_vm._v(" "+_vm._s(reading.label)+" ")])],1),_c("p",{staticClass:"pL30 m0 f18 bold"},[_vm._v(" "+_vm._s(_vm.getCurrentWeatherData(time,reading.key))+" ")])])})),0)],2)})),1)]],2)])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),api=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(648324),__webpack_require__(634338),__webpack_require__(32284)),validation=__webpack_require__(990260),helpers=__webpack_require__(778390),WeatherUtils=__webpack_require__(62561),WeatherTablevue_type_script_lang_js={props:["details"],data:function(){return{WEATHER_ICONS:WeatherUtils/* WEATHER_ICONS */.Wf,isLoading:!1,rowExpanded:!1,activeRow:"",stationId:-1,weatherData:{},weatherReadingFields:{},weatherModule:{},weatherDataTimeList:[],requiredReadingFields:[{key:"temperature",label:"Temperature",icon:"temp"},{key:"dewPoint",label:"Dew Point",icon:"dew-point"},{key:"windSpeed",label:"Wind Speed",icon:"wind"},{key:"visibility",label:"Visibility",icon:"visibility"},{key:"uvIndex",label:"UV Index",icon:"uv-index"},{key:"pressure",label:"Pressure",icon:"pressure"},{key:"humidity",label:"Humidity",icon:"humidity"}]}},computed:{},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.getStationAndLoadData();case 2:_this.$nextTick((function(){_this.resizeTableHeight({})}));case 3:case"end":return _context.stop()}}),_callee)})))()},methods:{getStationAndLoadData:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var siteId,_yield$API$get,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this2.isLoading=!0,siteId=_this2.$getProperty(_this2,"details.id"),_context2.prev=2,_context2.next=5,api/* API */.bl.get("v3/weather/sitestationid",{siteId:siteId});case 5:_yield$API$get=_context2.sent,data=_yield$API$get.data,error=_yield$API$get.error,_this2.stationId=error?-1:_this2.$getProperty(data,"stationId",-1),_context2.next=14;break;case 11:_context2.prev=11,_context2.t0=_context2["catch"](2),_this2.stationId=-1;case 14:if((0,validation/* isEmpty */.xb)(_this2.stationId)){_context2.next=19;break}return _context2.next=17,_this2.loadModuleMeta("newWeather");case 17:return _context2.next=19,_this2.loadWeatherData();case 19:_this2.isLoading=!1;case 20:case"end":return _context2.stop()}}),_callee2,null,[[2,11]])})))()},loadModuleMeta:function(moduleName){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$API$get2,data,error,_ref,meta,_ref2,_ref2$fields,fields,module,fieldsMap;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,api/* API */.bl.get("/module/meta",{moduleName:moduleName});case 3:_yield$API$get2=_context3.sent,data=_yield$API$get2.data,error=_yield$API$get2.error,error?(_this3.weatherModule={},_this3.weatherReadingFields={}):(_this3.weatherModule={},_this3.weatherReadingFields={},(0,validation/* isEmpty */.xb)(data)||(_ref=data||{},meta=_ref.meta,_ref2=meta||{},_ref2$fields=_ref2.fields,fields=void 0===_ref2$fields?[]:_ref2$fields,module=_ref2.module,fieldsMap={},fields.forEach((function(field){fieldsMap[field.name]=field})),_this3.weatherReadingFields=fieldsMap,_this3.weatherModule=module)),_context3.next=13;break;case 9:_context3.prev=9,_context3.t0=_context3["catch"](0),_this3.weatherModule={},_this3.weatherReadingFields={};case 13:case"end":return _context3.stop()}}),_callee3,null,[[0,9]])})))()},loadWeatherData:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var _this4$weatherReading,weatherReadingFields,stationId,startTime,endTime,fetchFields,fields,params,_yield$API$get3,error,data,_this4$weatherData,weatherData,_this4$weatherDataTim,weatherDataTimeList,dataList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(_this4$weatherReading=_this4.weatherReadingFields,weatherReadingFields=void 0===_this4$weatherReading?{}:_this4$weatherReading,stationId=_this4.stationId,startTime=_this4.$helpers.getOrgMoment().valueOf(),endTime=_this4.$helpers.getOrgMoment().valueOf()+432e5,fetchFields=["temperature","dewPoint","windSpeed","visibility","uvIndex","pressure","humidity","precipitationProbability","icon","summary"],(0,validation/* isEmpty */.xb)(weatherReadingFields)){_context4.next=15;break}return fields=[],fetchFields.forEach((function(fetchField){var _weatherReadingFields=weatherReadingFields[fetchField],name=_weatherReadingFields.displayName,dataType=_weatherReadingFields.dataType,fieldId=_weatherReadingFields.fieldId,actual=_weatherReadingFields.name;"icon"===fetchField&&(dataType=2);var aggr="summary"===fetchField?4:2,field={parentId:[stationId],name:name,yAxis:{dataType:dataType,fieldId:fieldId,aggr:aggr},aliases:{actual:actual},type:1,duplicateDataPoint:!1};fields.push(field)})),fields=JSON.stringify(fields),params={mode:1,startTime:startTime,endTime:endTime,fields:fields,xAggr:20,showSafeLimit:!0,analyticsType:6,newFormat:!0},_context4.next=11,api/* API */.bl.get("v2/report/readingReport",params);case 11:_yield$API$get3=_context4.sent,error=_yield$API$get3.error,data=_yield$API$get3.data,error?_this4.$message.error(error.message||"Error Occured"):(0,validation/* isEmpty */.xb)(data)||(_this4$weatherData=_this4.weatherData,weatherData=void 0===_this4$weatherData?{}:_this4$weatherData,_this4$weatherDataTim=_this4.weatherDataTimeList,weatherDataTimeList=void 0===_this4$weatherDataTim?[]:_this4$weatherDataTim,dataList=_this4.$getProperty(data,"reportData.data",[]),dataList.forEach((function(dataPoint){(0,validation/* isEmpty */.xb)(null===dataPoint||void 0===dataPoint?void 0:dataPoint.X)||(weatherDataTimeList.push(dataPoint.X),weatherData[dataPoint.X]=dataPoint)})));case 15:case"end":return _context4.stop()}}),_callee4)})))()},getCurrentWeatherData:function(time,key){var WEATHER_ICONS=this.WEATHER_ICONS,_ref3=this.weatherReadingFields[key]||{},_ref3$unit=_ref3.unit,unit=void 0===_ref3$unit?"":_ref3$unit;unit=(0,validation/* isEmpty */.xb)(unit)?"":unit;var _this$weatherData=this.weatherData,weatherData=void 0===_this$weatherData?{}:_this$weatherData,_weatherData$time=weatherData[time],currentWeatherGroup=void 0===_weatherData$time?{}:_weatherData$time;if(!(0,validation/* isEmpty */.xb)(currentWeatherGroup[key])){if("icon"===key){var IconKey=currentWeatherGroup[key]||"default";return IconKey=Math.floor(IconKey),WEATHER_ICONS[IconKey]}return"".concat(currentWeatherGroup[key]," ").concat(unit)}return"icon"===key?WEATHER_ICONS["default"]:"---"},getFormatedTime:function(timeStamp){return(0,helpers/* getTimeInOrgFormat */.eB)(timeStamp)},handleRowClick:function(activeName){(0,validation/* isEmpty */.xb)(activeName)?(this.resizeTableHeight({showMore:!1}),this.rowExpanded=!1):(this.resizeTableHeight({showMore:!0}),this.rowExpanded=!0)},resizeTableHeight:function(_ref4){var showMore=_ref4.showMore,container=this.$refs["el-collapse-container"],containerElement=null===container||void 0===container?void 0:container.$el;if(containerElement){var height=containerElement.scrollHeight+65,width=containerElement.scrollWidth;this.rowExpanded||(0,validation/* isEmpty */.xb)(showMore)||!showMore||(height+=245),(0,validation/* isEmpty */.xb)(showMore)||showMore||(height-=245),height=height<=370?370:height,this.$attrs.resizeWidget({height:height,width:width})}}}},site_WeatherTablevue_type_script_lang_js=WeatherTablevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(site_WeatherTablevue_type_script_lang_js,render,staticRenderFns,!1,null,"6c7c5e65",null)
/* harmony default export */,WeatherTable=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/13185.js.map