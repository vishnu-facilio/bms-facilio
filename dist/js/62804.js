"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[62804],{
/***/756974:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return CardBuilderDashboardMixin}});
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
var render,staticRenderFns,objectSpread2=__webpack_require__(595082),validation=(__webpack_require__(670560),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(990260)),CardBuilderDashboardMixinvue_type_script_lang_js={data:function(){return{selectedCardData:null,selectedWidgetConfig:null,isDuplicate:!1}},methods:{openNewCardBuilder:function(){this.showCardBuilderSetup=!0},onCardSave:function(data){var layout=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.addCardToDashboard(data,layout),this.isDraging=!1,this.showCardBuilderSetup=!1,this.isDuplicate=!1},onCardDuplicate:function(data){var layout=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.duplicateCardToDashboard(data,layout),this.isDraging=!1,this.showCardBuilderSetup=!1,this.isDuplicate=!1},onCardUpdate:function(data){var selectedCardData=this.selectedCardData;this.updateCardInDashboard(selectedCardData.id,data.cardContext),this.onBuilderClosed(),this.isDuplicate=!1},onBuilderClosed:function(){this.selectedCardData=null,this.cancelBuilding()},deleteCard:function(data){this.isDuplicate=!1,this.removeChartList.push(data);var index=this.dashboardLayout.findIndex((function(r){return r.widget.id===data.widgetId}));(0,validation/* isEmpty */.xb)(index)||this.dashboardLayout.splice(index,1)},editCard:function(widget,widgetConfig){this.selectedCardData=widget,this.selectedWidgetConfig=widgetConfig,this.showCardBuilderSetup=!0,this.isDuplicate=!1},duplicate:function(widget,widgetConfig){this.isDuplicate=!1,this.selectedCardData=widget,this.selectedWidgetConfig=widgetConfig,this.showCardBuilderSetup=!0,this.isDuplicate=!0},duplicateCardToDashboard:function(data,layoutParams){this.dashboardlength=this.dashboardlength+1;var layoutProp=this.selectedWidgetConfig,layout={i:this.dashboardlength+"",x:layoutProp.x,y:layoutProp.y+layoutProp.h,w:layoutProp.w,h:layoutProp.h,minW:layoutProp.minW,minH:layoutProp.minH,widget:{dataOptions:data.cardContext,type:"card",id:-1}};this.dashboardLayout.push(layout)},addCardToDashboard:function(data,layoutParams){this.dashboardlength=this.dashboardlength+1,(0,validation/* isEmpty */.xb)(layoutParams)&&(layoutParams={w:24,h:12});var layout={i:this.dashboardlength+"",x:0,y:0,w:layoutParams.w,h:layoutParams.h,minW:layoutParams.w,minH:layoutParams.h,widget:{dataOptions:data.cardContext,type:"card",id:-1}};this.dashboardLayout.push(layout)},updateCardInDashboard:function(id,cardContext){var _this=this,selectedCard=null;if(selectedCard=id<0&&!(0,validation/* isEmpty */.xb)(this.selectedWidgetConfig)?this.dashboardLayout.find((function(gridItem){return gridItem.i===_this.selectedWidgetConfig.i})):this.dashboardLayout.find((function(gridItem){return gridItem.widget.id===id})),!(0,validation/* isEmpty */.xb)(selectedCard)){var _selectedCard=selectedCard,dataOptions=_selectedCard.widget.dataOptions;this.$set(selectedCard.widget,"dataOptions",(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},dataOptions),cardContext),{},{hasEdited:!0}))}},canResizeCard:function(cardContext){if(!cardContext)return!1;var cardState=cardContext.cardState;return!((0,validation/* isEmpty */.xb)(cardState)||!cardState.hasOwnProperty("canResize"))&&cardState.canResize}}},components_CardBuilderDashboardMixinvue_type_script_lang_js=CardBuilderDashboardMixinvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_CardBuilderDashboardMixinvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,CardBuilderDashboardMixin=component.exports;
// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.push.js
},
/***/585081:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return DashboardTopTab}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/DashboardTopTab.vue?vue&type=template&id=8e3f2984
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.loading?_vm._e():_c("div",{staticClass:"dashboard-top-bar pointer inline-flex self-center "},[_c("div",{staticClass:"inline-flex"},_vm._l(_vm.mainTabs,(function(tab,index){return _c("div",{key:index},[tab.childTabs&&tab.childTabs.length?_c("div",{directives:[{name:"popover",rawName:"v-popover",value:"popover-"+tab.id,expression:"`popover-${tab.id}`"}],staticClass:"db-tab-cell",class:{active:_vm.getTabActiveClass(tab)},on:{click:function($event){return _vm.mainTabChange(tab)}}},[_vm._v(" "+_vm._s(_vm.getTabName(tab))+" "),_c("i",{staticClass:"el-icon-arrow-down pL15"})]):_c("div",{staticClass:"db-tab-cell",class:{active:tab.id===_vm.dashboardTabId},on:{click:function($event){return _vm.mainTabChange(tab)}}},[_vm._v(" "+_vm._s(tab.name)+" ")]),_c("el-popover",{ref:"popover-"+tab.id,refInFor:!0,attrs:{placement:"bottom",trigger:"hover","visible-arrow":!1,"after-enter":_vm.childTabChange,"popper-class":"inventory-list-popover-1 fc-dashboard-tab-popup"}},[_c("div",{staticClass:"db-childtab-cell ellipsis",class:{active:tab.id===_vm.dashboardTabId},on:{click:function($event){_vm.closepopver(tab.id),_vm.mainTabChange(tab)}}},[_vm._v(" "+_vm._s(tab.name)+" "),tab.id===_vm.dashboardTabId?_c("div",{staticClass:"pull-right"},[_c("i",{staticClass:"el-icon-check",staticStyle:{color:"green"}})]):_vm._e()]),_vm._l(tab.childTabs,(function(childTab,cId){return[_c("div",{key:cId,staticClass:"db-childtab-cell ellipsis",class:{active:childTab.id===_vm.dashboardTabId},on:{click:function($event){_vm.closepopver(tab.id),_vm.mainTabChange(childTab)}}},[_vm._v(" "+_vm._s(childTab.name)+" "),childTab.id===_vm.dashboardTabId?_c("div",{staticClass:"pull-right"},[_c("i",{staticClass:"el-icon-check",staticStyle:{color:"green"}})]):_vm._e()])]}))],2)],1)})),0),_c("el-popover",{ref:"more-popover",attrs:{placement:"bottom",trigger:"hover","visible-arrow":!1,"popper-class":"inventory-list-popover-1 fc-dashboard-more-tab-popup"}},[_c("el-cascader-panel",{attrs:{options:_vm.moreTabsCascadeData},on:{change:_vm.moreTabChange,"expand-change":_vm.expandChange},model:{value:_vm.moreTabSelectedDashboard,callback:function($$v){_vm.moreTabSelectedDashboard=$$v},expression:"moreTabSelectedDashboard"}})],1),_c("div",{directives:[{name:"popover",rawName:"v-popover",value:"more-popover",expression:"`more-popover`"}],staticClass:"self-center "},[_vm.moreTabs.length?_c("i",{staticClass:"el-icon-more p15 border-right"}):_vm._e()]),_vm.edit?_c("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",animation:"shift-away",arrow:!0},expression:"{\n        placement: 'top',\n        animation: 'shift-away',\n        arrow: true,\n      }"}],staticClass:"self-center p15",attrs:{title:_vm.$t("home.dashboard.tab_manager")},on:{click:function($event){return _vm.toggleDashboardTabEditor()}}},[_c("i",{staticClass:"el-icon-setting"})]):_vm._e()],1)])},staticRenderFns=[],objectSpread2=__webpack_require__(595082),DashboardTopTabvue_type_script_lang_js=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(425728),{props:["dashboardTabContexts","dashboardTabId","edit"],data:function(){return{mainTabs:[],moreTabs:[],tabLimit:5,loading:!1,moreTabSelectedDashboard:[]}},computed:{moreTabsCascadeData:function(){var _this=this,moreTabs=this.moreTabs;if(moreTabs&&moreTabs.length){var data=[];return moreTabs.forEach((function(folder){var d=(0,objectSpread2/* default */.Z)({value:folder.id,label:folder.name},folder);if(folder.childTabs&&folder.childTabs.length){var c=[];folder.childTabs.forEach((function(tab){var t=(0,objectSpread2/* default */.Z)({value:tab.id,label:tab.name},tab);c.push(t)})),_this.$set(d,"children",c)}data.push(d)})),data}return[]}},watch:{dashboardTabContexts:function(){this.splitTabList()}},mounted:function(){this.splitTabList(),this.selectDefaultMoreTab()},methods:{selectDefaultMoreTab:function(){var _this2=this;this.moreTabsCascadeData.length&&this.moreTabsCascadeData.forEach((function(tab){tab.id===_this2.dashboardTabId?_this2.moreTabSelectedDashboard.push(tab.id):null!==tab&&void 0!==tab&&tab.children&&tab.children.length&&tab.children.forEach((function(children){children.id===_this2.dashboardTabId&&(_this2.moreTabSelectedDashboard=[tab.id,children.id])}))}))},mainTabChange:function(tab){this.changeDashboardTabId(tab.id),this.moreTabSelectedDashboard=[]},expandChange:function(value){this.changeDashboardTabId(value[0])},moreTabChange:function(value){value&&1===value.length?this.changeDashboardTabId(value[0]):value&&2===value.length&&this.changeDashboardTabId(value[1])},getTabActiveClass:function(tab){var _this3=this;return tab.id===this.dashboardTabId||!!(tab.childTabs&&tab.childTabs.length&&tab.childTabs.findIndex((function(t){return t.id===_this3.dashboardTabId}))>-1)},switchTabs:function(tab){var lastTab=[];lastTab=this.$helpers.cloneObject(this.mainTabs[this.mainTabs.length-1]);var firstTab=[],selectedTabIndex=this.moreTabs.findIndex((function(rt){return rt.id===tab.id}));firstTab=this.$helpers.cloneObject(tab),this.mainTabs.splice(this.mainTabs.length-1,1,firstTab),this.moreTabs.splice(selectedTabIndex,1,lastTab)},closemoreTab:function(){this.$refs["more-popover"].showPopper=!1},splitTabList:function(){var _this4=this;this.loading=!0;var dashboardTabContexts=this.dashboardTabContexts,tabLimit=this.tabLimit;dashboardTabContexts&&dashboardTabContexts.length>tabLimit?(this.mainTabs=[],this.moreTabs=[],dashboardTabContexts.forEach((function(tab,index){index<tabLimit?_this4.mainTabs.push(tab):_this4.moreTabs.push(tab)}))):this.mainTabs=dashboardTabContexts,this.loading=!1},getTabName:function(tab){var _this5=this;if(tab&&tab.childTabs&&tab.childTabs.length&&this.isTabSwitched(tab)){var childTab=tab.childTabs.find((function(rt){return rt.id===_this5.dashboardTabId}));if(childTab)return childTab.name}return tab.name},isTabSwitched:function(tab){var _this6=this;if(tab.id===this.dashboardTabId)return!1;if(tab.childTabs&&tab.childTabs.length){var childTab=tab.childTabs.find((function(rt){return rt.id===_this6.dashboardTabId}));if(childTab)return!0}return!1},closepopver:function(id){id&&(this.$refs["popover-".concat(id)][0].showPopper=!1)},changeDashboardTabId:function(tabId){this.$emit("changeDashboardTabId",tabId)},toggleDashboardTabEditor:function(){this.$emit("toggleDashboardTabEditor")},childTabChange:function(){}}}),dashboard_DashboardTopTabvue_type_script_lang_js=DashboardTopTabvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(dashboard_DashboardTopTabvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,DashboardTopTab=component.exports},
/***/638433:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FWidget}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/widget/FWidget.vue?vue&type=template&id=7104e4fa
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:!!_vm.isLazyDashboard&&_vm.handleViewportVisibilityChange,expression:"\n    isLazyDashboard ? handleViewportVisibilityChange : false\n  "}],staticClass:"fc-widget",staticStyle:{width:"100%",height:"100%"},style:_vm.widget.type&&"static"===_vm.widget.type&&("profilecard"===_vm.widget.dataOptions.staticKey||"weathercard"===_vm.widget.dataOptions.staticKey||"energycard"===_vm.widget.dataOptions.staticKey||"energycostaltayer"===_vm.widget.dataOptions.staticKey||"weathercardaltayer"===_vm.widget.dataOptions.staticKey||"cumulativesavings"===_vm.widget.dataOptions.staticKey||"weathermini"===_vm.widget.dataOptions.staticKey||"profilemini"===_vm.widget.dataOptions.staticKey||"carbonmini"===_vm.widget.dataOptions.staticKey||"energycostmini"===_vm.widget.dataOptions.staticKey||"readingcard"===_vm.widget.dataOptions.staticKey||"readingWithGraphCard"===_vm.widget.dataOptions.staticKey||"readingGaugeCard"===_vm.widget.dataOptions.staticKey||"readingComboCard"===_vm.widget.dataOptions.staticKey||"fcucard"===_vm.widget.dataOptions.staticKey||_vm.widget.dataOptions.staticKey.includes("emrilllevel")||"emrillFcu"===_vm.widget.dataOptions.staticKey||"emrillFcuList"===_vm.widget.dataOptions.staticKey||"resourceAlarmBar"===_vm.widget.dataOptions.staticKey||"kpiCard"===_vm.widget.dataOptions.staticKey)?"border:0px":"border:solid 1px #eae8e8",attrs:{id:_vm.widget.id?_vm.widget.id:-1}},[_vm.viewHeader(_vm.widget.header)?_c("div",{staticClass:"row fc-widget-header"},[_c("div",{staticClass:"col-8",staticStyle:{overflow:"hidden"}},[_vm.mode&&_vm.changeheader?_c("el-input",{staticClass:"create-dashboard-input-title f18 fc-widget-label ellipsis",attrs:{autofocus:!0,placeholder:""},on:{blur:function($event){return _vm.blurevent()},change:function($event){return _vm.titlechage()}},model:{value:_vm.widget.header.title,callback:function($$v){_vm.$set(_vm.widget.header,"title",$$v)},expression:"widget.header.title"}}):_c("div",{staticClass:"f18 fc-widget-label ellipsis",on:{dblclick:function($event){return _vm.editheader("edit")}}},[_vm._v(" "+_vm._s(_vm.widget.header.title)+" ")]),_vm.widget.header.subtitle?_c("div",{staticClass:"fc-widget-sublabel"},[_vm._v(" "+_vm._s(_vm.setSubTitle||_vm.emptyTitle)+" ")]):_c("div",{staticClass:"fc-widget-sublabel"},[_vm._v(_vm._s(_vm.emptyTitle))])],1),"static"==_vm.widget.type||_vm.isReadOnly?_vm._e():_c("div",{staticClass:"col-4"},["f-newchart-widget"===_vm.widgetType||"f-modular-report-widget"===_vm.widgetType||"f-newchart-widget-optimize"===_vm.widgetType||"PivotTableWrapper"===_vm.widgetType?_c("div",[_c("el-popover",{key:_vm.widget.id?_vm.widget.id:-1,attrs:{"popper-class":"fc-widget-more-options",placement:"bottom",width:"200",trigger:"click"},model:{value:_vm.newWidgetOptionsPopoverToggle,callback:function($$v){_vm.newWidgetOptionsPopoverToggle=$$v},expression:"newWidgetOptionsPopoverToggle"}},[_vm.mode||_vm.showFilterConfig?_vm._e():_c("div",{staticClass:"fc-widget-view-options"},[_vm.isOperationsApp?_vm._e():[_vm.isPortalApp?_vm._e():_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openReport(_vm.widget.dataOptions.reportId,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.go_to_report"))+" ")]),"f-modular-report-widget"!==_vm.widgetType||_vm.isPortalApp?_vm._e():_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openInAnalytics(_vm.widget.dataOptions.newReportId,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.edit_report"))+" ")]),"PivotTableWrapper"!==_vm.widgetType||_vm.isPortalApp?_vm._e():_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openInPivotBuilder(_vm.widget.dataOptions.newReportId)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.edit_report"))+" ")]),"f-newchart-widget"!==_vm.widgetType&&"f-newchart-widget-optimize"!==_vm.widgetType||_vm.isPortalApp?_vm._e():_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openInAnalytics(_vm.widget.dataOptions.newReportId,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.explore_in_analytics"))+" ")]),_c("div",{staticClass:"en-divider"})],"f-newchart-widget"===_vm.widgetType||"f-modular-report-widget"===_vm.widgetType||"f-newchart-widget-optimize"===_vm.widgetType||"PivotTableWrapper"===_vm.widgetType?_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.exportAsFile(1,_vm.widget.dataOptions.newReportId,_vm.widget.dataOptions.reportTemplate,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.export_csv"))+" ")]):_vm._e(),"f-newchart-widget"===_vm.widgetType||"f-modular-report-widget"===_vm.widgetType||"f-newchart-widget-optimize"===_vm.widgetType||"PivotTableWrapper"===_vm.widgetType?_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.exportAsFile(2,_vm.widget.dataOptions.newReportId,_vm.widget.dataOptions.reportTemplate,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.export_xcl"))+" ")]):_vm._e(),"f-newchart-widget"===_vm.widgetType||"f-modular-report-widget"===_vm.widgetType||"f-newchart-widget-optimize"===_vm.widgetType?_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.exportAsFile(3,_vm.widget.dataOptions.newReportId,_vm.widget.dataOptions.reportTemplate,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.export_pdf"))+" ")]):_vm._e(),_vm.isTabular||"f-newchart-widget"!==_vm.widgetType&&"f-modular-report-widget"!==_vm.widgetType&&"f-newchart-widget-optimize"!==_vm.widgetType?_vm._e():_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.exportAsFile(4,_vm.widget.dataOptions.newReportId,_vm.widget.dataOptions.reportTemplate,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.export_image"))+" ")]),_vm.isOperationsApp||"PivotTableWrapper"===_vm.widgetType?_vm._e():[_c("div",{staticClass:"en-divider"}),_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){_vm.emailReportVisibility=!0}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.email_this_report"))+" ")])]],2),_vm.mode&&!_vm.showFilterConfig?_c("div",{staticClass:"fc-widget-edit-options"},[_vm.widget&&_vm.widget.dataOptions&&_vm.widget.dataOptions.newReport&&4===_vm.widget.dataOptions.newReport.type?_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.showTemplateReportOptions(_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.report_options"))+" ")]):_vm._e(),_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.deleteChart(_vm.widget,_vm.dashboard)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.remove_widget"))+" ")]),_c("div",{staticClass:"pointer fc-newChart-options-label ",on:{click:_vm.editHelpText}},[_vm._v(" "+_vm._s(_vm.$t("common._common.help_text"))+" ")])]):_vm._e(),_vm.showFilterConfig?_c("div",{staticClass:"fc-widget-filter-config-options"},[_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:_vm.editFilterConfig}},[_vm._v(" "+_vm._s(_vm.$t("dashboardfilters.configure"))+" ")])]):_vm._e(),_c("i",{staticClass:"pointer pull-right  fc-widget-moreicon-vertical fa fa-ellipsis-v",class:[{tabular:_vm.isTabular},{"display-block-important":_vm.isInfoIconPopOverOpen}],attrs:{slot:"reference"},slot:"reference"})]),_vm.mode?_vm._e():_c("div",{staticClass:"pointer pull-right fc-widget-fullScreen",class:[{tabular:_vm.isTabular},{"display-block-important":_vm.isInfoIconPopOverOpen}],on:{click:_vm.expandReport}},[_c("i",{directives:[{name:"tippy",rawName:"v-tippy",value:{arrow:!0,animation:"perspective"},expression:"{ arrow: true, animation: 'perspective' }"}],staticClass:"fa fa-expand",attrs:{title:_vm.$t("common._common.expand"),"data-position":"top"}})]),_vm.showWidgetInfoIcon?_c("el-popover",{staticClass:"widget-info-container",class:{"show-info-icon":_vm.isInfoIconPopOverOpen},attrs:{"popper-class":"widget-info-popper",placement:"bottom",trigger:"click"},model:{value:_vm.isInfoIconPopOverOpen,callback:function($$v){_vm.isInfoIconPopOverOpen=$$v},expression:"isInfoIconPopOverOpen"}},[_c("div",{staticClass:"widget-help-text  space-preline break-normal pT5 pB5 pL10 pR10"},[_vm._v(" "+_vm._s(this.widget.helpText)+" ")]),_c("i",{staticClass:"pointer el-icon-info pull-right mR10 mT2",attrs:{slot:"reference"},slot:"reference"})]):_vm._e(),_c("portal-target",{directives:[{name:"show",rawName:"v-show",value:!_vm.hideTimelineFilterInsideWidget,expression:"!hideTimelineFilterInsideWidget"}],attrs:{name:"widget-datepicker"+_vm.widget.id}})],1):"f-graphics-widget"===_vm.widgetType?_c("div",[_c("el-popover",{attrs:{"popper-class":"fc-widget-more-options",placement:"bottom",width:"200",trigger:"click"},model:{value:_vm.newWidgetOptionsPopoverToggle,callback:function($$v){_vm.newWidgetOptionsPopoverToggle=$$v},expression:"newWidgetOptionsPopoverToggle"}},[_vm.mode?_c("div",{staticClass:"fc-widget-edit-options"},[_vm.widget&&"graphics"===_vm.widget.type?_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openGraphicsOptions(_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("panel.card.graphics_options"))+" ")]):_vm._e(),_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.deleteChart(_vm.widget,_vm.dashboard)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.remove_widget"))+" ")])]):_vm._e(),_vm.mode?_vm._e():_c("div",{staticClass:"fc-widget-view-options"},[_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openGraphics(_vm.widget.dataOptions.graphicsId,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("panel.card.graphics"))+" ")]),_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.openGraphicsInAnalytics(_vm.widget.dataOptions.graphicsId,_vm.widget)}}},[_vm._v(" "+_vm._s(_vm.$t("panel.card.exp_analytics"))+" ")]),_c("div",{staticClass:"en-divider"}),_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.exportGraphicsAsImage(_vm.widget.dataOptions.graphicsId)}}},[_vm._v(" "+_vm._s(_vm.$t("panel.card.exp_img"))+" ")])]),_c("i",{staticClass:"pointer pull-right fc-widget-moreicon-vertical fa fa-ellipsis-v",attrs:{slot:"reference"},slot:"reference"})])],1):_vm.enableRedirect(_vm.widgetType)?_c("div",[_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"pull-right externalLink",attrs:{title:_vm.$t("home.dashboard.open_full_view")}},[_c("img",{staticClass:"chart-icon-report",attrs:{src:__webpack_require__(396295)},on:{click:function($event){return _vm.openReport(_vm.widget.dataOptions.reportId,_vm.widget)}}})]),_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"pull-right chart-icon-hide",attrs:{title:"Hide widget"}})]):"f-view-widget"==_vm.widgetType&&_vm.showFilterConfig?_c("div",[_c("el-popover",{attrs:{"popper-class":"fc-widget-more-options",placement:"bottom",width:"200",trigger:"click"}},[_c("div",{staticClass:"fc-widget-filter-config-options"},[_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:_vm.editFilterConfig}},[_vm._v(" "+_vm._s(_vm.$t("dashboardfilters.configure"))+" ")])]),_c("i",{staticClass:"pointer pull-right fc-widget-moreicon-vertical fa fa-ellipsis-v",attrs:{slot:"reference"},on:{click:function($event){_vm.newWidgetOptionsPopoverToggle=!0}},slot:"reference"})])],1):_vm._e()])]):_vm._e(),_vm.exportDownloadUrl?_c("iframe",{staticStyle:{display:"none"},attrs:{src:_vm.exportDownloadUrl}}):_vm._e(),_c("div",{staticClass:"en-divider",style:_vm.widget.type&&"static"===_vm.widget.type&&("profilecard"===_vm.widget.dataOptions.staticKey||"weathercard"===_vm.widget.dataOptions.staticKey||"energycard"===_vm.widget.dataOptions.staticKey||"energycostaltayer"===_vm.widget.dataOptions.staticKey||"weathercardaltayer"===_vm.widget.dataOptions.staticKey||"cumulativesavings"===_vm.widget.dataOptions.staticKey||"weathermini"===_vm.widget.dataOptions.staticKey||"profilemini"===_vm.widget.dataOptions.staticKey||"carbonmini"===_vm.widget.dataOptions.staticKey||"energycostmini"===_vm.widget.dataOptions.staticKey||"readingcard"===_vm.widget.dataOptions.staticKey||"fahuStatusCard"===_vm.widget.dataOptions.staticKey||"fahuStatusCard1"===_vm.widget.dataOptions.staticKey||"textcard"===_vm.widget.dataOptions.staticKey||"readingWithGraphCard"===_vm.widget.dataOptions.staticKey||"readingGaugeCard"===_vm.widget.dataOptions.staticKey||"readingComboCard"===_vm.widget.dataOptions.staticKey||"fcucard"===_vm.widget.dataOptions.staticKey||_vm.widget.dataOptions.staticKey.includes("emrilllevel")||"emrillFcu"===_vm.widget.dataOptions.staticKey||"emrillFcuList"===_vm.widget.dataOptions.staticKey||"alarmbarwidget"===_vm.widget.dataOptions.staticKey||"resourceAlarmBar"===_vm.widget.dataOptions.staticKey||"kpiCard"===_vm.widget.dataOptions.staticKey)?"display:none;":"display:block;"}),_c("spinner",{attrs:{show:_vm.loading,size:"80"}}),_c("div",{staticClass:"self-center",class:{"fc-widget-body":null!==_vm.widget.header.title,"fc-widget-dragable-body":null===_vm.widget.header.title,"fc-new-tabular":_vm.isNewTabular,"fc-newchart-widget":"f-newchart-widget"===_vm.widgetType||"f-modular-report-widget"===_vm.widgetType||"f-newchart-widget-optimize"===_vm.widgetType}},[!_vm.loading&&_vm.failed?_c("div",[_vm._v(" "+_vm._s(_vm.$t("common._common.load_data_failed"))+" ")]):_vm._e(),"f-newchart-widget"!==_vm.widgetType&&"f-modular-report-widget"!==_vm.widgetType&&"f-newchart-widget-optimize"!==_vm.widgetType&&"f-graphics-widget"!==_vm.widgetType&&"PivotTableWrapper"!==_vm.widgetType?_c("div",{staticClass:"pull-right chart-delete-icon"},[_c("el-popover",{attrs:{"popper-class":"fc-widget-more-options",placement:"bottom",width:"200",trigger:"click"},model:{value:_vm.newWidgetOptionsPopoverToggle,callback:function($$v){_vm.newWidgetOptionsPopoverToggle=$$v},expression:"newWidgetOptionsPopoverToggle"}},[_vm.mode?_c("div",{staticClass:"fc-widget-edit-options"},[_vm.editrule?_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.editWidget(_vm.widget,_vm.dashboard)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.edit_widget"))+" ")]):_vm._e(),_c("div",{staticClass:"pointer fc-newChart-options-label",on:{click:function($event){return _vm.deleteChart(_vm.widget,_vm.dashboard)}}},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.remove_widget"))+" ")])]):_vm._e(),_c("i",{staticClass:"pointer pull-right el-icon-more fc-widget-moreicon-vertical fa fa-ellipsis-v",attrs:{slot:"reference"},slot:"reference"})])],1):_vm._e(),_vm._e(),_c(_vm.widgetType,{directives:[{name:"show",rawName:"v-show",value:!_vm.report||_vm.report&&"matrix"!==_vm.report.options.type&&"tabular"!==_vm.report.options.type,expression:"\n        !report ||\n          (report &&\n            report.options.type !== 'matrix' &&\n            report.options.type !== 'tabular')\n      "}],ref:"widgetComponent",tag:"component",class:{"fc-secondChart":_vm.multiChartMapping[_vm.widget.id]},attrs:{dbFilterJson:_vm.dbFilterJson,dbTimelineFilter:_vm.dbTimelineFilter,dashbord:!0,isLazyDashboard:_vm.isLazyDashboard,isVisibleInViewport:_vm.isVisibleInViewport,reportId:_vm.$getProperty(_vm.widget,"dataOptions.newReportId"),config:{widget:_vm.widget,isAutoRefreshEnabled:_vm.isAutoRefreshEnabled,currentDashboard:_vm.currentDashboard,dashboardObj:_vm.dashboardObj,intervalUpdate:_vm.intervalUpdate,id:_vm.widget.dataOptions.reportId,width:_vm.widgetSize.width,height:_vm.widgetSize.height-80,actualWidth:_vm.actualWidgetSize.width,actualHeight:_vm.actualWidgetSize.height,isReportUpdateFromDashboard:!0,editwidget:_vm.editwidget,selectedWidgetId:_vm.selectedWidgetId,rowHeight:_vm.rowHeight},isMobileDashboard:!1,mode1:_vm.mode,showTimePeriod:!!_vm.chartState&&[1,4].includes(_vm.chartState.common.mode),getReportUtil:_vm.sendUtil},on:{timelineFilterChange:_vm.timelineFilterChange,onload:_vm.reportLoaded,dateFilterUpdated:_vm.dateFilterUpdated,reportUtil:_vm.getReportutil,reportLoaded:_vm.getNewReportObj}}),_vm.report&&"tabular"===_vm.report.options.type?_c("f-tabular-report",{attrs:{reportObject:_vm.reportObject}}):_vm._e(),_c("el-dialog",{attrs:{title:"Configure widget",width:"50%",visible:_vm.showTemplateConfigDialog,"append-to-body":!0},on:{"update:visible":function($event){_vm.showTemplateConfigDialog=$event}}},[_c("div",{staticClass:"height200"},[_c("div",[_c("el-radio-group",{model:{value:_vm.templateConfig.showOrHide,callback:function($$v){_vm.$set(_vm.templateConfig,"showOrHide",$$v)},expression:"templateConfig.showOrHide"}},[_c("el-radio",{attrs:{label:1}},[_vm._v(_vm._s(_vm.$t("panel.card.show_filter")))]),_c("el-radio",{attrs:{label:2}},[_vm._v(_vm._s(_vm.$t("panel.card.hide_filter")))])],1)],1),2===_vm.templateConfig.showOrHide?_c("div",{staticClass:"mT30"},[_c("div",[_vm._v(" "+_vm._s(_vm.$t("panel.card.pick_def_asset"))+" ")]),_c("div",{staticClass:"mT10"},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{filterable:""},model:{value:_vm.templateConfig.choosenResource,callback:function($$v){_vm.$set(_vm.templateConfig,"choosenResource",$$v)},expression:"templateConfig.choosenResource"}},_vm._l(_vm.templateConfig.assets,(function(resource,resourceIdx){return _c("el-option",{key:resourceIdx,attrs:{label:resource.name,value:resource.id}})})),1)],1)]):_vm._e()]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.closeDialog}},[_vm._v(_vm._s(_vm.$t("panel.card.cancel__")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.configureWidget}},[_vm._v(_vm._s(_vm.$t("panel.card.configure")))])],1)]),_vm.mode?_c("el-dialog",{attrs:{title:"Graphics Options",width:"50%",visible:_vm.showGraphicsOptionsDialog,"append-to-body":!0},on:{"update:visible":function($event){_vm.showGraphicsOptionsDialog=$event}}},[_c("div",{staticClass:"height250"},[_c("div",[_c("el-checkbox",{model:{value:_vm.graphicsOptions.showFilter,callback:function($$v){_vm.$set(_vm.graphicsOptions,"showFilter",$$v)},expression:"graphicsOptions.showFilter"}},[_vm._v(_vm._s(_vm.$t("panel.card.show_asset_filter")))])],1),_c("div",{staticClass:"pT10"},[_c("el-checkbox",{model:{value:_vm.graphicsOptions.hideHeader,callback:function($$v){_vm.$set(_vm.graphicsOptions,"hideHeader",$$v)},expression:"graphicsOptions.hideHeader"}},[_vm._v(_vm._s(_vm.$t("panel.card.hide_header")))])],1),_c("div",{staticClass:"mT30"},[_c("div",[_vm._v(" "+_vm._s(_vm.$t("panel.card.default_asset"))+" ")]),_c("div",{staticClass:"mT10"},[_c("el-select",{staticClass:"fc-input-full-border2",attrs:{filterable:""},model:{value:_vm.graphicsOptions.defaultAsset,callback:function($$v){_vm.$set(_vm.graphicsOptions,"defaultAsset",$$v)},expression:"graphicsOptions.defaultAsset"}},_vm._l(_vm.graphicsOptions.assets,(function(resource,resourceIdx){return _c("el-option",{key:resourceIdx,attrs:{"no-data-text":_vm.graphicsOptions.assetsLoading?"Loading...":"No Assets.",label:resource.name,value:resource.id}})})),1)],1)]),_c("div",{staticClass:"pT15"},[_c("el-input",{staticClass:"fc-input-full-border2",staticStyle:{width:"300px"},attrs:{placeholder:"eg: 75"},model:{value:_vm.graphicsOptions.zoomLevel,callback:function($$v){_vm.$set(_vm.graphicsOptions,"zoomLevel",$$v)},expression:"graphicsOptions.zoomLevel"}},[_c("template",{slot:"prepend"},[_vm._v(_vm._s(_vm.$t("panel.card.zoom")))]),_c("template",{slot:"append"},[_vm._v("%")])],2)],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.closeGraphicsDialog}},[_vm._v(_vm._s(_vm.$t("panel.card.cancel__")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:function($event){return _vm.saveGraphicsOptions(_vm.widget)}}},[_vm._v(_vm._s(_vm.$t("panel.card.save")))])],1)]):_vm._e()],1),_vm.emailReportVisibility?_c("email-report",{attrs:{visibility:_vm.emailReportVisibility,report:_vm.widget.dataOptions&&_vm.widget.dataOptions.newReport?_vm.widget.dataOptions.newReport:{}},on:{"update:visibility":function($event){_vm.emailReportVisibility=$event}}}):_vm._e()],1)},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),router=(__webpack_require__(976801),__webpack_require__(879288),__webpack_require__(689730),__webpack_require__(169358),__webpack_require__(434284),__webpack_require__(648324),__webpack_require__(450886),__webpack_require__(241830),__webpack_require__(634338),__webpack_require__(670560),__webpack_require__(903650),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(329435)),FReport=__webpack_require__(712744),FNewReport=__webpack_require__(862423),FNewReportOptimize=__webpack_require__(106803),FListWidget=__webpack_require__(293708),FCountWidget=__webpack_require__(528727),FMapWidget=__webpack_require__(307765),FStaticWidget=__webpack_require__(776906),Fcards=__webpack_require__(972258),FWebWidget=__webpack_require__(486829),FGraphicsWidget=__webpack_require__(263099),FTabularReport=__webpack_require__(329744),moment=__webpack_require__(730381),moment_default=__webpack_require__.n(moment),OutsideClick=__webpack_require__(21864),Comments2=__webpack_require__(487565),ModuleNewReport=__webpack_require__(518999),util=__webpack_require__(733313),NewReportSummaryHelper=__webpack_require__(601458),element_ui_common=__webpack_require__(364720),PivotTableWrapper=__webpack_require__(302347),validation=__webpack_require__(990260),DashboardEmailReport=__webpack_require__(81938),api=__webpack_require__(32284),OtherMixin=__webpack_require__(964967),types=["chart","newchart","view","map","count","static","web","cards","graphics","connectedapps"],FWidgetvue_type_script_lang_js={mixins:[NewReportSummaryHelper/* default */.Z,OtherMixin/* default */.Z],props:{type:{type:String,required:!0,validator:function(val){return types.includes(val)}},widget:{type:Object,required:!0,default:function(){return{}}},currentDashboard:{type:Object},demoData:{type:Object},grid:{type:Object},rowHeight:{type:Number},dashboard:{type:Number},mode:{type:Boolean},editwidget:{type:Boolean},selectedWidgetId:{type:Number},dashboardObj:{type:Object},dbFilterJson:{type:Object},dbTimelineFilter:{type:Object},showFilterConfig:{type:Boolean,default:!1},isLazyDashboard:{type:Boolean,default:!1}},components:{"f-chart-widget":FReport/* default */.Z,"f-newchart-widget":FNewReport/* default */.Z,"f-newchart-widget-optimize":FNewReportOptimize/* default */.Z,"f-view-widget":FListWidget/* default */.Z,"f-count-widget":FCountWidget/* default */.Z,"f-map-widget":FMapWidget/* default */.Z,"f-static-widget":FStaticWidget/* default */.Z,"f-cards-widget":Fcards/* default */.Z,"f-web-widget":FWebWidget["default"],"f-graphics-widget":FGraphicsWidget/* default */.Z,"f-tabular-report":FTabularReport/* default */.Z,outsideClick:OutsideClick/* default */.Z,comments:Comments2/* default */.Z,"f-modular-report-widget":ModuleNewReport/* default */.Z,EmailReport:DashboardEmailReport/* default */.Z,
// eslint-disable-next-line vue/no-unused-components
PivotTableWrapper:PivotTableWrapper/* default */.Z},data:function(){return{isVisibleInViewport:!1,emailReportVisibility:!1,templateConfig:{showOrHide:1,choosenResource:null,assets:[],hideHeader:!1},widgetDateObj:null,currentTemplate:null,exportDownloadUrl:null,url:null,loading:!1,newWidgetOptionsPopoverToggle:!1,failed:!1,changeheader:!1,newReportObj:null,sendUtil:null,data:null,report:null,reportObject:null,selectedPeriod:null,refreshInterval:null,setSubTitle:"",emptyTitle:"Today",ChartType:null,pubSubWatcherKey:null,graphicsOptions:{showFilter:!1,defaultAsset:null,assetsLoading:!0,assets:[],hideHeader:!1,zoomLevel:null},showGraphicsOptionsDialog:!1,showTemplateConfigDialog:!1,isInfoIconPopOverOpen:!1,multiChartMapping:{2387:4498,2388:4498,2400:4498,2401:4498,2408:4498,2409:4498,3032:4498,3033:4498,3034:4498,3035:4498,3036:4498,3037:4498,3038:4498,3039:4498,3040:4498,3041:4498,3042:4498,3043:4498,3044:4498,3045:4498,3046:4498,3048:4498,3098:4498,3097:4498,2391:4499,2392:4499,2402:4499,2403:4499,2410:4499,2411:4499,3049:4499,3050:4499,3051:4499,3052:4499,3053:4499,3054:4499,3055:4499,3056:4499,3057:4499,3058:4499,3059:4499,3060:4499,3061:4499,3062:4499,3063:4499,3064:4499,3099:4499,3100:4499,3395:4499,3394:4499,3396:4499,2394:4500,2395:4500,2404:4500,2405:4500,2412:4500,2413:4500,3065:4500,3066:4500,3067:4500,3068:4500,3069:4500,3070:4500,3071:4500,3072:4500,3073:4500,3074:4500,3075:4500,3076:4500,3077:4500,3078:4500,3079:4500,3080:4500,2397:4501,2398:4501,2406:4501,2407:4501,2414:4501,2415:4501,3081:4501,3082:4501,3083:4501,3084:4501,3085:4501,3086:4501,3087:4501,3088:4501,3089:4501,3090:4501,3091:4501,3092:4501,3093:4501,3094:4501,3095:4501,3096:4501,3436:4501,3437:4501,3438:4501,4089:5745,4090:5745,4091:5745,4083:5745,4085:5745,4097:5759,4098:5759,4096:5759,4094:5759,4095:5759,4106:5773,4105:5773,4104:5773,4100:5773,4101:5773,4119:5790,4120:5790,4118:5790,4116:5790,4117:5790,4135:5806,4136:5806,4137:5806,4138:5806,4139:5806,2657:4337,2659:4337,2658:4337,4206:5830,4207:5830,4208:5830,4209:5834,4210:5834,4211:5834,4212:5838,4214:5838,4213:5838,4215:5841,4217:5841,4216:5841,4218:5845,4219:5845,4220:5845,4221:5849,4223:5849,4222:5849,4224:5853,4225:5853,4226:5853,4227:5857,4228:5857,4229:5857,4230:5862,4232:5862,4231:5862,4233:5866,4234:5866,4235:5866,4236:5870,4238:5870,4237:5870,5787:6546,5786:6546,5784:6546,5785:6546,5782:6546,5783:6546,5780:6546,5781:6546,5778:6546,5779:6546,5776:6546,5777:6546,5774:6546,5775:6546,5772:6546,5773:6546,5770:6546,5771:6546,5807:6622,5806:6622,5805:6622,5804:6622,5803:6622,5802:6622,5801:6622,5800:6622,5799:6622,5798:6622,5797:6622,5796:6622,5795:6622,5794:6622,5793:6622,5792:6622,5791:6622,5790:6622,5789:6622,5827:6623,5826:6623,5825:6623,5824:6623,5823:6623,5822:6623,5821:6623,5820:6623,5819:6623,5818:6623,5817:6623,5816:6623,5815:6623,5814:6623,5813:6623,5812:6623,5811:6623,5810:6623,5809:6623,5847:6624,5846:6624,5845:6624,5844:6624,5843:6624,5842:6624,5841:6624,5840:6624,5839:6624,5838:6624,5837:6624,5836:6624,5835:6624,5834:6624,5833:6624,5832:6624,5831:6624,5830:6624,5829:6624}}},mounted:function(){"graphics"!==this.type||""!==this.widget.header.title&&null!==this.widget.header.title||(this.changeheader=!0),this.initRefreshInterval(),this.getGraphicsOptions(this.widget)},destroyed:function(){this.cleanupRefreshInterval()},computed:{isPortalApp:function(){var PORTALS=this.$constants.appCategory.PORTALS;return!(!(0,router/* getApp */.wx)()||(0,router/* getApp */.wx)().appCategory!==PORTALS)},showWidgetInfoIcon:function(){var _this$widget;return(null===(_this$widget=this.widget)||void 0===_this$widget||null===(_this$widget=_this$widget.widgetSettings)||void 0===_this$widget?void 0:_this$widget.showHelpText)&&this.widget.helpText},hideTimelineFilterInsideWidget:function(){var _this$dashboardObj;return!(null===(_this$dashboardObj=this.dashboardObj)||void 0===_this$dashboardObj||null===(_this$dashboardObj=_this$dashboardObj.dashboardFilter)||void 0===_this$dashboardObj||!_this$dashboardObj.hideFilterInsideWidgets)&&this.dashboardObj.dashboardFilter.hideFilterInsideWidgets},isOperationsApp:function(){var appNameFromUrl=window.location.pathname.slice(1).split("/")[0];return"operations"===appNameFromUrl},chartState:function(){return this.widget&&this.widget.dataOptions&&this.widget.dataOptions.newReport&&this.widget.dataOptions.newReport&&this.widget.dataOptions.newReport.chartState?"string"===typeof this.widget.dataOptions.newReport.chartState?JSON.parse(this.widget.dataOptions.newReport.chartState):this.widget.dataOptions.newReport.chartState:null},isTabular:function(){return"PivotTableWrapper"===this.widgetType||!(!this.chartState||null===this.chartState)&&!(!this.chartState.settings||!1!==this.chartState.settings.chart)},isReadOnly:function(){return!!this.isAltayerNonPrivilagedUser||!(!this.currentDashboard||!this.currentDashboard.readOnly)},isAutoRefreshEnabled:function(){return this.$hasPermission("setup:GENERAL")&&116===this.$org.id},editrule:function(){var data=this.widget.dataOptions;return 146!==this.$account.org.id&&("readingcard"===data.staticKey||"readingGaugeCard"===data.staticKey||"readingWithGraphCard"===data.staticKey||"textcard"===data.staticKey||"imagecard"===data.staticKey||"readingComboCard"===data.staticKey||"kpiCard"===data.staticKey)},widgetSize:function(){var w=null,h=null;return this.grid?(w=this.grid.w,h=this.grid.h):(w=this.widget.layout.width,h=this.widget.layout.height),this.multiChartMapping[this.widget.id]?{width:w*(this.rowHeight?this.rowHeight:100),height:h*(this.rowHeight?.9*this.rowHeight:100)-(this.report&&this.report.options.showWidgetLegends?65:0)}:this.newReportObj?{width:w*(this.rowHeight?this.rowHeight:100),height:h*(this.rowHeight?this.rowHeight:100)-(this.newReportObj&&this.newReportObj.options&&this.newReportObj.options.widgetLegend&&this.newReportObj.options&&this.newReportObj.options.widgetLegend.show?0:-65)}:{width:this.$el?this.$el.offsetWidth:w*(this.rowHeight?this.rowHeight:100),height:this.$el?this.$el.offsetHeight-(this.report&&this.report.options.showWidgetLegends?100:65):h*(this.rowHeight?this.rowHeight:100)-(this.report&&this.report.options.showWidgetLegends,0)}},actualWidgetSize:function(){var w=null,h=null;return this.grid?(w=this.grid.w,h=this.grid.h):(w=this.widget.layout.width,h=this.widget.layout.height),{width:w*(this.rowHeight?this.rowHeight:100),height:h*(this.rowHeight?this.rowHeight:100)}},widgetType:function(){return this.widget.dataOptions.newReportId?2==this.widget.dataOptions.reportType?"f-modular-report-widget":5==this.widget.dataOptions.reportType?"PivotTableWrapper":this.$route.query.newchart?"f-newchart-widget-optimize":"f-newchart-widget":"f-"+this.widget.type+"-widget"},classObject:function(){if(this.widget.layout.width){var className="col-"+3*this.widget.layout.width;return className}return"col-1"},isNewTabular:function(){return this.widget.dataOptions.newReportId&&this.newReportObj&&this.newReportObj.options&&this.newReportObj.options.settings&&!1===this.newReportObj.options.settings.chart}},methods:{getRoute:function(id,widgetss){var _widgetss$dataOptions,moduleName=null,currentModule=this.getCurrentModule();if(moduleName=null!==widgetss&&void 0!==widgetss&&null!==(_widgetss$dataOptions=widgetss.dataOptions)&&void 0!==_widgetss$dataOptions&&null!==(_widgetss$dataOptions=_widgetss$dataOptions.newReport)&&void 0!==_widgetss$dataOptions&&null!==(_widgetss$dataOptions=_widgetss$dataOptions.module)&&void 0!==_widgetss$dataOptions&&_widgetss$dataOptions.name?widgetss.dataOptions.newReport.module.name:currentModule.module,(0,router/* isWebTabsEnabled */.tj)()&&widgetss.dataOptions.newReportId){var routeObj;routeObj=moduleName?"energydata"===moduleName?(0,router/* findRouteForReport */.Mq)("analytics_reports",router/* pageTypes */.As.REPORT_VIEW,{moduleName:moduleName}):(0,router/* findRouteForReport */.Mq)("module_reports",router/* pageTypes */.As.REPORT_VIEW,{moduleName:moduleName}):(0,router/* findRouteForReport */.Mq)("analytics_reports",router/* pageTypes */.As.REPORT_VIEW);var _ref=routeObj||{},name=_ref.name,url=this.$router.resolve({name:name}).href+"/"+widgetss.dataOptions.newReportId;this.url=url}},handleViewportVisibilityChange:function(isVisible,entry){
//one set state from false to true, DONT reset it to false when widget goes out of view again , no need to trigger refresh again. see watcher for isVisibleInViewport inside report comp
isVisible&&(this.isVisibleInViewport=isVisible)},editFilterConfig:function(){this.newWidgetOptionsPopoverToggle=!1;var widget=this.widget;this.$emit("editWidgetFilterConfig",widget)},enableRedirect:function(widgetType){return"f-graphics-widget"!==widgetType&&"f-view-widget"!==widgetType},timelineFilterChange:function(dateObj){this.widgetDateObj=dateObj},closeGraphicsDialog:function(){this.showGraphicsOptionsDialog=!1},saveGraphicsOptions:function(widget){widget&&(widget.dataOptions.graphicsOptions=JSON.stringify({showFilter:this.graphicsOptions.showFilter,defaultAsset:this.graphicsOptions.defaultAsset,hideHeader:this.graphicsOptions.hideHeader,zoomLevel:this.graphicsOptions.zoomLevel})),this.showGraphicsOptionsDialog=!1},openGraphicsOptions:function(widget){if(widget&&widget.dataOptions&&(widget.dataOptions.graphicsId||widget.graphicsId)){if(widget.dataOptions.graphicsOptions){var goptions=JSON.parse(widget.dataOptions.graphicsOptions);this.graphicsOptions={showFilter:!!goptions.showFilter,defaultAsset:goptions.defaultAsset?goptions.defaultAsset:null,assets:[],hideHeader:goptions.hideHeader,zoomLevel:goptions.zoomLevel}}else this.graphicsOptions={showFilter:!1,defaultAsset:null,assets:[],hideHeader:!1,zoomLevel:null};this.loadGraphicsAssets(widget.dataOptions.graphicsId||widget.graphicsId),this.showGraphicsOptionsDialog=!0}},getGraphicsOptions:function(widget){if(widget&&widget.dataOptions&&(widget.dataOptions.graphicsId||widget.graphicsId))if(widget.dataOptions.graphicsOptions){var goptions=JSON.parse(widget.dataOptions.graphicsOptions);this.graphicsOptions={showFilter:!!goptions.showFilter,defaultAsset:goptions.defaultAsset?goptions.defaultAsset:null,assets:[],hideHeader:goptions.hideHeader,zoomLevel:goptions.zoomLevel}}else this.graphicsOptions={showFilter:!1,defaultAsset:null,assets:[],hideHeader:!1,zoomLevel:null}},loadGraphicsAssets:function(graphicsId){var _this=this;this.graphicsOptions.assetsLoading=!0,this.$http.get("/v2/graphics/getById?recordId="+graphicsId).then((function(response){if(response.data.result.graphics){var param,graphicsObj=response.data.result.graphics;if(graphicsObj.applyTo){var applyTo=JSON.parse(graphicsObj.applyTo);param=2===applyTo.applyToType&&applyTo.applyToAssetIds.length>0?{filters:{id:{operatorId:36,value:applyTo.applyToAssetIds.map(String)}}}:3===applyTo.applyToType&&applyTo.criteria?{filterCriterias:applyTo.criteria}:{categoryId:graphicsObj.assetCategoryId}}else param={categoryId:graphicsObj.assetCategoryId};util/* default */.Z.loadAsset(param).then((function(response){_this.graphicsOptions.assets=response.assets,_this.graphicsOptions.defaultAsset||(_this.graphicsOptions.defaultAsset=parseInt(graphicsObj.assetId)),_this.graphicsOptions.assetsLoading=!1}))}}))},closeDialog:function(){this.showTemplateConfigDialog=!1},configureWidget:function(){var template=JSON.parse(JSON.stringify(this.currentTemplate));1===this.templateConfig.showOrHide?template.isVisibleInDashBoard=!0:(template.isVisibleInDashBoard=!1,template.parentId=this.templateConfig.choosenResource,template.defaultValue=this.templateConfig.choosenResource),template.chooseValues=[],this.currentTemplate=template,this.widget.dataOptions.reportTemplate=template,this.showTemplateConfigDialog=!1,this.multiChartMapping[this.widget.id]?this.$refs.widgetChildComponent.init():this.$refs.widgetComponent.init()},showTemplateReportOptions:function(widget){var _this2=this;if(widget&&widget.dataOptions&&widget.dataOptions.newReport&&4===widget.dataOptions.newReport.type)if(this.currentTemplate=this.widget.dataOptions.newReport.reportTemplate?this.widget.dataOptions.newReport.reportTemplate:this.widget.dataOptions.reportTemplate,0===this.templateConfig.assets.length){var template=JSON.parse(JSON.stringify(this.currentTemplate));this.loadReportTemplateValues(template).then((function(){_this2.templateConfig.assets=template.chooseValues,_this2.showTemplateConfigDialog=!0}))}else this.showTemplateConfigDialog=!0;else this.showTemplateConfigDialog=!1},openReportComments:function(id){var temp={};temp["id"]=id,temp["open"]=!0,this.newWidgetOptionsPopoverToggle=!1,this.$emit("showComments",temp)},expandReport:function(){var params={};"PivotTableWrapper"==this.widgetType?params["type"]="pivot":params["type"]="report",params["dbFilterJson"]=this.dbFilterJson;var dateObj=Object.freeze(this.dbTimelineFilter);this.widgetDateObj&&(dateObj={startTime:this.widgetDateObj.value[0],endTime:this.widgetDateObj.value[1],operatorId:this.widgetDateObj.operatorId,dateLabel:this.widgetDateObj.label,dateValueString:"".concat(this.widgetDateObj.value[0],",").concat(this.widgetDateObj.value[1]),dateField:this.dbTimelineFilter.dateField}),params["dbTimelineFilter"]=dateObj,params["url"]="",params["alt"]="",params["dashboardId"]="",params["reportId"]=this.widget.dataOptions.newReportId,params["newReport"]=this.widget.dataOptions.newReportId?this.widget.dataOptions.newReport:null,params["target"]="",this.$popupView.openPopup(params)},openInAnalytics:function(reportId,widget){if("f-modular-report-widget"!==this.widgetType){this.newWidgetOptionsPopoverToggle=!1;var routePath,deafultPath="/app/em/analytics/",ANALYTIC_PORTFOLIO=router/* pageTypes */.As.ANALYTIC_PORTFOLIO,ANALYTIC_BUILDING=router/* pageTypes */.As.ANALYTIC_BUILDING,HEAT_MAP=router/* pageTypes */.As.HEAT_MAP,ANALYTIC_SITE=router/* pageTypes */.As.ANALYTIC_SITE,TREE_MAP=router/* pageTypes */.As.TREE_MAP,SCATTER=(router/* pageTypes */.As.REGRESSION,router/* pageTypes */.As.SCATTER);switch(widget.dataOptions.newReport.analyticsType){case 1:routePath=this.newReportObj&&this.newReportObj.options.common.filters&&this.newReportObj.options.common.filters.xCriteriaMode?{path:"portfolio",pageType:ANALYTIC_PORTFOLIO}:{path:"building",pageType:ANALYTIC_BUILDING};break;case 3:routePath={path:"heatmap",pageType:HEAT_MAP};break;case 6:routePath={path:"site",pageType:ANALYTIC_SITE};break;case 7:routePath={path:"treemap",pageType:TREE_MAP};break;case 8:routePath={path:"scatter",pageType:SCATTER};break;default:routePath={path:"building",pageType:ANALYTIC_BUILDING}}if((0,router/* isWebTabsEnabled */.tj)()){var _ref3=(0,router/* findRouteForTab */.OD)(routePath.pageType)||{},_name=_ref3.name,_query={reportId:reportId,fromDashboard:!0};_name&&this.$router.push({name:_name,query:_query})}else this.$router.push({path:deafultPath+routePath.path,query:{reportId:reportId,fromDashboard:!0}})}else{var moduleName=widget.dataOptions.newReport.module.name,isCustomModule=widget.dataOptions.newReport.module.custom;if((0,router/* isWebTabsEnabled */.tj)()){var _ref2=(0,router/* findRouteForReport */.Mq)("module_reports",router/* pageTypes */.As.REPORT_FORM,{moduleName:moduleName})||{},name=_ref2.name,query={reportId:reportId,module:moduleName,fromDashboard:!0};return void(name&&this.$router.push({name:name,query:query}))}if(this.$helpers.isEtisalat())return void this.$router.push({path:"/app/em/modulereports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});switch(moduleName){case"workorder":case"workorderLabour":case"workorderCost":case"workorderItem":case"workorderTools":case"workorderService":case"workorderTimeLog":case"workorderHazard":case"plannedmaintenance":this.$router.push({path:"/app/wo/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"purchaseorder":case"poterms":case"purchaseorderlineitems":case"purchaserequest":case"purchaserequestlineitems":this.$router.push({path:"/app/purchase/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"inspectionTemplate":case"inspectionResponse":this.$router.push({path:"/app/inspection/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"budget":case"budgetamount":this.$router.push({path:"/app/ac/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"item":case"tool":case"itemTransactions":case"tootTransactions":case"itemTypes":case"toolTypes":case"storeRoom":case"shipment":case"transferrequest":case"transferrequestpurchaseditems":case"transferrequestshipmentreceivables":this.$router.push({path:"/app/inventory/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"alarm":case"newreadingalarm":case"readingalarmoccurrence":case"bmsalarm":case"mlAnomalyAlarm":case"anomalyalarmoccurrence":case"violationalarm":case"violationalarmoccurrence":case"operationalarm":case"operationalarmoccurrence":case"sensoralarm":case"sensoralarmoccurrence":case"sensorrollupalarm":case"sensorrollupalarmoccurrence":case"basealarm":case"alarmoccurrence":case"readingevent":case"bmsevent":case"mlAnomalyEvent":case"violationevent":case"operationevent":case"sensorevent":case"baseevent":this.$router.push({path:"/app/fa/reports/new",query:{reportId:reportId,fromDashboard:!0,module:this.$helpers.isLicenseEnabled("NEW_ALARMS")?moduleName:"alarm"}});break;case"serviceRequest":this.$router.push({path:"/app/sr/reports/new",query:{reportId:reportId,fromDashboard:!0,module:this.$helpers.isLicenseEnabled("ServiceRequest")?moduleName:"serviceRequest"}});break;case"asset":this.$router.push({path:"/app/at/reports/new",query:{reportId:reportId,fromDashboard:!0,module:"asset"}});break;case"visitor":case"visitorlog":case"invitevisitor":case"watchlist":this.$router.push({path:"/app/vi/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"tenant":case"tenantunit":case"tenantcontact":case"quote":case"contact":case"tenantspaces":case"quotelineitems":case"quoteterms":case"people":case"newsandinformationsharing":case"neighbourhoodsharing":case"dealsandofferssharing":case"contactdirectorysharing":case"admindocumentsharing":case"audienceSharing":this.$router.push({path:"/app/tm/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;case"contracts":case"purchasecontracts":case"purchasecontractlineitems":case"labourcontracts":case"labourcontractlineitems":case"warrantycontracts":case"warrantycontractlineitems":case"rentalleasecontracts":case"rentalleasecontractlineitems":this.$router.push({path:"/app/ct/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break;default:isCustomModule?this.$router.push({path:"/app/ca/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}}):this.$router.push({path:"/app/at/reports/new",query:{reportId:reportId,fromDashboard:!0,module:moduleName}});break}}},openInPivotBuilder:function(id){var path="/app/em/pivotbuilder/new?reportId=".concat(id);if((0,router/* isWebTabsEnabled */.tj)()){var _findRouteForTab=(0,router/* findRouteForTab */.OD)(router/* pageTypes */.As.PIVOT_FORM),name=_findRouteForTab.name;path=this.$router.resolve({name:name,query:{reportId:id}}).href}this.$router.push({path:path})},exportAsFile:function(type,reportId,reportTemplate,widgets){var _this3=this;this.newWidgetOptionsPopoverToggle=!1;var params=this.newReportObj.params?this.newReportObj.params:{};if(this.getRoute(reportId,widgets),params["url"]=null!==this&&void 0!==this&&this.url?this.url:"",this.$message({message:"Exporting as "+this.$constants.FILE_FORMAT[type],showClose:!0,duration:0}),
// this.$message('Exporting as ' + this.$constants.FILE_FORMAT[type])
4===type&&(params.exportParams={showHeader:!0,showPrintDetails:!0}),"f-modular-report-widget"===this.widgetType){params["fileFormat"]=type,params["reportId"]=reportId;
//export WYSIWYG ,pass current date picker range(if enabled) to export api\
//, Child comp emits sycn newreportObj on  change in FModule or FNewReport. TO DO : remove reportObj state in Fwidget if not needed
//get child state from child when needed like below
try{var dateFilter=this.$refs["widgetComponent"].dateFilter;dateFilter&&(params["startTime"]=dateFilter.value[0],params["endTime"]=dateFilter.value[1]),
//if dashboard filters applied on widget , get filters from widget comp prop and send param to export
this.dbFilterJson&&(params["filters"]=JSON.stringify(this.dbFilterJson))}catch(e){}this.$http.post("/v2/report/exportModuleReport",params).then((function(response){element_ui_common.Message.closeAll(),response.data&&0===response.data.responseCode&&(_this3.exportDownloadUrl=response.data.result.fileUrl)}))}else if("PivotTableWrapper"===this.widgetType){
// params['startTime'] = this.newReportObj.dateRange.time[0]
// params['endTime'] = this.newReportObj.dateRange.time[1]
params["reportId"]=reportId,params["fileFormat"]=type;try{this.widgetDateObj?(params["startTime"]=this.widgetDateObj.value[0],params["endTime"]=this.widgetDateObj.value[1]):this.dbTimelineFilter&&(params["startTime"]=this.dbTimelineFilter.startTime,params["endTime"]=this.dbTimelineFilter.endTime),
//if dashboard filters applied on widget , get filters from widget comp prop and send param to export
this.dbFilterJson&&(params["filters"]=JSON.stringify(this.dbFilterJson))}catch(err){}api/* API */.bl.get("/v2/report/exportPivotReport",params).then((function(_ref4){var data=_ref4.data,error=_ref4.error;element_ui_common.Message.closeAll(),error||(_this3.exportDownloadUrl=data.fileUrl)}))}else"f-modular-report-widget"===this.widgetType||"f-newchart-widget-optimize"===this.widgetType||(reportTemplate&&"null"!==reportTemplate&&(params["templateString"]=reportTemplate),params["startTime"]=this.newReportObj.dateRange.time[0],params["endTime"]=this.newReportObj.dateRange.time[1],params["dateOperator"]=this.newReportObj.dateRange.operatorId,params["dateOperatorValue"]=this.newReportObj.dateRange.value,params["chartType"]=this.newReportObj.options.type,params["mode"]=1,params["reportId"]=reportId,params["fileFormat"]=type,api/* API */.bl.put("/v3/report/reading/export",params).then((function(response){element_ui_common.Message.closeAll(),response.error?_this3.$message.error("Error while downloading widget PDF"):response.data&&(_this3.exportDownloadUrl=response.data.fileUrl)})))},initRefreshInterval:function(){if(this.subscribeLiveData(),this.isAutoRefreshEnabled){var _self=this;if(this.widget.dataOptions.refresh_interval&&this.widget.dataOptions.refresh_interval>=120){
// min 2 minutes
this.refreshInterval&&clearInterval(this.refreshInterval);var intervalTime=1e3*this.widget.dataOptions.refresh_interval;// converting seconds to millis
this.refreshInterval=setInterval((function(){_self.$refs["widgetComponent"]&&_self.$refs["widgetComponent"].refresh()}),intervalTime)}}},refresh:function(){this.$refs["widgetComponent"]&&this.$refs["widgetComponent"].refresh()},getCurrentValueReadings:function(){var readingList=[];if(!this.widget.dataOptions.staticKey)return readingList;if("readingcard"===this.widget.dataOptions.staticKey){var currentDateOperators=[22,31,28,68,44];// today, this week/month/quarter/year
this.widget.dataOptions.paramsJson&&this.widget.dataOptions.paramsJson.parentId&&this.widget.dataOptions.paramsJson.fieldId&&6===this.widget.dataOptions.paramsJson.aggregateFunc&&-1!==currentDateOperators.indexOf(this.widget.dataOptions.paramsJson.dateOperator)&&readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldId:this.widget.dataOptions.paramsJson.fieldId+""})}if("readingGaugeCard"===this.widget.dataOptions.staticKey){var _currentDateOperators=[22,31,28,68,44];// today, this week/month/quarter/year
this.widget.dataOptions.paramsJson&&this.widget.dataOptions.paramsJson.parentId&&this.widget.dataOptions.paramsJson.fieldId&&6===this.widget.dataOptions.paramsJson.aggregateFunc&&-1!==_currentDateOperators.indexOf(this.widget.dataOptions.paramsJson.dateOperator)&&readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldId:this.widget.dataOptions.paramsJson.fieldId+""})}else if("readingWithGraphCard"===this.widget.dataOptions.staticKey){var _currentDateOperators2=[22,31,28,68,44];// today, this week/month/quarter/year
if(this.widget.dataOptions.paramsJson&&this.widget.dataOptions.paramsJson.parentId&&this.widget.dataOptions.paramsJson.fieldId&&-1!==_currentDateOperators2.indexOf(this.widget.dataOptions.paramsJson.dateOperator))if(6===this.widget.dataOptions.paramsJson.aggregateFunc)readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldId:this.widget.dataOptions.paramsJson.fieldId+""});else if(this.widget.dataOptions.metaJson){var metaJsonObj=JSON.parse(this.widget.dataOptions.metaJson);metaJsonObj.aggregateFunction&&"lastValue"===metaJsonObj.aggregateFunction&&readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldId:this.widget.dataOptions.paramsJson.fieldId+""})}}else-1!==this.widget.dataOptions.staticKey.indexOf("fahuStatus")&&("fahuStatusCard"===this.widget.dataOptions.staticKey?(readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"runstatus",moduleName:"prefilterstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"valvefeedback",moduleName:"prefilterstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"tripstatus",moduleName:"bagfilterstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"automanualstatus",moduleName:"prefilterstatus"})):"fahuStatusCard1"===this.widget.dataOptions.staticKey?(readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"runstatus",moduleName:"runstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"valvecommand",moduleName:"runstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"tripstatus",moduleName:"runstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"automanualstatus",moduleName:"automanualstatus"})):"fahuStatusCard2"===this.widget.dataOptions.staticKey?(readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"runstatus",moduleName:"runstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"valvefeedback",moduleName:"supplyairtemperature"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"tripstatus",moduleName:"runstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"automanualstatus",moduleName:"runstatus"})):"fahuStatusCard3"===this.widget.dataOptions.staticKey?(readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"runstatus",moduleName:"automanualstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"valvecommand",moduleName:"returntemperature"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"tripstatus",moduleName:"returntemperature"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"automanualstatus",moduleName:"automanualstatus"})):"fahuStatusCardNew"===this.widget.dataOptions.staticKey&&(readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"runstatus",moduleName:"runstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"valvefeedback",moduleName:"valvefeedback"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"tripstatus",moduleName:"tripstatus"}),readingList.push({parentId:this.widget.dataOptions.paramsJson.parentId+"",fieldName:"automanualstatus",moduleName:"automanualstatus"})));return readingList},refreshData:function(){self.$refs["widgetComponent"]&&self.$refs["widgetComponent"].refresh()},subscribeLiveData:function(){var _this4=this,self=this;self.pubSubWatcherKey=null;var readings=this.getCurrentValueReadings();readings&&readings.length&&(this.$wms?this.$http.post("/v2/fetchLiveUpdateFields",{liveUpdateFields:readings}).then((function(response){var readingFields=response.data.result.liveUpdateFields;if(readingFields&&readingFields.length){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(readingFields);try{for(_iterator.s();!(_step=_iterator.n()).done;){var reading=_step.value,topic="__livereading__/"+reading.parentId+"/"+reading.fieldId;_this4.$wms.subscribe(topic,_this4.refreshData)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}})):self.pubSubWatcherKey=this.subscribe("readingChange",{readings:readings},this.refreshData))},unsubscribeLiveData:function(){var _this5=this,readings=this.getCurrentValueReadings();readings&&readings.length&&(this.$wms?this.$http.post("/v2/fetchLiveUpdateFields",{liveUpdateFields:readings}).then((function(response){var readingFields=response.data.result.liveUpdateFields;if(readingFields&&readingFields.length){var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(readingFields);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var reading=_step2.value,topic="__livereading__/"+reading.parentId+"/"+reading.fieldId;_this5.$wms.unsubscribe(topic,_this5.refreshData)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}})):this.pubSubWatcherKey&&(this.unsubscribe(this.pubSubWatcherKey,"readingChange",{readings:readings}),this.pubSubWatcherKey=null))},getNewReportObj:function(report,result){report&&result&&(this.$set(this.widget.dataOptions,"newReport",result.report),this.newReportObj=report)},getWidget:function(widget){if(widget)return widget},cleanupRefreshInterval:function(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null),this.unsubscribeLiveData()},initData:function(){var self=this;self.loading=!0,!this.selectedPeriod&&this.widget.header&&this.widget.header.periods&&(this.selectedPeriod=this.widget.header.periods[0].value,this.widget.header.subtitle=this.selectedPeriod);var url=this.widget.dataOptions.dataurl;this.selectedPeriod&&(url=url.indexOf("?")>0?url+"&period="+this.selectedPeriod:url+"?period="+this.selectedPeriod),self.$http.get(url).then((function(response){if(self.loading=!1,response.data.reportData){self.data={xAxis:{},yAxis:{},name:self.widget.dataOptions.name};var reportData=response.data.reportData.filter((function(item){return!!item.label||!(!item.value||item.label)&&(item.label="unknown",!0)}));self.data=reportData}else self.widget.dataKey&&response.data[self.widget.dataKey]?self.data=response.data[self.widget.dataKey]:self.widget.dataKey&&response.data.length?self.data=response.data:self.demoData?self.data=self.demoData:self.failed=!0})).catch((function(error){error&&(self.loading=!1,self.failed=!0)}))},intervalUpdate:function(interval){this.widget.dataOptions.refresh_interval=interval,this.cleanupRefreshInterval(),this.initRefreshInterval()},reportLoaded:function(report,reportObject){var self=this;this.report=report,this.reportObject=reportObject,null!==self.report&&null!==self.report.options.timeObject.time&&(self.setSubTitle=self.timeForm(self.report.options.timeObject.time,self.report.options.timeObject.field))},dateFilterUpdated:function(fulldate){this.$refs["widgetChildComponent"]&&this.$refs["widgetChildComponent"].setDateFilter(fulldate)},timeForm:function(time,option){return"D"===option?moment_default()(time[0]).calendar().split(" at")[0]:"W"===option||"M"===option||"Y"===option?moment_default()(time[0]).tz(this.$timezone).format("MMM DD, YYYY")+" - "+moment_default()(time[1]).tz(this.$timezone).format("MMM DD, YYYY"):""},getThisperiod:function(option){return"D"===option?"Today":"W"===option?"This Week":"M"===option?"This Month":"Y"===option?"This Year":""},selectPeriod:function(period){this.selectedPeriod=period.value,this.widget.header.subtitle=period.value},getPeriod:function(period){switch(period=period.toLowerCase(),period){case"current week":var firstDay=moment_default()().startOf("week"),endDay=moment_default()().endOf("week");return moment_default()(firstDay).format("DD")+" - "+moment_default()(endDay).format("DD MMM YYYY");case"last week":var lastWeekStart=moment_default()().subtract(1,"weeks").startOf("week"),lastWeekEnd=moment_default()().subtract(1,"weeks").endOf("week");return moment_default()(lastWeekStart).format("DD")+" - "+moment_default()(lastWeekEnd).format("DD MMM YYYY");case"today":return moment_default()(new Date).format("DD MMM YYYY")}return period},openReport:function(id,widget){var _widget$dataOptions;if(this.newWidgetOptionsPopoverToggle=!1,5!==(null===widget||void 0===widget||null===(_widget$dataOptions=widget.dataOptions)||void 0===_widget$dataOptions?void 0:_widget$dataOptions.reportType)){var currentModule=this.getCurrentModule();if("view"===widget.type){var modulePath="";"workorder"===widget.dataOptions.moduleName?modulePath="/app/wo/orders/"+widget.dataOptions.viewName:"alarm"!==widget.dataOptions.moduleName&&"alarmoccurrence"!==widget.dataOptions.moduleName&&"readingalarmoccurrence"!==widget.dataOptions.moduleName&&"mlalarmoccurrence"!==widget.dataOptions.moduleName&&"violationalarmoccurrence"!==widget.dataOptions.moduleName&&"baseevent"!==widget.dataOptions.moduleName&&"newreadingalarm"!==widget.dataOptions.moduleName||(modulePath="/app/fa/faults/"+widget.dataOptions.viewName),this.$router.push(modulePath)}else{var moduleName=null,_modulePath=null;if(moduleName=widget.dataOptions.newReport?widget.dataOptions.newReport.module.name:currentModule.module,(0,router/* isWebTabsEnabled */.tj)()&&widget.dataOptions.newReportId){var routeObj;routeObj=moduleName?"energydata"===moduleName?(0,router/* findRouteForReport */.Mq)("analytics_reports",router/* pageTypes */.As.REPORT_VIEW,{moduleName:moduleName}):(0,router/* findRouteForReport */.Mq)("module_reports",router/* pageTypes */.As.REPORT_VIEW,{moduleName:moduleName}):(0,router/* findRouteForReport */.Mq)("analytics_reports",router/* pageTypes */.As.REPORT_VIEW);var _ref6=routeObj||{},_name2=_ref6.name,params={reportid:widget.dataOptions.newReportId};return void((0,validation/* isEmpty */.xb)(_name2)?this.$dialog.confirm({title:this.$t("common._common.tab_not_configured"),message:this.$t("common._common.tab_not_configured_message"),rbLabel:this.$t("common._common.ok"),lbHide:!0}):this.$router.push({name:_name2,params:params}))}if(_modulePath=["workorder","workorderLabour","workorderCost","workorderItem","workorderTools","workorderService","workorderTimeLog","workorderHazard","plannedmaintenance"].includes(moduleName)?"/app/wo":["alarm","newreadingalarm","readingalarmoccurrence","bmsalarm","mlAnomalyAlarm","anomalyalarmoccurrence","violationalarm","violationalarmoccurrence","operationalarm","operationalarmoccurrence","sensoralarm","sensoralarmoccurrence","sensorrollupalarm","sensorrollupalarmoccurrence","basealarm","alarmoccurrence","readingevent","bmsevent","mlAnomalyEvent","violationevent","operationevent","sensorevent","baseevent"].includes(moduleName)?"/app/fa":"energydata"===moduleName?"/app/em":["inspectionTemplate","inspectionResponse"].includes(moduleName)?"/app/inspection":["asset","assetbreakdown","vendors"].includes(moduleName)?"/app/at":["tenant","tenantcontact","tenantunit","quote","contact","tenantspaces","quotelineitems","quoteterms","people","newsandinformationsharing","neighbourhoodsharing","dealsandofferssharing","contactdirectorysharing","admindocumentsharing","audienceSharing"].includes(moduleName)?"/app/tm":["contracts","purchasecontracts","labourcontracts","warrantycontracts","rentalleasecontracts","purchasecontractlineitems","labourcontractlineitems","warrantycontractlineitems","rentalleasecontractlineitems"].includes(moduleName)?"/app/ct":["visitorlog","visitor","invitevisitor","watchlist"].includes(moduleName)?"/app/vi":["serviceRequest"].includes(moduleName)?"/app/sr":["purchaseorder","purchaseorderlineitems","purchaserequest","poterms","purchaserequestlineitems"].includes(moduleName)?"/app/purchase":["budget","budgetamount"].includes(moduleName)?"/app/ac":["item","tool","itemTransactions","tootTransactions","itemTypes","toolTypes","storeRoom","shipment","transferrequest","transferrequestshipmentreceivables","transferrequestpurchaseditems"].includes(moduleName)?"/app/inventory":void 0!==widget.dataOptions.newReport&&widget.dataOptions.newReport.module.custom||currentModule.custom?"/app/ca":"/app/at",this.$helpers.isEtisalat()){var url="/app/em/modulereports/newview/"+widget.dataOptions.newReportId;return void this.$router.push(url)}if(widget.dataOptions.newReportId){var _url=_modulePath+"/reports/newview/"+widget.dataOptions.newReportId;this.$router.push(_url)}else if(id){var _url2=_modulePath+"/reports/view/"+id;if(this.$route.params&&"buildingdashboard"===this.$route.params.dashboardlink&&this.$route.params.buildingid){var data={buildingid:parseInt(this.$route.params.buildingid)};this.$router.push({path:_url2,query:{reportSpaceFilterContext:JSON.stringify(data)}})}else if(this.$route.params&&("chillerplant"===this.$route.params.dashboardlink||"chillers"===this.$route.params.dashboardlink)&&this.$route.params.buildingid){var _data={chillerId:parseInt(this.$route.params.buildingid)};this.$router.push({path:_url2,query:{reportSpaceFilterContext:JSON.stringify(_data)}})}else this.$router.push(_url2)}}}else{var _widget$dataOptions2,route_url="/app/em/pivot/view/".concat(null===widget||void 0===widget||null===(_widget$dataOptions2=widget.dataOptions)||void 0===_widget$dataOptions2?void 0:_widget$dataOptions2.newReportId);if((0,router/* isWebTabsEnabled */.tj)()){var _findRouteForTab2,_widget$dataOptions3,_ref5=null!==(_findRouteForTab2=(0,router/* findRouteForTab */.OD)(router/* pageTypes */.As.PIVOT_VIEW))&&void 0!==_findRouteForTab2?_findRouteForTab2:{},name=_ref5.name;if((0,validation/* isEmpty */.xb)(name))this.$dialog.confirm({title:this.$t("common._common.tab_not_configured"),message:this.$t("common._common.tab_not_configured_message"),rbLabel:this.$t("common._common.ok"),lbHide:!0});else route_url=this.$router.resolve({name:name,params:{reportId:null===widget||void 0===widget||null===(_widget$dataOptions3=widget.dataOptions)||void 0===_widget$dataOptions3?void 0:_widget$dataOptions3.newReportId}}).href,this.$router.push(route_url);return}this.$router.push(route_url)}},openPivotReport:function(id){this.$router.push("/app/em/pivot/view/".concat(id))},openGraphics:function(id){this.newWidgetOptionsPopoverToggle=!1;var url="/app/em/graphics/view/"+id;this.$router.push({path:url})},openGraphicsInAnalytics:function(id){this.newWidgetOptionsPopoverToggle=!1,this.$refs["widgetComponent"]&&this.$refs["widgetComponent"].openInAnalytics(id)},exportGraphicsAsImage:function(id){this.newWidgetOptionsPopoverToggle=!1,this.$refs["widgetComponent"]&&this.$refs["widgetComponent"].exportAsImage(id)},getCurrentModule:function(){var routeObj=this.$route,module=null,rootPath=null;if(routeObj.meta.module)module=routeObj.meta.module,rootPath=routeObj.path;else if(routeObj.matched){var _step3,_iterator3=(0,createForOfIteratorHelper/* default */.Z)(routeObj.matched);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var matchedRoute=_step3.value;if(matchedRoute.meta.module){module=matchedRoute.meta.module,rootPath=matchedRoute.path;break}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return{module:module,rootPath:rootPath}},editHelpText:function(){this.newWidgetOptionsPopoverToggle=!1,this.$emit("helpTextConfig",this.widget)},deleteChart:function(widget,dashboard){this.newWidgetOptionsPopoverToggle=!1;var data={widgetId:widget.id,dashboardId:dashboard,widget:widget};this.$emit("deletechart",data)},editWidget:function(widget,dashboard){widget.dataOptions&&(widget.dataOptions.edit=!0),this.$emit("editwidget",widget),this.newWidgetOptionsPopoverToggle=!1},hideWidget:function(widget,dashboard){var data={widgetId:widget.id,dashboardId:dashboard,widget:widget};this.$emit("hidewidget",data)},editheader:function(){this.changeheader=!0},titlechage:function(){},blurevent:function(){""===this.widget.header.title||null===this.widget.header.title?this.changeheader=!0:this.changeheader=!1,this.$emit("widget",this.widget)},addwidgetHedaer:function(){this.changeheader=!0},viewHeader:function(header){return!(this.graphicsOptions&&this.graphicsOptions.hideHeader&&!this.mode)&&(!!(header&&header.title||"chart"==this.widget.type)||!!this.changeheader)},getReportutil:function(data){this.ChartType=data.ChartType?data.ChartType:"line"},sendReportUtil:function(data){this.sendUtil=data}}},widget_FWidgetvue_type_script_lang_js=FWidgetvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(widget_FWidgetvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FWidget=component.exports},
/***/797995:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return CriteriaTable}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/CriteriaTable.vue?vue&type=template&id=57ecf97f
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fc-report-pdf-details mT40"},[_c("div",{staticClass:"fc-report-pdf-heading"},[_vm._v(" REPORT CONDITIONS "),_vm.criteriaObj.conditions.length>1?_c("span",{staticClass:"fw4"},[_vm._v("( Matching Criteria : "+_vm._s(_vm.criteriaObj.pattern)+" )")]):_vm._e()]),_c("div",{staticClass:"pT20 flex-middle flex-wrap"},[_vm._l(_vm.criteriaObj.conditions,(function(condition,index){return[_c("div",{key:index,staticClass:"fc-report-pdf-border mB20 report-option-table",class:100===condition.width?"width50":"width100"},[_c("table",{staticClass:"width100"},[_c("td",{staticClass:"fc-rpeort-pdf-col-bg text-center",staticStyle:{width:"7%"}},[_vm._v(" "+_vm._s(condition.key)+" ")]),_c("td",{staticClass:"fc-report-pdf-border-left pl10",class:(condition.width,"width25")},[_vm._v(" "+_vm._s(condition.field)+" ")]),_c("td",{staticClass:"fc-report-pdf-border-left pl10 pR10 text-lowercase",class:(condition.width,"width25")},[_vm._v(" "+_vm._s(condition.operator)+" ")]),_c("td",{staticClass:"fc-report-pdf-border-left pl10 pR10",class:"width100"===condition.width?"width60":"width70"},[_vm._v(" "+_vm._s(_vm.formatCriteriaValue(condition.value,condition.fieldType))+" ")])])])]}))],2)])},staticRenderFns=[],CriteriaTablevue_type_script_lang_js=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(506203),{props:["criteriaObj"],mounted:function(){var _this=this;this.criteriaObj.conditions.forEach((function(condition){condition.value&&condition.value.length>30&&_this.$set(condition,"width",100)}))},methods:{formatCriteriaValue:function(valueArray,type){var self=this,values=[];return Array.isArray(valueArray)&&("Date"==type?valueArray.forEach((function(value){-1!=value&&values.push(self.$options.filters.formatDate(value,!0))})):"DateTime"==type?valueArray.forEach((function(value){-1!=value&&values.push(self.$options.filters.formatDate(value))})):values=valueArray),values.join(", ")}}}),report_CriteriaTablevue_type_script_lang_js=CriteriaTablevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(report_CriteriaTablevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,CriteriaTable=component.exports},
/***/518999:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return ModuleNewReport}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/ModuleNewReport.vue?vue&type=template&id=8119bcec
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100 mobile-report"},[_c("div",{staticClass:"datefilter-hide-overlay"}),_vm.showHeadingOnlyForPdf&&_vm.pdfloading?_c("div",{staticClass:"text-center label-txt-black4 bold pB20"},[_vm.excludeParamsObj.title&&_vm.excludeParamsObj.logo?_vm._e():_c("div",{staticClass:"report-pdf-header",staticStyle:{overflow:"hidden"}},[_vm.$org.logoUrl?_c("div",{staticClass:"fc-report-cus-logo",class:{"logo-visible":_vm.excludeParamsObj.logo}},[_c("img",{staticStyle:{width:"100px",height:"50px"},attrs:{src:_vm.$org.logoUrl}})]):_c("div",{staticClass:"fc-logo-report",class:{"logo-visible":_vm.excludeParamsObj.logo}},[_vm.showLogo?_c("img",{attrs:{src:_vm.getFacilioLogoURL}}):_vm._e()]),_vm.excludeParamsObj.title?_vm._e():_c("div",{staticClass:"f18 fc-widget-label ellipsis max-width350px"},[_vm._v(" "+_vm._s(_vm.reportPdfData.report.name||"Report")+" ")])]),_vm.showPrintDetails||_vm.printView?_c("div",{staticClass:"fc-report-author-sec pdf-margin-top pdf-text-left"},[_vm.excludeParamsObj.description?_vm._e():_c("div",[_c("div",{staticClass:"fc-report-author-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.generated_on"))+" "),_c("span",{staticClass:"fw6 pdf-left-margin"},[_vm._v(" "+_vm._s(_vm.formatDate())+" ")])]),_c("div",{staticClass:"fc-report-author-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.generated_by"))+" "),_c("span",{staticClass:"fw6 pdf-left-margin"},[_vm._v(" "+_vm._s(_vm.$account.user.name)+" ")])])]),_vm.excludeParamsObj.filter?_vm._e():_c("div",[_vm.getDateRangeString.dateFieldLabel||_vm.getDateRangeString.label?_c("div",{staticClass:"fc-report-author-txt flex-middle"},[_vm._v(" "+_vm._s(_vm.$t("common.date_picker.date_range")+":")+" "),_c("div",{staticClass:"f9 fw6 pdf-left-margin"},[_c("span",{staticClass:"fc-report-author-txt"},[_vm._v(_vm._s(""!==_vm.getDateRangeString.dateFieldLabel?_vm.getDateRangeString.dateFieldLabel.concat(":"):""))]),_vm._v(" "+_vm._s(_vm.getDateRangeString.label)+" ")])]):_vm._e(),_vm._l(_vm.dataObj,(function(value,key,index){return _c("div",{key:index,staticClass:"fc-report-author-txt"},[_vm._v(" "+_vm._s(key+":")+" "),_c("span",{staticClass:"fw6 pdf-left-margin"},[_vm._v(" "+_vm._s(" "+value)+" ")])])}))],2)]):_vm._e()]):_vm._e(),_vm.config&&_vm.widgetDatePicker?_c("portal",{staticClass:"tabulardata-datepicker",attrs:{to:"widget-datepicker"+_vm.config.widget.id,slim:""}},[!_vm.hideTimelineFilterInsideWidget&&_vm.dateFilter?_c("new-date-picker",{key:_vm.datePickerCompKey,staticClass:"filter-field date-filter-comp-new-report inline",attrs:{zone:_vm.$timezone,dateObj:_vm.dateFilter},on:{date:_vm.setDateFilter}}):_vm._e()],1):[!_vm.hideTimelineFilterInsideWidget&&_vm.showDatePicker?_c("div",{staticStyle:{"text-align":"center"}},[_c("new-date-picker",{key:_vm.datePickerCompKey,staticClass:"filter-field date-filter-comp-new-report",attrs:{disabled:!!_vm.drilldownDatePickerObj,zone:_vm.$timezone,dateObj:_vm.dateFilter},on:{date:_vm.setDateFilter}})],1):_vm._e()],_vm.resultObj&&_vm.resultObj.report.userFilters&&null!==_vm.userFilters?_c("div",{staticClass:"mT5 modular-user-filter"},[_c("ModularUserFilterRender",{attrs:{widgetConfig:_vm.config,filterConfiguration:_vm.userFilters},on:{emitChangedValue:_vm.setUserFilter}})],1):_vm._e(),_vm.loading?_c("Spinner",{attrs:{show:_vm.loading,size:"80"}}):_vm.failed?_c("div",{staticStyle:{"margin-top":"30px",opacity:"0.7","font-size":"13px",padding:"50px","line-height":"25px","text-align":"center"}},[_c("div",[_vm._v(_vm._s(_vm.$t("home.dashboard.data_loading_failed")))])]):_vm.noData?_c("div",{staticClass:"report-no-data-cotainer-wrapper"},[_vm.drilldownParams?_c("drilldown-breadcrumb",{attrs:{drilldownParams:_vm.drilldownParams},on:{crumbClick:_vm.handleCrumbClick}}):_vm._e(),_c("div",{staticClass:"report-no-data-container"},[_c("inline-svg",{attrs:{src:"svgs/emptystate/reportlist",iconClass:"icon text-center icon-100"}}),_c("div",{staticClass:"nowo-label f13"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.empty_data"))+" "),_vm.resultObj&&_vm.resultObj.dateRange?_c("span",{staticClass:"bold"},[_vm._v(_vm._s(_vm._f("formatPeriod")(_vm.resultObj.dateRange.value,"MMM DD, YYYY")))]):_vm._e()])],1)],1):_c("div",{staticClass:"height100",class:{scrollable:_vm.reportObj&&_vm.reportObj.options&&!1===_vm.reportObj.options.settings.chart}},[_vm._e(),!0===_vm.reportObj.options.settings.chart?_c("div",{staticClass:"fc-single-chart-pdf",class:{height100:_vm.config||_vm.height}},[_vm.isHeatMap||_vm.isTreeMap?_vm._e():_c("f-new-chart",{ref:"newChart",attrs:{showWidgetLegends:_vm.reportObj&&_vm.reportObj.options&&_vm.reportObj.options.widgetLegend.show,isWidget:_vm.config||_vm.isWidget,width:_vm.config&&_vm.config.width?_vm.config.width:null,resultObj:_vm.resultObj,config:_vm.config,height:_vm.config&&_vm.config.height?_vm.config.height:_vm.height,data:_vm.reportObj.data,options:_vm.reportObj.options,alarms:_vm.reportObj.alarms,dateRange:_vm.reportObj.dateRange,hidecharttypechanger:_vm.$mobile||_vm.isWidget,drilldownParams:_vm.drilldownParams},on:{drilldown:_vm.handleClickAction,crumbClick:_vm.handleCrumbClick}}),_vm.isHeatMap&&!_vm.isTreeMap?_c("FNewHeatMap",{ref:"heatmap",attrs:{config:_vm.config,width:_vm.widgetWidth,height:_vm.widgetHeight,resultObject:_vm.resultObj,reportObject:_vm.reportObj},on:{"update:width":function($event){_vm.widgetWidth=$event},"update:height":function($event){_vm.widgetHeight=$event}}}):_vm._e(),!_vm.isHeatMap&&_vm.isTreeMap?_c("FTreeMap",{ref:"treemap",attrs:{config:_vm.config,resultObject:_vm.resultObj,width:_vm.widgetWidth,height:_vm.widgetHeight,reportObject:_vm.reportObj},on:{"update:width":function($event){_vm.widgetWidth=$event},"update:height":function($event){_vm.widgetHeight=$event}}}):_vm._e()],1):_vm._e(),!_vm.reportObj||"undefined"!==typeof _vm.config&&!1!==_vm.reportObj.options.settings.chart||"undefined"!==typeof _vm.hideTabs&&_vm.hideTabs||_vm.showOnlyImage||_vm.excludeParamsObj.table||_vm.isWidget?_vm._e():_c("div",[_vm.config?_c("portal",{staticClass:"tabulardata-datepicker",attrs:{to:"widget-period"+_vm.config.widget.id,slim:""}},[_c("div",{staticClass:"widget-tabular-date"},[_c("div",{staticClass:"f14 fw6"},[_c("span",[_vm._v(_vm._s(""!==_vm.getDateRangeString.dateFieldLabel?_vm.getDateRangeString.dateFieldLabel.concat(":"):""))]),_vm._v(" "+_vm._s(_vm.getDateRangeString.label)+" ")])])]):_vm._e(),!1!==_vm.failed||!1!==_vm.loading||!1!==_vm.reportObj.options.settings.chart||_vm.isPrinting?_vm._e():_c("modular-new-tabular-report",{ref:"newTable",staticClass:"new-analytics-table",attrs:{reportObject:_vm.resultObj,reportConfig:_vm.reportObj}}),_vm.isPrinting?[_vm.criteriaObj?_c("criteria-table",{attrs:{criteriaObj:_vm.criteriaObj}}):_vm._e(),_c("div",{staticClass:"tabular-print-heading"},[_vm._v(" "+_vm._s(_vm.$t("home.dashboard.report_summary"))+" ")]),_c("modular-new-tabular-report",{ref:"newTable",staticClass:"new-analytics-table fc-report-pdf-tabular",attrs:{printReverse:!0,reportObject:_vm.resultObj,reportConfig:_vm.reportObj}}),_c("div",{staticClass:"underlying-data-cut-page"},[_c("div",{staticClass:"tabular-print-heading mL0 mT0 mB20"},[_vm._v(" "+_vm._s(_vm.resultObj.report.name)+" ")]),_c("underlying-workorders",{staticClass:"underlying-report-print",attrs:{module:_vm.computedModule,reportObject:_vm.reportObj,resultObject:_vm.resultObj}})],1)]:[!1===_vm.failed&&!1===_vm.loading&&!0===_vm.reportObj.options.settings.chart?_c("el-tabs",{staticClass:"report-tab",staticStyle:{"padding-top":"20px"},model:{value:_vm.activeReportTab,callback:function($$v){_vm.activeReportTab=$$v},expression:"activeReportTab"}},[_c("el-tab-pane",{attrs:{label:_vm.$t("home.dashboard.tabular_report"),name:"tabular"}},[_c("modular-new-tabular-report",{ref:"newTable",staticClass:"new-analytics-table",attrs:{reportObject:_vm.resultObj,reportConfig:_vm.reportObj}})],1),_c("el-tab-pane",{attrs:{label:_vm.$t("home.dashboard.underlying")+" "+_vm.getModuleString,name:"underlying"}},[_c("underlying-workorders",{ref:"underlyingWorkOrders",attrs:{module:_vm.computedModule,reportObject:_vm.reportObj,resultObject:_vm.resultObj}})],1)],1):_vm._e()]],2)],1),_vm.showListView&&_vm.listView?_c("el-dialog",{attrs:{title:_vm.listView.title||"VIEW",visible:_vm.showListView,"append-to-body":!0,"custom-class":"f-popup-view fc-dialog-center-body-p0 fc-dialog-center-body-m0 fc-card-popup-list-view",top:"0%","before-close":_vm.closeListView},on:{"update:visible":function($event){_vm.showListView=$event}}},[_c("template",{slot:"title"},[_c("div",{staticClass:"flex-middle justify-content-space"},[_c("div",{staticClass:"label-txt-black fwBold"},[_vm._v(" "+_vm._s(_vm.listView.title||"VIEW")+" ")])])]),_c("CustomTable",{staticClass:"list-view-widget custom-view-table",attrs:{moduleName:_vm.listView.moduleName,viewname:"all",viewMode:!0,filterJSON:_vm.listView.filters}})],2):_vm._e()],2)},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),regeneratorRuntime=__webpack_require__(150124),defineProperty=__webpack_require__(482482),objectSpread2=__webpack_require__(595082),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),NewDatePicker=(__webpack_require__(169358),__webpack_require__(434284),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(634338),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(450886),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(648324),__webpack_require__(689730),__webpack_require__(900773)),validation=__webpack_require__(990260),FNewChart=__webpack_require__(875963),FNewHeatMap=__webpack_require__(283938),FTreeMap=__webpack_require__(650976),NewDataFormatHelper=__webpack_require__(804911),ModularNewTabularReport=__webpack_require__(340737),NewDateHelper=__webpack_require__(105534),UnderlyingWorkorders=__webpack_require__(722784),FChartSettings=__webpack_require__(746036),ModularAnalyticmixin=__webpack_require__(795e3),modularUserFilter=__webpack_require__(884900),ModularUserFilterRender=__webpack_require__(955220),CriteriaTable=__webpack_require__(797995),moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),NewReportSummaryHelper=__webpack_require__(601458),lodash=__webpack_require__(496486),CustomViewTableComponent=__webpack_require__(214090),ReportDrilldownMixin=__webpack_require__(425157),DrilldownBreadcrumb=__webpack_require__(374520),api=__webpack_require__(32284),Spinner=__webpack_require__(604947),ModuleNewReportvue_type_script_lang_js={props:["id","config","tabular","hideTabs","dbFilterJson","dbTimelineFilter","isWidget","qs","isLazyDashboard","isVisibleInViewport","showHeadingOnlyForPdf"],mixins:[NewDataFormatHelper/* default */.Z,ModularAnalyticmixin/* default */.Z,modularUserFilter/* default */.Z,NewReportSummaryHelper/* default */.Z,ReportDrilldownMixin/* default */.Z],components:{NewDatePicker:NewDatePicker/* default */.Z,ModularNewTabularReport:ModularNewTabularReport/* default */.Z,UnderlyingWorkorders:UnderlyingWorkorders/* default */.Z,FNewChart:FNewChart/* default */.Z,ModularUserFilterRender:ModularUserFilterRender/* default */.Z,FChartSettings:FChartSettings/* default */.Z,CriteriaTable:CriteriaTable/* default */.Z,FNewHeatMap:FNewHeatMap/* default */.Z,FTreeMap:FTreeMap/* default */.Z,CustomTable:CustomViewTableComponent/* default */.Z,DrilldownBreadcrumb:DrilldownBreadcrumb/* default */.Z,Spinner:Spinner/* default */.Z},data:function(){return{metaField:[],displayObject:{},isFilterApplied:!1,activeReportTab:"tabular",pdfloading:!1,loading:!0,failed:!1,noData:!1,reportObj:null,reportPdfData:[],resultObj:null,showReportOptions:!1,dateFilter:null,userFilterApplied:null,userFilters:null,moduleName:null,moduleId:null,moduleResourceField:null,showDatePicker:!1,firstLoad:!0,datePickerCompKey:1,
//new refresh impl, remove syncPicker soon
criteriaObj:null,height:null,widgetWidth:null,widgetHeight:null,showListView:!1,listView:null,
// chartDimensions:{
//   'width': 980,
//   'height': 800
// },
heatMapOptions:{Colors:{Default:["#5EC343","#90E214","#E9F600","#FDA504","#F47533"],"Palette 1":["#40AF22","#77C700","#FFA000","#F76E0C","#E54619"],"Palette 2":["#16AC99","#037E80","#004852","#D25A38","#E8721E"],"Palette 3":["#70B804","#2DA70C","#006A6D","#002E5B","#2E004D"],"Palette 4":["#00AAB3","#009BC2","#2872C7","#623CB7","#C84D99"],"Palette 5":["#3A688A","#27916F","#44AE7A","#A4B83B","#839A08"],"Palette 6":["#4BB82D","#2DA70C","#44AE7A","#18898B","#076163"],"Palette 7":["#AFE7FF","#87DBFF","#69D2FF","#64C2FF","#53B4F2"],"Palette 8":["#C5E3FF","#FFB5B4","#B0F7CF","#C1A4FF","#FDCEE3"],"Palette 9":["#32AEF9","#1F98E3","#177ABD","#1869A0","#135582"],"Palette 10":["#FFA000","#FF7E30","#E02564","#500083","#0B0310"],"Palette 11":["#1CACEE","#009BE2","#3674FF","#0150FF","#1700FF"],"Palette 12":["#E8E4FF","#D8D1FD","#BDABF6","#AA90FB","#987AF4"],"Palette 13":["#00BBA4","#009BC2","#4D60A6","#4E177D","#4A0052"],"Palette 14":["#FFF2B5","#F7E383","#FFA085","#F4797B","#DF6A6B"],"Palette 15":["#F7E383","#F4D814","#FFC05C","#FFAA82","#FF9665"],"Palette 16":["#DC687F","#24C4BC","#366CBA","#30B089","#0297CC"]},chosenColors:"Default",minValue:null,maxValue:null,showGrandParent:!0,showColorScale:!0,showWidgetLegends:!1,treemapTextMode:2},excludeParamsObj:{}}},created:function(){
//on report load , db date filter overrides report date filter . on further change of either ,the last change is applied
if(!(0,validation/* isEmpty */.xb)(this.dbTimelineFilter)){var pickerObj=NewDateHelper/* default */.Z.getDatePickerObject(this.dbTimelineFilter.operatorId,this.dbTimelineFilter.dateValueString);this.dateFilter=pickerObj}if(this.qs){var qsParams=this.getQueryStringParams(this.qs);if(qsParams.startTime&&qsParams.endTime){var _pickerObj=NewDateHelper/* default */.Z.getDatePickerObject(20,qsParams.startTime+","+qsParams.endTime);this.dateFilter=_pickerObj}}},mounted:function(){var _JSON$parse,_this$$route$query$ex=this.$route.query.excludeParams,excludeParams=void 0===_this$$route$query$ex?{}:_this$$route$query$ex;this.excludeParamsObj=(0,validation/* isEmpty */.xb)(excludeParams)?{}:null!==(_JSON$parse=JSON.parse(excludeParams))&&void 0!==_JSON$parse?_JSON$parse:{},this.init(),
// temp
this.isPrinting&&(this.height=300)},computed:{getFacilioLogoURL:function(){var brandConfig=this.brandConfig,logo=this.$getProperty(brandConfig,"logo",null);return logo},showLogo:function(){var brandConfig=this.brandConfig,showLogoInPDF=this.$getProperty(brandConfig,"showLogoInPDF",!0);return showLogoInPDF},brandConfig:function(){return window.brandConfig},dataObj:function(){var _ref=this||{},_ref$displayObject=_ref.displayObject,displayObject=void 0===_ref$displayObject?{}:_ref$displayObject;return displayObject},widgetDatePicker:function(){return!!(this.reportObj&&this.reportObj.options&&this.reportObj.options.settings&&!this.reportObj.options.settings.chart&&this.reportObj.options.settings.table)},hideTimelineFilterInsideWidget:function(){var _this$config;return!(null===(_this$config=this.config)||void 0===_this$config||null===(_this$config=_this$config.dashboardObj)||void 0===_this$config||null===(_this$config=_this$config.dashboardFilter)||void 0===_this$config||!_this$config.hideFilterInsideWidgets)&&this.config.dashboardObj.dashboardFilter.hideFilterInsideWidgets},isHeatMap:function(){return!(!this.reportObj||!this.reportObj.options||"heatmap"!==this.reportObj.options.type)&&(this.widgetWidth=this.$el.clientWidth,this.widgetHeight=this.$mobile?this.config.height:this.$el.clientHeight-30,!0)},isTreeMap:function(){return!(!this.reportObj||!this.reportObj.report||7!==this.reportObj.report.analyticsType)&&(this.widgetWidth=this.$el.clientWidth,this.widgetHeight=this.$mobile?this.config.height:this.$el.clientHeight-30,!0)},filters:function(){return this.$route.query.filters?this.$route.query.filters:null},computedModule:function(){var module={};return module["moduleName"]=this.moduleName,module["moduleId"]=this.moduleId,this.moduleResourceField&&(module["resourceField"]=this.moduleResourceField),module},isPrinting:function(){return this.showHeadingOnlyForPdf?null:this.$route.query.print||this.$route.query.daterange},isGroupByCrossModule:function(){if(this.resultObj.report.dataPoints[0].hasOwnProperty("groupByFields")&&null!==this.resultObj.report.dataPoints[0].groupByFields){var groupField=this.resultObj.report.dataPoints[0].groupByFields[0];return!(groupField.field.module.name===this.resultObj.report.module.name||this.resultObj.report.module.extendModule&&groupField.field.module.name===this.resultObj.report.module.extendModule.name)}return!1},isXFieldCrossModule:function(){var xAxis=this.resultObj.report.dataPoints[0].xAxis;return!(xAxis.field.module.name===this.resultObj.report.module.name||this.resultObj.report.module.extendModule&&xAxis.field.module.name===this.resultObj.report.module.extendModule.name)},reportId:function(){return this.id?this.id:this.config?this.config.widget.dataOptions.newReportId:null},appliedDateRange:function(){return this.$route.query.daterange?JSON.parse(this.$route.query.daterange):""},getModuleString:function(){var _this=this;if(-1!==this.resultObj.report.moduleType&&this.resultObj.moduleTypes&&0!==this.resultObj.moduleTypes.length){var moduleName=this.resultObj.moduleTypes.filter((function(type){return type.type===_this.resultObj.report.moduleType}))[0].displayName;return moduleName}return this.resultObj.report.module&&this.resultObj.report.module.custom?this.resultObj.report.module.displayName:this.resultObj.report.module.name+"s"},appliedChartType:function(){
// Temp...will be changed for pdf once temp report support is implemented
return this.$route.query.charttype},getDateRangeString:function(){var temp={dateFieldLabel:"",label:""};if(this.resultObj){var dateField=this.resultObj.report.dataPoints[0].dateField,xField=this.resultObj.report.dataPoints[0].xAxis,dateFieldString="";if(xField&&(xField&&dateField&&xField.fieldId!==dateField.fieldId&&(temp["dateFieldLabel"]=dateField.label),dateField)){var a=moment_timezone_default()(this.resultObj.report.dateRange.startTime);return dateFieldString=a.format("DD/MM/YYYY")+" to ",a=moment_timezone_default()(this.resultObj.report.dateRange.endTime),dateFieldString=dateFieldString+a.format("DD/MM/YYYY")+" ",temp["label"]=dateFieldString,temp}return temp}return temp}},watch:{userFilters:function(newValue){var filters=this.$route.query.filters;(0,validation/* isEmpty */.xb)(newValue)||!this.showHeadingOnlyForPdf||(0,validation/* isEmpty */.xb)(JSON.parse(filters))||this.pdfUserFilter(JSON.parse(filters))},
//when widget at bottom of dashboard is scrolled up , this prop changes from false to true,
isVisibleInViewport:function(newValue,oldValue){newValue&&this.init()},dbFilterJson:function(newValue,oldValue){(0,lodash.isEqual)(newValue,oldValue)||this.init()},dbTimelineFilter:function(newValue,oldValue){if(!(0,lodash.isEqual)(newValue,oldValue)){var pickerObj=NewDateHelper/* default */.Z.getDatePickerObject(newValue.operatorId,newValue.dateValueString);
//when dashboard filter is changed, need to refresh widget  ,call setDateFilter
this.dateFilter=pickerObj,this.init(),this.datePickerCompKey++}},reportId:{handler:function(newData,oldData){this.dateFilter=null,this.showDatePicker=!1,this.userFilters=null,this.resetDrillDown(),this.init(!1)}},filters:{handler:function(newData,oldData){newData!==oldData&&this.init(!1)},deep:!0},config:{handler:function(newData,oldData){newData&&oldData?newData.id!==oldData.id?this.init(!1):((this.isHeatMap||this.isTreeMap)&&(this.widgetWidth=this.$el.clientWidth,this.widgetHeight=this.$mobile?this.config.height:this.$el.clientHeight-30,this.$refs["heatmap"]&&this.$refs["heatmap"].resize()),this.$emit("reportLoaded",this.reportObj,this.resultObj)):this.init(!1)},deep:!0}},methods:{getFields:function(fieldId){var fieldName=(this.metaField||[]).reduce((function(fieldNameList,field){return fieldId===field.id?[].concat((0,toConsumableArray/* default */.Z)(fieldNameList),[field.name]):fieldNameList}),[]);return fieldName[0]},pdfUserFilter:function(filter){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var validFilterObj,_loop,i,_this2$userFilters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_this2.isFilterApplied=!0,validFilterObj=(Object.keys(filter)||[]).reduce((function(filterObj,userFilter){var temp={},selectedVal=filter[userFilter].value;return(0,validation/* isEmpty */.xb)(selectedVal)||(temp[userFilter]=selectedVal),(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},filterObj),temp)}),{}),_loop=(0,regeneratorRuntime/* default */.Z)().mark((function _loop(){var currentEle,fieldName,selectedValues,displayVal,filters,_yield$API$get,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(currentEle=_this2.userFilters[i],fieldName=(0,validation/* isEmpty */.xb)(currentEle.criteria)?_this2.getFields(currentEle.fieldId):_this2.$getProperty(currentEle,"criteria.conditions.1.fieldName")||"",selectedValues=validFilterObj[fieldName],displayVal=[],(0,validation/* isEmpty */.xb)(selectedValues)){_context.next=15;break}if(displayVal=currentEle.allValues.filter((function(value){return!!selectedValues.includes(Object.keys(value)[0])})).map((function(value){return value[Object.keys(value)[0]]})),!(0,validation/* isEmpty */.xb)(displayVal)){_context.next=14;break}return filters=JSON.stringify((0,defineProperty/* default */.Z)({},fieldName,filter[fieldName])),_context.next=10,api/* API */.bl.get("/v3/picklist/".concat(currentEle.lookupModuleName),{filters:filters});case 10:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error||(displayVal=data.pickList.map((function(ele){return ele.label})));case 14:(0,validation/* isEmpty */.xb)(displayVal)||(_this2.displayObject=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},_this2.displayObject),{},(0,defineProperty/* default */.Z)({},currentEle.name,displayVal)));case 15:case"end":return _context.stop()}}),_loop)})),i=0;case 4:if(!(i<(null===(_this2$userFilters=_this2.userFilters)||void 0===_this2$userFilters?void 0:_this2$userFilters.length))){_context2.next=9;break}return _context2.delegateYield(_loop(),"t0",6);case 6:i++,_context2.next=4;break;case 9:case"end":return _context2.stop()}}),_callee)})))()},getQueryStringParams:function(qs){var params={};if(qs){var _step,qsList=qs.split("&"),_iterator=(0,createForOfIteratorHelper/* default */.Z)(qsList);try{for(_iterator.s();!(_step=_iterator.n()).done;){var qsEntry=_step.value,key=qsEntry.split("=")[0],value=qsEntry.split("=")[1];params[key]=value}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return params},setUserFilter:function(val){this.userFilters=val,this.$forceUpdate(),this.initchart()},handleClickAction:function(val){var _this$resultObj$repor=this.resultObj.report.reportSettings,clickActionEnum=_this$resultObj$repor.clickActionEnum,isShowListAtDrillEnd=_this$resultObj$repor.isShowListAtDrillEnd;"DRILLDOWN"==clickActionEnum?this.handleReportDrillDown(val,isShowListAtDrillEnd):"LIST"==clickActionEnum&&this.drilltoList(val)},handleReportDrillDown:function(val,isShowListAtDrillEnd){if("group_total"!==val.id){var reloadReport=this.drillReport(val,isShowListAtDrillEnd,this.resultObj,this.reportObj);reloadReport&&this.init(),reloadReport||this.drilltoList(val,!0)}},drilltoList:function(val,isShowListAtEnd){if(this.isXFieldCrossModule||this.isGroupByCrossModule);else{var appNameFromUrl=window.location.pathname.slice(1).split("/")[0];if("operations"===appNameFromUrl){var filters=this.handleBasicDrillDown(val,this.resultObj,this.reportObj,this.filters,!0);return this.listView={},this.listView["filters"]=filters,this.listView["moduleName"]=this.moduleName,this.listView["title"]="",void(this.showListView=!0)}if(isShowListAtEnd){var drilldown_filter={};for(var filter_val in this.drilldownactionslist){var drill_down_obj=this.drilldownactionslist[filter_val],key_name=Object.keys(drill_down_obj)[0];drilldown_filter[key_name]=(0,objectSpread2/* default */.Z)({},drill_down_obj[key_name])}this.handleBasicDrillDown(val,this.resultObj,this.reportObj,JSON.stringify(drilldown_filter))}else this.handleBasicDrillDown(val,this.resultObj,this.reportObj,this.filters)}},handleCrumbClick:function(crumbIndex){this.drillFromCrumb(crumbIndex),this.init()},closeListView:function(){this.listView=null,this.showListView=!1},setDateFilter:function(dateFilter){this.dateFilter=dateFilter,this.$emit("timelineFilterChange",dateFilter),this.userFilterApplied?this.applyFilter(this.userFilterApplied):this.initchart()},init:function(){
//when dashboard in lazy mode and widget ain't visible dont load
this.isLazyDashboard&&!this.isVisibleInViewport||this.initchart()},resize:function(){this.$refs["newChart"]&&this.$refs["newChart"].resize(),this.$refs["multiChart"]&&this.$refs["multiChart"].resize(),this.$refs["newTable"]&&this.$refs["newTable"].resize()},initchart:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _this3$appliedDateRan,_this3$appliedDateRan2,params;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this3.printQuery&&_this3.printQuery.underlyingData&&!0===_this3.printQuery.underlyingData&&(_this3.activeReportTab="underlying"),_this3.loading=!0,_this3.failed=!1,_this3.noData=!1,_this3.$refs["underlyingWorkOrders"]&&_this3.$refs["underlyingWorkOrders"].rerender(),params={reportId:_this3.reportId},_this3.firstLoad&&null!==(_this3$appliedDateRan=_this3.appliedDateRange)&&void 0!==_this3$appliedDateRan&&_this3$appliedDateRan.startTime&&null!==(_this3$appliedDateRan2=_this3.appliedDateRange)&&void 0!==_this3$appliedDateRan2&&_this3$appliedDateRan2.endTime&&(_this3.firstLoad=!1,_this3.dateFilter=NewDateHelper/* default */.Z.getDatePickerObject(_this3.appliedDateRange.operatorId,_this3.appliedDateRange.startTime+","+_this3.appliedDateRange.endTime)),_this3.dateFilter&&(params.startTime=_this3.dateFilter.value[0],params.endTime=_this3.dateFilter.value[1]),_this3.filters&&(params["filters"]=_this3.filters),_this3.dbFilterJson&&(params["filters"]=JSON.stringify(_this3.dbFilterJson)),_this3.userFilters&&(params.userFilters=_this3.userFilters),_this3.drilldownParams&&(params.drilldownParams=_this3.drilldownParams),_context3.next=14,api/* API */.bl.put("/v3/report/execute",params).then((function(_ref2){var data=_ref2.data,error=_ref2.error;if(error)_this3.loading=!1,_this3.failed=!0;else{data.criteriaData&&(_this3.criteriaObj=data.criteriaData);var result=data;if(_this3.reportPdfData=data,_this3.pdfloading=!0,_this3.config&&_this3.config.dashboardObj&&1965===_this3.config.dashboardObj.id&&(result.convertTo="hour"),result=_this3.specialHandler(result),_this3.moduleName=result.module.name,_this3.moduleId=result.module.moduleId,result.report.userFilters&&null===_this3.userFilters){var conf={},userFilters=null;userFilters=result.report.userFilters,conf["userFilters"]=userFilters,_this3.loadAllValues(conf)}var self=_this3;if(0===result.reportData.data.length){if(self.noData=!0,self.loading=!1,-1!==result.report.dateOperator)if(null===_this3.dateFilter){var datePickerObject=NewDateHelper/* default */.Z.getDatePickerObject(result.report.dateOperator,result.report.dateValue);result["dateRange"]=datePickerObject,self.dateFilter=datePickerObject,self.showDatePicker=!0}else result["dateRange"]=self.dateFilter,_this3.drilldownDatePickerObj&&(result["dateRange"]=_this3.drilldownDatePickerObj);result.xAggr=result.report.xAggr,self.resultObj=result,
// TO DO . FWidget should not depend on report obj emitted by this component
self.$emit("reportLoaded",result.report,result)}else{if(-1!==result.report.dateOperator){if(null===_this3.dateFilter){var _datePickerObject=NewDateHelper/* default */.Z.getDatePickerObject(result.report.dateOperator,result.report.dateValue);result["dateRange"]=_datePickerObject,self.dateFilter=_datePickerObject,self.showDatePicker=!0}else result["dateRange"]=self.dateFilter,_this3.drilldownDatePickerObj&&(result["dateRange"]=_this3.drilldownDatePickerObj);_this3.showDatePicker=!0}else result["dateRange"]=self.dateFilter;result.xAggr=result.report.xAggr,self.reportObj=_this3.prepareReport(result),self.reportObj["report"]=result.report,
//self.resultObj is old result state here , from previous report load
//check why this is needed in execute report
_this3.drilldownParams||
//do not persist any options from old resultObj or from chartState while drilling down
_this3.handleAxisChartState(self.reportObj,self.resultObj,result),self.resultObj=result,//setting resultobj to current response result state
self.appliedChartType&&(self.reportObj.options.data.type=_this3.appliedChartType),self.isPrinting&&(self.reportObj.options.size||(self.reportObj.options.size={}),self.reportObj.options.size.height=300),self.reportObj&&self.reportObj.report&&7===self.reportObj.report.analyticsType&&(self.reportObj.options.heatMapOptions=self.heatMapOptions),self.$emit("reportLoaded",self.reportObj,self.resultObj),self.loading=!1}}}));case 14:case"end":return _context3.stop()}}),_callee2)})))()}}},report_ModuleNewReportvue_type_script_lang_js=ModuleNewReportvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(report_ModuleNewReportvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ModuleNewReport=component.exports},
/***/106803:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FNewReportOptimize}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/components/FNewReportOptimize.vue?vue&type=template&id=4b38d878
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100 mobile-report",class:{scrollable:_vm.config&&_vm.config.widget&&_vm.reportObj&&!1===_vm.reportObj.options.settings.chart}},[_c("div",{staticClass:"datefilter-hide-overlay"}),_c("div",{staticStyle:{"text-align":"center"}},[_vm.dateFilter?_c("new-date-picker",{staticClass:"filter-field date-filter-comp-new-report inline",attrs:{zone:_vm.$timezone,dateObj:_vm.dateFilter},on:{date:_vm.setDateFilter}}):_vm._e(),_vm.reportObj&&!0===_vm.reportObj.options.settings.timeperiod&&_vm.showTimePeriod?_c("div",{staticClass:"chart-icon pointer pB8 el-popover__reference",staticStyle:{"margin-left":"10px","margin-top":"5px",position:"absolute"}},[_c("el-select",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"period-select width100 fwidget-report-period-select",attrs:{size:"mini",placeholder:"Period",title:"Time period","data-arrow":"true"},on:{change:_vm.onPeriodChange},model:{value:_vm.period,callback:function($$v){_vm.period=$$v},expression:"period"}},_vm._l(_vm.getAvailablePeriods,(function(period,index){return _c("el-option",{key:index,attrs:{label:period.name,value:period.value,disabled:!period.enable}})})),1)],1):_vm._e(),_vm.config&&_vm.config.widget||_vm.isRegression?_vm._e():_c("f-chart-settings",{attrs:{showTimePeriod:_vm.showTimePeriod,showSafelimit:_vm.showSafeLimit,settings:_vm.reportObj.options.settings},on:{onSettingsChange:_vm.onSettingsChange}})],1),_vm.reportObj&&_vm.reportObj.options.common.filters&&_vm.reportObj.options.common.filters.filterState&&_vm.reportObj.options.common.filters.filterState.liveFilterField&&"none"!==_vm.reportObj.options.common.filters.filterState.liveFilterField&&!_vm.isRegression?_c("f-user-filters",{attrs:{report:_vm.reportObj},on:{applyFilter:_vm.applyFilter}}):_vm._e(),_vm.loading?_c("spinner",{attrs:{show:_vm.loading,size:"80"}}):_vm.failed?_c("div",{staticStyle:{"margin-top":"30px",opacity:"0.7","font-size":"13px",padding:"50px","line-height":"25px","text-align":"center"}},[_c("div",[_vm._v(_vm._s(_vm.$t("home.dashboard.data_loading_failed")))])]):_vm.reportObj.data?_c("div",{staticClass:"height100"},[_vm.isRegression?_vm._e():["multi"===_vm.reportObj.options.settings.chartMode?_c("div",{class:{height100:_vm.config}},[_vm.$mobile?_c("f-mobile-multi-chart",{ref:"multiChart",attrs:{isWidget:!!_vm.config,width:_vm.config&&_vm.config.width?_vm.config.width:null,resultObj:_vm.resultObj,height:_vm.config&&_vm.config.height?_vm.config.height:null,data:_vm.reportObj.data,options:_vm.reportObj.options,alarms:_vm.reportObj.alarms,dateRange:_vm.reportObj.dateRange,hidecharttypechanger:_vm.config&&_vm.config.widget||_vm.isRegression,booleanData:_vm.reportObj.booleanData}}):_c("f-multi-chart",{ref:"multiChart",attrs:{isWidget:!!_vm.config,width:_vm.config&&_vm.config.width?_vm.config.width:null,resultObj:_vm.resultObj,height:_vm.config&&_vm.config.height?_vm.config.height:null,data:_vm.reportObj.data,options:_vm.reportObj.options,alarms:_vm.reportObj.alarms,dateRange:_vm.reportObj.dateRange,hidecharttypechanger:_vm.config&&_vm.config.widget||_vm.isRegression,booleanData:_vm.reportObj.booleanData}})],1):_c("div",{class:{height100:_vm.config&&!1!==_vm.reportObj.options.settings.chart}},[_vm.$route.meta&&_vm.$route.meta.dashboardlayout&&"mobile"===_vm.$route.meta.dashboardlayout?_c("f-mobile-chart",{ref:"newChart",attrs:{width:_vm.config&&_vm.config.width?_vm.config.width:null,resultObj:_vm.resultObj,height:_vm.config&&_vm.config.height?_vm.config.height:null,data:_vm.reportObj.data,options:_vm.reportObj.options,dateRange:_vm.reportObj.dateRange}}):_c("f-new-chart-optimize",{ref:"newChart",attrs:{isWidget:!!_vm.config,width:_vm.config&&_vm.config.width?_vm.config.width:null,resultObj:_vm.resultObj,height:_vm.config&&_vm.config.height?_vm.config.height:null,reportObj:_vm.reportObj,options:_vm.reportObj.options,hidecharttypechanger:_vm.config&&_vm.config.widget||_vm.isRegression,config:_vm.config},on:{chartgenerate:_vm.chartgenerate}})],1),!0===_vm.chartgenerated?_c("f-tabular-report",{ref:"newTable",staticClass:"newTable",attrs:{reportObject:_vm.resultObj,reportConfig:_vm.reportObj,widget:_vm.config?_vm.config.widget:null}}):_vm._e()],_vm.isRegression?_c("div",{staticClass:"mT10"},[_c("MultipleRegressionAnalysis",{attrs:{resultObj:_vm.resultObj}})],1):_vm._e()],2):_c("div",{staticStyle:{"font-size":"13px",padding:"80px 50px 50px 50px","line-height":"25px","text-align":"center"}},[_c("inline-svg",{attrs:{src:"svgs/emptystate/reportlist",iconClass:"icon text-center icon-100"}}),_c("div",{staticClass:"nowo-label f13"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.empty_data"))+" "),_vm.resultObj&&_vm.resultObj.dateRange?_c("span",{staticClass:"bold"},[_vm._v(_vm._s(_vm._f("formatPeriod")(_vm.resultObj.dateRange.value,"MMM DD, YYYY")))]):_vm._e()])],1)],1)},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),NewDatePicker=(__webpack_require__(670560),__webpack_require__(169358),__webpack_require__(976801),__webpack_require__(648324),__webpack_require__(434284),__webpack_require__(900773)),FNewChartOptimize=__webpack_require__(678873),FMobileChart=__webpack_require__(242208),FMobileMultiChart=__webpack_require__(696593),FMultiChart=__webpack_require__(649206),NewDataFormatHelper=__webpack_require__(804911),FTabularReportNew=__webpack_require__(979),NewDateHelper=__webpack_require__(105534),FChartSettings=__webpack_require__(746036),FUserFilters=__webpack_require__(405977),MultipleRegressionAnalysis=__webpack_require__(974102),api=__webpack_require__(32284),FNewReportOptimizevue_type_script_lang_js={props:["id","config","tabular","showTimePeriod"],mixins:[NewDataFormatHelper/* default */.Z],components:{NewDatePicker:NewDatePicker/* default */.Z,FNewChartOptimize:FNewChartOptimize/* default */.Z,FMultiChart:FMultiChart/* default */.Z,FTabularReport:FTabularReportNew/* default */.Z,FMobileChart:FMobileChart/* default */.Z,FChartSettings:FChartSettings/* default */.Z,FUserFilters:FUserFilters/* default */.Z,FMobileMultiChart:FMobileMultiChart/* default */.Z,MultipleRegressionAnalysis:MultipleRegressionAnalysis/* default */.Z},data:function(){return{loading:!0,failed:!1,reportObj:null,resultObj:null,showReportOptions:!1,dateFilter:null,userFilterApplied:null,chartgenerated:!1,period:null}},mounted:function(){this.init()},computed:{getAvailablePeriods:function(){if(this.reportObj&&this.reportObj.dateRange){var operationOnId=this.reportObj.dateRange.operatorId,avail=[];
// avail.push({
//   name:'Week of year', // W1, W2
//   value: 16,
//   enable: true
// })
// avail.push({
//   name:'Month of year', // Jan, Feb , march
//   value: 15,
//   enable: true
// })
return avail.push({name:"High-res",value:0,enable:6===operationOnId||4!==operationOnId}),avail.push({name:"Hourly",value:20,enable:6===operationOnId||4!==operationOnId}),avail.push({name:"Daily",value:12,enable:!0}),avail.push({name:"Weekly",value:11,enable:!0}),avail.push({name:"Monthly",value:10,enable:!0}),avail.push({name:"Quarterly",value:25,enable:4===operationOnId||5===operationOnId}),avail.push({name:"Yearly",value:8,enable:4===operationOnId}),avail.push({name:"Hour of day",
// 12, 1, 2, 3
value:19,enable:!0}),avail.push({name:"Day of week",
// sun, mon
value:17,enable:!0}),avail.push({name:"Day of month",
// 1,2,3
value:18,enable:!0}),avail}return[]},isRegression:function(){return!!(this.resultObj&&this.resultObj.report&&this.resultObj.report.reportState&&this.resultObj.report.reportState.regressionConfig&&0!=this.resultObj.report.reportState.regressionConfig.length)},showSafeLimit:function(){return!this.resultObj||!this.resultObj.report||3!==this.resultObj.report.type},reportId:function(){return this.id?this.id:this.config?this.config.widget.dataOptions.newReportId:null},appliedDateRange:function(){if(this.$route.query.daterange)return JSON.parse(this.$route.query.daterange)},appliedChartType:function(){
// Temp...will be changed for pdf once temp report support is implemented
return this.$route.query.charttype}},watch:{reportId:{handler:function(newData,oldData){this.dateFilter=!1,this.init(!1)}},config:{handler:function(newData,oldData){newData&&oldData?newData.id!==oldData.id?this.init(!1):this.$emit("reportLoaded",this.reportObj,this.resultObj):this.init(!1)},deep:!0}},methods:{onPeriodChange:function(){this.initChart()},chartgenerate:function(value){var _this=this;setTimeout((function(){return _this.chartgenerated=value}),10)},setDateFilter:function(dateFilter){this.dateFilter=dateFilter,this.userFilterApplied?this.applyFilter(this.userFilterApplied):this.initChart()},init:function(){this.initChart()},resize:function(){this.$refs["newChart"]&&this.$refs["newChart"].resize(),this.$refs["multiChart"]&&this.$refs["multiChart"].resize(),this.$refs["newTable"]&&this.$refs["newTable"].resize()},initChart:function(){var self=this;self.loading=!0,self.failed=!1;var params={newFormat:!0};this.reportObj&&(params.showAlarms=this.reportObj.options.settings.alarm,params.showSafeLimit=this.reportObj.options.settings.safelimit),this.reportObj=null,this.appliedDateRange?(params.startTime=this.appliedDateRange.startTime,params.endTime=this.appliedDateRange.endTime):self.dateFilter&&self.dateFilter.value&&(params.startTime=self.dateFilter.value[0],params.endTime=self.dateFilter.value[1]),null!==self.period&&(params.xAggr=self.period),api/* API */.bl.get("/v3/report/reading/view?reportId="+this.reportId,params).then((function(response){if(response.error)self.$message.error("Error while fetching report data"),self.loading=!1,self.failed=!0;else{var result=response.data;self.dateFilter||(self.appliedDateRange?self.appliedDateRange.startTime&&self.appliedDateRange.endTime?self.dateFilter=NewDateHelper/* default */.Z.getDatePickerObject(self.appliedDateRange.operatorId,self.appliedDateRange.startTime+","+self.appliedDateRange.endTime):self.dateFilter=NewDateHelper/* default */.Z.getDatePickerObject(self.appliedDateRange.operatorId,self.appliedDateRange.value):self.dateFilter=NewDateHelper/* default */.Z.getDatePickerObject(result.report.dateOperator,result.report.dateValue)),result.xAggr=response.data.report.xAggr,result.dateRange=self.dateFilter,self.period=response.data.report.xAggr,result.report.reportState&&null!==result.report.reportState.regressionConfig&&result.report.reportState.regressionType&&result.report.reportState.regressionConfig&&"multiple"!==result.report.reportState.regressionType&&(result.regression=!0,result.regressionType=result.report.reportState.regressionType,result.regressionConfig=result.report.reportState.regressionConfig);var reportObj=self.prepareReport(result,params);reportObj.alarms=self.prepareBooleanReport(result.reportData.aggr),result.report.reportState&&null!==result.report.reportState.regressionConfig&&result.report.reportState.regressionType&&result.report.reportState.regressionConfig&&"multiple"===result.report.reportState.regressionType&&(result.regression=!0,result.regressionType=result.report.reportState.regressionType,result.regressionConfig=result.report.reportState.regressionConfig),reportObj.options.mode&&(result.mode=reportObj.options.mode),self.resultObj=result,self.appliedChartType&&(
// TODO remove
reportObj.options.type=self.appliedChartType),self.reportObj=reportObj,self.$nextTick((function(){self.$refs["newChart"]&&self.$refs["newChart"].render(reportObj)})),self.$emit("reportLoaded",self.reportObj,self.resultObj),self.loading=!1}})).catch((function(error){error&&(self.loading=!1,self.failed=!0)}))},applyFilter:function(filters){var self=this;self.loading=!0,self.failed=!1;var reportContext=null;self.resultObj&&self.resultObj.report&&self.resultObj.report.id&&-1!=self.resultObj.report.id&&(reportContext=self.resultObj.report);var params={newFormat:!0};params.mode=this.resultObj.mode;var chartStateObject,sortField,limit,orderByFunc,chartState=self.resultObj.report.chartState,tabularState=self.resultObj.report.tabularState;self.reportObj&&self.reportObj.options&&self.reportObj.options.common&&self.reportObj.options.common.sorting?(self.reportObj.options.common.sorting.sortByField&&(sortField=self.reportObj.options.common.sorting.sortByField),self.reportObj.options.common.sorting.limit&&(limit=self.reportObj.options.common.sorting.limit,orderByFunc=self.reportObj.options.common.sorting.orderByFunc)):chartState&&(chartStateObject=JSON.parse(chartState),chartStateObject.options&&chartStateObject.options.common&&chartStateObject.options.common.sorting&&(chartStateObject.options.common.sorting.sortByField&&(sortField=chartStateObject.options.common.sorting.sortByField),chartStateObject.options.common.sorting.limit&&(limit=chartStateObject.options.common.sorting.limit,orderByFunc=chartStateObject.options.common.sorting.orderByFunc))),[1,2,3].includes(params.mode)&&(params.xAggr=this.resultObj.report.xAggr),this.appliedDateRange?(params.startTime=this.appliedDateRange.startTime,params.endTime=this.appliedDateRange.endTime):self.dateFilter&&self.dateFilter.value&&(params.startTime=self.dateFilter.value[0],params.endTime=self.dateFilter.value[1]);var _step,fields=[],categoryId=[],_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.resultObj.report.dataPoints);try{for(_iterator.s();!(_step=_iterator.n()).done;){var dp=_step.value;dp.metaData&&dp.metaData.categoryId&&-1===categoryId.indexOf(dp.metaData.categoryId)&&categoryId.push(dp.metaData.categoryId);var dataField={parentId:null,name:dp.name,metaData:dp.metaData,yAxis:{fieldId:dp.yAxis.fieldId,aggr:dp.yAxis.aggr,label:dp.name,dataType:dp.yAxis.dataType,unitStr:dp.yAxis.unitStr},aliases:dp.aliases,type:dp.type>0?dp.type:1,transformWorkflow:dp.transformWorkflow,rule_aggr_type:null===dp||void 0===dp?void 0:dp.rule_aggr_type};sortField&&sortField===dp.yAxis.fieldId&&(dataField.orderByFunc=orderByFunc,dataField.limit=limit),fields.push(dataField)}}catch(err){_iterator.e(err)}finally{_iterator.f()}if(params.fields=JSON.stringify(fields),this.resultObj.report.baseLines&&this.resultObj.report.baseLines.length){var _step2,baseLines=[],_iterator2=(0,createForOfIteratorHelper/* default */.Z)(this.resultObj.report.baseLines);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var bl=_step2.value;baseLines.push({baseLineId:bl.baseLineId,adjustType:bl.adjustType})}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}params.baseLines=JSON.stringify(baseLines)}if(filters)if(filters.siteFilter.length||filters.buildingFilter.length||filters.categoryFilter.length||filters.assetFilter.length||(params.xCriteriaMode=2),filters.assetFilter.length)params.xCriteriaMode=3,params.parentId=filters.assetFilter;else{var spaceFilter=filters.buildingFilter.length?filters.buildingFilter:filters.siteFilter;params.xCriteriaMode=4,params.spaceId=spaceFilter,params.assetCategory=filters.categoryFilter.length?filters.categoryFilter:categoryId,params.spaceId&&params.spaceId.length||(params.xCriteriaMode=2)}self.$http.post("/v2/report/readingReport",params).then((function(response){var result=response.data.result;result.xAggr=params.xAggr,result.mode=params.mode,result.report.analyticsType=1,result.dateRange=self.dateFilter,result.report.chartState=chartState,result.report.tabularState=tabularState,self.reportObj=self.prepareReport(result),reportContext&&(result.report.id=reportContext.id,result.report.name=reportContext.name),self.resultObj=result,self.reportObj.params=params,self.$emit("reportLoaded",self.reportObj,self.resultObj),self.loading=!1,self.userFilterApplied=filters})).catch((function(error){self.userFilterApplied=filters,error&&(self.loading=!1,self.failed=!0)}))},onSettingsChange:function(changedOption){"alarm"===changedOption?this.reportObj.alarms&&this.reportObj.alarms.regions.length||!this.reportObj.options.settings.alarm||this.initChart():"safelimit"===changedOption&&!this.reportObj.options.safeLimit.length&&this.reportObj.options.settings.safelimit&&this.initChart()}}},components_FNewReportOptimizevue_type_script_lang_js=FNewReportOptimizevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FNewReportOptimizevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FNewReportOptimize=component.exports},
/***/81938:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return DashboardEmailReport}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/forms/DashboardEmailReport.vue?vue&type=template&id=789a73c7
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:_vm.visibility,"custom-class":"fc-dialog-center-container fc-dashboard-email-dialog","before-close":_vm.close,"append-to-body":!0},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("div",[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.email_this_report"))+" ")])])]),_c("div",{staticClass:"height500 p30"},[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v("To")]),_c("div",[_c("el-select",{staticClass:"fc-input-full-border2 width100 fc-tag",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":""},model:{value:_vm.mailJson.to,callback:function($$v){_vm.$set(_vm.mailJson,"to",$$v)},expression:"mailJson.to"}},_vm._l(_vm.users,(function(user){return user.inviteAcceptStatus?_c("el-option",{key:user.id,attrs:{label:user.name,value:user.id}},[_vm._v(_vm._s(user.name+" ("+user.email+")"))]):_vm._e()})),1)],1)]),_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v(" Format "),_c("div",[_c("el-select",{staticClass:"fc-input-full-border2 width100 mT10",attrs:{"collapse-tags":""},model:{value:_vm.format,callback:function($$v){_vm.format=$$v},expression:"format"}},_vm._l(_vm.fileFormats,(function(label,value){return _c("el-option",{key:value,attrs:{label:label,value:parseInt(value)}})})),1)],1)])])],1),_c("div",{staticClass:"fc-input-label-txt pT15",staticStyle:{clear:"both"}},[_vm._v("Subject")]),_c("div",[_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{type:"text"},model:{value:_vm.mailJson.subject,callback:function($$v){_vm.$set(_vm.mailJson,"subject",$$v)},expression:"mailJson.subject"}})],1),_c("div",{staticClass:"fc-input-label-txt pT20"},[_vm._v("Description")]),_c("div",[_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{type:"textarea",placeholder:_vm.$t("common._common.enter_desc"),autoComplete:"off",autosize:{minRows:4,maxRows:4},resize:"none"},model:{value:_vm.mailJson.message,callback:function($$v){_vm.$set(_vm.mailJson,"message",$$v)},expression:"mailJson.message"}})],1)],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.close}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.sendMail}},[_vm._v("SEND")])],1)])},staticRenderFns=[],vue_runtime_esm=(__webpack_require__(434284),__webpack_require__(506203),__webpack_require__(902918),__webpack_require__(648324),__webpack_require__(720144)),DashboardEmailReportvue_type_script_lang_js={props:["visibility","report","moduleReportConfig"],data:function(){return{format:1,mailJson:{to:[],subject:"",message:""}}},computed:{type:function(){var type=this.report.type;return type||-1},moduleName:function(){var module=this.report.module;return module&&module.name?module.name:null},users:function(){return this.$store.state.users},params:function(){var report=this.report,type=this.type;if(report&&1===type){var _report$dateRange,dateOperator=report.dateRange.operatorId,dateOperatorValue=20===report.dateRange.operatorId?null===(_report$dateRange=report.dateRange)||void 0===_report$dateRange||null===(_report$dateRange=_report$dateRange.time)||void 0===_report$dateRange?void 0:_report$dateRange.join(","):report.dateRange.value;!dateOperator&&null!==report&&void 0!==report&&report.dateOperator&&(dateOperator=report.dateOperator),!dateOperatorValue&&null!==report&&void 0!==report&&report.dateValue&&(dateOperatorValue=report.dateValue);var params={mode:this.type,startTime:report.dateRange.startTime,endTime:report.dateRange.endTime,dateOperator:dateOperator,dateOperatorValue:dateOperatorValue,chartType:report.chartState?report.chartState.type:null};return params}return{}},fileFormats:function(){var fileFormats={},formats=vue_runtime_esm["default"].prototype.$constants.FILE_FORMAT;if(this.report&&this.report.id&&-1!=this.report.id||this.params&&this.params.reportId)for(var format in formats)"Image"!==formats[format]&&(fileFormats[format]=formats[format]);else for(var _format in formats)"Image"!==formats[_format]&&"PDF"!==formats[_format]&&(fileFormats[_format]=formats[_format]);return fileFormats}},mounted:function(){this.report?(this.mailJson.subject=this.report.name+(this.report.name.endsWith("report")||this.report.name.endsWith("Report")?"":" report"),this.mailJson.message="Hi,\nThe report on "+this.report.name+" has been sent to you from "+this.$getProperty(window.brandConfig,"name","Facilio")+"."):this.mailJson.message="Hi,\nThis report has been sent to you."},methods:{close:function(){this.$emit("update:visibility",!1)},sendMail:function(){var self=this,type=this.type,url=null;if(this.mailJson.to.length&&this.mailJson.subject){var mailTemplate=this.$helpers.cloneObject(this.mailJson);this.$common.setUserMailWorkflow(this.mailJson.to,mailTemplate);var data={fileFormat:this.format,emailTemplate:mailTemplate};2===type?(this.report.id&&-1!==this.report.id?data["reportId"]=this.report.id:(this.$helpers.extend(data,this.moduleReportConfig),data["moduleName"]=this.moduleName),this.$message({message:"Sending email...",duration:0}),this.close(),url="/v2/report/sendModuleReportMail"):(this.$helpers.extend(data,this.params),this.report.id&&-1!==this.report.id&&(data["reportId"]=this.report.id),this.$message({message:"Sending email...",duration:0}),this.close(),url="/v2/report/sendMail",this.report&&4===this.report.type&&this.report.currentTemplate&&(url=url+"?templateString="+encodeURIComponent(JSON.stringify(this.report.currentTemplate)))),this.$http.post(url,data).then((function(response){self.$message.closeAll(),response.data&&0===response.data.responseCode?(self.$message({message:"Email sent successfully!",type:"success"}),self.mailJson.to=[],self.mailJson.subject="",self.mailJson.message=""):self.$message({message:"Email sending failed!",type:"error"})}))}}}},forms_DashboardEmailReportvue_type_script_lang_js=DashboardEmailReportvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(forms_DashboardEmailReportvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,DashboardEmailReport=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/62804.js.map