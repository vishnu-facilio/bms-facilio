(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[16977],{
/***/874249:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return RichTextArea}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/forms/RichTextArea.vue?vue&type=template&id=7711575b
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.isRichText?_c("div",{staticClass:"richtext-area"},[_c("RichText",{style:{minHeight:_vm.minHeight,maxHeight:_vm.maxHeight,overflow:_vm.overflow},attrs:{readOnly:_vm.disabled,placeholder:_vm.placeholder,hideImgTool:_vm.hideImgTool,hideUnorderedList:_vm.hideUnorderedList,hideOrderedList:_vm.hideOrderedList,secondaryToolbar:_vm.secondaryToolbar,istoolbarPositionBottom:_vm.istoolbarPositionBottom,isMoreOption:_vm.isMoreOption,customToolOrder:_vm.customToolOrder,iconColor:_vm.iconColor},scopedSlots:_vm._u([_vm.canShowModeToggle?{key:"editorMode",fn:function(){return[_c("div",{staticClass:"self-center marginL-auto mR15 cursor-pointer mode-btn",on:{click:function($event){return _vm.changeMode()}}},[_vm._v(" "+_vm._s(_vm.$t("forms.builder.plain_text_mode"))+" ")])]},proxy:!0}:null],null,!0),model:{value:_vm.content,callback:function($$v){_vm.content=$$v},expression:"content"}})],1):_c("div",{staticClass:"richtext-area plain-text-mode"},[_c("div",{staticClass:"richtext-editor"},[_c("div",{staticClass:"richtext-toolbar"},[_c("div",{staticClass:"toolbar-button marginL-auto cursor-pointer mode-btn",on:{click:function($event){return _vm.changeMode()}}},[_vm._v(" "+_vm._s(_vm.$t("forms.builder.switch_to_richtext"))+" ")])]),_c("el-input",{key:"plain-text",staticClass:"richtext-content",attrs:{type:"textarea",resize:"none",placeholder:_vm.placeholder},model:{value:_vm.content,callback:function($$v){_vm.content=$$v},expression:"content"}})],1)])},staticRenderFns=[],ui_forms=(__webpack_require__(879288),__webpack_require__(141323)),filters=__webpack_require__(638203),RichTextAreavue_type_script_lang_js={props:{value:{type:String},field:{type:Object},rows:{type:Number,default:10},maxRows:{type:Number,default:12},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"Enter text here"},isEdit:{type:Boolean,default:!1},hideImgTool:{type:Boolean,default:!1},hideOrderedList:{type:Boolean,default:!1},hideUnorderedList:{type:Boolean,default:!1},isRichTextMode:{type:Boolean,default:!0},canShowModeToggle:{type:Boolean,default:!1},istoolbarPositionBottom:{type:Boolean},customToolOrder:{type:Array},isMoreOption:{type:Boolean},secondaryToolbar:{type:Boolean},iconColor:{type:String}},components:{RichText:ui_forms/* RichText */.Ho},computed:{content:{get:function(){return this.value},set:function(value){this.$emit("input",value)}},isRichText:{get:function(){return this.isRichTextMode},set:function(value){this.$emit("update:isRichTextMode",value)}},
// Assuming a <p></p> tag inside editor
// has fonts-size 1rem and margin-bottom 1rem
minHeight:function(){return"".concat(2*this.rows,"rem")},maxHeight:function(){return"".concat(2*this.maxRows,"rem")},overflow:function(){return"hidden"}},methods:{changeMode:function(){var isRichText=this.isRichText,value=this.value;if(isRichText)this.showConfirmModeSwitch();else{var htmlContent="<p>".concat(value,"</p>");this.content=htmlContent,this.proceedChangingModes()}},showConfirmModeSwitch:function(){var _this=this,dialogObj={htmlMessage:"".concat(this.$t("forms.builder.switch_alert")),rbDanger:!0,rbLabel:"Confirm"};this.$dialog.confirm(dialogObj).then((function(canProceed){if(canProceed){var value=_this.value,textContent=(0,filters/* htmlToText */.s9)(value);_this.content=textContent,_this.proceedChangingModes()}}))},proceedChangingModes:function(){var isRichText=this.isRichText;this.isRichText=!isRichText}}},forms_RichTextAreavue_type_script_lang_js=RichTextAreavue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(forms_RichTextAreavue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,RichTextArea=component.exports},
/***/675709:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return pmnewform}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/multisitepreventive/pmnewform.vue?vue&type=template&id=11ada634
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"wo-form-main-container"},[_c("div",{staticClass:"fc-pm-form-container"},[_c("div",{staticClass:"fc-pm-form-left-menu"},[_c("div",{staticClass:"fc-pm-form-list"},_vm._l(_vm.pmFormType,(function(data,key){return"resourceplan"!==key||_vm.model.triggerData.triggers.length?_c("ul",{key:data},[_c("li",{staticClass:"label-txt-black pointer",on:{click:function($event){return _vm.formSelect(key)}}},[_c("div",{key:key,class:{"form-dot-align":!0,"dot-inactive-grey":_vm.currentView!==key,"dot-active-pink":_vm.currentView===key},attrs:{value:"key"}}),_vm._v(" "+_vm._s(data)+" ")])]):_vm._e()})),0)])]),_c("pm-config",{directives:[{name:"show",rawName:"v-show",value:_vm.show["pmconfig"],expression:"show['pmconfig']"}],attrs:{model:_vm.model},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious,validated:_vm.validated,failed:_vm.failed}}),_c("workorder",{directives:[{name:"show",rawName:"v-show",value:_vm.show["workorder"],expression:"show['workorder']"}],attrs:{tenant:_vm.tenantId,model:_vm.model},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious,validated:_vm.validated,failed:_vm.failed}}),_vm.model.isLoading?_vm._e():_c("wo-nx-form",{directives:[{name:"show",rawName:"v-show",value:_vm.show["workorderNx"],expression:"show['workorderNx']"}],attrs:{tenant:_vm.tenantId,model:_vm.model},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious,validated:_vm.validated,failed:_vm.failed,setFormObject:_vm.setFormObject}}),_vm.model.isLoading?_vm._e():_c("prerequests",{directives:[{name:"show",rawName:"v-show",value:_vm.show["prerequests"],expression:"show['prerequests']"}],attrs:{model:_vm.model,users:_vm.users,teams:_vm.teams},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious}}),_vm.model.isLoading?_vm._e():_c("tasks",{directives:[{name:"show",rawName:"v-show",value:_vm.show["tasks"],expression:"show['tasks']"}],attrs:{model:_vm.model},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious}}),_vm.model.isLoading||!_vm.$helpers.isLicenseEnabled("SKIP_TRIGGERS")&&!this.model.triggerData.enableSkipTriggers?_vm.model.isLoading||_vm.$helpers.isLicenseEnabled("SKIP_TRIGGERS")?_vm._e():_c("old-trigger",{directives:[{name:"show",rawName:"v-show",value:_vm.show["trigger"],expression:"show['trigger']"}],attrs:{model:_vm.model,users:_vm.users,groups:_vm.teams},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious}}):_c("trigger",{directives:[{name:"show",rawName:"v-show",value:_vm.show["trigger"],expression:"show['trigger']"}],attrs:{model:_vm.model,users:_vm.users,groups:_vm.teams},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious}}),!_vm.model.isLoading&&"bulk"===_vm.model.woData.workOrderType&&_vm.model.triggerData.triggers.length?_c("resource-plan",{directives:[{name:"show",rawName:"v-show",value:_vm.show["resourceplan"],expression:"show['resourceplan']"}],attrs:{model:_vm.model,users:_vm.users,groups:_vm.teams},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious}}):_vm._e(),_vm.model.isLoading||!_vm.$helpers.isLicenseEnabled("SKIP_TRIGGERS")&&!this.model.triggerData.enableSkipTriggers?_vm.model.isLoading||_vm.$helpers.isLicenseEnabled("SKIP_TRIGGERS")?_vm._e():_c("old-review",{directives:[{name:"show",rawName:"v-show",value:_vm.show["review"],expression:"show['review']"}],ref:"reviewer",attrs:{model:_vm.model,users:_vm.users,groups:_vm.teams},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious,saved:_vm.saved,edited:_vm.edited}}):_c("review",{directives:[{name:"show",rawName:"v-show",value:_vm.show["review"],expression:"show['review']"}],ref:"reviewer",attrs:{model:_vm.model,formObj:_vm.formObj,users:_vm.users,groups:_vm.teams},on:{next:_vm.moveToNext,previous:_vm.moveToPrevious,saved:_vm.saved,edited:_vm.edited}})],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(450886),__webpack_require__(425728),__webpack_require__(538077),__webpack_require__(162506),__webpack_require__(865137),__webpack_require__(420629)),PmWoFormvue_type_template_id_04e8b7d3_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fc-pm-form-right-main2"},[_vm.model.isEdit?_c("div",{staticClass:"heading-black22 mT20 mB20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.edit_pm"))+" ")]):_c("div",{staticClass:"heading-black22 mT20 mB20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.new_pm"))+" ")]),_vm.loading?_c("div",{staticClass:"fc-pm-main-bg"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm._e(),_c("div",{directives:[{name:"show",rawName:"v-show",value:!_vm.loading,expression:"!loading"}],staticClass:"fc-pm-main-bg"},[_c("div",{staticClass:"fc-pm-main-content2 pm-form-active-border-remove"},[_c("facilio-web-form",{staticClass:"fc-pm-form",attrs:{editObj:_vm.model.woData.woModel,emitForm:_vm.model.emitForm,name:"multi_web_pm",model:_vm.model.woData.woModel,siteScope:_vm.model.woData.sites},on:{"update:model":function($event){return _vm.$set(_vm.model.woData,"woModel",$event)},loaded:_vm.setAfterLoadParams,validated:function(data){return _vm.relay("validated",data)},failed:function(data){return _vm.relay("failed",data)}}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v("PROCEED TO NEXT")])],1)])])},PmWoFormvue_type_template_id_04e8b7d3_staticRenderFns=[],FacilioWebForm=__webpack_require__(111801),PMMixin=__webpack_require__(369087),PmWoFormvue_type_script_lang_js={mixins:[PMMixin/* default */.Z],props:["model","tenant"],components:{FacilioWebForm:FacilioWebForm/* default */.Z},data:function(){return{
// loadingOption: false,
// showFloorOption: true,
// showSpaceCategOption: true,
// showAssetCategOption: true,
// fetchedAssets: [],
// fetchedSpaces: [],
// buildings: [],
// dummyValue: [1],
// dummyValue1: [1],
// dummyValue2: [1],
// chooserVisibility: false,
// showAsset: true,
// singleAssetSpacevisibility: false,
loading:!0}},created:function(){this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadGroups"),// if required, get users/groups from pmnewform.vue as props, which is fetched from PMMixin.getScopedGroupsAndUsers().
this.$store.dispatch("loadBuildings")},methods:{relay:function(event,data){this.$emit(event,data)},
// resetEmit() {
//   this.model.emitForm = false
// },
setAfterLoadParams:function(){this.loading=!1,this.tenant&&(this.model.woData.woModel.tenant.id=this.tenant)},
// getScopeFilteredValues(siteId, buildingId) {
//   if (!siteId && !buildingId) {
//     return
//   }
//   let params = ''
//   if (siteId) {
//     params = `siteId=${siteId}`
//   }
//   if (buildingId) {
//     params = params
//       ? `${params}&buildingId=${buildingId}`
//       : `buildingId=${buildingId}`
//   }
//   this.loadingOption = true
//   console.log('getScopeFilteredValuesForPM from PMWOFORM')
//   this.$http
//     .get(`/workorder/getScopeFilteredValuesForPM?${params}`)
//     .then(response => {
//       this.showFloorOption = response.data.hasFloor
//       this.fetchedAssets = response.data.assetCategoryIds
//       this.fetchedSpaces = response.data.spaceCategoryIds
//       this.buildings = response.data.buildings || []
//       this.loadingOption = false
//     })
// },
// onBuildingChange(buildingId) {
//   this.getScopeFilteredValues(this.model.woData.woModel.site.id, buildingId)
// },
// resourceListHandler() {
//   if (this.model.isEdit && this.model.isLoading) {
//     return
//   }
//   if (this.model.woData.workOrderType === 'bulk') {
//     if (this.model.woData.resourceType === 'SPACE_CATEGORY') {
//       if (
//         this.model.woData.selectedSpaceList &&
//         this.model.woData.selectedSpaceList.length !== 0
//       ) {
//         if (
//           this.model.woData.isIncludeSpace === null ||
//           this.model.woData.isIncludeSpace === undefined ||
//           this.model.woData.isIncludeSpace
//         ) {
//           let presentInSpaceList = {}
//           this.model.woData.selectedSpaceList.forEach(
//             i => (presentInSpaceList[i.id] = true)
//           )
//           let presentInRPList = {}
//           this.model.woData.resourceList.forEach(resource => {
//             presentInRPList[resource.id] = true
//           })
//           this.model.woData.selectedSpaceList.forEach(i => {
//             if (!presentInRPList[i.id]) {
//               this.model.woData.resourceList.push({
//                 id: i.id,
//                 triggerNames: ['0'],
//                 assignedTo: null,
//                 notifications: [],
//                 selected: false,
//               })
//             }
//           })
//           let newResourceList = []
//           this.model.woData.resourceList.forEach(resource => {
//             if (presentInSpaceList[resource.id]) {
//               newResourceList.push(resource)
//             }
//           })
//           this.$set(this.model.woData, 'resourceList', newResourceList)
//         } else {
//           if (
//             this.model.woData.spacecategoryId &&
//             this.model.woData.spacecategoryId > 0
//           ) {
//             this.$util
//               .loadSpacesContext(4, null, [
//                 {
//                   key: 'site',
//                   operator: 'is',
//                   value: this.model.woData.woModel.site.id,
//                 },
//                 {
//                   key: 'building',
//                   operator: 'is',
//                   value: this.model.woData.selectedBuilding,
//                 },
//                 {
//                   key: 'spaceCategory',
//                   operator: 'is',
//                   value: this.model.woData.spacecategoryId,
//                 },
//               ])
//               .then(response => {
//                 this.$set(
//                   this.model.woData,
//                   'resourceList',
//                   response.records
//                 )
//                 this.model.woData.resourceList = this.model.woData.resourceList.filter(
//                   i => {
//                     for (
//                       let j = 0;
//                       j < this.model.woData.selectedSpaceList.length;
//                       j++
//                     ) {
//                       if (
//                         this.model.woData.selectedSpaceList[j].id === i.id
//                       ) {
//                         return false
//                       }
//                     }
//                     return true
//                   }
//                 )
//                 this.model.woData.resourceList.forEach(resource => {
//                   resource.triggerNames = ['0']
//                   resource.assignedTo = null
//                   resource.notifications = []
//                   resource.selected = false
//                 })
//               })
//           }
//         }
//       } else {
//         if (
//           this.model.woData.spacecategoryId &&
//           this.model.woData.spacecategoryId > 0
//         ) {
//           this.$util
//             .loadSpacesContext(4, null, [
//               {
//                 key: 'site',
//                 operator: 'is',
//                 value: this.model.woData.woModel.site.id,
//               },
//               {
//                 key: 'building',
//                 operator: 'is',
//                 value: this.model.woData.selectedBuilding,
//               },
//               {
//                 key: 'spaceCategory',
//                 operator: 'is',
//                 value: this.model.woData.spacecategoryId,
//               },
//             ])
//             .then(response => {
//               this.$set(this.model.woData, 'resourceList', response.records)
//               this.model.woData.resourceList.forEach(resource => {
//                 resource.triggerNames = ['0']
//                 resource.assignedTo = null
//                 resource.notifications = []
//                 resource.selected = false
//               })
//             })
//         }
//       }
//     } else if (this.model.woData.resourceType === 'ASSET_CATEGORY') {
//       if (
//         this.model.woData.selectedResourceList &&
//         this.model.woData.selectedResourceList.length !== 0
//       ) {
//         if (
//           this.model.woData.isIncludeResource === null ||
//           this.model.woData.isIncludeResource === undefined ||
//           this.model.woData.isIncludeResource
//         ) {
//           let presentInAssetList = {}
//           this.model.woData.selectedResourceList.forEach(
//             i => (presentInAssetList[i.id] = true)
//           )
//           let presentInRPList = {}
//           this.model.woData.resourceList.forEach(resource => {
//             presentInRPList[resource.id] = true
//           })
//           this.model.woData.selectedResourceList.forEach(i => {
//             if (!presentInRPList[i.id]) {
//               this.model.woData.resourceList.push({
//                 id: i.id,
//                 triggerNames: ['0'],
//                 assignedTo: null,
//                 notifications: [],
//                 selected: false,
//               })
//             }
//           })
//           let newResourceList = []
//           this.model.woData.resourceList.forEach(resource => {
//             if (presentInAssetList[resource.id]) {
//               newResourceList.push(resource)
//             }
//           })
//           this.$set(this.model.woData, 'resourceList', newResourceList)
//         } else {
//           if (
//             this.model.woData.assetCategoryId &&
//             this.model.woData.assetCategoryId > 0
//           ) {
//             let spaceId = this.model.woData.selectedBuilding
//             if (
//               !this.model.woData.selectedBuilding ||
//               this.model.woData.selectedBuilding < 0
//             ) {
//               spaceId = this.model.woData.woModel.site.id
//             }
//             this.$util
//               .loadAsset({
//                 spaceId: spaceId,
//                 categoryId: this.model.woData.assetCategoryId,
//               })
//               .then(response => {
//                 this.$set(
//                   this.model.woData,
//                   'resourceList',
//                   response.assets.filter(i => {
//                     for (
//                       let j = 0;
//                       j < this.model.woData.selectedResourceList.length;
//                       j++
//                     ) {
//                       if (
//                         this.model.woData.selectedResourceList[j].id ===
//                         i.id
//                       ) {
//                         return false
//                       }
//                     }
//                     return true
//                   })
//                 )
//                 this.model.woData.resourceList.forEach(resource => {
//                   resource.triggerNames = ['0']
//                   resource.assignedTo = null
//                   resource.notifications = []
//                   resource.selected = false
//                 })
//               })
//           }
//         }
//       } else {
//         if (
//           this.model.woData.assetCategoryId &&
//           this.model.woData.assetCategoryId > 0
//         ) {
//           let spaceId = this.model.woData.selectedBuilding
//           if (
//             !this.model.woData.selectedBuilding ||
//             this.model.woData.selectedBuilding < 0
//           ) {
//             spaceId = this.model.woData.woModel.site.id
//           }
//           this.$util
//             .loadAsset({
//               spaceId: spaceId,
//               categoryId: this.model.woData.assetCategoryId,
//             })
//             .then(response => {
//               this.$set(this.model.woData, 'resourceList', response.assets)
//               this.model.woData.resourceList.forEach(resource => {
//                 resource.triggerNames = ['0']
//                 resource.assignedTo = null
//                 resource.notifications = []
//                 resource.selected = false
//               })
//             })
//         }
//       }
//     }
//   }
// },
// resourceListAllFloorsHandler(newVal, oldVal) {
//   if (this.model.isEdit && this.model.isLoading) {
//     return
//   }
//   if (this.model.woData.workOrderType === 'bulk' && newVal !== oldVal) {
//     if (this.model.woData.resourceType === 'ALL_FLOORS') {
//       if (
//         this.model.woData.selectedFloorList &&
//         this.model.woData.selectedFloorList.length !== 0
//       ) {
//         if (
//           this.model.woData.isIncludeFloor === null ||
//           this.model.woData.isIncludeFloor === undefined ||
//           this.model.woData.isIncludeFloor
//         ) {
//           let presentInFloorList = {}
//           this.model.woData.selectedFloorList.forEach(
//             i => (presentInFloorList[i.id] = true)
//           )
//           let presentInRPList = {}
//           this.model.woData.resourceList.forEach(resource => {
//             presentInRPList[resource.id] = true
//           })
//           this.model.woData.selectedFloorList.forEach(i => {
//             if (!presentInRPList[i.id]) {
//               this.model.woData.resourceList.push({
//                 id: i.id,
//                 triggerNames: ['0'],
//                 assignedTo: null,
//                 notifications: [],
//                 selected: false,
//               })
//             }
//           })
//           let newResourceList = []
//           this.model.woData.resourceList.forEach(resource => {
//             if (presentInFloorList[resource.id]) {
//               newResourceList.push(resource)
//             }
//           })
//           this.$set(this.model.woData, 'resourceList', newResourceList)
//         } else {
//           this.$util
//             .loadSpace([3], null, [
//               { key: 'site', value: this.model.woData.woModel.site.id },
//               {
//                 key: 'building',
//                 value: this.model.woData.selectedBuilding,
//               },
//             ])
//             .then(data => {
//               let rList = data.basespaces.filter(i => {
//                 for (
//                   let j = 0;
//                   j < this.model.woData.selectedFloorList.length;
//                   j++
//                 ) {
//                   if (this.model.woData.selectedFloorList[j].id === i.id) {
//                     return false
//                   }
//                 }
//                 return true
//               })
//               this.$set(this.model.woData, 'resourceList', rList)
//               this.model.woData.resourceList.forEach(resource => {
//                 resource.triggerNames = ['0']
//                 resource.assignedTo = null
//                 resource.notifications = []
//                 resource.selected = false
//               })
//             })
//         }
//       } else {
//         this.$util
//           .loadSpace([3], null, [
//             { key: 'site', value: this.model.woData.woModel.site.id },
//             { key: 'building', value: this.model.woData.selectedBuilding },
//           ])
//           .then(data => {
//             this.$set(this.model.woData, 'resourceList', data.basespaces)
//             this.model.woData.resourceList.forEach(resource => {
//               resource.triggerNames = ['0']
//               resource.assignedTo = null
//               resource.notifications = []
//               resource.selected = false
//             })
//           })
//       }
//     }
//   }
// },
// associateResource(selectedObj) {
//   if (selectedObj.resourceList && selectedObj.resourceList.length) {
//     if (this.model.woData.resourceType === 'ASSET_CATEGORY') {
//       this.model.woData.selectedResourceList = selectedObj.resourceList
//       this.model.woData.isIncludeResource = selectedObj.isInclude
//     } else if (this.model.woData.resourceType === 'SPACE_CATEGORY') {
//       this.model.woData.selectedSpaceList = selectedObj.resourceList
//       this.model.woData.isIncludeSpace = selectedObj.isInclude
//     } else if (this.model.woData.resourceType === 'ALL_FLOORS') {
//       this.model.woData.selectedFloorList = selectedObj.resourceList
//       this.model.woData.isIncludeFloor = selectedObj.isInclude
//     }
//     this.resourceListHandler()
//   } else {
//     this.model.woData.selectedResourceList = []
//     this.model.woData.isIncludeResource = true
//     this.model.woData.selectedSpaceList = []
//     this.model.woData.isIncludeSpace = true
//     this.model.woData.selectedFloorList = []
//     this.model.woData.isIncludeFloor = true
//   }
//   this.chooserVisibility = false
//   this.model.woData.resourceQuery = null
// },
// associateSingleAssetSpace(selectedObj) {
//   this.singleAssetSpacevisibility = false
//   this.model.woData.spaceAssetDisplayName = selectedObj.name
//   this.model.woData.singleResource = selectedObj
// },
moveToNext:function(){
// validateMultiSiteWO from mixin
// let isValid = this.validateMultiSiteWO()
// if (isValid) {
this.$emit("next");
// }
},moveToPrevious:function(){
// validateMultiSiteWO from mixin
// let isValid = this.validateMultiSiteWO()
// if (isValid) {
this.$emit("previous");
// }
}}},multisitepreventive_PmWoFormvue_type_script_lang_js=PmWoFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(multisitepreventive_PmWoFormvue_type_script_lang_js,PmWoFormvue_type_template_id_04e8b7d3_render,PmWoFormvue_type_template_id_04e8b7d3_staticRenderFns,!1,null,null,null)
/* harmony default export */,PmWoForm=component.exports,WoNxFormvue_type_template_id_6137c2f0_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fc-pm-form-right-main2"},[_vm.model.isEdit?_c("div",{staticClass:"heading-black22 mT20 mB20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.edit_pm"))+" ")]):_c("div",{staticClass:"heading-black22 mT20 mB20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.new_pm"))+" ")]),_vm.loading?_c("div",{staticClass:"fc-pm-main-bg"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm._e(),_c("div",{directives:[{name:"show",rawName:"v-show",value:!_vm.loading,expression:"!loading"}],staticClass:"fc-pm-main-bg"},[_c("div",{staticClass:"fc-pm-main-content2 pm-form-active-border-remove"},[_vm.loading?_vm._e():_c("f-webform",{attrs:{form:_vm.formObj,module:"workorder",moduleDisplayName:"Work Order",isSaving:!1,canShowPrimaryBtn:!1,canShowSecondaryBtn:!1,isWidgetsSupported:!0,isV3Api:!1,isEdit:_vm.model.isEdit},on:{"update:form":function($event){_vm.formObj=$event},onFormModelChange:_vm.formUpdateHandler}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.moveToPrevious}},[_vm._v(_vm._s(_vm.$t("maintenance.wr_list.previous")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v(_vm._s(_vm.$t("maintenance.wr_list.proceed_to_next")))])],1)])])},WoNxFormvue_type_template_id_6137c2f0_staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),validation=(__webpack_require__(634338),__webpack_require__(976801),__webpack_require__(990260)),api=__webpack_require__(32284),FWebform=__webpack_require__(434500),utility_methods=__webpack_require__(773258),baseUrl=__webpack_require__(420499),constant=__webpack_require__(354754),pick=__webpack_require__(478718),pick_default=__webpack_require__.n(pick),WoNxFormvue_type_script_lang_js={name:"NxWoForm",props:["model"],components:{FWebform:FWebform/* default */.Z},data:function(){return{formObj:{},loading:!0}},created:function(){this.loadFormData()},computed:{moduleDataId:function(){var _ref=this.$route||{},query=_ref.query,_ref2=query||{},edit=_ref2.edit;return edit||null}},methods:{convToDaysHours:function(seconds){if((0,validation/* isObject */.Kn)(seconds)&&(seconds=this.$util.daysHoursToUnixTime(seconds)||-1),-1===seconds)return{days:0,hours:0};var factor=3600,days=seconds/(24*factor),hours=seconds-24*days*factor;return{days:days,hours:hours}},formUpdateHandler:function(selection){var _this=this;if(this.model.woData.woModel&&this.formObj){var _loop=function(key){var value=selection[key];if(null===value||void 0===value)return 1;// continue
var formField=_this.formObj.fields.filter((function(f){return f.name===key}))[0],_ref3=formField||{},field=_ref3.field,_ref4=field||{},dataTypeEnum=_ref4.dataTypeEnum,_ref5=field||{},displayType=_ref5.displayType;formField&&formField.field&&8===formField.field.dataType?value=value.id:"LOOKUP"===dataTypeEnum&&(0,validation/* isEmpty */.xb)(value.id)?value={id:-1}:"MULTI_LOOKUP"===dataTypeEnum?value=(value||[]).map((function(currValue){return{id:currValue}})):"DURATION"===displayType&&"NUMBER"===dataTypeEnum&&(value=_this.convToDaysHours(value)),"duration"!==key&&"estimatedWorkDuration"!=key||(value=_this.convToDaysHours(value)),_this.model.woData.woModel.data&&key in _this.model.woData.woModel.data&&(_this.model.woData.woModel.data[key]=value),_this.model.woData.woModel[key]=value};for(var key in selection)_loop(key)}},moveToPrevious:function(){this.$emit("previous")},moveToNext:function(){this.$emit("next")},loadFormData:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var formObj,formUrl,_yield$API$get,data,error,message,form;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return formObj={},formUrl="/v2/forms/workorder?formName=multi_web_pm&fetchFormRuleFields=true",_context.next=4,api/* API */.bl.get(formUrl);case 4:return _yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?(message=error.message,_this2.$message.error(message)):(form=data.form,(0,validation/* isEmpty */.xb)(form)||(formObj=form,formObj.secondaryBtnLabel=_this2.$t("common._common.cancel"),formObj.primaryBtnLabel=_this2.$t("common._common._save"),_this2.formObj=formObj,_this2.model.isEdit&&!(0,validation/* isEmpty */.xb)(_this2.model.actualWoData)&&_this2.deserializeData(_this2.model.actualWoData))),_this2.loading=!1,_this2.$emit("setFormObject",formObj),_context.abrupt("return",formObj);case 11:case"end":return _context.stop()}}),_callee)})))()},deserializeData:function(moduleData){var _this3=this,_ref6=moduleData||{},data=_ref6.data,isV3Api=this.isV3Api,formObj=this.formObj;if(!(0,validation/* isEmpty */.xb)(formObj)){var sections=formObj.sections;(0,validation/* isEmpty */.xb)(sections)||sections.forEach((function(section){var fields=section.fields;(0,validation/* isEmpty */.xb)(fields)||fields.forEach((function(field){var fieldObj=field.field,name=field.name,displayTypeEnum=field.displayTypeEnum,displayType=field.displayType;
// Custom fields data extraction
if((0,validation/* isEmpty */.xb)(fieldObj)||fieldObj.default||(0,validation/* isEmpty */.xb)(data)||isV3Api)if("TEAMSTAFFASSIGNMENT"===displayTypeEnum){var assignedTo=moduleData.assignedTo,assignmentGroup=moduleData.assignmentGroup,fieldValue={assignedTo:{id:""},assignmentGroup:{id:""}};(0,validation/* isEmpty */.xb)(assignedTo)||(fieldValue.assignedTo=assignedTo),(0,validation/* isEmpty */.xb)(assignmentGroup)||(fieldValue.assignmentGroup=assignmentGroup),_this3.$set(field,"value",fieldValue)}else if("IMAGE"===displayTypeEnum||"SIGNATURE"===displayTypeEnum){var _imageId=moduleData["".concat(name,"Id")],_imgUrl="".concat((0,baseUrl/* getBaseURL */.BS)(),"/v2/files/preview/").concat(moduleData["".concat(name,"Id")]);_this3.$set(field,"imgUrl",_imageId?_imgUrl:null),_this3.$set(field,"value",_imageId)}else if("FILE"===displayTypeEnum){var _fileId=moduleData["".concat(name,"Id")],_fileObj={name:moduleData["".concat(name,"FileName")]};_this3.$set(field,"fileObj",_fileId?_fileObj:null),_this3.$set(field,"value",_fileId)}else if("ATTACHMENT"===displayTypeEnum){var attachments=_this3.$getProperty(moduleData,"attachedFiles.attachments",[]);_this3.$set(field,"value",attachments)}else if("LOOKUP_SIMPLE"!==displayTypeEnum&&"REQUESTER"!==displayTypeEnum||"siteId"===field.name)if(56===displayType){var config=field.config,endFieldName=config.endFieldName,startFieldName=config.startFieldName,scheduleJsonName=config.scheduleJsonName,scheduleValueObj={startFieldValue:moduleData[startFieldName],endFieldValue:moduleData[endFieldName],scheduleJsonValue:moduleData[scheduleJsonName],isRecurring:moduleData.isRecurring};_this3.$set(field,"scheduleValueObj",scheduleValueObj)}else"SADDRESS"===displayTypeEnum||"ADDRESS"===displayTypeEnum?_this3.$set(field,"value",_this3.$getProperty(_this3,"moduleData.".concat(field.name),(0,utility_methods/* deepCloneObject */.kh)(constant/* default */.Z.ADDRESS_FIELD_DEFAULTS))):"QUOTE_ADDRESS"===displayTypeEnum?(_this3.$set(field,"billToAddress",_this3.$getProperty(_this3,"moduleData.billToAddress",{})),_this3.$set(field,"shipToAddress",_this3.$getProperty(_this3,"moduleData.shipToAddress",{}))):["QUOTE_LINE_ITEMS","LINEITEMS"].includes(displayTypeEnum)?(_this3.$set(field,"value",_this3.$getProperty(_this3,"moduleData.".concat(name),null)),constant/* default */.Z.QUOTE_LINE_ITEMS_ADDITIONAL_FIELDS.forEach((function(additionalField){var value=_this3.$getProperty(_this3,"moduleData.".concat(additionalField),null);"tax"===additionalField&&(value=(0,validation/* isEmpty */.xb)(value)?{id:null}:pick_default()(value,["id"])),_this3.$set(field,additionalField,value)}))):["INVREQUEST_LINE_ITEMS"].includes(displayTypeEnum)?_this3.$set(field,"value",_this3.$getProperty(_this3,"moduleData.lineItems",null)||_this3.$getProperty(_this3,"moduleData.inventoryrequestlineitems",null)):"BUDGET_AMOUNT"===displayTypeEnum?_this3.$set(field,"value",_this3.getFormattedBudgetAmountsData(moduleData)):"FACILITY_BOOKING_SLOTS"===displayTypeEnum?(_this3.$set(field,"value",_this3.getFormattedSlotData(moduleData)),_this3.$set(field,"bookingDate",moduleData.bookingDate)):"FACILITY_AVAILABILITY"===displayTypeEnum?_this3.$set(field,"value",_this3.formatForFacilityAvailability(moduleData)):["NUMBER","DECIMAL"].includes(displayTypeEnum)&&!(0,validation/* isNullOrUndefined */.le)(moduleData[name])?_this3.$set(field,"value",moduleData[name]):"DURATION"===displayTypeEnum?_this3.$set(field,"value",_this3.$helpers.getDurationInSecs(moduleData[name],(0,validation/* isEmpty */.xb)((fieldObj||{}).unit)?"s":fieldObj.unit)):(0,validation/* isEmpty */.xb)(moduleData[name])?_this3.$set(field,"value",null):_this3.$set(field,"value",moduleData[name]);else _this3.$set(field,"value",(moduleData[name]||{}).id);else if("IMAGE"===displayTypeEnum||"SIGNATURE"===displayTypeEnum){var imageId=moduleData.data["".concat(name,"Id")],imgUrl="".concat((0,baseUrl/* getBaseURL */.BS)(),"/v2/files/preview/").concat(moduleData.data["".concat(name,"Id")]);_this3.$set(field,"imgUrl",imageId?imgUrl:null),_this3.$set(field,"value",imageId)}else if("FILE"===displayTypeEnum){var fileId=moduleData.data["".concat(name,"Id")],fileObj={name:moduleData.data["".concat(name,"FileName")]};_this3.$set(field,"fileObj",fileId?fileObj:null),_this3.$set(field,"value",fileId)}else"LOOKUP_SIMPLE"===displayTypeEnum?!(0,validation/* isEmpty */.xb)(data[name])&&_this3.$getProperty(data[name],"id")>0&&_this3.$set(field,"value",(data[name]||{}).id):"DURATION"===displayTypeEnum?_this3.$set(field,"value",_this3.$helpers.getDurationInSecs(data[name],(0,validation/* isEmpty */.xb)((fieldObj||{}).unit)?"s":fieldObj.unit)):"SADDRESS"===displayTypeEnum||"ADDRESS"===displayTypeEnum?_this3.$set(field,"value",_this3.$getProperty(_this3,"moduleData.data.".concat(field.name),(0,utility_methods/* deepCloneObject */.kh)(constant/* default */.Z.ADDRESS_FIELD_DEFAULTS))):_this3.$set(field,"value",data[name])}))}))}}// deserializeData(moduleData) {
//   if (!moduleData) {
//     console.log('module data is null/ undefined')
//     return
//   }
//   console.log('deserializing data')
//   console.log('moduleData:', moduleData)
//   // let { data } = moduleData
//   let { isV3Api } = this
//   let { formObj } = this
//   if (!isEmpty(formObj)) {
//     let { sections } = formObj
//     if (!isEmpty(sections)) {
//       sections.forEach(section => {
//         let { fields } = section
//         if (!isEmpty(fields)) {
//           fields.forEach(field => {
//             console.log('f:', field)
//           })
//         }
//       })
//     }
//   }
// },
}},multisitepreventive_WoNxFormvue_type_script_lang_js=WoNxFormvue_type_script_lang_js,WoNxForm_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_WoNxFormvue_type_script_lang_js,WoNxFormvue_type_template_id_6137c2f0_render,WoNxFormvue_type_template_id_6137c2f0_staticRenderFns,!1,null,null,null)
/* harmony default export */,WoNxForm=WoNxForm_component.exports,pmformtaskvue_type_template_id_9e42e24e_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable-y100"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v("EDIT PLANNED MAINTENANCE")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_c("div",{staticClass:"fc-pm-main-content-H"},[_vm._v("TASKS")]),_c("div",{staticClass:"fc-heading-border-width43"}),_c("div",{staticClass:"fc-pm-main-inner-container"},[_c("div",{staticClass:"fc-pm-task-form-table-con"},[_c("draggable",{attrs:{options:{draggable:".asf"},element:"div",list:_vm.model.taskData.taskSections}},_vm._l(_vm.model.taskData.taskSections,(function(taskSection,key){return _c("table",{key:key,staticClass:"fc-pm-form-table mT40 fc-pm-form-task-table asf"},[_c("thead",[_c("tr",{staticClass:"visibility-visible-actions",on:{click:function($event){return _vm.setCurrentPosition(key,_vm.model.taskData.taskSections[key].tasks.length-1)}}},[_c("th",{staticStyle:{width:"10px"}}),_c("th",{staticStyle:{width:"600px"}},[_c("el-input",{staticClass:"fc-input-border-remove task-input-bold pR20 position-relative mT20 width100",staticStyle:{left:"-50px"},model:{value:taskSection.name,callback:function($$v){_vm.$set(taskSection,"name",$$v)},expression:"taskSection.name"}})],1),"bulk"===_vm.model.woData.workOrderType&&_vm.model.taskData.taskSections[key].category||"single"===_vm.model.woData.workOrderType&&_vm.model.woData.singleResource&&"SPACE"===_vm.model.woData.singleResource.resourceTypeEnum?_c("th",{staticClass:"position-relative fc-elselect-dpdown-txt"},[_c("el-select",{ref:"section-"+key,refInFor:!0,staticClass:"fc-input-full-border-select2",attrs:{filterable:""},on:{"visible-change":function($event){_vm.setCurrentPosition(key,_vm.model.taskData.taskSections[key].tasks.length-1),_vm.beforeChange($event)},change:_vm.handleSelectLabel},model:{value:_vm.model.taskData.taskSections[key].resourceLabel,callback:function($$v){_vm.$set(_vm.model.taskData.taskSections[key],"resourceLabel",$$v)},expression:"\n                          model.taskData.taskSections[key].resourceLabel\n                        "}},[_c("el-option",{staticClass:"visibility-visible-actions pm-task-active-remove",attrs:{label:_vm.categoryOptions[0].label,value:{index:key,categ:[_vm.categoryOptions[0].value]}}},[_c("div",{staticClass:"fL width200px textoverflow-ellipsis"},[_vm._v(" "+_vm._s(_vm.categoryOptions[0].label)+" ")]),"single"!==_vm.model.woData.workOrderType?_c("div",{staticClass:"fR visibility-hide-actions",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentSection(key),_vm.handleSearchSelect(key,[_vm.categoryOptions[0].value])}}},[_c("img",{attrs:{src:__webpack_require__(88804),height:"15px",width:"15px"}})]):_vm._e()]),_vm._l(_vm.categoryOptions,(function(categ,index){return 0!==index?_c("el-option-group",{key:index,attrs:{label:_vm.categoryOptions[index].label}},_vm._l(_vm.categoryOptions[index].children,(function(child,ci){return _c("el-option",{key:ci,staticClass:"visibility-visible-actions pm-task-active-remove",attrs:{label:_vm.categoryOptions[index].children[ci].label,value:{index:key,categ:[_vm.categoryOptions[index].value,_vm.categoryOptions[index].children[ci].value]}}},[_c("div",{staticClass:"fL width200px textoverflow-ellipsis"},[_vm._v(" "+_vm._s(_vm.categoryOptions[index].children[ci].label)+" ")]),_c("div",{staticClass:"fR visibility-hide-actions",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentSection(key),_vm.handleSearchSelect(key,[_vm.categoryOptions[index].value,_vm.categoryOptions[index].children[ci].value])}}},[_c("img",{attrs:{src:__webpack_require__(88804),height:"15px",width:"15px"}})])])})),1):_vm._e()}))],2)],1):_vm._e(),_c("th",{staticClass:"fc-pm-popover-btn",staticStyle:{width:"60px"}},[_c("el-button",{staticClass:"mT10",on:{click:function($event){_vm.setCurrentSection(key),_vm.showSectionSettingsDialog()}}},[_c("img",{attrs:{src:__webpack_require__(108277),height:"16px",width:"16px"}})])],1),_c("th",[_vm.model.taskData.taskSections.length>1?_c("div",{staticClass:"actions task-delete-icon-block",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentSection(key),_vm.deleteSection(key)}}},[_c("i",{staticClass:"el-icon-delete pointer fc-delete-icon visibility-hide-actions task-th-delete-icon"})]):_vm._e()])])]),_c("draggable",{attrs:{options:{draggable:".asd"},element:"tbody",list:_vm.model.taskData.taskSections[key].tasks}},_vm._l(taskSection.tasks,(function(task,taskKey){return _c("tr",{key:taskKey,staticClass:"visibility-visible-actions pointer table-hover asd",on:{click:function($event){_vm.setCurrentSection(key),_vm.setCurrentTask(taskKey)}}},[_c("td",{staticStyle:{width:"50px"}},[_c("el-input",{staticClass:"wo-task-list-num",attrs:{type:"number"},model:{value:taskSection.tasks[taskKey].additionInfo.uniqueId,callback:function($$v){_vm.$set(taskSection.tasks[taskKey].additionInfo,"uniqueId",$$v)},expression:"\n                          taskSection.tasks[taskKey].additionInfo.uniqueId\n                        "}})],1),_c("td",{staticStyle:{width:"386px"}},[_c("el-input",{ref:"task-"+key+"-"+taskKey,refInFor:!0,staticClass:"fc-input-border-remove fL mL10 pR20",staticStyle:{width:"90%"},attrs:{placeholder:"Enter a task"},nativeOn:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.onTaskEnter($event,taskKey,task.subject)},paste:function($event){return _vm.onTaskPaste(taskSection.tasks,taskKey,$event)}},model:{value:taskSection.tasks[taskKey].name,callback:function($$v){_vm.$set(taskSection.tasks[taskKey],"name",$$v)},expression:"taskSection.tasks[taskKey].name"}})],1),"bulk"===_vm.model.woData.workOrderType||"single"===_vm.model.woData.workOrderType&&_vm.model.woData.singleResource&&_vm.model.woData.singleResource.id&&"SPACE"===_vm.model.woData.singleResource.resourceTypeEnum?_c("td",[_c("el-select",{ref:key+"-"+taskKey,refInFor:!0,staticClass:"fc-input-full-border-select-hover fc-input-border-remove fc-elselect-dpdown-txt pR0",attrs:{filterable:""},on:{"visible-change":function($event){_vm.setCurrentPosition(key,taskKey),_vm.beforeTaskChange($event)},change:_vm.handleTaskSelectLabel},model:{value:_vm.model.taskData.taskSections[key].tasks[taskKey].resourceLabel,callback:function($$v){_vm.$set(_vm.model.taskData.taskSections[key].tasks[taskKey],"resourceLabel",$$v)},expression:"\n                          model.taskData.taskSections[key].tasks[taskKey]\n                            .resourceLabel\n                        "}},[_c("el-option",{staticClass:"visibility-visible-actions pm-task-active-remove",attrs:{label:_vm.getCategoryOptionsForTasksLabel(0),value:{index:key,taskIndex:taskKey,categ:[_vm.getCategoryOptionsForTasksValue(0)]}}},[_c("div",{staticClass:"fL width200px textoverflow-ellipsis"},[_vm._v(" "+_vm._s(_vm.getCategoryOptionsForTasksLabel(0))+" ")]),"single"!==_vm.model.woData.workOrderType?_c("div",{staticClass:"fR visibility-hide-actions",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentPosition(key,taskKey),_vm.handleTaskSearchSelect(key,taskKey,[_vm.getCategoryOptionsForTasksValue(0)])}}},[_c("img",{attrs:{src:__webpack_require__(88804),height:"15px",width:"15px"}})]):_vm._e()]),_vm._l(_vm.categoryOptionsForTasks,(function(categ,index){return 0!==index?_c("el-option-group",{key:index,attrs:{label:_vm.categoryOptionsForTasks[index].label}},_vm._l(_vm.categoryOptionsForTasks[index].children,(function(child,ci){return _c("el-option",{key:ci,staticClass:"visibility-visible-actions pm-task-active-remove",attrs:{label:_vm.categoryOptionsForTasks[index].children[ci].label,value:{index:key,taskIndex:taskKey,categ:[_vm.categoryOptionsForTasks[index].value,_vm.categoryOptionsForTasks[index].children[ci].value]}}},[_c("div",{staticClass:"fL width200px textoverflow-ellipsis"},[_vm._v(" "+_vm._s(_vm.categoryOptionsForTasks[index].children[ci].label)+" ")]),_c("div",{staticClass:"fR visibility-hide-actions",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentPosition(key,taskKey),_vm.handleTaskSearchSelect(key,taskKey,[_vm.categoryOptionsForTasks[index].value,_vm.categoryOptionsForTasks[index].children[ci].value])}}},[_c("img",{attrs:{src:__webpack_require__(88804),height:"15px",width:"15px"}})])])})),1):_vm._e()}))],2)],1):_vm._e(),_c("td",{staticClass:"fc-pm-popover-btn2"},[_c("el-button",{staticClass:"mT0 btn-border-hide visibility-hide-actions",on:{click:function($event){_vm.setCurrentPosition(key,taskKey),_vm.showTaskSettingsDialog()}}},[_c("img",{attrs:{src:__webpack_require__(108277),height:"16px",width:"16px"}})])],1),_c("td",[_vm.model.taskData.taskSections[key].tasks.length>1?_c("div",{staticClass:"task-delete-icon-block position-relative",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentPosition(key,taskKey),_vm.deleteTask(key,taskKey)}}},[_c("i",{staticClass:"el-icon-delete fc-delete-icon pointer visibility-hide-actions"})]):_vm._e()])])})),0)],1)})),0),_c("div",{staticClass:"mT30"},[_c("el-button",{staticClass:"fc-btn-green-medium-fill",on:{click:_vm.addNewTask}},[_vm._v("ADD TASK")]),_c("el-button",{staticClass:"fc-btn-green-medium-border mL20",on:{click:_vm.addNewSection}},[_vm._v("ADD SECTION")])],1)],1)])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save f13",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v(" PROCEED TO NEXT "),_c("img",{staticClass:"fR",attrs:{src:__webpack_require__(936658),width:"17px"}})])],1)])]),_c("el-dialog",{staticClass:"fc-dialog-center-container taskdialog2",attrs:{visible:_vm.showTaskSettings,"append-to-body":!0,title:"TASK DETAILS"},on:{"update:visible":function($event){_vm.showTaskSettings=$event}}},[_c("div",{staticClass:"task-container-scroll2"},[_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Task name")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{placeholder:"Enter a task"},model:{value:_vm.taskSettingsEdit.name,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"name",$$v)},expression:"taskSettingsEdit.name"}}),_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Description")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea mT5",attrs:{type:"textarea",autosize:{minRows:3,maxRows:3},autocomplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.taskSettingsEdit.description,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"description",$$v)},expression:"taskSettingsEdit.description"}}),_c("div",{staticClass:"mT20 mB10"},[_c("div",{staticClass:"fc-dark-grey-txt14 mT30 mB30"},[_vm._v("Task Type")]),_c("el-checkbox",{model:{value:_vm.taskSettingsEdit.enableInput,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"enableInput",$$v)},expression:"taskSettingsEdit.enableInput"}},[_vm._v("Enable Input")])],1),_vm.taskSettingsEdit.enableInput?_c("div",{staticClass:"mT20"},[_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{disabled:!("single"===_vm.model.woData.workOrderType&&"ASSET"===_vm.model.woData.singleResource.resourceTypeEnum)&&!_vm.model.taskData.taskSections[_vm.currentIndex].category&&!_vm.model.taskData.taskSections[_vm.currentIndex].tasks[_vm.currentTaskIndex].category,label:"2"},on:{change:_vm.onTaskSelectInput},model:{value:_vm.taskSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"inputType",$$v)},expression:"taskSettingsEdit.inputType"}},[_vm._v(" Reading "+_vm._s("single"===_vm.model.woData.workOrderType&&"ASSET"===_vm.model.woData.singleResource.resourceTypeEnum||_vm.model.taskData.taskSections[_vm.currentIndex].tasks[_vm.currentTaskIndex].category?"":" ( Please select Space/Asset for the task to enable )")+" ")]),_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{label:"3"},on:{change:_vm.onTaskSelectInput},model:{value:_vm.taskSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"inputType",$$v)},expression:"taskSettingsEdit.inputType"}},[_vm._v("Text")]),_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{label:"4"},on:{change:_vm.onTaskSelectInput},model:{value:_vm.taskSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"inputType",$$v)},expression:"taskSettingsEdit.inputType"}},[_vm._v("Number")]),_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{label:"5"},on:{change:_vm.onTaskSelectInput},model:{value:_vm.taskSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"inputType",$$v)},expression:"taskSettingsEdit.inputType"}},[_vm._v("Option")])],1):_vm._e(),_vm.taskSettingsEdit.enableInput&&"2"===_vm.taskSettingsEdit.inputType?_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-dark-grey-txt14 mb5"},[_vm._v("Reading Field")]),_vm.taskSettingsEdit.readingFields?_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{filterable:"",placeholder:" "},model:{value:_vm.taskSettingsEdit.readingFieldId,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"readingFieldId",$$v)},expression:"taskSettingsEdit.readingFieldId"}},_vm._l(_vm.taskSettingsEdit.readingFields,(function(readingField){return _c("el-option",{key:readingField.id,attrs:{label:readingField.displayName,value:readingField.id}})})),1):_vm._e()],1):_vm._e(),!_vm.taskSettingsEdit.enableInput||"5"!==_vm.taskSettingsEdit.inputType&&"6"!==_vm.taskSettingsEdit.inputType?_vm._e():_c("div",[_c("div",{staticClass:"fc-dark-grey-txt14 mT20"},[_vm._v("Options")]),_vm._l(_vm.taskSettingsEdit.options,(function(option,index){return _c("el-row",{key:index,staticClass:"mT20"},[_c("el-col",{attrs:{span:10}},[_c("div",[_c("el-input",{staticClass:"fc-input-full-border2 width200px task-option-input",attrs:{type:"text",placeholder:"Option "+(index+1)},on:{change:function($event){return _vm.setDefaultValueForTaskSettings(_vm.taskSettingsEdit)}},model:{value:option.name,callback:function($$v){_vm.$set(option,"name",$$v)},expression:"option.name"}},[_c("template",{slot:"prepend"},[_vm._v(_vm._s(index+1))])],2)],1)]),"5"===_vm.taskSettingsEdit.inputType?_c("el-col",{staticClass:"task-add-delete",attrs:{span:1}},[_c("div",{staticClass:"mT10 pointer",on:{click:function($event){return _vm.addTaskOption(_vm.taskSettingsEdit)}}},[_c("img",{attrs:{src:__webpack_require__(353654),width:"16",height:"16"}})])]):_vm._e(),"5"===_vm.taskSettingsEdit.inputType?_c("el-col",{attrs:{span:2}},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.taskSettingsEdit.options.length>2,expression:"taskSettingsEdit.options.length > 2"}],staticClass:"mT10 mL10",on:{click:function($event){_vm.removeOption(_vm.taskSettingsEdit,index,_vm.isTaskSettings=!0)}}},[_c("i",{staticClass:"el-icon-delete fc-delete-icon pointer"})])]):_vm._e()],1)}))],2),_vm.taskSettingsEdit.enableInput&&_vm.taskSettingsEdit.inputType&&"2"!==_vm.taskSettingsEdit.inputType?_c("div",[_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Default Value")]),"5"===_vm.taskSettingsEdit.inputType||"6"===_vm.taskSettingsEdit.inputType?_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{placeholder:"Select Default Value",clearable:""},model:{value:_vm.taskSettingsEdit.defaultValue,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"defaultValue",$$v)},expression:"taskSettingsEdit.defaultValue"}},_vm._l(_vm.taskSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:option.name}})})),1):_c("el-input",{staticClass:"fc-input-full-border2 width200px task-option-input",attrs:{type:"4"===_vm.taskSettingsEdit.inputType?"number":"text",placeholder:"Enter default value"},model:{value:_vm.taskSettingsEdit.defaultValue,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"defaultValue",$$v)},expression:"taskSettingsEdit.defaultValue"}})],1):_vm._e(),!_vm.taskSettingsEdit.enableInput||"4"!==_vm.taskSettingsEdit.inputType&&"5"!==_vm.taskSettingsEdit.inputType&&"6"!==_vm.taskSettingsEdit.inputType?_vm._e():_c("div",["4"===_vm.taskSettingsEdit.inputType?[_c("div",{staticClass:"fc-dark-grey-txt14 f15 mT20 mb5"},[_vm._v(" Deviation Condition ")]),_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:11}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mb5"},[_vm._v("Operator")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{placeholder:"Select Operator"},model:{value:_vm.taskSettingsEdit.deviationOperatorId,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"deviationOperatorId",$$v)},expression:"taskSettingsEdit.deviationOperatorId"}},[_c("el-option",{attrs:{label:"=",value:9}}),_c("el-option",{attrs:{label:"!=",value:10}}),_c("el-option",{attrs:{label:"<",value:11}}),_c("el-option",{attrs:{label:"<=",value:12}}),_c("el-option",{attrs:{label:">",value:13}}),_c("el-option",{attrs:{label:">=",value:14}})],1)],1),_c("el-col",{attrs:{span:11}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mb5"},[_vm._v("Value")]),_c("el-input",{staticClass:"fc-input-full-border2 width200px task-option-input",attrs:{type:"number",placeholder:"Enter value"},model:{value:_vm.taskSettingsEdit.failureValue,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"failureValue",$$v)},expression:"taskSettingsEdit.failureValue"}})],1)],1)]:_c("div",[_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Deviation Value")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{placeholder:"Select Deviation Value",clearable:""},model:{value:_vm.taskSettingsEdit.failureValue,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"failureValue",$$v)},expression:"taskSettingsEdit.failureValue"}},_vm._l(_vm.taskSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:option.name}})})),1)],1),_c("div",{staticClass:"mT10"},[_c("el-checkbox",{staticClass:"width-full pT20 pB10",model:{value:_vm.taskSettingsEdit.createWoOnFailure,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"createWoOnFailure",$$v)},expression:"taskSettingsEdit.createWoOnFailure"}},[_vm._v("Create Work Order on Deviation")])],1)],2),_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Validation")]),_c("div",{staticClass:"mT20"},[_c("el-checkbox",{model:{value:_vm.taskSettingsEdit.attachmentRequired,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"attachmentRequired",$$v)},expression:"taskSettingsEdit.attachmentRequired"}},[_vm._v("Photo Mandatory")])],1),_vm.taskSettingsEdit.attachmentRequired&&_vm.taskSettingsEdit.enableInput&&"5"===_vm.taskSettingsEdit.inputType?_c("div",[_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-dark-grey-txt14 mb5"},[_vm._v("Attachment Options")]),_c("el-radio-group",{staticClass:"mT10",model:{value:_vm.taskSettingsEdit.attachmentOption,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"attachmentOption",$$v)},expression:"taskSettingsEdit.attachmentOption"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"all"}},[_vm._v("All")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"specific"}},[_vm._v("Specific")])],1),"specific"===_vm.taskSettingsEdit.attachmentOption?_c("el-select",{staticClass:"fc-input-full-border-select2 fc-tag el-select-block width200px mT10",attrs:{multiple:"","collapse-tags":"",placeholder:"Select Values"},model:{value:_vm.taskSettingsEdit.attachmentOptionValues,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"attachmentOptionValues",$$v)},expression:"taskSettingsEdit.attachmentOptionValues"}},_vm._l(_vm.taskSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:option.name}})})),1):_vm._e()],1)],1)],1):_vm._e(),_vm.taskSettingsEdit.enableInput&&"5"===_vm.taskSettingsEdit.inputType?_c("div",{staticClass:"mT20"},[_c("el-checkbox",{model:{value:_vm.taskSettingsEdit.remarksRequired,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"remarksRequired",$$v)},expression:"taskSettingsEdit.remarksRequired"}},[_vm._v("Remarks Mandatory")]),_vm.taskSettingsEdit.remarksRequired?_c("div",[_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-dark-grey-txt14 mb5"},[_vm._v("Remarks Options")]),_c("el-radio-group",{staticClass:"mT10",model:{value:_vm.taskSettingsEdit.remarkOption,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"remarkOption",$$v)},expression:"taskSettingsEdit.remarkOption"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"all"}},[_vm._v("All")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"specific"}},[_vm._v("Specific")])],1),"specific"===_vm.taskSettingsEdit.remarkOption?_c("el-select",{staticClass:"fc-input-full-border-select2 fc-tag el-select-block width200px mT10",attrs:{multiple:"","collapse-tags":"",placeholder:"Select Values"},model:{value:_vm.taskSettingsEdit.remarkOptionValues,callback:function($$v){_vm.$set(_vm.taskSettingsEdit,"remarkOptionValues",$$v)},expression:"taskSettingsEdit.remarkOptionValues"}},_vm._l(_vm.taskSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:option.name}})})),1):_vm._e()],1)],1)],1):_vm._e()],1):_vm._e()],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.cancelTaskSettings}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.saveTaskSettings}},[_vm._v("SAVE")])],1)]),_c("el-dialog",{staticClass:"fc-dialog-center-container taskdialog",attrs:{visible:_vm.showSectionSettings,"append-to-body":!0,title:"CONFIGURE TASK SECTION"},on:{"update:visible":function($event){_vm.showSectionSettings=$event}}},[_c("div",{staticClass:"fc-alert-msg-info"},[_c("i",{staticClass:"fa fa-exclamation-triangle pR10",attrs:{"aria-hidden":"true"}}),_vm._v(" This setting is applied to every task in this section but can also be edited individually ")]),_c("div",{staticClass:"mT10 mB10"},[_c("div",{staticClass:"fc-dark-grey-txt14 mT30"},[_vm._v("Section Name")]),_c("el-input",{staticClass:"fc-input-full-border2 mT10",attrs:{placeholder:"Write Section Name"},model:{value:_vm.sectionSettingsEdit.name,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"name",$$v)},expression:"sectionSettingsEdit.name"}})],1),_vm.model.triggerData.triggers&&_vm.model.triggerData.triggers.length>1?_c("div",{staticClass:"fc-dark-grey-txt14 mT20"},[_vm._v(" Triggers ")]):_vm._e(),_vm.model.triggerData.triggers&&_vm.model.triggerData.triggers.length>1?_c("div",{staticClass:"mT10 mB10 flex-middle"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width-full fc-tag width90",attrs:{multiple:"","collapse-tags":""},on:{change:_vm.triggerOptionHandler},model:{value:_vm.sectionSettingsEdit.triggers,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"triggers",$$v)},expression:"sectionSettingsEdit.triggers"}},[_c("el-option",{attrs:{label:"All",value:"All"}}),_vm._l(_vm.model.triggerData.triggers,(function(trigger,index){return _c("el-option",{key:index,attrs:{label:trigger.name,value:trigger.name}})}))],2),_vm.$helpers.isLicenseEnabled("SCHEDULED_WO")?_c("img",{staticClass:"mL10 pointer",attrs:{src:__webpack_require__(238735)},on:{click:_vm.showTriggerContextDialog}}):_vm._e()],1):_vm._e(),_c("div",{staticClass:"mT20 mB10"},[_c("div",{staticClass:"width100"},[_c("div",{staticClass:"fc-dark-grey-txt14 mT20"},[_vm._v("Enable Input")]),_c("el-checkbox",{staticClass:"mT10",model:{value:_vm.sectionSettingsEdit.enableInput,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"enableInput",$$v)},expression:"sectionSettingsEdit.enableInput"}},[_vm._v("Enable Input")])],1)]),_c("div",{},[_vm.sectionSettingsEdit.enableInput?_c("div",{staticClass:"mT20 form-task-radio"},[_c("div",{staticClass:"fc-dark-grey-txt14 mT30"},[_vm._v("Task Type")]),_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{label:"3"},on:{change:_vm.onSelectInput},model:{value:_vm.sectionSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"inputType",$$v)},expression:"sectionSettingsEdit.inputType"}},[_vm._v("Text")]),_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{label:"4"},on:{change:_vm.onSelectInput},model:{value:_vm.sectionSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"inputType",$$v)},expression:"sectionSettingsEdit.inputType"}},[_vm._v("Number")]),_c("el-radio",{staticClass:"fc-radio-btn mT20",attrs:{label:"5"},on:{change:_vm.onSelectInput},model:{value:_vm.sectionSettingsEdit.inputType,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"inputType",$$v)},expression:"sectionSettingsEdit.inputType"}},[_vm._v("Option")])],1):_vm._e(),!_vm.sectionSettingsEdit.enableInput||"5"!==_vm.sectionSettingsEdit.inputType&&"6"!==_vm.sectionSettingsEdit.inputType?_vm._e():_c("div",{staticClass:"mT30"},[_c("div",{staticClass:"fc-dark-grey-txt14"},[_vm._v("Options")]),_vm._l(_vm.sectionSettingsEdit.options,(function(option,index){return _c("div",{key:index,staticClass:"mT20"},[_c("el-row",{staticClass:"visibility-visible-actions"},[_c("el-col",{attrs:{span:10}},[_c("el-input",{staticClass:"fc-input-full-border2 width200px task-option-input",attrs:{type:"text",placeholder:"Option "+(index+1)},on:{change:function($event){return _vm.setDefaultValueForSectionSettings(_vm.sectionSettingsEdit)}},model:{value:option.name,callback:function($$v){_vm.$set(option,"name",$$v)},expression:"option.name"}},[_c("template",{slot:"prepend"},[_vm._v(_vm._s(index+1))])],2)],1),"5"===_vm.sectionSettingsEdit.inputType?_c("el-col",{staticClass:"visibility-hide-actions pointer task-add-delete",attrs:{span:1}},[_c("div",{staticClass:"mT12",on:{click:function($event){return _vm.addTaskOption(_vm.sectionSettingsEdit)}}},[_c("img",{attrs:{src:__webpack_require__(353654),width:"16",height:"16"}})])]):_vm._e(),"5"===_vm.sectionSettingsEdit.inputType?_c("el-col",{staticClass:"visibility-hide-actions pointer",attrs:{span:2}},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.sectionSettingsEdit.options.length>2,expression:"sectionSettingsEdit.options.length > 2"}],staticClass:"mT12 mL10",on:{click:function($event){_vm.removeOption(_vm.sectionSettingsEdit,index,_vm.isTaskSectionSettings=!0)}}},[_c("img",{attrs:{src:__webpack_require__(385769),width:"16",height:"16"}})])]):_vm._e()],1)],1)}))],2)]),_vm.sectionSettingsEdit.enableInput&&_vm.sectionSettingsEdit.inputType&&"2"!==_vm.sectionSettingsEdit.inputType?_c("div",[_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Default Value")]),"5"===_vm.sectionSettingsEdit.inputType||"6"===_vm.sectionSettingsEdit.inputType?_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{placeholder:"Select Default Value",clearable:""},model:{value:_vm.sectionSettingsEdit.defaultValue,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"defaultValue",$$v)},expression:"sectionSettingsEdit.defaultValue"}},_vm._l(_vm.sectionSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:option.name}})})),1):_c("el-input",{staticClass:"fc-input-full-border2 width200px task-option-input",attrs:{type:"4"===_vm.sectionSettingsEdit.inputType?"number":"text",placeholder:"Enter default value"},model:{value:_vm.sectionSettingsEdit.defaultValue,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"defaultValue",$$v)},expression:"sectionSettingsEdit.defaultValue"}})],1):_vm._e(),!_vm.sectionSettingsEdit.enableInput||"4"!==_vm.sectionSettingsEdit.inputType&&"5"!==_vm.sectionSettingsEdit.inputType&&"6"!==_vm.sectionSettingsEdit.inputType?_vm._e():_c("div",["4"===_vm.sectionSettingsEdit.inputType?[_c("div",{staticClass:"fc-dark-grey-txt14 f15 mT20 mb5"},[_vm._v("Deviation Condition")]),_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:11}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mb5"},[_vm._v("Operator")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{placeholder:"Select Operator"},model:{value:_vm.sectionSettingsEdit.deviationOperatorId,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"deviationOperatorId",$$v)},expression:"sectionSettingsEdit.deviationOperatorId"}},[_c("el-option",{attrs:{label:"=",value:9}}),_c("el-option",{attrs:{label:"!=",value:10}}),_c("el-option",{attrs:{label:"<",value:11}}),_c("el-option",{attrs:{label:"<=",value:12}}),_c("el-option",{attrs:{label:">",value:13}}),_c("el-option",{attrs:{label:">=",value:14}})],1)],1),_c("el-col",{attrs:{span:11}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mb5"},[_vm._v("Value")]),_c("el-input",{staticClass:"fc-input-full-border2 width200px task-option-input",attrs:{type:"number",placeholder:"Enter value"},model:{value:_vm.sectionSettingsEdit.failureValue,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"failureValue",$$v)},expression:"sectionSettingsEdit.failureValue"}})],1)],1)]:_c("div",[_c("div",{staticClass:"fc-dark-grey-txt14 mT20 mb5"},[_vm._v("Deviation Value")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width200px",attrs:{placeholder:"Select Deviation Value",clearable:""},model:{value:_vm.sectionSettingsEdit.failureValue,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"failureValue",$$v)},expression:"sectionSettingsEdit.failureValue"}},_vm._l(_vm.sectionSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:option.name}})})),1)],1),_c("div",{staticClass:"mT10"},[_c("el-checkbox",{staticClass:"width-full pT20 pB10",model:{value:_vm.sectionSettingsEdit.createWoOnFailure,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"createWoOnFailure",$$v)},expression:"sectionSettingsEdit.createWoOnFailure"}},[_vm._v("Create Work Order on Deviation")])],1)],2),_c("div",[_c("div",{staticClass:"fc-dark-grey-txt14 mT20"},[_vm._v("Validation")]),_c("el-checkbox",{staticClass:"mT10",model:{value:_vm.sectionSettingsEdit.attachmentRequired,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"attachmentRequired",$$v)},expression:"sectionSettingsEdit.attachmentRequired"}},[_vm._v("Photo Mandatory")]),_vm.sectionSettingsEdit.attachmentRequired&&_vm.sectionSettingsEdit.enableInput&&"5"===_vm.sectionSettingsEdit.inputType?_c("div",[_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-dark-grey-txt14 mb5"},[_vm._v("Attachment Options")]),_c("el-radio-group",{staticClass:"mT10",model:{value:_vm.sectionSettingsEdit.attachmentOption,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"attachmentOption",$$v)},expression:"sectionSettingsEdit.attachmentOption"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"all"}},[_vm._v("All")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"specific"}},[_vm._v("Specific")])],1),"specific"===_vm.sectionSettingsEdit.attachmentOption?_c("el-select",{staticClass:"fc-input-full-border-select2 fc-tag el-select-block width200px mT10",attrs:{multiple:"","collapse-tags":"",placeholder:"Select Values"},model:{value:_vm.sectionSettingsEdit.attachmentOptionValues,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"attachmentOptionValues",$$v)},expression:"sectionSettingsEdit.attachmentOptionValues"}},_vm._l(_vm.sectionSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:String(option.name)}})})),1):_vm._e()],1)],1)],1):_vm._e()],1),_vm.sectionSettingsEdit.enableInput&&"5"===_vm.sectionSettingsEdit.inputType?_c("div",{staticClass:"mT20"},[_c("el-checkbox",{model:{value:_vm.sectionSettingsEdit.remarksRequired,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"remarksRequired",$$v)},expression:"sectionSettingsEdit.remarksRequired"}},[_vm._v("Remarks Mandatory")]),_vm.sectionSettingsEdit.remarksRequired?_c("div",[_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-dark-grey-txt14 mb5"},[_vm._v("Remarks Options")]),_c("el-radio-group",{staticClass:"mT10",model:{value:_vm.sectionSettingsEdit.remarkOption,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"remarkOption",$$v)},expression:"sectionSettingsEdit.remarkOption"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"all"}},[_vm._v("All")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"specific"}},[_vm._v("Specific")])],1),"specific"===_vm.sectionSettingsEdit.remarkOption?_c("el-select",{staticClass:"fc-input-full-border-select2 fc-tag el-select-block width200px mT10",attrs:{multiple:"","collapse-tags":"",placeholder:"Select Values"},model:{value:_vm.sectionSettingsEdit.remarkOptionValues,callback:function($$v){_vm.$set(_vm.sectionSettingsEdit,"remarkOptionValues",$$v)},expression:"sectionSettingsEdit.remarkOptionValues"}},_vm._l(_vm.sectionSettingsEdit.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.name,value:String(option.name)}})})),1):_vm._e()],1)],1)],1):_vm._e()],1):_vm._e(),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.cancelSectionSettings}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.saveSectionSettings}},[_vm._v("SAVE")])],1)]),_c("el-dialog",{staticClass:"fc-dialog-center-container taskdialog",attrs:{visible:_vm.showTriggerContextEdit,"append-to-body":!0},on:{"update:visible":function($event){_vm.showTriggerContextEdit=$event}}},[_c("template",{slot:"title"},[_c("div",{staticClass:"fw-bold"},[_c("img",{staticClass:"rotate-180 mR10 pointer",staticStyle:{"vertical-align":"bottom"},attrs:{src:__webpack_require__(513905),width:"15",height:"15"},on:{click:function($event){_vm.showTriggerContextEdit=!1}}}),_vm._v(" CUSTOMIZE TRIGGER ")])]),_c("div",{staticClass:"height330 overflow-y-scroll pB50"},[_c("draggable",{attrs:{list:_vm.triggerContextEdit,"data-parent":"default"}},_vm._l(_vm.triggerContextEdit,(function(context,draggableIndex){return _c("div",{key:draggableIndex,staticClass:"border-bottom10 pT10 pB10 taskhover-config pL20 pR20 visibility-visible-actions pointer"},[_c("div",{class:{"fc-dark-blue4-12":0===draggableIndex,"fc-grey-text-input-label":0!==draggableIndex,pB0:0===draggableIndex}},[_vm._v(" "+_vm._s(context.triggerName)+" ")]),0!==draggableIndex?[_c("el-checkbox",{model:{value:context.isExecuteIfNotInTime,callback:function($$v){_vm.$set(context,"isExecuteIfNotInTime",$$v)},expression:"context.isExecuteIfNotInTime"}}),_c("label",{staticClass:"pm-label"},[_vm._v("Avoid if triggered before")]),_c("el-input",{staticClass:"fc-input-full-border2 width150px task-option-input fc-form-trigger-input fw-bold",class:{"hover-actions-view":!context.isExecuteIfNotInTime},attrs:{type:"number"},model:{value:context.executeIfNotInTime,callback:function($$v){_vm.$set(context,"executeIfNotInTime",$$v)},expression:"context.executeIfNotInTime"}},[_c("template",{slot:"append"},[_vm._v("days")])],2)]:_vm._e(),_c("img",0===draggableIndex?{staticClass:"fR mT10 visibility-hide-actions cursor-drag",staticStyle:{"margin-top":"-15px"},attrs:{src:__webpack_require__(808592)}}:{staticClass:"fR mT10 visibility-hide-actions cursor-drag",attrs:{src:__webpack_require__(808592)}})],2)})),0)],1),_c("div",{staticClass:"modal-dialog-footer clearboth"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){_vm.showTriggerContextEdit=!1}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.saveTriggerContextDialog}},[_vm._v("SAVE")])],1)],2),_vm.chooserVisibility?_c("space-asset-multi-chooser",{attrs:{hideBanner:!0,visibility:_vm.chooserVisibility,showAsset:_vm.showAsset,disable:!0,initialValues:_vm.initialValues,filter:_vm.filter,resourceType:_vm.resourceFilter},on:{associate:_vm.associateResource,"update:visibility":function($event){_vm.chooserVisibility=$event}}}):_vm._e(),_vm.chooserVisibilityForTask?_c("space-asset-multi-chooser",{attrs:{hideBanner:!0,visibility:_vm.chooserVisibilityForTask,showAsset:_vm.showAsset,disable:!0,initialValues:_vm.initialValuesForTask,filter:_vm.filter,resourceType:_vm.resourceFilter},on:{associate:_vm.associateResourceForTask,"update:visibility":function($event){_vm.chooserVisibilityForTask=$event}}}):_vm._e()],1)},pmformtaskvue_type_template_id_9e42e24e_staticRenderFns=[],toConsumableArray=__webpack_require__(488478),esm_typeof=__webpack_require__(103336),SpaceAssetMultiChooser=(__webpack_require__(843843),__webpack_require__(879288),__webpack_require__(339772),__webpack_require__(648324),__webpack_require__(659749),__webpack_require__(386544),__webpack_require__(709873),__webpack_require__(673362)),vuedraggable_umd=__webpack_require__(909980),vuedraggable_umd_default=__webpack_require__.n(vuedraggable_umd),pmformtaskvue_type_script_lang_js={mixins:[PMMixin/* default */.Z],props:["model"],components:{SpaceAssetMultiChooser:SpaceAssetMultiChooser/* default */.Z,Draggable:vuedraggable_umd_default()},data:function(){return{taskPopover:{},sectionPopover:{},currentIndex:0,currentTaskIndex:0,chooserVisibility:!1,chooserVisibilityForTask:!1,showAsset:!1,showSettings:!1,inputType:null,showSectionSettings:!1,sectionSettingsEdit:{},taskSettingsEdit:{},showTaskSettings:!1,fetchedAssets:[],fetchedSpaces:[],categoryOptions:[{value:"CURRENT_FLOOR",label:"Current Floor"},{value:"asset",label:"Asset Categories"},{value:"space",label:"Space Categories"}],resourceFilter:null,oldSectionLabel:"",oldTasklabel:"",triggerContextEdit:[],showTriggerContextEdit:!1,woForms:[]}},created:function(){this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadBuildings")},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetcategory:function(state){return state.assetCategory}})),(0,vuex_esm/* mapGetters */.Se)(["getSpaceCategoryPickList"])),{},{spacecategory:function(){return this.getSpaceCategoryPickList()},categoryOptionsForTasks:function(){var _this=this,category=this.model.taskData.taskSections[this.currentIndex].category,options=[];if(!category)return[];if("CURRENT_FLOOR"===category[0]){if(options=[{value:"CURRENT_FLOOR",label:"Every Floor"}],this.fetchedAssets.length){var opt={value:"asset",label:"Asset Categories Under ".concat(this.model.woData.resourceLabel),children:[]};this.assetcategory.forEach((function(j){_this.fetchedAssets.includes(j.id)&&opt.children.push({value:j.id,label:j.name})})),options.push(opt)}if(this.fetchedSpaces.length){var _opt={value:"space",label:"Space Categories Under ".concat(this.model.woData.resourceLabel),children:[]};for(var j in this.spacecategory)this.fetchedSpaces.includes(Number(j))&&_opt.children.push({value:j,label:this.spacecategory[j]});options.push(_opt)}return options}if("CURRENT_ASSET"===category[0]){
// Old handling for assetCategory
var assetCategory=this.assetcategory.find((function(i){return i.id===Number(_this.model.woData.assetCategoryId)}));(0,validation/* isEmpty */.xb)(assetCategory)||(options=[{value:"CURRENT_ASSET",label:"Every ".concat(assetCategory.name)}])}else{if("ALL_SITES"===category[0]){if(
// Handling for Site Level PM, When category[0] is ALL_SITES.
options=[{value:"ALL_SITES",label:"Every Site"}],this.fetchedAssets.length){var assetLabel="Asset Categories Under ".concat(this.model.woData.resourceLabel),_opt2={value:"asset",label:assetLabel,children:[]};this.assetcategory.forEach((function(j){_this.fetchedAssets.includes(j.id)&&_opt2.children.push({value:j.id,label:j.name})})),options.push(_opt2)}if(this.fetchedSpaces.length){var spaceLabel="Space Categories Under ".concat(this.model.woData.resourceLabel),_opt3={value:"space",label:spaceLabel,children:[]};for(var _j in this.spacecategory)this.fetchedSpaces.includes(Number(_j))&&_opt3.children.push({value:_j,label:this.spacecategory[_j]});options.push(_opt3)}return options}if("CURRENT_SPACE"===category[0]){var currentSpaceLabel="Every ".concat(this.spacecategory[this.model.woData.spacecategoryId]);if("single"===this.model.woData.workOrderType&&(currentSpaceLabel=this.model.woData.spaceAssetDisplayName),options=[{value:"CURRENT_SPACE",label:currentSpaceLabel}],this.fetchedAssets.length){var _assetLabel="Asset Categories Under ".concat(this.model.woData.resourceLabel);"single"===this.model.woData.workOrderType&&(_assetLabel="Asset Categories Under ".concat(this.model.woData.spaceAssetDisplayName));var _opt4={value:"asset",label:_assetLabel,children:[]};this.assetcategory.forEach((function(j){_this.fetchedAssets.includes(j.id)&&_opt4.children.push({value:j.id,label:j.name})})),options.push(_opt4)}if(this.fetchedSpaces.length){var _spaceLabel="Space Categories Under ".concat(this.model.woData.resourceLabel);"single"===this.model.woData.workOrderType&&(_spaceLabel="Space Categories Under ".concat(this.model.woData.spaceAssetDisplayName));var _opt5={value:"space",label:_spaceLabel,children:[]};for(var _j2 in this.spacecategory)this.fetchedSpaces.includes(Number(_j2))&&_opt5.children.push({value:_j2,label:this.spacecategory[_j2]});options.push(_opt5)}return options}if("space"===category[0]){var spaceCateg=this.spacecategory[Number(category[1])],label="Every ".concat(spaceCateg);options=[{value:"CURRENT_SPACE",label:label},{value:"asset",label:"Asset Categories Under ".concat(label),children:[]},{value:"space",label:"Space Categories Under ".concat(label),children:[]}];var includeIds="";this.model.taskData.taskSections[this.currentIndex].selectedResourceList.length&&this.model.taskData.taskSections[this.currentIndex].selectedResourceList.forEach((function(x){includeIds+="&includeIds=".concat(x.id)}));var parentResourceIds="";"ALL_FLOORS"===this.model.woData.resourceType?this.model.woData.selectedFloorList.length&&this.model.woData.selectedFloorList.forEach((function(x){parentResourceIds+="&parentResourceIds=".concat(x.id)})):"BUILDINGS"===this.model.woData.resourceType?this.model.woData.resourceList.forEach((function(x){parentResourceIds+="&parentResourceIds=".concat(x.id)})):this.model.woData.selectedSpaceList.length&&this.model.woData.selectedSpaceList.forEach((function(x){parentResourceIds+="&parentResourceIds=".concat(x.id)}));var siteParams,parentAssignmentType,buildingId="";if(this.model.woData.selectedBuilding&&(buildingId="buildingId=".concat(this.model.woData.selectedBuilding,"&")),1===this.model.woData.sites.length)siteParams="siteIds=".concat(this.model.woData.sites[0]);else{siteParams="siteIds=".concat(this.model.woData.sites[0]);for(var i=1;i<this.model.woData.sites.length;i++)siteParams+="&siteIds=".concat(this.model.woData.sites[i])}return parentAssignmentType="ALL_FLOORS"===this.model.woData.resourceType?1:"BUILDINGS"===this.model.woData.resourceType?7:3,this.$http.get("/workorder/getScopeFilteredValuesForPM?".concat(buildingId).concat(siteParams,"&spaceCategoryId=").concat(Number(category[1])).concat(parentResourceIds,"&parentAssignmentType=").concat(parentAssignmentType,"&assignmentType=3").concat(includeIds)).then((function(response){for(var _loop=function(_i){if("asset"===options[_i].value)response.data.assetCategoryIds.length?(options[_i].children=[],_this.assetcategory.forEach((function(j){response.data.assetCategoryIds.includes(j.id)&&options[_i].children.push({value:j.id,label:j.name})}))):options.splice(_i,1);else if("space"===options[_i].value)if(response.data.spaceCategoryIds.length)for(var _j3 in options[_i].children=[],_this.spacecategory)response.data.spaceCategoryIds.includes(Number(_j3))&&options[_i].children.push({value:_j3,label:_this.spacecategory[_j3]});else options.splice(_i,1)},_i=options.length-1;_i>=1;_i--)_loop(_i)})),options}if("CURRENT_BUILDING"===category[0]){var _currentSpaceLabel="Every Building";if(options=[{value:"CURRENT_SPACE",label:_currentSpaceLabel}],this.fetchedAssets.length){var _assetLabel2="Asset Categories Under ".concat(this.model.woData.resourceLabel),_opt6={value:"asset",label:_assetLabel2,children:[]};this.assetcategory.forEach((function(j){_this.fetchedAssets.includes(j.id)&&_opt6.children.push({value:j.id,label:j.name})})),options.push(_opt6)}if(this.fetchedSpaces.length){var _spaceLabel2="Space Categories Under ".concat(this.model.woData.resourceLabel),_opt7={value:"space",label:_spaceLabel2,children:[]};for(var _j4 in this.spacecategory)this.fetchedSpaces.includes(Number(_j4))&&_opt7.children.push({value:_j4,label:this.spacecategory[_j4]});options.push(_opt7)}return options}if("asset"===category[0]){var assetCateg=this.assetcategory.find((function(i){return i.id===Number(category[1])})),_label="Every ".concat(assetCateg.name);options=[{value:"CURRENT_ASSET",label:_label}]}}return options.forEach((function(i){if("asset"===i.value)i.children=[],_this.assetcategory.forEach((function(j){i.children.push({value:j.id,label:j.name})}));else if("space"===i.value)for(var _j5 in i.children=[],_this.spacecategory)i.children.push({value:_j5,label:_this.spacecategory[_j5]})})),options},filter:function(){var filter={};return this.model.woData.sites&&1===this.model.woData.sites.length&&(filter.site=Number(this.model.woData.sites[0])),this.model.woData.selectedBuilding&&(filter.buildingId=Number(this.model.woData.selectedBuilding)),filter},buildingList:function(){var buildings=[];if(this.$store.getters.getBuildings&&this.model.woData.sites)for(var i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.$store.getters.getBuildings.length;j++)this.$store.getters.getBuildings[j].siteId===this.model.woData.sites[i]&&buildings.push(this.$store.getters.getBuildings[j]);return buildings},currentCategory:function(){return this.model.taskData.taskSections[this.currentIndex]?this.model.taskData.taskSections[this.currentIndex].category:null},currentTaskCategory:function(){return this.model.taskData.taskSections[this.currentIndex]&&this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex]?this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category:null},initialValuesForTask:function(){var category=null;if(this.currentTaskCategory?category=this.currentTaskCategory:this.currentCategory&&(category=this.currentCategory),category){if("asset"===category[0])return{assetCategory:Number(category[1]),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("space"===category[0])return{spaceCategory:Number(category[1]),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("CURRENT_FLOOR"===category[0])return{isIncludeResource:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("CURRENT_SPACE"===category[0])return{spaceCategory:Number(this.currentCategory[1]),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("CURRENT_ASSET"===category[0])return{assetCategory:Number(this.currentCategory[1]),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))}}return{isIncludeResource:null,selectedResources:[]}},initialValues:function(){var category=this.currentCategory;if(category){if("asset"===category[0])return{assetCategory:Number(category[1]),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("space"===category[0])return{spaceCategory:Number(category[1]),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("CURRENT_FLOOR"===category[0])return{isIncludeResource:this.model.taskData.taskSections[this.currentIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("CURRENT_SPACE"===category[0])return"single"===this.model.woData.workOrderType&&this.model.woData.singleResource&&this.model.woData.singleResource.id&&"SPACE"===this.model.woData.singleResource.resourceTypeEnum?{isIncludeResource:this.model.taskData.taskSections[this.currentIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))}:{spaceCategory:Number(this.model.woData.spacecategoryId),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))};if("CURRENT_ASSET"===category[0])return{assetCategory:Number(this.model.woData.assetCategoryId),isIncludeResource:this.model.taskData.taskSections[this.currentIndex].isIncludeResource,selectedResources:this.model.taskData.taskSections[this.currentIndex].selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))}}return{isIncludeResource:null,selectedResources:[]}}}),watch:{"model.woData.singleResource":{handler:function(newVal,oldVal){this.handleSingleResource(newVal,oldVal)},deep:!0},"model.woData.workOrderType":{handler:function(newVal,oldVal){this.handleSingleResource(newVal,oldVal)},deep:!0},"model.woData.selectedBuildingList":{handler:function(newVal,oldVal){this.handleWOChanges(newVal,oldVal)},deep:!0},"model.woData.selectedFloorList":{deep:!0,handler:function(newVal,oldVal){this.handleWOChanges(newVal,oldVal)}},"model.woData.selectedSpaceList":{deep:!0,handler:function(newVal,oldVal){this.handleWOChanges(newVal,oldVal)}},"model.woData.selectedResourceList":{deep:!0,handler:function(newVal,oldVal){
//this.handleWOChanges(newVal, oldVal)
}},"model.woData.spacecategoryId":{deep:!0,handler:function(newVal,oldVal){this.handleWOChanges(newVal,oldVal)}},"model.woData.assetCategoryId":{deep:!0,handler:function(newVal,oldVal){this.handleWOChanges(newVal,oldVal)}},"model.woData.resourceType":{handler:function(newVal,oldVal){this.handleWOChanges(newVal,oldVal)},deep:!0}},mounted:function(){var _this2=this;this.categoryOptions.forEach((function(i){if("asset"===i.value)i.children=[],(0,validation/* isEmpty */.xb)(_this2.assetcategory)||_this2.assetcategory.forEach((function(j){i.children.push({value:j.id,label:j.name})}));else if("space"===i.value)for(var j in i.children=[],_this2.spacecategory)i.children.push({value:j,label:_this2.spacecategory[j]})})),this.model.isEdit&&this.handleMount(),this.loadWoForms()},methods:{triggerOptionHandler:function(val){var _this3=this;
// when the options are emptied set all as default
if(val&&val.length){
// when other option is selected, remove 'all'
if(val.length>1){var index=this.sectionSettingsEdit.triggers.findIndex((function(i){return"All"===i}));index>-1&&(0===index?this.sectionSettingsEdit.triggers.splice(0,1):this.sectionSettingsEdit.triggers=["All"])}this.sectionSettingsEdit.triggerContextEdit=[],this.sectionSettingsEdit.triggers.forEach((function(i){"All"!==i&&_this3.sectionSettingsEdit.triggerContextEdit.push({executeIfNotInTime:-1,triggerName:i,isExecuteIfNotInTime:!1})}))}else this.sectionSettingsEdit.triggers=["All"]},onTaskEnter:function($event,index,subject){$event.target&&0===$event.target.selectionStart&&subject||index++,this.addNewTask(index)},beforeChange:function(val){val&&(this.oldSectionLabel=this.model.taskData.taskSections[this.currentIndex].resourceLabel)},beforeTaskChange:function(val){val&&(this.oldTasklabel=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].resourceLabel)},handleTaskSelectLabel:function(_ref){var index=_ref.index,taskIndex=_ref.taskIndex,categ=_ref.categ;this.model.taskData.taskSections[index].tasks[taskIndex].category=categ;var selectedDefault="CURRENT_FLOOR"===categ[0]||"CURRENT_ASSET"===categ[0]||"CURRENT_SPACE"===categ[0];this.changeTaskResourceLabel(selectedDefault)},handleSelectLabel:function(_ref2){var index=_ref2.index,categ=_ref2.categ;this.model.taskData.taskSections[index].category=categ;var selectedDefault="CURRENT_FLOOR"===categ[0]||"CURRENT_ASSET"===categ[0]||"CURRENT_SPACE"===categ[0];this.changeLabel(index,selectedDefault)},handleTaskSearchSelect:function(sectionIndex,taskIndex,category){var isChanged=JSON.stringify(this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].category)!==JSON.stringify(category);if(this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].category=category,1===category.length?"CURRENT_FLOOR"===category[0]?(this.showAsset=!1,this.resourceFilter=[3],this.chooserVisibilityForTask=!0):"CURRENT_ASSET"===category[0]?(this.showAsset=!0,this.resourceFilter=null,this.chooserVisibilityForTask=!0):("ALL_SITES"===category[0]||"CURRENT_SPACE"===category[0])&&(
// for site level pm - making showAsset false so that task filter dialog box shows all the resources and not only assets.
this.showAsset=!1,this.resourceFilter=null,this.chooserVisibilityForTask=!0):"space"===category[0]?(this.showAsset=!1,this.resourceFilter=null,this.chooserVisibilityForTask=!0):"asset"===category[0]&&(this.showAsset=!0,this.resourceFilter=null,this.chooserVisibilityForTask=!0),isChanged){var selectedDefault="CURRENT_FLOOR"===category[0]||"CURRENT_ASSET"===category[0]||"CURRENT_SPACE"===category[0];this.changeTaskResourceLabel(selectedDefault)}},handleSearchSelect:function(sectionIndex,category){var isChanged=JSON.stringify(this.model.taskData.taskSections[sectionIndex].category)!==JSON.stringify(category);if(this.model.taskData.taskSections[sectionIndex].category=category,1===category.length?"CURRENT_FLOOR"===category[0]?(this.showAsset=!1,this.resourceFilter=[3],this.chooserVisibility=!0):"CURRENT_ASSET"===category[0]?(this.showAsset=!0,this.resourceFilter=null,this.chooserVisibility=!0):"CURRENT_SPACE"===category[0]?(this.showAsset=!1,this.resourceFilter=null,this.chooserVisibility=!0):"ALL_SITES"===category[0]&&(
// for site level pm - making showAsset false so that task filter dialog box shows all the resources and not only assets.
this.showAsset=!1,this.resourceFilter=null,this.chooserVisibilityForTask=!0):"space"===category[0]?(this.showAsset=!1,this.resourceFilter=null,this.chooserVisibility=!0):"asset"===category[0]&&(this.showAsset=!0,this.resourceFilter=null,this.chooserVisibility=!0),isChanged){var selectedDefault="CURRENT_FLOOR"===category[0]||"CURRENT_ASSET"===category[0]||"CURRENT_SPACE"===category[0];this.changeLabel(sectionIndex,selectedDefault)}},handleMount:function(){var _this4=this,resourceType=this.model.woData.resourceType;this.model.taskData.taskSections.forEach((function(i,index){var category=_this4.model.taskData.taskSections[index].category,setDefaultName=!1;if(("ALL_FLOORS"===resourceType&&"CURRENT_FLOOR"===category[0]||"SPACE_CATEGORY"===resourceType&&"CURRENT_SPACE"===category[0]||"ASSET_CATEGORY"===resourceType&&"CURRENT_ASSET"===category[0])&&(setDefaultName=!0),_this4.model.taskData.taskSections[index].resourceLabel=_this4.resourceLabel(index,setDefaultName),"CURRENT_FLOOR"===category[0]?_this4.handleFloorCategoryOptions():"CURRENT_SPACE"===category[0]&&_this4.handleSpaceCategoryOptions("single"===_this4.model.woData.workOrderType),"ALL_FLOORS"===resourceType)_this4.categoryOptions[0]={value:"CURRENT_FLOOR",label:"Every Floor"};else if("SPACE_CATEGORY"===resourceType){var spacecategory=_this4.spacecategory[_this4.model.woData.spacecategoryId];_this4.categoryOptions[0]={value:"CURRENT_SPACE",label:"Every ".concat(spacecategory)}}else if("ASSET_CATEGORY"===resourceType){var assetCategory=_this4.assetcategory.find((function(i){return i.id===Number(_this4.model.woData.assetCategoryId)}));_this4.categoryOptions[0]={value:"CURRENT_ASSET",label:"Every ".concat(assetCategory.name)},3===_this4.categoryOptions.length?(_this4.categoryOptions.splice(1,1),_this4.categoryOptions.splice(1,1)):2===_this4.categoryOptions.length&&_this4.categoryOptions.splice(1,1)}else"single"===_this4.model.woData.workOrderType&&"SPACE"===_this4.model.woData.singleResource.resourceTypeEnum&&(_this4.categoryOptions[0]={value:"CURRENT_SPACE",label:"".concat(_this4.model.woData.spaceAssetDisplayName)},_this4.handleSpaceCategoryOptions("single"===_this4.model.woData.workOrderType));
// change
_this4.model.taskData.taskSections[index].tasks.forEach((function(task,taskIndex){
/* if (category[0] === 'CURRENT_FLOOR') {
            task.category = ['CURRENT_FLOOR']
          }
          else if (category[0] === 'CURRENT_SPACE' || category[0] === 'space') {
            task.category = ['CURRENT_SPACE']
          }
          else if (category[0] === 'CURRENT_ASSET' || category[0] === 'asset') {
            task.category = ['CURRENT_ASSET']
          } */
var setDefaultTaskName=!1;"CURRENT_ASSET"!==task.category[0]&&"CURRENT_SPACE"!==task.category[0]&&"CURRENT_FLOOR"!==task.category[0]||(setDefaultTaskName=!0),task.resourceLabel=_this4.resourceLabelForTask(index,taskIndex,setDefaultTaskName)})),_this4.$forceUpdate()}))},forceUpdate:function(){var temp=this.$helpers.cloneObject(this.triggerContextEdit);while(this.triggerContextEdit.length>0)this.triggerContextEdit.pop();while(temp.length>0)this.triggerContextEdit.push(temp.shift())},handleFloorCategoryOptions:function(){var _this5=this;if(this.model.woData.selectedBuilding)if(this.categoryOptions.length<3){this.categoryOptions.push({value:"asset",label:"Asset Categories Under ".concat(this.model.woData.resourceLabel),children:[]}),this.categoryOptions.push({value:"space",label:"Space Categories Under ".concat(this.model.woData.resourceLabel),children:[]});var includeIds="";this.model.woData.selectedFloorList.length&&this.model.woData.selectedFloorList.forEach((function(x){includeIds+="&includeIds=".concat(x.id)}));var siteParams,buildingId="";if(this.model.woData.selectedBuilding&&(buildingId="buildingId=".concat(this.model.woData.selectedBuilding,"&")),1===this.model.woData.sites.length)siteParams="siteIds=".concat(this.model.woData.sites[0]);else{siteParams="siteIds=".concat(this.model.woData.sites[0]);for(var i=1;i<this.model.woData.sites.length;i++)siteParams+="&siteIds=".concat(this.model.woData.sites[i])}this.$http.get("/workorder/getScopeFilteredValuesForPM?".concat(buildingId).concat(siteParams,"&assignmentType=1").concat(includeIds)).then((function(response){_this5.fetchedAssets=response.data.assetCategoryIds,_this5.fetchedSpaces=response.data.spaceCategoryIds;for(var assetFilled=!1,spaceFilled=!1,toDelete=[],_loop2=function(_i2){if("asset"===_this5.categoryOptions[_i2].value)assetFilled?toDelete.push(_i2):(_this5.fetchedAssets.length?(_this5.categoryOptions[_i2].children=[],_this5.assetcategory.forEach((function(j){_this5.fetchedAssets.includes(j.id)&&_this5.categoryOptions[_i2].children.push({value:j.id,label:j.name})}))):toDelete.push(_i2),assetFilled=!0);else if("space"===_this5.categoryOptions[_i2].value)if(spaceFilled)toDelete.push(_i2);else{if(_this5.fetchedSpaces.length)for(var j in _this5.categoryOptions[_i2].children=[],_this5.spacecategory)_this5.fetchedSpaces.includes(Number(j))&&_this5.categoryOptions[_i2].children.push({value:j,label:_this5.spacecategory[j]});else toDelete.push(_i2);spaceFilled=!0}},_i2=_this5.categoryOptions.length-1;_i2>=1;_i2--)_loop2(_i2);toDelete.forEach((function(n){return _this5.categoryOptions.splice(n,1)}))}))}else{var _includeIds="";this.model.woData.selectedFloorList.length&&this.model.woData.selectedFloorList.forEach((function(x){_includeIds+="&includeIds=".concat(x.id)}));var _siteParams,_buildingId="";if(this.model.woData.selectedBuilding&&(_buildingId="buildingId=".concat(this.model.woData.selectedBuilding,"&")),1===this.model.woData.sites.length)_siteParams="siteIds=".concat(this.model.woData.sites[0]);else{_siteParams="siteIds=".concat(this.model.woData.sites[0]);for(var _i3=1;_i3<this.model.woData.sites.length;_i3++)_siteParams+="&siteIds=".concat(this.model.woData.sites[_i3])}this.$http.get("/workorder/getScopeFilteredValuesForPM?".concat(_buildingId).concat(_siteParams,"&assignmentType=1").concat(_includeIds)).then((function(response){_this5.fetchedAssets=response.data.assetCategoryIds,_this5.fetchedSpaces=response.data.spaceCategoryIds;for(var assetFilled=!1,spaceFilled=!1,toDelete=[],_loop3=function(_i4){if("asset"===_this5.categoryOptions[_i4].value)assetFilled?toDelete.push(_i4):(_this5.fetchedAssets.length?(_this5.categoryOptions[_i4].label="Asset Categories Under ".concat(_this5.model.woData.resourceLabel),_this5.categoryOptions[_i4].children=[],_this5.assetcategory.forEach((function(j){_this5.fetchedAssets.includes(j.id)&&_this5.categoryOptions[_i4].children.push({value:j.id,label:j.name})}))):toDelete.push(_i4),assetFilled=!0);else if("space"===_this5.categoryOptions[_i4].value)if(spaceFilled)toDelete.push(_i4);else{if(_this5.fetchedSpaces.length)for(var j in _this5.categoryOptions[_i4].label="Space Categories Under ".concat(_this5.model.woData.resourceLabel),_this5.categoryOptions[_i4].children=[],_this5.spacecategory)_this5.fetchedSpaces.includes(Number(j))&&_this5.categoryOptions[_i4].children.push({value:j,label:_this5.spacecategory[j]});else toDelete.push(_i4);spaceFilled=!0}},_i4=_this5.categoryOptions.length-1;_i4>=1;_i4--)_loop3(_i4);toDelete.forEach((function(n){return _this5.categoryOptions.splice(n,1)}))}))}},handleAllBuildingsOptions:function(){var _this6=this,hasAsset=!1,hasSpace=!1;if(this.categoryOptions.forEach((function(x){"asset"===x.value?hasAsset=!0:"space"===x.value&&(hasSpace=!0)})),this.categoryOptions.length<3){hasAsset||this.categoryOptions.push({value:"asset",label:"Asset Categories Under ".concat(this.model.woData.resourceLabel),children:[]}),hasSpace||this.categoryOptions.push({value:"space",label:"Space Categories Under ".concat(this.model.woData.resourceLabel),children:[]});var siteParams,url="";if(1===this.model.woData.sites.length)siteParams="siteIds=".concat(this.model.woData.sites[0]);else{siteParams="siteIds=".concat(this.model.woData.sites[0]);for(var i=1;i<this.model.woData.sites.length;i++)siteParams+="&siteIds=".concat(this.model.woData.sites[i])}var buildingId="";if(this.model.woData.selectedBuildingList&&this.model.woData.selectedBuildingList.length)if(1===this.model.woData.selectedBuildingList.length)buildingId="buildingIds=".concat(this.model.woData.selectedBuildingList[0],"&");else{buildingId="buildingIds=".concat(this.model.woData.selectedBuildingList[0],"&");for(var _i5=1;_i5<this.model.woData.selectedBuildingList.length;_i5++)buildingId+="buildingIds=".concat(this.model.woData.selectedBuildingList[_i5],"&")}url="/workorder/getScopeFilteredValuesForPM?".concat(buildingId).concat(siteParams,"&assignmentType=7"),this.$http.get(url).then((function(response){_this6.fetchedAssets=response.data.assetCategoryIds||[],_this6.fetchedSpaces=response.data.spaceCategoryIds||[];for(var _loop4=function(_i6){if("asset"===_this6.categoryOptions[_i6].value)_this6.fetchedAssets.length?(_this6.categoryOptions[_i6].children=[],_this6.assetcategory.forEach((function(j){_this6.fetchedAssets.includes(j.id)&&_this6.categoryOptions[_i6].children.push({value:j.id,label:j.name})}))):_this6.categoryOptions.splice(_i6,1);else if("space"===_this6.categoryOptions[_i6].value)if(_this6.fetchedSpaces.length)for(var j in _this6.categoryOptions[_i6].children=[],_this6.spacecategory)_this6.fetchedSpaces.includes(Number(j))&&_this6.categoryOptions[_i6].children.push({value:j,label:_this6.spacecategory[j]});else _this6.categoryOptions.splice(_i6,1)},_i6=_this6.categoryOptions.length-1;_i6>=1;_i6--)_loop4(_i6)}))}else{var _siteParams2,_url="";if(1===this.model.woData.sites.length)_siteParams2="siteIds=".concat(this.model.woData.sites[0]);else{_siteParams2="siteIds=".concat(this.model.woData.sites[0]);for(var _i7=1;_i7<this.model.woData.sites.length;_i7++)_siteParams2+="&siteIds=".concat(this.model.woData.sites[_i7])}var _buildingId2="";if(this.model.woData.selectedBuildingList&&this.model.woData.selectedBuildingList.length)if(1===this.model.woData.selectedBuildingList.length)_buildingId2="buildingIds=".concat(this.model.woData.selectedBuildingList[0],"&");else{_buildingId2="buildingIds=".concat(this.model.woData.selectedBuildingList[0],"&");for(var _i8=1;_i8<this.model.woData.selectedBuildingList.length;_i8++)_buildingId2+="buildingIds=".concat(this.model.woData.selectedBuildingList[_i8],"&")}_url="/workorder/getScopeFilteredValuesForPM?".concat(_buildingId2).concat(_siteParams2,"&assignmentType=7"),this.$http.get(_url).then((function(response){_this6.fetchedAssets=response.data.assetCategoryIds||[],_this6.fetchedSpaces=response.data.spaceCategoryIds||[];for(var _loop5=function(_i9){if("asset"===_this6.categoryOptions[_i9].value)_this6.fetchedAssets.length?(_this6.categoryOptions[_i9].label="Asset Categories Under ".concat(_this6.model.woData.resourceLabel),_this6.categoryOptions[_i9].children=[],_this6.assetcategory.forEach((function(j){_this6.fetchedAssets.includes(j.id)&&_this6.categoryOptions[_i9].children.push({value:j.id,label:j.name})}))):_this6.categoryOptions.splice(_i9,1);else if("space"===_this6.categoryOptions[_i9].value)if(_this6.fetchedSpaces.length)for(var j in _this6.categoryOptions[_i9].label="Space Categories Under ".concat(_this6.model.woData.resourceLabel),_this6.categoryOptions[_i9].children=[],_this6.spacecategory)_this6.fetchedSpaces.includes(Number(j))&&_this6.categoryOptions[_i9].children.push({value:j,label:_this6.spacecategory[j]});else _this6.categoryOptions.splice(_i9,1)},_i9=_this6.categoryOptions.length-1;_i9>=1;_i9--)_loop5(_i9)}))}},handleSpaceCategoryOptions:function(isSingleWo){var _this7=this,hasAsset=!1,hasSpace=!1;if(this.categoryOptions.forEach((function(x){"asset"===x.value?hasAsset=!0:"space"===x.value&&(hasSpace=!0)})),this.categoryOptions.length<3){isSingleWo?(hasAsset||this.categoryOptions.push({value:"asset",label:"Asset Categories Under ".concat(this.model.woData.spaceAssetDisplayName),children:[]}),hasSpace||this.categoryOptions.push({value:"space",label:"Space Categories Under ".concat(this.model.woData.spaceAssetDisplayName),children:[]})):(hasAsset||this.categoryOptions.push({value:"asset",label:"Asset Categories Under ".concat(this.model.woData.resourceLabel),children:[]}),hasSpace||this.categoryOptions.push({value:"space",label:"Space Categories Under ".concat(this.model.woData.resourceLabel),children:[]}));var includeIds="";isSingleWo?includeIds="&includeIds=".concat(this.model.woData.singleResource.id):this.model.woData.selectedSpaceList.length&&this.model.woData.selectedSpaceList.forEach((function(x){includeIds+="&includeIds=".concat(x.id)}));var siteParams,url="";if(1===this.model.woData.sites.length)siteParams="siteIds=".concat(this.model.woData.sites[0]);else{siteParams="siteIds=".concat(this.model.woData.sites[0]);for(var i=1;i<this.model.woData.sites.length;i++)siteParams+="&siteIds=".concat(this.model.woData.sites[i])}if(isSingleWo)url="/workorder/getScopeFilteredValuesForPM?siteId=".concat(this.model.woData.woModel.site.id,"&assignmentType=3").concat(includeIds);else{var buildingId="";this.model.woData.selectedBuilding&&(buildingId="buildingId=".concat(this.model.woData.selectedBuilding,"&")),url="/workorder/getScopeFilteredValuesForPM?".concat(buildingId).concat(siteParams,"&spaceCategoryId=").concat(this.model.woData.spacecategoryId,"&assignmentType=3").concat(includeIds)}this.$http.get(url).then((function(response){_this7.fetchedAssets=response.data.assetCategoryIds,_this7.fetchedSpaces=response.data.spaceCategoryIds;for(var _loop6=function(_i10){if("asset"===_this7.categoryOptions[_i10].value)_this7.fetchedAssets.length?(_this7.categoryOptions[_i10].children=[],_this7.assetcategory.forEach((function(j){_this7.fetchedAssets.includes(j.id)&&_this7.categoryOptions[_i10].children.push({value:j.id,label:j.name})}))):_this7.categoryOptions.splice(_i10,1);else if("space"===_this7.categoryOptions[_i10].value)if(_this7.fetchedSpaces.length)for(var j in _this7.categoryOptions[_i10].children=[],_this7.spacecategory)_this7.fetchedSpaces.includes(Number(j))&&_this7.categoryOptions[_i10].children.push({value:j,label:_this7.spacecategory[j]});else _this7.categoryOptions.splice(_i10,1)},_i10=_this7.categoryOptions.length-1;_i10>=1;_i10--)_loop6(_i10)}))}else{var _includeIds2="";if(isSingleWo)_includeIds2="&includeIds=".concat(this.model.woData.singleResource.id);else{if(!this.model.woData.spacecategoryId)return;this.model.woData.selectedSpaceList.length&&this.model.woData.selectedSpaceList.forEach((function(x){_includeIds2+="&includeIds=".concat(x.id)}))}var _url2="";if(isSingleWo)_url2="/workorder/getScopeFilteredValuesForPM?siteId=".concat(this.model.woData.woModel.site.id,"&assignmentType=3").concat(_includeIds2);else{var _siteParams3;if(1===this.model.woData.sites.length)_siteParams3="siteIds=".concat(this.model.woData.sites[0]);else{_siteParams3="siteIds=".concat(this.model.woData.sites[0]);for(var _i11=1;_i11<this.model.woData.sites.length;_i11++)_siteParams3+="&siteIds=".concat(this.model.woData.sites[_i11])}var _buildingId3="";this.model.woData.selectedBuilding&&(_buildingId3="buildingId=".concat(this.model.woData.selectedBuilding,"&")),_url2="/workorder/getScopeFilteredValuesForPM?".concat(_buildingId3).concat(_siteParams3,"&spaceCategoryId=").concat(this.model.woData.spacecategoryId,"&assignmentType=3").concat(_includeIds2)}this.$http.get(_url2).then((function(response){_this7.fetchedAssets=response.data.assetCategoryIds,_this7.fetchedSpaces=response.data.spaceCategoryIds;for(var _loop7=function(_i12){if("asset"===_this7.categoryOptions[_i12].value)_this7.fetchedAssets.length?(_this7.categoryOptions[_i12].label="Asset Categories Under ".concat(isSingleWo?_this7.model.woData.spaceAssetDisplayName:_this7.model.woData.resourceLabel),_this7.categoryOptions[_i12].children=[],_this7.assetcategory.forEach((function(j){_this7.fetchedAssets.includes(j.id)&&_this7.categoryOptions[_i12].children.push({value:j.id,label:j.name})}))):_this7.categoryOptions.splice(_i12,1);else if("space"===_this7.categoryOptions[_i12].value)if(_this7.fetchedSpaces.length)for(var j in _this7.categoryOptions[_i12].label="Space Categories Under ".concat(isSingleWo?_this7.model.woData.spaceAssetDisplayName:_this7.model.woData.resourceLabel),_this7.categoryOptions[_i12].children=[],_this7.spacecategory)_this7.fetchedSpaces.includes(Number(j))&&_this7.categoryOptions[_i12].children.push({value:j,label:_this7.spacecategory[j]});else _this7.categoryOptions.splice(_i12,1)},_i12=_this7.categoryOptions.length-1;_i12>=1;_i12--)_loop7(_i12)}))}},handleAllSitesOptions:function(){var _this8=this,hasAsset=!1,hasSpace=!1;if(this.categoryOptions.forEach((function(x){"asset"===x.value?hasAsset=!0:"space"===x.value?hasSpace=!0:"building"===x.value&&!0})),this.categoryOptions.length<3){hasAsset||this.categoryOptions.push({value:"asset",label:"Asset Categories Under ".concat(this.model.woData.resourceLabel),children:[]}),hasSpace||this.categoryOptions.push({value:"space",label:"Space Categories Under ".concat(this.model.woData.resourceLabel),children:[]});var siteParams,url="";if(1===this.model.woData.sites.length)siteParams="siteIds=".concat(this.model.woData.sites[0]);else{siteParams="siteIds=".concat(this.model.woData.sites[0]);for(var i=1;i<this.model.woData.sites.length;i++)siteParams+="&siteIds=".concat(this.model.woData.sites[i])}url="/workorder/getScopeFilteredValuesForPM?".concat(siteParams,"&assignmentType=8"),this.$http.get(url).then((function(response){_this8.fetchedAssets=response.data.assetCategoryIds||[],_this8.fetchedSpaces=response.data.spaceCategoryIds||[];for(var _loop8=function(_i13){if("asset"===_this8.categoryOptions[_i13].value)_this8.fetchedAssets.length?(_this8.categoryOptions[_i13].children=[],_this8.assetcategory.forEach((function(j){_this8.fetchedAssets.includes(j.id)&&_this8.categoryOptions[_i13].children.push({value:j.id,label:j.name})}))):_this8.categoryOptions.splice(_i13,1);else if("space"===_this8.categoryOptions[_i13].value)if(_this8.fetchedSpaces.length)for(var j in _this8.categoryOptions[_i13].children=[],_this8.spacecategory)_this8.fetchedSpaces.includes(Number(j))&&_this8.categoryOptions[_i13].children.push({value:j,label:_this8.spacecategory[j]});else _this8.categoryOptions.splice(_i13,1)},_i13=_this8.categoryOptions.length-1;_i13>=1;_i13--)_loop8(_i13)}))}else{var _siteParams4,_url3="";if(1===this.model.woData.sites.length)_siteParams4="siteIds=".concat(this.model.woData.sites[0]);else{_siteParams4="siteIds=".concat(this.model.woData.sites[0]);for(var _i14=1;_i14<this.model.woData.sites.length;_i14++)_siteParams4+="&siteIds=".concat(this.model.woData.sites[_i14])}_url3="/workorder/getScopeFilteredValuesForPM?".concat(_siteParams4,"&assignmentType=8"),this.$http.get(_url3).then((function(response){_this8.fetchedAssets=response.data.assetCategoryIds||[],_this8.fetchedSpaces=response.data.spaceCategoryIds||[];for(var _loop9=function(_i15){if("asset"===_this8.categoryOptions[_i15].value)_this8.fetchedAssets.length?(_this8.categoryOptions[_i15].label="Asset Categories Under ".concat(_this8.model.woData.resourceLabel),_this8.categoryOptions[_i15].children=[],_this8.assetcategory.forEach((function(j){_this8.fetchedAssets.includes(j.id)&&_this8.categoryOptions[_i15].children.push({value:j.id,label:j.name})}))):_this8.categoryOptions.splice(_i15,1);else if("space"===_this8.categoryOptions[_i15].value)if(_this8.fetchedSpaces.length)for(var j in _this8.categoryOptions[_i15].label="Space Categories Under ".concat(_this8.model.woData.resourceLabel),_this8.categoryOptions[_i15].children=[],_this8.spacecategory)_this8.fetchedSpaces.includes(Number(j))&&_this8.categoryOptions[_i15].children.push({value:j,label:_this8.spacecategory[j]});else _this8.categoryOptions.splice(_i15,1)},_i15=_this8.categoryOptions.length-1;_i15>=1;_i15--)_loop9(_i15)}))}},handleWOChanges:function(newVal,oldVal){var _this9=this;if(newVal!==oldVal&&newVal)if("ALL_FLOORS"===this.model.woData.resourceType)this.categoryOptions[0]={value:"CURRENT_FLOOR",label:"Every Floor"},this.model.taskData.taskSections.forEach((function(i,index){i.category=["CURRENT_FLOOR"],_this9.changeLabelForSection(index,!0)})),this.handleFloorCategoryOptions();else if("SPACE_CATEGORY"===this.model.woData.resourceType){if(!this.model.woData.spacecategoryId)return;var spacecategory=this.spacecategory[this.model.woData.spacecategoryId];this.categoryOptions[0]={value:"CURRENT_SPACE",label:"Every ".concat(spacecategory)},this.model.taskData.taskSections.forEach((function(i,index){i.category=["CURRENT_SPACE"],_this9.changeLabelForSection(index,!0)})),this.handleSpaceCategoryOptions()}else if("ASSET_CATEGORY"===this.model.woData.resourceType){var assetCategory=this.assetcategory.find((function(i){return i.id===Number(_this9.model.woData.assetCategoryId)}));(0,validation/* isEmpty */.xb)(assetCategory)||(this.categoryOptions[0]={value:"CURRENT_ASSET",label:"Every ".concat(assetCategory.name)},this.model.taskData.taskSections.forEach((function(i,index){i.category=["CURRENT_ASSET"],_this9.changeLabelForSection(index,!0)})),3===this.categoryOptions.length?(this.categoryOptions.splice(2,1),this.categoryOptions.splice(1,1)):2===this.categoryOptions.length&&this.categoryOptions.splice(1,1))}else"BUILDINGS"===this.model.woData.resourceType?(this.categoryOptions=[{value:"CURRENT_BUILDING",label:"Every Building"}],this.model.taskData.taskSections.forEach((function(i,index){i.category=["CURRENT_BUILDING"],_this9.changeLabelForSection(index,!0)})),this.handleAllBuildingsOptions()):"ALL_SITES"===this.model.woData.resourceType&&(
// Handling Site Level PM
this.categoryOptions=[{value:"ALL_SITES",label:"Every Sites"}],this.model.taskData.taskSections.forEach((function(i,index){i.category=["ALL_SITES"],_this9.changeLabelForSection(index,!0)})),this.handleAllSitesOptions())},showTaskSettingsDialog:function(){this.taskSettingsEdit={attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,inputType:null,options:[],description:"",name:"",defaultValue:"",failureValue:"",createWoOnFailure:!1,woCreateFormId:null,deviationOperatorId:null,readingFields:[],remarkOption:"all",remarkOptionValues:[],remarksRequired:!1,attachmentOptionValues:[],attachmentOption:"all"},this.taskSettingsEdit.name=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].name,this.taskSettingsEdit.description=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].description,this.taskSettingsEdit.attachmentRequired=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].attachmentRequired,this.taskSettingsEdit.enableInput=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].enableInput,this.taskSettingsEdit.readingFieldId=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].readingFieldId,this.taskSettingsEdit.validation=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].validation,this.taskSettingsEdit.minSafeLimit=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].minSafeLimit,this.taskSettingsEdit.maxSafeLimit=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].maxSafeLimit,this.taskSettingsEdit.readingFields=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].readingFields,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].options&&this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].options.length?this.taskSettingsEdit.options=this.$helpers.cloneObject(this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].options):this.taskSettingsEdit.options=[{name:""},{name:""}],this.taskSettingsEdit.inputType=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].inputType,"2"!==this.taskSettingsEdit.inputType||this.taskSettingsEdit.readingFields&&this.taskSettingsEdit.readingFields.length||this.fillTaskReadingsForTasks();var task=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex];this.taskSettingsEdit.defaultValue=task.additionInfo.defaultValue,this.taskSettingsEdit.failureValue=task.additionInfo.failureValue,this.taskSettingsEdit.deviationOperatorId=task.additionInfo.deviationOperatorId,this.taskSettingsEdit.woCreateFormId=task.additionInfo.woCreateFormId,this.taskSettingsEdit.remarksRequired=task.additionInfo.remarksRequired,this.taskSettingsEdit.remarkOptionValues=task.additionInfo.remarkOptionValues,this.taskSettingsEdit.remarkOption=!(0,validation/* isEmpty */.xb)(task.additionInfo.remarkOptionValues)&&(0,validation/* isArray */.kJ)(task.additionInfo.remarkOptionValues)&&task.additionInfo.remarkOptionValues.length>0?"specific":"all",this.taskSettingsEdit.attachmentOptionValues=task.additionInfo.attachmentOptionValues,this.taskSettingsEdit.attachmentOption=!(0,validation/* isEmpty */.xb)(task.additionInfo.attachmentOptionValues)&&(0,validation/* isArray */.kJ)(task.additionInfo.attachmentOptionValues)&&task.additionInfo.attachmentOptionValues.length>0?"specific":"all",(0,validation/* isEmpty */.xb)(task.additionInfo.createWoOnFailure)?this.taskSettingsEdit.createWoOnFailure=!1:this.taskSettingsEdit.createWoOnFailure=task.additionInfo.createWoOnFailure,this.showTaskSettings=!0},saveTaskSettings:function(){this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].name=this.taskSettingsEdit.name,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].description=this.taskSettingsEdit.description,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].attachmentRequired=this.taskSettingsEdit.attachmentRequired,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].enableInput=this.taskSettingsEdit.enableInput,(0,validation/* isEmpty */.xb)(this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].inputType)&&"2"===this.taskSettingsEdit.inputType||this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].inputType!==this.taskSettingsEdit.inputType&&"2"===this.taskSettingsEdit.inputType||this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].inputType===this.taskSettingsEdit.inputType?
/** Will be true, when 
            1) Reading is selected initially.
            2) Reading is selected after selecting other input type. 
            3) Same Input Type is selected saved/no changes is done in input type.
        **/
this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].readingFieldId=this.taskSettingsEdit.readingFieldId:
// INPUT_TYPE has been changed.
// Assigning - 1, so that readingFieldId gets updated to new value in backend.
this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].readingFieldId=-1,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].validation=this.taskSettingsEdit.validation,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].minSafeLimit=this.taskSettingsEdit.minSafeLimit,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].maxSafeLimit=this.taskSettingsEdit.maxSafeLimit,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].readingFields=this.taskSettingsEdit.readingFields,this.taskSettingsEdit.enableInput&&this.taskSettingsEdit.options?this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].options=this.$helpers.cloneObject(this.taskSettingsEdit.options):this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].options=[],this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].inputType=this.taskSettingsEdit.inputType,this.taskSettingsEdit.enableInput||(this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].inputType=null);var task=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex];"2"===task.inputType&&task.readingFieldId>-1?task.additionInfo.defaultValue="":task.additionInfo.defaultValue=this.taskSettingsEdit.defaultValue,task.additionInfo.failureValue=this.taskSettingsEdit.failureValue,task.additionInfo.deviationOperatorId=this.taskSettingsEdit.deviationOperatorId,task.additionInfo.remarksRequired=this.taskSettingsEdit.remarksRequired,task.additionInfo.remarkOptionValues=this.taskSettingsEdit.remarkOptionValues,task.additionInfo.attachmentOptionValues="specific"===this.taskSettingsEdit.attachmentOption?this.taskSettingsEdit.attachmentOptionValues:[],task.additionInfo.createWoOnFailure=this.taskSettingsEdit.createWoOnFailure,
// below support for formId might be removed soon
// if (this.taskSettingsEdit.createWoOnFailure) {
//   task.additionInfo.woCreateFormId = this.taskSettingsEdit.woCreateFormId
// } else {
//   delete task.additionInfo.woCreateFormId
// }
this.showTaskSettings=!1},cancelTaskSettings:function(){this.showTaskSettings=!1},showTriggerContextDialog:function(){var _this10=this;"All"===this.sectionSettingsEdit.triggers[0]?(this.triggerContextEdit=[],this.model.triggerData.triggers.forEach((function(i){_this10.triggerContextEdit.push({executeIfNotInTime:1,triggerName:i.name,isExecuteIfNotInTime:!1})}))):(this.triggerContextEdit=this.$helpers.cloneObject(this.sectionSettingsEdit.triggerContextEdit),this.triggerContextEdit.forEach((function(i){i.isExecuteIfNotInTime<0&&(i.isExecuteIfNotInTime=1)}))),this.showTriggerContextEdit=!0},saveTriggerContextDialog:function(){var _this11=this;this.sectionSettingsEdit.triggerContextEdit=this.$helpers.cloneObject(this.triggerContextEdit),this.sectionSettingsEdit.triggerContextEdit||(this.sectionSettingsEdit.triggerContextEdit=[]),this.sectionSettingsEdit.triggers=[],this.sectionSettingsEdit.triggerContextEdit.forEach((function(i,index){i.isExecuteIfNotInTime||(i.executeIfNotInTime=1),_this11.sectionSettingsEdit.triggers.push(i.triggerName)})),this.showTriggerContextEdit=!1},showSectionSettingsDialog:function(){var _this12=this;this.sectionSettingsEdit={attachmentRequired:!1,enableInput:!1,validation:null,minSafeLimit:null,maxSafeLimit:null,inputType:null,options:[],name:"",triggers:[],triggerContextEdit:[],showTriggerContextEdit:!1,currentIndex:this.currentIndex,defaultValue:"",failureValue:"",deviationOperatorId:null,createWoOnFailure:!1,woCreateFormId:null,remarkOption:"all",remarkOptionValues:[],remarksRequired:!1,attachmentOptionValues:[],attachmentOption:"all"},this.sectionSettingsEdit.attachmentRequired=this.model.taskData.taskSections[this.currentIndex].attachmentRequired,this.sectionSettingsEdit.enableInput=this.model.taskData.taskSections[this.currentIndex].enableInput,this.sectionSettingsEdit.validation=this.model.taskData.taskSections[this.currentIndex].validation,this.sectionSettingsEdit.minSafeLimit=this.model.taskData.taskSections[this.currentIndex].minSafeLimit,this.sectionSettingsEdit.maxSafeLimit=this.model.taskData.taskSections[this.currentIndex].maxSafeLimit,this.sectionSettingsEdit.name=this.model.taskData.taskSections[this.currentIndex].name,this.model.taskData.taskSections[this.currentIndex].options&&this.model.taskData.taskSections[this.currentIndex].options.length?this.sectionSettingsEdit.options=this.$helpers.cloneObject(this.model.taskData.taskSections[this.currentIndex].options):this.sectionSettingsEdit.options=[{name:""},{name:""}],this.sectionSettingsEdit.inputType=this.model.taskData.taskSections[this.currentIndex].inputType;var triggerNames=[];this.model.taskData.taskSections[this.currentIndex].triggers&&this.model.taskData.taskSections[this.currentIndex].triggers.length&&this.model.taskData.taskSections[this.currentIndex].triggers.forEach((function(i){triggerNames.push(i.triggerName),"All"!==i.triggerName&&_this12.sectionSettingsEdit.triggerContextEdit.push({executeIfNotInTime:i.executeIfNotInTime>0?i.executeIfNotInTime:1,triggerName:i.triggerName,isExecuteIfNotInTime:!!i.executeIfNotInTime&&i.executeIfNotInTime>-1})})),this.sectionSettingsEdit.triggers=triggerNames;var task=this.model.taskData.taskSections[this.currentIndex];this.sectionSettingsEdit.defaultValue=task.additionInfo.defaultValue,this.sectionSettingsEdit.failureValue=task.additionInfo.failureValue,this.sectionSettingsEdit.deviationOperatorId=task.additionInfo.deviationOperatorId,this.sectionSettingsEdit.woCreateFormId=task.additionInfo.woCreateFormId,this.sectionSettingsEdit.remarksRequired=task.additionInfo.remarksRequired,this.sectionSettingsEdit.remarkOptionValues=task.additionInfo.remarkOptionValues,this.sectionSettingsEdit.remarkOption=!(0,validation/* isEmpty */.xb)(task.additionInfo.remarkOptionValues)&&(0,validation/* isArray */.kJ)(task.additionInfo.remarkOptionValues)&&task.additionInfo.remarkOptionValues.length>0?"specific":"all",this.sectionSettingsEdit.attachmentOptionValues=task.additionInfo.attachmentOptionValues,this.sectionSettingsEdit.attachmentOption=!(0,validation/* isEmpty */.xb)(task.additionInfo.attachmentOptionValues)&&(0,validation/* isArray */.kJ)(task.additionInfo.attachmentOptionValues)&&task.additionInfo.attachmentOptionValues.length>0?"specific":"all",(0,validation/* isEmpty */.xb)(task.additionInfo.createWoOnFailure)?this.sectionSettingsEdit.createWoOnFailure=!1:this.sectionSettingsEdit.createWoOnFailure=task.additionInfo.createWoOnFailure,this.showSectionSettings=!0},saveSectionSettings:function(){var _this13=this;this.model.taskData.taskSections[this.currentIndex].attachmentRequired=this.sectionSettingsEdit.attachmentRequired,this.model.taskData.taskSections[this.currentIndex].enableInput=this.sectionSettingsEdit.enableInput,this.model.taskData.taskSections[this.currentIndex].validation=this.sectionSettingsEdit.validation,this.model.taskData.taskSections[this.currentIndex].minSafeLimit=this.sectionSettingsEdit.minSafeLimit,this.model.taskData.taskSections[this.currentIndex].maxSafeLimit=this.sectionSettingsEdit.maxSafeLimit,this.model.taskData.taskSections[this.currentIndex].triggers=[];var triggerContextMap={};this.sectionSettingsEdit.triggerContextEdit&&this.sectionSettingsEdit.triggerContextEdit.length&&this.sectionSettingsEdit.triggerContextEdit.forEach((function(i){triggerContextMap[i.triggerName]=i})),this.sectionSettingsEdit.triggers&&this.sectionSettingsEdit.triggers.length&&this.sectionSettingsEdit.triggers.forEach((function(i){_this13.model.taskData.taskSections[_this13.currentIndex].triggers.push({triggerName:i,executeIfNotInTime:triggerContextMap[i]&&triggerContextMap[i].isExecuteIfNotInTime?triggerContextMap[i].executeIfNotInTime:-1})})),this.model.taskData.taskSections[this.currentIndex].enableInput?this.sectionSettingsEdit.options&&(this.model.taskData.taskSections[this.currentIndex].options=this.$helpers.cloneObject(this.sectionSettingsEdit.options)):this.model.taskData.taskSections[this.currentIndex].options=[],this.model.taskData.taskSections[this.currentIndex].inputType=this.sectionSettingsEdit.inputType,this.model.taskData.taskSections[this.currentIndex].enableInput||(this.model.taskData.taskSections[this.currentIndex].inputType=null),this.model.taskData.taskSections[this.currentIndex].name=this.sectionSettingsEdit.name;var section=this.model.taskData.taskSections[this.currentIndex];section.additionInfo.defaultValue=this.sectionSettingsEdit.defaultValue,section.additionInfo.failureValue=this.sectionSettingsEdit.failureValue,section.additionInfo.deviationOperatorId=this.sectionSettingsEdit.deviationOperatorId,section.additionInfo.remarksRequired=this.sectionSettingsEdit.remarksRequired,section.additionInfo.remarkOptionValues=this.sectionSettingsEdit.remarkOptionValues,section.additionInfo.attachmentOptionValues="specific"==this.sectionSettingsEdit.attachmentOption?this.sectionSettingsEdit.attachmentOptionValues:[],section.additionInfo.createWoOnFailure=this.sectionSettingsEdit.createWoOnFailure;
// below formId support might be removed soon...
// if (this.sectionSettingsEdit.createWoOnFailure) {
//   section.additionInfo.woCreateFormId = this.sectionSettingsEdit.woCreateFormId
// } else {
//   delete section.additionInfo.woCreateFormId
// }
for(var i=0;i<this.model.taskData.taskSections[this.currentIndex].tasks.length;i++){this.model.taskData.taskSections[this.currentIndex].tasks[i].attachmentRequired=this.sectionSettingsEdit.attachmentRequired,this.model.taskData.taskSections[this.currentIndex].tasks[i].enableInput=this.sectionSettingsEdit.enableInput,this.model.taskData.taskSections[this.currentIndex].tasks[i].validation=this.sectionSettingsEdit.validation,this.model.taskData.taskSections[this.currentIndex].tasks[i].minSafeLimit=this.sectionSettingsEdit.minSafeLimit,this.model.taskData.taskSections[this.currentIndex].tasks[i].maxSafeLimit=this.sectionSettingsEdit.maxSafeLimit,this.model.taskData.taskSections[this.currentIndex].options&&this.model.taskData.taskSections[this.currentIndex].options.length?this.model.taskData.taskSections[this.currentIndex].tasks[i].options=this.$helpers.cloneObject(this.model.taskData.taskSections[this.currentIndex].options):this.model.taskData.taskSections[this.currentIndex].tasks[i].options=[],this.model.taskData.taskSections[this.currentIndex].tasks[i].inputType=this.sectionSettingsEdit.inputType,this.model.taskData.taskSections[this.currentIndex].enableInput||(this.model.taskData.taskSections[this.currentIndex].tasks[i].inputType=null),
// INPUT_TYPE has been changed.
// Assigning - 1, so that readingFieldId gets updated to new value in backend.
this.model.taskData.taskSections[this.currentIndex].tasks[i].readingFieldId=-1;var task=this.model.taskData.taskSections[this.currentIndex].tasks[i];task.additionInfo.defaultValue=this.sectionSettingsEdit.defaultValue,task.additionInfo.failureValue=this.sectionSettingsEdit.failureValue,task.additionInfo.deviationOperatorId=this.sectionSettingsEdit.deviationOperatorId,task.additionInfo.remarksRequired=this.sectionSettingsEdit.remarksRequired,task.additionInfo.remarkOptionValues=this.sectionSettingsEdit.remarkOptionValues,task.additionInfo.attachmentOptionValues="specific"===this.sectionSettingsEdit.attachmentOption?this.sectionSettingsEdit.attachmentOptionValues:[],task.additionInfo.createWoOnFailure=this.sectionSettingsEdit.createWoOnFailure}this.showSectionSettings=!1},cancelSectionSettings:function(){this.showSectionSettings=!1},handleSingleResource:function(newVal,oldVal){var _this14=this;if(newVal!==oldVal&&newVal){var model=this.model,_model$woData=model.woData,woData=void 0===_model$woData?{}:_model$woData,_woData$singleResourc=woData.singleResource,singleResource=void 0===_woData$singleResourc?null:_woData$singleResourc;(0,validation/* isEmpty */.xb)(singleResource)||("single"===this.model.woData.workOrderType&&"SPACE"===singleResource.resourceTypeEnum?(this.categoryOptions[0]={value:"CURRENT_SPACE",label:"".concat(this.model.woData.spaceAssetDisplayName)},this.handleSpaceCategoryOptions(!0),this.model.taskData.taskSections.forEach((function(i,index){i.category=["CURRENT_SPACE"],_this14.changeLabelForSection(index,!0)}))):"single"===this.model.woData.workOrderType&&"ASSET"===singleResource.resourceTypeEnum&&this.model.taskData.taskSections.forEach((function(i){i.category=["CURRENT_ASSET"],i.tasks.forEach((function(k){k.category=["CURRENT_ASSET"]}))})))}},setDefaultValueForTaskSettings:function(taskSettingsEdit){taskSettingsEdit.defaultValue="",taskSettingsEdit.failureValue=""},setDefaultValueForSectionSettings:function(sectionSettingsEdit){sectionSettingsEdit.defaultValue="",sectionSettingsEdit.failureValue=""},addTaskOption:function(selectedTask){selectedTask.options.push({name:""})},removeOption:function(settingObj,index){var isTaskSettings=arguments.length>2&&void 0!==arguments[2]&&arguments[2],isTaskSectionSettings=arguments.length>3&&void 0!==arguments[3]&&arguments[3],_ref3=settingObj||{},_ref3$options=_ref3.options,options=void 0===_ref3$options?[]:_ref3$options;options.splice(index,1),this.$setProperty(settingObj,"options",options),isTaskSettings&&this.setDefaultValueForTaskSettings(settingObj),isTaskSectionSettings&&this.setDefaultValueForSectionSettings(settingObj)},onTaskSelectInput:function(){
// following assignment is required so that, when user switches back to same input type
// readingFieldId will be same, if other input Type is selected it will be reset to -1 in saveTaskSettings()
this.taskSettingsEdit.readingFieldId=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].readingFieldId,"2"===this.taskSettingsEdit.inputType?(this.fillTaskReadingsForTasks(),
// reset readingFieldId so that readingField will be empty while changing the input option to Reading
this.taskSettingsEdit.readingFieldId=null):"5"===this.taskSettingsEdit.inputType?(this.taskSettingsEdit.options=[],this.addTaskOption(this.taskSettingsEdit),this.addTaskOption(this.taskSettingsEdit)):"6"===this.taskSettingsEdit.inputType&&(this.taskSettingsEdit.options=[{name:""},{name:""}],this.taskSettingsEdit.options[0].name="YES",this.taskSettingsEdit.options[1].name="NO")},onSelectInput:function(){"5"===this.sectionSettingsEdit.inputType?(this.sectionSettingsEdit.options=[],this.addTaskOption(this.sectionSettingsEdit),this.addTaskOption(this.sectionSettingsEdit)):"6"===this.sectionSettingsEdit.inputType&&(this.taskSettingsEdit.options=[{name:""},{name:""}],this.sectionSettingsEdit.options[0].name="YES",this.sectionSettingsEdit.options[1].name="NO"),this.$forceUpdate()},getFloorReadings:function(isSection){var _this15=this;this.$http.post("/reading/getallspacetypereadings",{spaceType:"Floors"}).then((function(response){for(var categoryId in response.data.moduleMap){var moduleJson=response.data.moduleMap[categoryId];for(var moduleIndex in moduleJson)if(3===moduleJson[moduleIndex].type){var readingFields=moduleJson[moduleIndex].fields;for(var fieldIndex in readingFields){var field=readingFields[fieldIndex];-1===categoryId?(field["spaceId"]="Default Readings",field.buildingName="All"):(field["spaceId"]=response.data.spaces[categoryId].name,field.buildingName=response.data.spaces[categoryId].building.name),isSection?_this15.model.taskData.taskSections[_this15.currentIndex].readingFields.push(field):_this15.taskSettingsEdit.readingFields.push(field)}}}}))},fillTaskReadingsForTasks:function(){var _this16=this;if(this.taskSettingsEdit.readingFields=[],"single"===this.model.woData.workOrderType&&"ASSET"===this.model.woData.singleResource.resourceTypeEnum)this.model.woData.singleResource&&this.model.woData.singleResource.id&&this.model.woData.singleResource.category&&this.$util.loadAssetReadingFields(-1,this.model.woData.singleResource.category.id,!1,!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()}));else if("CURRENT_FLOOR"===this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[0])this.getFloorReadings(!1);else if("CURRENT_SPACE"===this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[0])if("single"===this.model.woData.workOrderType){if(this.model.woData.singleResource&&this.model.woData.singleResource.id){var sectionCategory=this.model.taskData.taskSections[this.currentIndex].category;if(1===sectionCategory.length)this.$util.loadSpaceReadingFields(this.model.woData.singleResource.id,!1,null,!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()}));else if(2===sectionCategory.length){var sectionCategoryId=Number(sectionCategory[1]);this.$util.loadSpaceReadingFields(-1,!1,sectionCategoryId,!0,!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()}))}}}else this.$util.loadSpaceReadingFields(-1,!1,Number(this.model.woData.spacecategoryId),!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()}));else if("CURRENT_BUILDING"===this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[0])this.taskSettingsEdit.readingFields=[],this.model.woData.selectedBuildingList.forEach((function(x){_this16.$util.loadSpaceReadingFields(x,!1,null,!0).then((function(fields){var _this16$taskSettingsE;(_this16$taskSettingsE=_this16.taskSettingsEdit.readingFields).push.apply(_this16$taskSettingsE,(0,toConsumableArray/* default */.Z)(fields)),_this16.$forceUpdate()}))}));else if("CURRENT_ASSET"===this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[0]){var assetCategoryId=Number(this.model.woData.assetCategoryId);if("single"===this.model.woData.workOrderType&&this.model.woData.singleResource&&this.model.woData.singleResource.id){var _sectionCategory=this.model.taskData.taskSections[this.currentIndex].category;"asset"===_sectionCategory[0]&&(assetCategoryId=Number(_sectionCategory[1]))}var _sectionCategory2=this.model.taskData.taskSections[this.currentIndex].category;"asset"===_sectionCategory2[0]&&(assetCategoryId=Number(_sectionCategory2[1])),this.$util.loadAssetReadingFields(-1,assetCategoryId,!1,!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()}))}else"space"===this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[0]?this.$util.loadSpaceReadingFields(-1,!1,Number(this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[1]),!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()})):"asset"===this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[0]&&this.$util.loadAssetReadingFields(-1,Number(this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category[1]),!1,!0).then((function(fields){_this16.taskSettingsEdit.readingFields=fields,_this16.$forceUpdate()}))},reinitTaskSettings:function(sectionIndex,taskIndex,resourceLabel){var obj={resourceLabel:"",selectedResourceList:[],isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,options:[],inputType:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:null}};resourceLabel&&(obj.resourceLabel=resourceLabel);var oldUnique=this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].additionInfo.uniqueId;Object.assign(this.model.taskData.taskSections[sectionIndex].tasks[taskIndex],obj),this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].additionInfo.uniqueId=oldUnique},reinitTaskSectionSettings:function(sectionIndex,resourceLabel){var obj={resourceLabel:"",selectedResourceList:[],isIncludeResource:null,attachmentRequired:!1,enableInput:!1,validation:null,minSafeLimit:null,maxSafeLimit:null,options:[],inputType:null,createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]}};resourceLabel&&(obj.resourceLabel=resourceLabel),Object.assign(this.model.taskData.taskSections[sectionIndex],obj);for(var j=0;j<this.model.taskData.taskSections[sectionIndex].tasks.length;j++)this.reinitTaskSettings(sectionIndex,j)},changeLabel:function(sectionIndex,selectedDefault){this.changeLabelForSection(sectionIndex,selectedDefault),this.$forceUpdate()},changeLabelForSection:function(sectionIndex,fromWo){var _this17=this;if(this.model.taskData.taskSections[sectionIndex].resourceLabel=this.resourceLabel(sectionIndex,fromWo),this.model.taskData.taskSections[sectionIndex].resourceLabel!==this.oldSectionLabel){this.reinitTaskSectionSettings(sectionIndex,this.model.taskData.taskSections[sectionIndex].resourceLabel);var category=this.model.taskData.taskSections[sectionIndex].category;this.model.taskData.taskSections[sectionIndex].tasks.forEach((function(task,taskIndex){"CURRENT_FLOOR"===category[0]?task.category=["CURRENT_FLOOR"]:"CURRENT_SPACE"===category[0]||"space"===category[0]?task.category=["CURRENT_SPACE"]:"CURRENT_ASSET"===category[0]||"asset"===category[0]?task.category=["CURRENT_ASSET"]:"CURRENT_BUILDING"===category[0]||"building"===category[0]?task.category=["CURRENT_BUILDING"]:"ALL_SITES"!==category[0]&&"site"!==category[0]||(task.category=["ALL_SITES"]);var selectedDefault="CURRENT_FLOOR"===category[0]||"CURRENT_ASSET"===category[0]||"CURRENT_SPACE"===category[0]||"CURRENT_BUILDING"===category[0]||"ALL_SITES"===category[0];_this17.model.taskData.taskSections[sectionIndex].tasks[taskIndex].resourceLabel=_this17.resourceLabelForTask(sectionIndex,taskIndex,selectedDefault)}))}},changeTaskResourceLabel:function(selectedDefault){this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].resourceLabel=this.resourceLabelForTask(this.currentIndex,this.currentTaskIndex,selectedDefault),this.oldTasklabel!==this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].resourceLabel&&this.reinitTaskSettings(this.currentIndex,this.currentTaskIndex,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].resourceLabel),this.$forceUpdate()},associateResource:function(selectedObj){var _this18=this;selectedObj.resourceList&&selectedObj.resourceList.length&&(this.model.taskData.taskSections[this.currentIndex].selectedResourceList=selectedObj.resourceList,this.model.taskData.taskSections[this.currentIndex].isIncludeResource=selectedObj.isInclude),this.chooserVisibility=!1,this.model.taskData.taskSections[this.currentIndex].resourceLabel=this.resourceLabel(this.currentIndex),Object.keys(this.sectionPopover).forEach((function(key){_this18.$set(_this18.sectionPopover,key,!1)}))},associateResourceForTask:function(selectedObj){var _this19=this;selectedObj.resourceList&&selectedObj.resourceList.length&&(this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].selectedResourceList=selectedObj.resourceList,this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].isIncludeResource=selectedObj.isInclude),this.chooserVisibilityForTask=!1;var category=this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].category,selectedDefault="CURRENT_FLOOR"===category[0]||"CURRENT_ASSET"===category[0]||"CURRENT_SPACE"===category[0];this.model.taskData.taskSections[this.currentIndex].tasks[this.currentTaskIndex].resourceLabel=this.resourceLabelForTask(this.currentIndex,this.currentTaskIndex,selectedDefault),Object.keys(this.taskPopover).forEach((function(key){_this19.$set(_this19.taskPopover,key,!1)}))},setCurrentPosition:function(secIdx,taskIdx){this.currentIndex=secIdx,this.currentTaskIndex=taskIdx},setCurrentSection:function(idx){this.currentIndex=idx},setCurrentTask:function(idx){this.currentTaskIndex=idx},getMaxTaskUniqueId:function(){var max=this.model.taskData.taskSections[0].tasks[0].additionInfo.uniqueId;return this.model.taskData.taskSections.forEach((function(ts){ts.tasks.forEach((function(t){t.additionInfo.uniqueId>max&&(max=t.additionInfo.uniqueId)}))})),max},addNewTask:function(taskIndex){var _this20=this;if((0,validation/* isEmpty */.xb)(this.model.woData.resourceType))this.$message.error(this.$t("maintenance.old_pm.please_fill_the_details_in_configuration_page"));else{var taskObj={name:"",category:null,resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:null}};taskObj.additionInfo.uniqueId=this.getMaxTaskUniqueId()+1;var category=this.model.taskData.taskSections[this.currentIndex].category;category&&category.length&&("CURRENT_FLOOR"===category[0]?taskObj.category=["CURRENT_FLOOR"]:"CURRENT_SPACE"===category[0]||"space"===category[0]?taskObj.category=["CURRENT_SPACE"]:"CURRENT_ASSET"===category[0]||"asset"===category[0]?taskObj.category=["CURRENT_ASSET"]:"CURRENT_BUILDING"===category[0]?taskObj.category=["CURRENT_BUILDING"]:"ALL_SITES"===category[0]&&(taskObj.category=["ALL_SITES"])),taskObj.attachmentRequired=this.model.taskData.taskSections[this.currentIndex].attachmentRequired,taskObj.enableInput=this.model.taskData.taskSections[this.currentIndex].enableInput,taskObj.validation=this.model.taskData.taskSections[this.currentIndex].validation,taskObj.minSafeLimit=this.model.taskData.taskSections[this.currentIndex].minSafeLimit,taskObj.maxSafeLimit=this.model.taskData.taskSections[this.currentIndex].maxSafeLimit,taskObj.additionInfo.deviationOperatorId=this.model.taskData.taskSections[this.currentIndex].additionInfo.deviationOperatorId,taskObj.additionInfo.defaultValue=this.model.taskData.taskSections[this.currentIndex].additionInfo.defaultValue,taskObj.additionInfo.failureValue=this.model.taskData.taskSections[this.currentIndex].additionInfo.failureValue,taskObj.additionInfo.createWoOnFailure=this.model.taskData.taskSections[this.currentIndex].additionInfo.createWoOnFailure,taskObj.additionInfo.remarksRequired=this.model.taskData.taskSections[this.currentIndex].additionInfo.remarksRequired,taskObj.additionInfo.remarkOptionValues=this.model.taskData.taskSections[this.currentIndex].additionInfo.remarkOptionValues,taskObj.additionInfo.attachmentOptionValues=this.model.taskData.taskSections[this.currentIndex].additionInfo.attachmentOptionValues,this.model.taskData.taskSections[this.currentIndex].options&&this.model.taskData.taskSections[this.currentIndex].options.length&&(taskObj.options=this.$helpers.cloneObject(this.model.taskData.taskSections[this.currentIndex].options)),taskObj.inputType=this.model.taskData.taskSections[this.currentIndex].inputType,taskIndex=taskIndex>=0?taskIndex:this.model.taskData.taskSections[this.currentIndex].tasks.length,this.model.taskData.taskSections[this.currentIndex].tasks.splice(taskIndex,0,taskObj),this.currentTaskIndex=this.currentTaskIndex+1;var setDefaultTaskName=!1;category&&category.length&&("CURRENT_ASSET"!==taskObj.category[0]&&"CURRENT_SPACE"!==taskObj.category[0]&&"CURRENT_FLOOR"!==taskObj.category[0]&&"CURRENT_BUILDING"!==taskObj.category[0]&&"ALL_SITES"!==taskObj.category[0]||(setDefaultTaskName=!0),taskObj.resourceLabel=this.resourceLabelForTask(this.currentIndex,this.currentTaskIndex,setDefaultTaskName)),this.$nextTick((function(){var ref=_this20.$refs["task-"+_this20.currentIndex+"-"+taskIndex];ref&&ref[0].focus()}))}},onTaskPaste:function(tasks,index,event){var _this21=this,data=event.clipboardData.getData("text/plain");if(data){var list=data.split(/[\n\r]/g);list.length>1&&(tasks[index].name||(tasks[index].name=list.splice(0,1)[0]),list.forEach((function(subject){subject&&(_this21.addNewTask(event,++index),tasks[index].name=subject)})),
// tasks.splice(index + 1, 0, ...list.map(value => ({subject: value})))
event.preventDefault())}},addNewSection:function(){if((0,validation/* isEmpty */.xb)(this.model.woData.resourceType))this.$message.error(this.$t("maintenance.old_pm.please_fill_the_details_in_configuration_page"));else{var count=this.model.taskData.taskSections.length;if("bulk"===this.model.woData.workOrderType)"ALL_FLOORS"===this.model.woData.resourceType?this.model.taskData.taskSections.push({name:"Untitled Section ".concat(count+1),category:["CURRENT_FLOOR"],dummyValue:[1],resourceLabel:"Current Floor",selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,createWoOnFailure:!1,triggers:[{triggerName:"All"}],additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",category:["CURRENT_FLOOR"],resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:this.getMaxTaskUniqueId()+1}}]}):"SPACE_CATEGORY"===this.model.woData.resourceType?this.model.taskData.taskSections.push({name:"Untitled Section ".concat(count+1),category:["CURRENT_SPACE"],dummyValue:[1],resourceLabel:"Current Spaces",selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,triggers:[{triggerName:"All"}],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",category:["CURRENT_SPACE"],resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:this.getMaxTaskUniqueId()+1}}]}):"ASSET_CATEGORY"===this.model.woData.resourceType?this.model.taskData.taskSections.push({name:"Untitled Section ".concat(count+1),category:["CURRENT_ASSET"],dummyValue:[1],resourceLabel:"Current Asset",selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,triggers:[{triggerName:"All"}],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",category:["CURRENT_ASSET"],resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:this.getMaxTaskUniqueId()+1}}]}):"BUILDINGS"===this.model.woData.resourceType?this.model.taskData.taskSections.push({name:"Untitled Section ".concat(count+1),category:["CURRENT_BUILDING"],dummyValue:[1],resourceLabel:"Current Spaces",selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,triggers:[{triggerName:"All"}],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",category:["CURRENT_BUILDING"],resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:this.getMaxTaskUniqueId()+1}}]}):"ALL_SITES"===this.model.woData.resourceType&&this.model.taskData.taskSections.push({name:"Untitled Section ".concat(count+1),category:["ALL_SITES"],dummyValue:[1],resourceLabel:"All Sites",selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,triggers:[{triggerName:"All"}],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",category:["ALL_SITES"],resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:this.getMaxTaskUniqueId()+1}}]});else{var category=[];1===this.model.woData.singleResource.resourceType&&(category=["CURRENT_SPACE"]),this.model.taskData.taskSections.push({name:"Untitled Section ".concat(count+1),category:category,dummyValue:[1],resourceLabel:"Current Spaces",selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,triggers:[{triggerName:"All"}],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",category:category,resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",deviationOperatorId:null,woCreateFormId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:this.getMaxTaskUniqueId()+1}}]})}this.currentIndex=count,this.currentTaskIndex=0,"single"===this.model.woData.workOrderType&&2===this.model.woData.singleResource.resourceType||(this.oldSectionLabel=null,this.changeLabelForSection(this.currentIndex,!0))}},moveToNext:function(){var validated=this.validateTaskForm();validated&&this.$emit("next")},moveToPrevious:function(){this.$emit("previous")},deleteTask:function(sectionIndex,taskIndex){this.currentTaskIndex=0,this.model.taskData.taskSections[sectionIndex].tasks.splice(taskIndex,1)},deleteSection:function(sectionIndex){this.currentIndex=0,this.currentTaskIndex=0,this.model.taskData.taskSections.splice(sectionIndex,1)},loadWoForms:function(){var _this22=this,url="/v2/forms?moduleName=workorder";this.$http.get(url).then((function(response){0===response.data.responseCode&&(_this22.woForms=(response.data.result.forms||[]).filter((function(form){return form.id>0&&"default_workorder_web"!==form.name})))}))},resourceLabelForTask:function(sectionIndex,taskIndex,fromWo){var _this23=this;if(this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].category){var category=this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].category;if(category.length>=1){if("asset"===category[0]){var assetCategory=this.assetcategory.find((function(i){return i.id===Number(category[1])}));if(!this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length)return fromWo?"Every ".concat(assetCategory.name):"All ".concat(assetCategory.name);var count=this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length;return"".concat(count," ").concat(assetCategory.name)}if("space"===category[0]){var spacecategory=this.spacecategory[category[1]];if(!this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length)return fromWo?"Every ".concat(spacecategory):"All ".concat(spacecategory);var _count=this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length;return"".concat(_count," ").concat(spacecategory)}if("building"===category[0]){if(!this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length)return fromWo?"Every Building":"All Buildings";var _count2=this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length;return"".concat(_count2," Building(s)")}if("CURRENT_FLOOR"===category[0])return fromWo?"Every Floor":"All Floor";if("CURRENT_ASSET"===category[0]){var secCateg=this.model.taskData.taskSections[sectionIndex].category,_assetCategory=null;if("CURRENT_ASSET"===secCateg[0]?_assetCategory=this.assetcategory.find((function(i){return i.id===Number(_this23.model.woData.assetCategoryId)})):"asset"===secCateg[0]&&(_assetCategory=this.assetcategory.find((function(i){return i.id===Number(secCateg[1])}))),!this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length)return fromWo?"Every ".concat(_assetCategory.name):"All ".concat(_assetCategory.name);var _count3=this.model.taskData.taskSections[sectionIndex].tasks[taskIndex].selectedResourceList.length;return"".concat(_count3," ").concat(_assetCategory.name)}if("CURRENT_SPACE"===category[0]){var _secCateg=this.model.taskData.taskSections[sectionIndex].category;if("CURRENT_SPACE"===_secCateg[0]){var _spacecategory=null;return _spacecategory="single"===this.model.woData.workOrderType?this.model.woData.spaceAssetDisplayName:this.spacecategory[this.model.woData.spacecategoryId],"single"===this.model.woData.workOrderType?"".concat(_spacecategory):fromWo?"Every ".concat(_spacecategory):"All ".concat(_spacecategory)}if("space"===_secCateg[0]){var _spacecategory2=null;return _spacecategory2=this.spacecategory[_secCateg[1]],"single"===this.model.woData.workOrderType?"".concat(_spacecategory2):fromWo?"Every ".concat(_spacecategory2):"All ".concat(_spacecategory2)}}else if("CURRENT_BUILDING"===category[0]){var _secCateg2=this.model.taskData.taskSections[sectionIndex].category;if("CURRENT_BUILDING"===_secCateg2[0])return fromWo?"Every Building":"All Building(s)";if("building"===_secCateg2[0])return fromWo?"Every Building":"All Building(s)"}else if("ALL_SITES"===category[0]){var _secCateg3=this.model.taskData.taskSections[sectionIndex].category;if("ALL_SITES"===_secCateg3[0])return fromWo?"Every Site":"All Site(s)";if("sites"===_secCateg3[0])return fromWo?"Every Site":"All Site(s)"}}}},resourceLabel:function(sectionIndex,fromWo){var _this24=this;if(this.model.taskData.taskSections[sectionIndex].dummyValue=[1],"single"===this.model.woData.workOrderType){var category=this.model.taskData.taskSections[sectionIndex].category;if(1===category.length){if("SPACE"===this.model.woData.singleResource.resourceTypeEnum)return"".concat(this.model.woData.spaceAssetDisplayName)}else{if("asset"===category[0]){var assetCategory=this.assetcategory.find((function(i){return i.id===Number(category[1])}));if(!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every ".concat(assetCategory.name):"All ".concat(assetCategory.name);var count=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;return"".concat(count," ").concat(assetCategory.name)}if("space"===category[0]){var spacecategory=this.spacecategory[category[1]];if(!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every ".concat(spacecategory):"All ".concat(spacecategory);var _count4=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;return"".concat(_count4," ").concat(spacecategory)}}this.model.taskData.taskSections[sectionIndex].dummyValue=[]}else if(this.model.taskData.taskSections[sectionIndex].category){var _category=this.model.taskData.taskSections[sectionIndex].category;if(1===_category.length){if("ALL_FLOORS"===this.model.woData.resourceType&&!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return"Every Floor";if("SPACE_CATEGORY"===this.model.woData.resourceType&&!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length){var woCateg=this.model.woData.spacecategoryId;return fromWo?"Every ".concat(this.spacecategory[Number(woCateg)]):"All ".concat(this.spacecategory[Number(woCateg)])}if("BUILDINGS"===this.model.woData.resourceType&&!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every Building":"All Building(s)";if("ASSET_CATEGORY"===this.model.woData.resourceType&&!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length){var _assetCategory2=this.assetcategory.find((function(i){return i.id===Number(_this24.model.woData.assetCategoryId)}));return fromWo?"Every ".concat(_assetCategory2.name):"All ".concat(_assetCategory2.name)}if("ALL_SITES"===this.model.woData.resourceType&&!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every Sites":"All Site(s)";var _count5=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;if("ALL_FLOORS"===this.model.woData.resourceType)return"".concat(_count5," Floor");if("SPACE_CATEGORY"===this.model.woData.resourceType){var _woCateg=this.model.woData.spacecategoryId;return"".concat(_count5," ").concat(this.spacecategory[Number(_woCateg)])}if("ASSET_CATEGORY"===this.model.woData.resourceType){var _assetCategory3=this.assetcategory.find((function(i){return i.id===Number(_this24.model.woData.assetCategoryId)}));return"".concat(_count5," ").concat(_assetCategory3.name)}return"ALL_SITES"===this.model.woData.resourceType?"".concat(_count5," Site"):""}if("asset"===_category[0]){var _assetCategory4=this.assetcategory.find((function(i){return i.id===Number(_category[1])}));if(!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every ".concat(_assetCategory4.name):"All ".concat(_assetCategory4.name);var _count6=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;return"".concat(_count6," ").concat(_assetCategory4.name)}if("space"===_category[0]){var _spacecategory3=this.spacecategory[_category[1]];if(!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every ".concat(_spacecategory3):"All ".concat(_spacecategory3);var _count7=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;return"".concat(_count7," ").concat(_spacecategory3)}if("building"===_category[0]){if(!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every Building":"All Buildings";var _count8=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;return"".concat(_count8," Bulding(s)")}if("site"===_category[0]){if(!this.model.taskData.taskSections[sectionIndex].selectedResourceList.length)return fromWo?"Every Site":"All Sites";var _count9=this.model.taskData.taskSections[sectionIndex].selectedResourceList.length;return"".concat(_count9," Site(s)")}}else this.model.taskData.taskSections[sectionIndex].dummyValue=[]},getCategoryOptionsForTasksLabel:function(index){return this.categoryOptionsForTasks&&this.categoryOptionsForTasks.length>0?this.$getProperty(this,"categoryOptionsForTasks.".concat(index,".label")):""},getCategoryOptionsForTasksValue:function(index){return this.categoryOptionsForTasks&&this.categoryOptionsForTasks.length>0?this.$getProperty(this,"categoryOptionsForTasks.".concat(index,".value")):""}}},multisitepreventive_pmformtaskvue_type_script_lang_js=pmformtaskvue_type_script_lang_js,pmformtask_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_pmformtaskvue_type_script_lang_js,pmformtaskvue_type_template_id_9e42e24e_render,pmformtaskvue_type_template_id_9e42e24e_staticRenderFns,!1,null,null,null)
/* harmony default export */,pmformtask=pmformtask_component.exports,pmformprerequestvue_type_template_id_65930e9d_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable130-y60"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" EDIT PLANNED MAINTENANCE ")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_c("div",{staticClass:"fc-pm-main-content-H"},[_vm._v(" PREREQUISITES ")]),_c("div",{staticClass:"fc-heading-border-width43"}),_c("div",{staticClass:"fc-pm-main-inner-container"},[_c("div",{staticClass:"fc-pm-task-form-table-con"},[_vm.model.preRequestData.preRequestSections.length>0?_c("div",{staticClass:"label-txt-black"},[_vm._v(" Validation ")]):_vm._e(),_vm.model.preRequestData.preRequestSections.length>0?_c("el-checkbox",{staticClass:"pT20",model:{value:_vm.model.preRequestData.photoMandatory,callback:function($$v){_vm.$set(_vm.model.preRequestData,"photoMandatory",$$v)},expression:"model.preRequestData.photoMandatory"}},[_vm._v("Photo Mandatory")]):_vm._e(),_vm.model.preRequestData.preRequestSections.length>0&&3===_vm.model.preRequestData.allowNegativePreRequisite?_c("div",[_c("el-form",{attrs:{model:_vm.model.preRequestData,"label-position":"top"}},[_c("div",{staticClass:"fc-input-label-txt pT20 pB0"},[_vm._v(" Specify users, roles or groups who can approve ")]),_c("el-form-item",{staticClass:"mB10",staticStyle:{"margin-left":"-10px"},attrs:{prop:"approvers"}},_vm._l(_vm.model.preRequestData.approvers,(function(approver,key){return _c("el-row",{key:key,staticClass:"criteria-condition-block visibility-visible-actions max-width650px"},[_c("el-col",{attrs:{span:6}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{placeholder:"Select"},on:{change:function($event){return _vm.getFieldDrop(approver)}},model:{value:approver.sharingType,callback:function($$v){_vm.$set(approver,"sharingType",$$v)},expression:"approver.sharingType"}},_vm._l(_vm.model.preRequestData.approvalTypes,(function(field,index){return _c("el-option",{key:index,attrs:{label:field.name,value:field.id}})})),1)],1),_c("el-col",{staticClass:"mL20",attrs:{span:6}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{placeholder:"Select"},model:{value:approver.approversId,callback:function($$v){_vm.$set(approver,"approversId",$$v)},expression:"approver.approversId"}},_vm._l(approver.approvesDataType,(function(objList,index){return _c("el-option",{key:index,attrs:{label:objList.name,value:objList.id}})})),1)],1),_c("el-col",{staticClass:"mL5 border-left visibility-hide-actions",attrs:{span:2}},[key+1===_vm.model.preRequestData.approvers.length?_c("img",{staticClass:"delete-icon vertical-middle",staticStyle:{height:"18px",width:"18px"},attrs:{src:__webpack_require__(353654)},on:{click:_vm.addApprover}}):_vm._e(),1!==_vm.model.preRequestData.approvers.length?_c("img",{staticClass:"delete-icon vertical-middle mL5",staticStyle:{height:"18px",width:"18px"},attrs:{src:__webpack_require__(385769)},on:{click:function($event){return _vm.deleteApprovers(key)}}}):_vm._e()])],1)})),1)],1)],1):_vm._e(),_c("draggable",{attrs:{options:{draggable:".asf"},element:"div",list:_vm.model.preRequestData.preRequestSections}},_vm._l(_vm.model.preRequestData.preRequestSections,(function(preRequestSection,key){return _c("table",{key:key,staticClass:"fc-pm-form-table mT40 fc-pm-form-task-table asf"},[_c("thead",[_c("tr",{staticClass:"visibility-visible-actions",on:{click:function($event){return _vm.setCurrentPosition(key,_vm.model.preRequestData.preRequestSections[key].preRequests.length-1)}}},[_c("th",{staticStyle:{width:"60%"}},[_c("el-input",{staticClass:"fc-input-border-remove task-input-bold",staticStyle:{width:"100%","margin-top":"20px"},model:{value:preRequestSection.name,callback:function($$v){_vm.$set(preRequestSection,"name",$$v)},expression:"preRequestSection.name"}})],1),_c("th"),_c("th"),_c("th",{staticStyle:{width:"50px","text-align":"right"}},[_c("div",{staticClass:"actions task-delete-icon-block",staticStyle:{right:"25px"},on:{click:function($event){$event.stopPropagation(),_vm.setCurrentSection(key),_vm.deleteSection(key)}}},[_c("i",{staticClass:"el-icon-delete pointer fc-delete-icon visibility-hide-actions task-th-delete-icon"})])])])]),_c("draggable",{attrs:{options:{draggable:".asd"},element:"tbody",list:_vm.model.preRequestData.preRequestSections[key].preRequests}},_vm._l(preRequestSection.preRequests,(function(task,taskKey){return _c("tr",{key:taskKey,staticClass:"visibility-visible-actions pointer table-hover asd",on:{click:function($event){_vm.setCurrentSection(key),_vm.setCurrentTask(taskKey)}}},[_c("td",{staticStyle:{width:"60%"}},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"dot-green mL5"}),_c("el-input",{ref:"task-"+key+"-"+taskKey,refInFor:!0,staticClass:"fc-input-border-remove mL10",staticStyle:{width:"100%"},attrs:{placeholder:"Write a prerequisite name"},nativeOn:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.onTaskEnter($event,taskKey,task.subject)},paste:function($event){return _vm.onTaskPaste(preRequestSection.preRequests,taskKey,$event)}},model:{value:preRequestSection.preRequests[taskKey].name,callback:function($$v){_vm.$set(preRequestSection.preRequests[taskKey],"name",$$v)},expression:"\n                            preRequestSection.preRequests[taskKey].name\n                          "}})],1)]),_c("td",{staticStyle:{clear:"both"}},[_c("div",{staticClass:"flex-middle mR10 justify-content-end"},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"dot-green-postivite"}),_c("div",{staticClass:"pL5 label-txt-black"},[_vm._v(" "+_vm._s(preRequestSection.preRequests[taskKey].additionInfo.truevalue)+" ")])]),_c("div",{staticClass:"flex-middle pL30"},[_c("div",{staticClass:"dot-red-negative"}),_c("div",{staticClass:"pL5 label-txt-black"},[_vm._v(" "+_vm._s(preRequestSection.preRequests[taskKey].additionInfo.falsevalue)+" ")])])])]),_c("td",{staticClass:"fc-pm-popover-btn2",staticStyle:{width:"50px"}},[_c("f-popover",{attrs:{placement:"right","popper-class":"calender-popup",title:"Options",trigger:"click",width:"250",confirmTitle:"SAVE"},on:{save:_vm.savePreRequestSettings,show:function($event){return _vm.showPreRequestSettingsDialog(preRequestSection.preRequests[taskKey])},close:_vm.cancelPreRequestSettings,hide:_vm.cancelPreRequestSettings},model:{value:preRequestSection.preRequests[taskKey].additionInfo.show,callback:function($$v){_vm.$set(preRequestSection.preRequests[taskKey].additionInfo,"show",$$v)},expression:"\n                          preRequestSection.preRequests[taskKey].additionInfo\n                            .show\n                        "}},[_c("i",{staticClass:"el-icon-edit edit-icon-border visibility-hide-actions",attrs:{slot:"reference"},slot:"reference"}),_c("template",{slot:"content"},[_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:10}},[_c("div",[_c("el-input",{staticClass:"fc-input-full-border2 width200px",attrs:{type:"text",placeholder:"+ve value"},model:{value:_vm.preRequestSettingsEdit.truevalue,callback:function($$v){_vm.$set(_vm.preRequestSettingsEdit,"truevalue",$$v)},expression:"preRequestSettingsEdit.truevalue"}})],1)])],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:10}},[_c("div",[_c("el-input",{staticClass:"fc-input-full-border2 width200px",attrs:{type:"text",placeholder:"-ve value"},model:{value:_vm.preRequestSettingsEdit.falsevalue,callback:function($$v){_vm.$set(_vm.preRequestSettingsEdit,"falsevalue",$$v)},expression:"preRequestSettingsEdit.falsevalue"}})],1)])],1)],1)],2)],1),_c("td",{staticStyle:{width:"50px"}},[_c("div",{staticClass:"task-delete-icon-block position-relative",on:{click:function($event){$event.stopPropagation(),_vm.setCurrentPosition(key,taskKey),_vm.deleteTask(key,taskKey)}}},[_c("i",{staticClass:"el-icon-delete fc-delete-icon pointer visibility-hide-actions"})])])])})),0)],1)})),0),_vm.model.preRequestData.preRequestSections.length?_c("div",{staticClass:"text-left"},[_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20",on:{click:_vm.addNewPreRequest}},[_vm._v("ADD PREREQUISITE")]),_vm.model.preRequestData.preRequestSections.length>0?_c("el-button",{staticClass:"fc-btn-green-medium-border mL20",on:{click:_vm.addNewSection}},[_vm._v("ADD SECTION")]):_vm._e()],1):_c("div",{staticClass:"mT30 text-center"},[_c("div",[_c("inline-svg",{attrs:{src:"svgs/emptystate/cartempty",iconClass:"icon icon-xxxlg"}})],1),_c("el-button",{staticClass:"fc-btn-green-medium-fill mT20 mL30",on:{click:_vm.addNewPreRequest}},[_vm._v("ADD PREREQUISITE")]),_vm.model.preRequestData.preRequestSections.length>0?_c("el-button",{staticClass:"fc-btn-green-medium-border mL20",on:{click:_vm.addNewSection}},[_vm._v("ADD SECTION")]):_vm._e()],1)],1)])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save f13",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v("PROCEED TO NEXT "),_c("img",{staticClass:"fR",attrs:{src:__webpack_require__(936658),width:"17px"}})])],1)])])])},pmformprerequestvue_type_template_id_65930e9d_staticRenderFns=[],FPopover=__webpack_require__(507008),pmformprerequestvue_type_script_lang_js={mixins:[PMMixin/* default */.Z],props:["model","users","teams"],components:{Draggable:vuedraggable_umd_default(),FPopover:FPopover/* default */.Z},data:function(){return{currentIndex:0,currentTaskIndex:0,inputType:null,showSectionSettings:!1,sectionSettingsEdit:{},preRequestSettingsEdit:{truevalue:null,falsevalue:null},showPreRequestSettings:!1}},created:function(){this.$store.dispatch("loadRoles");
//this.$store.dispatch('loadGroups') // users/temas sent from pmnewform.vue as props
},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({
// users: state => state.users,
// teams: state => state.groups,
roles:function(state){return state.roles}})),methods:{changeAllowNegativePrerequisiteValue:function(){this.model.preRequestData.allowNegative?this.model.preRequestData.allowNegativePreRequisite=3:this.model.preRequestData.allowNegativePreRequisite=2},addApprover:function(){this.model.preRequestData.approvers.push({sharingType:null,approversId:null})},deleteApprovers:function(index){this.$delete(this.model.preRequestData.approvers,index)},getFieldDrop:function(approver){approver.approversId=null,approver.approvesDataType=[],1===approver.sharingType?approver.approvesDataType=this.users:2===approver.sharingType?approver.approvesDataType=this.roles:3===approver.sharingType&&(approver.approvesDataType=this.teams)},onTaskEnter:function($event,index,subject){$event.target&&0===$event.target.selectionStart&&subject||index++,this.addNewPreRequest(index)},showPreRequestSettingsDialog:function(prerequisite){this.preRequestSettingsEdit={truevalue:null,falsevalue:null},this.preRequestSettingsEdit.truevalue=prerequisite.additionInfo.truevalue,this.preRequestSettingsEdit.falsevalue=prerequisite.additionInfo.falsevalue},savePreRequestSettings:function(){var task=this.model.preRequestData.preRequestSections[this.currentIndex].preRequests[this.currentTaskIndex];task.additionInfo.truevalue=this.preRequestSettingsEdit.truevalue,task.additionInfo.falsevalue=this.preRequestSettingsEdit.falsevalue,task.additionInfo.show=!1},cancelPreRequestSettings:function(){this.showPreRequestSettings=!1},setCurrentPosition:function(secIdx,taskIdx){this.currentIndex=secIdx,this.currentTaskIndex=taskIdx},setCurrentSection:function(idx){this.currentIndex=idx},setCurrentTask:function(idx){this.currentTaskIndex=idx},addNewPreRequest:function(preRequestIndex){var _this=this;if(this.model.preRequestData.preRequestSections.length>0){var preRequestObj={name:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,selectedResourceList:[],isIncludeResource:null,readingFields:[],additionInfo:{truevalue:null,falsevalue:null,defaultValue:"",failureValue:"",woCreateTemplateId:null}};preRequestObj.attachmentRequired=this.model.preRequestData.preRequestSections[this.currentIndex].attachmentRequired,preRequestObj.enableInput=this.model.preRequestData.preRequestSections[this.currentIndex].enableInput,preRequestObj.validation=this.model.preRequestData.preRequestSections[this.currentIndex].validation,this.model.preRequestData.preRequestSections[this.currentIndex].additionInfo.truevalue&&(preRequestObj.additionInfo.truevalue=this.model.preRequestData.preRequestSections[this.currentIndex].additionInfo.truevalue),this.model.preRequestData.preRequestSections[this.currentIndex].additionInfo.falsevalue&&(preRequestObj.additionInfo.falsevalue=this.model.preRequestData.preRequestSections[this.currentIndex].additionInfo.falsevalue),preRequestObj.inputType=this.model.preRequestData.preRequestSections[this.currentIndex].inputType,preRequestIndex=preRequestIndex>=0?preRequestIndex:this.model.preRequestData.preRequestSections[this.currentIndex].preRequests.length,this.model.preRequestData.preRequestSections[this.currentIndex].preRequests.splice(preRequestIndex,0,preRequestObj),this.currentTaskIndex=this.currentTaskIndex+1,this.$nextTick((function(){var ref=_this.$refs["task-"+_this.currentIndex+"-"+preRequestIndex];ref&&ref[0].focus()}))}else this.addNewSection()},onTaskPaste:function(tasks,index,event){var _this2=this,data=event.clipboardData.getData("text/plain");if(data){var list=data.split(/[\n\r]/g);list.length>1&&(tasks[index].name||(tasks[index].name=list.splice(0,1)[0]),list.forEach((function(subject){subject&&(_this2.addNewPreRequest(event,++index),tasks[index].name=subject)})),event.preventDefault())}},addNewSection:function(){var count=this.model.preRequestData.preRequestSections.length;this.model.preRequestData.preRequestSections.push({name:"Untitled Section ".concat(count+1),dummyValue:[1],selectedResourceList:[],inputType:null,isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,additionInfo:{truevalue:"Yes",falsevalue:"No",defaultValue:"",failureValue:"",woCreateTemplateId:null},preRequests:[{name:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,selectedResourceList:[],isIncludeResource:null,readingFields:[],additionInfo:{truevalue:"Yes",falsevalue:"No",defaultValue:"",failureValue:"",woCreateTemplateId:null}}]}),this.currentIndex=count,this.currentTaskIndex=0},moveToNext:function(){var validated=this.validatePreRequestForm();validated&&this.$emit("next")},moveToPrevious:function(){this.$emit("previous")},deleteTask:function(sectionIndex,preRequestIndex){this.currentTaskIndex=0,this.model.preRequestData.preRequestSections[sectionIndex].preRequests.splice(preRequestIndex,1),0===this.model.preRequestData.preRequestSections[sectionIndex].preRequests.length&&this.model.preRequestData.preRequestSections.splice(sectionIndex,1)},deleteSection:function(sectionIndex){this.currentIndex=0,this.currentTaskIndex=0,this.model.preRequestData.preRequestSections.splice(sectionIndex,1)}}},multisitepreventive_pmformprerequestvue_type_script_lang_js=pmformprerequestvue_type_script_lang_js,pmformprerequest_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_pmformprerequestvue_type_script_lang_js,pmformprerequestvue_type_template_id_65930e9d_render,pmformprerequestvue_type_template_id_65930e9d_staticRenderFns,!1,null,null,null)
/* harmony default export */,pmformprerequest=pmformprerequest_component.exports,pmformtriggervue_type_template_id_c5d67f3a_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable-y100 pm-trigger-form"},[_c("div",{staticClass:"fc-pm-form-container"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",[_vm._v("EDIT PLANNED MAINTENANCE")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_c("div",{},[_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-pm-main-content-H"},[_vm._v(" TRIGGER AND ASSIGNING ")]):_vm._e(),_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-heading-border-width43"}):_vm._e()]),_c("div",{staticClass:"fc-pm-main-inner-container"},[_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-pm-task-form-table-con"},[_c("table",{staticClass:"fc-pm-form-table"},[_vm._m(1),_c("tbody",_vm._l(_vm.model.triggerData.triggers,(function(trigger,key){return _c("tr",{key:key,staticClass:"visibility-visible-actions pointer table-hover",on:{click:function($event){return _vm.currentTriggerIndex(key)}}},[_c("td",{},[_c("div",{staticClass:"felx-middle"},[_c("div",{staticClass:"dot-green fL",staticStyle:{"margin-top":"9px"}}),_c("div",{staticClass:"label-txt-black mL20 max-width500px fL line-height20"},[_vm._v(" "+_vm._s(trigger.name)+" ")]),0!==key||_vm.model.triggerData.isDefaultAllTriggers?_vm._e():_c("div",{staticClass:"fc-tag fL mL10"},[_c("el-tag",[_vm._v("Default")])],1)])]),_c("td",{staticClass:"pL30 pR30 pT20 pB20"}),_c("td",{staticClass:"pL30 pR30 pT20 pB20"}),_c("td",{staticClass:"text-right"},[_c("div",{staticClass:"flex-middle visibility-hide-actions text-right justify-content-end pR10"},[_c("div",[_c("i",{staticClass:"el-icon-edit visibility-hide-actions edit-icon-grey pL5 mT10",on:{click:function($event){return _vm.handleactions("edit",key)}}})]),_c("div",{staticClass:"mT10 pL10",on:{click:function($event){return _vm.handleactions("delete",key)}}},[_c("img",{attrs:{src:__webpack_require__(385769),height:"16",width:"16"}})])])])])})),0)]),_c("div",{},[_c("el-button",{staticClass:"fc-btn-green-medium-border mT30",on:{click:_vm.addTrigger}},[_vm._v("Add trigger")])],1),_c("div",{staticClass:"pT30"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("ASSIGNMENT")]),_c("el-row",[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black pT10"},[_vm._v("Default Assignee")])]),_c("el-col",{attrs:{span:6}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100 mR10 background-hide mR10",attrs:{clearable:"",filterable:""},on:{change:_vm.updateResourceList},model:{value:_vm.model.triggerData.defaultAssignedTo,callback:function($$v){_vm.$set(_vm.model.triggerData,"defaultAssignedTo",$$v)},expression:"model.triggerData.defaultAssignedTo"}},_vm._l(_vm.userList,(function(user,key){return _c("el-option",{key:key,attrs:{label:user.name,value:user.ouid}})})),1)],1)],1)],1),_c("div",{staticClass:"pT30"},[_vm._m(2),_c("div",{staticClass:"mB30 pT20"},_vm._l(_vm.model.triggerData.reminders,(function(reminder,key){return _c("el-row",{key:key,staticClass:"pm-form-notifications-row visibility-visible-actions border-bottom2 pT10 pB10"},[_c("el-col",{staticClass:"pT5 pB5 p10",attrs:{span:9}},[_vm._v(_vm._s(_vm.model.triggerData.reminders[key].name))]),_c("el-col",{staticClass:"pT5 pB5",attrs:{span:6}},[_vm._v(_vm._s(_vm.templateOptions[key].label))]),_c("el-col",{staticClass:"fc-tag fc-tag-pm",attrs:{span:6}}),_c("el-col",{staticClass:"visibility-hide-actions text-right flex-middle justify-content-end pR20",attrs:{span:3}},[_c("i",{staticClass:"el-icon-edit visibility-hide-actions edit-icon-grey pR10 f16",on:{click:function($event){return _vm.showEditNotificationConfiguration(key)}}}),_c("span",{staticClass:"visibility-hide-actions",on:{click:function($event){return _vm.removeReminder(key)}}},[_c("img",{staticClass:"mT5",attrs:{src:__webpack_require__(385769),height:"16",width:"16"}})])])],1)})),1)]),_c("el-button",{staticClass:"fc-btn-green-medium-border",on:{click:_vm.showAddNotificationConfiguration}},[_vm._v("ADD NOTIFICATION")])],1):_c("div",{staticClass:"text-center mT20"},[_vm._m(0),_c("div",[_c("InlineSvg",{attrs:{src:"svgs/emptystate/data-empty",iconClass:"icon icon-xxxxlg new-icon"}})],1),_c("div",{staticClass:"empty-greyH-bold bold"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.schedule_your_maintenance"))+" ")]),_c("div",{staticClass:"empty-grey-desc pT10"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.set_trigger_your_wo"))+" ")]),_c("div",{staticClass:"pT15"},[_c("el-button",{staticClass:"fc-btn-green-medium-border",on:{click:_vm.addTrigger}},[_vm._v("ADD TRIGGER")])],1)])])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v("PROCEED TO NEXT")])],1)])])]),_vm.showScheduleSettings?_c("el-dialog",{staticClass:"fc-dialog-center-container new-add-triger-dialog fc-dialog-header-hide",attrs:{visible:_vm.showScheduleSettings,"append-to-body":!0,title:""},on:{"update:visible":function($event){_vm.showScheduleSettings=$event}}},[_c("div",{staticClass:"positon-relative trigger-dialog-body"},[_c("trigger",{attrs:{trigger:_vm.triggerEdit,isSingleWo:"bulk"!==_vm.model.woData.workOrderType,resource:_vm.model.woData.singleResource}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.cancelTriggerSave}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.saveTrigger}},[_vm._v("SAVE")])],1)]):_vm._e(),_vm.showReminderCustomization?_c("el-dialog",{staticClass:"fc-dialog-center-container form-customize-dialog",attrs:{visible:_vm.showReminderCustomization,width:"40%","append-to-body":!0},on:{"update:visible":function($event){_vm.showReminderCustomization=$event}}},[_c("div",{staticClass:"el-tabs-block"},[_c("el-tabs",{model:{value:_vm.activeName,callback:function($$v){_vm.activeName=$$v},expression:"activeName"}},[_c("el-tab-pane",{attrs:{label:"Email",name:"email"}},[_c("el-row",[_c("el-col",{staticClass:"el-select-block",attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("To")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width500px",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.templateEdit[_vm.activeName].toAddr,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"toAddr",$$v)},expression:"templateEdit[activeName].toAddr"}},_vm._l(_vm.notificationUserLists,(function(user){return _c("el-option",{key:user.value,staticClass:"subject",attrs:{label:user.label,value:user.value}},[_vm._v(_vm._s(user.displayLabel?user.displayLabel:user.label))])})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Subject")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"text",placeholder:"Please Enter the Subject"},model:{value:_vm.templateEdit[_vm.activeName].subject,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"subject",$$v)},expression:"templateEdit[activeName].subject"}})],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Message")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:6,maxRows:3},autocomplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.templateEdit[_vm.activeName].message,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"message",$$v)},expression:"templateEdit[activeName].message"}})],1)],1)],1),_c("el-tab-pane",{attrs:{label:"SMS",name:"sms"}},[_c("el-row",[_c("el-col",{staticClass:"el-select-block",attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("To")]),_c("el-select",{staticClass:"fc-input-full-border-select2 el-select-block width500px",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.templateEdit[_vm.activeName].toAddr,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"toAddr",$$v)},expression:"templateEdit[activeName].toAddr"}},_vm._l(_vm.notificationUserLists,(function(user){return _c("el-option",{key:user.value,staticClass:"subject",attrs:{label:user.label,value:user.value}},[_vm._v(_vm._s(user.displayLabel?user.displayLabel:user.label))])})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Message")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:6,maxRows:3},autocomplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.templateEdit[_vm.activeName].message,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"message",$$v)},expression:"templateEdit[activeName].message"}})],1)],1)],1),_c("el-tab-pane",{attrs:{label:"Mobile",name:"mobile"}},[_c("el-row",[_c("el-col",{staticClass:"el-select-block",attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("To")]),_c("el-select",{staticClass:"fc-input-full-border-select2 el-select-block width500px",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.templateEdit[_vm.activeName].toAddr,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"toAddr",$$v)},expression:"templateEdit[activeName].toAddr"}},_vm._l(_vm.notificationUserLists,(function(user){return _c("el-option",{key:user.value,staticClass:"subject",attrs:{label:user.label,value:user.value}},[_vm._v(_vm._s(user.displayLabel?user.displayLabel:user.label))])})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Subject")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"text",placeholder:"Please Enter the Subject"},model:{value:_vm.templateEdit[_vm.activeName].subject,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"subject",$$v)},expression:"templateEdit[activeName].subject"}})],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Message")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:6,maxRows:3},autocomplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.templateEdit[_vm.activeName].message,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"message",$$v)},expression:"templateEdit[activeName].message"}})],1)],1)],1)],1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){_vm.showReminderCustomization=!1,_vm.activeName="email",_vm.currentTrigger=0}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:_vm.saveReminderTemplate}},[_vm._v("Save")])],1)]):_vm._e(),_c("notification-form",{attrs:{showConfigureNotification:_vm.showConfigureNotification,reminderTemplateEdit:_vm.reminderTemplateEdit,reminderType:_vm.reminderType},on:{closeDialog:function($event){return _vm.closeDialog()},addReminder:_vm.addReminder}})],1)},pmformtriggervue_type_template_id_c5d67f3a_staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("TRIGGER LIST")])])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("thead",[_c("tr",[_c("th",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("TRIGGER LIST")])])])])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"flex-middle justify-content-space"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("NOTIFICATIONS")])])}],PMTrigger=__webpack_require__(438817),PMFormNotification=__webpack_require__(923703),SeasonTriggerMixin=__webpack_require__(747192),pmformtriggervue_type_script_lang_js={props:["model","users","groups"],mixins:[PMMixin/* default */.Z,SeasonTriggerMixin/* default */.Z],components:{Trigger:PMTrigger/* default */.Z,NotificationForm:PMFormNotification/* default */.Z},data:function(){return{showScheduleSettings:!1,triggerIndex:-1,dateOptions:{disabledDate:function(time){var today=new Date;today.setHours(0,0,0,0);var fiveYear=new Date;return fiveYear.setFullYear(today.getFullYear()+5),time.getTime()<today.getTime()||time.getTime()>fiveYear.getTime()}},timesOption:[],readingFields:[],popovers:{},triggerPopovers:{},showConfigureNotification:!1,showReminderCustomization:!1,editNotificationConfiguration:!1,customizeVisible:!1,activeName:"email",reminderType:[{label:"Before Execution",value:1,helpText:"before execution"},{label:"After Execution",value:2,helpText:"after execution"},{label:"Before Due",value:3,helpText:"before due"},{label:"After Due",value:4,helpText:"after due"}],notificationEdit:[],currentTrigger:0,reminderTemplateEdit:{},triggerEdit:{},templateEdit:{},isEditingTrigger:!1,searchQuery:""}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({templateOptions:function(){var options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),this.model.triggerData.reminders.forEach((function(reminder,i){options.push({label:"".concat(timeLookup[reminder.duration]," ").concat(typeLookup[reminder.type]),value:i})})),options}},(0,vuex_esm/* mapState */.rn)({})),{},{triggerTypes:function(){var types=[{label:"Schedule",value:1},{label:"Reading",value:2},{label:"Alarm Condition",value:3}];return"single"===this.model.woData.workOrderType||types.splice(1,2),types},notificationUserLists:function(){if(this.users){var users=this.$helpers.cloneObject(this.users).filter((function(user){return user.inviteAcceptStatus})).map((function(user){return{label:user.name,value:user.id,displayLabel:user.name+" ("+user.email+")"}}));return users}return[]},buildingList:function(){var buildings=[];if(this.$store.getters.getBuildings&&this.model.woData.sites)for(var i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.$store.getters.getBuildings.length;j++)this.$store.getters.getBuildings[j].siteId===this.model.woData.sites[i]&&buildings.push(this.$store.getters.getBuildings[j]);return buildings},userList:function(){var _this=this,groups=this.$getProperty(this,"model.woData.woModel.groups",{});if(groups&&groups.id){var group=this.groups.find((function(group){return group.id===Number(_this.model.woData.woModel.groups.id)}));if(group)return group.members}return this.users.filter((function(user){return _this.canHandleSite(user,_this.model.woData.sites)}))}}),methods:{closeDialog:function(){this.showConfigureNotification=!1},generateReminderOptions:function(){var options=[];options.push({label:"30 Min",value:1800});for(var i=1;i<24;i++)options.push({label:i+(1===i?" Hour":" Hours"),value:3600*i});for(var _i=1;_i<32;_i++)options.push({label:_i+(1===_i?" Day":" Days"),value:24*_i*3600});return options},resetDate:function(val){this.$forceUpdate()},assignCriteria:function(val){this.triggerEdit.criteria=val,this.$forceUpdate()},userName:function(resource){var user=this.userList.find((function(user){return user.ouid===resource.assignedTo}));return user?user.name:"Default"},forceUpdate:function(){this.$forceUpdate()},setHourOptions:function(){for(var i=0;i<=23;i++){var time=(i<10?"0"+i:i)+":";this.timesOption.push(time+"00"),this.timesOption.push(time+"30")}},currentTriggerIndex:function(key){this.triggerIndex=key},addTrigger:function(){var type=1,startDate=new Date;startDate.setHours(0,0,0,0);var startTime=startDate.getTime(),name="Trigger ".concat(this.model.triggerData.triggers.length+1);this.triggerEdit={name:name,type:type,startDate:startDate,startTime:startTime,basedOn:"Date",schedule:{times:["00:00"],frequency:1,skipEvery:-1,values:[],frequencyType:1,weekFrequency:-1,yearlyDayValue:null,monthValue:-1,yearlyDayOfWeekValues:[]},customTrigger:{customModuleId:null,fieldId:null,days:null,hours:null},stopAfter:"never",endTime:new Date,startReading:null,readingFieldId:null,stopAfterReading:"never",endReading:null,readingInterval:null,assignedTo:null,reminders:[],criteria:null,sharingContext:{shareTo:2,sharedRoles:[],sharedUsers:[],sharedGroups:[]}},this.isEditingTrigger=!1,this.triggerIndex=this.triggerIndex+1,this.showScheduleSettings=!0},saveTrigger:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var currIndex,previous,i,triggerNames,index,k,frequencyType,basedOn,freqMap;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this2.canSaveTrigger();case 2:if(_context.sent){_context.next=4;break}return _context.abrupt("return");case 4:if(currIndex=_this2.triggerIndex,!_this2.isEditingTrigger){_context.next=28;break}
// Replace the tigger name in resource planner
if(previous=_this2.$helpers.cloneObject(_this2.model.triggerData.triggers[_this2.triggerIndex]),_this2.$set(_this2.model.triggerData.triggers,_this2.triggerIndex,_this2.triggerEdit),previous.name===_this2.triggerEdit.name){_context.next=26;break}i=0;case 10:if(!(i<_this2.model.woData.resourceList.length)){_context.next=26;break}if(triggerNames=_this2.$helpers.cloneObject(_this2.model.woData.resourceList[i].triggerNames),!triggerNames){_context.next=23;break}index=-1,k=0;case 15:if(!(k<triggerNames.length)){_context.next=22;break}if(triggerNames[k]!==previous.name){_context.next=19;break}return index=k,_context.abrupt("break",22);case 19:k++,_context.next=15;break;case 22:index>-1&&(triggerNames[index]=_this2.triggerEdit.name,_this2.$set(_this2.model.woData.resourceList[i],"triggerNames",triggerNames));case 23:i++,_context.next=10;break;case 26:_context.next=31;break;case 28:_this2.model.triggerData.triggers.push(_this2.triggerEdit),currIndex=_this2.model.triggerData.triggers.length-1,_this2.triggerIndex=_this2.triggerIndex+1;case 31:1===_this2.model.triggerData.triggers[currIndex].type&&(_this2.model.triggerData.triggers[currIndex].schedule.skipEvery||(_this2.model.triggerData.triggers[currIndex].schedule.skipEvery=-1),_this2.model.triggerData.triggers[currIndex].schedule.yearlyDayValue||(_this2.model.triggerData.triggers[currIndex].schedule.yearlyDayValue=-1),frequencyType=_this2.model.triggerData.triggers[currIndex].schedule.frequencyType,frequencyType=_this2.$constants.FACILIO_FREQUENCY[frequencyType],basedOn=_this2.model.triggerData.triggers[currIndex].basedOn,freqMap={},Object.keys(_this2.$constants.FACILIO_FREQUENCY).forEach((function(i){return freqMap[_this2.$constants.FACILIO_FREQUENCY[i]]=i})),_this2.model.triggerData.triggers[currIndex].frequency=freqMap[frequencyType]||0,"Monthly"===frequencyType?_this2.model.triggerData.triggers[currIndex].schedule.frequencyType="Date"===basedOn?3:4:"Quarterly"===frequencyType?_this2.model.triggerData.triggers[currIndex].schedule.frequencyType="Date"===basedOn?7:8:"Half Yearly"===frequencyType?_this2.model.triggerData.triggers[currIndex].schedule.frequencyType="Date"===basedOn?9:10:"Annually"===frequencyType&&(_this2.model.triggerData.triggers[currIndex].schedule.frequencyType="Date"===basedOn?5:6),delete _this2.model.triggerData.triggers[currIndex].schedule.basedOn),_this2.showScheduleSettings=!1,_this2.isEditingTrigger=!1;case 34:case"end":return _context.stop()}}),_callee)})))()},resourceChanged:function(newVal,oldVal){return newVal.workOrderType!==oldVal.workOrderType||newVal.resourceType!==oldVal.resourceType||newVal.spacecategoryId!==oldVal.spacecategoryId||newVal.assetCategoryId!==oldVal.assetCategoryId},moveToPrevious:function(){this.$emit("previous")},moveToNext:function(){this.$emit("next")},selectedUser:function(key,userId){this.model.woData.resourceList[key].assignedTo=userId,this.updateResourceList(),this.popovers[key]=!1},updateResourceList:function(){var resourceList=this.$helpers.cloneObject(this.model.woData.resourceList);this.$set(this.model.woData,"resourceList",resourceList)},selectedTrigger:function(key,index){this.model.woData.resourceList[key].triggerIndex=index,this.triggerPopovers[key]=!1},getFloorReadings:function(){var _this3=this;this.$http.post("/reading/getallspacetypereadings",{spaceType:"Floors"}).then((function(response){for(var categoryId in response.data.moduleMap){var moduleJson=response.data.moduleMap[categoryId];for(var moduleIndex in moduleJson){var readingFields=moduleJson[moduleIndex].fields;for(var fieldIndex in readingFields){var field=readingFields[fieldIndex];-1===categoryId?(field["spaceId"]="Default Readings",field.buildingName="All"):(field["spaceId"]=response.data.spaces[categoryId].name,field.buildingName=response.data.spaces[categoryId].building.name),_this3.readingFields.push(field)}}}}))},handleSingleResource:function(){var _this4=this;"single"===this.model.woData.workOrderType&&this.model.woData.singleResource&&this.model.woData.singleResource.id&&("SPACE"===this.model.woData.singleResource.resourceTypeEnum?this.$util.loadSpaceReadingFields(this.model.woData.singleResource.id,!1).then((function(fields){_this4.readingFields=fields})):"ASSET"===this.model.woData.singleResource.resourceTypeEnum&&this.$util.loadAssetReadingFields(this.model.woData.singleResource.id,-1,!1).then((function(fields){_this4.readingFields=fields})))},removeReminder:function(index){var reminderName=this.model.triggerData.reminders[index].name;
// removing notifications assigned to resources
if(this.model.triggerData.reminders.splice(index,1),"bulk"===this.model.woData.workOrderType&&this.model.woData.resourceList)for(var i=0;i<this.model.woData.resourceList.length;i++)if(this.model.woData.resourceList[i].notifications)for(var j=0;j<this.model.woData.resourceList[i].notifications.length;j++)this.model.woData.resourceList[i].notifications[j]===reminderName&&this.$delete(this.model.woData.resourceList[i].notifications,j)},addReminder:function(reminderTemplateEdit){this.showConfigureNotification=!1,this.editNotificationConfiguration?Object.assign(this.model.triggerData.reminders[reminderTemplateEdit.index],this.$helpers.cloneObject(reminderTemplateEdit)):this.model.triggerData.reminders.push(this.$helpers.cloneObject(reminderTemplateEdit))},handleactions:function(val,key){if("edit"===val){if(this.isEditingTrigger=!0,this.triggerEdit=this.$helpers.cloneObject(this.model.triggerData.triggers[key]),1===this.triggerEdit.type){var frequencyType=this.triggerEdit.schedule.frequencyType;this.triggerEdit.schedule.frequencyType%2?this.triggerEdit.basedOn="Date":this.triggerEdit.basedOn="Week",3===frequencyType||4===frequencyType?this.triggerEdit.schedule.frequencyType=3:7===frequencyType||8===frequencyType?this.triggerEdit.schedule.frequencyType=4:9===frequencyType||10===frequencyType?this.triggerEdit.schedule.frequencyType=5:5!==frequencyType&&6!==frequencyType||(this.triggerEdit.schedule.frequencyType=6)}this.showScheduleSettings=!0}else if("delete"===val&&this.model.triggerData.triggers.length>0){var triggerName=this.model.triggerData.triggers[key].name;
// deleting triggers from resources planner
if(this.model.triggerData.triggers.splice(key,1),"bulk"===this.model.woData.workOrderType&&this.model.woData.resourceList){for(var rList=this.$helpers.cloneObject(this.model.woData.resourceList),i=0;i<rList.length;i++){var zi=rList[i].triggerNames.findIndex((function(l){return l===triggerName}));zi>-1&&(rList[i].triggerNames.splice(zi,1),0===rList[i].triggerNames.length&&rList[i].triggerNames.push("0"))}this.$set(this.model.woData,"resourceList",rList)}
// delete associated trigger in task
for(var j=0;j<this.model.taskData.taskSections.length;j++)for(var index=-1,triggers=this.$helpers.cloneObject(this.model.taskData.taskSections[j].triggers),k=0;k<triggers.length;k++)if(index=triggers.findIndex((function(n){return"All"!==n&&n.triggerName===triggerName})),index>-1){triggers.splice(index,1),0===triggers.length&&triggers.push({triggerName:"All"}),this.$set(this.model.taskData.taskSections[j],"triggers",triggers);break}}},cancelTriggerSave:function(){this.isEditingTrigger=!1,this.showScheduleSettings=!1},showEditNotificationConfiguration:function(index){this.editNotificationConfiguration=!0,this.reminderTemplateEdit={name:"",type:null,duration:null,isEmail:!1,isSms:!1,isMobile:!1,template:{email:{},mobile:{},sms:{}},reminderActions:[]},this.reminderTemplateEdit.index=index,Object.assign(this.reminderTemplateEdit,this.model.triggerData.reminders[index]),this.showConfigureNotification=!0},showAddNotificationConfiguration:function(){this.editNotificationConfiguration=!1;var count=this.model.triggerData.reminders.length;this.reminderTemplateEdit={name:"Notification ".concat(count+1),type:2,duration:3600,isEmail:!0,isSms:!1,isMobile:!0,template:{email:{},mobile:{},sms:{}},reminderActions:[]},this.showConfigureNotification=!0},showReminderTemplate:function(key){this.templateEdit={email:{toAddr:[],subject:"",message:""},mobile:{toAddr:[],subject:"",message:""},sms:{toAddr:[],message:""},key:key},this.editNotificationConfiguration?(this.model.triggerData.reminders[key].template.email&&Object.assign(this.templateEdit.email,this.model.triggerData.reminders[key].template.email),this.model.triggerData.reminders[key].template.mobile&&Object.assign(this.templateEdit.mobile,this.model.triggerData.reminders[key].template.mobile),this.model.triggerData.reminders[key].template.sms&&Object.assign(this.templateEdit.sms,this.model.triggerData.reminders[key].template.sms)):(this.reminderTemplateEdit.template.email&&Object.assign(this.templateEdit.email,this.reminderTemplateEdit.template.email),this.reminderTemplateEdit.template.mobile&&Object.assign(this.templateEdit.mobile,this.reminderTemplateEdit.template.mobile),this.reminderTemplateEdit.template.sms&&Object.assign(this.templateEdit.sms,this.reminderTemplateEdit.template.sms)),this.showReminderCustomization=!0},saveReminderTemplate:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:Object.assign(_this5.reminderTemplateEdit.template.email,_this5.templateEdit.email),Object.assign(_this5.reminderTemplateEdit.template.mobile,_this5.templateEdit.mobile),Object.assign(_this5.reminderTemplateEdit.template.sms,_this5.templateEdit.sms),_this5.showReminderCustomization=!1,_this5.activeName="email";case 5:case"end":return _context2.stop()}}),_callee2)})))()}},watch:{"model.woData.spacecategoryId":{handler:function(newVal,oldVal){var _this6=this;newVal!==oldVal&&newVal&&"bulk"===this.model.woData.workOrderType&&this.$util.loadSpaceReadingFields(-1,!1,Number(this.model.woData.spacecategoryId)).then((function(fields){_this6.readingFields=fields}))},deep:!0},"model.woData.assetCategoryId":{handler:function(newVal,oldVal){var _this7=this;newVal!==oldVal&&newVal&&"bulk"===this.model.woData.workOrderType&&this.$util.loadAssetReadingFields(-1,!1,Number(this.model.woData.assetCategoryId)).then((function(fields){_this7.readingFields=fields}))},deep:!0},"model.woData.resourceType":{deep:!0,handler:function(newVal,oldVal){"bulk"===this.model.woData.workOrderType&&"ALL_FLOORS"===this.model.woData.resourceType&&this.getFloorReadings()}},"model.woData.workOrderType":{deep:!0,handler:function(newVal,oldVal){this.handleSingleResource()}},"model.woData.singleResource":{deep:!0,handler:function(newVal,oldVal){this.handleSingleResource()}}},created:function(){this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadBuildings")},mounted:function(){this.setHourOptions()}},multisitepreventive_pmformtriggervue_type_script_lang_js=pmformtriggervue_type_script_lang_js,pmformtrigger_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_pmformtriggervue_type_script_lang_js,pmformtriggervue_type_template_id_c5d67f3a_render,pmformtriggervue_type_template_id_c5d67f3a_staticRenderFns,!1,null,null,null)
/* harmony default export */,pmformtrigger=pmformtrigger_component.exports,pmformtriggeroldvue_type_template_id_84af82ce_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable-y100"},[_c("div",{staticClass:"fc-pm-form-container"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",[_vm._v(" EDIT PLANNED MAINTENANCE ")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-pm-main-content-H"},[_vm._v(" TRIGGER AND ASSIGNING ")]):_vm._e(),_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-heading-border-width43"}):_vm._e(),_c("div",{staticClass:"fc-pm-main-inner-container"},[_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-pm-task-form-table-con"},[_c("table",{staticClass:"fc-pm-form-table"},[_vm._m(1),_c("tbody",_vm._l(_vm.model.triggerData.triggers,(function(trigger,key){return _c("tr",{key:key,staticClass:"visibility-visible-actions pointer table-hover",on:{click:function($event){return _vm.currentTriggerIndex(key)}}},[_c("td",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"dot-green fL",staticStyle:{"margin-top":"9px"}}),_c("div",{staticClass:"label-txt-black mL20 max-width500px fL line-height20"},[_vm._v(" "+_vm._s(trigger.name)+" ")]),0!==key||_vm.model.triggerData.isDefaultAllTriggers?_vm._e():_c("div",{staticClass:"width200px fc-tag fL mL10"},[_c("el-tag",[_vm._v("Default")])],1)]),_c("td"),_c("td"),_c("td",{staticClass:"text-right pT10 pB10"},[_c("el-col",{staticClass:"visibility-visible-actions",attrs:{span:4}},[_c("i",{staticClass:"el-icon-edit visibility-hide-actions edit-icon-grey pL5 mT10",on:{click:function($event){return _vm.handleactions("edit",key)}}})]),_c("el-col",{staticClass:"visibility-hide-actions",attrs:{span:3}},[_c("div",{staticClass:"mT10 pL20 fL",on:{click:function($event){return _vm.handleactions("delete",key)}}},[_c("img",{attrs:{src:__webpack_require__(385769),height:"16",width:"16"}})])])],1)])})),0)]),_c("div",[_c("el-button",{staticClass:"fc-btn-green-medium-border mT30",on:{click:_vm.addTrigger}},[_vm._v("ADD TRIGGER")])],1),_c("div",{staticClass:"fc-pm-border mT40 mB30"}),_c("div",{staticClass:"fc-text-pink"},[_vm._v("ASSIGNMENT")]),_c("el-row",[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"label-txt-black bold pT10"},[_vm._v(" Default Assignee ")])]),_c("el-col",{attrs:{span:10}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width170px mR10 background-hide mR10",attrs:{clearable:"",filterable:""},on:{change:_vm.updateResourceList},model:{value:_vm.model.triggerData.defaultAssignedTo,callback:function($$v){_vm.$set(_vm.model.triggerData,"defaultAssignedTo",$$v)},expression:"model.triggerData.defaultAssignedTo"}},_vm._l(_vm.userList,(function(user,key){return _c("el-option",{key:key,attrs:{label:user.name,value:user.ouid}})})),1)],1)],1),_c("div",{staticClass:"fc-pm-border mT40 mB30"}),_c("div",{staticClass:"fc-text-pink"},[_vm._v("NOTIFICATIONS")]),_c("div",{staticClass:"mB30"},_vm._l(_vm.model.triggerData.reminders,(function(reminder,key){return _c("el-row",{key:key,staticClass:"pm-form-notifications-row visibility-visible-actions border-bottom2"},[_c("el-col",{staticClass:"pT5 pB5",attrs:{span:9}},[_vm._v(" "+_vm._s(_vm.model.triggerData.reminders[key].name)+" ")]),_c("el-col",{staticClass:"pT5 pB5",attrs:{span:6}},[_vm._v(" "+_vm._s(_vm.templateOptions[key].label)+" ")]),_c("el-col",{staticClass:"fc-tag fc-tag-pm",attrs:{span:6}},[_vm.model.triggerData.reminders[key].isEmail?_c("el-tag",[_vm._v("Email")]):_vm._e(),_vm.model.triggerData.reminders[key].isMobile?_c("el-tag",[_vm._v("Mobile")]):_vm._e(),_vm.model.triggerData.reminders[key].isSms?_c("el-tag",[_vm._v("SMS")]):_vm._e()],1),_c("el-col",{staticClass:"visibility-hide-actions",attrs:{span:3}},[_c("i",{staticClass:"el-icon-edit visibility-hide-actions edit-icon-grey pL5 pR5 f16",on:{click:function($event){return _vm.showEditNotificationConfiguration(key)}}}),_c("span",{staticClass:"visibility-hide-actions",on:{click:function($event){return _vm.removeReminder(key)}}},[_c("img",{staticClass:"mT5",attrs:{src:__webpack_require__(385769),height:"16",width:"16"}})])])],1)})),1),_c("el-button",{staticClass:"fc-btn-green-medium-border",on:{click:_vm.showAddNotificationConfiguration}},[_vm._v("ADD NOTIFICATION")])],1):_c("div",{staticClass:"text-center mT20"},[_vm._m(0),_c("div",{staticClass:"trigger-empty-state"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.schedule_your_maintenance"))+" ")]),_c("div",{staticClass:"trigger-empty-state-subtext"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.set_trigger_your_wo"))+" ")]),_c("div",{staticClass:"pT15"},[_c("el-button",{staticClass:"fc-btn-green-medium-border",on:{click:_vm.addTrigger}},[_vm._v("ADD TRIGGER")])],1)])])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v("PROCEED TO NEXT")])],1)])])]),_vm.showScheduleSettings?_c("el-dialog",{staticClass:"fc-dialog-center-container add-triger-dialog",attrs:{visible:_vm.showScheduleSettings,"append-to-body":!0,title:"TRIGGER DETAILS"},on:{"update:visible":function($event){_vm.showScheduleSettings=$event}}},[_c("el-row",[_c("el-col",[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Name")]),_c("div",[_c("el-input",{staticClass:"fc-input-full-border2",model:{value:_vm.triggerEdit.name,callback:function($$v){_vm.$set(_vm.triggerEdit,"name",$$v)},expression:"triggerEdit.name"}})],1)])],1),_c("el-row",{staticClass:"mT25"},[_c("el-col",[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Trigger Type")]),_c("div",[_c("el-select",{staticClass:"form-item fc-input-full-border-select2",staticStyle:{width:"100%"},attrs:{disabled:"bulk"===_vm.model.woData.workOrderType,placeholder:" "},on:{change:function($event){_vm.triggerEdit.schedule=null,_vm.forceUpdate()}},model:{value:_vm.triggerEdit.type,callback:function($$v){_vm.$set(_vm.triggerEdit,"type",$$v)},expression:"triggerEdit.type"}},_vm._l(_vm.triggerTypes,(function(triggerType){return _c("el-option",{directives:[{name:"show",rawName:"v-show",value:1!==triggerType.value||1===_vm.triggerEdit.type,expression:"triggerType.value !== 1 || triggerEdit.type === 1"}],key:triggerType.value,attrs:{label:triggerType.label,value:triggerType.value}})})),1)],1)])],1),1===_vm.triggerEdit.type?_c("el-row",{staticClass:"mT25"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Execution Start Date")]),_c("el-col",{attrs:{span:12}},[_c("el-date-picker",{staticClass:"form-item fc-input-full-border-select2 date-picker-trigger",staticStyle:{width:"100%"},attrs:{"picker-options":_vm.dateOptions,"float-label":"Start Date",type:"date","suffix-icon":"el-icon-date"},on:{input:_vm.resetDate},model:{value:_vm.triggerEdit.startDate,callback:function($$v){_vm.$set(_vm.triggerEdit,"startDate",$$v)},expression:"triggerEdit.startDate"}})],1),_c("el-col",{staticClass:"el-select-block",attrs:{span:12}},[_c("el-select",{staticClass:"form-item pL10 fc-input-full-border-select2",staticStyle:{width:"100%"},attrs:{multiple:"","multiple-limit":_vm.triggerEdit.schedule&&0===parseInt(_vm.triggerEdit.schedule.facilioFrequency)?1:0,"collapse-tags":!0},on:{change:_vm.forceUpdate},model:{value:_vm.triggerEdit.startHour,callback:function($$v){_vm.$set(_vm.triggerEdit,"startHour",$$v)},expression:"triggerEdit.startHour"}},_vm._l(_vm.timesOption,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1)],1)],1):_vm._e(),1===_vm.triggerEdit.type?_c("f-schedule",{staticClass:"mT25",attrs:{from:_vm.triggerEdit.startDate,times:_vm.triggerEdit.startHour,initialSchedule:_vm.triggerEdit.initialSchedule},model:{value:_vm.triggerEdit.schedule,callback:function($$v){_vm.$set(_vm.triggerEdit,"schedule",$$v)},expression:"triggerEdit.schedule"}}):_vm._e(),2===_vm.triggerEdit.type?_c("el-row",{staticClass:"mT25"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.reading_field"))+" ")]),_c("el-select",{staticClass:"form-item fc-input-full-border-select2",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:" "},on:{change:_vm.forceUpdate},model:{value:_vm.triggerEdit.readingFieldId,callback:function($$v){_vm.$set(_vm.triggerEdit,"readingFieldId",$$v)},expression:"triggerEdit.readingFieldId"}},_vm._l(_vm.readingFields,(function(readingField){return _c("el-option",{key:readingField.id,attrs:{label:readingField.displayName,value:readingField.id}})})),1)],1)],1):_vm._e(),2===_vm.triggerEdit.type?_c("el-row",{staticClass:"mT25"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.every"))+" ")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"number",placeholder:""},model:{value:_vm.triggerEdit.readingInterval,callback:function($$v){_vm.$set(_vm.triggerEdit,"readingInterval",$$v)},expression:"triggerEdit.readingInterval"}})],1)],1):_vm._e(),2===_vm.triggerEdit.type?_c("el-row",{staticClass:"mT25"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.start_reading"))+" ")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"number",placeholder:""},model:{value:_vm.triggerEdit.startReading,callback:function($$v){_vm.$set(_vm.triggerEdit,"startReading",$$v)},expression:"triggerEdit.startReading"}})],1)],1):_vm._e(),3===_vm.triggerEdit.type?_c("el-row",{staticClass:"mT25"},[_c("new-criteria-builder",{attrs:{exrule:_vm.triggerEdit.criteria,module:"alarm"},on:{condition:_vm.assignCriteria}})],1):_vm._e(),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.cancelTriggerSave}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.saveTrigger}},[_vm._v("SAVE")])],1)],1):_vm._e(),_vm.showReminderCustomization?_c("el-dialog",{staticClass:"fc-dialog-center-container form-customize-dialog",attrs:{visible:_vm.showReminderCustomization,width:"40%","append-to-body":!0},on:{"update:visible":function($event){_vm.showReminderCustomization=$event}}},[_c("div",{staticClass:"el-tabs-block"},[_c("el-tabs",{model:{value:_vm.activeName,callback:function($$v){_vm.activeName=$$v},expression:"activeName"}},[_c("el-tab-pane",{attrs:{label:"Email",name:"email"}},[_c("el-row",[_c("el-col",{staticClass:"el-select-block",attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("To")]),_c("el-select",{staticClass:"fc-input-full-border-select2  width500px",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.templateEdit[_vm.activeName].toAddr,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"toAddr",$$v)},expression:"templateEdit[activeName].toAddr"}},_vm._l(_vm.notificationUserLists,(function(user){return _c("el-option",{key:user.value,staticClass:"subject",attrs:{label:user.label,value:user.value}},[_vm._v(_vm._s(user.displayLabel?user.displayLabel:user.label))])})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Subject")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"text",placeholder:"Please Enter the Subject"},model:{value:_vm.templateEdit[_vm.activeName].subject,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"subject",$$v)},expression:"templateEdit[activeName].subject"}})],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Message")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:6,maxRows:3},autoComplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.templateEdit[_vm.activeName].message,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"message",$$v)},expression:"templateEdit[activeName].message"}})],1)],1)],1),_c("el-tab-pane",{attrs:{label:"SMS",name:"sms"}},[_c("el-row",[_c("el-col",{staticClass:"el-select-block",attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("To")]),_c("el-select",{staticClass:"fc-input-full-border-select2 el-select-block width500px",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.templateEdit[_vm.activeName].toAddr,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"toAddr",$$v)},expression:"templateEdit[activeName].toAddr"}},_vm._l(_vm.notificationUserLists,(function(user){return _c("el-option",{key:user.value,staticClass:"subject",attrs:{label:user.label,value:user.value}},[_vm._v(_vm._s(user.displayLabel?user.displayLabel:user.label))])})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Message")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:6,maxRows:3},autoComplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.templateEdit[_vm.activeName].message,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"message",$$v)},expression:"templateEdit[activeName].message"}})],1)],1)],1),_c("el-tab-pane",{attrs:{label:"Mobile",name:"mobile"}},[_c("el-row",[_c("el-col",{staticClass:"el-select-block",attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("To")]),_c("el-select",{staticClass:"fc-input-full-border-select2 el-select-block width500px",attrs:{multiple:"",filterable:"","default-first-option":"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.templateEdit[_vm.activeName].toAddr,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"toAddr",$$v)},expression:"templateEdit[activeName].toAddr"}},_vm._l(_vm.notificationUserLists,(function(user){return _c("el-option",{key:user.value,staticClass:"subject",attrs:{label:user.label,value:user.value}},[_vm._v(_vm._s(user.displayLabel?user.displayLabel:user.label))])})),1)],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Subject")]),_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"text",placeholder:"Please Enter the Subject"},model:{value:_vm.templateEdit[_vm.activeName].subject,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"subject",$$v)},expression:"templateEdit[activeName].subject"}})],1)],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Message")]),_c("el-input",{staticClass:"fc-input-txt fc-desc-input fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:6,maxRows:3},autoComplete:"off",rows:1,resize:"none",placeholder:"Enter Description"},model:{value:_vm.templateEdit[_vm.activeName].message,callback:function($$v){_vm.$set(_vm.templateEdit[_vm.activeName],"message",$$v)},expression:"templateEdit[activeName].message"}})],1)],1)],1)],1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){_vm.showReminderCustomization=!1,_vm.activeName="email",_vm.currentTrigger=0}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:_vm.saveReminderTemplate}},[_vm._v("Save")])],1)]):_vm._e(),_vm.showConfigureNotification?_c("el-dialog",{staticClass:"fc-dialog-center-container notification-trigger-dialog",attrs:{title:"NOTIFICATION",visible:_vm.showConfigureNotification,width:"40%","append-to-body":!0},on:{"update:visible":function($event){_vm.showConfigureNotification=$event}}},[_c("el-row",{},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Name")]),_c("el-col",{attrs:{span:24}},[_c("el-input",{staticClass:"fc-input-full-border-select3",model:{value:_vm.reminderTemplateEdit.name,callback:function($$v){_vm.$set(_vm.reminderTemplateEdit,"name",$$v)},expression:"reminderTemplateEdit.name"}})],1)],1),_c("el-row",{staticClass:"mT25"},[_c("el-col",{attrs:{span:11}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Duration")]),_c("el-select",{staticClass:"fc-input-full-border-select3 width240px",attrs:{placeholder:"Select"},model:{value:_vm.reminderTemplateEdit.duration,callback:function($$v){_vm.$set(_vm.reminderTemplateEdit,"duration",$$v)},expression:"reminderTemplateEdit.duration"}},_vm._l(_vm.generateReminderOptions(),(function(item){return _c("el-option",{key:item.value,attrs:{label:item.label,value:item.value}})})),1)],1),_c("el-col",{staticClass:"mL45",attrs:{span:8}},[_c("div",{staticClass:"fc-input-label-txt mb5"},[_vm._v("Type")]),_c("el-select",{staticClass:"fc-input-full-border-select3 width240px",attrs:{placeholder:"Select"},model:{value:_vm.reminderTemplateEdit.type,callback:function($$v){_vm.$set(_vm.reminderTemplateEdit,"type",$$v)},expression:"reminderTemplateEdit.type"}},_vm._l(_vm.reminderType,(function(item){return _c("el-option",{key:item.value,attrs:{label:item.label,value:item.value}})})),1)],1)],1),_c("el-row",{staticClass:"mT25"},[_c("el-col",{attrs:{span:4}},[_c("el-checkbox",{staticClass:"mT10",model:{value:_vm.reminderTemplateEdit.isEmail,callback:function($$v){_vm.$set(_vm.reminderTemplateEdit,"isEmail",$$v)},expression:"reminderTemplateEdit.isEmail"}},[_vm._v("Email")])],1),_c("el-col",{attrs:{span:4}},[_c("el-checkbox",{staticClass:"mT10",model:{value:_vm.reminderTemplateEdit.isSms,callback:function($$v){_vm.$set(_vm.reminderTemplateEdit,"isSms",$$v)},expression:"reminderTemplateEdit.isSms"}},[_vm._v("SMS")])],1),_c("el-col",{attrs:{span:3}},[_c("el-checkbox",{staticClass:"mT10",model:{value:_vm.reminderTemplateEdit.isMobile,callback:function($$v){_vm.$set(_vm.reminderTemplateEdit,"isMobile",$$v)},expression:"reminderTemplateEdit.isMobile"}},[_vm._v("Mobile")])],1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){_vm.showConfigureNotification=!1}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:_vm.addReminder}},[_vm._v("Save")])],1)],1):_vm._e()],1)},pmformtriggeroldvue_type_template_id_84af82ce_staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("img",{staticStyle:{width:"49px",height:"49px"},attrs:{src:__webpack_require__(433664)}})])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("thead",[_c("tr",[_c("th",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("TRIGGER LIST")])]),_c("th",{staticClass:"pT10 pB10"}),_c("th",{staticClass:"pT10 pB10"})])])}],FSchedule=__webpack_require__(645877),NewCriteriaBuilder=__webpack_require__(859850),pmformtriggeroldvue_type_script_lang_js={props:["model","users","groups"],mixins:[PMMixin/* default */.Z],components:{FSchedule:FSchedule/* default */.Z,NewCriteriaBuilder:NewCriteriaBuilder/* default */.Z},data:function(){return{showScheduleSettings:!1,triggerIndex:-1,dateOptions:{disabledDate:function(time){var today=new Date;today.setHours(0,0,0,0);var fiveYear=new Date;return fiveYear.setFullYear(today.getFullYear()+5),time.getTime()<today.getTime()||time.getTime()>fiveYear.getTime()}},timesOption:[],readingFields:[],popovers:{},triggerPopovers:{},showConfigureNotification:!1,showReminderCustomization:!1,editNotificationConfiguration:!1,customizeVisible:!1,activeName:"email",reminderType:[{label:"Before Execution",value:1},{label:"After Execution",value:2},{label:"Before Due",value:3},{label:"After Due",value:4}],notificationEdit:[],currentTrigger:0,reminderTemplateEdit:{},triggerEdit:{},templateEdit:{},isEditingTrigger:!1,searchQuery:""}},created:function(){this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadBuildings")},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({templateOptions:function(){var options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),this.model.triggerData.reminders.forEach((function(reminder,i){options.push({label:"".concat(timeLookup[reminder.duration]," ").concat(typeLookup[reminder.type]),value:i})})),options}},(0,vuex_esm/* mapState */.rn)({})),{},{triggerTypes:function(){var types=[{label:"Schedule",value:1},{label:"Reading",value:2},{label:"Alarm Condition",value:3}];return"single"===this.model.woData.workOrderType||types.splice(1,2),types},notificationUserLists:function(){if(this.users){var users=this.$helpers.cloneObject(this.users).filter((function(user){return user.inviteAcceptStatus})).map((function(user){return{label:user.name,value:user.id,displayLabel:user.name+" ("+user.email+")"}}));return users}return[]},buildingList:function(){var buildings=[];if(this.$store.getters.getBuildings&&this.model.woData.sites)for(var i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.$store.getters.getBuildings.length;j++)this.$store.getters.getBuildings[j].siteId===this.model.woData.sites[i]&&buildings.push(this.$store.getters.getBuildings[j]);return buildings},userList:function(){var _this=this;if(this.model.woData.woModel.groups&&this.model.woData.woModel.groups.id){var group=this.groups.find((function(group){return group.id===Number(_this.model.woData.woModel.groups.id)}));return group.members}return this.users}}),methods:{generateReminderOptions:function(){var options=[];options.push({label:"30 Min",value:1800});for(var i=1;i<24;i++)options.push({label:i+(1===i?" Hour":" Hours"),value:3600*i});for(var _i=1;_i<32;_i++)options.push({label:_i+(1===_i?" Day":" Days"),value:24*_i*3600});return options},resetDate:function(val){this.$forceUpdate()},assignCriteria:function(val){this.triggerEdit.criteria=val,this.$forceUpdate()},userName:function(resource){var user=this.userList.find((function(user){return user.ouid===resource.assignedTo}));return user?user.name:"Default"},forceUpdate:function(){this.$forceUpdate()},setHourOptions:function(){for(var i=0;i<=23;i++){var time=(i<10?"0"+i:i)+":";this.timesOption.push(time+"00"),this.timesOption.push(time+"30")}},currentTriggerIndex:function(key){this.triggerIndex=key},addTrigger:function(){var type=1,startDate=new Date;startDate.setHours(0,0,0,0);var name="Trigger ".concat(this.model.triggerData.triggers.length+1);this.triggerEdit={name:name,type:type,startHour:["00:00"],startDate:startDate,startTime:null,schedule:null,stopAfter:"never",endTime:new Date,startReading:null,readingFieldId:null,stopAfterReading:"never",endReading:null,readingInterval:null,assignedTo:null,reminders:[],criteria:null},this.isEditingTrigger=!1,this.triggerIndex=this.triggerIndex+1,this.showScheduleSettings=!0},saveTrigger:function(){if(this.isEditingTrigger){var previous=this.$helpers.cloneObject(this.model.triggerData.triggers[this.triggerIndex]);if(this.$set(this.model.triggerData.triggers,this.triggerIndex,this.triggerEdit),previous.name!==this.triggerEdit.name)for(var i=0;i<this.model.woData.resourceList.length;i++){var triggerNames=this.$helpers.cloneObject(this.model.woData.resourceList[i].triggerNames);if(triggerNames){for(var index=-1,k=0;k<triggerNames.length;k++)if(triggerNames[k]===previous.name){index=k;break}index>-1&&(triggerNames[index]=this.triggerEdit.name,this.$set(this.model.woData.resourceList[i],"triggerNames",triggerNames))}}}else this.model.triggerData.triggers.push(this.triggerEdit),this.triggerIndex=this.triggerIndex+1;this.showScheduleSettings=!1,this.isEditingTrigger=!1},resourceChanged:function(newVal,oldVal){return newVal.workOrderType!==oldVal.workOrderType||newVal.resourceType!==oldVal.resourceType||newVal.spacecategoryId!==oldVal.spacecategoryId||newVal.assetCategoryId!==oldVal.assetCategoryId},moveToPrevious:function(){this.$emit("previous")},moveToNext:function(){this.$emit("next")},selectedUser:function(key,userId){this.model.woData.resourceList[key].assignedTo=userId,this.updateResourceList(),this.popovers[key]=!1},updateResourceList:function(){var resourceList=this.$helpers.cloneObject(this.model.woData.resourceList);this.$set(this.model.woData,"resourceList",resourceList)},selectedTrigger:function(key,index){this.model.woData.resourceList[key].triggerIndex=index,this.triggerPopovers[key]=!1},getFloorReadings:function(){var _this2=this;this.$http.post("/reading/getallspacetypereadings",{spaceType:"Floors"}).then((function(response){for(var categoryId in response.data.moduleMap){var moduleJson=response.data.moduleMap[categoryId];for(var moduleIndex in moduleJson){var readingFields=moduleJson[moduleIndex].fields;for(var fieldIndex in readingFields){var field=readingFields[fieldIndex];-1===categoryId?(field["spaceId"]="Default Readings",field.buildingName="All"):(field["spaceId"]=response.data.spaces[categoryId].name,field.buildingName=response.data.spaces[categoryId].building.name),_this2.readingFields.push(field)}}}}))},handleSingleResource:function(){var _this3=this;"single"===this.model.woData.workOrderType&&this.model.woData.singleResource&&this.model.woData.singleResource.id&&("SPACE"===this.model.woData.singleResource.resourceTypeEnum?this.$util.loadSpaceReadingFields(this.model.woData.singleResource.id,!1).then((function(fields){_this3.readingFields=fields})):"ASSET"===this.model.woData.singleResource.resourceTypeEnum&&this.$util.loadAssetReadingFields(this.model.woData.singleResource.id,-1,!1).then((function(fields){_this3.readingFields=fields})))},removeReminder:function(index){var reminderName=this.model.triggerData.reminders[index].name;
// removing notifications assigned to resources
if(this.model.triggerData.reminders.splice(index,1),"bulk"===this.model.woData.workOrderType&&this.model.woData.resourceList)for(var i=0;i<this.model.woData.resourceList.length;i++)if(this.model.woData.resourceList[i].notifications)for(var j=0;j<this.model.woData.resourceList[i].notifications.length;j++)this.model.woData.resourceList[i].notifications[j]===reminderName&&this.$delete(this.model.woData.resourceList[i].notifications,j)},addReminder:function(){this.showConfigureNotification=!1,this.editNotificationConfiguration?Object.assign(this.model.triggerData.reminders[this.reminderTemplateEdit.index],this.$helpers.cloneObject(this.reminderTemplateEdit)):this.model.triggerData.reminders.push(this.$helpers.cloneObject(this.reminderTemplateEdit))},handleactions:function(val,key){if("edit"===val)this.isEditingTrigger=!0,this.triggerEdit=Object.assign({},this.model.triggerData.triggers[key]),this.triggerEdit.initialSchedule=this.$helpers.cloneObject(this.model.triggerData.triggers[key].schedule),this.showScheduleSettings=!0;else if("delete"===val&&this.model.triggerData.triggers.length>0){var triggerName=this.model.triggerData.triggers[key].name;
// deleting triggers from resources planner
if(this.model.triggerData.triggers.splice(key,1),"bulk"===this.model.woData.workOrderType&&this.model.woData.resourceList){for(var rList=this.$helpers.cloneObject(this.model.woData.resourceList),i=0;i<rList.length;i++){var zi=rList[i].triggerNames.findIndex((function(l){return l===triggerName}));zi>-1&&(rList[i].triggerNames.splice(zi,1),0===rList[i].triggerNames.length&&rList[i].triggerNames.push("0"))}this.$set(this.model.woData,"resourceList",rList)}
// delete associated trigger in task
for(var j=0;j<this.model.taskData.taskSections.length;j++)for(var index=-1,triggers=this.$helpers.cloneObject(this.model.taskData.taskSections[j].triggers),k=0;k<triggers.length;k++)if(index=triggers.findIndex((function(n){return"All"!==n&&n.triggerName===triggerName})),index>-1){triggers.splice(index,1),0===triggers.length&&triggers.push({triggerName:"All"}),this.$set(this.model.taskData.taskSections[j],"triggers",triggers);break}}},cancelTriggerSave:function(){this.isEditingTrigger=!1,this.showScheduleSettings=!1},showEditNotificationConfiguration:function(index){this.editNotificationConfiguration=!0,this.reminderTemplateEdit={name:"",type:null,duration:null,isEmail:!1,isSms:!1,isMobile:!1,template:{email:{},mobile:{},sms:{}}},this.reminderTemplateEdit.index=index,Object.assign(this.reminderTemplateEdit,this.model.triggerData.reminders[index]),this.showConfigureNotification=!0},showAddNotificationConfiguration:function(){this.editNotificationConfiguration=!1;var count=this.model.triggerData.reminders.length;this.reminderTemplateEdit={name:"Notification ".concat(count+1),type:2,duration:3600,isEmail:!0,isSms:!1,isMobile:!0,template:{email:{},mobile:{},sms:{}}},this.showConfigureNotification=!0},showReminderTemplate:function(key){this.templateEdit={email:{toAddr:[],subject:"",message:""},mobile:{toAddr:[],subject:"",message:""},sms:{toAddr:[],message:""},key:key},this.editNotificationConfiguration?(this.model.triggerData.reminders[key].template.email&&Object.assign(this.templateEdit.email,this.model.triggerData.reminders[key].template.email),this.model.triggerData.reminders[key].template.mobile&&Object.assign(this.templateEdit.mobile,this.model.triggerData.reminders[key].template.mobile),this.model.triggerData.reminders[key].template.sms&&Object.assign(this.templateEdit.sms,this.model.triggerData.reminders[key].template.sms)):(this.reminderTemplateEdit.template.email&&Object.assign(this.templateEdit.email,this.reminderTemplateEdit.template.email),this.reminderTemplateEdit.template.mobile&&Object.assign(this.templateEdit.mobile,this.reminderTemplateEdit.template.mobile),this.reminderTemplateEdit.template.sms&&Object.assign(this.templateEdit.sms,this.reminderTemplateEdit.template.sms)),this.showReminderCustomization=!0},saveReminderTemplate:function(){Object.assign(this.reminderTemplateEdit.template.email,this.templateEdit.email),Object.assign(this.reminderTemplateEdit.template.mobile,this.templateEdit.mobile),Object.assign(this.reminderTemplateEdit.template.sms,this.templateEdit.sms),this.showReminderCustomization=!1,this.activeName="email"}},watch:{"model.woData.spacecategoryId":{handler:function(newVal,oldVal){var _this4=this;newVal!==oldVal&&newVal&&"bulk"===this.model.woData.workOrderType&&this.$util.loadSpaceReadingFields(-1,!1,Number(this.model.woData.spacecategoryId)).then((function(fields){_this4.readingFields=fields}))},deep:!0},"model.woData.assetCategoryId":{handler:function(newVal,oldVal){var _this5=this;newVal!==oldVal&&newVal&&"bulk"===this.model.woData.workOrderType&&this.$util.loadAssetReadingFields(-1,!1,Number(this.model.woData.assetCategoryId)).then((function(fields){_this5.readingFields=fields}))},deep:!0},"model.woData.resourceType":{deep:!0,handler:function(newVal,oldVal){"bulk"===this.model.woData.workOrderType&&"ALL_FLOORS"===this.model.woData.resourceType&&this.getFloorReadings()}},"model.woData.workOrderType":{deep:!0,handler:function(newVal,oldVal){this.handleSingleResource()}},"model.woData.singleResource":{deep:!0,handler:function(newVal,oldVal){this.handleSingleResource()}}},mounted:function(){this.setHourOptions()}},multisitepreventive_pmformtriggeroldvue_type_script_lang_js=pmformtriggeroldvue_type_script_lang_js,pmformtriggerold_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_pmformtriggeroldvue_type_script_lang_js,pmformtriggeroldvue_type_template_id_84af82ce_render,pmformtriggeroldvue_type_template_id_84af82ce_staticRenderFns,!1,null,null,null)
/* harmony default export */,pmformtriggerold=pmformtriggerold_component.exports,PmReviewvue_type_template_id_75b79565_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable-y100"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v("EDIT PLANNED MAINTENANCE")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("OVERVIEW")]),_c("div",{staticClass:"fc-pm-main-inner-container"},[_c("div",{staticClass:"fc-pm-task-form-table-con"},[_c("div",{staticClass:"review-wrap-block"},[_c("el-row",{staticClass:"pB15"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-red-txt14 pB5"},[_vm._v("Sites")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(""!==_vm.siteName?_vm.siteName:"")+" ")])]),"single"===_vm.model.woData.workOrderType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Space / Asset ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.woData.spaceAssetDisplayName)+" ")])]):_vm.model.woData.selectedBuilding?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v("Building")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(_vm._s(_vm.buildingName))])]):_vm._e()],1),_c("el-row",{staticClass:"pB15 pT15"},["ALL_FLOORS"===_vm.model.woData.resourceType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v("Floors")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.resourceListLength)+" Floors ")])]):_vm._e(),"SPACE_CATEGORY"===_vm.model.woData.resourceType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Space Category ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.spacecategory[_vm.model.woData.spacecategoryId])+"("+_vm._s(_vm.model.woData.resourceList.length)+") ")])]):_vm._e(),"ASSET_CATEGORY"===_vm.model.woData.resourceType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Asset Category ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.assetCategoryName)+" ("+_vm._s(_vm.model.woData.resourceList.length)+") ")])]):_vm._e()],1),_c("el-row",{staticClass:"pB15 pT15"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Task Template ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.taskData.taskSections.length)+" ")])]),_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" No of Triggers ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.triggerData.triggers.length)+" ")])])],1)],1),_vm.model.triggerData.triggers&&_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-text-pink mT50"},[_vm._v(" RESOURCE PLAN ")]):_vm._e(),_vm.model.triggerData.triggers&&_vm.model.triggerData.triggers.length?_c("div",{staticClass:"review-plan-container-scroll mT20"},_vm._l(_vm.model.woData.resourceList,(function(resource,index){return _c("el-row",{key:index,staticClass:"border-bottom2 pT10 pB10 visibility-visible-actions pointer"},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"label-txt-black pT10 pB10"},[_vm._v(" "+_vm._s(resource.name)+" ")])]),_vm.model.woData.resourceList[index].triggerNames.length?[_vm.model.woData.resourceList[index].triggerNames.length>1?[_c("el-col",{attrs:{span:4}},[_c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom"}},[_c("div",{staticClass:"fc-grey-text14 pT5 pB5 textoverflow-ellipsis"},[_vm._v(" "+_vm._s(_vm.model.woData.resourceList[index].triggerNames.length+" Triggers")+" ")]),_vm._l(_vm.model.woData.resourceList[index].triggerNames,(function(item,index){return _c("div",{key:index,attrs:{slot:"content"},slot:"content"},[_vm._v(" "+_vm._s(item)+" ")])}))],2)],1)]:"0"===_vm.model.woData.resourceList[index].triggerNames[0]?[_c("el-col",{attrs:{span:4}},[_vm.model.triggerData.isDefaultAllTriggers?_c("div",{staticClass:"fc-grey-text14 textoverflow-ellipsis pT5 pB5"},[_vm._v(" All Triggers ")]):_c("div",{staticClass:"fc-grey-text14 pT5 pB5 textoverflow-ellipsis"},[_vm._v(" "+_vm._s(""+_vm.model.triggerData.triggers[0].name)+" ")])])]:[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-grey-text14 textoverflow-ellipsis pT5 pB5"},[_vm._v(" "+_vm._s(""+_vm.model.woData.resourceList[index].triggerNames[0])+" ")])])]]:[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-grey-text14 textoverflow-ellipsis pT5 pB5"},[_vm._v(" "+_vm._s(""+_vm.model.triggerData.triggers[0].name)+" ")])])],_c("el-col",{attrs:{span:7}},[_c("user-avatar",{attrs:{size:"md",user:_vm.userObj(_vm.model.woData.resourceList[index].assignedTo),showPopover:!1,name:!0}})],1),_c("el-col",{attrs:{span:3}},[_c("div",[_c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom","popper-class":_vm.model.woData.resourceList[index].notifications.length?"element-tooltip":"hide"}},[_vm._l(_vm.templateOp(_vm.model.woData.resourceList[index].notifications),(function(item,k){return _c("div",{key:k,attrs:{slot:"content"},slot:"content"},[_vm._v(" "+_vm._s(_vm.model.woData.resourceList[index].notifications[k]+" ("+item+")")+" ")])})),_vm.model.woData.resourceList[index].notifications.length>0?_c("img",{staticClass:"mT7",attrs:{src:__webpack_require__(380789),width:"15",height:"15"}}):_c("img",{staticClass:"mT7",attrs:{src:__webpack_require__(37576),width:"15",height:"15"}})],2)],1)])],2)})),1):_vm._e()])])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save f13",attrs:{type:"primary",loading:_vm.isSaving},on:{click:_vm.triggerValidation}},[_vm._v("CONFIRM")])],1)])])])},PmReviewvue_type_template_id_75b79565_staticRenderFns=[],defineProperty=__webpack_require__(482482),User=__webpack_require__(426803),picklist=__webpack_require__(961358),PmReviewvue_type_script_lang_js={props:["model","formObj","users","groups"],mixins:[PMMixin/* default */.Z],components:{UserAvatar:User/* default */.Z},created:function(){this.$store.dispatch("loadRoles"),this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadBuildings")},data:function(){return{isSaving:!1,siteOptions:[],reminderType:[{label:"Before Execution",value:1},{label:"After Execution",value:2},{label:"Before Due",value:3},{label:"After Due",value:4}],config:{email:{type:1,
// Template type
actionType:3,label:"Send Email Action",name:"New WorkOrder Email Template"},sms:{type:2,
// Template type
actionType:4,label:"Send SMS Action",name:"New WorkOrder SMS Template"},mobile:{type:8,
// Template type
actionType:7,label:"Send Mobile Notification",name:"New WorkOrder Push Notification Template"},web:{type:9,
// Template type
label:"Send Web Notification",name:"New WorkOrder Push Notification Template"}}}},mounted:function(){this.loadPickList("site",this.siteOptions)},methods:{generateReminderOptions:function(){var options=[];options.push({label:"30 Min",value:1800});for(var i=1;i<24;i++)options.push({label:i+(1===i?" Hour":" Hours"),value:3600*i});for(var _i=1;_i<32;_i++)options.push({label:_i+(1===_i?" Day":" Days"),value:24*_i*3600});return options},templateOp:function(notifications){var _this=this,options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),notifications.forEach((function(notification,i){var n=_this.model.triggerData.reminders.find((function(k){return k.name===notification}));options.push("".concat(timeLookup[n.duration]," ").concat(typeLookup[n.type]))})),options},loadPickList:function(moduleName,options){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$getFieldOption,error,picklistOptions;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(!moduleName){_context.next=7;break}return _context.next=3,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:moduleName}});case 3:_yield$getFieldOption=_context.sent,error=_yield$getFieldOption.error,picklistOptions=_yield$getFieldOption.options,error?_this2.$message.error(error.message||"Error Occured"):_this2.siteOptions=picklistOptions;case 7:case"end":return _context.stop()}}),_callee)})))()},moveToPrevious:function(){this.$emit("previous")},userObj:function(userId){userId=userId&&userId>-1?userId:this.model.triggerData.defaultAssignedTo;var userObj=null;return userId&&userId>0&&(userObj=this.userList.find((function(i){return i.ouid===userId})),userObj||(userObj={name:""})),userObj},triggerValidation:function(){this.model.emitForm=!0},sendClientErrorLog:function(error){if(!(0,validation/* isEmpty */.xb)(error)){var $account=this.$account,_ref=$account||{},user=_ref.user,data={userId:user.ouid,orgId:user.orgId,route:this.$router.name,message:error.message,stacktrace:error.stack||"",browser:"browser",os:"os",ceType:"client: PMReview.vue",ceInfo:null,ceUa:null};this.$http.post("/v2/errors/web",data).catch((function(){setTimeout((function(){}),6e4);//delays logging by 1min if api call fails
}))}},validated:function(){try{this.save()}catch(error){this.$message.error(this.$t("maintenance.old_pm.something_went_wrong_while_saving_the_record")),this.isSaving=!1,this.sendClientErrorLog(error)}},failed:function(){this.isSaving=!1},save:function(){var _this3=this;if(this.isSaving=!0,this.model.emitForm=!1,!this.model.woData.sites||0===this.model.woData.sites.length)return this.$message({message:"Site is mandatory",type:"error"}),void(this.isSaving=!1);var _ref2=this.formObj||{},fields=_ref2.fields,durationFields=[];// For handling Custom Duration fields
(0,validation/* isEmpty */.xb)(fields)||fields.forEach((function(field_){var _ref3=field_||{},field=_ref3.field;(0,validation/* isEmpty */.xb)(field)||"DURATION"===field.displayType&&"NUMBER"===field.dataTypeEnum&&durationFields.push(field.name)}));var workorder=this.$helpers.cloneObject(this.model.woData.woModel);Object.assign(workorder,workorder.woModel),workorder.isSignatureRequired=this.model.woData.isSignatureRequired;var uploadFiles=[];if(this.model.woData.woModel.ticketattachments){for(var i=0;i<this.model.woData.woModel.attachedFiles.uploadFiles.length;i++)
/* 
            since attachments gets added in `this.model.woData.woModel.ticketattachments`, 
            it never comes here, this for-loop can be removed if not required later.
          */
uploadFiles.push(new File([this.model.woData.woModel.attachedFiles.uploadFiles[i]],this.model.woData.woModel.attachedFiles.uploadFiles[i].name));this.model.woData.woModel.ticketattachments&&(workorder.attachments=this.model.woData.woModel.ticketattachments.filter((function(u){return u.fileId>0}))),delete workorder.attachedFiles}delete workorder.woModel,workorder.resource=this.model.woData.singleResource,workorder.resource&&!workorder.resource.id&&delete workorder.resource,workorder.category&&!workorder.category.id&&delete workorder.category,workorder.type&&!workorder.type.id&&delete workorder.type,workorder.priority&&!workorder.priority.id&&delete workorder.priority,workorder.assignmentGroup=workorder.groups,workorder.assignmentGroup&&(workorder.assignmentGroup.id?workorder.assignmentGroup={id:workorder.assignmentGroup.id}:delete workorder.assignmentGroup),this.model.triggerData.defaultAssignedTo&&(workorder.assignedTo={id:this.model.triggerData.defaultAssignedTo}),workorder.photoMandatory=this.model.preRequestData.photoMandatory,workorder.allowNegativePreRequisite=this.model.preRequestData.allowNegativePreRequisite,-1===workorder.allowNegativePreRequisite&&(workorder.allowNegativePreRequisite=2);var formdata={};formdata.workorder=workorder,workorder.duration&&(workorder.duration=this.$util.daysHoursToUnixTime(workorder.duration)||-1),workorder.estimatedWorkDuration&&(workorder.estimatedWorkDuration=this.$util.daysHoursToUnixTime(workorder.estimatedWorkDuration)||-1),(0,validation/* isEmpty */.xb)(durationFields)||durationFields.forEach((function(name){_this3.$getProperty(workorder,"".concat(name))&&(workorder["".concat(name)]=_this3.$util.daysHoursToUnixTime(workorder["".concat(name)])||-1)})),formdata.deleteReadingRulesList=[];var preRequestsections=[],preRequestsequence=1;for(var key in this.model.preRequestData.preRequestSections){var section=this.$helpers.cloneObject(this.model.preRequestData.preRequestSections[key]);if(delete section.assignmentType,section.enableInput=!0,section.inputType="6","6"===section.inputType){var secOptions=[];for(var key3 in section.options||(section.options=[],section.options.push({name:section.additionInfo.truevalue}),section.options.push({name:section.additionInfo.falsevalue})),section.options){var option=section.options[key3];option&&option.name&&(secOptions[key3]=option.name)}section.options=secOptions}else section.options=[];for(var key2 in section.taskTemplates=this.$helpers.cloneObject(section.preRequests),delete section.preRequests,section.taskTemplates){var task=section.taskTemplates[key2],errorMsg=this.validatePreRequest(task);if(errorMsg)return this.$message({message:errorMsg,type:"error"}),void(this.isSaving=!1);if(task.enableInput=!0,task.inputType="6","6"===task.inputType){var taskOptions=[];for(var _key in task.options||(task.options=[],task.options.push({name:task.additionInfo.truevalue}),task.options.push({name:task.additionInfo.falsevalue})),task.options){var _option=task.options[_key];_option&&_option.name&&(taskOptions[_key]=_option.name)}task.options=taskOptions}else task.options=[];task.readingFieldId||(task.readingFieldId=-1),task.sequence=preRequestsequence,preRequestsequence+=1}preRequestsections.push(section)}if(formdata.preRequests=preRequestsections,3===this.model.preRequestData.allowNegativePreRequisite){var approvers=[],approverKeys={1:"userId",2:"roleId",3:"groupId"};this.model.preRequestData.approvers.forEach((function(approver){var _approvers$push;approver.sharingType&&approver.approversId&&approvers.push((_approvers$push={},(0,defineProperty/* default */.Z)(_approvers$push,approverKeys[approver.sharingType],approver.approversId),(0,defineProperty/* default */.Z)(_approvers$push,"sharingType",approver.sharingType),(0,defineProperty/* default */.Z)(_approvers$push,"actions",approver.actions),_approvers$push))})),this.model.preRequestData.approvers=approvers}else delete this.model.preRequestData.approvers;formdata.prerequisiteApprover=this.model.preRequestData.approvers;
// prerequisite end
var _ret,sections=[],sequence=1,uniqueId=1,sectionSequence=1,isSingleWoAssetType="single"===this.model.woData.workOrderType&&"ASSET"===this.model.woData.singleResource.resourceTypeEnum,_loop=function(){var _formdata$deleteReadi,section=_this3.$helpers.cloneObject(_this3.model.taskData.taskSections[_key2]);if(section.pmIncludeExcludeResourceContexts=[],section.selectedResourceList.forEach((function(x){section.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:2})})),delete section.selectedResourceList,section.pmTaskSectionTemplateTriggers=[],section.triggers.forEach((function(x,index){"All"!==x.triggerName&&(x.executeIfNotInTime=0===index?-1:24*x.executeIfNotInTime*60*60,section.pmTaskSectionTemplateTriggers.push(x))})),delete section.triggers,section.category&&section.category.length&&("CURRENT_FLOOR"===section.category[0]||"CURRENT_ASSET"===section.category[0]||"CURRENT_SPACE"===section.category[0]||"CURRENT_BUILDING"===section.category[0]||"ALL_SITES"===section.category[0]?section.assignmentType=5:"space"===section.category[0]?(section.assignmentType=3,section.spaceCategoryId=section.category[1]):"asset"===section.category[0]&&(section.assignmentType=4,section.assetCategoryId=section.category[1])),isSingleWoAssetType&&(section.assignmentType=-1,section.assetCategoryId=-1),"5"===section.inputType||"6"===section.inputType){var _secOptions=[];for(var _key3 in section.options){var _option2=section.options[_key3];_option2&&_option2.name&&(_secOptions[_key3]=_option2.name)}section.options=_secOptions}else section.options=[];var sectionRules=_this3.constructReadingRules(section);section.readingRules=sectionRules.readingRules,section.actionsList=sectionRules.actionsList,(_formdata$deleteReadi=formdata.deleteReadingRulesList).push.apply(_formdata$deleteReadi,(0,toConsumableArray/* default */.Z)(sectionRules.deleteReadingRulesList)),section.taskTemplates=_this3.$helpers.cloneObject(section.tasks),delete section.tasks;var _ret2,_loop3=function(){var _formdata$deleteReadi2,task=section.taskTemplates[_key4];task.pmIncludeExcludeResourceContexts=[],task.selectedResourceList.forEach((function(x){task.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:3})})),delete task.selectedResourceList,delete task.readingFields,task.category&&task.category.length&&("CURRENT_FLOOR"===task.category[0]||"CURRENT_ASSET"===task.category[0]||"CURRENT_SPACE"===task.category[0]||"CURRENT_BUILDING"===task.category[0]||"ALL_SITES"==task.category[0]?task.assignmentType=5:"space"===task.category[0]?(task.assignmentType=3,task.spaceCategoryId=task.category[1]):"asset"===task.category[0]&&(task.assignmentType=4,task.assetCategoryId=task.category[1])),isSingleWoAssetType&&(task.assignmentType=-1,task.assetCategoryId=-1);var errorMsg=_this3.validateTask(task);if(errorMsg)return _this3.$message({message:errorMsg,type:"error"}),_this3.isSaving=!1,{v:{v:void 0}};if("5"===task.inputType||"6"===task.inputType){var _taskOptions=[];for(var _key5 in task.options){var _option3=task.options[_key5];_option3&&_option3.name&&(_taskOptions[_key5]=_option3.name)}task.options=_taskOptions}else task.options=[];var taskRules=_this3.constructReadingRules(task);task.readingRules=taskRules.readingRules,(_formdata$deleteReadi2=formdata.deleteReadingRulesList).push.apply(_formdata$deleteReadi2,(0,toConsumableArray/* default */.Z)(taskRules.deleteReadingRulesList)),task.readingFieldId||(task.readingFieldId=-1),task.sequence=sequence,_this3.$set(task.additionInfo,"uniqueId",uniqueId++),sequence+=1};for(var _key4 in section.taskTemplates)if(_ret2=_loop3(),_ret2)return _ret2.v;section=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},section),{},{sequenceNumber:sectionSequence++}),sections.push(section)};for(var _key2 in this.model.taskData.taskSections)if(_ret=_loop(),_ret)return _ret.v;formdata.tasks=sections;var preventiveFormData={};if(preventiveFormData.title=formdata.workorder.subject,preventiveFormData.triggers=[],preventiveFormData.preventOnNoTask=this.model.woData.isPreventOnNoTask,this.model.woData.isOffsetWOCreation){var offset=24*this.model.woData.offsetDays*60*60+60*this.model.woData.offsetHours*60;preventiveFormData.woCreationOffset=offset,formdata.workorder.woCreationOffset=offset}else preventiveFormData.woCreationOffset=0,formdata.workorder.woCreationOffset=0;formdata.workorder.sendForApproval=this.model.woData.sendForApproval,formdata.workorder.workPermitNeeded=this.model.woData.workPermitNeeded,preventiveFormData.markIgnoredWo=this.model.woData.markIgnoredWo,preventiveFormData.pmCreationType=3,preventiveFormData.siteIds=this.model.woData.sites,preventiveFormData.baseSpaceId=this.model.woData.selectedBuilding||this.getSelectedSiteId()||-1,preventiveFormData.pmIncludeExcludeResourceContexts=[],"ALL_FLOORS"===this.model.woData.resourceType?(preventiveFormData.assignmentType=1,this.model.woData.selectedFloorList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))):"SPACE_CATEGORY"===this.model.woData.resourceType?(preventiveFormData.assignmentType=3,preventiveFormData.spaceCategoryId=this.model.woData.spacecategoryId,this.model.woData.selectedSpaceList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))):"BUILDINGS"===this.model.woData.resourceType?(preventiveFormData.assignmentType=7,this.model.woData.selectedBuildingList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x,isInclude:!0,parentType:1})}))):"ASSET_CATEGORY"===this.model.woData.resourceType?(preventiveFormData.assignmentType=4,preventiveFormData.assetCategoryId=this.model.woData.assetCategoryId,this.model.woData.selectedResourceList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))):"ALL_SITES"===this.model.woData.resourceType&&(
// set assignmentType & pmIncludeExcludeResourceContexts in preventiveFormData
preventiveFormData.assignmentType=8,this.model.woData.selectedResourceList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))),preventiveFormData.resourcePlanners=[],this.model.woData.resourceList.forEach((function(resource){var triggerContexts,noti=[];if(resource.triggerNames.length)if(1===resource.triggerNames.length&&"0"===resource.triggerNames[0])resource.triggerNames=[];else{var index=resource.triggerNames.findIndex((function(i){return"0"===i}));index>=0&&_this3.model.triggerData.triggers.length&&resource.triggerNames.splice(index,1,_this3.model.triggerData.triggers[0].name)}(resource.notifications.forEach((function(n){noti.push({reminderName:n})})),noti.length||resource.triggerNames.length||resource.assignedTo&&resource.assignedTo>-1)&&(resource.triggerNames.length?triggerContexts=resource.triggerNames.map((function(i){return{name:i}})):_this3.model.triggerData.triggers.length&&(triggerContexts=[{name:_this3.model.triggerData.triggers[0].name}]),preventiveFormData.resourcePlanners.push({assignedToId:resource.assignedTo||_this3.model.triggerData.defaultAssignedTo,resourceId:resource.id,pmResourcePlannerReminderContexts:noti,triggerContexts:triggerContexts}))}));var reminders=[];for(var x in preventiveFormData.triggers=[],this.model.triggerData.triggers){var trigger=Object.assign({},this.model.triggerData.triggers[x]);if(trigger.triggerType="0"===x?1:2,trigger.schedule&&(trigger.custom=trigger.schedule.custom),1===trigger.type)trigger.triggerExecutionSource=1,trigger.stopAfter,trigger.endTime=-1,
// TODO - check the need ?
// trigger.frequency = trigger.schedule.facilioFrequency
// if (trigger.frequency.length > 1) {
//  preventiveFormData.frequency = 8
// }
// else {
//  preventiveFormData.frequency = trigger.schedule.facilioFrequency
// }
// preventiveFormData.custom = trigger.schedule.custom
delete trigger.sharingContext;else if(2===trigger.type)trigger.triggerExecutionSource=2,trigger.startTime=-1,trigger.endTime=-1,"never"===trigger.stopAfterReading&&(trigger.endReading=-1),delete trigger.sharingContext;else if(3===trigger.type)trigger.startTime=-1,trigger.endTime=-1,trigger.triggerExecutionSource=3,trigger.workFlowRule={criteria:this.$helpers.cloneObject(trigger.criteria)},trigger.workFlowRule.criteria&&delete trigger.workFlowRule.criteria.regEx,delete trigger.sharingContext,delete trigger.criteria;else if(4===trigger.type){var userTrigger={name:trigger.name,type:trigger.type,sharingContext:this.constructSharingContext(trigger.sharingContext),triggerExecutionSource:4};trigger=userTrigger}else if(5==trigger.type){var customTrigger={name:trigger.name,type:trigger.type,triggerExecutionSource:5,executeOn:trigger.customTrigger.executeOn,executionOffset:trigger.customTrigger.hours+60*trigger.customTrigger.days*60*24,customModuleId:trigger.customTrigger.customModuleId,fieldId:trigger.customTrigger.fieldId};trigger=customTrigger,delete trigger.sharingContext,delete trigger.criteria}delete trigger.initialSchedule,preventiveFormData.triggers.push(trigger)}var templates=["email","sms","mobile"];if(this.model.triggerData.reminders&&this.model.triggerData.reminders.length)for(var _loop2=function(){var reminder=_this3.$helpers.cloneObject(_this3.model.triggerData.reminders[_i2]);reminder.template&&templates.forEach((function(t){var mode="email"===t?"mail":t;if(reminder.template[t].toAddr&&reminder.template[t].toAddr.length){var _data={type:_this3.config[t].type,message:reminder.template[t].message,name:_this3.config[t].name,workflow:{}};_this3.$common.setUserMailWorkflow(reminder.template[t].toAddr,_data,mode),_this3.$common.setExpressionFromPlaceHolder(_data.workflow,reminder.template[t].message),"mail"!==t&&"mobile"!==t||(_data.subject=reminder.template[t].subject,_this3.$common.setExpressionFromPlaceHolder(_data.workflow,reminder.template[t].subject)),"sms"===t&&(_data.body=reminder.template[t].subject),reminder["".concat(t,"template")]={actionType:_this3.config[t].actionType,templateJson:_data}}})),reminder.template&&delete reminder.template,reminders.push(reminder)},_i2=0;_i2<this.model.triggerData.reminders.length;_i2++)_loop2();formdata.preventivemaintenance=preventiveFormData,formdata.reminders=[];for(var idx=0;idx<reminders.length;idx++)-1!==reminders[idx].duration&&formdata.reminders.push(reminders[idx]);var _ref4=formdata||{},woData=_ref4.workorder,_ref5=woData||{},data=_ref5.data;woData=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},woData),data),delete woData.data,formdata=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formdata),{},{workorder:woData}),this.model.isEdit?this.updatePreventiveMaintenance(formdata,uploadFiles):this.savePreventiveMaintenance(formdata,uploadFiles)},constructReadingRules:function(obj){var readingRules=[],actionsList=[],deleteReadingRulesList=[];return"4"===obj.inputType&&("none"===obj.validation?obj.inputValidationRuleId&&-1!==obj.inputValidationRuleId&&deleteReadingRulesList.push(obj.inputValidationRuleId):"incremental"===obj.validation||"decremental"===obj.validation?readingRules.push({id:obj.inputValidationRuleId||-1,name:"incremental"===obj.validation?"Incremental":"Decremental",ruleType:9,event:{activityType:1},thresholdType:5,workflow:{expressions:[{name:"a",constant:"${inputValue}"},{name:"b",constant:"${previousValue}"}],parameters:[{name:"inputValue",typeString:"Number"},{name:"previousValue",typeString:"Number"}],resultEvaluator:"incremental"===obj.validation?"(b!=-1)&&(a<b)":"(b!=-1)&&(a>b)"}}):"safeLimit"===obj.validation&&("undefined"!==typeof obj.minSafeLimit&&null!=obj.minSafeLimit||"undefined"!==typeof obj.maxSafeLimit&&null!=obj.maxSafeLimit)&&readingRules.push({id:obj.inputValidationRuleId||-1,name:"Safelimit",ruleType:9,event:{activityType:1},thresholdType:5,workflow:{expressions:[{name:"a",constant:"${inputValue}"},{name:"b",constant:null===obj.minSafeLimit?-1:obj.minSafeLimit},{name:"c",constant:null===obj.maxSafeLimit?-1:obj.maxSafeLimit}],parameters:[{name:"inputValue",typeString:"Number"}],resultEvaluator:"(b!=-1&&a<b)||(c!=-1&&a>c)"}})),{readingRules:readingRules,actionsList:actionsList,deleteReadingRulesList:deleteReadingRulesList}},constructSharingContext:function(sharing){var sharingContext=[];if(1===sharing.shareTo)sharingContext.push({type:1,userId:this.getCurrentUser().ouid});else if(3===sharing.shareTo){if(sharing.sharedUsers.length>0){sharingContext.push({type:1,userId:this.getCurrentUser().ouid});for(var i=0;i<sharing.sharedUsers.length;i++)sharing.sharedUsers[i]!==this.getCurrentUser().ouid&&sharingContext.push({type:1,userId:sharing.sharedUsers[i]})}if(sharing.sharedRoles.length>0)for(var _i3=0;_i3<sharing.sharedRoles.length;_i3++)sharingContext.push({type:2,roleId:sharing.sharedRoles[_i3]});if(sharing.sharedGroups.length>0)for(var _i4=0;_i4<sharing.sharedGroups.length;_i4++)sharingContext.push({type:3,groupId:sharing.sharedGroups[_i4]})}return sharingContext},updatePreventiveMaintenance:function(data,uploadFiles){var _this4=this,formData=new FormData;if(formData.append("workOrderString",JSON.stringify(data.workorder)),formData.append("preventiveMaintenanceString",JSON.stringify(data.preventivemaintenance)),formData.append("tasksString",JSON.stringify(data.tasks)),formData.append("preRequestsString",JSON.stringify(data.preRequests)),formData.append("prerequisiteApproverString",JSON.stringify(data.prerequisiteApprover)),data.reminders&&formData.append("reminderString",JSON.stringify(data.reminders)),formData.append("deleteReadingRulesListString",JSON.stringify(data.deleteReadingRulesList)),uploadFiles)for(var num=0;num<uploadFiles.length;num++)formData.append("attachedFiles",uploadFiles[num]);var id=parseInt(this.$route.query.edit||this.$route.params.id);this.$http.post("/workorder/updateNewPreventiveMaintenance?id="+id,formData).then((function(response){"object"===(0,esm_typeof/* default */.Z)(response.data)?(_this4.$message({message:"Planned maintenance updated successfully!",type:"success"}),_this4.$emit("edited")):(_this4.$message({message:"Planned maintenance updation failed!",type:"error"}),_this4.isSaving=!1)})).catch((function(error){var _error$data;_this4.$message.error((null===error||void 0===error||null===(_error$data=error.data)||void 0===_error$data?void 0:_error$data.message)||"Failed to edit Planned maintenance!"),_this4.isSaving=!1}))},savePreventiveMaintenance:function(data,uploadFiles){var formData=new FormData,error=this.validationPM(data);if(error)return this.$message.error(error),void(this.isSaving=!1);if(formData.append("workOrderString",JSON.stringify(data.workorder)),formData.append("preventiveMaintenanceString",JSON.stringify(data.preventivemaintenance)),formData.append("tasksString",JSON.stringify(data.tasks)),formData.append("preRequestsString",JSON.stringify(data.preRequests)),formData.append("prerequisiteApproverString",JSON.stringify(data.prerequisiteApprover)),uploadFiles)for(var num=0;num<uploadFiles.length;num++)formData.append("attachedFiles",uploadFiles[num]);data.reminders&&formData.append("reminderString",JSON.stringify(data.reminders));var saveurl="/workorder/addNewPreventiveMaintenance",self=this;self.$http.post(saveurl,formData).then((function(response){"object"===(0,esm_typeof/* default */.Z)(response.data)?(self.$message({message:"Planned maintenance created successfully!",type:"success"}),self.isSaving=!1,self.$emit("saved")):(self.$message({message:"Planned maintenance creation failed!",type:"error"}),self.isSaving=!1)})).catch((function(_){self.$message({message:"Planned maintenance creation failed!",type:"error"}),self.isSaving=!1}))},validationPM:function(data){var errorMsg="";if(!data.workorder.subject)return errorMsg+="Please enter the PPM subject \n",errorMsg;if(data.preventivemaintenance.triggers.length>0)for(var keys in data.preventivemaintenance.triggers){var ds=data.preventivemaintenance.triggers[keys];if(2===parseInt(ds.type)){if(!ds.readingFieldId||ds.readingFieldId<1)return errorMsg+="Please select the specific reading type for this trigger \n",errorMsg;if(!ds.readingInterval||ds.readingFieldId<0)return errorMsg+="Please specify the reading interval \n",errorMsg;if(!ds.startReading||ds.startReading<0)return errorMsg+="Please specify the reading start value \n",errorMsg}else parseInt(ds.type)}},validateTask:function(task){var errorMsg="";return task.name||(errorMsg+="Please specify the task subject \n"),task.enableInput&&(2===parseInt(task.inputType)?(parseInt(task.readingFieldId)<1||!task.readingFieldId)&&(errorMsg+="Please select a specific reading type \n"):4===parseInt(task.inputType)?"safeLimit"===task.validation&&(task.minSafeLimit||task.maxSafeLimit||(errorMsg+="Please enter either minimum or maximum value \n")):5===parseInt(task.inputType)&&(task.options.length<2?errorMsg+="Please enter atleast two options\n":task.options[0].name||task.options[1].name||(errorMsg+="Please enter atleast two options \n"))),errorMsg},getSelectedSiteId:function(){
// return siteId only if one site is selected or else return null
// this condition applies when category is selected as SPACE/ASSET Category.
return 1==this.model.woData.sites.length?this.model.woData.sites[0]:null}},watch:{"model.woData.resourceList":{handler:function(newValue){this.$forceUpdate()},deep:!0}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetcategory:function(state){return state.assetCategory}
// groups: state => state.groups,
// users: state => state.users,
})),(0,vuex_esm/* mapGetters */.Se)(["getSpaceCategoryPickList","getCurrentUser"])),{},{spacecategory:function(){return this.getSpaceCategoryPickList()},resourceListLength:function(){return this.model.woData.resourceList?this.model.woData.resourceList.length:0},userList:function(){var _this5=this;if(this.model.woData.woModel.groups&&this.model.woData.woModel.groups.id){var group=this.groups.find((function(group){return group.id===Number(_this5.model.woData.woModel.groups.id)}));return(0,validation/* isEmpty */.xb)(group)?[]:group.members}return this.users},siteName:function(){if(this.model.woData.sites&&this.model.woData.sites.length>0&&this.siteOptions){for(var label,siteLabels=[],i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.siteOptions.length;j++)if(Number(this.siteOptions[j].value)===this.model.woData.sites[i]){siteLabels.push(this.siteOptions[j].label);break}if(siteLabels.length>0){label=siteLabels[0];for(var k=1;k<siteLabels.length;k++)label=label+","+siteLabels[k]}return label}return""},assetCategoryName:function(){var _this6=this,category=this.assetcategory.find((function(i){return i.id===Number(_this6.model.woData.assetCategoryId)}));return category?category.name:""},buildingList:function(){var buildings=[];if(this.$store.getters.getBuildings&&this.model.woData.sites)for(var i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.$store.getters.getBuildings.length;j++)this.$store.getters.getBuildings[j].siteId===this.model.woData.sites[i]&&buildings.push(this.$store.getters.getBuildings[j]);return buildings},buildingName:function(){var _this7=this,building=this.buildingList.find((function(i){return i.id===_this7.model.woData.selectedBuilding}));return building?building.name:""},templateOptions:function(){var options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),this.model.triggerData.reminders.forEach((function(reminder,i){options.push({label:"".concat(timeLookup[reminder.duration]," ").concat(typeLookup[reminder.type]),value:i})})),options}})},multisitepreventive_PmReviewvue_type_script_lang_js=PmReviewvue_type_script_lang_js,PmReview_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_PmReviewvue_type_script_lang_js,PmReviewvue_type_template_id_75b79565_render,PmReviewvue_type_template_id_75b79565_staticRenderFns,!1,null,null,null)
/* harmony default export */,PmReview=PmReview_component.exports,OldPmReviewvue_type_template_id_74a14666_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable-y100"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v("EDIT PLANNED MAINTENANCE")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_c("div",{staticClass:"fc-text-pink"},[_vm._v("OVERVIEW")]),_c("div",{staticClass:"fc-pm-main-inner-container"},[_c("div",{staticClass:"fc-pm-task-form-table-con"},[_c("div",{staticClass:"review-wrap-block"},[_c("el-row",{staticClass:"pB15"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-red-txt14 pB5"},[_vm._v("Site")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(_vm._s(_vm.siteName))])]),"single"===_vm.model.woData.workOrderType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Space / Asset ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.woData.spaceAssetDisplayName)+" ")])]):_vm.model.woData.selectedBuilding?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v("Building")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(_vm._s(_vm.buildingName))])]):_vm._e()],1),_c("el-row",{staticClass:"pB15 pT15"},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v("PM Type")]),"bulk"===_vm.model.woData.workOrderType?_c("div",{staticClass:"label-txt-black"},[_vm._v(" Multiple Workorders ")]):_vm._e(),"single"===_vm.model.woData.workOrderType?_c("div",{staticClass:"label-txt-black"},[_vm._v(" Single Workorder ")]):_vm._e()]),"bulk"===_vm.model.woData.workOrderType&&"ALL_FLOORS"===_vm.model.woData.resourceType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v("Floors")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.resourceListLength)+" Floors ")])]):_vm._e(),"bulk"===_vm.model.woData.workOrderType&&"SPACE_CATEGORY"===_vm.model.woData.resourceType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Space Category ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.spacecategory[_vm.model.woData.spacecategoryId])+"("+_vm._s(_vm.model.woData.resourceList.length)+") ")])]):_vm._e(),"bulk"===_vm.model.woData.workOrderType&&"ASSET_CATEGORY"===_vm.model.woData.resourceType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Asset Category ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.assetCategoryName)+" ("+_vm._s(_vm.model.woData.resourceList.length)+") ")])]):_vm._e(),"single"===_vm.model.woData.workOrderType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Task Template ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.taskData.taskSections.length)+" ")])]):_vm._e()],1),_c("el-row",{staticClass:"pB15 pT15"},["bulk"===_vm.model.woData.workOrderType?_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" Task Template ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.taskData.taskSections.length)+" ")])]):_vm._e(),_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"pB5 fc-summary-content-header"},[_vm._v(" No of Triggers ")]),_c("div",{staticClass:"label-txt-black"},[_vm._v(" "+_vm._s(_vm.model.triggerData.triggers.length)+" ")])])],1)],1),"single"===_vm.model.woData.workOrderType&&_vm.model.triggerData.reminders.length?_c("div",{staticClass:"fc-text-pink mT50"},[_vm._v(" NOTIFICATIONS ")]):_vm._e(),"single"===_vm.model.woData.workOrderType&&_vm.model.triggerData.reminders.length?_c("div",{staticClass:"mB30"},_vm._l(_vm.model.triggerData.reminders,(function(reminder,key){return _c("el-row",{key:key,staticClass:"pm-form-notifications-row visibility-visible-actions border-bottom2"},[_c("el-col",{staticClass:"pT5 pB5",attrs:{span:9}},[_vm._v(_vm._s(_vm.model.triggerData.reminders[key].name))]),_c("el-col",{staticClass:"pT5 pB5",attrs:{span:6}},[_vm._v(_vm._s(_vm.templateOptions[key].label))]),_c("el-col",{staticClass:"fc-tag fc-tag-pm",attrs:{span:6}},[_vm.model.triggerData.reminders[key].isEmail?_c("el-tag",[_vm._v("Email")]):_vm._e(),_vm.model.triggerData.reminders[key].isMobile?_c("el-tag",[_vm._v("Mobile")]):_vm._e(),_vm.model.triggerData.reminders[key].isSms?_c("el-tag",[_vm._v("SMS")]):_vm._e()],1)],1)})),1):_vm._e(),"bulk"===_vm.model.woData.workOrderType&&_vm.model.triggerData.triggers&&_vm.model.triggerData.triggers.length?_c("div",{staticClass:"fc-text-pink mT50"},[_vm._v(" RESOURCE PLAN ")]):_vm._e(),"bulk"===_vm.model.woData.workOrderType&&_vm.model.triggerData.triggers&&_vm.model.triggerData.triggers.length?_c("div",{staticClass:"review-plan-container-scroll mT20"},_vm._l(_vm.model.woData.resourceList,(function(resource,index){return _c("el-row",{key:index,staticClass:"border-bottom2 pT10 pB10 visibility-visible-actions pointer"},[_c("el-col",{attrs:{span:10}},[_c("div",{staticClass:"label-txt-black pT10 pB10"},[_vm._v(" "+_vm._s(resource.name)+" ")])]),_vm.model.woData.resourceList[index].triggerNames.length?[_vm.model.woData.resourceList[index].triggerNames.length>1?[_c("el-col",{attrs:{span:4}},[_c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom"}},[_c("div",{staticClass:"fc-grey-text14 pT5 pB5"},[_vm._v(" "+_vm._s(_vm.model.woData.resourceList[index].triggerNames.length+" Triggers")+" ")]),_vm._l(_vm.model.woData.resourceList[index].triggerNames,(function(item,index){return _c("div",{key:index,attrs:{slot:"content"},slot:"content"},[_vm._v(" "+_vm._s(item)+" ")])}))],2)],1)]:"0"===_vm.model.woData.resourceList[index].triggerNames[0]?[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-grey-text14 pT5 pB5"},[_vm._v(" "+_vm._s(""+_vm.model.triggerData.triggers[0].name)+" ")])])]:[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-grey-text14 pT5 pB5"},[_vm._v(" "+_vm._s(""+_vm.model.woData.resourceList[index].triggerNames[0])+" ")])])]]:[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-grey-text14 pT5 pB5"},[_vm._v(" "+_vm._s(""+_vm.model.triggerData.triggers[0].name)+" ")])])],_c("el-col",{attrs:{span:7}},[_c("user-avatar",{attrs:{size:"md",user:_vm.userObj(_vm.model.woData.resourceList[index].assignedTo),showPopover:!1,name:!0}})],1),_c("el-col",{attrs:{span:3}},[_c("div",[_c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom","popper-class":_vm.model.woData.resourceList[index].notifications.length?"element-tooltip":"hide"}},[_vm._l(_vm.templateOp(_vm.model.woData.resourceList[index].notifications),(function(item,k){return _c("div",{key:k,attrs:{slot:"content"},slot:"content"},[_vm._v(" "+_vm._s(_vm.model.woData.resourceList[index].notifications[k]+" ("+item+")")+" ")])})),_vm.model.woData.resourceList[index].notifications.length>0?_c("img",{staticClass:"mT7",attrs:{src:__webpack_require__(380789),width:"15",height:"15"}}):_c("img",{staticClass:"mT7",attrs:{src:__webpack_require__(37576),width:"15",height:"15"}})],2)],1)])],2)})),1):_vm._e()])])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save f13",attrs:{type:"primary",loading:_vm.isSaving},on:{click:_vm.triggerValidation}},[_vm._v("CONFIRM")])],1)])])])},OldPmReviewvue_type_template_id_74a14666_staticRenderFns=[],OldPmReviewvue_type_script_lang_js={props:["model","users","groups"],mixins:[PMMixin/* default */.Z],components:{UserAvatar:User/* default */.Z},data:function(){return{isSaving:!1,siteOptions:[],reminderType:[{label:"Before Execution",value:1},{label:"After Execution",value:2},{label:"Before Due",value:3},{label:"After Due",value:4}],config:{email:{type:1,
// Template type
actionType:3,label:"Send Email Action",name:"New WorkOrder Email Template"},sms:{type:2,
// Template type
actionType:4,label:"Send SMS Action",name:"New WorkOrder SMS Template"},mobile:{type:8,
// Template type
actionType:7,label:"Send Mobile Notification",name:"New WorkOrder Push Notification Template"},web:{type:9,
// Template type
label:"Send Web Notification",name:"New WorkOrder Push Notification Template"}}}},mounted:function(){this.loadPickList("site",this.siteOptions)},created:function(){this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadBuildings")},methods:{generateReminderOptions:function(){var options=[];options.push({label:"30 Min",value:1800});for(var i=1;i<24;i++)options.push({label:i+(1===i?" Hour":" Hours"),value:3600*i});for(var _i=1;_i<32;_i++)options.push({label:_i+(1===_i?" Day":" Days"),value:24*_i*3600});return options},templateOp:function(notifications){var _this=this,options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),notifications.forEach((function(notification,i){var n=_this.model.triggerData.reminders.find((function(k){return k.name===notification}));options.push("".concat(timeLookup[n.duration]," ").concat(typeLookup[n.type]))})),options},loadPickList:function(moduleName,options){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$getFieldOption,error,picklistOptions;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:moduleName}});case 2:_yield$getFieldOption=_context.sent,error=_yield$getFieldOption.error,picklistOptions=_yield$getFieldOption.options,error?_this2.$message.error(error.message||"Error Occured"):_this2.siteOptions=picklistOptions;case 6:case"end":return _context.stop()}}),_callee)})))()},moveToPrevious:function(){this.$emit("previous")},userObj:function(userId){userId=userId&&userId>-1?userId:this.model.triggerData.defaultAssignedTo;var userObj=null;return userId&&userId>0&&(userObj=this.userList.find((function(i){return i.ouid===userId})),userObj||(userObj={name:""})),userObj},triggerValidation:function(){this.model.emitForm=!0},validated:function(){this.save()},failed:function(){this.isSaving=!1},save:function(){var _this3=this;if(this.isSaving=!0,this.model.emitForm=!1,!this.model.woData.sites||0===this.model.woData.sites.length)return this.$message({message:"Site is mandatory",type:"error"}),void(this.isSaving=!1);var workorder=this.$helpers.cloneObject(this.model.woData.woModel);Object.assign(workorder,workorder.woModel),workorder.isSignatureRequired=this.model.woData.isSignatureRequired;var uploadFiles=[];if(this.model.woData.woModel.attachedFiles){for(var i=0;i<this.model.woData.woModel.attachedFiles.uploadFiles.length;i++)uploadFiles.push(new File([this.model.woData.woModel.attachedFiles.uploadFiles[i]],this.model.woData.woModel.attachedFiles.uploadFiles[i].name));this.model.woData.woModel.attachedFiles.attachments&&(workorder.attachments=this.model.woData.woModel.attachedFiles.attachments.filter((function(u){return u.fileId>0}))),delete workorder.attachedFiles}delete workorder.woModel,workorder.resource=this.model.woData.singleResource,workorder.resource&&!workorder.resource.id&&delete workorder.resource,workorder.category&&!workorder.category.id&&delete workorder.category,workorder.type&&!workorder.type.id&&delete workorder.type,workorder.priority&&!workorder.priority.id&&delete workorder.priority,workorder.assignmentGroup=workorder.groups,workorder.assignmentGroup&&(workorder.assignmentGroup.id?workorder.assignmentGroup={id:workorder.assignmentGroup.id}:delete workorder.assignmentGroup),this.model.triggerData.defaultAssignedTo&&(workorder.assignedTo={id:this.model.triggerData.defaultAssignedTo}),workorder.photoMandatory=this.model.preRequestData.photoMandatory,workorder.allowNegativePreRequisite=this.model.preRequestData.allowNegativePreRequisite,-1===workorder.allowNegativePreRequisite&&(workorder.allowNegativePreRequisite=2);var formdata={};formdata.workorder=workorder,workorder.duration&&(workorder.duration=this.$util.daysHoursToUnixTime(workorder.duration)||-1),workorder.estimatedWorkDuration&&(workorder.estimatedWorkDuration=this.$util.daysHoursToUnixTime(workorder.estimatedWorkDuration)||-1),formdata.deleteReadingRulesList=[];var preRequestsections=[],preRequestsequence=1;for(var key in this.model.preRequestData.preRequestSections){var section=this.$helpers.cloneObject(this.model.preRequestData.preRequestSections[key]);if(delete section.assignmentType,section.enableInput=!0,section.inputType="6","6"===section.inputType){var secOptions=[];for(var key3 in section.options||(section.options=[],section.options.push({name:section.additionInfo.truevalue}),section.options.push({name:section.additionInfo.falsevalue})),section.options){var option=section.options[key3];option&&option.name&&(secOptions[key3]=option.name)}section.options=secOptions}else section.options=[];for(var key2 in section.taskTemplates=this.$helpers.cloneObject(section.preRequests),delete section.preRequests,section.taskTemplates){var task=section.taskTemplates[key2],errorMsg=this.validatePreRequest(task);if(errorMsg)return this.$message({message:errorMsg,type:"error"}),void(this.isSaving=!1);if(task.enableInput=!0,task.inputType="6","6"===task.inputType){var taskOptions=[];for(var _key in task.options||(task.options=[],task.options.push({name:task.additionInfo.truevalue}),task.options.push({name:task.additionInfo.falsevalue})),task.options){var _option=task.options[_key];_option&&_option.name&&(taskOptions[_key]=_option.name)}task.options=taskOptions}else task.options=[];task.readingFieldId||(task.readingFieldId=-1),task.sequence=preRequestsequence,preRequestsequence+=1}preRequestsections.push(section)}if(formdata.preRequests=preRequestsections,3===this.model.preRequestData.allowNegativePreRequisite){var approvers=[],approverKeys={1:"userId",2:"roleId",3:"groupId"};this.model.preRequestData.approvers.forEach((function(approver){var _approvers$push;approver.sharingType&&approver.approversId&&approvers.push((_approvers$push={},(0,defineProperty/* default */.Z)(_approvers$push,approverKeys[approver.sharingType],approver.approversId),(0,defineProperty/* default */.Z)(_approvers$push,"sharingType",approver.sharingType),(0,defineProperty/* default */.Z)(_approvers$push,"actions",approver.actions),_approvers$push))})),this.model.preRequestData.approvers=approvers}else delete this.model.preRequestData.approvers;formdata.prerequisiteApprover=this.model.preRequestData.approvers;
// prerequisite end
var _ret,sections=[],sequence=1,isSingleWoAssetType="single"===this.model.woData.workOrderType&&"ASSET"===this.model.woData.singleResource.resourceTypeEnum,_loop=function(){var _formdata$deleteReadi,section=_this3.$helpers.cloneObject(_this3.model.taskData.taskSections[_key2]);if(section.pmIncludeExcludeResourceContexts=[],section.selectedResourceList.forEach((function(x){section.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:2})})),delete section.selectedResourceList,section.pmTaskSectionTemplateTriggers=[],section.triggers.forEach((function(x,index){"All"!==x.triggerName&&(x.executeIfNotInTime=0===index?-1:24*x.executeIfNotInTime*60*60,section.pmTaskSectionTemplateTriggers.push(x))})),delete section.triggers,section.category&&section.category.length&&("CURRENT_FLOOR"===section.category[0]||"CURRENT_ASSET"===section.category[0]||"CURRENT_SPACE"===section.category[0]?section.assignmentType=5:"space"===section.category[0]?(section.assignmentType=3,section.spaceCategoryId=section.category[1]):"asset"===section.category[0]&&(section.assignmentType=4,section.assetCategoryId=section.category[1])),isSingleWoAssetType&&(section.assignmentType=-1,section.assetCategoryId=-1),"5"===section.inputType||"6"===section.inputType){var _secOptions=[];for(var _key3 in section.options){var _option2=section.options[_key3];_option2&&_option2.name&&(_secOptions[_key3]=_option2.name)}section.options=_secOptions}else section.options=[];var sectionRules=_this3.constructReadingRules(section);section.readingRules=sectionRules.readingRules,section.actionsList=sectionRules.actionsList,(_formdata$deleteReadi=formdata.deleteReadingRulesList).push.apply(_formdata$deleteReadi,(0,toConsumableArray/* default */.Z)(sectionRules.deleteReadingRulesList)),section.taskTemplates=_this3.$helpers.cloneObject(section.tasks),delete section.tasks;var _ret2,_loop3=function(){var _formdata$deleteReadi2,task=section.taskTemplates[_key4];task.pmIncludeExcludeResourceContexts=[],task.selectedResourceList.forEach((function(x){task.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:3})})),delete task.selectedResourceList,delete task.readingFields,task.category&&task.category.length&&("CURRENT_FLOOR"===task.category[0]||"CURRENT_ASSET"===task.category[0]||"CURRENT_SPACE"===task.category[0]?task.assignmentType=5:"space"===task.category[0]?(task.assignmentType=3,task.spaceCategoryId=task.category[1]):"asset"===task.category[0]&&(task.assignmentType=4,task.assetCategoryId=task.category[1])),isSingleWoAssetType&&(task.assignmentType=-1,task.assetCategoryId=-1);var errorMsg=_this3.validateTask(task);if(errorMsg)return _this3.$message({message:errorMsg,type:"error"}),_this3.isSaving=!1,{v:{v:void 0}};if("5"===task.inputType||"6"===task.inputType){var _taskOptions=[];for(var _key5 in task.options){var _option3=task.options[_key5];_option3&&_option3.name&&(_taskOptions[_key5]=_option3.name)}task.options=_taskOptions}else task.options=[];var taskRules=_this3.constructReadingRules(task);task.readingRules=taskRules.readingRules,(_formdata$deleteReadi2=formdata.deleteReadingRulesList).push.apply(_formdata$deleteReadi2,(0,toConsumableArray/* default */.Z)(taskRules.deleteReadingRulesList)),task.readingFieldId||(task.readingFieldId=-1),task.sequence=sequence,sequence+=1};for(var _key4 in section.taskTemplates)if(_ret2=_loop3(),_ret2)return _ret2.v;sections.push(section)};for(var _key2 in this.model.taskData.taskSections)if(_ret=_loop(),_ret)return _ret.v;formdata.tasks=sections;var preventiveFormData={};if(preventiveFormData.title=formdata.workorder.subject,preventiveFormData.triggers=[],preventiveFormData.preventOnNoTask=this.model.woData.isPreventOnNoTask,this.model.woData.isOffsetWOCreation){var offset=24*this.model.woData.offsetDays*60*60+60*this.model.woData.offsetHours*60;preventiveFormData.woCreationOffset=offset,formdata.workorder.woCreationOffset=offset}else preventiveFormData.woCreationOffset=0,formdata.workorder.woCreationOffset=0;formdata.workorder.sendForApproval=this.model.woData.sendForApproval,formdata.workorder.workPermitNeeded=this.model.woData.workPermitNeeded,preventiveFormData.markIgnoredWo=this.model.woData.markIgnoredWo,preventiveFormData.pmCreationType="single"===this.model.woData.workOrderType?1:2,preventiveFormData.baseSpaceId=this.model.woData.selectedBuilding||-1,preventiveFormData.pmIncludeExcludeResourceContexts=[],"ALL_FLOORS"===this.model.woData.resourceType?(preventiveFormData.assignmentType=1,this.model.woData.selectedFloorList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))):"SPACE_CATEGORY"===this.model.woData.resourceType?(preventiveFormData.assignmentType=3,preventiveFormData.spaceCategoryId=this.model.woData.spacecategoryId,this.model.woData.selectedSpaceList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))):"ASSET_CATEGORY"===this.model.woData.resourceType&&(preventiveFormData.assignmentType=4,preventiveFormData.assetCategoryId=this.model.woData.assetCategoryId,this.model.woData.selectedResourceList.forEach((function(x){preventiveFormData.pmIncludeExcludeResourceContexts.push({resourceId:x.id,isInclude:!0,parentType:1})}))),preventiveFormData.resourcePlanners=[],this.model.woData.resourceList.forEach((function(resource){var triggerContexts,noti=[];if(resource.triggerNames.length)if(1===resource.triggerNames.length&&"0"===resource.triggerNames[0])resource.triggerNames=[];else{var index=resource.triggerNames.findIndex((function(i){return"0"===i}));index>=0&&_this3.model.triggerData.triggers.length&&resource.triggerNames.splice(index,1,_this3.model.triggerData.triggers[0].name)}(resource.notifications.forEach((function(n){noti.push({reminderName:n})})),noti.length||resource.triggerNames.length||resource.assignedTo&&resource.assignedTo>-1)&&(resource.triggerNames.length?triggerContexts=resource.triggerNames.map((function(i){return{name:i}})):_this3.model.triggerData.triggers.length&&(triggerContexts=[{name:_this3.model.triggerData.triggers[0].name}]),preventiveFormData.resourcePlanners.push({assignedToId:resource.assignedTo||_this3.model.triggerData.defaultAssignedTo,resourceId:resource.id,pmResourcePlannerReminderContexts:noti,triggerContexts:triggerContexts}))}));var reminders=[];for(var x in preventiveFormData.triggers=[],this.model.triggerData.triggers){var trigger=Object.assign({},this.model.triggerData.triggers[x]);trigger.triggerType="0"===x?1:2,trigger.schedule&&(trigger.custom=trigger.schedule.custom),1===trigger.type?(trigger.triggerExecutionSource=1,trigger.startTime=this.$helpers.addTime(trigger.startDate,trigger.startHour.length?trigger.startHour[0]:"00:00"),trigger.stopAfter,trigger.endTime=-1,trigger.frequency=trigger.schedule.facilioFrequency,(!trigger.frequency||trigger.frequency<0)&&(trigger.frequency=0),trigger.frequency.length>1?preventiveFormData.frequency=8:preventiveFormData.frequency=trigger.schedule.facilioFrequency,preventiveFormData.custom=trigger.schedule.custom):2===trigger.type?(trigger.triggerExecutionSource=2,trigger.startTime=-1,trigger.endTime=-1,"never"===trigger.stopAfterReading&&(trigger.endReading=-1)):3===trigger.type&&(trigger.startTime=-1,trigger.endTime=-1,trigger.triggerExecutionSource=3,trigger.workFlowRule={criteria:this.$helpers.cloneObject(trigger.criteria)},trigger.workFlowRule.criteria&&delete trigger.workFlowRule.criteria.regEx,delete trigger.criteria),delete trigger.initialSchedule,preventiveFormData.triggers.push(trigger)}var templates=["email","sms","mobile"];if(this.model.triggerData.reminders&&this.model.triggerData.reminders.length)for(var _loop2=function(){var reminder=_this3.$helpers.cloneObject(_this3.model.triggerData.reminders[_i2]);reminder.template&&templates.forEach((function(t){var mode="email"===t?"mail":t;if(reminder.template[t].toAddr&&reminder.template[t].toAddr.length){var data={type:_this3.config[t].type,message:reminder.template[t].message,name:_this3.config[t].name,workflow:{}};_this3.$common.setUserMailWorkflow(reminder.template[t].toAddr,data,mode),_this3.$common.setExpressionFromPlaceHolder(data.workflow,reminder.template[t].message),"mail"!==t&&"mobile"!==t||(data.subject=reminder.template[t].subject,_this3.$common.setExpressionFromPlaceHolder(data.workflow,reminder.template[t].subject)),"sms"===t&&(data.body=reminder.template[t].subject),reminder["".concat(t,"template")]={actionType:_this3.config[t].actionType,templateJson:data}}})),reminder.template&&delete reminder.template,reminders.push(reminder)},_i2=0;_i2<this.model.triggerData.reminders.length;_i2++)_loop2();formdata.preventivemaintenance=preventiveFormData,formdata.reminders=[];for(var idx=0;idx<reminders.length;idx++)-1!==reminders[idx].duration&&formdata.reminders.push(reminders[idx]);this.model.isEdit?this.updatePreventiveMaintenance(formdata,uploadFiles):this.savePreventiveMaintenance(formdata,uploadFiles)},constructReadingRules:function(obj){var readingRules=[],actionsList=[],deleteReadingRulesList=[];return"4"===obj.inputType&&("none"===obj.validation?obj.inputValidationRuleId&&-1!==obj.inputValidationRuleId&&deleteReadingRulesList.push(obj.inputValidationRuleId):"incremental"===obj.validation||"decremental"===obj.validation?readingRules.push({id:obj.inputValidationRuleId||-1,name:"incremental"===obj.validation?"Incremental":"Decremental",ruleType:9,event:{activityType:1},thresholdType:5,workflow:{expressions:[{name:"a",constant:"${inputValue}"},{name:"b",constant:"${previousValue}"}],parameters:[{name:"inputValue",typeString:"Number"},{name:"previousValue",typeString:"Number"}],resultEvaluator:"incremental"===obj.validation?"(b!=-1)&&(a<b)":"(b!=-1)&&(a>b)"}}):"safeLimit"===obj.validation&&("undefined"!==typeof obj.minSafeLimit&&null!=obj.minSafeLimit||"undefined"!==typeof obj.maxSafeLimit&&null!=obj.maxSafeLimit)&&readingRules.push({id:obj.inputValidationRuleId||-1,name:"Safelimit",ruleType:9,event:{activityType:1},thresholdType:5,workflow:{expressions:[{name:"a",constant:"${inputValue}"},{name:"b",constant:null===obj.minSafeLimit?-1:obj.minSafeLimit},{name:"c",constant:null===obj.maxSafeLimit?-1:obj.maxSafeLimit}],parameters:[{name:"inputValue",typeString:"Number"}],resultEvaluator:"(b!=-1&&a<b)||(c!=-1&&a>c)"}})),{readingRules:readingRules,actionsList:actionsList,deleteReadingRulesList:deleteReadingRulesList}},updatePreventiveMaintenance:function(data,uploadFiles){var _this4=this,formData=new FormData;if(data.preventivemaintenance.siteId=data.workorder.siteId,formData.append("workOrderString",JSON.stringify(data.workorder)),formData.append("preventiveMaintenanceString",JSON.stringify(data.preventivemaintenance)),formData.append("tasksString",JSON.stringify(data.tasks)),formData.append("preRequestsString",JSON.stringify(data.preRequests)),formData.append("prerequisiteApproverString",JSON.stringify(data.prerequisiteApprover)),data.reminders&&formData.append("reminderString",JSON.stringify(data.reminders)),formData.append("deleteReadingRulesListString",JSON.stringify(data.deleteReadingRulesList)),uploadFiles)for(var num=0;num<uploadFiles.length;num++)formData.append("attachedFiles",uploadFiles[num]);var id=parseInt(this.$route.query.edit||this.$route.params.id);this.$http.post("/workorder/updateNewPreventiveMaintenance?id="+id,formData).then((function(response){"object"===(0,esm_typeof/* default */.Z)(response.data)?(_this4.$message({message:"Planned maintenance updated successfully!",type:"success"}),_this4.$emit("edited")):(_this4.$message({message:"Planned maintenance updation failed!",type:"error"}),_this4.isSaving=!1)})).catch((function(_){_this4.$message({message:"Failed to edit Planned maintenance!",type:"error"}),_this4.isSaving=!1}))},savePreventiveMaintenance:function(data,uploadFiles){var formData=new FormData,error=this.validationPM(data);if(error)return this.$message.error(error),void(this.isSaving=!1);if(data.preventivemaintenance.siteId=data.workorder.siteId,formData.append("workOrderString",JSON.stringify(data.workorder)),formData.append("preventiveMaintenanceString",JSON.stringify(data.preventivemaintenance)),formData.append("tasksString",JSON.stringify(data.tasks)),formData.append("preRequestsString",JSON.stringify(data.preRequests)),formData.append("prerequisiteApproverString",JSON.stringify(data.prerequisiteApprover)),uploadFiles)for(var num=0;num<uploadFiles.length;num++)formData.append("attachedFiles",uploadFiles[num]);data.reminders&&formData.append("reminderString",JSON.stringify(data.reminders));var saveurl="/workorder/addNewPreventiveMaintenance",self=this;self.$http.post(saveurl,formData).then((function(response){"object"===(0,esm_typeof/* default */.Z)(response.data)?(self.$message({message:"Planned maintenance created successfully!",type:"success"}),self.isSaving=!1,self.$emit("saved")):(self.$message({message:"Planned maintenance creation failed!",type:"error"}),self.isSaving=!1)})).catch((function(_){self.$message({message:"Planned maintenance creation failed!",type:"error"}),self.isSaving=!1}))},validationPM:function(data){var errorMsg="";if(!data.workorder.subject)return errorMsg+="Please enter the PPM subject \n",errorMsg;if(data.preventivemaintenance.triggers.length>0)for(var keys in data.preventivemaintenance.triggers){var ds=data.preventivemaintenance.triggers[keys];if(2===parseInt(ds.type)){if(!ds.readingFieldId||ds.readingFieldId<1)return errorMsg+="Please select the specific reading type for this trigger \n",errorMsg;if(!ds.readingInterval||ds.readingFieldId<0)return errorMsg+="Please specify the reading interval \n",errorMsg;if(!ds.startReading||ds.startReading<0)return errorMsg+="Please specify the reading start value \n",errorMsg}else if(1===parseInt(ds.type)){if(!ds.startHour[0])return errorMsg+="Please enter a date for this trigger \n",errorMsg;if(!ds.startDate)return errorMsg+="Please enter a time for this trigger \n",errorMsg}}},validateTask:function(task){var errorMsg="";return task.name||(errorMsg+="Please specify the task subject \n"),task.enableInput&&(2===parseInt(task.inputType)?(parseInt(task.readingFieldId)<1||!task.readingFieldId)&&(errorMsg+="Please select a specific reading type \n"):4===parseInt(task.inputType)?"safeLimit"===task.validation&&(task.minSafeLimit||task.maxSafeLimit||(errorMsg+="Please enter either minimum or maximum value \n")):5===parseInt(task.inputType)&&(task.options.length<2?errorMsg+="Please enter atleast two options\n":task.options[0].name||task.options[1].name||(errorMsg+="Please enter atleast two options \n"))),errorMsg}},watch:{"model.woData.resourceList":{handler:function(newValue){this.$forceUpdate()},deep:!0}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetcategory:function(state){return state.assetCategory}
// groups: state => state.groups,
// users: state => state.users,
})),(0,vuex_esm/* mapGetters */.Se)(["getSpaceCategoryPickList"])),{},{spacecategory:function(){return this.getSpaceCategoryPickList()},resourceListLength:function(){return this.model.woData.resourceList?this.model.woData.resourceList.length:0},userList:function(){var _this5=this;if(this.model.woData.woModel.groups&&this.model.woData.woModel.groups.id){var group=this.groups.find((function(group){return group.id===Number(_this5.model.woData.woModel.groups.id)}));return group.members}return this.users},siteName:function(){if(this.model.woData.sites&&this.model.woData.sites.length>0&&this.siteOptions){for(var label,siteLabels=[],i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.siteOptions.length;j++)if(Number(this.siteOptions[j].value)===this.model.woData.sites[i]){siteLabels.push(this.siteOptions[j].label);break}if(siteLabels.length>0){label=siteLabels[0];for(var k=1;k<siteLabels.length;k++)label=label+","+siteLabels[k]}return label}return""},assetCategoryName:function(){var _this6=this,category=this.assetcategory.find((function(i){return i.id===Number(_this6.model.woData.assetCategoryId)}));return category?category.name:""},buildingList:function(){var buildings=[];if(this.$store.getters.getBuildings&&this.model.woData.sites)for(var i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.$store.getters.getBuildings.length;j++)this.$store.getters.getBuildings[j].siteId===this.model.woData.sites[i]&&buildings.push(this.$store.getters.getBuildings[j]);return buildings},buildingName:function(){var _this7=this,building=this.buildingList.find((function(i){return i.id===_this7.model.woData.selectedBuilding}));return building?building.name:""},templateOptions:function(){var options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),this.model.triggerData.reminders.forEach((function(reminder,i){options.push({label:"".concat(timeLookup[reminder.duration]," ").concat(typeLookup[reminder.type]),value:i})})),options}})},multisitepreventive_OldPmReviewvue_type_script_lang_js=OldPmReviewvue_type_script_lang_js,OldPmReview_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_OldPmReviewvue_type_script_lang_js,OldPmReviewvue_type_template_id_74a14666_render,OldPmReviewvue_type_template_id_74a14666_staticRenderFns,!1,null,null,null)
/* harmony default export */,OldPmReview=OldPmReview_component.exports,PmResourcePlanvue_type_template_id_7dc584cf_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"scrollable-y100"},[_c("div",{staticClass:"fc-pm-form-container"},[_c("div",{staticClass:"fc-pm-form-right-main"},[_vm.model.isEdit?_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" EDIT PLANNED MAINTENANCE ")]):_c("div",{staticClass:"fc-grey-text mT10"},[_vm._v(" NEW PLANNED MAINTENANCE ")]),_c("div",{staticClass:"heading-black22 mB20"},[_vm._v(" Maintenance for "+_vm._s(_vm.resourceName())+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-main-bg2"},[_c("div",{staticClass:"fc-pm-main-content"},[_c("div",[_c("div",{staticClass:"fc-text-pink width50 fL"},[_vm._v("RESOURCE PLAN")]),_c("div",{staticClass:"fR fc-black-small-txt-12"},[_c("div",{staticClass:"flex-middle"},[_c("div",{},[_vm.from!==_vm.to?_c("span",[_vm._v(_vm._s(_vm.from)+" - ")]):_vm._e(),_c("span",[_vm._v(_vm._s(_vm.to))]),[_vm._v(" of "+_vm._s(_vm.resourceListLength)+" "),_c("span",{staticClass:"el-icon-arrow-left fc-black-small-txt-12 fw-bold f16 pointer mL10 mR5",class:{disable:_vm.from<=1},on:{click:function($event){_vm.from>1&&_vm.prev()}}}),_c("span",{staticClass:"el-icon-arrow-right fc-black-small-txt-12 f16 pointer mR10 fw-bold",class:{disable:_vm.to===_vm.resourceListLength},on:{click:function($event){_vm.hasMorePage&&_vm.next()}}})]],2),_c("el-input",{staticClass:"fc-input-full-border2 text-input-icon-align input-padding width300px",attrs:{placeholder:"search",type:"search","prefix-icon":"el-icon-search"},model:{value:_vm.searchQuery,callback:function($$v){_vm.searchQuery=$$v},expression:"searchQuery"}})],1)]),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.selectAll||_vm.selectedResourceListLength,expression:"selectAll || selectedResourceListLength"}],staticClass:"clearboth pT20"},[_c("el-button",{staticClass:"add-border-btn",on:{click:function($event){_vm.showTriggerSelect=!0}}},[_vm._v("Trigger")]),_c("el-button",{staticClass:"add-border-btn",on:{click:function($event){_vm.showNotificationSelect=!0}}},[_vm._v("Notifications")]),_c("el-button",{staticClass:"add-border-btn",on:{click:function($event){_vm.showUserSelect=!0}}},[_vm._v("Assign User")])],1),_c("div",{staticClass:"fc-pm-task-form-table-con pm-resource-table pT20 clearboth"},[_c("table",{staticClass:"fc-pm-form-table"},[_c("thead",[_c("tr",{staticClass:"pm-trigger-head-tr"},[_c("th",[_c("el-checkbox",{on:{change:_vm.selected},model:{value:_vm.selectAll,callback:function($$v){_vm.selectAll=$$v},expression:"selectAll"}})],1),_c("th",{staticClass:"pT10 pB10",staticStyle:{width:"300px"}},[_vm._v("RESOURCE")]),_c("th",{staticClass:"pT10 pB10 text-left",staticStyle:{width:"250px","padding-left":"25px !important"}},[_vm._v(" TRIGGER ")]),_c("th",{staticClass:"pT10 pB10 text-left",staticStyle:{width:"200px","padding-left":"25px !important"}},[_vm._v(" ASSIGN TO ")]),_c("th")])]),_c("tbody",_vm._l(_vm.model.woData.resourceList,(function(resource,key){return _vm.searchQuery.trim()||key>=_vm.from-1&&key<_vm.to?_c("tr",{directives:[{name:"show",rawName:"v-show",value:!_vm.searchQuery.trim()||resource.name.trim().toLowerCase().includes(_vm.searchQuery.trim().toLowerCase()),expression:"\n                      !searchQuery.trim() ||\n                        resource.name\n                          .trim()\n                          .toLowerCase()\n                          .includes(searchQuery.trim().toLowerCase())\n                    "}],key:key,staticClass:"trigger-tr-visibility visibility-visible-actions"},[_c("td",[_c("el-checkbox",{on:{change:_vm.forceUpdate},model:{value:_vm.model.woData.resourceList[key].selected,callback:function($$v){_vm.$set(_vm.model.woData.resourceList[key],"selected",$$v)},expression:"model.woData.resourceList[key].selected"}})],1),_c("td",{staticStyle:{width:"300px"}},[_c("div",[_vm._v(_vm._s(resource.name))])]),_c("td",{staticClass:"text-left",staticStyle:{width:"250px"}},[_c("el-select",{staticClass:"fc-input-full-border-select-hover fc-input-border-remove mR30 line-height35px height35px el-caret-down-icon width250px",attrs:{multiple:"","collapse-tags":"",placeholder:"Select"},on:{change:function($event){return _vm.onChangeTriggerValue(key)}},model:{value:_vm.model.woData.resourceList[key].triggerNames,callback:function($$v){_vm.$set(_vm.model.woData.resourceList[key],"triggerNames",$$v)},expression:"model.woData.resourceList[key].triggerNames"}},[_vm.model.triggerData.isDefaultAllTriggers?_c("el-option",{attrs:{label:"All Triggers",value:"0"}}):_c("el-option",{attrs:{label:_vm.ellipsis(_vm.model.triggerData.triggers[0].name)+" (Default)",value:"0"}}),_vm._l(_vm.model.triggerData.triggers,(function(trigger,index){return _c("el-option",{key:index,attrs:{label:_vm.ellipsis(trigger.name),value:trigger.name}})}))],2)],1),_c("td",{staticClass:"text-left",staticStyle:{width:"250px"}},[_vm.model.woData.resourceList[key].assignedTo>0?_c("el-select",{staticClass:"fc-input-full-border-select-hover fc-input-border-remove line-height35px height35px el-caret-down-icon pR0",staticStyle:{width:"190px"},attrs:{clearable:""},on:{click:function($event){$event.stopPropagation()},change:_vm.forceUpdate},model:{value:_vm.model.woData.resourceList[key].assignedTo,callback:function($$v){_vm.$set(_vm.model.woData.resourceList[key],"assignedTo",$$v)},expression:"model.woData.resourceList[key].assignedTo"}},[_vm.model.triggerData.defaultAssignedTo>0?_c("el-option",{attrs:{label:""+_vm.userName({assignedTo:-1}),value:"-1"}}):_vm._e(),_vm._l(_vm.userList,(function(user,ikey){return _c("el-option",{key:ikey,attrs:{label:user.name,value:user.ouid}})}))],2):_c("div",{staticClass:"width200px"},[_c("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click","popper-class":"popover-height popover-arow-hover"},model:{value:_vm.popovers[key],callback:function($$v){_vm.$set(_vm.popovers,key,$$v)},expression:"popovers[key]"}},[_vm._l(_vm.userListBySite(_vm.model.woData.resourceList[key].id),(function(user,ikey){return _c("div",{key:ikey,staticClass:"p10 fc-div-hover pointer",attrs:{label:user.label,value:user.ouid},on:{click:function($event){return $event.stopPropagation(),_vm.selectedUser(key,user.ouid)}}},[_vm._v(" "+_vm._s(user.name)+" ")])})),_c("el-button",{staticClass:"btn-remove-border pL15 pR15",attrs:{slot:"reference"},slot:"reference"},[_vm._v(_vm._s(_vm.userName(resource))),_c("i",{staticClass:"el-icon-arrow-down"})])],2)],1)],1),_c("td",{staticStyle:{width:"100px"}},[1===_vm.model.triggerData.reminders.length?_c("div",[0===_vm.model.woData.resourceList[key].notifications.length?_c("img",{staticClass:"mL50",attrs:{src:__webpack_require__(37576),width:"15",height:"15"},on:{click:function($event){return _vm.handleSingleNotification(key)}}}):_c("img",{staticClass:"mL50",attrs:{src:__webpack_require__(380789),width:"15",height:"15"},on:{click:function($event){return _vm.handleSingleNotification(key)}}})]):_c("div",[_c("el-popover",{attrs:{trigger:"click",placement:"bottom",width:"200","popper-class":_vm.model.triggerData.reminders.length?"popover-height":"hide"},model:{value:_vm.notificationPopovers[key],callback:function($$v){_vm.$set(_vm.notificationPopovers,key,$$v)},expression:"notificationPopovers[key]"}},[_vm._l(_vm.model.triggerData.reminders,(function(notification,ikey){return _c("div",{key:ikey,staticClass:"p10 pointer",attrs:{label:notification.name,value:notification.name}},[_c("el-checkbox",{attrs:{checked:_vm.model.woData.resourceList[key].notifications.includes(_vm.model.triggerData.reminders[ikey].name)},on:{change:function(val){val?_vm.model.woData.resourceList[key].notifications.push(notification.name):_vm.removeNotif(key,notification.name),_vm.forceUpdate()}}},[_vm._v(" "+_vm._s(notification.name)+" ")])],1)})),_c("el-tooltip",{staticClass:"item",attrs:{slot:"reference",effect:"dark",placement:"bottom","popper-class":_vm.model.woData.resourceList[key].notifications.length&&!_vm.notificationPopovers[key]?"element-tooltip":"hide"},slot:"reference"},[_vm.model.woData.resourceList[key].notifications.length?_c("img",{staticClass:"mL50",attrs:{src:__webpack_require__(380789),width:"15",height:"15"},on:{click:function($event){_vm.$set(_vm.notificationPopovers,key,!_vm.notificationPopovers[key]),_vm.forceUpdate()}}}):_vm._e(),_c("img",{staticClass:"mL50",attrs:{src:__webpack_require__(37576),width:"15",height:"15"},on:{click:function($event){_vm.$set(_vm.notificationPopovers,key,!_vm.notificationPopovers[key]),_vm.forceUpdate()}}}),_vm._l(_vm.templateOptions(_vm.model.woData.resourceList[key].notifications),(function(item,index){return _c("div",{key:index,attrs:{slot:"content"},slot:"content"},[_vm._v(" "+_vm._s(_vm.model.woData.resourceList[key].notifications[index]+" ("+item+")")+" ")])}))],2)],2)],1)])]):_vm._e()})),0)])])])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:_vm.moveToPrevious}},[_vm._v("PREVIOUS")]),_c("el-button",{staticClass:"modal-btn-save f13",attrs:{type:"primary"},on:{click:_vm.moveToNext}},[_vm._v("PROCEED TO NEXT "),_c("img",{staticClass:"fR",attrs:{src:__webpack_require__(936658),width:"17px"}})])],1)])])]),_vm.showTriggerSelect?_c("el-dialog",{staticClass:"fc-dialog-center-container resource-dialog",attrs:{visible:_vm.showTriggerSelect,"append-to-body":!0,title:"TRIGGERS",width:"30%"},on:{"update:visible":function($event){_vm.showTriggerSelect=$event}}},[_vm.model.triggerData.triggers.length?_c("el-row",{staticClass:"pT10 pB10"},[_c("el-checkbox",{attrs:{checked:_vm.checkedDefault},on:{change:function(val){val?_vm.selectedTriggers.push("0"):_vm.selectedTriggers=_vm.selectedTriggers.filter((function(i){return"0"===i})),_vm.forceUpdate()}}},[_vm._v(" "+_vm._s(_vm.model.triggerData.triggers[0].name)+" (Default) ")])],1):_vm._e(),_vm._l(_vm.model.triggerData.triggers,(function(trigger,index){return _c("el-row",{key:index,staticClass:"pT10 pB10"},[_c("el-checkbox",{attrs:{checked:_vm.selectedTriggers.includes(trigger.name)},on:{change:function(val){val?_vm.selectedTriggers.push(trigger.name):_vm.selectedTriggers=_vm.selectedTriggers.filter((function(i){return i===trigger.name})),_vm.forceUpdate()}}},[_vm._v(" "+_vm._s(trigger.name)+" ")])],1)})),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){_vm.showTriggerSelect=!1,_vm.selectedTriggers=[],_vm.checkedDefault=!1}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:_vm.applyTriggers}},[_vm._v("Apply")])],1)],2):_vm._e(),_vm.showNotificationSelect?_c("el-dialog",{staticClass:"fc-dialog-center-container add-triger-dialog resource-dialog",attrs:{visible:_vm.showNotificationSelect,"append-to-body":!0,title:"NOTIFICATIONS",width:"30%"},on:{"update:visible":function($event){_vm.showNotificationSelect=$event}}},[_vm._l(_vm.model.triggerData.reminders,(function(notification,ikey){return _c("el-row",{key:ikey,staticClass:"mT10 mB10"},[_c("el-checkbox",{attrs:{checked:_vm.selectedReminders.includes(notification.name),label:notification.name},on:{change:function(val){val?_vm.selectedReminders.push(notification.name):_vm.selectedReminders=_vm.selectedReminders.filter((function(i){return i===notification.name})),_vm.forceUpdate()}}},[_vm._v(" "+_vm._s(notification.name))])],1)})),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){_vm.showNotificationSelect=!1,_vm.selectedReminders=[]}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:_vm.applyNotifications}},[_vm._v("Apply")])],1)],2):_vm._e(),_vm.showUserSelect?_c("el-dialog",{staticClass:"fc-dialog-center-container add-triger-dialog resource-dialog",attrs:{visible:_vm.showUserSelect,"append-to-body":!0,title:"ASSIGN USER",width:"30%"},on:{"update:visible":function($event){_vm.showUserSelect=$event}}},[_c("el-row",{staticClass:"pT10"},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"-1"},model:{value:_vm.selectedAssignee,callback:function($$v){_vm.selectedAssignee=$$v},expression:"selectedAssignee"}},[_vm._v(_vm._s(_vm.model.triggerData.defaultAssignedTo>0?_vm.userList.find((function(i){return i.ouid===_vm.model.triggerData.defaultAssignedTo})).name+" (Default)":"Default"))])],1),_vm._l(_vm.userList,(function(user,ikey){return _c("el-row",{key:ikey,staticClass:"pT10 pB10"},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:user.ouid},model:{value:_vm.selectedAssignee,callback:function($$v){_vm.selectedAssignee=$$v},expression:"selectedAssignee"}},[_vm._v(" "+_vm._s(user.name))])],1)})),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel f13",on:{click:function($event){_vm.showUserSelect=!1,_vm.selectedAssignee=null}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save f13",on:{click:_vm.applyUser}},[_vm._v("Apply")])],1)],2):_vm._e()],1)},PmResourcePlanvue_type_template_id_7dc584cf_staticRenderFns=[],PmResourcePlanvue_type_script_lang_js=(__webpack_require__(228436),{mixins:[PMMixin/* default */.Z],props:["model","users","groups"],data:function(){return{selectAll:!1,searchQuery:"",popovers:{},triggerPopovers:{},notificationPopovers:{},showTriggerSelect:!1,showNotificationSelect:!1,selectedTrigger:null,selectedReminders:[],selectedTriggers:[],checkedDefault:!1,showUserSelect:!1,selectedAssignee:null,reminderType:[{label:"Before Execution",value:1},{label:"After Execution",value:2},{label:"Before Due",value:3},{label:"After Due",value:4}],perPage:20,page:1,from:0,to:0,hasMorePage:!1}},watch:{page:function(){this.from=(this.page-1)*this.perPage+1,this.to=this.from+this.perPage-1,this.to>=this.model.woData.resourceList.length&&(this.to=this.model.woData.resourceList.length,this.hasMorePage=!0)},"model.woData.resourceList":{handler:function(newVal,oldVal){!(0,validation/* isEmpty */.xb)(this.resourceListLength)&&this.resourceListLength>0&&(this.from=1,this.perPage>=this.resourceListLength?(this.to=this.resourceListLength,this.hasMorePage=!1):(this.to=this.perPage,this.hasMorePage=!0))},
// deep: true,
immediate:!0}},created:function(){this.$store.dispatch("loadBuildings");
//this.$store.dispatch('loadGroups') // users/groups sent from store pmnewform.vue as props.
},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({})),{},{userList:function(){var _this=this;if(this.model.woData.woModel.groups&&this.model.woData.woModel.groups.id){var group=this.groups.find((function(group){return group.id===Number(_this.model.woData.woModel.groups.id)}));return group?group.members:[]}return this.users},buildingName:function(){var buildingId=this.model.woData.selectedBuilding,building=this.buildingList.find((function(i){return i.id===buildingId}));return building?building.name:""},buildingList:function(){var buildings=[];if(this.$store.getters.getBuildings&&this.model.woData.sites)for(var i=0;i<this.model.woData.sites.length;i++)for(var j=0;j<this.$store.getters.getBuildings.length;j++)this.$store.getters.getBuildings[j].siteId===this.model.woData.sites[i]&&buildings.push(this.$store.getters.getBuildings[j]);return buildings},resourceListLength:function(){var model=this.model,_ref=model||{},woData=_ref.woData,_ref2=woData||{},_ref2$resourceList=_ref2.resourceList,resourceList=void 0===_ref2$resourceList?[]:_ref2$resourceList;return resourceList.length},selectedResourceListLength:function(){var model=this.model,_ref3=model||{},woData=_ref3.woData,_ref4=woData||{},_ref4$resourceList=_ref4.resourceList,resourceList=void 0===_ref4$resourceList?[]:_ref4$resourceList;return resourceList.filter((function(resource){return resource.selected})).length}}),methods:{prev:function(){this.page=this.page-1},next:function(){this.page=this.page+1},ellipsis:function(string){return string.length>10?string.substring(0,9)+"...":string},generateReminderOptions:function(){var options=[];options.push({label:"30 Min",value:1800});for(var i=1;i<24;i++)options.push({label:i+(1===i?" Hour":" Hours"),value:3600*i});for(var _i=1;_i<32;_i++)options.push({label:_i+(1===_i?" Day":" Days"),value:24*_i*3600});return options},templateOptions:function(notifications){var _this2=this,options=[],allTimeOptions=this.generateReminderOptions(),timeLookup={};allTimeOptions.forEach((function(op){timeLookup[op.value]=op.label}));var typeLookup={};return this.reminderType.forEach((function(type){typeLookup[type.value]=type.label})),notifications.forEach((function(notification,i){var n=_this2.model.triggerData.reminders.find((function(k){return k.name===notification}));options.push("".concat(timeLookup[n.duration]," ").concat(typeLookup[n.type]))})),options},moveToNext:function(){this.$emit("next")},moveToPrevious:function(){this.$emit("previous")},applyNotifications:function(){if(this.selectedReminders.length)for(var i=0;i<this.model.woData.resourceList.length;i++)this.model.woData.resourceList[i].selected&&(this.model.woData.resourceList[i].notifications=this.$helpers.cloneObject(this.selectedReminders));this.showNotificationSelect=!1,this.selectedReminders=[],this.$forceUpdate()},applyTriggers:function(){if(this.checkedDefault)for(var i=0;i<this.model.woData.resourceList.length;i++)this.model.woData.resourceList[i].triggerNames=["0"];if(this.selectedTriggers.length)for(var _i2=0;_i2<this.model.woData.resourceList.length;_i2++)this.model.woData.resourceList[_i2].selected&&(this.checkedDefault?this.model.woData.resourceList[_i2].triggerNames=[].concat((0,toConsumableArray/* default */.Z)(this.model.woData.resourceList[_i2].triggerNames),(0,toConsumableArray/* default */.Z)(this.selectedTriggers)):this.model.woData.resourceList[_i2].triggerNames=(0,toConsumableArray/* default */.Z)(this.selectedTriggers));this.showTriggerSelect=!1,this.selectedTriggers=[],this.checkedDefault=!1,this.$forceUpdate()},applyUser:function(){if(this.selectedAssignee)for(var i=0;i<this.model.woData.resourceList.length;i++)this.model.woData.resourceList[i].selected&&(-1===this.selectedAssignee?this.model.woData.resourceList[i].assignedTo=-1:this.model.woData.resourceList[i].assignedTo=Number(this.selectedAssignee));this.showUserSelect=!1,this.selectedAssignee=null,this.$forceUpdate()},selected:function(val){for(var i=0;i<this.model.woData.resourceList.length;i++)this.searchQuery.trim()&&!this.model.woData.resourceList[i].name.trim().toLowerCase().includes(this.searchQuery.trim().toLowerCase())||i>=this.from-1&&i<this.to&&(this.model.woData.resourceList[i].selected=val)},userName:function(resource){var _this3=this;if(!this.userList)return"";var user=this.userList.find((function(user){return user.ouid===resource.assignedTo}));if(user)return user.name;var defaultVal=this.userList.find((function(user){return user.ouid===_this3.model.triggerData.defaultAssignedTo}));return defaultVal?"".concat(defaultVal.name," (Default)"):""},forceUpdate:function(){this.$forceUpdate()},selectTrigger:function(index,triggerName){this.model.woData.resourceList[index].triggerName=triggerName,this.$forceUpdate()},selectedUser:function(index,ouid){this.model.woData.resourceList[index].assignedTo=Number(ouid),this.popovers[index]=!1;var resourceList=this.$helpers.cloneObject(this.model.woData.resourceList);this.$set(this.model.woData,"resourceList",resourceList)},removeNotif:function(key,name){this.model.woData.resourceList[key].notifications=this.model.woData.resourceList[key].notifications.filter((function(i){return i!==name})),this.$forceUpdate()},handleSingleNotification:function(key){1===this.model.woData.resourceList[key].notifications.length?this.model.woData.resourceList[key].notifications.splice(0,1):this.model.woData.resourceList[key].notifications.push(this.model.triggerData.reminders[0].name)},userListBySite:function(siteID){var _this4=this;return this.users.filter((function(user){return _this4.canHandleSite(user,[siteID])}))},onChangeTriggerValue:function(key){if(!(0,validation/* isEmpty */.xb)(key)){var model=this.model,_ref5=model||{},woData=_ref5.woData,_ref6=woData||{},_ref6$resourceList=_ref6.resourceList,resourceList=void 0===_ref6$resourceList?[]:_ref6$resourceList,_ref7=model||{},triggerData=_ref7.triggerData,_ref8=triggerData||{},_ref8$triggers=_ref8.triggers,triggers=void 0===_ref8$triggers?[]:_ref8$triggers,actualTriggerNames=[];triggers.forEach((function(trigger){actualTriggerNames.push(trigger.name)}));var triggerNames=resourceList[key]?resourceList[key].triggerNames:[],allTriggerIndex=triggerNames.findIndex((function(i){return"0"===i})),actualTriggerIndex=triggerNames.findIndex((function(i){return actualTriggerNames.includes(i)}));if(actualTriggerIndex<0&&allTriggerIndex>=0){var allTrigger=triggerNames[allTriggerIndex]?[triggerNames[allTriggerIndex]]:[];this.$set(this,"model.woData.resourceList[".concat(key,"].triggerNames"),allTrigger)}else actualTriggerIndex>=0&&allTriggerIndex>=0&&this.$set(this,"model.woData.resourceList[".concat(key,"].triggerNames"),triggerNames.splice(allTriggerIndex,1));this.forceUpdate()}}}}),multisitepreventive_PmResourcePlanvue_type_script_lang_js=PmResourcePlanvue_type_script_lang_js,PmResourcePlan_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_PmResourcePlanvue_type_script_lang_js,PmResourcePlanvue_type_template_id_7dc584cf_render,PmResourcePlanvue_type_template_id_7dc584cf_staticRenderFns,!1,null,null,null)
/* harmony default export */,PmResourcePlan=PmResourcePlan_component.exports,PMConfigFormvue_type_template_id_1696e4e8_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fc-pm-form-right-main2 fc-pm-multipm-con"},[_vm.model.isEdit?_c("div",{staticClass:"heading-black22 mT20 mB20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.edit_pm"))+" ")]):_c("div",{staticClass:"heading-black22 mT20 mB20"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.new_pm"))+" ")]),_c("div",{staticClass:"fc-pm-main-bg fc-pm-multi-bg-con pB150"},[_c("div",{staticClass:"fc-pm-main-content2 pm-form-active-border-remove"},[_c("div",{staticClass:"fc-pm-form"},[_vm._m(0),_c("el-row",[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mB10"},[_vm._v(" Sites ")])]),_c("el-col",{staticClass:"fc-width-reduce-pm-col",attrs:{span:16}},[_c("FLookupField",{attrs:{model:_vm.model.woData.sites,field:_vm.siteField,hideDropDown:!1},on:{"update:model":function($event){return _vm.$set(_vm.model.woData,"sites",$event)},showLookupWizard:_vm.showLookupWizard}}),_vm.canShowLookupWizard?_c("FLookupFieldWizard",{attrs:{canShowLookupWizard:_vm.canShowLookupWizard,selectedLookupField:_vm.selectedLookupField,withReadings:!0},on:{"update:canShowLookupWizard":function($event){_vm.canShowLookupWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowLookupWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}}):_vm._e()],1)],1),_c("div",{class:{activeSingleSite:_vm.model.woData.sites&&_vm.model.woData.sites.length<=1}},[_c("el-row",{staticClass:"mT30"},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mB10"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.wr_list.category"))+" ")])]),_c("el-col",{staticClass:"fc-width-reduce-pm-col",attrs:{span:5}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width575px",attrs:{loading:_vm.loadingOption,disabled:!(_vm.model.woData.sites&&_vm.model.woData.sites.length>0)},model:{value:_vm.model.woData.resourceType,callback:function($$v){_vm.$set(_vm.model.woData,"resourceType",$$v)},expression:"model.woData.resourceType"}},[_c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.showFloorOption&&1===_vm.model.woData.sites.length,expression:"showFloorOption && model.woData.sites.length === 1"}],attrs:{label:"All Floors",value:"ALL_FLOORS"}}),_c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.fetchedSpaces.length,expression:"fetchedSpaces.length"}],attrs:{label:"Space Category",value:"SPACE_CATEGORY"}}),_c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.fetchedAssets.length,expression:"fetchedAssets.length"}],attrs:{label:"Asset Category",value:"ASSET_CATEGORY"}}),_c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.buildings&&_vm.buildings.length,expression:"buildings && buildings.length"}],attrs:{label:"Buildings",value:"BUILDINGS"}}),_c("el-option",{directives:[{name:"show",rawName:"v-show",value:_vm.model.woData.sites&&_vm.model.woData.sites.length>0,expression:"model.woData.sites && model.woData.sites.length > 0"}],attrs:{label:"Sites",value:"ALL_SITES"}})],1)],1)],1),_vm.model.woData.sites&&_vm.model.woData.sites.length<=1?_c("el-row",{staticClass:"mT30"},["BUILDINGS"!=_vm.model.woData.resourceType&&"ALL_SITES"!=_vm.model.woData.resourceType?_c("el-col",{staticClass:"fc-building-col-left",attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mB10"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.building"))+" ")])]):_vm._e(),"BUILDINGS"!=_vm.model.woData.resourceType&&"ALL_SITES"!=_vm.model.woData.resourceType?_c("el-col",{staticClass:"fc-width-reduce-pm-col2",attrs:{span:5}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width575px",attrs:{disabled:!(_vm.model.woData.sites&&_vm.model.woData.sites.length>0)||!_vm.model.woData.resourceType,filterable:"",clearable:"",placeholder:"Select"},on:{change:_vm.onBuildingChange},model:{value:_vm.model.woData.selectedBuilding,callback:function($$v){_vm.$set(_vm.model.woData,"selectedBuilding",$$v)},expression:"model.woData.selectedBuilding"}},_vm._l(_vm.buildings,(function(item,key){return _c("el-option",{key:key,attrs:{label:item.name,value:item.id}})})),1)],1):_vm._e()],1):_vm._e()],1),_c("el-row",[_vm.model.woData.sites&&_vm.model.woData.sites.length>0?_vm._e():_c("div",{staticClass:"mT20 form-msg-txt"},[_vm._v(" *"+_vm._s(_vm.$t("maintenance.pm_list.please_choose_site"))+". ")])]),"BUILDINGS"===_vm.model.woData.resourceType?_c("el-row",{staticClass:"mT30"},[_c("el-col",{staticClass:"fc-building-col-left",attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mB10"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.building"))+" ")])]),_c("el-col",{staticClass:"width575px"},[_c("el-select",{staticClass:"fc-select-multiple-tag width100 fc-tag width575px",attrs:{multiple:""},model:{value:_vm.model.woData.selectedBuildingList,callback:function($$v){_vm.$set(_vm.model.woData,"selectedBuildingList",$$v)},expression:"model.woData.selectedBuildingList"}},_vm._l(_vm.buildings,(function(item,key){return _c("el-option",{key:key,attrs:{label:item.name,value:item.id}})})),1)],1)],1):_vm._e(),"SPACE_CATEGORY"===_vm.model.woData.resourceType?_c("el-row",{staticClass:"mT30"},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.space_category"))+" ")])]),_c("el-col",{staticClass:"mR30",attrs:{span:5}},[_c("el-select",{staticClass:"fc-input-full-border-select2 pm-select-width",attrs:{filterable:"",placeholder:_vm.$t("maintenance.pm_list.space_category")},model:{value:_vm.model.woData.spacecategoryId,callback:function($$v){_vm.$set(_vm.model.woData,"spacecategoryId",$$v)},expression:"model.woData.spacecategoryId"}},_vm._l(_vm.spacecategory,(function(item,key){return _vm.fetchedSpaces.includes(Number(key))?_c("el-option",{key:key,attrs:{label:item,value:key}}):_vm._e()})),1)],1),_c("el-col",{staticClass:"mL40",attrs:{span:2}},["SPACE_CATEGORY"===_vm.model.woData.resourceType?_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mB10 position-relative fc-pm-left23"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.space"))+" ")]):_vm._e()]),_c("el-col",{staticClass:"mL40 position-relative",attrs:{span:5}},[_c("el-select",{staticClass:"multi suffix-disabled fc-input-full-border-select2 fc-tag tag-overflow pm-select-width",attrs:{filterable:"",multiple:"","collapse-tags":"",disabled:""},model:{value:_vm.dummyValue1,callback:function($$v){_vm.dummyValue1=$$v},expression:"dummyValue1"}},[_c("el-option",{attrs:{label:_vm.spaceLabel,value:1}})],1),_c("i",{staticClass:"el-icon-search web-form-search-icon",on:{click:function($event){_vm.showAsset=!1,_vm.chooserVisibility=!0}}})],1)],1):"ASSET_CATEGORY"===_vm.model.woData.resourceType?_c("el-row",{staticClass:"mT30"},[_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14 mT10"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.asset_category"))+" ")])]),_c("el-col",{staticClass:"mR30 mL8",attrs:{span:5}},[_c("el-select",{staticClass:"fc-input-full-border-select2 pm-select-width fc-tag tag-overflow",attrs:{placeholder:_vm.$t("maintenance.pm_list.asset_category"),filterable:"","collapse-tags":""},model:{value:_vm.model.woData.assetCategoryId,callback:function($$v){_vm.$set(_vm.model.woData,"assetCategoryId",$$v)},expression:"model.woData.assetCategoryId"}},_vm._l(_vm.assetcategory,(function(item,key){return _vm.fetchedAssets.includes(Number(item.id))?_c("el-option",{key:key,attrs:{label:item.displayName,value:item.id}}):_vm._e()})),1)],1),_c("el-col",{staticClass:"mL35",attrs:{span:2}},["ASSET_CATEGORY"===_vm.model.woData.resourceType?_c("div",{staticClass:"fc-dark-grey-txt14 mT10 mB10 position-relative fc-pm-left23"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.asset"))+" ")]):_vm._e()]),"ASSET_CATEGORY"===_vm.model.woData.resourceType?_c("el-col",{staticClass:"position-relative mL40",attrs:{span:5}},[_c("el-select",{staticClass:"multi suffix-disabled fc-input-full-border-select2 pm-select-width fc-tag tag-overflow",attrs:{filterable:"",multiple:"",disabled:""},model:{value:_vm.dummyValue,callback:function($$v){_vm.dummyValue=$$v},expression:"dummyValue"}},[_c("el-option",{attrs:{label:_vm.resourceLabel,value:1}})],1),_c("i",{staticClass:"el-icon-search web-form-search-icon",on:{click:function($event){_vm.showAsset=!0,_vm.chooserVisibility=!0}}})],1):_vm._e()],1):_vm._e(),"ALL_FLOORS"===_vm.model.woData.resourceType&&_vm.model.woData.selectedBuilding?_c("el-row",{staticClass:"mT20"},[_c("el-col",{staticClass:"mT20",attrs:{span:4}},[_c("div",{staticClass:"fc-dark-grey-txt14"},[_vm._v("Floor")])]),_c("el-col",{staticClass:"position-relative",attrs:{span:15}},[_c("el-select",{staticClass:"multi mT10 suffix-disabled fc-input-full-border-select2 width575px fc-tag",attrs:{filterable:"",multiple:"",disabled:""},model:{value:_vm.dummyValue2,callback:function($$v){_vm.dummyValue2=$$v},expression:"dummyValue2"}},[_c("el-option",{attrs:{label:_vm.floorLabel,value:1}})],1),_c("i",{staticClass:"el-icon-search web-form-search-icon2",on:{click:function($event){_vm.showAsset=!1,_vm.chooserVisibility=!0}}})],1)],1):_vm._e(),_c("div",{staticClass:"mT40 pB30"},[_c("div",[_c("el-checkbox",{staticClass:"fw4",model:{value:_vm.model.woData.isPreventOnNoTask,callback:function($$v){_vm.$set(_vm.model.woData,"isPreventOnNoTask",$$v)},expression:"model.woData.isPreventOnNoTask"}},[_vm._v(_vm._s(_vm.$t("maintenance.pm_list.prevent_pm_with_no_task")))])],1),_c("div",{staticClass:"mT20"},[_c("el-checkbox",{staticClass:"fw4",model:{value:_vm.model.woData.isSignatureRequired,callback:function($$v){_vm.$set(_vm.model.woData,"isSignatureRequired",$$v)},expression:"model.woData.isSignatureRequired"}},[_vm._v(_vm._s(_vm.$t("maintenance.pm_list.enable_e_sign")))])],1),_c("div",{staticClass:"mT20"},[_c("el-checkbox",{staticClass:"fw4",model:{value:_vm.model.woData.sendForApproval,callback:function($$v){_vm.$set(_vm.model.woData,"sendForApproval",$$v)},expression:"model.woData.sendForApproval"}},[_vm._v("Send for approval")])],1),_vm.isWorkPermitLicenseEnabled?_c("div",{staticClass:"mT20"},[_c("el-checkbox",{staticClass:"fw4",model:{value:_vm.model.woData.workPermitNeeded,callback:function($$v){_vm.$set(_vm.model.woData,"workPermitNeeded",$$v)},expression:"model.woData.workPermitNeeded"}},[_vm._v("Work permit required")])],1):_vm._e(),_c("div",{staticClass:"mT20 flex align-center"},[_c("el-checkbox",{staticClass:"fw4",model:{value:_vm.model.woData.isOffsetWOCreation,callback:function($$v){_vm.$set(_vm.model.woData,"isOffsetWOCreation",$$v)},expression:"model.woData.isOffsetWOCreation"}},[_vm._v("Pre-generate work orders before ")]),_vm.model.woData.isOffsetWOCreation?_c("div",{staticClass:"flex items-baseline mL15"},[_c("span",{staticClass:"fwBold"},[_vm._v("Days")]),_c("el-input",{staticClass:"mL15 pm-input-width70 fw4 fc-input-full-border2",model:{value:_vm.model.woData.offsetDays,callback:function($$v){_vm.$set(_vm.model.woData,"offsetDays",$$v)},expression:"model.woData.offsetDays"}})],1):_vm._e(),_vm.model.woData.isOffsetWOCreation?_c("div",{staticClass:"flex items-baseline mL15"},[_c("span",{staticClass:"fwBold"},[_vm._v("Hours")]),_c("el-input",{staticClass:"mL15 pm-input-width70 fw4 fc-input-full-border2",model:{value:_vm.model.woData.offsetHours,callback:function($$v){_vm.$set(_vm.model.woData,"offsetHours",$$v)},expression:"model.woData.offsetHours"}})],1):_vm._e()],1),_c("div",{staticClass:"mT20"},[_c("el-checkbox",{staticClass:"fw4",model:{value:_vm.model.woData.markIgnoredWo,callback:function($$v){_vm.$set(_vm.model.woData,"markIgnoredWo",$$v)},expression:"model.woData.markIgnoredWo"}},[_vm._v(" Skip workorders if not started till next due ")])],1)]),_c("el-row",{staticClass:"fc-pm-border-top"},[_c("el-col",{attrs:{span:1}},[_c("img",{staticClass:"mT25",attrs:{src:__webpack_require__(759597),width:"24px",height:"24px"}})]),_c("el-col",{attrs:{span:20}},[_c("div",{staticClass:"fc-black-15 mT15 mL10"},[_c("span",{staticClass:"bold"},[_vm._v(" "+_vm._s(_vm.resourceListLength)+" "+_vm._s(_vm.$t("maintenance.pm_list.workorders"))+" ")]),_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.no_of_workorder_mapped_1"))+" "),_c("br"),_vm._v(" "+_vm._s(_vm.$t("maintenance.pm_list.no_of_workorder_mapped_2"))+" ")])])],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"fc-full-btn-fill-green f13",attrs:{type:"button"},on:{click:_vm.moveToNext}},[_vm._v("PROCEED TO NEXT "),_c("img",{staticClass:"fR",attrs:{src:__webpack_require__(936658),width:"17px"}})])],1),_c("space-asset-multi-chooser",{attrs:{hideBanner:!0,visibility:_vm.chooserVisibility,query:_vm.model.woData.resourceQuery,showAsset:_vm.showAsset,disable:!0,initialValues:_vm.initialValues,filter:_vm.filter,resourceType:_vm.resourceFilter},on:{associate:_vm.associateResource,"update:visibility":function($event){_vm.chooserVisibility=$event}}})],1)])])])},PMConfigFormvue_type_template_id_1696e4e8_staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fc-pm-main-content-H"},[_vm._v(" CONFIGURATION "),_c("div",{staticClass:"fc-heading-border-width43 mT15"})])}],FLookupField=__webpack_require__(855048),FLookupFieldWizard=__webpack_require__(499751),PMConfigFormvue_type_script_lang_js={props:["model"],components:{SpaceAssetMultiChooser:SpaceAssetMultiChooser/* default */.Z,FLookupFieldWizard:FLookupFieldWizard["default"],FLookupField:FLookupField/* default */.Z},created:function(){this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadGroups"),// if required, get users/groups from pmnewform.vue as props, which is fetched from PMMixin.getScopedGroupsAndUsers().
this.$store.dispatch("loadBuildings")},data:function(){return{siteField:{isDataLoading:!1,lookupModuleName:"site",field:{lookupModule:{name:"site",displayName:"Site"}},filters:{},multiple:!0},canShowLookupWizard:!1,selectedLookupField:null,loadingOption:!1,showFloorOption:!0,fetchedAssets:[],fetchedSpaces:[],buildings:[],dummyValue:[1],dummyValue1:[1],dummyValue2:[1],chooserVisibility:!1,showAsset:!0,isFromAssociateResourceMethod:!1}},methods:{showLookupWizard:function(field,canShow){this.$set(this,"selectedLookupField",field),this.$set(this,"canShowLookupWizard",canShow)},setLookupFieldValue:function(_ref){var _this=this,field=_ref.field;this.model.woData.sites=field.selectedItems.map((function(item){return item.value}));var options=this.fields.options,selectedItemsInOptions=options.filter((function(option){return _this.model.woData.sites.includes(option.value)})),selectedItemIdsInOptions=selectedItemsInOptions.map((function(item){return item.value})),selectedItemsNotInOptions=field.selectedItems.filter((function(item){return!selectedItemIdsInOptions.includes(item.value)}));this.$set(this.fields,"options",[].concat((0,toConsumableArray/* default */.Z)(options),(0,toConsumableArray/* default */.Z)(selectedItemsNotInOptions)))},moveToNext:function(){this.$emit("next")},resourceListAllFloorsHandler:function(newVal,oldVal){var _this2=this;if(!this.model.isEdit||!this.model.isLoading)if("ALL_FLOORS"===this.model.woData.resourceType)if(this.model.woData.selectedFloorList&&0!==this.model.woData.selectedFloorList.length)if(null===this.model.woData.isIncludeFloor||void 0===this.model.woData.isIncludeFloor||this.model.woData.isIncludeFloor){var presentInFloorList={};this.model.woData.selectedFloorList.forEach((function(i){return presentInFloorList[i.id]=!0}));var presentInRPList={};this.model.woData.resourceList.forEach((function(resource){presentInRPList[resource.id]=!0})),this.model.woData.selectedFloorList.forEach((function(i){presentInRPList[i.id]||_this2.model.woData.resourceList.push({id:i.id,triggerNames:["0"],assignedTo:null,notifications:[],selected:!1})}));var newResourceList=[];this.model.woData.resourceList.forEach((function(resource){presentInFloorList[resource.id]&&newResourceList.push(resource)})),this.$set(this.model.woData,"resourceList",newResourceList)}else this.$util.loadSpace([3],null,[{key:"site",value:this.model.woData.woModel.site.id},{key:"building",value:this.model.woData.selectedBuilding}]).then((function(data){var rList=data.basespaces.filter((function(i){for(var j=0;j<_this2.model.woData.selectedFloorList.length;j++)if(_this2.model.woData.selectedFloorList[j].id===i.id)return!1;return!0}));_this2.$set(_this2.model.woData,"resourceList",rList),_this2.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}));else this.$util.loadSpace([3],null,[{key:"building",value:this.model.woData.selectedBuilding}]).then((function(data){_this2.$set(_this2.model.woData,"resourceList",data.basespaces),_this2.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}));else if("ALL_SITES"===this.model.woData.resourceType&&!(0,validation/* isEmpty */.xb)(this.model.woData.sites)&&this.model.woData.sites.length>0){
// Handling Site Level PM - Sites
var selectedSites=this.model.woData.sites,resourceList=[];selectedSites.forEach((function(siteId){_this2.allSitesMap[siteId]&&resourceList.push(_this2.allSitesMap[siteId])})),
// Add into this.model.woData.resourceList
this.$set(this.model.woData,"resourceList",resourceList),
// Add into this.model.woData.selectedSitesList
this.model.woData.selectedSitesList=resourceList,this.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}},associateResource:function(selectedObj){this.isFromAssociateResourceMethod=!0,selectedObj.resourceList&&selectedObj.resourceList.length?("ASSET_CATEGORY"===this.model.woData.resourceType?(this.model.woData.selectedResourceList=selectedObj.resourceList,this.model.woData.isIncludeResource=selectedObj.isInclude):"SPACE_CATEGORY"===this.model.woData.resourceType?(this.model.woData.selectedSpaceList=selectedObj.resourceList,this.model.woData.isIncludeSpace=selectedObj.isInclude):"ALL_FLOORS"===this.model.woData.resourceType&&(this.model.woData.selectedFloorList=selectedObj.resourceList,this.model.woData.isIncludeFloor=selectedObj.isInclude),this.resourceListHandler()):(this.model.woData.resourceList=[],this.model.woData.selectedResourceList=[],this.model.woData.isIncludeResource=!0,this.model.woData.selectedSpaceList=[],this.model.woData.isIncludeSpace=!0,this.model.woData.selectedFloorList=[],this.model.woData.isIncludeFloor=!0),this.chooserVisibility=!1,this.model.woData.resourceQuery=null,this.isFromAssociateResourceMethod=!1},resourceListHandler:function(){var _this3=this;if(!this.model.isEdit||!this.model.isLoading)if("SPACE_CATEGORY"===this.model.woData.resourceType)if(this.model.woData.selectedSpaceList&&0!==this.model.woData.selectedSpaceList.length)if(this.isFromAssociateResourceMethod&&(null===this.model.woData.isIncludeSpace||void 0===this.model.woData.isIncludeSpace||this.model.woData.isIncludeSpace)){var presentInSpaceList={};this.model.woData.selectedSpaceList.forEach((function(i){return presentInSpaceList[i.id]=!0}));var presentInRPList={};this.model.woData.resourceList.forEach((function(resource){presentInRPList[resource.id]=!0})),this.model.woData.selectedSpaceList.forEach((function(i){presentInRPList[i.id]||_this3.model.woData.resourceList.push({id:i.id,triggerNames:["0"],assignedTo:null,notifications:[],selected:!1,name:i.name})}));var newResourceList=[];this.model.woData.resourceList.forEach((function(resource){presentInSpaceList[resource.id]&&newResourceList.push(resource)})),this.$set(this.model.woData,"resourceList",newResourceList)}else this.model.woData.spacecategoryId&&this.model.woData.spacecategoryId>0&&(this.isMultiSite()?this.loadMultiSiteSpaces():this.loadSingleSiteSpaces());else this.model.woData.spacecategoryId&&this.model.woData.spacecategoryId>0&&(this.isMultiSite()?this.loadMultiSiteSpaces():this.loadSingleSiteSpaces());else if("ASSET_CATEGORY"===this.model.woData.resourceType)if(this.model.woData.selectedResourceList&&0!==this.model.woData.selectedResourceList.length)if(this.isFromAssociateResourceMethod&&(null===this.model.woData.isIncludeResource||void 0===this.model.woData.isIncludeResource||this.model.woData.isIncludeResource)){var presentInAssetList={};this.model.woData.selectedResourceList.forEach((function(i){return presentInAssetList[i.id]=!0}));var _presentInRPList={};this.model.woData.resourceList.forEach((function(resource){_presentInRPList[resource.id]=!0})),this.model.woData.selectedResourceList.forEach((function(i){_presentInRPList[i.id]||_this3.model.woData.resourceList.push({id:i.id,triggerNames:["0"],assignedTo:null,notifications:[],selected:!1,name:i.name})}));var _newResourceList=[];this.model.woData.resourceList.forEach((function(resource){presentInAssetList[resource.id]&&_newResourceList.push(resource)})),this.$set(this.model.woData,"resourceList",_newResourceList)}else this.model.woData.assetCategoryId&&this.model.woData.assetCategoryId>0&&(this.isMultiSite()?this.loadMultiSiteAssets():this.loadSingleSiteAssets());else this.model.woData.assetCategoryId&&this.model.woData.assetCategoryId>0&&(this.isMultiSite()?this.loadMultiSiteAssets():this.loadSingleSiteAssets())},onBuildingChange:function(buildingId){this.getScopeFilteredValues(this.model.woData.sites,buildingId)},getScopeFilteredValues:function(siteIds,buildingId){var _this4=this;if((siteIds||buildingId)&&(!siteIds||0!==siteIds.length)){var params="";if(siteIds)if(1===siteIds.length)params="siteIds=".concat(siteIds[0]);else{params="siteIds=".concat(siteIds[0]);for(var i=1;i<siteIds.length;i++)params+="&siteIds=".concat(siteIds[i])}buildingId&&(params=params?"".concat(params,"&buildingId=").concat(buildingId):"buildingId=".concat(buildingId)),this.loadingOption=!0,this.$http.get("/workorder/getScopeFilteredValuesForPM?".concat(params)).then((function(response){_this4.showFloorOption=response.data.hasFloor,_this4.fetchedAssets=response.data.assetCategoryIds||[],_this4.fetchedSpaces=response.data.spaceCategoryIds||[],_this4.buildings=response.data.buildings||[],_this4.loadingOption=!1}))}},isMultiSite:function(){return this.model.woData.sites&&this.model.woData.sites.length>1},loadSingleSiteSpaces:function(){var _this5=this,filter=[];this.model.woData.sites[0]&&filter.push({key:"site",operator:"is",value:this.model.woData.sites[0]}),this.model.woData.selectedBuilding&&this.model.woData.selectedBuilding>0&&filter.push({key:"building",operator:"is",value:this.model.woData.selectedBuilding}),filter.push({key:"spaceCategory",operator:"is",value:this.model.woData.spacecategoryId}),this.$util.loadSpacesContextPmConfigForm(4,null,filter).then((function(response){var spaces=response.records.filter((function(i){for(var j=0;j<_this5.model.woData.selectedSpaceList.length;j++)if(_this5.model.woData.selectedSpaceList[j].id===i.id)return!1;return!0}));_this5.$set(_this5.model.woData,"resourceList",spaces),_this5.$set(_this5.model.woData,"selectedSpaceList",spaces),_this5.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}))},loadMultiSiteSpaces:function(){var _this6=this,sitesStr=[];if(this.model.woData.sites&&this.model.woData.sites.length>0&&this.model.woData.sites.length>1)for(var i=0;i<this.model.woData.sites.length;i++)this.model.woData.sites[i]>0&&sitesStr.push(String(this.model.woData.sites[i]));if(this.model.woData.spacecategoryId&&this.model.woData.spacecategoryId>0){var filters=[];sitesStr&&filters.push({key:"site",operator:"is",value:sitesStr}),this.model.woData.selectedBuilding&&this.model.woData.selectedBuilding>0&&filters.push({key:"building",operator:"is",value:this.model.woData.selectedBuilding}),this.model.woData.spacecategoryId>0&&filters.push({key:"spaceCategory",operator:"is",value:this.model.woData.spacecategoryId}),this.$util.loadSpacesContextPmConfigForm(4,null,filters).then((function(response){_this6.$set(_this6.model.woData,"resourceList",response.records),_this6.$set(_this6.model.woData,"selectedSpaceList",response.records),_this6.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}))}},loadMultiSiteAssets:function(){var _this7=this;this.$util.loadAsset({spaceIds:this.model.woData.sites,categoryId:this.model.woData.assetCategoryId}).then((function(response){_this7.$set(_this7.model.woData,"resourceList",response.assets),_this7.$set(_this7.model.woData,"selectedResourceList",response.assets),_this7.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}))},loadSingleSiteAssets:function(){var _this8=this,spaceId=this.model.woData.selectedBuilding;(!this.model.woData.selectedBuilding||this.model.woData.selectedBuilding<0)&&(spaceId=this.model.woData.sites[0]),this.$util.loadAsset({spaceId:spaceId,categoryId:this.model.woData.assetCategoryId}).then((function(response){var assets=response.assets.filter((function(i){for(var j=0;j<_this8.model.woData.selectedResourceList.length;j++)if(_this8.model.woData.selectedResourceList[j].id===i.id)return!1;return!0}));_this8.$set(_this8.model.woData,"resourceList",assets),_this8.$set(_this8.model.woData,"selectedResourceList",assets),_this8.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}))}},watch:{"model.isLoading":function(val){!this.model.isLoading&&this.model.isEdit&&this.onBuildingChange(this.model.woData.selectedBuilding,this.model.woData.selectedBuildingList)},"model.woData.workOrderType":function(val){val&&"single"===val?(this.model.woData.spacecategoryId=null,this.model.woData.assetCategoryId=null,this.model.woData.selectedBuilding=null,this.model.woData.resourceType=null,this.model.woData.selectedResourceList=[],this.model.woData.selectedFloorList=[],this.model.woData.selectedSpaceList=[],this.$set(this.model.woData,"resourceList",[])):val&&"bulk"===val&&(this.model.woData.singleResource=null,this.model.woData.spaceAssetDisplayName=null)},"model.woData.resourceType":{handler:function(newVal,oldVal){this.model.isLoading||(this.model.woData.selectedBuilding=null,this.model.woData.spacecategoryId=null,this.model.woData.assetCategoryId=null,this.model.woData.selectedResourceList=[],this.model.woData.selectedFloorList=[],this.model.woData.selectedSpaceList=[],this.model.woData.selectedBuildingList=[],this.model.woData.selectedSitesList=[],this.$set(this.model.woData,"resourceList",[]),this.resourceListAllFloorsHandler(newVal,oldVal))},deep:!0},"model.woData.selectedSpaceList":{handler:function(newVal,oldVal){this.resourceListAllFloorsHandler(newVal,oldVal)},deep:!0},"model.woData.selectedResourceList":{handler:function(newVal,oldVal){this.resourceListAllFloorsHandler(newVal,oldVal)},deep:!0},"model.woData.selectedFloorList":{handler:function(newVal,oldVal){this.resourceListAllFloorsHandler(newVal,oldVal)},deep:!0},"model.woData.selectedBuilding":function(newVal,oldVal){this.model.isLoading||(this.model.woData.selectedResourceList=[],this.model.woData.selectedFloorList=[],this.model.woData.selectedSpaceList=[],this.model.woData.spacecategoryId=null,this.model.woData.assetCategoryId=null,this.$set(this.model.woData,"resourceList",[]))},"model.woData.sites":{handler:function(val,oldVal){this.model.isLoading||(this.model.woData.woModel.hasOwnProperty("groups")&&(this.model.woData.woModel.groups.id=""),
//this.model.woData.selectedBuilding = null
this.model.woData.resourceType=null,this.model.woData.spacecategoryId=null,this.model.woData.assetCategoryId=null,this.model.woData.resourceList=[],this.getScopeFilteredValues(val))},deep:!0},"model.woData.selectedBuildingList":{handler:function(val,oldVal){if(!this.loadingOption&&(!this.model.isEdit||!this.model.isLoading)){var resourceList=[];if("BUILDINGS"===this.model.woData.resourceType){if(val&&val.length>0){var model=this.model,_this$buildings=this.buildings,buildings=void 0===_this$buildings?[]:_this$buildings,_ref2=model||{},woData=_ref2.woData,_ref3=woData||{},_ref3$resourceList=_ref3.resourceList,_resourceList=void 0===_ref3$resourceList?[]:_ref3$resourceList,resourceListMap={},buildingsListMap={};_resourceList.forEach((function(resource,index){resourceListMap[resource.id]=index})),buildings.forEach((function(building,index){buildingsListMap[building.id]=index}));for(var i=0;i<val.length;i++){var buildingId=val[i]>=0?val[i]:-1,buildingIndex=this.$getProperty(buildingsListMap,"".concat(buildingId),-1);if(buildingIndex>-1){var building=buildings[buildingIndex]||{},id=building.id;if(buildingId===id){var index=resourceListMap[building.id],defaultResourceMeta={triggerNames:["0"],assignedTo:null,notifications:[],selected:!1},resource=_resourceList[index]||defaultResourceMeta;resourceList.push((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},building),resource))}}}}else if(resourceList=this.$getProperty(this,"buildings",[]),(0,validation/* isEmpty */.xb)(resourceList)||(resourceList=resourceList.map((function(resource){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},resource),{},{triggerNames:["0"],assignedTo:null,notifications:[],selected:!1})}))),this.model.woData.selectedBuildingList=[],this.buildings)for(var _i=0;_i<this.buildings.length;_i++)this.model.woData.selectedBuildingList.push(this.buildings[_i].id);this.$set(this.model.woData,"resourceList",resourceList)}}},deep:!0},"model.woData.assetCategoryId":{handler:function(newVal,oldVal){newVal!==oldVal&&this.resourceListHandler(newVal,oldVal)},deep:!0},"model.woData.spacecategoryId":{handler:function(newVal,oldVal){newVal!==oldVal&&this.resourceListHandler(newVal,oldVal)},deep:!0}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({allsites:function(state){return state.sites},assetcategory:function(state){return state.assetCategory}})),(0,vuex_esm/* mapGetters */.Se)(["getSpaceCategoryPickList"])),{},{spacecategory:function(){return this.getSpaceCategoryPickList()},
// Adding `allSitesMap` for easier lookup of site objects
allSitesMap:function(){
// Converting `this.allsites` into map/object
var siteMapping={};return this.allsites.forEach((function(site){siteMapping[site.id]=site})),siteMapping},spaceCategoryName:function(){if(this.model.woData.spacecategoryId>0&&this.spacecategory){var category=this.spacecategory[this.model.woData.spacecategoryId];if(category)return category}return""},floorLabel:function(){if(this.dummyValue2=[1],this.model.woData.selectedFloorList){var message,selectedCount=this.model.woData.selectedFloorList.length;return message=selectedCount?"".concat(selectedCount," Floors"):"All Floors",this.model.woData.resourceLabel=message,message}this.dummyValue2=[]},spaceLabel:function(){if(this.dummyValue1=[1],this.model.woData.spacecategoryId>0){var message,selectedCount=this.model.woData.selectedSpaceList.length;return message=selectedCount?"".concat(selectedCount," ").concat(this.spaceCategoryName):"All ".concat(this.spaceCategoryName),this.model.woData.resourceLabel=message,message}this.dummyValue1=[]},categoryName:function(){var _this9=this;if(this.model.woData.assetCategoryId>0&&this.assetcategory){var category=this.assetcategory.find((function(category){return category.id===_this9.model.woData.assetCategoryId}));if(category)return category.name}return""},resourceLabel:function(){if(this.dummyValue=[1],this.model.woData.assetCategoryId>0){var message,selectedCount=this.model.woData.selectedResourceList.length;if(selectedCount){if(1===selectedCount)return this.model.woData.selectedResourceList[0].name;message="".concat(selectedCount," ").concat(this.categoryName)}else message="All ".concat(this.categoryName);return this.model.woData.resourceLabel=message,message}this.dummyValue=[]},isWorkPermitLicenseEnabled:function(){var $helpers=this.$helpers,_ref4=$helpers||{},isLicenseEnabled=_ref4.isLicenseEnabled;return isLicenseEnabled("WORK_PERMIT")},filter:function(){var filter={},model=this.model,_ref5=model||{},woData=_ref5.woData,_ref6=woData||{},_ref6$sites=_ref6.sites,sites=void 0===_ref6$sites?[]:_ref6$sites;return!(0,validation/* isEmpty */.xb)(sites)&&sites.length>1?filter.site=sites.map((function(site){return site?Number(site):-1})):filter.site=Number(sites[0])||-1,this.model.woData.selectedBuilding&&(filter.buildingId=Number(this.model.woData.selectedBuilding)),filter},resourceFilter:function(){return"ALL_FLOORS"===this.model.woData.resourceType?[3]:null},initialValues:function(){return"ASSET_CATEGORY"===this.model.woData.resourceType?{assetCategory:this.model.woData.assetCategoryId,isIncludeResource:this.model.woData.isIncludeResource,selectedResources:this.model.woData.selectedResourceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))}:"SPACE_CATEGORY"===this.model.woData.resourceType?{spaceCategory:this.model.woData.spacecategoryId,isIncludeResource:this.model.woData.isIncludeSpace,selectedResources:this.model.woData.selectedSpaceList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))}:"ALL_FLOORS"===this.model.woData.resourceType?{isIncludeResource:this.model.woData.isIncludeFloor,selectedResources:this.model.woData.selectedFloorList.map((function(resource){return{id:resource&&"object"===(0,esm_typeof/* default */.Z)(resource)?resource.id:resource}}))}:void 0},resourceListLength:function(){var model=this.model,_ref7=model||{},woData=_ref7.woData,_ref8=woData||{},_ref8$resourceList=_ref8.resourceList,resourceList=void 0===_ref8$resourceList?[]:_ref8$resourceList;return resourceList.length}})},multisitepreventive_PMConfigFormvue_type_script_lang_js=PMConfigFormvue_type_script_lang_js,PMConfigForm_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_PMConfigFormvue_type_script_lang_js,PMConfigFormvue_type_template_id_1696e4e8_render,PMConfigFormvue_type_template_id_1696e4e8_staticRenderFns,!1,null,null,null)
/* harmony default export */,PMConfigForm=PMConfigForm_component.exports,FormMixin=__webpack_require__(674811),router=__webpack_require__(329435),cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),pmnewformvue_type_script_lang_js={mixins:[PMMixin/* default */.Z,FormMixin/* default */.Z],data:function(){return{currentView:"pmconfig",show:{pmconfig:!0,workorder:!1,prerequests:!1,tasks:!1,trigger:!1,review:!1,resourceplan:!1,workorderNx:!1},model:{isEdit:!1,isLoading:!1,emitForm:!1,woData:{sites:[],woModel:null,workOrderType:"bulk",resourceLabel:"",resourceName:"",selectedBuilding:null,spacecategoryId:null,resourceQuery:null,selectedResourceList:[],isIncludeResource:!0,assetCategoryId:null,resourceType:null,selectedSpaceList:[],isIncludeSpace:!0,selectedFloorList:[],isIncludeFloor:!0,selectedBuildingList:[],selectedSitesList:[],singleResource:null,quickSearchQuery:"",spaceAssetDisplayName:"",resourceList:[],isPreventOnNoTask:!0,isSignatureRequired:!1,isOffsetWOCreation:!1,woCreationOffset:0,offsetDays:0,offsetHours:0,sendForApproval:!1,workPermitNeeded:!1,markIgnoredWo:!1,enableSkipTriggers:!1},taskData:{taskSections:[{name:"Untitled Section",category:null,dummyValue:[1],inputType:null,resourceLabel:"",selectedResourceList:[],isIncludeResource:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,options:[],triggers:[{triggerName:"All"}],additionInfo:{defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]},tasks:[{name:"",resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,inputValidationRuleId:null,validation:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,category:null,readingFields:[],additionInfo:{defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],uniqueId:1}}]}]},preRequestData:{photoMandatory:!1,allowNegative:!1,allowNegativePreRequisite:2,preRequestSections:[],approvers:[{type:null,approversId:null}],approvalTypes:[{id:1,name:"User"},{id:2,name:"Role"},{id:3,name:"Group"}]},triggerData:{defaultAssignedTo:null,isDefaultAllTriggers:!1,enableSkipTriggers:!0,triggers:[],reminders:[]}},pmFormType:{pmconfig:"Configuration",
// workorder: this.$t('common.header.workorders'),
workorderNx:this.$t("common.header.workorders"),trigger:this.$t("maintenance.pm_list.trigger"),prerequests:this.$t("maintenance._workorder.prerequisites"),tasks:this.$t("maintenance._workorder.tasks"),resourceplan:this.$t("maintenance.pm_list.resource_planning"),review:this.$t("maintenance.pm_list.review")},newTrigger:{name:"",type:-1,startHour:["00:00"],startDate:new Date,startTime:null,schedule:null,stopAfter:"never",endTime:new Date,startReading:null,readingFieldId:null,stopAfterReading:"never",endReading:null,readingInterval:null,frequency:-1,sharingContext:null},remindersTemplate:{name:null,type:null,duration:null,isEmail:null,isSms:null,isMobile:null,reminderActions:null,emailtemplate:null,smstemplate:null,mobiletemplate:null},formObj:{},durationFields:[],defaultDuration:0,users:[],teams:[]}},created:function(){var _this=this;this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadRoles");var groupsAndUsersResponse=this.getScopedGroupsAndUsers();groupsAndUsersResponse.then((function(groupsAndUsersResult){(0,validation/* isEmpty */.xb)(groupsAndUsersResult)||(_this.$set(_this,"users",groupsAndUsersResult.users),_this.$set(_this,"teams",groupsAndUsersResult.groups))}))},mounted:function(){this.fetchPmDetail()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({
//users: state => state.users,
//teams: state => state.groups,
roles:function(state){return state.roles}})),(0,vuex_esm/* mapGetters */.Se)(["getCurrentUser"])),{},{tenantId:function(){return this.$route.query.tenant}}),components:{workorder:PmWoForm,prerequests:pmformprerequest,tasks:pmformtask,trigger:pmformtrigger,review:PmReview,"resource-plan":PmResourcePlan,"old-trigger":pmformtriggerold,"old-review":OldPmReview,"pm-config":PMConfigForm,WoNxForm:WoNxForm},methods:{saved:function(){if(this.isFormSaved=!0,(0,router/* isWebTabsEnabled */.tj)()){var _ref=(0,router/* findRouteForModule */.Jp)("preventivemaintenance",router/* pageTypes */.As.LIST)||{},name=_ref.name;name&&this.$router.push({name:name,params:{viewname:"active"}})}else this.$router.push({path:"/app/wo/planned"})},edited:function(){if(this.isFormSaved=!0,(0,router/* isWebTabsEnabled */.tj)()){var id=this.$route.params.id,_ref2=(0,router/* findRouteForModule */.Jp)("preventivemaintenance",router/* pageTypes */.As.OVERVIEW)||{},name=_ref2.name;name&&this.$router.push({name:name,params:{viewname:"all",id:id}})}else{var _ref3=this.$route.query||{},edit=_ref3.edit;this.$router.replace({path:"/app/wo/planned/multisummary/".concat(edit)})}},fetchPmDetail:function(){var _this2=this,id=parseInt(this.$route.query.edit||this.$route.params.id);if(id&&(this.model.isEdit=!0),this.model.isEdit)this.model.isLoading=!0,this.$http.get("v2/workorders/pmDetail?id=".concat(id)).then((function(response){var woData=_this2.$helpers.cloneObject(response.data.workorder);woData.site={id:-1},delete woData.siteId,null!==woData&&void 0!==woData&&woData.duration&&-1===woData.duration&&(woData.duration=_this2.defaultDuration),null!==woData&&void 0!==woData&&woData.estimatedWorkDuration&&-1===woData.estimatedWorkDuration&&(woData.estimatedWorkDuration=_this2.defaultDuration),woData.assignmentGroup&&(woData.groups=_this2.$helpers.cloneObject(woData.assignmentGroup),delete woData.assignmentGroup),woData.attachments&&(woData.attachedFiles={attachments:[],uploadFiles:[]},woData.attachedFiles.attachments=woData.attachments),woData.resource&&(_this2.model.woData.singleResource=_this2.$helpers.cloneObject(woData.resource),delete woData.resource),_this2.model.woData.sendForApproval=woData.sendForApproval,_this2.model.woData.workPermitNeeded=woData.workPermitNeeded,response.data.preventivemaintenance.woCreationOffset&&response.data.preventivemaintenance.woCreationOffset>0?_this2.model.woData.woCreationOffset=response.data.preventivemaintenance.woCreationOffset:_this2.model.woData.woCreationOffset=0,_this2.model.woData.woCreationOffset&&(_this2.model.woData.offsetDays=Math.floor(_this2.model.woData.woCreationOffset/86400),_this2.model.woData.offsetHours=_this2.model.woData.woCreationOffset%86400/3600),_this2.model.woData.isOffsetWOCreation=_this2.model.woData.woCreationOffset>0,_this2.model.woData.isSignatureRequired=woData.isSignatureRequired,delete woData.isSignatureRequired,_this2.model.woData.isPreventOnNoTask=response.data.preventivemaintenance.preventOnNoTask,_this2.model.woData.sites=response.data.preventivemaintenance.siteIds;var customData=woData.data,newCustomData={};
// added this check - as data from import doesn't have custom data
(0,validation/* isEmpty */.xb)(customData)||Object.keys(customData).forEach((function(d){var cd=customData[d];(0,validation/* isObject */.Kn)(cd)&&cd.hasOwnProperty("id")&&!(0,validation/* isEmpty */.xb)(cd.id)&&(newCustomData[d]={id:parseInt(cd.id)})})),_this2.$set(_this2.model.woData,"woModel",(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},woData),newCustomData)),_this2.$set(_this2.model,"actualWoData",cloneDeep_default()(woData)),_this2.model.woData.assetCategoryId=response.data.preventivemaintenance.assetCategoryId,_this2.model.woData.spacecategoryId=String(response.data.preventivemaintenance.spaceCategoryId),_this2.model.woData.woModel.preventOnNoTask=response.data.preventivemaintenance.preventOnNoTask,_this2.model.woData.workOrderType="bulk";
// boolean flag to check if the given baseSpaceId is Site ID.
//  [ Use Case: When the user creates SPACE_CATEGORY/ASSET_CATEGORY PM,
//  site level(selects single site), and doesn't select the Building option. ]
var isBaseSpaceASiteId=!1;response.data.preventivemaintenance.siteIds&&response.data.preventivemaintenance.siteIds.forEach((function(id){id===response.data.preventivemaintenance.baseSpaceId&&(isBaseSpaceASiteId=!0)})),isBaseSpaceASiteId||(_this2.model.woData.selectedBuilding=response.data.preventivemaintenance.baseSpaceId),_this2.model.woData.markIgnoredWo=response.data.preventivemaintenance.markIgnoredWo,_this2.model.triggerData.isDefaultAllTriggers=response.data.preventivemaintenance.defaultAllTriggers||!1,_this2.model.triggerData.enableSkipTriggers=response.data.preventivemaintenance.enableSkipTriggers||!1;var resourceMap={};response.data.listOfTasks&&response.data.listOfTasks.forEach((function(t){t.resource&&t.resource.id>0&&!resourceMap.hasOwnProperty(t.resource.id)&&(resourceMap[t.resource.id]=t.resource)}));var triggerMap={};response.data.preventivemaintenance.triggers&&response.data.preventivemaintenance.triggers.forEach((function(i){triggerMap[i.id]=i})),response.data.prerequisiteApproverTemplates&&(woData.approvers=response.data.prerequisiteApproverTemplates),_this2.fillPreRequests(response.data.preRequestSectionTemplates,woData.photoMandatory,woData.allowNegativePreRequisite,woData.approvers),_this2.$nextTick((function(){
// when building is filled watchers fire
3===response.data.preventivemaintenance.pmCreationType?1===response.data.preventivemaintenance.assignmentType?(_this2.model.woData.resourceType="ALL_FLOORS",_this2.$nextTick((function(){
// when resourceType is filled watchers fire
response.data.preventivemaintenance.pmIncludeExcludeResourceContexts&&response.data.preventivemaintenance.pmIncludeExcludeResourceContexts.forEach((function(x){_this2.model.woData.selectedFloorList.push({id:x.resourceId})})),_this2.fillTasks(response.data.sectionTemplates,_this2.model.woData.resourceType,2,null,resourceMap,triggerMap),_this2.model.isLoading=!1}))):3===response.data.preventivemaintenance.assignmentType?(_this2.model.woData.resourceType="SPACE_CATEGORY",_this2.$nextTick((function(){response.data.preventivemaintenance.pmIncludeExcludeResourceContexts&&response.data.preventivemaintenance.pmIncludeExcludeResourceContexts.forEach((function(x){_this2.model.woData.selectedSpaceList.push({id:x.resourceId})})),_this2.fillTasks(response.data.sectionTemplates,_this2.model.woData.resourceType,2,null,resourceMap,triggerMap),_this2.model.isLoading=!1}))):7===response.data.preventivemaintenance.assignmentType?(_this2.model.woData.resourceType="BUILDINGS",_this2.$nextTick((function(){response.data.preventivemaintenance.pmIncludeExcludeResourceContexts&&response.data.preventivemaintenance.pmIncludeExcludeResourceContexts.forEach((function(x){_this2.model.woData.selectedBuildingList.push(x.resourceId)})),_this2.fillTasks(response.data.sectionTemplates,_this2.model.woData.resourceType,2,null,resourceMap,triggerMap),_this2.model.isLoading=!1}))):4===response.data.preventivemaintenance.assignmentType?(_this2.model.woData.resourceType="ASSET_CATEGORY",_this2.$nextTick((function(){response.data.preventivemaintenance.pmIncludeExcludeResourceContexts&&response.data.preventivemaintenance.pmIncludeExcludeResourceContexts.forEach((function(x){_this2.model.woData.selectedResourceList.push({id:x.resourceId})})),_this2.fillTasks(response.data.sectionTemplates,_this2.model.woData.resourceType,2,null,resourceMap,triggerMap),_this2.model.isLoading=!1}))):8===response.data.preventivemaintenance.assignmentType&&(_this2.model.woData.resourceType="ALL_SITES",_this2.$nextTick((function(){response.data.preventivemaintenance.pmIncludeExcludeResourceContexts&&response.data.preventivemaintenance.pmIncludeExcludeResourceContexts.forEach((function(x){_this2.model.woData.selectedSitesList.push(x.resourceId)})),_this2.fillTasks(response.data.sectionTemplates,_this2.model.woData.resourceType,2,null,resourceMap,triggerMap),_this2.model.isLoading=!1}))):_this2.$nextTick((function(){_this2.fillTasks(response.data.sectionTemplates,_this2.model.woData.resourceType,1,_this2.model.woData.singleResource,resourceMap,triggerMap),_this2.model.isLoading=!1})),response.data.workorder.assignedTo&&(_this2.model.triggerData.defaultAssignedTo=response.data.workorder.assignedTo.id),response.data.reminders&&(_this2.model.triggerData.reminders=[],response.data.reminders&&response.data.reminders.length&&response.data.reminders.forEach((function(r){var reminder=_this2.$helpers.cloneFromSchema(_this2.remindersTemplate,r);reminder.reminderActions&&reminder.reminderActions.length&&reminder.reminderActions.forEach((function(ra){3===ra.action.actionType?reminder.isEmail=!0:4===ra.action.actionType?reminder.isSms=!0:7===ra.action.actionType&&(reminder.isMobile=!0)})),_this2.model.triggerData.reminders.push(reminder)}))),response.data.preventivemaintenance.triggers&&(_this2.model.triggerData.triggers=response.data.preventivemaintenance.triggers.map((function(trigger){var newTrigger=_this2.$helpers.cloneObject(_this2.newTrigger);for(var key in newTrigger)trigger.hasOwnProperty(key)&&trigger[key]&&-1!==trigger[key]&&(newTrigger[key]=trigger[key]);if(0===trigger["frequency"]&&(newTrigger["frequency"]=0),1===trigger.triggerExecutionSource)newTrigger.type=1,trigger.schedule.timeObjects=null,newTrigger.initialSchedule=trigger.schedule,newTrigger.initialSchedule.facilioFrequency=trigger.frequency,newTrigger.initialSchedule.custom=trigger.schedule.custom,trigger.custom&&(newTrigger.initialSchedule.custom=trigger.custom),newTrigger.startHour=trigger.schedule.times,newTrigger.startTime&&-1!==newTrigger.startTime&&(newTrigger.startDate=new Date(newTrigger.startTime).setHours(0,0,0,0)),newTrigger.endTime&&-1!==newTrigger.endTime&&(newTrigger.endTime=new Date(newTrigger.endTime),newTrigger.stopAfter="time");else if(2===trigger.triggerExecutionSource)newTrigger.type=2,newTrigger.stopAfterReading=trigger.endReading&&-1!==trigger.endReading?"reading":"never";else if(3===trigger.triggerExecutionSource)newTrigger.type=3,trigger.workFlowRule&&(newTrigger.criteria=trigger.workFlowRule.criteria,delete newTrigger.criteria.regEx,delete newTrigger.criteria.computedValues,newTrigger.criteria.conditions&&Object.keys(newTrigger.criteria.conditions).forEach((function(i){delete newTrigger.criteria.conditions[i].computedValues,delete newTrigger.criteria.conditions[i].computedWhereClause})));else if(4===trigger.triggerExecutionSource){newTrigger.type=4;var sharingContext=newTrigger.sharingContext,newSharingContext={shareTo:null,sharedRoles:[],sharedUsers:[],sharedGroups:[]};if(sharingContext&&0!==sharingContext.length)if(1===sharingContext.length&&sharingContext[0].userId===_this2.getCurrentUser().ouid)newSharingContext.shareTo=1,newSharingContext.sharedUsers=[sharingContext[0].userId];else{newSharingContext.shareTo=3;for(var i=0;i<sharingContext.length;i++)1===sharingContext[i].type?newSharingContext.sharedUsers.push(sharingContext[i].userId):2===sharingContext[i].type?newSharingContext.sharedRoles.push(sharingContext[i].roleId):3===sharingContext[i].type&&newSharingContext.sharedGroups.push(sharingContext[i].groupId)}else newSharingContext.shareTo=2;newTrigger.sharingContext=newSharingContext}else if(5===trigger.triggerExecutionSource){var customTrigger;if(newTrigger.type=5,1===trigger.executeOn)customTrigger={executeOn:trigger.executeOn,days:0,hours:0,customModuleId:trigger.customModuleId,fieldId:trigger.fieldId};else{var days=Math.floor(trigger.executionOffset/86400),hours=trigger.executionOffset%86400;customTrigger={executeOn:trigger.executeOn,days:days,hours:hours,customModuleId:trigger.customModuleId,fieldId:trigger.fieldId}}newTrigger.customTrigger=customTrigger}return newTrigger}))),_this2.$nextTick((function(){var resources=response.data.preventivemaintenance.resourcePlanners;resources&&resources.forEach((function(r){var selected=!1,triggerNames=[],name=r.resource?r.resource.name:"",assignedTo=r.assignedToId,notifications=[],id=r.resourceId;r.triggerContexts&&response.data.preventivemaintenance.triggers&&r.triggerContexts.forEach((function(k){var trigger=response.data.preventivemaintenance.triggers.find((function(i){return i.id===k.id}));trigger&&triggerNames.push(trigger.name)})),null!=triggerNames&&triggerNames.length||(triggerNames=["0"]),r.pmResourcePlannerReminderContexts&&r.pmResourcePlannerReminderContexts.forEach((function(i){if(response.data.reminders){var rem=response.data.reminders.find((function(k){return k.id===i.reminderId}));rem&&notifications.push(rem.name)}})),_this2.model.woData.resourceList.push({selected:selected,triggerNames:triggerNames,name:name,assignedTo:assignedTo,notifications:notifications,id:id})}))}))}))}));else{var startDate=new Date;startDate.setHours(0,0,0,0);var startTime=startDate.getTime();this.model.triggerData.isDefaultAllTriggers=!0,!this.$helpers.isLicenseEnabled("SKIP_TRIGGERS")&&this.model.isEdit||this.model.triggerData.triggers.push({name:"Trigger 1",type:4,startDate:startDate,startTime:startTime,basedOn:"Date",schedule:{},stopAfter:"never",endTime:new Date,startReading:null,readingFieldId:null,stopAfterReading:"never",endReading:null,readingInterval:null,assignedTo:null,reminders:[],criteria:null,sharingContext:{shareTo:2,sharedRoles:[],sharedUsers:[],sharedGroups:[]},customTrigger:{customModuleId:null,fieldId:null,days:null,hours:null}})}},resourceListHandler:function(){var _this3=this;if("bulk"===this.model.woData.workOrderType){var sitesStr="";if(this.model.woData.sites&&this.model.woData.sites.length>0&&(sitesStr+=this.model.woData.sites[0],this.model.woData.sites.length>1))for(var i=1;i<this.model.woData.sites.length;i++)this.model.woData.sites[i]>0&&(sitesStr=sitesStr+","+this.model.woData.sites[i]);if("SPACE_CATEGORY"===this.model.woData.resourceType)this.model.woData.selectedSpaceList&&0!==this.model.woData.selectedSpaceList.length?null===this.model.woData.isIncludeSpace||void 0===this.model.woData.isIncludeSpace||this.model.woData.isIncludeSpace?(this.$set(this.model.woData,"resourceList",this.model.woData.selectedSpaceList),this.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))):this.model.woData.spacecategoryId&&this.model.woData.spacecategoryId>0&&this.$util.loadSpacesContext(4,null,[{key:"site",operator:"is",value:sitesStr},{key:"building",operator:"is",value:this.model.woData.selectedBuilding},{key:"spaceCategory",operator:"is",value:this.model.woData.spacecategoryId}]).then((function(response){_this3.$set(_this3.model.woData,"resourceList",response.records),_this3.model.woData.resourceList=_this3.model.woData.resourceList.filter((function(i){for(var j=0;j<_this3.model.woData.selectedSpaceList.length;j++)if(_this3.model.woData.selectedSpaceList[j].id===i.id)return!1;return!0})),_this3.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))})):this.model.woData.spacecategoryId&&this.model.woData.spacecategoryId>0&&this.$util.loadSpacesContext(4,null,[{key:"site",operator:"is",value:sitesStr},{key:"building",operator:"is",value:this.model.woData.selectedBuilding},{key:"spaceCategory",operator:"is",value:this.model.woData.spacecategoryId}]).then((function(response){_this3.$set(_this3.model.woData,"resourceList",response.records),_this3.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}));else if("ASSET_CATEGORY"===this.model.woData.resourceType)if(this.model.woData.selectedResourceList&&0!==this.model.woData.selectedResourceList.length){if(null===this.model.woData.isIncludeResource||void 0===this.model.woData.isIncludeResource||this.model.woData.isIncludeResource)this.$set(this.model.woData,"resourceList",this.model.woData.selectedResourceList),this.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}));else if(this.model.woData.assetCategoryId&&this.model.woData.assetCategoryId>0){var spaceIds=[this.model.woData.selectedBuilding];(!this.model.woData.selectedBuilding||this.model.woData.selectedBuilding<0)&&(spaceIds=this.model.woData.sites),this.$util.loadAsset({spaceIds:spaceIds,categoryId:this.model.woData.assetCategoryId}).then((function(response){_this3.$set(_this3.model.woData,"resourceList",response.assets.filter((function(i){for(var j=0;j<_this3.model.woData.selectedResourceList.length;j++)if(_this3.model.woData.selectedResourceList[j].id===i.id)return!1;return!0}))),_this3.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}))}}else if(this.model.woData.assetCategoryId&&this.model.woData.assetCategoryId>0){var _spaceIds=[this.model.woData.selectedBuilding];(!this.model.woData.selectedBuilding||this.model.woData.selectedBuilding<0)&&(_spaceIds=this.model.woData.sites),this.$util.loadAsset({spaceIds:_spaceIds,categoryId:this.model.woData.assetCategoryId}).then((function(response){_this3.$set(_this3.model.woData,"resourceList",response.assets),_this3.model.woData.resourceList.forEach((function(resource){resource.triggerNames=["0"],resource.assignedTo=null,resource.notifications=[],resource.selected=!1}))}))}}},validated:function(){this.$refs.reviewer.validated()},failed:function(){this.$refs.reviewer.failed()},sortBySequence:function(a,b){return a.taskTemplates[0].sequence<b.taskTemplates[0].sequence?-1:a.taskTemplates[0].sequence>b.taskTemplates[0].sequence?1:0},fillTasks:function(sectionTemplates,resourceType,creationType,singleResource,resourceMap,triggerMap){var _this4=this;if(sectionTemplates)this.model.taskData.taskSections.splice(0,1),sectionTemplates.sort(this.sortBySequence),sectionTemplates.forEach((function(section,i){var taskSection={name:"Untitled Section",category:null,dummyValue:[1],inputType:null,resourceLabel:"",selectedResourceList:[],isIncludeResource:null,attachmentRequired:!1,enableInput:!1,validation:null,minSafeLimit:null,maxSafeLimit:null,options:[],tasks:[],triggers:[],additionInfo:{defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]}};section.additionInfo||(section.additionInfo={defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]}),Object.keys(section).filter((function(key){return key in taskSection})).forEach((function(key){taskSection[key]=_this4.$helpers.cloneObject(section[key])})),taskSection.tasks=[],taskSection.enableInput=section.inputType>1,taskSection.inputType=String(section.inputType),taskSection.assignmentType=section.assignmentType,taskSection.selectedResourceList=[],section.pmIncludeExcludeResourceContexts&&section.pmIncludeExcludeResourceContexts.forEach((function(i){return taskSection.selectedResourceList.push({id:i.resourceId})})),section.additionInfo&&(section.additionInfo.options&&(taskSection.options=section.additionInfo.options.map((function(x){return{name:x}}))),taskSection.additionInfo.defaultValue=section.additionInfo.defaultValue,taskSection.additionInfo.failureValue=section.additionInfo.failureValue,taskSection.additionInfo.woCreateFormId=section.additionInfo.woCreateFormId,taskSection.additionInfo.deviationOperatorId=section.additionInfo.deviationOperatorId,taskSection.additionInfo.remarksRequired=section.additionInfo.remarksRequired,taskSection.additionInfo.remarkOptionValues=section.additionInfo.remarkOptionValues,taskSection.additionInfo.attachmentOptionValues=section.additionInfo.attachmentOptionValues),section.pmTaskSectionTemplateTriggers&&section.pmTaskSectionTemplateTriggers.length?(taskSection.triggers=[],section.pmTaskSectionTemplateTriggers.forEach((function(ptc){ptc.triggerName=triggerMap[ptc.triggerId].name,ptc.executeIfNotInTime=ptc.executeIfNotInTime>0?ptc.executeIfNotInTime/86400:-1,taskSection.triggers.push(ptc)}))):taskSection.triggers=[{triggerName:"All"}],2===creationType?5===taskSection.assignmentType?"ALL_FLOORS"===resourceType?taskSection.category=["CURRENT_FLOOR"]:"SPACE_CATEGORY"===resourceType?taskSection.category=["CURRENT_SPACE"]:"ASSET_CATEGORY"===resourceType?taskSection.category=["CURRENT_ASSET"]:"BUILDINGS"===resourceType?taskSection.category=["CURRENT_BUILDING"]:"ALL_SITES"===resourceType&&(taskSection.category=["ALL_SITES"]):4===taskSection.assignmentType?taskSection.category=["asset",section.assetCategoryId]:3===taskSection.assignmentType?taskSection.category=["space",section.spaceCategoryId]:8===taskSection.assignmentType&&(taskSection.category=["ALL_SITES"]):2===singleResource.resourceType?taskSection.category=["CURRENT_ASSET"]:1===singleResource.resourceType&&(5!==taskSection.assignmentType&&taskSection.assignmentType&&-1!==taskSection.assignmentType?4===taskSection.assignmentType?taskSection.category=["asset",section.assetCategoryId]:3===taskSection.assignmentType&&(taskSection.category=["space",section.spaceCategoryId]):(taskSection.assignmentType=5,taskSection.category=["CURRENT_SPACE"]));var task={name:"",resourceLabel:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,inputValidationRuleId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,category:taskSection.category,readingFields:[],createWoOnFailure:!1,additionInfo:{defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,uniqueId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[],createWoOnFailure:!1}};2===creationType?section.taskTemplates&&section.taskTemplates.forEach((function(t){if(5===t.assignmentType?"CURRENT_FLOOR"===taskSection.category[0]?t.category=["CURRENT_FLOOR"]:"SPACE_CATEGORY"===taskSection.category[0]||"space"===taskSection.category[0]?t.category=["CURRENT_SPACE"]:"ASSET_CATEGORY"===taskSection.category[0]||"asset"===taskSection.category[0]?t.category=["CURRENT_ASSET"]:"BUILDINGS"===taskSection.category[0]?t.category=["CURRENT_BUILDING"]:"ALL_SITES"===taskSection.category[0]&&(t.category=["ALL_SITES"]):4===t.assignmentType?t.category=["asset",t.assetCategoryId]:3===t.assignmentType?t.category=["space",t.spacecategoryId]:8===t.assignmentType&&(t.category=["ALL_SITES"]),t.enableInput=t.inputType>1,t.inputType=String(t.inputType),t.additionInfo&&t.additionInfo.options&&(t.options=t.additionInfo.options.map((function(x){return{name:x}}))),t.selectedResourceList=[],t.pmIncludeExcludeResourceContexts&&t.pmIncludeExcludeResourceContexts.forEach((function(i){return t.selectedResourceList.push({id:i.resourceId})})),t.readingRules&&t.readingRules.length){var rule=t.readingRules[0];if(t.inputValidationRuleId=rule.id,"(b!=-1)&&(a<b)"===rule.workflow.resultEvaluator)t.validation="incremental";else if("(b!=-1)&&(a>b)"===rule.workflow.resultEvaluator)t.validation="decremental";else if("(b!=-1&&a<b)||(c!=-1&&a>c)"===rule.workflow.resultEvaluator){t.validation="safeLimit";var min=rule.workflow.expressions.find((function(val){return"b"===val.name})).constant;t.minSafeLimit="-1"===min?null:min;var max=rule.workflow.expressions.find((function(val){return"c"===val.name})).constant;t.maxSafeLimit="-1"===max?null:max}}taskSection.tasks.push(_this4.$helpers.cloneFromSchema(task,t))})):section.taskTemplates&&section.taskTemplates.forEach((function(t,taskIndex){if(5===t.assignmentType)"CURRENT_SPACE"===taskSection.category[0]||"space"===taskSection.category[0]?t.category=["CURRENT_SPACE"]:"CURRENT_ASSET"===taskSection.category[0]||"asset"===taskSection.category[0]?t.category=["CURRENT_ASSET"]:"CURRENT_BUILDING"===taskSection.category[0]&&(t.category=["CURRENT_BUILDING"]);else if(4===t.assignmentType)t.category=["asset",t.assetCategoryId];else if(3===t.assignmentType)t.category=["space",t.spacecategoryId];else if(!t.assignmentType||-1===t.assignmentType)if(t.readingFieldId>0&&t.resourceId>0&&resourceMap[t.resourceId]){var resource=resourceMap[t.resourceId];"CURRENT_SPACE"===taskSection.category[0]&&(1===resource.resourceType?resource.category&&resource.category.id&&resource.id!==singleResource.id&&(t.assignmentType=3,t.category=["space",resource.category.id],t.pmIncludeExcludeResourceContexts=[resource]):2===resource.resourceType&&resource.category&&resource.category.id&&resource.id!==singleResource.id&&(t.assignmentType=3,t.category=["asset",resource.category.id],t.pmIncludeExcludeResourceContexts=[resource]))}else t.assignmentType=5,"CURRENT_SPACE"===taskSection.category[0]?t.category=["CURRENT_SPACE"]:"CURRENT_ASSET"===taskSection.category[0]?t.category=["CURRENT_ASSET"]:"ALL_SITES"===taskSection.category[0]&&(t.category=["ALL_SITES"]);if(t.enableInput=t.inputType>1,t.inputType=String(t.inputType),t.additionInfo&&t.additionInfo.options&&(t.options=t.additionInfo.options.map((function(x){return{name:x}}))),t.selectedResourceList=[],t.pmIncludeExcludeResourceContexts&&t.pmIncludeExcludeResourceContexts.forEach((function(i){return t.selectedResourceList.push({id:i.resourceId})})),t.readingRules&&t.readingRules.length){var rule=t.readingRules[0];if(t.inputValidationRuleId=rule.id,"(b!=-1)&&(a<b)"===rule.workflow.resultEvaluator)t.validation="incremental";else if("(b!=-1)&&(a>b)"===rule.workflow.resultEvaluator)t.validation="decremental";else if("(b!=-1&&a<b)||(c!=-1&&a>c)"===rule.workflow.resultEvaluator){t.validation="safeLimit";var min=rule.workflow.expressions.find((function(val){return"b"===val.name})).constant;t.minSafeLimit="-1"===min?null:min;var max=rule.workflow.expressions.find((function(val){return"c"===val.name})).constant;t.maxSafeLimit="-1"===max?null:max}}taskSection.tasks.push(_this4.$helpers.cloneFromSchema(task,t))})),_this4.model.taskData.taskSections.push(taskSection)}));else for(var i=0;i<this.model.taskData.taskSections.length;i++)if(2===creationType){if("ALL_FLOORS"===resourceType){this.model.taskData.taskSections[i].category=["CURRENT_FLOOR"];for(var j=0;j<this.model.taskData.taskSections[i].tasks.length;j++)this.model.taskData.taskSections[i].tasks[j].category=["CURRENT_FLOOR"]}else if("SPACE_CATEGORY"===resourceType){this.model.taskData.taskSections[i].category=["CURRENT_SPACE"];for(var _j=0;_j<this.model.taskData.taskSections[i].tasks.length;_j++)this.model.taskData.taskSections[i].tasks[_j].category=["CURRENT_SPACE"]}else if("BUILDINGS"===resourceType){this.model.taskData.taskSections[i].category=["CURRENT_BUILDING"];for(var _j2=0;_j2<this.model.taskData.taskSections[i].tasks.length;_j2++)this.model.taskData.taskSections[i].tasks[_j2].category=["CURRENT_BUILDING"]}else if("ALL_SITES"===resourceType){
// fill in task-section & tasks category for ALL_SITES
this.model.taskData.taskSections[i].category=["ALL_SITES"];for(var _j3=0;_j3<this.model.taskData.taskSections[i].tasks.length;_j3++)this.model.taskData.taskSections[i].tasks[_j3].category=["ALL_SITES"]}else if("ASSET_CATEGORY"===resourceType){this.model.taskData.taskSections[i].category=["CURRENT_ASSET"];for(var _j4=0;_j4<this.model.taskData.taskSections[i].tasks.length;_j4++)this.model.taskData.taskSections[i].tasks[_j4].category=["CURRENT_ASSET"]}}else if(2===singleResource.resourceType){this.model.taskData.taskSections[i].category=["CURRENT_ASSET"];for(var _j5=0;_j5<this.model.taskData.taskSections[i].tasks.length;_j5++)this.model.taskData.taskSections[i].tasks[_j5].category=["CURRENT_ASSET"]}else if(1===singleResource.resourceType){this.model.taskData.taskSections[i].category=["CURRENT_SPACE"];for(var _j6=0;_j6<this.model.taskData.taskSections[i].tasks.length;_j6++)this.model.taskData.taskSections[i].tasks[_j6].category=["CURRENT_SPACE"]}},fillPreRequests:function(sectionTemplates,photoMandatory,allowNegativePreRequisite,approvers){var _this5=this;this.model.preRequestData.photoMandatory=photoMandatory,-1===allowNegativePreRequisite&&(allowNegativePreRequisite=2),this.model.preRequestData.allowNegativePreRequisite=allowNegativePreRequisite,this.model.preRequestData.allowNegative=3===this.model.preRequestData.allowNegativePreRequisite,approvers?0===approvers.length?approvers.push({sharingType:null,approversId:null}):approvers.forEach((function(approver){_this5.getFieldDrop(approver),1===approver.sharingType?approver.approversId=approver.userId:2===approver.sharingType?approver.approversId=parseInt(approver.roleId):3===approver.sharingType&&(approver.approversId=parseInt(approver.groupId))})):(approvers=[],approvers.push({sharingType:null,approversId:null})),this.model.preRequestData.approvers=approvers,sectionTemplates&&(this.model.preRequestData.preRequestSections.splice(0,1),sectionTemplates.sort(this.sortBySequence),sectionTemplates.forEach((function(section,i){var taskSection={name:"Untitled Section",dummyValue:[1],inputType:null,selectedResourceList:[],isIncludeResource:null,attachmentRequired:!1,enableInput:!1,validation:null,minSafeLimit:null,maxSafeLimit:null,options:[],tasks:[],triggers:[],additionInfo:{truevalue:null,falsevalue:null,defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]}};Object.keys(section).filter((function(key){return key in taskSection})).forEach((function(key){taskSection[key]=_this5.$helpers.cloneObject(section[key])})),taskSection.preRequests=[],taskSection.enableInput=section.inputType>1,taskSection.inputType=String(section.inputType),taskSection.assignmentType=section.assignmentType,taskSection.selectedResourceList=[],section.additionInfo&&(section.additionInfo.options&&(taskSection.options=section.additionInfo.options.map((function(x){return{name:x}}))),taskSection.additionInfo.truevalue=section.additionInfo.truevalue,taskSection.additionInfo.falsevalue=section.additionInfo.falsevalue,taskSection.additionInfo.defaultValue=section.additionInfo.defaultValue,taskSection.additionInfo.failureValue=section.additionInfo.failureValue,taskSection.additionInfo.woCreateFormId=section.additionInfo.woCreateFormId,taskSection.additionInfo.deviationOperatorId=section.additionInfo.deviationOperatorId,taskSection.additionInfo.remarksRequired=section.additionInfo.remarksRequired,taskSection.additionInfo.remarkOptionValues=section.additionInfo.remarkOptionValues,taskSection.additionInfo.attachmentOptionValues=section.additionInfo.attachmentOptionValues);var task={name:"",description:"",inputType:null,attachmentRequired:!1,enableInput:!1,readingFieldId:null,validation:null,inputValidationRuleId:null,minSafeLimit:null,maxSafeLimit:null,options:[],selectedResourceList:[],isIncludeResource:null,category:taskSection.category,readingFields:[],additionInfo:{truevalue:null,falsevalue:null,defaultValue:"",failureValue:"",woCreateFormId:null,deviationOperatorId:null,remarksRequired:!1,remarkOptionValues:[],attachmentOptionValues:[]}};section.taskTemplates&&section.taskTemplates.forEach((function(t){t.enableInput=t.inputType>1,t.inputType=String(t.inputType),t.additionInfo&&t.additionInfo.options&&(t.options=t.additionInfo.options.map((function(x){return{name:x}}))),taskSection.preRequests.push(_this5.$helpers.cloneFromSchema(task,t))})),_this5.model.preRequestData.preRequestSections.push(taskSection)})))},getFieldDrop:function(approver){approver.approversId=null,approver.approvesDataType=[],1===approver.sharingType?approver.approvesDataType=this.users:2===approver.sharingType?approver.approvesDataType=this.roles:3===approver.sharingType&&(approver.approvesDataType=this.teams)},formSelect:function(view){var currView=null;for(var key in this.show)if(this.show[key]){currView=key;break}if(view!==currView){if("workorder"===currView){var isValid=this.validateMultiSiteWO();if(!isValid)return}else if("tasks"===currView&&"workorder"!==view){var _isValid=this.validateTaskForm();if(!_isValid)return}for(var _key in this.show)this.show[_key]=!1;this.show[view]=!0,this.currentView=view}},moveToNext:function(){if("pmconfig"===this.currentView){for(var key in this.show)this.show[key]=!1;this.currentView="workorderNx",this.show["workorderNx"]=!0}else if("workorderNx"===this.currentView){for(var _key2 in this.show)this.show[_key2]=!1;this.currentView="trigger",this.show["trigger"]=!0}else if("trigger"===this.currentView){for(var _key3 in this.show)this.show[_key3]=!1;this.currentView="prerequests",this.show["prerequests"]=!0}else if("prerequests"===this.currentView){for(var _key4 in this.show)this.show[_key4]=!1;this.currentView="tasks",this.show["tasks"]=!0}else if("tasks"===this.currentView){for(var _key5 in this.show)this.show[_key5]=!1;"bulk"===this.model.woData.workOrderType&&this.model.triggerData.triggers.length?(this.currentView="resourceplan",this.show["resourceplan"]=!0):(this.currentView="review",this.show["review"]=!0)}else if("resourceplan"===this.currentView){for(var _key6 in this.show)this.show[_key6]=!1;this.currentView="review",this.show["review"]=!0}},moveToPrevious:function(){if("workorder"===this.currentView){for(var key in this.show)this.show[key]=!1;this.currentView="pmconfig",this.show["pmconfig"]=!0}else if("trigger"===this.currentView){for(var _key7 in this.show)this.show[_key7]=!1;this.currentView="workorder",this.show["workorder"]=!0}else if("prerequests"===this.currentView){for(var _key8 in this.show)this.show[_key8]=!1;this.currentView="trigger",this.show["trigger"]=!0}else if("tasks"===this.currentView){for(var _key9 in this.show)this.show[_key9]=!1;this.currentView="prerequests",this.show["prerequests"]=!0}else if("resourceplan"===this.currentView){for(var _key10 in this.show)this.show[_key10]=!1;this.currentView="tasks",this.show["tasks"]=!0}else if("review"===this.currentView){for(var _key11 in this.show)this.show[_key11]=!1;this.model.triggerData.triggers.length?(this.currentView="resourceplan",this.show["resourceplan"]=!0):(this.currentView="trigger",this.show["trigger"]=!0)}},setFormObject:function(formObject){var _this6=this;this.formObj=formObject;var _ref4=this.formObj||{},fields=_ref4.fields;
// Handling Custom Duration fields
if((0,validation/* isEmpty */.xb)(fields)||fields.forEach((function(field_){var _ref5=field_||{},field=_ref5.field;(0,validation/* isEmpty */.xb)(field)||"DURATION"===field.displayType&&"NUMBER"===field.dataTypeEnum&&_this6.durationFields.push(field.name)})),!(0,validation/* isEmpty */.xb)(this.durationFields)){var _this$defaultDuration=this.defaultDuration,defaultDuration=void 0===_this$defaultDuration?0:_this$defaultDuration;this.durationFields.forEach((function(name){if(_this6.$getProperty(_this6.model.woData.woModel,"".concat(name))){var unixTime=_this6.$util.daysHoursToUnixTime(_this6.model.woData.woModel["".concat(name)])||-1;-1===unixTime&&(_this6.model.woData.woModel["".concat(name)]={date:defaultDuration,hours:defaultDuration},_this6.$getProperty(_this6.model.actualWoData,"data")&&(_this6.model.actualWoData.data["".concat(name)]={date:defaultDuration,hours:defaultDuration}))}}))}}}},multisitepreventive_pmnewformvue_type_script_lang_js=pmnewformvue_type_script_lang_js,pmnewform_component=(0,componentNormalizer/* default */.Z)(multisitepreventive_pmnewformvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,pmnewform=pmnewform_component.exports},
/***/188742:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"22bc1f7e3fecc069519710728d363ce9.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/16977.js.map