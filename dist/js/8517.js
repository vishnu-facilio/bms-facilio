"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[8517],{
/***/808517:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return FSubForm}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/FSubForm.vue?vue&type=template&id=625d9dc2&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{class:[!_vm.removeDefaultStyling&&"f-subform-container",_vm.$validation.isEmpty(_vm.customClass)?"":_vm.customClass,_vm.isLiveSubForm?"f-subform-live scrollbar-style":"f-subform-builder"]},[_vm.canShowRemove?_c("div",{staticClass:"remove-btn-container",class:0===_vm.formIndex?"first":""},[_c("img",{staticClass:"mL5 remove-icon",attrs:{src:__webpack_require__(385769)},on:{click:function($event){return _vm.removeLineItem()}}})]):_vm._e(),_c("el-form",{ref:"form",staticClass:"position-relative",attrs:{model:_vm.formModel,rules:_vm.rules,"label-position":"top","label-width":"100px"}},[_vm.isSectionsEmpty&&!_vm.isLiveSubForm?_c("div",{staticClass:"empty btn-container",on:{click:function(event){_vm.showHideFields(!0,event)}}},[_c("div",{staticClass:"add-field-btn"},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"add",iconClass:"icon icon-sm-md"}})],1)]):_vm._l(_vm.form.sections,(function(section,sectionIndex){return _c("div",{key:sectionIndex,staticClass:"section-container pR300",class:[0===sectionIndex?"":"mT20",_vm.isFirstofType?"first-subform":"",_vm.isLastofType?"last-subform ":""]},[_c("draggable",_vm._b({staticClass:"dragArea fields-container",attrs:{disabled:_vm.canDisableDrag()},on:{start:_vm.onStart,end:_vm.onEnd,change:function($event){return _vm.onSubFormFieldChange.apply(void 0,arguments)}},model:{value:_vm.form.sections[sectionIndex].fields,callback:function($$v){_vm.$set(_vm.form.sections[sectionIndex],"fields",$$v)},expression:"form.sections[sectionIndex].fields"}},"draggable",_vm.formFieldsDragOptions,!1),_vm._l(section.fields,(function(field,fieldIndex){return _c("div",{key:sectionIndex+" - "+fieldIndex,staticClass:"subform-field",class:[_vm.isLiveSubForm?"":"form-drag-item",_vm.isLiveSubForm&&field.hideField?"hide":""],on:{click:function($event){return $event.stopPropagation(),_vm.setActiveField(field)}}},[_c("el-form-item",{staticClass:"section-items",class:[_vm.isFieldActive(field)&&!_vm.isLiveSubForm?"active":""],attrs:{label:field.displayName,prop:field.name,required:!!_vm.isLiveSubForm&&field.required,"label-width":"150px"},scopedSlots:_vm._u([_vm.isLiveSubForm?null:{key:"label",fn:function(){return[_c("div",[_c("label",[_c("span",{staticClass:"forms-field-text-label"},[_vm._v(_vm._s(field.displayName))]),field.required?_c("span",{staticClass:"forms-red-dot"},[_vm._v("*")]):_vm._e()]),field.hideField?_c("inline-svg",{attrs:{src:"svgs/hidden-field",iconClass:"mL5 icon icon-sm vertical-text-bottom"}}):_vm._e()],1)]},proxy:!0}],null,!0)},[_vm.isLiveSubForm?_vm._e():_c("div",{staticClass:"subform-field-delete",on:{click:function(event){_vm.removeSubFormField(field,fieldIndex,event)}}},[_c("img",{staticClass:"delete-icon",attrs:{src:__webpack_require__(385769)}})]),_vm.$constants.FORM_TEXTAREA_DISPLAY_TYPES.includes(field.displayTypeEnum)?_c("el-input",{key:""+sectionIndex+fieldIndex,staticClass:"fc-input-full-border-textarea",attrs:{type:"textarea",resize:"none",placeholder:"Type your  "+field.displayName,disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}}):"DECISION_BOX"===field.displayTypeEnum?_c("el-checkbox",{attrs:{disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}}):"RADIO"===field.displayTypeEnum?_c("el-radio-group",{attrs:{disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:!0}},[_vm._v(_vm._s(field.field.trueVal))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:!1}},[_vm._v(_vm._s(field.field.falseVal))])],1):"MULTI_CURRENCY"===field.displayTypeEnum?_c("div",[_c("FNewCurrencyField",{key:_vm.formModel.currencyCode,attrs:{field:field,isEdit:_vm.isEdit,disabled:!_vm.isLiveSubForm,isSubform:!0,moduleData:_vm.formModel},on:{setCurrencyCodeInSubform:_vm.setCurrencyCodeInSubform,calculateExchangeRate:function(rateObj){return _vm.calculateExchangeRate(rateObj,section.fields)}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}})],1):_vm.isSiteField(field)||_vm.$fieldUtils.isSiteLookup(field)?_c("FSiteField",{key:fieldIndex+" "+field.id,attrs:{"data-test-selector":""+field.name,model:(_vm.formModel[field.name]||{}).id,canDisable:field.isDisabled,resetFields:!0,isEdit:_vm.isEdit,filter:_vm.filter,field:field},on:{"update:model":function($event){_vm.$set(_vm.formModel[field.name]||{},"id",$event)},"update:filter":function($event){_vm.filter=$event},handleSiteSwitch:_vm.showConfirmSiteSwitch,handleChange:function(){return _vm.onChangeHandler({field:field})}}}):"MULTI_LOOKUP_SIMPLE"===field.displayTypeEnum?_c("FLookupField",{key:fieldIndex+" "+field.id,attrs:{"data-test-selector":""+field.name,model:_vm.formModel[field.name],field:field,disabled:field.isDisabled,hideDropDown:_vm.$fieldUtils.isChooserTypeField(field)&&!(field.config||{}).isFiltersEnabled,siteId:_vm.selectedSiteId,rulesCriteria:field.rulesCriteria},on:{"update:model":function($event){return _vm.$set(_vm.formModel,field.name,$event)},showLookupWizard:_vm.showLookupWizard,recordSelected:function(value,field){return _vm.onRecordSelected({value:value,field:field,isSubForm:!0})}}}):_vm.isLookupSimpleField(field)&&(field.config||{}).canShowFloorPlanPicker?_c("FLookupFieldWithFloorplan",{key:fieldIndex+" "+field.id,attrs:{"data-test-selector":""+field.name,model:(_vm.formModel[field.name]||{}).id,field:field,disabled:field.isDisabled,siteId:_vm.selectedSiteId},on:{"update:model":function($event){_vm.$set(_vm.formModel[field.name]||{},"id",$event)},showLookupWizard:_vm.showLookupWizard,recordSelected:function(value,field){return _vm.onRecordSelected({value:value,field:field,isSubForm:!0})}}}):_vm.checkFieldType(field)?_c("FLookupField",{attrs:{model:(_vm.formModel[field.name]||{}).id,field:field,disabled:_vm.canDisableField(field),hideDropDown:_vm.$fieldUtils.isChooserTypeField(field)&&!(field.config||{}).isFiltersEnabled,siteId:_vm.selectedSiteId,fetchOptionsOnLoad:!0,skipLoading:!0},on:{"update:model":function($event){_vm.$set(_vm.formModel[field.name]||{},"id",$event)},showLookupWizard:_vm.showLookupWizard,recordSelected:function(value,field){return _vm.onRecordSelected({value:value,field:field,isSubForm:!0})}}}):"GEO_LOCATION"===field.displayTypeEnum?_c("div",[_c("FLocationField",{key:fieldIndex+" "+field.id,attrs:{field:field,disabled:field.isDisabled,clearable:!1},on:{change:function(value){return _vm.onChangeHandler({value:value,field:field})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}})],1):_vm.isDropdownTypeFields(field.displayTypeEnum)&&_vm.isMultiple(field)?_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{multiple:!0,filterable:"",disabled:_vm.canDisableField(field),placeholder:"Select"},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}},[_c("div",{attrs:{slot:"empty"},slot:"empty"},[_c("div",{staticClass:"el-select-dropdown__empty"},[_vm._v(" "+_vm._s(_vm.$t("common._common.empty_option_text"))+" ")]),field.allowCreate?_c("el-button",{staticClass:"add-option-empty",attrs:{loading:field.isOptionsLoading},on:{click:function($event){return _vm.addOption(field,sectionIndex,fieldIndex)}}},[_vm._v(_vm._s(_vm.$t("maintenance._workorder.add_option")))]):_vm._e()],1),_vm._l(field.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.label,value:option.value}})})),field.allowCreate?_c("div",{staticClass:"add-option-container"},[_c("el-button",{staticClass:"add-option-content",on:{click:function($event){return _vm.addOption(field,sectionIndex,fieldIndex)}}},[_vm._v(_vm._s(_vm.$t("maintenance._workorder.add_option")))])],1):_vm._e()],2):_vm.isDropdownTypeFields(field.displayTypeEnum)?_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",disabled:_vm.canDisableField(field),placeholder:"Select"},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:(_vm.formModel[field.name]||{}).id,callback:function($$v){_vm.$set(_vm.formModel[field.name]||{},"id",$$v)},expression:"(formModel[field.name] || {}).id"}},[_c("div",{attrs:{slot:"empty"},slot:"empty"},[_c("div",{staticClass:"el-select-dropdown__empty"},[_vm._v(" "+_vm._s(_vm.$t("common._common.empty_option_text"))+" ")]),field.allowCreate?_c("el-button",{staticClass:"add-option-empty",attrs:{loading:field.isOptionsLoading},on:{click:function($event){return _vm.addOption(field,sectionIndex,fieldIndex)}}},[_vm._v(_vm._s(_vm.$t("maintenance._workorder.add_option")))]):_vm._e()],1),_vm._l(field.options,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.label,value:option.value}})})),field.allowCreate?_c("div",{staticClass:"add-option-container"},[_c("el-button",{staticClass:"add-option-content",on:{click:function($event){return _vm.addOption(field,sectionIndex,fieldIndex)}}},[_vm._v(_vm._s(_vm.$t("maintenance._workorder.add_option")))])],1):_vm._e()],2):"TEAMSTAFFASSIGNMENT"===field.displayTypeEnum?_c("div",{staticClass:"fc-input-full-border-select2",class:[field.isDisabled?"disabled-background":""],attrs:{disabled:_vm.canDisableField(field)}},[_c("div",{staticClass:"fc-border-input-div",on:{click:function(event){return _vm.openFassignment(event,field)}}},[_c("span",[_vm._v(_vm._s(_vm.getTeamStaffLabel(_vm.formModel[field.name])))]),_c("span",{staticStyle:{float:"right"}},[_c("img",{staticClass:"svg-icon team-down-icon",attrs:{src:__webpack_require__(620955)}})])]),_c("FAssignment",{attrs:{model:_vm.formModel[field.name],siteId:_vm.selectedSiteId,viewtype:"form"},on:{onChange:function(){return _vm.onChangeHandler({field:field,isSubForm:!0})}}})],1):"DURATION"===field.displayTypeEnum?_c("div",[_c("f-duration-field",{key:field.fieldId,staticClass:"duration-container",attrs:{field:field,isDisabled:_vm.canDisableField(field)},on:{updateDurationValue:_vm.updateDurationValue}})],1):"TIME"===field.displayTypeEnum?_c("FTimePicker",{staticClass:"el-select fc-input-full-border-select2 width100",attrs:{disabled:field.isDisabled,placeholder:_vm.$t("fields.properties.time_picker_placeholder")},on:{onChange:function(){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}}):"DATE"===field.displayTypeEnum?_c("f-date-picker",{key:fieldIndex+" "+field.id,staticClass:"fc-input-full-border2 form-date-picker",attrs:{type:"date",disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}}):"DATETIME"===field.displayTypeEnum?_c("f-date-picker",{key:fieldIndex+" "+field.id,staticClass:"fc-input-full-border2 form-date-picker",attrs:{type:"datetime",disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}}):"DATERANGE"===field.displayTypeEnum?_c("f-date-picker",{key:fieldIndex+" "+field.id,staticClass:"fc-input-full-border2 form-date-picker",attrs:{type:"daterange",disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}}):"FILE"===field.displayTypeEnum?_c("div",[_c("FFileUpload",{key:_vm.getRandomNumber(),attrs:{field:field,isFileType:"FILE"===field.displayTypeEnum,isDisabled:!_vm.isLiveSubForm,imgContentUrl:field.imgUrl,fileObj:field.fileObj,showWebCamPhoto:!1,isSaveBtnDisabled:_vm.isSaveBtnDisabled,isV3Api:_vm.isV3Api,addImgFile:function(fileOrId,field){return _vm.addImgFile({fileOrId:fileOrId,field:field,isSubForm:!0})}},on:{"update:imgContentUrl":function($event){return _vm.$set(field,"imgUrl",$event)},"update:img-content-url":function($event){return _vm.$set(field,"imgUrl",$event)},"update:fileObj":function($event){return _vm.$set(field,"fileObj",$event)},"update:file-obj":function($event){return _vm.$set(field,"fileObj",$event)},"update:isSaveBtnDisabled":function($event){_vm.isSaveBtnDisabled=$event},"update:is-save-btn-disabled":function($event){_vm.isSaveBtnDisabled=$event},removeImgFile:function(field){return _vm.removeImgFile({field:field,isSubForm:!0})}}})],1):"SIGNATURE"===field.displayTypeEnum?_c("div",[_c("FSignaturePad",{attrs:{model:_vm.formModel[field.name],fileName:field.name,isV3Api:_vm.isV3Api,imgUrl:field.imgUrl,isSaveBtnDisabled:_vm.isSaveBtnDisabled,canShowColorPalette:(field.config||{}).canShowColorPalette},on:{"update:model":function($event){return _vm.$set(_vm.formModel,field.name,$event)},"update:imgUrl":function($event){return _vm.$set(field,"imgUrl",$event)},"update:img-url":function($event){return _vm.$set(field,"imgUrl",$event)},"update:isSaveBtnDisabled":function($event){_vm.isSaveBtnDisabled=$event},"update:is-save-btn-disabled":function($event){_vm.isSaveBtnDisabled=$event},onChange:function(){return _vm.onChangeHandler({field:field,isSubForm:!0})}}})],1):"NUMBER"===field.displayTypeEnum||"DECIMAL"===field.displayTypeEnum?_c("el-input",{class:["fc-input-full-border2",_vm.canShowMetric(field)&&("prepend"===_vm.metricSymbolPosition(field)?"fc-slot-input-prepend":"fc-slot-input-append")],attrs:{type:"number",disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}},[_vm.canShowMetric(field)?_c("template",{slot:_vm.metricSymbolPosition(field)},[_vm._v(" "+_vm._s((field.field||{}).unit)+" ")]):_vm._e()],2):"PERCENTAGE"===field.displayTypeEnum?_c("el-input",{staticClass:"fc-input-full-border2 fc-input-icon",attrs:{disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}},[_c("template",{slot:field.iconPosition},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:field.icon,iconClass:"icon icon-xs"}})],1)],2):_c("el-input",{staticClass:"fc-input-full-border2",attrs:{disabled:_vm.canDisableField(field)},on:{change:function(value){return _vm.onChangeHandler({field:field,isSubForm:!0})}},model:{value:_vm.formModel[field.name],callback:function($$v){_vm.$set(_vm.formModel,field.name,$$v)},expression:"formModel[field.name]"}})],1)],1)})),0),_vm.isLiveSubForm?_vm._e():_c("div",{staticClass:"add-field-btn",on:{click:function(event){_vm.showHideFields(!0,event)}}},[_c("div",[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"add",iconClass:"icon icon-sm-md"}})],1)])],1)})),_vm.isLiveSubForm?_vm._e():_c("el-popover",{directives:[{name:"click-outside",rawName:"v-click-outside",value:_vm.showHideFields,expression:"showHideFields"}],attrs:{placement:"left",width:"200",trigger:"manual",value:_vm.canShowFields,"popper-class":"fields-dropdown"}},_vm._l(_vm.subFormFields,(function(field,index){return _c("div",{key:index},[_c("div",{staticClass:"letter-spacing0_4 fc-black-color f14 mB20 pointer",on:{click:function(event){_vm.addSubFormField(field,index,event)}}},[_c("span",{staticClass:"mR5 vertical-middle"},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:_vm.getIconSrc(field.displayTypeEnum),iconClass:"icon icon-sm-md"}})],1),_vm._v(" "+_vm._s(field.displayName)+" ")])])})),0)],2),_vm.canShowLookupWizard?_c("div",[_c("FLookupFieldWizard",{attrs:{canShowLookupWizard:_vm.canShowLookupWizard,selectedLookupField:_vm.selectedLookupField,siteId:_vm.selectedSiteId},on:{"update:canShowLookupWizard":function($event){_vm.canShowLookupWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowLookupWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}})],1):_vm._e()],1)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),FWebform=(__webpack_require__(434284),__webpack_require__(260228),__webpack_require__(634338),__webpack_require__(162506),__webpack_require__(670560),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(434500)),FormBuilderMixin=__webpack_require__(445829),vuedraggable_umd=__webpack_require__(909980),vuedraggable_umd_default=__webpack_require__.n(vuedraggable_umd),isEqual=__webpack_require__(618446),isEqual_default=__webpack_require__.n(isEqual),validation=__webpack_require__(990260),cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),uuid=__webpack_require__(455877),utils_field=__webpack_require__(815872),TeamStaffMixin=__webpack_require__(462599),FNewCurrencyField=__webpack_require__(533206),CurrencyUtil=__webpack_require__(15426),defaultDragOptions={animation:150,easing:"cubic-bezier(1, 0, 0, 1)"},FSubFormvue_type_script_lang_js={name:"f-sub-form",extends:FWebform/* default */.Z,mixins:[FormBuilderMixin/* default */.Z,TeamStaffMixin/* default */.Z],components:{draggable:vuedraggable_umd_default(),FNewCurrencyField:FNewCurrencyField/* default */.Z},props:["isLiveSubForm","removeDefaultStyling","customClass","fieldError","activeField","isLastofType","isFirstofType","canShowRemove","formIndex","isV3Api","isEdit","subFormModuleData"],data:function(){return{removeFieldsHash:["photo","attachedFiles"],subFormFields:[],canShowFields:!1}},computed:{formFieldsDragOptions:function(){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},defaultDragOptions),{},{draggable:".form-drag-item",group:"subform-fields",sort:!0})},moduleName:function(){var form=this.form;if(!(0,validation/* isEmpty */.xb)(form)){var module=form.module,_ref=module||{},name=_ref.name;return name}return null},formId:function(){var form=this.form;if(!(0,validation/* isEmpty */.xb)(form)){var id=form.id;return id}return null},subFormActiveField:{get:function(){return this.activeField},set:function(value){this.$emit("update:activeField",value)}},isSectionsEmpty:function(){var form=this.form,_ref2=form||{},_ref2$sections=_ref2.sections,sections=void 0===_ref2$sections?[]:_ref2$sections,_ref3=sections[0]||{},fields=_ref3.fields;return(0,validation/* isEmpty */.xb)(fields)}},watch:{form:{handler:function(newVal,oldVal){isEqual_default()(newVal,oldVal)||this.deserialize()},deep:!0}},methods:{
/* Data serialize and deserialize methods */deserializeFormData:function(){var subFormActiveField=this.subFormActiveField,_this$form$sections=this.form.sections,sections=void 0===_this$form$sections?[]:_this$form$sections;this.deserialize(),(0,validation/* isEmpty */.xb)(subFormActiveField)||(this.subFormActiveField=this.findSelectedField(sections,subFormActiveField))},init:function(){var _this=this,moduleName=this.moduleName,formId=this.formId,isLiveSubForm=this.isLiveSubForm;this.isLookupSimpleField=utils_field/* isLookupSimple */.qu,this.initActionHandlers(),this.deserialize();var _ref4=this.subFormModuleData||{},currencyCode=_ref4.currencyCode,exchangeRate=_ref4.exchangeRate;this.setCurrencyCodeInSubform(currencyCode,exchangeRate),isLiveSubForm||(0,validation/* isEmpty */.xb)(moduleName)||(0,validation/* isEmpty */.xb)(formId)||this.loadUnusedFields(moduleName,formId).then((function(fields){return _this.setSubFormFields(fields)}))},saveRecord:function(){var _arguments=arguments,_this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var props,_ref5,_ref5$skipSubFormVali,skipSubFormValidation,isValid;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(props=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:{},_ref5=props||{},_ref5$skipSubFormVali=_ref5.skipSubFormValidation,skipSubFormValidation=void 0!==_ref5$skipSubFormVali&&_ref5$skipSubFormVali,isValid=!0,skipSubFormValidation||!_this2.canValidateSubForm()){_context.next=9;break}return _context.next=6,new Promise((function(res){return _this2.$refs["form"].validate((function(valid){return res(valid)}))}));case 6:isValid=_context.sent,_context.next=10;break;case 9:_this2.$refs["form"].clearValidate();case 10:return _context.abrupt("return",new Promise((function(resolve,reject){var formModel=_this2.formModel;if(isValid){var _formModel=cloneDeep_default()(formModel);resolve(_formModel)}else reject()})));case 11:case"end":return _context.stop()}}),_callee)})))()},
/* Drag and drop related methods */onStart:function(){this.$emit("onDragStart")},onEnd:function(){this.$emit("onDragEnd")},onSubFormFieldChange:function(){var subFormObj=this.form;this.debounceSaveRecord({subFormObj:subFormObj,skipSettingSave:!0})},
/* Show/Hide/Disable related Actions */canDisableDrag:function(){var fieldError=this.fieldError,isSaving=this.isSaving;return fieldError||isSaving},canDisableField:function(field){var isLiveSubForm=this.isLiveSubForm,isDisabled=field.isDisabled;return!isLiveSubForm||isDisabled},showHideFields:function(){var canShow=arguments.length>0&&void 0!==arguments[0]&&arguments[0],event=arguments.length>1?arguments[1]:void 0,isLiveSubForm=this.isLiveSubForm;isLiveSubForm||(event&&event.stopPropagation(),this.$set(this,"canShowFields",canShow))},setSubFormFields:function(fields){var isLiveSubForm=this.isLiveSubForm;if(!isLiveSubForm){var systemFields=fields.systemFields,customFields=fields.customFields,subFormFields=[].concat((0,toConsumableArray/* default */.Z)(systemFields),(0,toConsumableArray/* default */.Z)(customFields));this.$set(this,"subFormFields",subFormFields)}},setActiveField:function(field){var isLiveSubForm=this.isLiveSubForm;isLiveSubForm||(this.subFormActiveField=field,this.$emit("resetActiveSection"))},addSubFormField:function(field,index,event){var isLiveSubForm=this.isLiveSubForm;if(!isLiveSubForm){event&&event.stopPropagation();var subFormFields=this.subFormFields,form=this.form,_ref6=form||{},sections=_ref6.sections,section=sections[0]||{},fields=section.fields;if(subFormFields.splice(index,1),(0,validation/* isEmpty */.xb)(fields)){var _fields=[],_sections=[];_fields.push(field),section.fields=_fields,_sections.push(section),form.sections=_sections}else fields.push(field);this.setActiveField(field),this.$set(this,"subFormFields",subFormFields),this.$set(this,"canShowFields",!1),this.saveFormRecord({subFormObj:form,skipSettingSave:!0})}},removeSubFormField:function(field,index,event){var isLiveSubForm=this.isLiveSubForm;if(!isLiveSubForm){event&&event.stopPropagation();var subFormFields=this.subFormFields,subFormObj=this.form,_ref7=subFormObj||{},sections=_ref7.sections,section=sections[0]||{},fields=section.fields;fields.splice(index,1),this.$set(section.fields,"fields",fields),subFormFields.push(field),this.isFieldActive(field)&&this.$emit("removeActiveField"),this.debounceSaveRecord({subFormObj:subFormObj,skipSettingSave:!0})}},
/* live subform related methods */removeLineItem:function(){var formIndex=this.formIndex;this.$emit("removeLineItem",formIndex)},getRandomNumber:function(){return(0,uuid.v4)()},canValidateSubForm:function(){var shouldSkipValidation,formModel=this.formModel;return Object.keys(formModel).forEach((function(field){shouldSkipValidation||((0,validation/* isObject */.Kn)(formModel[field])||(0,validation/* isEmpty */.xb)(formModel[field])?(0,validation/* isObject */.Kn)(formModel[field])&&!(0,validation/* areValuesEmpty */.sD)(formModel[field])&&(shouldSkipValidation=!0):shouldSkipValidation=!0)})),shouldSkipValidation},checkFieldType:function(field){return!(0,validation/* isEmpty */.xb)(field)&&((0,utils_field/* isLookupSimple */.qu)(field)||this.$fieldUtils.isChooserTypeField(field))},setCurrencyCodeInSubform:function(currencyCode,exchangeRate){var formModel=this.formModel;this.formModel=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formModel||{}),{},{currencyCode:currencyCode,exchangeRate:exchangeRate})},calculateExchangeRate:function(rateObj,fields){this.formModel=(fields||[]).reduce((function(formModel,field){var _ref8=field||{},name=_ref8.name,displayTypeEnum=_ref8.displayTypeEnum,value=formModel[name];return"MULTI_CURRENCY"!==displayTypeEnum||(0,validation/* isEmpty */.xb)(value)||(formModel[name]=(0,CurrencyUtil/* getCalculatedCurrencyValue */.sd)(rateObj,value)),formModel}),this.formModel)}}},components_FSubFormvue_type_script_lang_js=FSubFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FSubFormvue_type_script_lang_js,render,staticRenderFns,!1,null,"625d9dc2",null)
/* harmony default export */,FSubForm=component.exports},
/***/445829:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FormBuilderMixin}});
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
var render,staticRenderFns,objectSpread2=__webpack_require__(595082),slicedToArray=__webpack_require__(554621),toConsumableArray=__webpack_require__(488478),helpers=(__webpack_require__(634338),__webpack_require__(821057),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(450886),__webpack_require__(648324),__webpack_require__(947522),__webpack_require__(336585),__webpack_require__(879288),__webpack_require__(162506),__webpack_require__(778390)),utility_methods=__webpack_require__(773258),validation=__webpack_require__(990260),utils_utility_methods=__webpack_require__(555005),constant=__webpack_require__(354754),http=__webpack_require__(218430),DELAY=5e3,windowMessage={action:"setup-form-close"},FormBuilderMixinvue_type_script_lang_js={mounted:function(){var _this=this;this.debounceSaveRecord=helpers/* default */.ZP.debounce((function(){var props=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_this.saveFormRecord(props)}),DELAY)},methods:{loadUnusedFields:function(moduleName,formId){var fetchUnusedFieldsUrl="/v2/forms/fields/unusedlist?moduleName=".concat(moduleName,"&formId=").concat(formId);return http/* default */.ZP.get(fetchUnusedFieldsUrl).then((function(_ref){var _ref$data=_ref.data,message=_ref$data.message,responseCode=_ref$data.responseCode,_ref$data$result=_ref$data.result,result=void 0===_ref$data$result?{}:_ref$data$result;if(0===responseCode){var fields=result.fields;return fields}throw new Error(message)})).catch((function(err){throw new Error(err)}))},findSelectedField:function(sections,element){return sections.reduce((function(res,_ref2){var fields=_ref2.fields;return[].concat((0,toConsumableArray/* default */.Z)(res),(0,toConsumableArray/* default */.Z)(fields))}),[]).find((function(field){return field.name===element.name}))},isFieldActive:function(_ref3){var name=_ref3.name,formId=_ref3.formId,activeField=this.activeField;if(!(0,validation/* isEmpty */.xb)(activeField)){var activeFieldFormId=activeField.formId;return"".concat(activeFieldFormId).concat((activeField||{}).name)==="".concat(formId).concat(name)}return!1},getIconSrc:function(name){var svgName=constant/* default */.Z.FIELDS_ICON_HASH[name]||"single-line";return"".concat(svgName)},deserializeSectionData:function(sections){var _this2=this,skipEmptySectionHandling=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!skipEmptySectionHandling){var sectionsLength=sections.length+1;
// Pushing empty section object, to support adding new section.
sections.push({name:"section_".concat(sectionsLength),id:-1,showLabel:!1,fields:[]})}return sections.map((function(section){var subFormId=section.subFormId,subForm=section.subForm,subFormsArr=[];return(0,validation/* isEmpty */.xb)(subFormId)||(subFormsArr=[subForm],_this2.$set(section,"subFormsArr",subFormsArr)),(0,validation/* isEmpty */.xb)(section.fields)?section.fields=[]:section.fields=_this2.deserializeData(section.fields,sections),section}))},saveFormRecord:function(_ref4){var _this3=this,_ref4$redirect=_ref4.redirect,redirect=void 0!==_ref4$redirect&&_ref4$redirect,_ref4$subFormObj=_ref4.subFormObj,subFormObj=void 0===_ref4$subFormObj?{}:_ref4$subFormObj,_ref4$skipSettingSave=_ref4.skipSettingSave,skipSettingSave=void 0!==_ref4$skipSettingSave&&_ref4$skipSettingSave,sections=this.sections,_this$formProperties=this.formProperties,form=void 0===_this$formProperties?{}:_this$formProperties,hasError=this.hasError,$route=this.$route,isSetupPage=this.$getProperty($route.query,"setup",!1),formObj=(0,validation/* isEmpty */.xb)(subFormObj)?form:subFormObj,_form=this.serializeFormData(formObj),_sections=(0,validation/* isEmpty */.xb)(subFormObj)?(0,utility_methods/* cloneArray */.M2)(sections):(0,utility_methods/* cloneArray */.M2)(subFormObj.sections),data={form:_form};if(data.form.sections=this.serializeData(_sections,!(0,validation/* isEmpty */.xb)(subFormObj)),!hasError)return skipSettingSave||(this.isSaving=!0),http/* default */.ZP.post("/v2/forms/fields/init",data).then((function(_ref5){var _ref5$data=_ref5.data,message=_ref5$data.message,responseCode=_ref5$data.responseCode,_ref5$data$result=_ref5$data.result,result=void 0===_ref5$data$result?{}:_ref5$data$result;if(0!==responseCode)throw new Error(message);if(skipSettingSave||(_this3.isSaving=!1),!redirect)return _this3.deserializeFormData(result);isSetupPage&&_this3.sendMessage(),_this3.redirectToFormsList()})).catch((function(_ref6){var message=_ref6.message;_this3.$message.error(message),skipSettingSave||(_this3.isSaving=!0)}))},sendMessage:function(){var origin=window.location.origin,stringifiedMessage=JSON.stringify(windowMessage);window.parent.postMessage(stringifiedMessage,origin)},serializeFormData:function(){var form=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},formObj=(0,utility_methods/* deepCloneObject */.kh)(form),labelPosition="",labelAlignmentHash=constant/* default */.Z.FORMS_LABELALIGNMENT_ENUMHASH;return Object.entries(labelAlignmentHash).forEach((function(_ref7){var _ref8=(0,slicedToArray/* default */.Z)(_ref7,2),key=_ref8[0],value=_ref8[1];formObj.labelPosition===value&&(labelPosition=Number(key))})),"number"!==typeof(formObj||{}).labelPosition&&(formObj.labelPosition=labelPosition),formObj},serializeData:function(){var _this4=this,sections=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],skipEmptyRow=arguments.length>1?arguments[1]:void 0;
// To remove the empty row, which is added manually to support drag
if(!skipEmptyRow){var sectionLastIndex=sections.length-1;sections.splice(sectionLastIndex,1)}return sections=sections.map((function(section){var _section=(0,utility_methods/* deepCloneObject */.kh)(section),_section2=_section,subFormId=_section2.subFormId;return(0,validation/* isEmpty */.xb)(subFormId)?_section.fields=_section.fields.reduce((function(result,field){var _field=(0,utility_methods/* deepCloneObject */.kh)(field);return result.push(_this4.serializeFields(_field)),result}),[]):_section=_this4.serializeSubFormSection(_section),_section})),sections},serializeSubFormSection:function(){var _this5=this,formSection=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],_ref9=formSection||{},subForm=_ref9.subForm,_subForm=(0,utility_methods/* deepCloneObject */.kh)(subForm);delete _subForm.fields;var _ref10=_subForm||{},_ref10$sections=_ref10.sections,subFormSections=void 0===_ref10$sections?[]:_ref10$sections;subFormSections=subFormSections.map((function(section){var _ref11=section||{},fields=_ref11.fields;return fields=fields.map((function(field){return _this5.serializeFields(field)})),(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},section),{},{fields:fields})}));var serializedSection=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formSection),{},{subForm:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},_subForm),{},{sections:subFormSections})});return delete serializedSection.subFormsArr,serializedSection},serializeFields:function(){var field=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},resourceProps=arguments.length>1?arguments[1]:void 0,currentSiteId=this.currentSiteId,_ref12=field||{},name=_ref12.name,resourceProperties=(0,validation/* isEmpty */.xb)(resourceProps)?constant/* default */.Z.FIELDS_RESOURCE_PROPS:resourceProps,serializedField=(0,utils_utility_methods/* serializeProps */._$)(field,resourceProperties),skipStringify=null===field.value||"string"===typeof field.value;return serializedField.value=skipStringify?field.value:JSON.stringify(field.value),
// Skip site field value update, if global site is not 'All'
"siteId"!==name||(0,validation/* isEmpty */.xb)(currentSiteId)||delete serializedField["value"],serializedField}}},forms_FormBuilderMixinvue_type_script_lang_js=FormBuilderMixinvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(forms_FormBuilderMixinvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FormBuilderMixin=component.exports;
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/slicedToArray.js + 1 modules
}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/8517.js.map