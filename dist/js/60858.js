"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[60858],{
/***/163525:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FMapWidget}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/FMapWidget.vue?vue&type=template&id=025f1228
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("gmap-map",{ref:"mapView",style:_vm.mapStyle,attrs:{center:_vm.center,zoom:10,options:_vm.mapOptions}},[_vm.isClicked?_c("gmap-info-window",{attrs:{options:{pixelOffset:{width:-0,height:-48}},position:_vm.currentMarker.location}},[_vm._t("default",null,{currentMarker:_vm.currentMarker})],2):_vm._e(),_vm.markerType&&"profile"===_vm.markerType?_vm._l(_vm.markersList,(function(d,index){return _c("custom-marker",{key:"profile"+index,attrs:{marker:d.location},on:{"update:marker":function($event){return _vm.$set(d,"location",$event)}},nativeOn:{click:function($event){return _vm.loadInfo(d)}}},[_c("map-profile-marker",{attrs:{image:d.avatarUrl}})],1)})):_vm._l(_vm.markersList,(function(d,index){return _c("gmap-marker",{key:index,staticClass:"gmarker",attrs:{position:d.location,clickable:!0,draggable:!1,icon:d.icon?d.icon:_vm.defaultIcon},on:{"update:position":function($event){return _vm.$set(d,"location",$event)},click:function($event){return _vm.loadInfo(d)}}})}))],2)],1)},staticRenderFns=[],validation=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(990260)),CustomMarkervue_type_template_id_ec50e0be_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{style:{opacity:_vm.opacity}},[_vm._t("default")],2)},CustomMarkervue_type_template_id_ec50e0be_staticRenderFns=[],classCallCheck=__webpack_require__(513087),createClass=__webpack_require__(862833),inherits=__webpack_require__(793806),createSuper=__webpack_require__(624343),main=(__webpack_require__(879288),__webpack_require__(450886),__webpack_require__(821057),__webpack_require__(634338),__webpack_require__(564043),__webpack_require__(322462),__webpack_require__(225594)),CustomMarkervue_type_script_lang_js={mixins:[main.MapElementMixin],props:{marker:{type:Object,default:void 0},offsetX:{type:Number,default:0},offsetY:{type:Number,default:0},alignment:{type:String,default:"top"},zIndex:{type:Number,default:50},cssPosition:{type:Boolean,default:!1}},inject:{$clusterPromise:{default:null}},beforeCreate:function(options){return this.$clusterPromise&&(options.map=null),this.$clusterPromise},methods:{afterCreate:function(inst){var _this=this;this.$clusterPromise&&!this.isMarkerAdded&&this.$clusterPromise.then((function(co){co.addMarker(inst),_this.$clusterObject=co,_this.isMarkerAdded=!0}))}},data:function(){return{opacity:.01}},watch:{
// eslint-disable-next-line no-unused-vars
marker:function(val){var _this2=this;
// eslint-disable-next-line no-unused-vars
this.$mapPromise.then((function(map){return _this2.$overlay.setPosition()}))},
// eslint-disable-next-line no-unused-vars
zIndex:function(val){this.$overlay&&this.$overlay.repaint()}},provide:function(){var _this3=this,self=this;return this.$mapPromise.then((function(map){var Overlay=function(_window$google$maps$O){(0,inherits/* default */.Z)(Overlay,_window$google$maps$O);var _super=(0,createSuper/* default */.Z)(Overlay);function Overlay(map){var _this4;return(0,classCallCheck/* default */.Z)(this,Overlay),_this4=_super.call(this),_this4.setMap(map),_this4.draw=function(){return _this4.repaint()},_this4.setPosition=function(){return _this4.repaint()},_this4}return(0,createClass/* default */.Z)(Overlay,[{key:"repaint",value:function(){var div=self.$el,projection=this.getProjection();if(projection&&div){var x,y,posPixel=projection.fromLatLngToDivPixel(self.latLng);switch(self.alignment){case"top":x=posPixel.x-div.offsetWidth/2,y=posPixel.y-div.offsetHeight;break;case"bottom":x=posPixel.x-div.offsetWidth/2,y=posPixel.y;break;case"left":x=posPixel.x-div.offsetWidth,y=posPixel.y-div.offsetHeight/2;break;case"right":x=posPixel.x,y=posPixel.y-div.offsetHeight/2;break;case"center":x=posPixel.x-div.offsetWidth/2,y=posPixel.y-div.offsetHeight/2;break;case"topleft":case"lefttop":x=posPixel.x-div.offsetWidth,y=posPixel.y-div.offsetHeight;break;case"topright":case"righttop":x=posPixel.x,y=posPixel.y-div.offsetHeight;break;case"bottomleft":case"leftop":x=posPixel.x-div.offsetWidth,y=posPixel.y;break;case"bottomright":case"rightbottom":x=posPixel.x,y=posPixel.y;break;default:throw new Error("Invalid alignment type of custom marker!")}self.cssPosition?div.style.transform="translate(".concat(x+self.offsetX,"px, ").concat(y+self.offsetY,"px)"):(div.style.left=x+self.offsetX+"px",div.style.top=y+self.offsetY+"px"),div.style["z-index"]=self.zIndex}}},{key:"onAdd",value:function(){var div=self.$el,panes=this.getPanes();div.style.position="absolute",div.style.display="inline-block",div.style.zIndex=self.zIndex,panes.overlayLayer.appendChild(div),panes.overlayMouseTarget.appendChild(div),this.getDraggable=function(){return!1},this.getPosition=function(){return new window.google.maps.LatLng(self.lat,self.lng)},self.afterCreate(this)}},{key:"onRemove",value:function(){if(self.$el){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");msie>0||ua.match(/Trident.*rv\:11\./)?self.$el.parentNode.removeChild(self.$el):self.$el.remove()}}}]),Overlay}(window.google.maps.OverlayView);_this3.$overlay=new Overlay(map),setTimeout((function(){_this3.$overlay&&(_this3.$overlay.repaint(),_this3.opacity=1)}),100)}))},computed:{lat:function(){return parseFloat(isNaN(this.marker.lat)?this.marker.latitude:this.marker.lat)},lng:function(){return parseFloat(isNaN(this.marker.lng)?this.marker.longitude:this.marker.lng)},latLng:function(){return this.marker instanceof window.google.maps.LatLng?this.marker:new window.google.maps.LatLng(this.lat,this.lng)}},destroyed:function(){this.$clusterObject?this.$clusterObject.removeMarker(this.$overlay,!0):(this.$overlay.setMap(null),this.$overlay=void 0)}},map_CustomMarkervue_type_script_lang_js=CustomMarkervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(map_CustomMarkervue_type_script_lang_js,CustomMarkervue_type_template_id_ec50e0be_render,CustomMarkervue_type_template_id_ec50e0be_staticRenderFns,!1,null,null,null)
/* harmony default export */,CustomMarker=component.exports,MapProfileMarkervue_type_template_id_187cd326_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"map-marker-container"},[_c("el-image",{staticClass:"map-image-marker",attrs:{src:_vm.getFullPath(_vm.image)}},[_c("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[_c("span",{staticClass:"dot placeholder-loading"},[_vm._v("...")])]),_c("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[_c("i",{staticClass:"el-icon-office-building placeholder-image "})])]),_c("div",{staticClass:"marker-arrow"})],1)},MapProfileMarkervue_type_template_id_187cd326_scoped_true_staticRenderFns=[],MapProfileMarkervue_type_script_lang_js={props:["image"],methods:{getFullPath:function(image){var fullPath="https://".concat(document.domain).concat(image);return fullPath}}},map_MapProfileMarkervue_type_script_lang_js=MapProfileMarkervue_type_script_lang_js,MapProfileMarker_component=(0,componentNormalizer/* default */.Z)(map_MapProfileMarkervue_type_script_lang_js,MapProfileMarkervue_type_template_id_187cd326_scoped_true_render,MapProfileMarkervue_type_template_id_187cd326_scoped_true_staticRenderFns,!1,null,"187cd326",null)
/* harmony default export */,MapProfileMarker=MapProfileMarker_component.exports,FMapWidgetvue_type_script_lang_js={props:["data","height","markerType"],components:{customMarker:CustomMarker,MapProfileMarker:MapProfileMarker},data:function(){return{mapOptions:{maxZoom:16,gestureHandling:"cooperative"},mapStyle:{width:"100%",height:this.height?this.height:"300px"},defaultIcon:"",isClicked:!1,currentMarker:{},center:{lat:40.712776,lng:-74.005974}}},watch:{data:{handler:function(newVal){(0,validation/* isEmpty */.xb)(newVal)||this.fitBounds()}}},computed:{markersList:function(){return(0,validation/* isEmpty */.xb)(this.data)?[]:this.data.filter((function(data){return data.location}))}},mounted:function(){var _this=this;this.data.location&&this.getLocation();var theme=window.localStorage.getItem("theme");theme&&"black"===theme&&(this.mapOptions.styles=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]),this.$refs.mapView.$mapPromise.then((function(){
// Waits for Map to be loaded initially
_this.fitBounds()}))},methods:{loadInfo:function(data){var _this2=this;this.isClicked=!1,this.$nextTick((function(){_this2.currentMarker=data,_this2.isClicked=!0}))},mapclick:function(){this.isClicked=!1},fitBounds:function(){if(window.google&&window.google.maps){var b=new window.google.maps.LatLngBounds,self=this;if(this.data)for(var i=0;i<this.data.length;i++)self.data[i].location&&b.extend({lat:self.data[i].location.lat,lng:self.data[i].location.lng});this.$refs.mapView.fitBounds(b)}},getLocation:function(){var self=this,geocoder=new window.google.maps.Geocoder;geocoder.geocode({address:this.$account.org.timezone},(function(results,status){if(status===window.google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();self.center={lat:latitude,lng:longitude}}}))}}},components_FMapWidgetvue_type_script_lang_js=FMapWidgetvue_type_script_lang_js,FMapWidget_component=(0,componentNormalizer/* default */.Z)(components_FMapWidgetvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FMapWidget=FMapWidget_component.exports},
/***/960858:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return MapWidget}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/dashboard/widget/static/MapWidget.vue?vue&type=template&id=4121ebcd
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"row fmapwidget",staticStyle:{width:"100%",height:"100%"}},[_c("div",{class:{"map-drag-area":"new"===_vm.mode,"map-drag-area":"edit"===_vm.mode}}),_c("f-map-widget",{staticStyle:{width:"100%",height:"100%"},attrs:{data:_vm.data,height:"400px"},scopedSlots:_vm._u([{key:"default",fn:function(markerScope){return[_c("div",{staticClass:"row ellipsis",staticStyle:{"min-width":"250px"}},[_c("div",{staticClass:"col"},[_c("div",[_c("div",{staticClass:"row"},[_c("space-avatar",{attrs:{name:!1,size:"xxlg",space:markerScope.currentMarker}}),_c("div",{staticClass:"fw5 ellipsis inline pointer self-center",staticStyle:{"font-size":"16px",top:"10px","margin-left":"10px"},on:{click:function($event){return _vm.openOverview(markerScope.currentMarker.id)}}},[_vm._v(" "+_vm._s(markerScope.currentMarker.name)+" ")])],1),_vm._l(markerScope.currentMarker.stats,(function(stats,index){return _c("div",{key:index,staticClass:"row g-marker-sub",staticStyle:{margin:"20px"}},[_c("div",{staticClass:"col-7"},[_c("div",{staticClass:"pull-left",on:{click:function($event){return _vm.filterByBuilding("/app/fa/faults",markerScope.currentMarker.id,stats)}}},[_vm._v(" "+_vm._s(stats.severity)+" ")])]),_c("div",{staticClass:"col-5"},[_c("div",{staticClass:"pull-right",staticStyle:{"font-weight":"500"},on:{click:function($event){return _vm.filterByBuilding("/app/fa/faults",markerScope.currentMarker.id,stats)}}},[_vm._v(" "+_vm._s(stats.count)+" ")])])])}))],2)])])]}}])})],1)},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),FMapWidget=(__webpack_require__(670560),__webpack_require__(648324),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(450886),__webpack_require__(434284),__webpack_require__(169358),__webpack_require__(163525)),Space=__webpack_require__(826127),MapWidgetvue_type_script_lang_js={data:function(){return{mapSummary:{loading:!0,defaultImage:__webpack_require__(188742),data:[],center:{lat:24.8001981,lng:55.1142434}},data:""}},mounted:function(){this.initdata()},components:{FMapWidget:FMapWidget/* default */.Z,SpaceAvatar:Space/* default */.Z},computed:{mode:function(){return this.$route.query?this.$route.query.create:"normal"}},created:function(){this.$store.dispatch("loadAlarmSeverity")},methods:{initdata:function(){var self=this;setTimeout((function(){self.loadMap()}),3e3)},filterByBuilding:function(url,param,stats){var filterObj={resource:{operatorId:38,value:[param+""]}};stats&&-1!==stats.id&&(filterObj.severity={operatorId:36,value:[stats.id+""]}),
// url = url + '?search=' + encodeURIComponent(JSON.stringify(filterObj))
this.mobile||this.$router.push({path:url,query:{search:JSON.stringify(filterObj),includeParentFilter:"true"}})},loadMap:function(){var self=this;self.$http.get("/report/alarms/siteMap").then((function(response){if(response.data&&response.data.length){var _step,reportData=response.data.filter((function(rt){return rt.siteMeta&&rt.siteMeta.location&&rt.siteMeta.location.lat&&null!==rt.siteMeta.location.lat&&rt.siteMeta&&rt.siteMeta.location&&rt.siteMeta.location.lng&&null!==rt.siteMeta.location.lng})),mapDatas=[],severityDetails=self.getTopSeverityDetails(3),_iterator=(0,createForOfIteratorHelper/* default */.Z)(reportData);try{var _loop=function(){var row=_step.value,stats=severityDetails.map((function(severityLevel){return{id:severityLevel.id,severity:severityLevel.severity,count:row.stats[severityLevel.severity]||0}}));stats.push({id:-1,severity:"Total",count:row.stats.Total||0});var thisData={avatarUrl:row.siteMeta.avatar,id:row.siteMeta.id,location:{lat:row.siteMeta.location.lat,lng:row.siteMeta.location.lng},name:row.siteMeta.name,stats:stats};mapDatas.push(thisData)};for(_iterator.s();!(_step=_iterator.n()).done;)_loop()}catch(err){_iterator.e(err)}finally{_iterator.f()}self.data=mapDatas}else self.mapSummary.loading=!1})).catch((function(error){self.data=[]}))},getTopSeverityDetails:function(levels){for(var severityLevel=this.$store.state.alarmSeverity,topThreeSeverity=[],n=0,len=Object.keys(severityLevel).length;n<levels&&n<len;n++){var severityLevelObject={cardinality:severityLevel[n].cardinality,severity:severityLevel[n].severity,id:severityLevel[n].id};topThreeSeverity.push(severityLevelObject)}return topThreeSeverity}}},static_MapWidgetvue_type_script_lang_js=MapWidgetvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(static_MapWidgetvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,MapWidget=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/60858.js.map