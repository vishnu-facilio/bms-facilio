"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[88921],{
/***/688921:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return OverviewLayout}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/spacemanagement/overview/OverviewLayout.vue?vue&type=template&id=99958f24
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100"},[_c("el-row",{staticClass:"height100"},[_c("el-col",{staticClass:"height100",attrs:{span:6}},[_c("SpaceNav",{staticClass:"fc-white-bg height100"})],1),_c("el-col",{staticClass:"height100",attrs:{span:18}},[_c("router-view")],1)],1)],1)},staticRenderFns=[],SpaceNavBarvue_type_template_id_988cb934_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"space-management-v1-tree"},[_c("div",{staticClass:"d-flex flex-direction-column"},[_c("div",{staticClass:"fc-black-13 text-left site-border-bottom-grey pL20 pR20 pT10 pB10",on:{click:_vm.back}},[_c("i",{staticClass:"el-icon-back pR10 bold"}),_c("a",{staticClass:"fc-black-12 bold"},[_vm._v(" "+_vm._s(_vm.$t("common._common.back_list"))+" ")])]),_vm.isSiteLoading?_vm._e():_c("div",{staticClass:"side-bar-site-details flex-middle",class:{siteActive:_vm.isSiteOverview}},[_c("div",[_vm.site.photoId>0?_c("img",{staticClass:"site-img-container",attrs:{src:_vm.getImage(_vm.site.photoId)}}):_vm.newSiteSummary?_c("fc-icon",{attrs:{group:"default",name:"site",size:"50"}}):_c("InlineSvg",{staticClass:"pointer",attrs:{src:"svgs/spacemanagement/site",iconClass:"icon icon-60"}})],1),_c("div",{staticClass:"pL15 width100"},[_c("div",{staticClass:"display-flex-between-space"},[_c("div",{staticClass:"fc-id"},[_vm._v(_vm._s("#"+_vm.site.value))]),_c("div",{directives:[{name:"show",rawName:"v-show",value:!_vm.hideSwitchSite,expression:"!hideSwitchSite"}]},[_c("el-popover",{attrs:{placement:"bottom",width:"240",trigger:"click","popper-class":"site-switch-popover"},on:{"after-leave":function($event){_vm.searchText=null}},model:{value:_vm.siteSwitcher,callback:function($$v){_vm.siteSwitcher=$$v},expression:"siteSwitcher"}},[_c("div",{staticClass:"popover-text",attrs:{slot:"reference"},slot:"reference"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.change_site"))+" ")]),_c("div",{staticClass:"popover-body d-flex flex-direction-column"},[_c("el-input",{staticClass:"fc-input-full-border2 width100 spacenav-search",attrs:{"prefix-icon":"el-icon-search",autofocus:""},model:{value:_vm.searchText,callback:function($$v){_vm.searchText=$$v},expression:"searchText"}}),_c("div",{staticClass:"d-flex overflow-y-scroll flex-direction-column mT10"},_vm._l(_vm.filteredSiteList,(function(site,siteIndex){return _c("div",{key:siteIndex,class:["popover-content pointer",site.value==_vm.siteId&&"current-site"],on:{click:function($event){return _vm.switchSite(site.value)}}},[_c("div",{staticClass:"display-flex-between-space"},[_c("div",{staticClass:"label"},[_vm._v(_vm._s(site.label))]),site.value==_vm.siteId?_c("div",[_c("i",{staticClass:"el-icon-check"})]):_vm._e()])])})),0)],1)])],1)]),_c("div",{staticClass:"display-flex-between-space"},[_c("div",{staticClass:"label-text pointer",on:{click:_vm.openSiteSummary}},[_vm._v(" "+_vm._s(_vm.site.label)+" ")])])])])]),_vm.loading?_c("div",[_c("spinner",{attrs:{show:!0}})],1):_c("div",{staticClass:"space-tree-v1"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.initialDataLoading,expression:"initialDataLoading"}]},[_c("spinner",{attrs:{show:!0}})],1),_c("el-tree",{directives:[{name:"show",rawName:"v-show",value:!_vm.initialDataLoading&&!_vm.isSiteLoading,expression:"!initialDataLoading && !isSiteLoading"}],ref:"tree",attrs:{props:_vm.treeProps,"node-key":"key",load:_vm.loadTree,"highlight-current":!0,"default-expanded-keys":_vm.defaultExpandedKeys,"current-node-key":_vm.currentNodeKey,accordion:"",lazy:""},on:{"node-click":_vm.handleNodeClick},scopedSlots:_vm._u([{key:"default",fn:function(ref){var node=ref.node,data=ref.data;return[_c("div",{staticClass:"space-nav-tree-slot align-center",class:[1===node.level&&"building-border-bottom",2===node.level&&"floor-border-bottom"]},[_c("div",{staticClass:"d-flex align-center"},[3===node.level?_c("i",{staticClass:"fa fa-circle site-dot-icon mR10"}):_vm._e(),data.data.photoId>0&&node.level<3?_c("img",{staticClass:"mR10 nav-img-container",attrs:{src:_vm.getImage(data.data.photoId)}}):_vm.newSiteSummary&&node.level<3?_c("fc-icon",{staticClass:"mL5 mR10",attrs:{group:"default",name:_vm.getIconSrc(data),size:"25"}}):node.level<3?_c("InlineSvg",{staticClass:"mR10",attrs:{src:_vm.getIconSrc(data),iconClass:"icon icon-xxxll"}}):_vm._e(),_c("div",{class:["label-text",node.isCurrent&&"bold"]},[_vm._v(" "+_vm._s(data.name)+" ")])],1),_c("div",[node.loading&&!node.isLeaf?_c("i",{staticClass:"el-icon-loading"}):node.expanded&&!node.isLeaf?_c("i",{staticClass:"el-icon-arrow-up"}):node.isLeaf?_vm._e():_c("i",{staticClass:"el-icon-arrow-down"})])])]}}])})],1)])},SpaceNavBarvue_type_template_id_988cb934_staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),toConsumableArray=__webpack_require__(488478),slicedToArray=__webpack_require__(554621),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),validation=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(879288),__webpack_require__(670560),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(434284),__webpack_require__(634338),__webpack_require__(990260)),eventBus=__webpack_require__(398011),baseUrl=__webpack_require__(420499),router=__webpack_require__(329435),picklist=__webpack_require__(961358),SpaceHelper=__webpack_require__(436289),SpaceNavBarvue_type_script_lang_js={mixins:[SpaceHelper/* default */.Z],data:function(){return{treeProps:{label:"name",children:"spaces",isLeaf:"leaf"},loading:!1,defaultExpandedKeys:[],currentNodeKey:null,searchText:null,initialDataLoading:!1,siteSwitcher:!1,isSiteHandled:!1,isSiteLoading:!0,siteList:[],filteredSiteList:[]}},computed:{viewname:function(){return this.$route.params.viewname?this.$route.params.viewname:"all"},pathname:function(){return this.$route.params.pathname?this.$route.params.pathname:"sites"},site:function(){var _this=this;return(this.siteList||[]).find((function(site){return site.value===_this.siteId}))||{}},siteId:function(){return Number(this.$route.params.siteid)||-1},isSiteScope:function(){var currentSiteId=Number(this.$cookie.get("fc.currentSite"))||-1;return currentSiteId>0},currentRoutePath:function(){var $route=this.$route,path=$route.path;return path},isSiteOverview:function(){var siteId=this.siteId,currentRoutePath=this.currentRoutePath;return this.getSiteLink(siteId)===currentRoutePath},hideSwitchSite:function(){return(this.siteList||[]).length<2||this.isSiteScope}},created:function(){var _this2=this;this.getSiteList().then((function(){_this2.isSiteLoading=!1,eventBus/* eventBus */.Y.$on("overviewRecordDetails",(function(space){_this2.loading&&(_this2.loading=!1),_this2.expandTree(space)})),eventBus/* eventBus */.Y.$on("reloadTree",(function(space){_this2.loading=!0,_this2.initialDataLoading=!0,_this2.$nextTick((function(){(0,validation/* isEmpty */.xb)(space)||_this2.expandTree(space),_this2.loading=!1}))}))}))},watch:{searchText:{handler:function(){this.getFilteredSiteList()}}},methods:{getSiteList:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var siteId,defaultIds,_yield$getFieldOption,error,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return siteId=_this3.siteId,defaultIds=[],defaultIds.push(siteId),_context.next=5,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:"site",additionalParams:{isToFetchDecommissionedResource:!0}},defaultIds:defaultIds});case 5:_yield$getFieldOption=_context.sent,error=_yield$getFieldOption.error,options=_yield$getFieldOption.options,error||(_this3.siteList=options,_this3.filteredSiteList=_this3.siteList);case 9:case"end":return _context.stop()}}),_callee)})))()},getFilteredSiteList:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var siteId,searchText,defaultIds,_yield$getFieldOption2,error,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return siteId=_this4.siteId,searchText=_this4.searchText,defaultIds=[],defaultIds.push(siteId),_context2.next=5,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:"site",additionalParams:{isToFetchDecommissionedResource:!0}},defaultIds:defaultIds,searchText:searchText});case 5:_yield$getFieldOption2=_context2.sent,error=_yield$getFieldOption2.error,options=_yield$getFieldOption2.options,error||(_this4.filteredSiteList=options);case 9:case"end":return _context2.stop()}}),_callee2)})))()},switchSite:function(val){var siteUrl=this.getSiteLink(val);siteUrl!=this.currentRoutePath&&(this.initialDataLoading=!0,this.loading=!0,this.$router.push({path:siteUrl}),this.siteSwitcher=!1)},getIconSrc:function(_ref){var data=_ref.data,newSiteSummary=this.newSiteSummary,spaceType=data.spaceType,src="svgs/spacemanagement/";return 2===spaceType&&(src=newSiteSummary?"building":src+="building"),3===spaceType&&(src=newSiteSummary?"floorstack":src+="floor"),4===spaceType&&(src=newSiteSummary?"workspace":src+="space"),src},loadTree:function(node,resolve){var _this5=this,promise=[];promise.push(this.getSiteList()),promise.push(this.site),Promise.all(promise).finally((function(){_this5.loadChildren(node,resolve)}))},loadChildren:function(node,resolve){0===node.level?(this.initialDataLoading=!0,this.isSiteHandled=!0,this.loadSubTree({name:this.site.label,path:this.getSiteLink(this.site.value),data:this.site},resolve)):(this.isSiteHandled=!1,this.loadSubTree(node.data,resolve))},handleNodeClick:function(node){node.path!=this.currentRoutePath&&this.$router.push({path:node.path})},findRoute:function(){if((0,router/* isWebTabsEnabled */.tj)()){var tabType=router/* tabTypes */.VF.CUSTOM,config={type:"portfolio"},route=(0,router/* findRouteForTab */.OD)(tabType,{config:config})||{};return(0,validation/* isEmpty */.xb)(route)?null:this.$router.resolve({name:route.name}).href}return"/app/home/portfolio"},getSiteLink:function(siteId){var parentPath=this.findRoute();if(parentPath)return"".concat(parentPath,"/").concat(this.pathname,"/").concat(this.viewname,"/site/").concat(siteId,"/overview")},getBuildingLink:function(siteId,buildingId){var parentPath=this.findRoute();if(parentPath)return"".concat(parentPath,"/").concat(this.pathname,"/").concat(this.viewname,"/site/").concat(siteId,"/building/").concat(buildingId)},getFloorLink:function(siteId,floorId){var parentPath=this.findRoute();if(parentPath)return"".concat(parentPath,"/").concat(this.pathname,"/").concat(this.viewname,"/site/").concat(siteId,"/floor/").concat(floorId)},getSpaceLink:function(siteId,spaceId){var parentPath=this.findRoute();if(parentPath)return"".concat(parentPath,"/").concat(this.pathname,"/").concat(this.viewname,"/site/").concat(siteId,"/space/").concat(spaceId)},back:function(){var parentPath=this.findRoute();parentPath&&this.$router.push({path:"".concat(parentPath,"/").concat(this.pathname,"/")+this.viewname})},loadSubTree:function(item,resolve){var spaceKey,subparams,_this6=this,spaceType=[4];if(this.isSiteHandled)item.data.value&&(subparams=[{key:"site",value:item.data.value},{key:"building",operator:"is empty"},{key:"floor",operator:"is empty"},{key:"space1",operator:"is empty"},{key:"space2",operator:"is empty"},{key:"space3",operator:"is empty"},{key:"space4",operator:"is empty"},{key:"space5",operator:"is empty"}]);else if(2===item.data.spaceType)subparams=[{key:"building",value:item.data.id},{key:"floor",operator:"is empty"},{key:"space1",operator:"is empty"},{key:"space2",operator:"is empty"},{key:"space3",operator:"is empty"},{key:"space4",operator:"is empty"},{key:"space5",operator:"is empty"}];else if(3===item.data.spaceType)spaceKey="floor",subparams=[{key:spaceKey,value:item.data.id},{key:"space1",operator:item.data.spaceId1>0?"is":"is empty",value:item.data.spaceId1},{key:"space2",operator:item.data.spaceId2>0?"is":"is empty",value:item.data.spaceId2},{key:"space3",operator:item.data.spaceId3>0?"is":"is empty",value:item.data.spaceId3},{key:"space4",operator:item.data.spaceId4>0?"is":"is empty",value:item.data.spaceId4},{key:"space5",operator:item.data.spaceId5>0?"is":"is empty",value:item.data.spaceId5}];else{if(4!==item.data.spaceType)return void resolve([]);if(spaceKey="space",item.data.spaceId1<0)subparams=[{key:"space1",operator:"is",value:item.data.spaceId},{key:"space2",operator:"is empty"},{key:"space3",operator:"is empty"},{key:"space4",operator:"is empty"},{key:"space5",operator:"is empty"}];else if(item.data.spaceId2<0)subparams=[{key:"space2",operator:"is",value:item.data.spaceId},{key:"space3",operator:"is empty"},{key:"space4",operator:"is empty"},{key:"space5",operator:"is empty"}];else if(item.data.spaceId3<0)subparams=[{key:"space3",operator:"is",value:item.data.spaceId},{key:"space4",operator:"is empty"},{key:"space5",operator:"is empty"}];else if(item.data.spaceId4<0)subparams=[{key:"space4",operator:"is",value:item.data.spaceId},{key:"space5",operator:"is empty"}];else{if(!(item.data.spaceId5<0))return void resolve([]);subparams=[{key:"space5",operator:"is",value:item.data.spaceId}]}}if(this.isSiteHandled||2===item.data.spaceType){var itemId,promises=[];itemId=this.isSiteHandled?item.data.value:item.data.id;var url="/v2/basespace/getBaseSpaceChildren?baseSpaceId="+itemId;promises.push(this.$http.get(url)),Promise.all(promises).then((function(_ref2){var _ref3=(0,slicedToArray/* default */.Z)(_ref2,1),baseSpaceList=_ref3[0],siteChilren=[];if(!(0,validation/* isEmpty */.xb)(baseSpaceList)){var _baseSpaceList$data=baseSpaceList.data,responseCode=_baseSpaceList$data.responseCode,_baseSpaceList$data$r=_baseSpaceList$data.result.basespaces,basespaces=void 0===_baseSpaceList$data$r?[]:_baseSpaceList$data$r;0===responseCode&&siteChilren.push.apply(siteChilren,(0,toConsumableArray/* default */.Z)(basespaces))}var chilren=_this6.getChildData(siteChilren);resolve(chilren)})).finally((function(){_this6.initialDataLoading&&(_this6.initialDataLoading=!1),_this6.setCurrentKey()}))}else this.$util.loadSpacesContext(spaceType,null,subparams).then((function(response){var spaces=response.records,children=_this6.getChildData(spaces);resolve(children),_this6.setCurrentKey()}))},getChildData:function(records){var children=[];if((0,validation/* isArray */.kJ)(records)){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(records);try{for(_iterator.s();!(_step=_iterator.n()).done;){var bs=_step.value,path="";if("Site"===bs.spaceTypeVal)path=this.getSiteLink(bs.id);else if("Building"===bs.spaceTypeVal)path=this.getBuildingLink(this.siteId,bs.id);else if("Floor"===bs.spaceTypeVal)path=this.getFloorLink(this.siteId,bs.id);else if("Space"===bs.spaceTypeVal)path=this.getSpaceLink(this.siteId,bs.id);else if("Zone"===bs.spaceTypeVal){var parentPath=this.findRoute();parentPath&&(path="".concat(parentPath,"/zone/").concat(bs.id,"/overview"))}var isLeaf=!1;1===bs.spaceType?bs.noOfBuildings<1&&bs.noOfIndependentSpaces<1&&(isLeaf=!0):2===bs.spaceType?bs.noOfFloors<1&&bs.noOfIndependentSpaces<1&&(isLeaf=!0):3===bs.spaceType?bs.noOfIndependentSpaces<1&&(isLeaf=!0):bs.noOfSubSpaces<1&&(isLeaf=!0),children.push({key:bs.id+"_"+bs.spaceTypeVal,name:bs.name,path:path,data:bs,leaf:isLeaf})}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return children},expandTree:function(data){var _this7=this,defaultExpandedKeys=[],spaceTypeVal=data.spaceTypeVal,spaceType=data.spaceType,key="".concat(data.id,"_").concat(spaceTypeVal),treeRef=this.$refs.tree,loaded=!1,init=!1;if("Site"===spaceTypeVal&&(key=null),!(0,validation/* isEmpty */.xb)(key)){if((0,validation/* isEmpty */.xb)(treeRef))this.currentNodeKey=key,init=!0;else{var node=treeRef.getNode(key);loaded=(node||{}).loaded}loaded||(0,validation/* isEmpty */.xb)(data.id)||(0,validation/* isEmpty */.xb)(key)||defaultExpandedKeys.push(key)}(0,validation/* isEmpty */.xb)(data.buildingId)||2==spaceType||defaultExpandedKeys.push("".concat(data.buildingId,"_Building")),(0,validation/* isEmpty */.xb)(data.floorId)||3==spaceType||defaultExpandedKeys.push("".concat(data.floorId,"_Floor")),(0,validation/* isEmpty */.xb)(data.spaceId1)||defaultExpandedKeys.push("".concat(data.spaceId1,"_Space")),(0,validation/* isEmpty */.xb)(data.spaceId2)||defaultExpandedKeys.push("".concat(data.spaceId2,"_Space")),(0,validation/* isEmpty */.xb)(data.spaceId3)||defaultExpandedKeys.push("".concat(data.spaceId3,"_Space")),(0,validation/* isEmpty */.xb)(data.spaceId4)||defaultExpandedKeys.push("".concat(data.spaceId4,"_Space")),(0,validation/* isEmpty */.xb)(data.spaceId5)||defaultExpandedKeys.push("".concat(data.spaceId5,"_Space")),this.defaultExpandedKeys=defaultExpandedKeys,init||(0,validation/* isEmpty */.xb)(treeRef)||this.$nextTick((function(){_this7.currentNodeKey=key,_this7.setCurrentKey()}))},setCurrentKey:function(){var currentKey,treeRef=this.$refs.tree,currentNodeKey=this.currentNodeKey;(0,validation/* isEmpty */.xb)(treeRef)||(currentKey=treeRef.getCurrentKey(),currentKey!=currentNodeKey&&treeRef.setCurrentKey(currentNodeKey))},openSiteSummary:function(){var url=this.getSiteLink(this.siteId);url!=this.currentRoutePath&&this.$router.push({path:url})},getImage:function(photoId){return"".concat((0,baseUrl/* getBaseURL */.BS)(),"/v2/files/preview/").concat(photoId)}}},components_SpaceNavBarvue_type_script_lang_js=SpaceNavBarvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_SpaceNavBarvue_type_script_lang_js,SpaceNavBarvue_type_template_id_988cb934_render,SpaceNavBarvue_type_template_id_988cb934_staticRenderFns,!1,null,null,null)
/* harmony default export */,SpaceNavBar=component.exports,OverviewLayoutvue_type_script_lang_js={components:{SpaceNav:SpaceNavBar}},overview_OverviewLayoutvue_type_script_lang_js=OverviewLayoutvue_type_script_lang_js,OverviewLayout_component=(0,componentNormalizer/* default */.Z)(overview_OverviewLayoutvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,OverviewLayout=OverviewLayout_component.exports},
/***/436289:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return SpaceHelper}});
// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js
__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(670560);
// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.for-each.js
var render,staticRenderFns,SpaceHelpervue_type_script_lang_js={computed:{getFormattedFile:function(){var _this=this,photos=this.photos,filePreviewList=[];return(photos||[]).forEach((function(photo){filePreviewList.push({contentType:"image",previewUrl:photo.originalUrl,downloadUrl:_this.$helpers.getFileDownloadUrl(photo.photoId)})})),filePreviewList},newSiteSummary:function(){var $helpers=this.$helpers,_ref=$helpers||{},isLicenseEnabled=_ref.isLicenseEnabled;return isLicenseEnabled("NEW_SITE_SUMMARY")&&isLicenseEnabled("WEATHER_INTEGRATION")}}},helpers_SpaceHelpervue_type_script_lang_js=SpaceHelpervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(helpers_SpaceHelpervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SpaceHelper=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/88921.js.map