(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[36695],{
/***/350367:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FUploadPhotos}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/FUploadPhotos.vue?vue&type=template&id=5a0f9682
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticClass:"upload-photos-dialog fc-dialog-center-container",attrs:{title:"Upload Photos",visible:_vm.showDialog,"append-to-body":!0},on:{"update:visible":function($event){_vm.showDialog=$event},"before-close":_vm.closeDialog}},[_vm.showDialog?_c("el-upload",{attrs:{multiple:"","list-type":"picture-card","file-list":_vm.photos,action:"",accept:"image/*","http-request":_vm.onUpload,"on-success":_vm.onUploadSuccess,"on-error":_vm.onError,"on-remove":_vm.onRemove}},[_c("i",{staticClass:"el-icon-plus"})]):_vm._e(),_c("span",{staticClass:"dialog-footer modal-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.closeDialog}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.done}},[_vm._v("Done")])],1)],1)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),validation=(__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(990260)),eventBus=__webpack_require__(398011),FUploadPhotosvue_type_script_lang_js={props:["module","record","list"],data:function(){return{photos:[],showDialog:!1,isChanged:!1}},methods:{open:function(){this.photos=(0,validation/* isEmpty */.xb)(this.list)?[]:this.list,this.showDialog=!0},onUpload:function(_ref){var file=_ref.file,data=(_ref.onError,{parentId:this.record.id,module:this.module}),formData=new FormData;for(var key in formData.append("file",file,file.name),data)this.$helpers.setFormData(key,data[key],formData);return this.$http.post("v2/photos/upload",formData)},onUploadSuccess:function(response){var _response$data=response.data,responseCode=_response$data.responseCode,result=_response$data.result;0===responseCode&&(this.list.push(result.photos[0]),this.isChanged=!0)},onError:function(){this.$message.error(this.$t("setup.users_management.Invalid_image"))},onRemove:function(file){var _this=this;this.$http.post("/v2/photos/delete",{id:file.id,photoId:file.photoId,module:this.module,parentId:this.record.id}).then((function(response){if(0===response.data.responseCode){var list=(0,toConsumableArray/* default */.Z)(_this.list),index=list.findIndex((function(f){return f.id===file.id}));list.splice(index,1),_this.$emit("updatePhotos",list),_this.isChanged=!0}})).catch((function(){}))},done:function(){this.showDialog=!1,this.photos=[],this.isChanged&&(eventBus/* eventBus */.Y.$emit("refreshDetails"),this.isChanged=!1)},closeDialog:function(){this.isChanged&&(eventBus/* eventBus */.Y.$emit("refreshDetails"),this.isChanged=!1),this.showDialog=!1}}},components_FUploadPhotosvue_type_script_lang_js=FUploadPhotosvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FUploadPhotosvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FUploadPhotos=component.exports},
/***/372587:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return SpaceAssetChooser}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/SpaceAssetChooser.vue?vue&type=template&id=daefb110
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:_vm.visibility,fullscreen:!1,open:"top","custom-class":" fc-dialog-up spaceassetchooser setup-dialog60","append-to-body":!0,"before-close":_vm.handleclose},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("div",{attrs:{id:"spaceassetchooser"}},[_c("div",{staticStyle:{height:"600px","max-height":"600px"}},[_vm.hideSidebar?_vm._e():_c("div",{staticClass:"sidebar",staticStyle:{height:"100%",width:"33%",display:"inline-block"}},[_c("div",{staticClass:"pT30",staticStyle:{"margin-left":"30px","z-index":"100"}},[_c("div",{staticClass:"flLeft",staticStyle:{"padding-right":"30px"},attrs:{disabled:"asset"===_vm.picktype},on:{click:function($event){"asset"!==_vm.picktype&&_vm.openSpace()}}},[_c("div",{staticClass:"flLeft",staticStyle:{"padding-top":"1px"}},[_c("i",{staticClass:"el-icon-circle-check",class:_vm.isAsset?"normalspace":"selectedspace"})]),_c("div",{staticClass:"txtstyle pointer flLeft",staticStyle:{"padding-left":"5px"}},[_vm._v(" "+_vm._s(_vm.$t("common.space_asset_chooser.space"))+" ")]),_c("div",{staticClass:"clearboth"})]),_c("div",{staticClass:"flLeft",attrs:{disabled:"space"===_vm.picktype},on:{click:function($event){"space"!==_vm.picktype&&_vm.openAsset()}}},[_c("div",{staticClass:"flLeft",staticStyle:{"padding-top":"1px"}},[_c("i",{staticClass:"el-icon-circle-check",class:_vm.isAsset?"selectedspace":"normalspace"})]),_c("div",{staticClass:"flLeft"},[_c("span",{staticClass:"txtstyle pointer",staticStyle:{"padding-left":"5px"}},[_vm._v(_vm._s(_vm.$t("common.space_asset_chooser.asset")))])]),_c("div",{staticClass:"clearboth"})]),_c("div",{staticClass:"clearboth"})]),_c("div",{staticStyle:{"margin-left":"30px"}},[_c("div",{staticClass:"space-heading pT30 pB5"},[_vm._v(" "+_vm._s(_vm.$t("common.space_asset_chooser.by_location"))+" ")]),_vm._l(_vm.resourceConfig,(function(field){return _c("div",{key:field.spaceType,staticClass:"pB15"},[_c("el-select",{attrs:{filterable:"",clearable:"",placeholder:field.placeHolder,"data-test-selector":""+field.placeHolder,disabled:4===field.spaceType&&!_vm.isAsset||field.disabled},on:{change:function($event){return _vm.onLocationSelected(field)}},model:{value:field.value,callback:function($$v){_vm.$set(field,"value",$$v)},expression:"field.value"}},_vm._l(field.options,(function(option){return _c("el-option",{key:option.id,attrs:{label:option.name,value:option.id,"data-test-selector":field.placeHolder+"_"+option.name}})})),1)],1)})),_c("div",{staticClass:"pT30"},[_c("div",{staticClass:"space-heading pT15 pB5"},[_vm._v(" "+_vm._s(_vm.$t("common.space_asset_chooser.by_category"))+" ")]),_c("div",[_vm.isAsset?_c("el-select",{attrs:{filterable:"",clearable:"",placeholder:_vm.assetCategory.placeHolder,"data-test-selector":""+_vm.$t("common.space_asset_chooser.by_category"),disabled:!_vm.isAsset},on:{change:_vm.onCategorySelected},model:{value:_vm.assetCategory.value,callback:function($$v){_vm.$set(_vm.assetCategory,"value",$$v)},expression:"assetCategory.value"}},_vm._l(_vm.assetCategory.options,(function(label,value){return _c("el-option",{key:value,attrs:{label:label,value:value,"data-test-selector":_vm.$t("common.space_asset_chooser.by_category")+"_"+label}})})),1):_c("el-select",{staticClass:"inline asset-category fc-input-full-border2",attrs:{filterable:"",clearable:"",placeholder:_vm.spaceCategory.placeHolder},on:{change:_vm.onSpaceCategorySelected},model:{value:_vm.spaceCategory.value,callback:function($$v){_vm.$set(_vm.spaceCategory,"value",$$v)},expression:"spaceCategory.value"}},_vm._l(_vm.spaceCategory.options,(function(label,value){return _c("el-option",{key:value,attrs:{label:label,value:value}})})),1)],1)])],2)]),_c("div",{staticClass:"pull-right heightlist",style:{width:_vm.hideSidebar?"100%":"67%"}},[_c("div",{staticStyle:{"padding-left":"20px","padding-right":"20px"}},[_vm.showQuickSearch?_c("div",{staticStyle:{display:"inline-block",width:"100%"}},[_c("div",{staticClass:"col-6 fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper relative chooser-search"},[_c("svg",{staticClass:"search-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"}},[_c("title",[_vm._v(_vm._s(_vm.$t("common._common.search")))]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQuery,expression:"quickSearchQuery"}],ref:"quickSearchQuery",staticClass:"quick-search-input",attrs:{autofocus:"autofocus",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQuery},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.loadResourceData.apply(null,arguments)},input:function($event){$event.target.composing||(_vm.quickSearchQuery=$event.target.value)}}}),_c("svg",{staticClass:"close-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.toggleQuickSearch}},[_c("title",[_vm._v("close")]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_c("div",{staticClass:"flex-middle justify-content-space"},[_c("span",{staticClass:"spaceheading",staticStyle:{display:"inline-block"}},[_vm._v(_vm._s(_vm.isAsset?this.$t("common.space_asset_chooser.asset_list"):this.$t("common.space_asset_chooser.space_list")))]),_c("span",{staticClass:"pull-right pointer"},[_c("span",{on:{click:_vm.toggleQuickSearch}},[_c("i",{staticClass:"el-icon-search"})])])])]),_c("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:_vm.loadMores,expression:"loadMores"}],staticClass:"scroll",attrs:{"infinite-scroll-distance":"10","infinite-scroll-immediate-check":"true"}},[_c("v-infinite-scroll",{staticStyle:{"max-height":"500px",height:"500px","overflow-y":"scroll"},attrs:{loading:_vm.loading,offset:20},on:{bottom:_vm.nextPage}},[_c("table",{staticClass:" pT15 fc-list-view-table"},[_c("thead",[_c("tr",{staticClass:"tablerow pT30",staticStyle:{"background-color":"#ffffff",padding:"15px"}},[_c("td",{staticClass:"headerrow width30"},[_vm._v(" #"+_vm._s(_vm.$t("common._common.id"))+" ")]),_c("td",{staticClass:"headerrow width30"},[_vm._v(" "+_vm._s(_vm.$t("common.space_asset_chooser.name"))+" ")]),_vm.hideSidebar?_vm._e():_c("td",{staticClass:"headerrow width30"},[_vm._v(" "+_vm._s(_vm.$t("common.space_asset_chooser.category"))+" ")]),_c("td"),_c("td")])]),_c("tbody",[_vm._l(_vm.spaceList,(function(space){return _vm.isAsset?_vm._e():_c("tr",{key:space.id,staticClass:"tablerow",class:{selectedrow:_vm.selectedObj===space},attrs:{"data-test-selector":""+space.name},on:{click:function($event){return _vm.select(space,1)}}},[_c("td",{staticClass:"contentrow width30"},[_vm._v(" #"+_vm._s(1==space.spaceType?"SI"+space.id:2==space.spaceType?"BU"+space.id:3==space.spaceType?"FL"+space.id:4==space.spaceType?"SP"+space.id:space.id)+" ")]),_c("td",{staticClass:"contentrow width30"},[_vm._v(_vm._s(space.name))]),_c("td",{staticClass:"contentrow width30"},[_vm._v(_vm._s(space.spaceTypeVal))]),_c("td"),_c("td",[_c("i",{staticClass:"el-icon-check",staticStyle:{color:"#39b2c2","padding-left":"20px"},style:{visibility:_vm.selectedObj===space?"visible":"hidden"}})])])})),_vm._l(_vm.assetList,(function(asset){return _vm.isAsset?_c("tr",{key:"asset_"+asset.id,staticClass:"tablerow",class:{selectedrow:_vm.selectedObj===asset},attrs:{"data-test-selector":""+asset.name},on:{click:function($event){return _vm.select(asset,2)}}},[_c("td",{staticClass:"contentrow width30"},[_vm._v("#"+_vm._s(asset.id))]),_c("td",{staticClass:"contentrow width30"},[_vm._v(_vm._s(asset.name))]),_vm.hideSidebar?_vm._e():_c("td",{staticClass:"contentrow width30"},[_vm._v(" "+_vm._s(asset.category?_vm.getAssetCategory(asset.category.id).displayName:"---")+" ")]),_c("td"),_c("td",[_c("i",{staticClass:"el-icon-check",staticStyle:{color:"#39b2c2","padding-left":"20px"},style:{visibility:_vm.selectedObj===asset?"visible":"hidden"}})])]):_vm._e()})),_vm.spaceList.length<1&&_vm.assetList.length<1?_c("tr",{staticStyle:{background:"none",border:"none","margin-top":"20px"}},[_c("td",{staticClass:"text-center label-txt-black",staticStyle:{"border-bottom":"none","font-size":"14px","padding-top":"40px",cursor:"auto"},attrs:{colspan:"100%"}},[_vm._v(" No "+_vm._s(_vm.isAsset?"Asset":"Space")+" to display! ")])]):_vm._e()],2)])])],1),_c("div",{staticClass:"space-asset-footer"},[_c("div",{staticClass:"space-asset-footer-align"},[_c("el-button",{staticStyle:{"font-size":"13px","font-weight":"bold",border:"2px solid #cde2e5",color:"#8eb1b6","letter-spacing":"0.5px",padding:"8px",width:"100px","text-transform":"uppercase"},attrs:{"data-test-selector":"SpaceAsset_cancel"},on:{click:_vm.handleclose}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticStyle:{"font-size":"13px","font-weight":"bold","letter-spacing":"0.5px","background-color":"#39b2c2","border-color":"#39b2c2",padding:"8px","text-transform":"uppercase"},attrs:{"data-test-selector":"SpaceAsset_save",type:"primary"},on:{click:_vm.associate}},[_vm._v(_vm._s(_vm.$t("common._common.select")))])],1)])])]),_c("div",{staticStyle:{position:"absolute",top:"40%",left:"55%","z-index":"5"}},[_c("spinner",{attrs:{show:_vm.resourceLoading,size:"70"}})],1)])])},staticRenderFns=[],objectSpread2=__webpack_require__(595082),vue_infinite_scroll=__webpack_require__(49026),vue_infinite_scroll_default=__webpack_require__.n(vue_infinite_scroll),ResourceMixin=__webpack_require__(22637),v_infinite_scroll=__webpack_require__(561364),v_infinite_scroll_default=__webpack_require__.n(v_infinite_scroll),Spinner=__webpack_require__(604947),vuex_esm=__webpack_require__(420629),SpaceAssetChooservue_type_script_lang_js={mixins:[ResourceMixin/* default */.Z],props:["visibility","appendToBody","query","picktype","hideSidebar","isService"],directives:{infiniteScroll:vue_infinite_scroll_default()},components:{Spinner:Spinner/* default */.Z,VInfiniteScroll:v_infinite_scroll_default()},data:function(){return{fetchingMore:!1,selected:!1,selectedObj:{},showQuickSearch:!1}},created:function(){this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadSpaceCategory")},mounted:function(){
// quickSearchQuery
"asset"===this.picktype&&(this.isAsset=!0),this.initResourceData()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory"])),{},{scrollDisabled:function(){return!1}}),component:{Spinner:Spinner/* default */.Z},watch:{visibility:function(val){var _this=this;val&&!this.query?(this.reInit(),this.hideSidebar&&(this.showQuickSearch=!0,this.$nextTick((function(){_this.$refs.quickSearchQuery&&_this.$refs.quickSearchQuery.focus()})))):val||!this.query||this.selectedObj&&this.selectedObj.id||this.$emit("associate",{},this.isAsset?"asset":"space")},query:function(val){var _this2=this;this.quickSearchQuery=val,val&&this.$refs.quickSearchQuery&&(this.selectedObj={},this.showQuickSearch=!0,this.$nextTick((function(){_this2.$refs.quickSearchQuery.focus()})),this.loadResourceData())}},methods:{loadMores:function(){this.fetchingMore=!0,this.openAsset(!0)},reInit:function(){this.showQuickSearch=!1,this.quickSearchQuery=null,this.paging.page=1,this.checkAndInitResourceData()},handleclose:function(){this.$emit("update:visibility",!1)},openSpace:function(){this.isAsset=!1,this.paging.page=1,this.loadSpace()},openAsset:function(isLoad){this.isAsset=!0,this.paging.page=1,this.loadAsset(isLoad)},select:function(obj,type){this.selectedObj=obj},associate:function(){this.$emit("associate",this.selectedObj,this.isAsset?"asset":"space")},toggleQuickSearch:function(){var _this3=this;this.showQuickSearch=!this.showQuickSearch,this.showQuickSearch?this.$nextTick((function(){_this3.$refs.quickSearchQuery.focus()})):(this.quickSearchQuery=null,this.loadResourceData())}}},components_SpaceAssetChooservue_type_script_lang_js=SpaceAssetChooservue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_SpaceAssetChooservue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SpaceAssetChooser=component.exports},
/***/664281:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return Storeroom}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/avatar/Storeroom.vue?vue&type=template&id=1587f6ed
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.storeRoom?_c("div",{staticClass:"inline"},[_c("div",{staticClass:"fc-avatar-element q-item-division relative-position cursor-pointer"},[!_vm.showSlide||"undefined"!==typeof _vm.disableSlide&&!1!==_vm.disableSlide?_vm.isSummary?_c("div",{staticClass:"q-item-side q-item-side-left q-item-section relative"},[_vm.avatarUrl?_c("img",{staticClass:"fc-avatar-square",class:_vm.sizeClass,attrs:{src:_vm.avatarUrl}}):_vm._e()]):_c("div",{staticClass:"q-item-side q-item-side-left q-item-section relative"},[_vm.avatarUrl?_c("img",{staticClass:"fc-avatar",class:_vm.sizeClass,attrs:{src:_vm.avatarUrl}}):_vm._e()]):_c("div",{staticClass:"q-item-side q-item-side-left q-item-section relative",class:_vm.sizeClass},[_c("el-carousel",{attrs:{trigger:"click",height:"180px",autoplay:!1,"indicator-position":"none"}},_vm._l(_vm.photos,(function(photo,index){return photo.url?_c("el-carousel-item",{key:index},[_c("img",{staticClass:"fc-avatar-square",class:_vm.sizeClass,attrs:{target:"_blank",src:photo.url},on:{click:function($event){return _vm.openPhotoUrl(photo.originalUrl)}}})]):_vm._e()})),1)],1),_vm.showName?_c("div",[_c("div",[_c("span",{staticClass:"q-item-label"},[_vm._v(_vm._s(_vm.storeRoom.name))])])]):_vm._e(),!_vm.showUpload||"undefined"!==typeof _vm.disableUpload&&!1!==_vm.disableUpload?_vm._e():_c("div",[_c("span",{staticClass:"upload-space-photos pointer",on:{click:_vm.showUploadPhotoDialog}},[_c("i",{staticClass:"fa fa-camera",attrs:{"aria-hidden":"true"}})]),_c("f-upload-photos",{ref:"uploadDialog",attrs:{list:_vm.photos,module:"storeroomphotos",record:_vm.storeRoom}})],1)])]):_vm._e()},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),FUploadPhotos=(__webpack_require__(434284),__webpack_require__(350367)),Storeroomvue_type_script_lang_js={props:["size","storeRoom","name","hovercard","disableUpload","disableSlide","isSummary"],data:function(){return{avatarUrl:null,sizeClass:"fc-avatar-"+this.size,hoverCardId:"spaceHoverCardId-"+this.storeRoom.id,showName:"undefined"===typeof this.name||"true"===this.name,showHoverCard:"undefined"===typeof this.hovercard||"true"===this.hovercard,loadHoverCardData:!1,photosLoading:!0,photos:[],sliderEnabledSize:["shuge","huge","xhuge","mxhuge"]}},components:{FUploadPhotos:FUploadPhotos/* default */.Z},mounted:function(){this.loadAvatarUrl()},computed:{showSlide:function(){if(this.photos.length){if(this.sliderEnabledSize.indexOf(this.size)>=0){var _step,allUrlNull=!0,_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.photos);try{for(_iterator.s();!(_step=_iterator.n()).done;){var photo=_step.value;if(photo.url){allUrlNull=!1;break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return!allUrlNull}return!1}return!1},showUpload:function(){return this.sliderEnabledSize.indexOf(this.size)>=0}},watch:{storeRoom:function(){this.loadAvatarUrl()}},methods:{loadAvatarUrl:function(){var self=this;this.storeRoom.id>0&&(self.photosLoading=!0,self.$http.get("/photos/get?module=storeroomphotos&parentId="+this.storeRoom.id).then((function(response){if(self.photos=response.data.photos?response.data.photos:[],self.photosLoading=!1,self.photos.length){var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(self.photos);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var photo=_step2.value;if(photo.url){self.avatarUrl=photo.url;break}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}))),this.storeRoom.avatarUrl?this.avatarUrl=this.storeRoom.avatarUrl:(this.avatarUrl=this.getDefaultAvatar(),this.storeRoom.avatarUrl=this.avatarUrl)},openPhotoUrl:function(url){window.open(url,"_blank")},getDefaultAvatar:function(){if(this.storeRoom)return __webpack_require__(494194)},loadHoverCard:function(){this.loadHoverCardData=!0},hideHoverCard:function(){this.loadHoverCardData=!1},showUploadPhotoDialog:function(){this.$refs.uploadDialog.open()}}},avatar_Storeroomvue_type_script_lang_js=Storeroomvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(avatar_Storeroomvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,Storeroom=component.exports},
/***/508427:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return InventoryStoreIssue}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/Inventory/Storerooms/InventoryStoreIssue.vue?vue&type=template&id=67241876
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.visibility?_c("div",[_c("el-dialog",{key:_vm.storeRoom.id,staticStyle:{"z-index":"999999"},attrs:{visible:_vm.visibility,fullscreen:!0,"before-close":_vm.closeDialog,"append-to-body":!0,"custom-class":"fc-dialog-form fc-dialog-right setup-dialog100 setup-dialog fc-web-form-dialog fc-item-type-summary-dialog"},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("div",{staticClass:"fc-pm-main-content-H"},[_vm._v(" "+_vm._s(_vm.$t("common.products.issue_inventory"))+" "),_c("div",{staticClass:"fc-heading-border-width43 mT15"})]),_c("div",{staticClass:"new-body-modal pL20 pR20"},[_c("el-row",{staticClass:"mB20",attrs:{gutter:20}},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.products.issue_type"))+" ")]),_c("el-radio-group",{attrs:{disabled:Boolean(_vm.inventoryIssueData.inventoryRequest&&_vm.inventoryIssueData.inventoryRequest.id)},on:{change:_vm.issueTypeChangeActions},model:{value:_vm.issueType,callback:function($$v){_vm.issueType=$$v},expression:"issueType"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.$t("common.products.user")}},[_vm._v(_vm._s(_vm.$t("common.products.user")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.$t("common._common.space/asset")}},[_vm._v(_vm._s(_vm.$t("common._common.space/asset")))])],1)],1)],1),_c("el-row",{staticClass:"mB20",attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.products.issued_to"))+" ")]),_vm.issueType===_vm.$t("common._common.space/asset")?_c("div",[_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{type:"text",placeholder:_vm.$t("common._common.to_search_type")},on:{change:function($event){_vm.quickSearchQuery=_vm.spaceAssetDisplayName,this.spaceAssetVisibility=!0}},model:{value:_vm.spaceAssetDisplayName,callback:function($$v){_vm.spaceAssetDisplayName=$$v},expression:"spaceAssetDisplayName"}},[_c("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{"line-height":"0px !important","font-size":"16px !important",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function($event){_vm.spaceAssetVisibility=!0}},slot:"suffix"})]),_c("space-asset-chooser",{attrs:{visibility:_vm.spaceAssetVisibility,query:_vm.quickSearchQuery,appendToBody:!1},on:{associate:_vm.associate,"update:visibility":function($event){_vm.spaceAssetVisibility=$event}}})],1):_vm.issueType===_vm.$t("common.products.user")?_c("el-select",{staticClass:"fc-input-full-border-select2 mT5",attrs:{disabled:Boolean(_vm.inventoryIssueData.inventoryRequest&&_vm.inventoryIssueData.inventoryRequest.id),filterable:""},model:{value:_vm.inventoryIssueData.resource.id,callback:function($$v){_vm.$set(_vm.inventoryIssueData.resource,"id",$$v)},expression:"inventoryIssueData.resource.id"}},_vm._l(_vm.users,(function(user){return _c("el-option",{key:user.id,attrs:{label:user.name,value:user.id}})})),1):_vm._e()],1)],1),_vm.inventoryIssueData.inventoryRequest.id?_c("div",{staticClass:"position-relative"},[_c("table",{staticClass:"setting-list-view-table store-table width100"},[_c("thead",{staticClass:"setup-dialog-thead"},[_c("tr",[_c("th",{staticClass:"setting-table-th setting-th-text",staticStyle:{width:"240px"}},[_vm._v(" "+_vm._s(_vm.$t("common._common.type"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text",staticStyle:{width:"240px"}},[_vm._v(" "+_vm._s(_vm.$t("common.products._name"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t('common._common."quantity"'))+" ")]),_c("th")])]),_c("tbody",_vm._l(_vm.inventoryIssueData.invReqLineItems,(function(lineItem,index){return _c("tr",{key:index,staticClass:"visibility-visible-actions"},[_c("td",{staticClass:"module-builder-td"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100px",attrs:{disabled:""},on:{change:function($event){return _vm.loadTypes(lineItem.inventoryType)}},model:{value:lineItem.inventoryType,callback:function($$v){_vm.$set(lineItem,"inventoryType",$$v)},expression:"lineItem.inventoryType"}},[_c("el-option",{key:"1",attrs:{label:_vm.$t("common.header.item"),value:1}}),_c("el-option",{key:"2",attrs:{label:_vm.$t("common.header.tool"),value:2}})],1)],1),_c("td",{staticClass:"module-builder-td"},[1===parseInt(lineItem.inventoryType)?_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2 width150px",attrs:{disabled:"",filterable:"",clearable:""},model:{value:lineItem.itemType.id,callback:function($$v){_vm.$set(lineItem.itemType,"id",$$v)},expression:"lineItem.itemType.id"}},_vm._l(_vm.itemTypes,(function(itemType,index){return _c("el-option",{key:index,attrs:{label:itemType.name,value:itemType.id}})})),1)],1):_vm._e(),2===parseInt(lineItem.inventoryType)?_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2 width150px",attrs:{disabled:"",filterable:"",clearable:""},model:{value:lineItem.toolType.id,callback:function($$v){_vm.$set(lineItem.toolType,"id",$$v)},expression:"lineItem.toolType.id"}},_vm._l(_vm.toolTypes,(function(toolType,index){return _c("el-option",{key:index,attrs:{label:toolType.name,value:toolType.id}})})),1)],1):_vm._e()]),_c("td",{staticClass:"module-builder-td"},[_c("el-input",{staticClass:"fc-input-full-border-select2 width100px duration-input",attrs:{disabled:"",placeholder:_vm.$t("common._common.quantity"),min:0,type:"number"},model:{value:lineItem.quantity,callback:function($$v){_vm.$set(lineItem,"quantity",$$v)},expression:"lineItem.quantity"}})],1),_c("td")])})),0)])]):_c("div",{staticClass:"position-relative"},[_c("table",{staticClass:"setting-list-view-table store-table width100"},[_c("thead",{staticClass:"setup-dialog-thead"},[_c("tr",[_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("common._common.type"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text",staticStyle:{width:"240px"}},[_vm._v(" "+_vm._s(_vm.$t("common.products.name"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("common._common.quantity"))+" ")]),_c("th")])]),_c("tbody",_vm._l(_vm.inventoryIssueData.storeIssueLineItems,(function(lineItem,index){return _c("tr",{key:index,staticClass:"visibility-visible-actions"},[_c("td",{staticClass:"module-builder-td"},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100px",on:{change:function($event){return _vm.loadTypes(lineItem.inventoryType)}},model:{value:lineItem.inventoryType,callback:function($$v){_vm.$set(lineItem,"inventoryType",$$v)},expression:"lineItem.inventoryType"}},[_c("el-option",{key:"1",attrs:{label:_vm.$t("common.header.item"),value:1}}),_vm.issueType!==_vm.$t("common._common.space/asset")?_c("el-option",{key:"2",attrs:{label:_vm.$t("common.header.tool"),value:2}}):_vm._e()],1)],1),_c("td",{staticClass:"module-builder-td"},[1===parseInt(lineItem.inventoryType)?_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",clearable:""},on:{change:function($event){lineItem.quantity=null,lineItem.assetIds=[]}},model:{value:lineItem.item.id,callback:function($$v){_vm.$set(lineItem.item,"id",$$v)},expression:"lineItem.item.id"}},_vm._l(_vm.lineItemList,(function(item,index){return _c("el-option",{key:index,attrs:{label:item.itemType.name,value:item.id}})})),1)],1):_vm._e(),2===parseInt(lineItem.inventoryType)?_c("div",[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",clearable:""},on:{change:function($event){lineItem.quantity=null,lineItem.assetIds=[]}},model:{value:lineItem.tool.id,callback:function($$v){_vm.$set(lineItem.tool,"id",$$v)},expression:"lineItem.tool.id"}},_vm._l(_vm.toolList,(function(tool,index){return _c("el-option",{key:index,attrs:{label:tool.toolType.name,value:tool.id}})})),1)],1):_vm._e()]),_c("td",[_c("el-tooltip",{attrs:{effect:"dark","open-delay":500,disabled:!_vm.inventoryToolTipQuantityFormatter(lineItem),content:"Available Quantity: "+_vm.inventoryToolTipQuantityFormatter(lineItem),placement:"top"}},[_c("el-input",{staticClass:"fc-input-full-border-select2 width100px duration-input",attrs:{placeholder:_vm.$t("common._common.quantity"),min:0,type:"number",readonly:_vm.checkForIsRotatingCase(lineItem)},model:{value:lineItem.quantity,callback:function($$v){_vm.$set(lineItem,"quantity",$$v)},expression:"lineItem.quantity"}},[_vm.checkForIsRotatingCase(lineItem)?_c("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{"line-height":"0px !important","font-size":"16px !important",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function($event){lineItem.visibility=!0}},slot:"suffix"}):_vm._e()])],1),_vm.checkForIsRotatingCase(lineItem)&&lineItem.visibility?_c("rotating-asset-chooser",{attrs:{visibility:lineItem.visibility,item:1===lineItem.inventoryType?lineItem.item.id:null,tool:2===lineItem.inventoryType?lineItem.tool.id:null,assetIds:lineItem.assetIds},on:{"update:visibility":function($event){return _vm.$set(lineItem,"visibility",$event)},save:function(data){return _vm.storeAssetData(lineItem,data)}}}):_vm._e()],1),_c("td",[_c("div",{staticClass:"visibility-hide-actions export-dropdown-menu"},[_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{title:_vm.$t("common._common.add")},on:{click:function($event){return _vm.addItemEntry(_vm.inventoryIssueData.storeIssueLineItems)}}},[_c("img",{staticClass:"mR10 mT10",attrs:{src:__webpack_require__(353654)}})]),_vm.inventoryIssueData.storeIssueLineItems.length>1?_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{title:_vm.$t("common._common.remove")},on:{click:function($event){return _vm.removeItemEntry(_vm.inventoryIssueData.storeIssueLineItems,index)}}},[_c("img",{staticClass:"mT10",attrs:{src:__webpack_require__(385769)}})]):_vm._e()])])])})),0)])])],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.cancelForm()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.issueLoading},on:{click:function($event){return _vm.issueLineItems()}}},[_vm._v(_vm._s(_vm.$t("common.products.issue")))])],1),_vm.rotatingItemChooserDialog?_c("div",[_c("el-dialog",{attrs:{visible:_vm.rotatingItemChooserDialog,"before-close":_vm.closeDialog,fullscreen:!1,title:_vm.$t("common.products.issue_inventory_request"),open:"top","custom-class":"fc-dialog-center-container","append-to-body":!0}},[_c("div",{staticClass:"height400"},[_c("el-steps",{attrs:{active:_vm.rotatingItemStepStatus,"finish-status":"success"}},_vm._l(_vm.rotatingLineItemsList,(function(item,i){return _c("el-step",{key:item.id,attrs:{title:1===item.inventoryType?item.itemType.name:item.toolType.name,description:(i===_vm.rotatingItemStepStatus?_vm.selectedRotatingItem.length:item.assetIds?item.assetIds.length:"0")+"/"+item.quantity}})})),1),_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.iTloading,expression:"iTloading"}],ref:"issueTable",staticClass:"width100 inventory-inner-table",attrs:{height:"200",data:_vm.rotatingItemList,"empty-text":_vm.$t("common.products.no_rotating_assets_available"),"default-sort":{prop:"costDate",order:"descending"}},on:{"selection-change":_vm.selectRotatingAsset}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{prop:"serialNumber",sortable:"",label:_vm.$t("common._common._serial_number")}}),_c("el-table-column",{attrs:{sortable:"",label:_vm.$t("common.header.price")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("currency",{attrs:{value:scope.row.unitPrice>0?scope.row.unitPrice:"---"}})]}}],null,!1,2712200387)}),_c("el-table-column",{attrs:{sortable:"",prop:"purchasedDate",formatter:_vm.getDateTimePurchasedDate,label:_vm.$t("common.products.purchased_time")}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save width100",attrs:{type:"primary"},on:{click:function($event){return _vm.nextStep()}}},[_vm._v(_vm._s(_vm.rotatingItemStepStatus===_vm.rotatingLineItemsList.length-1?"Issue":"Next"))])],1)],1)])],1):_vm._e()])],1):_vm._e()])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(425728),__webpack_require__(670560),__webpack_require__(162506),__webpack_require__(450886),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(420629)),RotatingAssetChooser=__webpack_require__(331778),SpaceAssetChooser=__webpack_require__(372587),api=__webpack_require__(32284),transactionTypeEnum={MANUAL:3},transactionStateEnum={ISSUE:2},InventoryStoreIssuevue_type_script_lang_js={data:function(){return{inventoryRequestList:null,issueLoading:!1,inventoryIssueData:{inventoryRequest:{id:null},requestedBy:{id:null},resource:{id:null,resourceType:null},invReqLineItems:[{inventoryType:1,itemType:{id:null},toolType:{id:null},quantity:null}],storeIssueLineItems:[{inventoryType:1,item:{id:null},tool:{id:null},quantity:null,visibility:!1,assetIds:[]}],parentId:null},itemTypes:[],toolTypes:[],rotatingItemChooserDialog:!1,rotatingLineItemsList:[],rotatingItemStepStatus:0,iTloading:!1,rotatingItemList:[],selectedRotatingItem:[],issueType:"User",spaceAssetDisplayName:null,spaceAssetVisibility:!1,quickSearchQuery:""}},props:["storeRoom","visibility","itemList","toolList"],components:{RotatingAssetChooser:RotatingAssetChooser/* default */.Z,SpaceAssetChooser:SpaceAssetChooser/* default */.Z},mounted:function(){this.loadInventoryRequestList(),this.loadTypes(1),this.loadTypes(2)},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),{},{lineItemList:function(){var _this=this,itemList=this.itemList;return itemList.filter((function(item){return(_this.issueType!==_this.$t("common._common.space/asset")||!item.itemType.isRotating)&&!!item.itemType.consumable}))}}),methods:{loadInventoryRequestList:function(){var self=this,param={status:2,storeRoomId:this.storeRoom.id};this.$http.post("/v2/inventoryrequest/list",param).then((function(response){0===response.data.responseCode&&(self.inventoryRequestList=response.data.result.inventoryrequests)})).catch((function(){}))},issueLineItems:function(){this.inventoryIssueData.inventoryRequest.id?this.issueInventoryRequestActions(this.storeRoom):this.manualIssueActions()},selectedItemFill:function(val){val&&(this.inventoryRequestList=this.inventoryRequestList.find((function(i){return val===i.id})))},cancelForm:function(){this.$emit("update:visibility",!1)},addIRItemEntry:function(field){var emptyData={inventoryType:1,itemType:{id:null},toolType:{id:null},quantity:null};field.push(emptyData)},removeIRItemEntry:function(list,index){list.splice(index,1)},addItemEntry:function(field){var emptyData={inventoryType:1,item:{id:null},tool:{id:null},quantity:null,visibility:!1,assetIds:[]};field.push(emptyData)},removeItemEntry:function(list,index){list.splice(index,1)},inventoryRequestChangeActions:function(val){if(val){var inventoryRequest=this.inventoryRequestList.find((function(inv){return inv.id===val}));inventoryRequest&&(inventoryRequest.requestedFor&&inventoryRequest.requestedFor.id&&(this.inventoryIssueData.resource.id=inventoryRequest.requestedFor.id,this.issueType=this.$t("common.products.user")),inventoryRequest.lineItems&&(this.inventoryIssueData.invReqLineItems=inventoryRequest.lineItems),inventoryRequest.parentId&&inventoryRequest.parentId>0&&(this.inventoryIssueData.parentId=inventoryRequest.parentId))}},loadTypes:function(type){if(1===type){if(0===this.itemTypes.length){var self=this,url="v2/itemTypes/view/all";this.$http.get(url).then((function(response){self.itemTypes=response.data.result&&response.data.result.itemTypes?response.data.result.itemTypes:[]})).catch((function(){}))}}else if(2===type&&0===this.toolTypes.length){var _self=this,_url="v2/toolTypes/view/all";this.$http.get(_url).then((function(response){_self.toolTypes=response.data.result&&response.data.result.toolTypes?response.data.result.toolTypes:[]})).catch((function(){}))}},inventoryToolTipQuantityFormatter:function(val){if(1===val.inventoryType&&val.item.id){var itemId=parseInt(val.item.id),item=this.itemList.find((function(i){return i.id===itemId}));return item.quantity}if(2===val.inventoryType&&val.tool.id){var toolId=parseInt(val.tool.id),tool=this.toolList.find((function(i){return i.id===toolId}));return tool.currentQuantity}return!1},issueInventoryRequest:function(){var _this2=this,param={inventoryRequest:{id:this.inventoryIssueData.inventoryRequest.id,lineItems:this.inventoryIssueData.invReqLineItems,storeRoom:this.storeRoom,requestedBy:{id:this.inventoryIssueData.requestedBy.id},requestedFor:{id:this.inventoryIssueData.resource.id},status:6}};this.inventoryIssueData.parentId>0&&(param.inventoryRequest["parentId"]=this.inventoryIssueData.parentId);var self=this;this.$http.post("/v2/inventoryrequest/issueInventoryRequests",param).then((function(response){0===response.data.responseCode?(self.$message.success(_this2.$t("common.products.items_issued_successfully")),self.$emit("refreshInventory"),self.closeDialog()):(self.$message.error(response.data.message),self.closeDialog())})).catch((function(){}))},issueInventoryRequestActions:function(storeId){if(storeId)for(var i in this.inventoryIssueData.invReqLineItems)if((1===this.inventoryIssueData.invReqLineItems[i].inventoryType&&this.inventoryIssueData.invReqLineItems[i].itemType.isRotating||2===this.inventoryIssueData.invReqLineItems[i].inventoryType&&this.inventoryIssueData.invReqLineItems[i].toolType.isRotating)&&this.rotatingLineItemsList.push(this.inventoryIssueData.invReqLineItems[i]),parseInt(i)===this.inventoryIssueData.invReqLineItems.length-1){if(this.rotatingLineItemsList.length>0)return this.rotatingItemChooserDialog=!0,void this.loadRotatingAsset();this.issueInventoryRequest()}},nextStep:function(){var count=this.rotatingLineItemsList[this.rotatingItemStepStatus].quantity;if(this.selectedRotatingItem.length===count){var assetIds=this.selectedRotatingItem.map((function(d){return d.id}));if(this.$refs.issueTable.clearSelection(),this.rotatingLineItemsList[this.rotatingItemStepStatus].assetIds=assetIds,this.inventoryIssueData.invReqLineItems[this.rotatingItemStepStatus].assetIds=assetIds,this.selectedRotatingItem=[],this.rotatingItemStepStatus++===this.rotatingLineItemsList.length-1)return this.issueInventoryRequest(),void(this.rotatingItemStepStatus=0);this.loadRotatingAsset()}else this.$message.error("Approved Count "+count+" Selected Count "+this.selectedRotatingItem.length)},selectRotatingAsset:function(val){this.selectedRotatingItem=val},getDateTimePurchasedDate:function(val){var value=val.purchasedDate;return value&&-1!==value?this.$options.filters.formatDate(value,!0):""},loadRotatingAsset:function(){var queryObj,self=this;self.iTloading=!0,queryObj=1===this.rotatingLineItemsList[this.rotatingItemStepStatus].inventoryType?{inventoryType:this.rotatingLineItemsList[this.rotatingItemStepStatus].inventoryType,itemTypeId:this.rotatingLineItemsList[this.rotatingItemStepStatus].itemType.id,storeRoomId:this.storeRoom.id}:{inventoryType:this.rotatingLineItemsList[this.rotatingItemStepStatus].inventoryType,toolTypeId:this.rotatingLineItemsList[this.rotatingItemStepStatus].toolType.id,storeRoomId:this.storeRoom.id},this.$http.post("/v2/assets/typeAndStore",queryObj).then((function(response){var individualItemList=[];0===response.data.responseCode?(individualItemList=response.data.result.assets,self.rotatingItemList=individualItemList):(self.$message.error(response.data.message),self.closeDialog()),self.iTloading=!1})).catch((function(){}))},closeDialog:function(){this.rotatingItemChooserDialog=!1,this.rotatingItemStepStatus=0,this.rotatingLineItemsList=[],this.rotatingItemList=[],this.selectedRotatingItem=[],this.cancelForm()},checkForIsRotatingCase:function(val){if(1===val.inventoryType&&val.item.id){var selectedItem=this.itemList.find((function(item){return item.id===val.item.id}));return selectedItem.itemType.isRotating}if(2===val.inventoryType&&val.tool.id){var selectedTool=this.toolList.find((function(tool){return tool.id===val.tool.id}));return selectedTool.toolType.isRotating}return!1},storeAssetData:function(lineItem,ids){lineItem.assetIds=ids,lineItem.quantity=ids.length},manualIssueActions:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var itemTransaction,toolTransaction,url,params,_yield$API$post,error,_params,_yield$API$post2,_error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this3.inventoryIssueData.resource.id){_context.next=4;break}_this3.$message.error(_this3.$t("common.header.please_choose_resource_user")),_context.next=23;break;case 4:if(!_this3.inventoryIssueData.resource.id){_context.next=23;break}if(itemTransaction=[],toolTransaction=[],_this3.inventoryIssueData.storeIssueLineItems.forEach((function(i){if(1===i.inventoryType){var tempItem={item:{id:i.item.id},parentId:_this3.inventoryIssueData.resource.id,issuedTo:{ouid:null},transactionType:transactionTypeEnum.MANUAL,transactionState:transactionStateEnum.ISSUE,quantity:i.quantity,assetIds:0===i.assetIds.length?null:i.assetIds,resource:{resourceType:null}};_this3.issueType===_this3.$t("common.products.user")?(tempItem.issuedTo.ouid=_this3.inventoryIssueData.resource.id,tempItem.resource.resourceType=4):(tempItem.resource.resourceType=_this3.inventoryIssueData.resource.resourceType,delete tempItem.issuedTo),itemTransaction.push(tempItem)}else if(2===i.inventoryType){var tempTool={tool:{id:i.tool.id},parentId:_this3.inventoryIssueData.resource.id,issuedTo:{ouid:null},transactionType:transactionTypeEnum.MANUAL,transactionState:transactionStateEnum.ISSUE,quantity:i.quantity,assetIds:0===i.assetIds.length?null:i.assetIds,resource:{resourceType:null}};_this3.issueType===_this3.$t("common.products.user")?(tempTool.issuedTo.ouid=_this3.inventoryIssueData.resource.id,tempTool.resource.resourceType=4):(tempTool.resource.resourceType=_this3.inventoryIssueData.resource.resourceType,delete tempTool.issuedTo),toolTransaction.push(tempTool)}})),url="v3/modules/data/bulkCreate",!(itemTransaction.length>0)){_context.next=16;break}return params={data:{itemTransactions:itemTransaction},moduleName:"itemTransactions",params:{issue:!0}},_context.next=13,api/* API */.bl.post(url,params);case 13:_yield$API$post=_context.sent,error=_yield$API$post.error,error?_this3.$message.error(error.message||_this3.$t("common.wo_report.unable_to_update")):(_this3.$message.success(_this3.$t("common.header.item_issued_successfully")),_this3.$emit("refreshInventory"),_this3.closeDialog());case 16:if(!(toolTransaction.length>0)){_context.next=23;break}return _params={data:{toolTransactions:toolTransaction},moduleName:"toolTransactions",params:{issue:!0}},_context.next=20,api/* API */.bl.post(url,_params);case 20:_yield$API$post2=_context.sent,_error=_yield$API$post2.error,_error?_this3.$message.error(_error.message||_this3.$t("common.wo_report.unable_to_update")):(_this3.$message.success(_this3.$t("common.header.tool_issued_successfully")),_this3.$emit("refreshInventory"),_this3.closeDialog());case 23:case"end":return _context.stop()}}),_callee)})))()},associate:function(selectedObj){this.inventoryIssueData.resource.id=selectedObj.id,this.inventoryIssueData.resource.resourceType=selectedObj.resourceType,this.spaceAssetDisplayName=selectedObj.name,this.spaceAssetVisibility=!1},issueTypeChangeActions:function(){this.inventoryIssueData.resource.id=null,this.spaceAssetDisplayName="";var lineItemObject=[{inventoryType:1,item:{id:null},tool:{id:null},quantity:null,visibility:!1,assetIds:[]}];this.$set(this.inventoryIssueData,"storeIssueLineItems",lineItemObject)}}},Storerooms_InventoryStoreIssuevue_type_script_lang_js=InventoryStoreIssuevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(Storerooms_InventoryStoreIssuevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,InventoryStoreIssue=component.exports},
/***/620814:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return ItemStoreIssueReturn}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/Inventory/Storerooms/ItemStoreIssueReturn.vue?vue&type=template&id=6bd0f067
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",["issue"===_vm.type?_c("div",[_c("div",[_c("el-dialog",{key:_vm.storeRoom.id,attrs:{visible:_vm.showItemIssueReturn,title:"ISSUE ITEM","before-close":_vm.cancelForm,"custom-class":"fc-dialog-center-container"},on:{"update:visible":function($event){_vm.showItemIssueReturn=$event}}},[_vm.loading?_c("div",[_c("spinner",{attrs:{show:_vm.loading}})],1):_vm._e(),_c("div",[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Item ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 mT5",attrs:{filterable:""},on:{change:function($event){return _vm.selectedItemFill(_vm.selectedItem)}},model:{value:_vm.selectedItem,callback:function($$v){_vm.selectedItem=$$v},expression:"selectedItem"}},[_vm._l(_vm.itemList,(function(item){return[item.itemType.approvalNeeded||item.storeRoom.approvalNeeded||!item.itemType.consumable?_vm._e():_c("el-option",{key:item.id,attrs:{label:item.itemType.name,value:item.id}})]}))],2)],1),_vm.loading?_vm._e():_c("div",{staticClass:"height400 mT20"},[_vm.item&&_vm.item.itemType.isRotating&&_vm.item.id?_c("div",[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.purLoading,expression:"purLoading"}],staticClass:"width100 inventory-inner-table",attrs:{height:"200",data:_vm.purchasedUnUsedItemList,"empty-text":"No Rotating assets available.","default-sort":{prop:"costDate",order:"descending"}},on:{"selection-change":_vm.toggleUnUsedItemSelection}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{prop:"serialNumber",sortable:"",label:"SERIAL NUMBER"}}),_c("el-table-column",{attrs:{sortable:"",label:"PRICE"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("currency",{attrs:{value:scope.row.unitPrice>0?scope.row.unitPrice:"---"}})]}}],null,!1,2712200387)}),_c("el-table-column",{attrs:{sortable:"",prop:"purchasedDate",formatter:_vm.getDateTimePurchasedDate,label:"PURCHASED TIME"}})],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Issue To ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{filterable:"",placeholder:"Select User"},model:{value:_vm.userid,callback:function($$v){_vm.userid=$$v},expression:"userid"}},_vm._l(_vm.users,(function(user){return _c("el-option",{key:user.id,attrs:{label:user.name,value:parseInt(user.id)}})})),1)],1)],1)],1):_vm.item&&!_vm.item.itemType.isRotating&&_vm.item.id?_c("div",[_c("div",[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-id"},[_vm._v("#"+_vm._s(_vm.item.itemType.id))]),_c("div",{staticClass:"fc-black3-16 text-left"},[_vm._v(" "+_vm._s(_vm.item.itemType.name)+" ")])]),_c("el-col",{attrs:{span:12}},[_c("store-room-avatar",{attrs:{name:"true",size:"lg",storeRoom:_vm.storeRoom}})],1)],1)],1),_c("el-row",{staticClass:"mT40",attrs:{gutter:10}},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Issue Quantity ")]),_c("el-input",{staticClass:"fc-input-full-border2 mT5",attrs:{placeholder:"Issue Quantity",min:1,max:_vm.item.quantity,type:"number"},model:{value:_vm.quantity,callback:function($$v){_vm.quantity=$$v},expression:"quantity"}},[_c("span",{staticClass:"width100 item-input-txt",attrs:{slot:"suffix"},slot:"suffix"},[_vm._v("Item")])]),_c("div",{staticClass:"green-txt2-13 mT10 fw4"},[_vm._v(" "+_vm._s(_vm.item.quantity)+" Current Balance ")])],1),_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Issue To ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 mT5",attrs:{filterable:"",clearable:"",placeholder:"Select User"},model:{value:_vm.userid,callback:function($$v){_vm.userid=$$v},expression:"userid"}},_vm._l(_vm.users,(function(user){return _c("el-option",{key:user.id,attrs:{label:user.name,value:parseInt(user.id)}})})),1)],1)],1)],1):_vm._e()]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.cancelForm()}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.saveIssueForm()}}},[_vm._v(_vm._s(_vm.saving?"Submitting...":"SAVE"))])],1)])],1)]):_vm._e(),"return"===_vm.type?_c("div",[_c("div",[_c("el-dialog",{key:_vm.storeRoom.id,attrs:{visible:_vm.showItemIssueReturn,title:"RETURN ITEM","before-close":_vm.cancelForm,width:"65%","custom-class":"fc-dialog-center-container"},on:{"update:visible":function($event){_vm.showItemIssueReturn=$event}}},[_c("div",[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Item ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 mT5",attrs:{filterable:""},on:{change:function($event){return _vm.selectedItemFill(_vm.selectedItem)}},model:{value:_vm.selectedItem,callback:function($$v){_vm.selectedItem=$$v},expression:"selectedItem"}},[_vm._l(_vm.itemList,(function(item){return[item.itemType.consumable?_c("el-option",{key:item.id,attrs:{label:item.itemType.name,value:item.id}}):_vm._e()]}))],2)],1),_c("div",{staticClass:"height400 mT20"},[_vm.issueLoading?_c("div",[_c("spinner",{attrs:{show:_vm.issueLoading}})],1):_vm._e(),!_vm.issueLoading&&_vm.item&&!_vm.item.itemType.isRotating&&_vm.item.id?_c("div",[_vm.selectedIssuedItems.length>0?_c("div",{staticClass:"rv-sum-table-click",on:{click:function($event){return _vm.markAsFullyReturned(_vm.issuedItems)}}},[_c("img",{staticClass:"mR10",attrs:{src:__webpack_require__(619257)}}),_vm._v(" Mark as Fully Returned ")]):_vm._e(),_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.issueLoading,expression:"issueLoading"}],ref:"returnTable",staticClass:"inventory-inner-table width100",attrs:{data:_vm.issuedItems,height:"300","empty-text":"This item is not issued to anyone.","default-sort":{prop:"item.storeRoom.name",order:"descending"}},on:{"selection-change":_vm.selectIssuedItemActions}},[_c("el-table-column",{attrs:{width:"60",type:"selection"}}),_c("el-table-column",{attrs:{prop:"item.storeRoom.name",sortable:"",width:"190",label:"STOREROOM NAME"}}),_c("el-table-column",{attrs:{prop:"remainingQuantity",sortable:"",width:"130",label:"QUANTITY"}}),_c("el-table-column",{attrs:{prop:"sysModifiedTime",formatter:_vm.getDateTimeIssuedTime,sortable:"",label:"ISSUED TIME"}}),_c("el-table-column",{attrs:{label:"ISSUED TO",width:"140"},scopedSlots:_vm._u([{key:"default",fn:function(item){return[2===item.row.transactionType?_c("div",[_vm._v(" WO-"),_c("router-link",{staticClass:"fc-id",attrs:{to:{path:"/app/wo/orders/summary/"+item.row.parentId}}},[_vm._v(" #"+_vm._s(item.row.parentId)+" ")])],1):_vm._e(),3===item.row.transactionType?_c("div",[4===item.row.resource.resourceType?_c("user-avatar",{attrs:{size:"md",user:_vm.$store.getters.getUser(item.row.parentId)}}):2===item.row.resource.resourceType?_c("span",[_vm._v("Asset-"),_c("router-link",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                          placement: 'top',\n                          arrow: true,\n                          animation: 'shift-away',\n                        }"}],staticClass:"fc-id",attrs:{title:item.row.resource?item.row.resource.name:"",to:{path:"/app/at/assets/all/"+item.row.parentId+"/overview/"}}},[_vm._v("#"+_vm._s(item.row.parentId))])],1):1===item.row.resource.resourceType?_c("span",[_vm._v("Space- "),_c("router-link",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                          placement: 'top',\n                          arrow: true,\n                          animation: 'shift-away',\n                        }"}],staticClass:"fc-id",attrs:{title:item.row.resource?item.row.resource.name:"",to:{path:_vm.getSpaceRouteLink(item.row.resource)}}},[_vm._v("#"+_vm._s(item.row.parentId))])],1):_vm._e()],1):_vm._e()]}}],null,!1,3281311784)}),_c("el-table-column",{attrs:{width:"180",label:"RETURN QUANTITY"},scopedSlots:_vm._u([{key:"default",fn:function(issuedItem){return[_c("div",[_c("el-input",{ref:"quantityElInput",staticClass:"fc-input-full-border-select2",attrs:{placeholder:"Quantity",min:1,max:issuedItem.row.remainingQuantity,type:"number"},model:{value:issuedItem.row.updateQuantity,callback:function($$v){_vm.$set(issuedItem.row,"updateQuantity",$$v)},expression:"issuedItem.row.updateQuantity"}})],1)]}}],null,!1,2691936242)})],1)],1):!_vm.issueLoading&&_vm.item&&_vm.item.itemType.isRotating&&_vm.item.id?_c("div",[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.issueLoading,expression:"issueLoading"}],staticClass:"width100 inventory-inner-table",attrs:{data:_vm.issuedItems,"empty-text":"This item is not issued to anyone.",height:"310","default-sort":{prop:"item.storeRoom.name",order:"descending"}},on:{"selection-change":_vm.toggleReturnItemSelection}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{prop:"item.storeRoom.name",sortable:"",label:"STOREROOM NAME",width:"190"}}),_c("el-table-column",{attrs:{prop:"asset.name",sortable:"",label:"NAME",width:"140"}}),_c("el-table-column",{attrs:{prop:"asset.serialNumber",sortable:"",label:"SERIAL NUMBER",width:"170"}}),_c("el-table-column",{attrs:{label:"ISSUED TO",width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(itemscope){return[2===itemscope.row.transactionType?_c("div",[_vm._v(" WO-"),_c("router-link",{staticClass:"fc-id",attrs:{to:{path:"/app/wo/orders/summary/"+itemscope.row.parentId}}},[_vm._v(" #"+_vm._s(itemscope.row.parentId)+" ")])],1):_vm._e(),3===itemscope.row.transactionType?_c("div",[_c("user-avatar",{attrs:{size:"md",user:_vm.$store.getters.getUser(itemscope.row.parentId)}})],1):_vm._e()]}}],null,!1,3991462055)}),_c("el-table-column",{attrs:{sortable:"",prop:"sysModifiedTime",formatter:_vm.getDateTimeIssuedTime,label:"ISSUED TIME"}})],1)],1):_vm._e()]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.cancelForm()}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.returnItem()}}},[_vm._v(_vm._s(_vm.saving?"Submitting...":"Return"))])],1)])],1)]):_vm._e()])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(450886),__webpack_require__(648324),__webpack_require__(670560),__webpack_require__(76265),__webpack_require__(947522),__webpack_require__(420629)),User=__webpack_require__(426803),Storeroom=__webpack_require__(664281),inventoryHelper=__webpack_require__(424477),InventoryUtil=__webpack_require__(976195),api=__webpack_require__(32284),transactionTypeEnum={STOCK:1,MANUAL:3},transactionStateEnum={ISSUE:2,RETURN:3},ItemStoreIssueReturnvue_type_script_lang_js={components:{UserAvatar:User/* default */.Z,StoreRoomAvatar:Storeroom/* default */.Z},props:["storeRoom","showItemIssueReturn","type"],mixins:[inventoryHelper/* default */.Z],data:function(){return{saving:!1,selectedItem:null,loading:!1,fetchingMore:!1,quantity:null,userid:null,workorderid:null,purchasedUnUsedItemList:null,selectedUnUsedItems:null,issueForm:null,transactionList:null,selectedIndTrackReturnItem:null,issuedItems:null,purLoading:!0,editQuantityVisibility:!1,selectedIssuedItems:[],item:null,itemList:[],issueLoading:!1}},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),mounted:function(){this.loadItemsforStoreroom()},methods:{loadItemsforStoreroom:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _this$item,$getProperty,filters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return $getProperty=_this.$getProperty,filters={storeRoom:{operatorId:36,value:[_this.storeRoom.id+""]}},_context.next=4,(0,InventoryUtil/* getFilteredItemList */.Oh)(filters);case 4:_this.itemList=_context.sent,_this.item=_this.itemList.find((function(item){return!$getProperty(item,"itemType.approvalNeeded")&&$getProperty(item,"itemType.consumable")})),_this.selectedItem=null===(_this$item=_this.item)||void 0===_this$item?void 0:_this$item.id,"issue"===_this.type?_this.loadPurchasedUnUsedItemsList():"return"===_this.type&&_this.loadIssuedItem();case 8:case"end":return _context.stop()}}),_callee)})))()},cancelForm:function(){this.$emit("update:showItemIssueReturn",!1)},savedForm:function(){this.cancelForm(),this.$emit("refresh")},itemIssue:function(itemTransactionData){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _yield$API$createReco,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api/* API */.bl.createRecord("itemTransactions",{data:itemTransactionData,params:{issue:!0}});case 2:_yield$API$createReco=_context2.sent,error=_yield$API$createReco.error,error?_this2.$message.error(error.message||_this2.$t("common.wo_report.unable_to_update")):(_this2.$message.success(_this2.$t("common.header.item_issued_successfully")),_this2.savedForm());case 5:case"end":return _context2.stop()}}),_callee2)})))()},saveIssueForm:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var itemTransactionData,_itemTransactionData,param,self,_param,_self;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(_this3.userid){_context3.next=4;break}_this3.$message.error(_this3.$t("common._common.choose_user_issue")),_context3.next=18;break;case 4:if(!_this3.userid||_this3.item.itemType.isRotating){_context3.next=11;break}return null!==_this3.quantity&&void 0!==_this3.quantity&&"0"!==_this3.quantity||_this3.$message.error(_this3.$t("common._common.enter_quantity")),itemTransactionData={item:{id:_this3.item.id},parentId:_this3.userid,issuedTo:{ouid:_this3.userid},transactionType:transactionTypeEnum.MANUAL,transactionState:transactionStateEnum.ISSUE,quantity:_this3.quantity},_context3.next=9,_this3.itemIssue(itemTransactionData);case 9:_context3.next=18;break;case 11:if(!(_this3.userid&&_this3.item.itemType.isRotating&&_this3.selectedUnUsedItems)){_context3.next=17;break}return _itemTransactionData={item:{id:_this3.item.id},parentId:_this3.userid,issuedTo:{ouid:_this3.userid},transactionType:transactionTypeEnum.MANUAL,transactionState:transactionStateEnum.ISSUE,assetIds:_this3.selectedUnUsedItems},_context3.next=15,_this3.itemIssue(_itemTransactionData);case 15:_context3.next=18;break;case 17:_this3.workorderid&&!_this3.item.itemType.isRotating&&_this3.quantity?(param={workorderItems:[{parentId:_this3.workorderid,item:{id:_this3.item.id},quantity:_this3.quantity}]},self=_this3,_this3.$http.post("/v2/workorderItems/addOrUpdate",param).then((function(response){self.loadWoItemParts(),0!==response.data.responseCode?(self.$message.success("Item Issued Successfully"),self.savedForm()):self.$message.error(response.data.message)})).catch((function(){_this3.$message.error("Unable to update")}))):_this3.workorderid&&_this3.item.itemType.isRotating&&(_param={workorderItems:[{parentId:_this3.workorderid,item:{id:_this3.item.id}}],purchasedItems:_this3.selectedUnUsedItems},_self=_this3,_this3.$http.post("/v2/workorderItems/addOrUpdate",_param).then((function(response){_self.loadWoItemParts(),0!==response.data.responseCode?(_self.$message.success("Item Issued Successfully"),_self.savedForm()):_self.$message.error(response.data.message)})).catch((function(){_this3.$message.error("Unable to update")})));case 18:case"end":return _context3.stop()}}),_callee3)})))()},loadPurchasedUnUsedItemsList:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var filters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(!_this4.item||!_this4.item.itemType.isRotating){_context4.next=7;break}return filters={rotatingItem:{operatorId:36,value:[_this4.item.id+""]},isUsed:{operatorId:15,value:[!1+""]}},_this4.purLoading=!0,_context4.next=5,_this4.$util.getFilteredAssetList(filters);case 5:_this4.purchasedUnUsedItemList=_context4.sent,_this4.purLoading=!1;case 7:case"end":return _context4.stop()}}),_callee4)})))()},toggleUnUsedItemSelection:function(selected){this.selectedUnUsedItems=selected.map((function(value){return value.id}))},toggleReturnItemSelection:function(selected){this.selectedIndTrackReturnItem=selected},getDateTimePurchasedDate:function(val){var value=val.purchasedDate;return value&&-1!==value?this.$options.filters.formatDate(value,!0):""},getDateTimeIssuedTime:function(val){var value=val.sysModifiedTime;return value&&-1!==value?this.$options.filters.formatDate(value,!0):""},loadIssuedItem:function(){if(this.item){var self=this,filters={item:{operatorId:36,value:[this.item.id+""]}};self.issueLoading=!0,this.$http.get("/v2/itemTransactions/view/showItemTransactionListForReturn?showItemsForReturn=true&filters="+encodeURIComponent(JSON.stringify(filters))).then((function(response){for(var i in self.issueLoading=!1,self.issuedItems=response.data.result.itemTransactions,self.issuedItems)self.$set(self.issuedItems[i],"updateQuantity",null)})).catch((function(error){error&&(self.issueLoading=!1,self.fetchingMore=!1)}))}},isValid:function(val){if(null!==val&&""!==val&&void 0!==val)return!0},returnItemCall:function(itemTransaction,rotating){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return url="v3/modules/data/bulkCreate",params={data:{itemTransactions:itemTransaction},moduleName:"itemTransactions",params:{return:!0}},_context5.next=4,api/* API */.bl.post(url,params);case 4:_yield$API$post=_context5.sent,error=_yield$API$post.error,error?_this5.$message.error(error.message||_this5.$t("common.wo_report.unable_to_update")):(_this5.$message.success(_this5.$t("common.header.item_returned_successfully")),_this5.loadIssuedItem(),rotating&&(_this5.selectedIndTrackReturnItem=null),_this5.savedForm(),_this5.$emit("refreshInventory"));case 7:case"end":return _context5.stop()}}),_callee5)})))()},returnItem:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var itemTransaction,i,iTemp,_itemTransaction,_i,temp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:if(_this6.item.itemType.isRotating){_context6.next=15;break}itemTransaction=[],_context6.t0=(0,regeneratorRuntime/* default */.Z)().keys(_this6.issuedItems);case 3:if((_context6.t1=_context6.t0()).done){_context6.next=11;break}if(i=_context6.t1.value,!(_this6.issuedItems[i].updateQuantity&&_this6.issuedItems[i].updateQuantity>_this6.issuedItems[i].remainingQuantity)){_context6.next=8;break}return _this6.$message.error(_this6.$t("common._common.return_quantity_greater_issued")),_context6.abrupt("return");case 8:_this6.isValid(_this6.issuedItems[i].updateQuantity)&&!isNaN(_this6.issuedItems[i].updateQuantity)&&(iTemp={item:{id:_this6.issuedItems[i].item.id},parentTransactionId:_this6.issuedItems[i].id,parentId:_this6.issuedItems[i].parentId,transactionType:_this6.issuedItems[i].transactionType,transactionState:transactionStateEnum.RETURN,requestedLineItem:_this6.issuedItems[i].requestedLineItem,quantity:parseInt(_this6.issuedItems[i].updateQuantity)},itemTransaction.push(iTemp)),_context6.next=3;break;case 11:return _context6.next=13,_this6.returnItemCall(itemTransaction,_this6.$getProperty(_this6.item,"itemType.isRotating",null));case 13:_context6.next=20;break;case 15:if(!_this6.item.itemType.isRotating){_context6.next=20;break}for(_i in _itemTransaction=[],_this6.selectedIndTrackReturnItem)temp={item:{id:_this6.selectedIndTrackReturnItem[_i].item.id},parentId:_this6.selectedIndTrackReturnItem[_i].parentId,parentTransactionId:_this6.selectedIndTrackReturnItem[_i].id,transactionType:_this6.selectedIndTrackReturnItem[_i].transactionType,transactionState:transactionStateEnum.RETURN,requestedLineItem:_this6.issuedItems[_i].requestedLineItem,assetIds:[_this6.selectedIndTrackReturnItem[_i].asset.id]},_itemTransaction.push(temp);return _context6.next=20,_this6.returnItemCall(_itemTransaction,_this6.$getProperty(_this6.item,"itemType.isRotating"));case 20:case"end":return _context6.stop()}}),_callee6)})))()},selectIssuedItemActions:function(val){this.selectedIssuedItems=val},markAsFullyReturned:function(val){var _this7=this;val.forEach((function(element){_this7.selectedIssuedItems.forEach((function(obj){element.id===obj.id&&(element.updateQuantity=element.remainingQuantity)}))})),this.$refs.returnTable.clearSelection()},selectedItemFill:function(val){val&&(this.item=this.itemList.find((function(it){return val===it.id})),"issue"===this.type?this.loadPurchasedUnUsedItemsList():"return"===this.type&&this.loadIssuedItem())}}},Storerooms_ItemStoreIssueReturnvue_type_script_lang_js=ItemStoreIssueReturnvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(Storerooms_ItemStoreIssueReturnvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ItemStoreIssueReturn=component.exports},
/***/396859:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return ToolStoreIssueReturn}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/Inventory/Storerooms/ToolStoreIssueReturn.vue?vue&type=template&id=59b9a372&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",["issue"===_vm.type?_c("div",[_c("div",[_c("el-dialog",{key:_vm.storeRoom.id,attrs:{visible:_vm.showToolIssueReturn,title:"ISSUE TOOL","before-close":_vm.cancelForm,"custom-class":"fc-dialog-center-container"},on:{"update:visible":function($event){_vm.showToolIssueReturn=$event}}},[_vm.loading?_c("div",{staticClass:"mT50"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm._e(),_c("div",[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Tool ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 mT5",attrs:{filterable:""},on:{change:function($event){return _vm.selectedToolFill(_vm.selectedTool)}},model:{value:_vm.selectedTool,callback:function($$v){_vm.selectedTool=$$v},expression:"selectedTool"}},[_vm._l(_vm.toolList,(function(tool){return[tool.toolType.approvalNeeded||tool.storeRoom.approvalNeeded?_vm._e():_c("el-option",{key:tool.id,attrs:{label:tool.toolType.name,value:tool.id}})]}))],2)],1),_c("div",{staticClass:"height400 mT20"},[_vm.tool&&_vm.tool.toolType.isRotating&&_vm.tool?_c("div",[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.purLoading,expression:"purLoading"}],staticClass:"width100 inventory-inner-table",attrs:{height:"200",data:_vm.purchasedUnUsedToolList,"empty-text":"No Rotating assets available.","default-sort":{prop:"costDate",order:"descending"}},on:{"selection-change":_vm.toggleUnUsedToolSelection}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{prop:"serialNumber",sortable:"",label:"SERIAL NUMBER"}}),_c("el-table-column",{attrs:{sortable:"",label:"RATE/HR"}},[[_c("currency",{attrs:{value:_vm.tool.rate}})]],2),_c("el-table-column",{attrs:{sortable:"",prop:"purchasedDate",formatter:_vm.getDateTime,label:"PURCHASED TIME"}})],1),_c("el-row",{staticClass:"mT20"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Issue To ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 mT5",attrs:{filterable:"",clearable:"",placeholder:"Select User"},model:{value:_vm.userid,callback:function($$v){_vm.userid=$$v},expression:"userid"}},_vm._l(_vm.users,(function(user){return _c("el-option",{key:user.id,attrs:{label:user.name,value:parseInt(user.id)}})})),1)],1)],1)],1):_vm._e(),_vm.tool&&!_vm.tool.toolType.isRotating&&_vm.tool?_c("div",[_c("div",[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-id"},[_vm._v("#"+_vm._s(_vm.tool.toolType.id))]),_c("div",{staticClass:"fc-black3-16 text-left"},[_vm._v(" "+_vm._s(_vm.tool.toolType.name)+" ")])]),_c("el-col",{attrs:{span:12}},[_c("store-room-avatar",{attrs:{name:"true",size:"lg",storeRoom:_vm.tool.storeRoom}})],1)],1)],1),_c("el-row",{staticClass:"mT40",attrs:{gutter:10}},[_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Issue Quantity ")]),_c("el-input",{staticClass:"fc-input-full-border2 mT5",attrs:{placeholder:"Issue Quantity",min:1,max:_vm.tool.currentQuantity,type:"number"},model:{value:_vm.quantity,callback:function($$v){_vm.quantity=$$v},expression:"quantity"}},[_c("span",{staticClass:"width100 item-input-txt",attrs:{slot:"suffix"},slot:"suffix"},[_vm._v("Tool")])]),_c("div",{staticClass:"green-txt2-13 mT10 fw4"},[_vm._v(" "+_vm._s(_vm.tool.currentQuantity)+" Current Balance ")])],1),_c("el-col",{attrs:{span:12}},[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Issue To ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 mT5",attrs:{filterable:"",clearable:"",placeholder:"Select User"},model:{value:_vm.userid,callback:function($$v){_vm.userid=$$v},expression:"userid"}},_vm._l(_vm.users,(function(user){return _c("el-option",{key:user.id,attrs:{label:user.name,value:parseInt(user.id)}})})),1)],1)],1)],1):_vm._e()]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.cancelForm()}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.saveIssueForm()}}},[_vm._v(_vm._s(_vm.saving?"Submitting...":"SAVE"))])],1)])],1)]):_vm._e(),"return"===_vm.type?_c("div",[_c("el-dialog",{key:_vm.storeRoom.id,attrs:{visible:_vm.showToolIssueReturn,title:"RETURN TOOL","before-close":_vm.cancelForm,width:"65%","custom-class":"fc-dialog-center-container"},on:{"update:visible":function($event){_vm.showToolIssueReturn=$event}}},[_vm.showLoading?_c("spinner",{staticClass:"height400",attrs:{show:_vm.showLoading,size:"80"}}):_vm.$validation.isEmpty(_vm.toolList)?_c("div",{staticClass:"tools-return-empty-state height400"},[_c("inline-svg",{attrs:{src:"svgs/list-empty",iconClass:"icon icon-130"}}),_c("div",{staticClass:"tools-return-empty-state-text"},[_vm._v(" "+_vm._s(_vm.$t("common.products.no_tools_available_in_this_storeroom"))+" ")])],1):_c("div",[_c("div",[_c("div",{staticClass:"fc-black3-16 text-left fw4"},[_vm._v(" Tool ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 mT5",attrs:{filterable:""},on:{change:function($event){return _vm.selectedToolFill(_vm.selectedTool)}},model:{value:_vm.selectedTool,callback:function($$v){_vm.selectedTool=$$v},expression:"selectedTool"}},_vm._l(_vm.toolList,(function(tool){return _c("el-option",{key:tool.id,attrs:{label:tool.toolType.name,value:tool.id}})})),1)],1),_c("div",{staticClass:"height400 mT20"},[_vm.issueLoading?_c("div",[_c("spinner",{attrs:{show:_vm.issueLoading}})],1):_vm._e(),_vm.issueLoading||!_vm.tool||_vm.tool.toolType.isRotating?_vm._e():_c("div",[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.issueLoading,expression:"issueLoading"}],staticClass:"inventory-inner-table width100",attrs:{data:_vm.issuedTools,"empty-text":"This tool is not issued to anyone.",height:"300","default-sort":{prop:"tool.storeRoom.name",order:"descending"}}},[_c("el-table-column",{attrs:{prop:"tool.storeRoom.name",sortable:"",width:"190",label:"STOREROOM NAME"}}),_c("el-table-column",{attrs:{prop:"remainingQuantity",sortable:"",label:"QUANTITY"}}),_c("el-table-column",{attrs:{prop:"sysModifiedTime",formatter:_vm.getDateTimeIssuedTime,width:"160",sortable:"",label:"ISSUED TIME"}}),_c("el-table-column",{attrs:{label:"ISSUED TO"},scopedSlots:_vm._u([{key:"default",fn:function(tool){return[2===tool.row.transactionType?_c("div",[_vm._v(" WO-"),_c("router-link",{staticClass:"fc-id",attrs:{to:{path:"/app/wo/orders/summary/"+tool.row.parentId}}},[_vm._v(" #"+_vm._s(tool.row.parentId)+" ")])],1):_vm._e(),3===tool.row.transactionType?_c("div",[4===tool.row.resource.resourceType?_c("user-avatar",{attrs:{size:"md",user:_vm.$store.getters.getUser(tool.row.parentId)}}):2===tool.row.resource.resourceType?_c("span",[_vm._v("Asset-"),_c("router-link",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                          placement: 'top',\n                          arrow: true,\n                          animation: 'shift-away',\n                        }"}],staticClass:"fc-id",attrs:{title:tool.row.resource?tool.row.resource.name:"",to:{path:"/app/at/assets/all/"+tool.row.parentId+"/overview/"}}},[_vm._v("#"+_vm._s(tool.row.parentId))])],1):1===tool.row.resource.resourceType?_c("span",[_vm._v("Space- "),_c("router-link",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                          placement: 'top',\n                          arrow: true,\n                          animation: 'shift-away',\n                        }"}],staticClass:"fc-id",attrs:{title:tool.row.resource?tool.row.resource.name:"",to:{path:_vm.getSpaceRouteLink(tool.row.resource)}}},[_vm._v("#"+_vm._s(tool.row.parentId))])],1):_vm._e()],1):_vm._e()]}}],null,!1,2072943877)}),_c("el-table-column",{attrs:{width:"180",label:"RETURN QUANTITY"},scopedSlots:_vm._u([{key:"default",fn:function(issuedTool){return[_c("div",[_c("el-input",{ref:"quantityElInput",staticClass:"fc-input-full-border-select2",attrs:{placeholder:"Quantity",min:1,max:issuedTool.row.remainingQuantity,type:"number"},model:{value:issuedTool.row.updateQuantity,callback:function($$v){_vm.$set(issuedTool.row,"updateQuantity",$$v)},expression:"issuedTool.row.updateQuantity"}})],1)]}}],null,!1,2624838559)})],1)],1),!_vm.issueLoading&&_vm.tool&&_vm.tool.toolType.isRotating?_c("div",[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.issueLoading,expression:"issueLoading"}],staticClass:"inventory-inner-table width100",attrs:{data:_vm.issuedTools,"empty-text":"This tool is not issued to anyone.",height:"300","default-sort":{prop:"storeRoom.name",order:"descending"}},on:{"selection-change":_vm.toggleReturnToolSelection}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{prop:"tool.storeRoom.name",sortable:"",label:"STOREROOM NAME",width:"190"}}),_c("el-table-column",{attrs:{prop:"asset.name",sortable:"",label:"NAME",width:"140"}}),_c("el-table-column",{attrs:{prop:"asset.serialNumber",sortable:"",label:"SERIAL NUMBER",width:"170"}}),_c("el-table-column",{attrs:{label:"ISSUED TO",width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(tool){return[2===tool.row.transactionType?_c("div",[_vm._v(" WO-"),_c("router-link",{staticClass:"fc-id",attrs:{to:{path:"/app/wo/orders/summary/"+tool.row.parentId}}},[_vm._v(" #"+_vm._s(tool.row.parentId)+" ")])],1):_vm._e(),3===tool.row.transactionType?_c("div",[4===tool.row.resource.resourceType?_c("user-avatar",{attrs:{size:"md",user:_vm.$store.getters.getUser(tool.row.parentId)}}):2===tool.row.resource.resourceType?_c("span",[_vm._v("Asset-"),_c("router-link",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                          placement: 'top',\n                          arrow: true,\n                          animation: 'shift-away',\n                        }"}],staticClass:"fc-id",attrs:{title:tool.row.resource?tool.row.resource.name:"",to:{path:"/app/at/assets/all/"+tool.row.parentId+"/overview/"}}},[_vm._v("#"+_vm._s(tool.row.parentId))])],1):1===tool.row.resource.resourceType?_c("span",[_vm._v("Space- "),_c("router-link",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                          placement: 'top',\n                          arrow: true,\n                          animation: 'shift-away',\n                        }"}],staticClass:"fc-id",attrs:{title:tool.row.resource?tool.row.resource.name:"",to:{path:_vm.getSpaceRouteLink(tool.row.resource)}}},[_vm._v("#"+_vm._s(tool.row.parentId))])],1):_vm._e()],1):_vm._e()]}}],null,!1,2072943877)}),_c("el-table-column",{attrs:{prop:"sysModifiedTime",formatter:_vm.getDateTimeIssuedTime,sortable:"",label:"ISSUED TIME"}})],1)],1):_vm._e()])]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.cancelForm()}}},[_vm._v("CLOSE")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.returnTool()}}},[_vm._v(_vm._s(_vm.saving?"Submitting...":"Return"))])],1)],1)],1):_vm._e()])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),vuex_esm=(__webpack_require__(450886),__webpack_require__(648324),__webpack_require__(670560),__webpack_require__(260228),__webpack_require__(76265),__webpack_require__(425728),__webpack_require__(420629)),User=__webpack_require__(426803),Storeroom=__webpack_require__(664281),inventoryHelper=__webpack_require__(424477),InventoryUtil=__webpack_require__(976195),api=__webpack_require__(32284),validation=__webpack_require__(990260),transactionTypeEnum={STOCK:1,MANUAL:3},transactionStateEnum={ISSUE:2,RETURN:3},ToolStoreIssueReturnvue_type_script_lang_js={props:["storeRoom","showToolIssueReturn","type"],components:{UserAvatar:User/* default */.Z,StoreRoomAvatar:Storeroom/* default */.Z},mixins:[inventoryHelper/* default */.Z],data:function(){return{saving:!1,loading:!1,fetchingMore:!1,quantity:null,userid:null,workorderid:null,purchasedUnUsedToolList:[],selectedUnUsedTools:null,issueForm:null,issuedTools:[],selectedIndTrackReturnTool:null,purLoading:!0,tool:null,issueLoading:!1,selectedTool:null,showLoading:!0,toolList:[]}},computed:(0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users}})),mounted:function(){this.loadToolforStoreRoom()},methods:{loadToolforStoreRoom:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var filters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.showLoading=!0,filters={storeRoom:{operatorId:36,value:[_this.storeRoom.id+""]}},_context.next=4,(0,InventoryUtil/* getFilteredToolList */.FI)(filters);case 4:if(_this.toolList=_context.sent,!(0,validation/* isEmpty */.xb)(_this.toolList)){_context.next=7;break}return _context.abrupt("return");case 7:_this.selectedTool=_this.toolList[0].id,_this.tool=_this.toolList[0],"issue"===_this.type?_this.loadPurchasedUnUsedToolsList():"return"===_this.type&&_this.loadIssuedTool(),_this.showLoading=!1;case 11:case"end":return _context.stop()}}),_callee)})))()},savedForm:function(){this.cancelForm()},cancelForm:function(){this.$emit("refresh"),this.$emit("update:showToolIssueReturn",!1)},issueTool:function(toolTransactionData){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _yield$API$createReco,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api/* API */.bl.createRecord("toolTransactions",{data:toolTransactionData,params:{issue:!0}});case 2:_yield$API$createReco=_context2.sent,error=_yield$API$createReco.error,error?_this2.$message.error(error.message||_this2.$t("common.wo_report.unable_to_update")):(_this2.$message.success(_this2.$t("common.header.tool_issued_successfully")),_this2.savedForm());case 5:case"end":return _context2.stop()}}),_callee2)})))()},saveIssueForm:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var toolTransactionData,_toolTransactionData;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(_this3.userid){_context3.next=4;break}_this3.$message.error("Choose a User"),_context3.next=14;break;case 4:if(!_this3.userid||_this3.tool.toolType.isRotating||!_this3.quantity){_context3.next=10;break}return toolTransactionData={tool:{id:_this3.tool.id},parentId:_this3.userid,transactionType:transactionTypeEnum.MANUAL,transactionState:transactionStateEnum.ISSUE,issuedTo:{ouid:_this3.userid},quantity:_this3.quantity},_context3.next=8,_this3.issueTool(toolTransactionData);case 8:_context3.next=14;break;case 10:if(!(_this3.userid&&_this3.tool.toolType.isRotating&&_this3.selectedUnUsedTools)){_context3.next=14;break}return _toolTransactionData={tool:{id:_this3.tool.id},parentId:_this3.userid,transactionType:transactionTypeEnum.MANUAL,transactionState:transactionStateEnum.ISSUE,issuedTo:{ouid:_this3.userid},assetIds:_this3.selectedUnUsedTools},_context3.next=14,_this3.issueTool(_toolTransactionData);case 14:case"end":return _context3.stop()}}),_callee3)})))()},loadPurchasedUnUsedToolsList:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var filters;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(!_this4.tool.toolType.isRotating){_context4.next=7;break}return filters={rotatingTool:{operatorId:36,value:[_this4.tool.id+""]},isUsed:{operatorId:15,value:[!1+""]}},_this4.purLoading=!0,_context4.next=5,_this4.$util.getFilteredAssetList(filters);case 5:_this4.purchasedUnUsedToolList=_context4.sent,_this4.purLoading=!1;case 7:case"end":return _context4.stop()}}),_callee4)})))()},toggleUnUsedToolSelection:function(selected){this.selectedUnUsedTools=selected.map((function(value){return value.id}))},toggleReturnToolSelection:function(selected){this.selectedIndTrackReturnTool=selected},getDateTime:function(val){var value=val.purchasedDate;return value&&-1!==value?this.$options.filters.formatDate(value):""},getDateTimeIssuedTime:function(val){var value=val.sysModifiedTime;return value&&-1!==value?this.$options.filters.formatDate(value,!0):""},loadIssuedTool:function(){var self=this,filters={tool:{operatorId:5,value:[this.tool.id+""]}};self.issueLoading=!0,self.$http.get("/v2/toolTransactions/view/showToolTransactionListForReturn?showToolsForReturn=true&filters="+encodeURIComponent(JSON.stringify(filters))).then((function(response){self.issueLoading=!1,self.issuedTools=response.data.result.toolTransactions})).catch((function(error){error&&(self.issueLoading=!1,self.fetchingMore=!1)}))},isValid:function(val){if(null!==val&&""!==val&&void 0!==val)return!0},returnToolCall:function(toolTransaction,rotating){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return url="v3/modules/data/bulkCreate",params={data:{toolTransactions:toolTransaction},moduleName:"toolTransactions",params:{return:!0}},_context5.next=4,api/* API */.bl.post(url,params);case 4:_yield$API$post=_context5.sent,error=_yield$API$post.error,error?_this5.$message.error(error.message||_this5.$t("common.wo_report.unable_to_update")):(_this5.$message.success(_this5.$t("common.header.tool_returned_successfully")),_this5.loadIssuedTool(),rotating&&(_this5.selectedIndTrackReturnTool=null),_this5.savedForm(),_this5.$emit("refreshInventory"));case 7:case"end":return _context5.stop()}}),_callee5)})))()},returnTool:function(){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var toolTransaction,i,tTemp,_toolTransaction,_i,temp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:if(_this6.tool.toolType.isRotating){_context6.next=15;break}toolTransaction=[],_context6.t0=(0,regeneratorRuntime/* default */.Z)().keys(_this6.issuedTools);case 3:if((_context6.t1=_context6.t0()).done){_context6.next=11;break}if(i=_context6.t1.value,!(_this6.issuedTools[i].updateQuantity&&_this6.issuedTools[i].updateQuantity>_this6.issuedTools[i].remainingQuantity)){_context6.next=8;break}return _this6.$message.error(_this6.$t("common._common.return_quantity_greater_issued")),_context6.abrupt("return");case 8:_this6.isValid(_this6.issuedTools[i].updateQuantity)&&!isNaN(_this6.issuedTools[i].updateQuantity)&&(tTemp={tool:{id:_this6.issuedTools[i].tool.id},parentTransactionId:_this6.issuedTools[i].id,parentId:_this6.issuedTools[i].parentId,transactionType:_this6.issuedTools[i].transactionType,transactionState:transactionStateEnum.RETURN,quantity:parseInt(_this6.issuedTools[i].updateQuantity)},toolTransaction.push(tTemp)),_context6.next=3;break;case 11:return _context6.next=13,_this6.returnToolCall(toolTransaction,_this6.$getProperty(_this6.tool,"toolType.isRotating",null));case 13:_context6.next=20;break;case 15:if(!_this6.tool.toolType.isRotating){_context6.next=20;break}for(_i in _toolTransaction=[],_this6.selectedIndTrackReturnTool)temp={tool:{id:_this6.selectedIndTrackReturnTool[_i].tool.id},parentId:_this6.selectedIndTrackReturnTool[_i].parentId,parentTransactionId:_this6.selectedIndTrackReturnTool[_i].id,transactionType:_this6.selectedIndTrackReturnTool[_i].transactionType,transactionState:transactionStateEnum.RETURN,assetIds:[_this6.selectedIndTrackReturnTool[_i].asset.id]},_toolTransaction.push(temp);return _context6.next=20,_this6.returnToolCall(_toolTransaction,_this6.$getProperty(_this6.tool,"toolType.isRotating"));case 20:case"end":return _context6.stop()}}),_callee6)})))()},selectedToolFill:function(val){val&&(this.tool=this.toolList.find((function(it){return val===it.id})),"issue"===this.type?this.loadPurchasedUnUsedToolsList():"return"===this.type&&this.loadIssuedTool())}}},Storerooms_ToolStoreIssueReturnvue_type_script_lang_js=ToolStoreIssueReturnvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(Storerooms_ToolStoreIssueReturnvue_type_script_lang_js,render,staticRenderFns,!1,null,"59b9a372",null)
/* harmony default export */,ToolStoreIssueReturn=component.exports},
/***/331778:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return RotatingAssetChooser}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/Inventory/component/RotatingAssetChooser.vue?vue&type=template&id=08083778
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.visibility?_c("div",[_c("el-dialog",{attrs:{visible:_vm.visibility,"before-close":_vm.closeDialog,fullscreen:!1,title:"Rotating Asset",open:"top","custom-class":"fc-dialog-center-container","append-to-body":!0}},[_c("div",{staticClass:"height400"},[_c("el-table",{directives:[{name:"loading",rawName:"v-loading",value:_vm.assetLoading,expression:"assetLoading"}],ref:"rotatingAssetTable",staticClass:"width100 inventory-inner-table",attrs:{height:"330",data:_vm.rotatingAssetList,"empty-text":"No Rotating assets available.","default-sort":{prop:"costDate",order:"descending"}},on:{"selection-change":_vm.selectRotatingAsset}},[_c("el-table-column",{attrs:{type:"selection",width:"60"}}),_c("el-table-column",{attrs:{prop:"serialNumber",sortable:"",label:"SERIAL NUMBER"}}),_c("el-table-column",{attrs:{sortable:"",label:"PRICE"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("currency",{attrs:{value:scope.row.unitPrice>0?scope.row.unitPrice:0}})]}}],null,!1,1697311838)}),_c("el-table-column",{attrs:{sortable:"",prop:"purchasedDate",formatter:_vm.getDateTimePurchasedDate,label:"PURCHASED TIME"}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v("CANCEL")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:function($event){return _vm.saveAsset()}}},[_vm._v("SAVE")])],1)],1)])],1):_vm._e()])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),RotatingAssetChooservue_type_script_lang_js=(__webpack_require__(450886),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(425728),__webpack_require__(670560),{data:function(){return{rotatingAssetList:[],selectedAssetObj:[],selectedAssetId:[],assetLoading:!1,entryCheck:!0}},props:["visibility","item","tool","assetIds","isGatePass"],mounted:function(){var filters={};this.item?(filters={rotatingItem:{operatorId:36,value:[this.item+""]},isUsed:{operatorId:15,value:["false"]}},this.isGatePass&&delete filters.isUsed):this.tool&&(filters={rotatingTool:{operatorId:36,value:[this.tool+""]},isUsed:{operatorId:15,value:["false"]}}),this.loadRotatingAssetList(filters)},methods:{loadRotatingAssetList:function(filters){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this.assetLoading=!0,_context.next=3,_this.$util.getFilteredAssetList(filters);case 3:_this.rotatingAssetList=_context.sent,_this.assetLoading=!1,_this.assetIds&&_this.mapAsset();case 6:case"end":return _context.stop()}}),_callee)})))()},selectRotatingAsset:function(val){
// Temp Fix Needs to be Handled in proper way
0===val.length&&this.entryCheck?(this.mapAsset(),this.entryCheck=!1):(this.selectedAssetObj=val,this.selectedAssetId=val.map((function(i){return i.id})))},toggleRotatingAsset:function(rows){var _this2=this;rows?rows.forEach((function(row){_this2.$refs.rotatingAssetTable.toggleRowSelection(row)})):this.$refs.rotatingAssetTable.clearSelection()},closeDialog:function(){this.$emit("update:visibility",!1)},saveAsset:function(){this.$emit("save",this.selectedAssetId),this.$emit("update:visibility",!1)},getDateTimePurchasedDate:function(val){var value=val.purchasedDate;return value&&-1!==value?this.$options.filters.formatDate(value,!0):""},mapAsset:function(){var self=this,assetToggleList=[];self.assetIds.forEach((function(i){var tempList=self.rotatingAssetList.find((function(j){return j.id===i}));assetToggleList.push(tempList)})),self.selectedAssetObj=assetToggleList,self.selectedAssetId=assetToggleList.map((function(i){return i.id})),self.toggleRotatingAsset(assetToggleList)}}}),component_RotatingAssetChooservue_type_script_lang_js=RotatingAssetChooservue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(component_RotatingAssetChooservue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,RotatingAssetChooser=component.exports},
/***/619257:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"b0e8e9091860c5af0950a491c2268b7f.svg";
/***/},
/***/494194:
/***/function(module,__unused_webpack_exports,__webpack_require__){"use strict";module.exports=__webpack_require__.p+"img/store-img.8acd997f.jpg"}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/36695.js.map