(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[14616],{
/***/673362:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return SpaceAssetMultiChooser}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/SpaceAssetMultiChooser.vue?vue&type=template&id=0ccc2fed
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:_vm.visibility,fullscreen:!1,open:"top",width:"60%","custom-class":" fc-dialog-up spaceassetchooser setup-dialog60","before-close":_vm.handleclose,"append-to-body":!0},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("div",{staticClass:"multi f-element",attrs:{id:"spaceassetchooser"}},[_vm.hideBanner?_vm._e():_c("banner",{attrs:{message:_vm.message,hideIcon:!_vm.selectedList.count}}),_c("div",{staticStyle:{height:"600px","overflow-y":"hidden"}},[_c("div",{staticStyle:{"background-color":"#ffffff",height:"100%",width:"100%",display:"inline-block"}},[_c("div",{staticClass:"flex-middle justify-content-space pT20 pL20 pR20"},[_vm.isAsset?_c("el-select",{staticClass:"inline asset-category fc-input-full-border2",attrs:{filterable:"",placeholder:_vm.assetCategory.placeHolder,disabled:!_vm.isAsset||_vm.disable},on:{change:_vm.onCategoryChange},model:{value:_vm.assetCategory.value,callback:function($$v){_vm.$set(_vm.assetCategory,"value",$$v)},expression:"assetCategory.value"}},_vm._l(_vm.assetCategory.options,(function(label,value){return _c("el-option",{key:value,attrs:{label:label,value:parseInt(value)}})})),1):_c("el-select",{staticClass:"inline asset-category fc-input-full-border2",attrs:{filterable:"",clearable:"",placeholder:_vm.spaceCategory.placeHolder},on:{change:_vm.onSpaceCategoryChange},model:{value:_vm.spaceCategory.value,callback:function($$v){_vm.$set(_vm.spaceCategory,"value",$$v)},expression:"spaceCategory.value"}},_vm._l(_vm.spaceCategory.options,(function(label,value){return _c("el-option",{key:value,attrs:{label:label,value:value}})})),1),_vm.hideBanner?_vm._e():_c("div",{staticClass:"pull-right"},[_c("el-radio-group",{on:{change:_vm.onIncludeTypeChange},model:{value:_vm.includeType,callback:function($$v){_vm.includeType=$$v},expression:"includeType"}},[_c("el-radio",{staticClass:"fc-radio",attrs:{label:"all"}},[_vm._v("All")]),_c("el-radio",{staticClass:"fc-radio",attrs:{label:"include"}},[_vm._v("Include")]),_c("el-radio",{staticClass:"fc-radio",attrs:{label:"exclude"}},[_vm._v("Exclude")])],1)],1)],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"pT10 pB10",staticStyle:{"padding-left":"20px","padding-right":"20px","border-bottom":"1px solid #e6ecf3 !important"}},[_vm.showQuickSearch?_c("div",{staticStyle:{display:"inline-block",width:"100%"}},[_c("div",{staticClass:"col-6 fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper relative chooser-search"},[_c("svg",{staticClass:"search-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"}},[_c("title",[_vm._v("search")]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQuery,expression:"quickSearchQuery"}],ref:"quickSearchQuery",staticClass:"quick-search-input",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQuery},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.setResourceData.apply(null,arguments)},input:function($event){$event.target.composing||(_vm.quickSearchQuery=$event.target.value)}}}),_c("svg",{staticClass:"close-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.toggleQuickSearch}},[_c("title",[_vm._v("close")]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_c("div",{staticClass:"asset-chooser-select-block"},[_vm._l(_vm.resourceConfig,(function(field){return _c("div",{key:field.spaceType,staticClass:"inline"},[!_vm.resourceType||_vm.resourceType.includes(field.spaceType+1)?_c("el-select",{attrs:{multiple:"","collapse-tags":"",filterable:"",clearable:"",placeholder:field.placeHolder,disabled:4===field.spaceType&&!_vm.isAsset||field.disabled},on:{change:function($event){return _vm.onLocationChange(field)}},model:{value:field.value,callback:function($$v){_vm.$set(field,"value",$$v)},expression:"field.value"}},_vm._l(field.options,(function(option){return _c("el-option",{key:option.id,attrs:{label:option.name,value:option.id}})})),1):_vm._e()],1)})),_c("span",{staticClass:"searchicon pull-right pointer"},[_c("span",{on:{click:_vm.toggleQuickSearch}},[_c("i",{staticClass:"el-icon-search"})])])],2)])])],1),_c("div",{staticClass:"scroll-multichooser"},[_c("el-row",[_c("el-col",{staticClass:"table-scroll-chooser",attrs:{span:_vm.hideBanner?16:24}},[_c("v-infinite-scroll",{staticStyle:{"max-height":"500px","overflow-y":"scroll","padding-bottom":"50px"},attrs:{loading:_vm.loading,offset:20},on:{bottom:_vm.nextPage}},[_c("table",{staticClass:" pT15 fc-list-view-table border-right-table"},[_c("thead",[_c("tr",{staticClass:"tablerow pT30",staticStyle:{"background-color":"#ffffff",padding:"15px"}},[_c("td",{staticClass:"headerrow "},[_c("el-checkbox",{attrs:{disabled:"exclude"===_vm.includeType&&!_vm.hideBanner},on:{change:_vm.onSelectAllChange},model:{value:_vm.selectall,callback:function($$v){_vm.selectall=$$v},expression:"selectall"}})],1),_c("td",{staticClass:"headerrow width30"},[_vm._v("#ID")]),_c("td",{staticClass:"headerrow width30"},[_vm._v("NAME")]),_c("td",{staticClass:"headerrow width30"},[_vm._v("CATEGORY")])])]),_c("tbody",[_vm._l(_vm.spaceList,(function(space){return _vm.isAsset?_vm._e():_c("tr",{key:space.id,staticClass:"tablerow",class:{selectedrow:space.selected}},[_c("td",{staticClass:"contentrow"},[_c("el-checkbox",{on:{change:function($event){return _vm.toggleSelect(space,!0)}},model:{value:space.selected,callback:function($$v){_vm.$set(space,"selected",$$v)},expression:"space.selected"}})],1),_c("td",{staticClass:"contentrow width30",on:{click:function($event){return $event.stopPropagation(),_vm.toggleSelect(space)}}},[_vm._v(" #"+_vm._s(1==space.spaceType?"SI"+space.id:2==space.spaceType?"BU"+space.id:3==space.spaceType?"FL"+space.id:4==space.spaceType?"SP"+space.id:space.id)+" ")]),_c("td",{staticClass:"contentrow width30",on:{click:function($event){return $event.stopPropagation(),_vm.toggleSelect(space)}}},[_vm._v(" "+_vm._s(space.name)+" ")]),_c("td",{staticClass:"contentrow width30"},[_vm._v(" "+_vm._s(space.spaceTypeVal)+" ")])])})),_vm._l(_vm.assetList,(function(asset){return _vm.isAsset?_c("tr",{key:asset.id,staticClass:"tablerow",class:{selectedrow:asset.selected}},[_c("td",{staticClass:"contentrow"},[_c("el-checkbox",{on:{change:function($event){return _vm.toggleSelect(asset,!0)}},model:{value:asset.selected,callback:function($$v){_vm.$set(asset,"selected",$$v)},expression:"asset.selected"}})],1),_c("td",{staticClass:"contentrow width30",on:{click:function($event){return $event.stopPropagation(),_vm.toggleSelect(asset)}}},[_vm._v(" #"+_vm._s(asset.id)+" ")]),_c("td",{staticClass:"contentrow width30",on:{click:function($event){return $event.stopPropagation(),_vm.toggleSelect(asset)}}},[_vm._v(" "+_vm._s(asset.name)+" ")]),_c("td",{staticClass:"contentrow width30"},[_vm._v(" "+_vm._s(asset.category?_vm.getAssetCategory(asset.category.id).displayName:"---")+" ")])]):_vm._e()})),_vm.spaceList&&_vm.spaceList.length<1&&_vm.assetList&&_vm.assetList.length<1?_c("tr",{staticStyle:{background:"none",border:"none","margin-top":"20px"}},[_c("td",{staticClass:"text-center label-txt-black",staticStyle:{"border-bottom":"none","font-size":"14px","padding-top":"40px",cursor:"auto"},attrs:{colspan:"100%"}},[_vm._v(" No "+_vm._s(_vm.isAsset?"Asset":"Space")+" to display! ")])]):_vm._e()],2)])])],1),_vm.hideBanner?_c("el-col",{staticClass:"chooser-selected-container",attrs:{span:8}},[_c("div",{staticClass:"chooser-scroll-block"},[_vm.selectedList&&_vm.selectedList.length?_c("div",{staticClass:"count-message"},[_vm._v(" "+_vm._s(_vm.message)+" ")]):_vm._e(),_vm._l(_vm.selectedList,(function(resource,value){return _c("div",{key:value,staticClass:"selected-field"},[_vm._v(" "+_vm._s(resource.name)+" "),_c("i",{staticClass:"el-icon-close remove",on:{click:function($event){return _vm.deSelect(resource)}}})])}))],2)]):_vm._e()],1)],1),_c("div",{staticClass:"f-footer row"},[_c("button",{staticClass:"footer-btn footer-btn-secondary col-6",attrs:{type:"button"},on:{click:_vm.handleclose}},[_c("span",[_vm._v("Cancel")])]),_c("button",{staticClass:"footer-btn footer-btn-primary col-6",attrs:{type:"button"},on:{click:_vm.associate}},[_c("span",[_vm._v("Ok")])])])],1)]),_c("div",{staticStyle:{position:"absolute",top:"45%",left:"45%","z-index":"5"}},[_c("spinner",{attrs:{show:_vm.resourceLoading,size:"70"}})],1)],1)])},staticRenderFns=[],objectSpread2=__webpack_require__(595082),v_infinite_scroll=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(450886),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(561364)),v_infinite_scroll_default=__webpack_require__.n(v_infinite_scroll),ResourceMixin=__webpack_require__(22637),FBannervue_type_template_id_85b57242_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.message?_c("div",{staticClass:"banner-block",style:{"background-color":_vm.bannerColor}},[_c("div",{staticClass:"banner-content"},[_c("i",{directives:[{name:"show",rawName:"v-show",value:!_vm.hideIcon,expression:"!hideIcon"}],class:["banner-icon flLeft",_vm.bannerIcon],style:{color:_vm.bannerTextColor},attrs:{"aria-hidden":"true"}}),_c("p",{staticClass:"banner-txt flLeft",style:{color:_vm.bannerTextColor}},[_vm._v(" "+_vm._s(_vm.message)+" ")])])]):_vm._e()])},FBannervue_type_template_id_85b57242_staticRenderFns=[],FBannervue_type_script_lang_js={props:["message","icon","color","textColor","hideIcon"],computed:{bannerColor:function(){var color;return this.color?color=this.color:this.isError||(color="#ecf3da"),color},bannerTextColor:function(){var color;return this.textColor?color=this.textColor:this.isError||(color="#67933a"),color},bannerIcon:function(){var icon;return this.icon?icon=this.icon:this.isError||(icon="el-icon-circle-check-outline"),icon}}},components_FBannervue_type_script_lang_js=FBannervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FBannervue_type_script_lang_js,FBannervue_type_template_id_85b57242_render,FBannervue_type_template_id_85b57242_staticRenderFns,!1,null,null,null)
/* harmony default export */,FBanner=component.exports,vuex_esm=__webpack_require__(420629),SpaceAssetMultiChooservue_type_script_lang_js={mixins:[ResourceMixin/* default */.Z],props:["visibility","disable","hideBanner"],components:{Banner:FBanner,VInfiniteScroll:v_infinite_scroll_default()},data:function(){return{selectall:!1,showQuickSearch:!1,includeType:"all",selectedList:[]}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapGetters */.Se)(["getAssetCategory"])),{},{message:function(){var message,selectedCount=this.selectedList.length;if("all"===this.includeType&&this.categoryName)message="All "+this.categoryName+"s have been selected";else if("all"!==this.includeType&&selectedCount){var includeMsg;includeMsg=this.hideBanner?" Selected":"include"===this.includeType?" Included":" Excluded";var resource=(this.categoryName?this.categoryName:"")+(this.showAsset?" Asset":" Space");message=selectedCount+" "+resource+(selectedCount>1?"s":"")+includeMsg}else message=this.resourceType?"No Space Selected":"No Asset Selected";return message},categoryName:function(){return!this.assetCategory||this.assetCategory.value<=0?"":this.assetCategory.options[this.assetCategory.value]}}),created:function(){var _this=this;this.$store.dispatch("loadSpaceCategory"),this.$store.dispatch("loadAssetCategory").then((function(){_this.initResourceData()}))},watch:{visibility:function(val){val?this.reInit():val||!this.query||this.selectedList&&this.selectedList.length||this.$emit("associate",{})},query:function(val){this.quickSearchQuery=val,val&&(this.showQuickSearch=!0,this.setResourceData())},initialResourcesFecthed:function(val){val&&this.setInitialData()}},methods:{reInit:function(){this.showQuickSearch=!1,this.quickSearchQuery=null,this.checkAndInitResourceData()},deSelect:function(object){var resource=this.resourceList.find((function(resource){return resource.id===object.id}));resource?resource.selected=!1:resource=object,this.setSelectedResource(resource),this.setIncludeTypeOnChange()},handleclose:function(){this.$emit("update:visibility",!1),this.$emit("update:siteId",null)},openSpace:function(){this.isAsset=!1,this.loadSpace()},openAsset:function(){this.isAsset=!0,this.loadAsset()},associate:function(){var obj={};"all"!==this.includeType&&(obj.resourceList=this.selectedList,obj.isInclude="include"===this.includeType),this.$emit("associate",obj)},toggleQuickSearch:function(){var _this2=this;this.showQuickSearch=!this.showQuickSearch,this.showQuickSearch?this.$nextTick((function(){_this2.$refs.quickSearchQuery.focus()})):(this.quickSearchQuery=null,this.setResourceData())},onCategoryChange:function(){this.assetCategory.value?this.includeType="all":this.setIncludeTypeOnChange(),this.onCategorySelected(),this.selectedList=[]},onSpaceCategoryChange:function(){this.spaceCategory;this.onSpaceCategorySelected(),this.selectedList=[]},onSelectAllChange:function(){var _this3=this;this.selectedList=[],this.resourceList.forEach((function(resource){_this3.$set(resource,"selected",_this3.selectall),_this3.setSelectedResource(resource)})),this.setIncludeTypeOnChange()},toggleSelect:function(resource,alreadyChanged){alreadyChanged||this.$set(resource,"selected",!resource.selected),this.setSelectedResource(resource),this.selectall=this.selectedList.length===this.resourceList.length,this.setIncludeTypeOnChange()},setInitialData:function(){var _this4=this;if(this.initialData){var selectedResources=this.initialData.selectedResources;this.includeType=selectedResources&&selectedResources.length?this.initialData.isIncludeResource?"include":"exclude":"all";var idArray=[];selectedResources&&(this.selectedList=[],this.resourceList.forEach((function(resource){var resourceSelectedObj=_this4.initialData.selectedResources.some((function(selctedResource){return selctedResource.id===resource.id}));_this4.$set(resource,"selected",resourceSelectedObj),_this4.setSelectedResource(resource)}))),this.selectedList&&selectedResources&&this.selectedList.length<selectedResources.length&&(this.selectedList=[],this.initialData.selectedResources.forEach((function(d){idArray.push(d.id)})),this.$util.loadResource(idArray).then((function(fields){_this4.selectedList=fields})))}},setIncludeTypeOnChange:function(){"all"===this.includeType?this.includeType="include":this.selectedList.length||(this.includeType="all")},onIncludeTypeChange:function(){var _this5=this;"all"===this.includeType&&(this.resourceList.forEach((function(resource){_this5.$set(resource,"selected",!1)})),this.selectedList=[],this.selectall=!1)},isSelected:function(resourceId){return this.selectedList.find((function(resource){return resource.id===resourceId}))},onLocationChange:function(field){var _this6=this;this.onLocationSelected(field).then((function(){_this6.setListSelected()})),this.setIncludeTypeOnChange()},setResourceData:function(){var _this7=this;this.loadResourceData().then((function(){_this7.setListSelected()}))},setListSelected:function(){var _this8=this,selectedIds=this.selectedList.map((function(resource){return resource.id}));this.isAsset?this.assetList.map((function(asset){return selectedIds.includes(asset.id)&&_this8.$set(asset,"selected",!0),asset})):this.spaceList.map((function(space){return selectedIds.includes(space.id)&&_this8.$set(space,"selected",!0),space}))},setSelectedResource:function(resource){if(resource.selected)this.selectedList.push(this.$helpers.cloneObject(resource));else{var idx=this.selectedList.findIndex((function(sr){return sr.id===resource.id}));-1!==idx&&this.selectedList.splice(idx,1)}}}},components_SpaceAssetMultiChooservue_type_script_lang_js=SpaceAssetMultiChooservue_type_script_lang_js,SpaceAssetMultiChooser_component=(0,componentNormalizer/* default */.Z)(components_SpaceAssetMultiChooservue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SpaceAssetMultiChooser=SpaceAssetMultiChooser_component.exports},
/***/760218:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PageBuilder}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/PageBuilder.vue?vue&type=template&id=0dd0982f
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.showPage&&_vm.pagebuilderComponent?_c(_vm.pagebuilderComponent,_vm._b({tag:"component",attrs:{module:_vm.module},on:{forceOldPage:function($event){_vm.forceOld=!0}}},"component",_vm.$attrs,!1)):_vm._e()},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),vuex_esm=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(420629)),PageBuildervue_type_script_lang_js={props:["module"],data:function(){return{forceOld:!1,showPage:!1}},components:{NewPageBuilder:function(){return Promise.all(/* import() */[__webpack_require__.e(93208),__webpack_require__.e(50232),__webpack_require__.e(93765),__webpack_require__.e(95953),__webpack_require__.e(35309),__webpack_require__.e(18778),__webpack_require__.e(12303),__webpack_require__.e(84290),__webpack_require__.e(31721),__webpack_require__.e(64418),__webpack_require__.e(5603),__webpack_require__.e(57432),__webpack_require__.e(435),__webpack_require__.e(72230),__webpack_require__.e(94255),__webpack_require__.e(67683),__webpack_require__.e(44178),__webpack_require__.e(91132),__webpack_require__.e(20280),__webpack_require__.e(78256),__webpack_require__.e(22200),__webpack_require__.e(49081),__webpack_require__.e(89472),__webpack_require__.e(12085),__webpack_require__.e(55754),__webpack_require__.e(86494),__webpack_require__.e(3037),__webpack_require__.e(49908),__webpack_require__.e(22061),__webpack_require__.e(31602),__webpack_require__.e(73609),__webpack_require__.e(44119),__webpack_require__.e(88262),__webpack_require__.e(82080),__webpack_require__.e(88506)]).then(__webpack_require__.bind(__webpack_require__,110570))},OldPageBuilder:function(){return Promise.all(/* import() */[__webpack_require__.e(93208),__webpack_require__.e(50232),__webpack_require__.e(93765),__webpack_require__.e(95953),__webpack_require__.e(35309),__webpack_require__.e(18778),__webpack_require__.e(12303),__webpack_require__.e(84290),__webpack_require__.e(31721),__webpack_require__.e(64418),__webpack_require__.e(5603),__webpack_require__.e(57432),__webpack_require__.e(435),__webpack_require__.e(72230),__webpack_require__.e(94255),__webpack_require__.e(67683),__webpack_require__.e(44178),__webpack_require__.e(91132),__webpack_require__.e(20280),__webpack_require__.e(78256),__webpack_require__.e(22200),__webpack_require__.e(49081),__webpack_require__.e(89472),__webpack_require__.e(12085),__webpack_require__.e(55754),__webpack_require__.e(86494),__webpack_require__.e(3037),__webpack_require__.e(49908),__webpack_require__.e(22061),__webpack_require__.e(31602),__webpack_require__.e(73609),__webpack_require__.e(23803),__webpack_require__.e(55246)]).then(__webpack_require__.bind(__webpack_require__,223803))}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(_context.prev=0,!_this.$helpers.isLicenseEnabled("PAGE_BUILDER")){_context.next=4;break}return _context.next=4,_this.$store.dispatch("pagebuilder/loadNewPageEnabledModules");case 4:_context.next=8;break;case 6:_context.prev=6,_context.t0=_context["catch"](0);case 8:_this.$nextTick((function(){_this.showPage=!0}));case 9:case"end":return _context.stop()}}),_callee,null,[[0,6]])})))()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({newPageEnabledModules:function(state){return state.pagebuilder.newPageEnabledModules}})),{},{pagebuilderComponent:function(){var newPageEnabledModules=this.newPageEnabledModules,module=this.module,forceOld=this.forceOld,isNew=(newPageEnabledModules||[]).includes(module),showNew=!forceOld&&(this.showNewPageBuilder||isNew);return showNew?"NewPageBuilder":"OldPageBuilder"},showNewPageBuilder:function(){var query=this.$route.query,_query$showNewPageBui=query.showNewPageBuilder,showNewPageBuilder=void 0!==_query$showNewPageBui&&_query$showNewPageBui;return!0===showNewPageBuilder||"true"===showNewPageBuilder}})},page_PageBuildervue_type_script_lang_js=PageBuildervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(page_PageBuildervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PageBuilder=component.exports},
/***/657659:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return HistoricalRunDialog}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/rule/HistoricalRunDialog.vue?vue&type=template&id=1ef2a102&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{visible:_vm.visibility,"append-to-body":!0,"custom-class":"setup-dialog40 setup-dialog breakdown-popup","before-close":_vm.closeDialog},on:{"update:visible":function($event){_vm.visibility=$event}}},[_c("error-banner",{attrs:{error:_vm.error,errorMessage:_vm.errorText},on:{"update:error":function($event){_vm.error=$event},"update:errorMessage":function($event){_vm.errorText=$event},"update:error-message":function($event){_vm.errorText=$event}}}),_c("div",{staticClass:"content-section"},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(_vm._s("Historical Run"))])])]),_c("div",{staticClass:"new-body-modal"},[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt pB10"},[_vm._v(_vm._s(_vm.$t("alarm.alarm.asset")))]),_c("el-input",{staticClass:"fc-border-select fc-input-full-border-select2 width100",attrs:{disabled:""},model:{value:_vm.resourceLabel,callback:function($$v){_vm.resourceLabel=$$v},expression:"resourceLabel"}},[_c("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{"line-height":"0px !important","font-size":"16px !important",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function($event){_vm.chooserVisibility=!0}},slot:"suffix"})])],1)],1),_c("el-row",{staticClass:"mT20",attrs:{align:"middle"}},[_c("el-col",{staticClass:"pR10",attrs:{span:24}},[_c("f-date-picker",{attrs:{"start-placeholder":"Start Date","end-placeholder":"End Date","picker-options":_vm.dateOptions,type:"datetimerange"},model:{value:_vm.selectedDate,callback:function($$v){_vm.selectedDate=$$v},expression:"selectedDate"}})],1)],1),_c("div",{staticClass:"fc-grey2 f11 line-height20 fw4 pT10"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.execute_for_30days"))+" ")])],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(_vm._s(_vm.$t("agent.agent.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.isSaving},on:{click:_vm.runThroughRule}},[_vm._v(_vm._s(_vm.isSaving?"Saving...":"SAVE"))])],1)]),_c("space-asset-multi-chooser",{staticClass:"fc-input-full-border-select2",attrs:{visibility:_vm.chooserVisibility,initialValues:_vm.resourceData,query:_vm.resourceQuery,showAsset:!0,disable:!0},on:{associate:_vm.associateResource,"update:visibility":function($event){_vm.chooserVisibility=$event}}})],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),validation=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(634338),__webpack_require__(990260)),ErrorBanner=__webpack_require__(297157),moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),SpaceAssetMultiChooser=__webpack_require__(673362),FDatePicker=__webpack_require__(358551),vuex_esm=__webpack_require__(420629),api=__webpack_require__(32284),HistoricalRunDialogvue_type_script_lang_js={props:["visibility","details"],components:{ErrorBanner:ErrorBanner/* default */.Z,FDatePicker:FDatePicker/* default */.Z,SpaceAssetMultiChooser:SpaceAssetMultiChooser/* default */.Z},data:function(){return{dateOptions:{disabledDate:function(time){var today=new Date;return time.getTime()>today.getTime()}},value1:null,isIncludeResource:!1,resourceQuery:null,selectedResourceList:[],chooserVisibility:!1,startTime:null,endTime:null,error:!1,errorText:"",selectedDate:null,isSaving:!1}},mounted:function(){this.$store.dispatch("loadAssetCategory")},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetCategory:function(state){return state.assetCategory}})),{},{assetCategoryId:function(){var details=this.details,_ref=details||{},moduleName=_ref.moduleName,alarmRule=_ref.alarmRule,assetCategoryId="";return assetCategoryId="newreadingrules"===moduleName?this.$getProperty(details,"assetCategory.id",""):this.$getProperty(alarmRule,"preRequsite.assetCategoryId","-1"),assetCategoryId},ruleId:function(){var details=this.details,_ref2=details||{},moduleName=_ref2.moduleName,alarmRule=_ref2.alarmRule,ruleId=null;return ruleId="newreadingrules"===moduleName?this.$getProperty(details,"id",null):this.$getProperty(alarmRule,"preRequsite.id",null),ruleId},resourceData:function(){return{assetCategory:this.assetCategoryId,isIncludeResource:this.isIncludeResource}},resourceLabel:function(){var _this=this;if(this.assetCategoryId>0){var message,category=this.assetCategory.filter((function(d){return d.id===_this.assetCategoryId})),selectedCount=this.selectedResourceList.length;if(selectedCount){var includeMsg=this.isIncludeResource?"included":"excluded";if(1===selectedCount)return this.selectedResourceList[0].name;message=selectedCount+" "+category[0].name+(selectedCount>1?"s":"")+" "+includeMsg}else message="All "+category[0].name+"s selected";return message}return this.selectedResourceList.id>0?this.selectedResourceList.name:null}}),methods:{validateEndDate:function(){var duration=moment_timezone_default().duration(moment_timezone_default()(this.selectedDate[1]).diff(moment_timezone_default()(this.selectedDate[0])));return duration.get("months")<1&&duration.get("days")<=30},associateResource:function(selectedObj){selectedObj.resourceList&&selectedObj.resourceList.length&&(this.selectedResourceList=selectedObj.resourceList,this.isIncludeResource=selectedObj.isInclude),this.chooserVisibility=!1,this.resourceQuery=null},validation:function(){null===this.fromTime||this.fromTime>1?(this.errorText="Please choose start time",this.error=!0):(null===this.toTime||this.toTime>1)&&(this.errorText="Please choose end time",this.error=!0)},runThroughRule:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var fromTime,toTime,historicalLoggerAssetIds,isInclude,url,_API$post,error,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this2.error=!1,null!==_this2.selectedDate){_context.next=5;break}return _this2.error=!0,_this2.errorText="Please select start and end date ",_context.abrupt("return");case 5:if(fromTime=(0,validation/* isEmpty */.xb)(_this2.selectedDate[0])?-1:_this2.selectedDate[0],toTime=(0,validation/* isEmpty */.xb)(_this2.selectedDate[1])?-1:_this2.selectedDate[1],!_this2.error){_context.next=9;break}return _context.abrupt("return");case 9:if(_this2.isSaving=!0,historicalLoggerAssetIds=[],_this2.selectedResourceList.length>0&&_this2.selectedResourceList.forEach((function(element){historicalLoggerAssetIds.push(element.id)})),isInclude=_this2.isIncludeResource,url="/v2/reading/rule/historicalrun/".concat(_this2.ruleId,"?startTime=").concat(fromTime,"&endTime=").concat(toTime),url+="&isInclude="+isInclude,url+="&isScaledFlow=true",_API$post=api/* API */.bl.post(url,{historicalLoggerAssetIds:historicalLoggerAssetIds}),error=_API$post.error,data=_API$post.data,!error||data){_context.next=21;break}return _this2.$message.error("Error Occurred"),_this2.closeDialog(),_context.abrupt("return");case 21:_this2.closeDialog(),_this2.isSaving=!1;case 23:case"end":return _context.stop()}}),_callee)})))()},closeDialog:function(){this.isSaving=!1,this.$emit("update:visibility",!1)}}},rule_HistoricalRunDialogvue_type_script_lang_js=HistoricalRunDialogvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(rule_HistoricalRunDialogvue_type_script_lang_js,render,staticRenderFns,!1,null,"1ef2a102",null)
/* harmony default export */,HistoricalRunDialog=component.exports},
/***/358551:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FDatePicker}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/assets/overview/FDatePicker.vue?vue&type=template&id=fd3cfbc4
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-date-picker",{ref:"date-picker",attrs:{appendToBody:_vm.appendToBody,clearable:!_vm.hideClear,type:_vm.type,"value-format":_vm.valueFormat,format:_vm.pickerFormat,placeholder:_vm.placeholder,disabled:_vm.disabled,editable:_vm.editable,"default-value":_vm.defaultValue,"picker-options":_vm.pickerOptions,"prefix-icon":_vm.prefixIcon,"clear-icon":_vm.clearIcon,"start-placeholder":_vm.startPlaceholder,"end-placeholder":_vm.endPlaceholder,"time-arrow-control":_vm.arrowControl,"default-time":_vm.defaultTime},on:{change:_vm.pickerChange},model:{value:_vm.ttime,callback:function($$v){_vm.ttime=$$v},expression:"ttime"}})},staticRenderFns=[],validation=(__webpack_require__(976801),__webpack_require__(564043),__webpack_require__(857267),__webpack_require__(756532),__webpack_require__(634338),__webpack_require__(450886),__webpack_require__(843843),__webpack_require__(990260)),constant=__webpack_require__(354754),moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),FDatePickervue_type_script_lang_js={props:["appendToBody","value","value-format","format","default-value","placeholder","disabled","editable","picker-options","type","prefix-icon","clear-icon","start-placeholder","end-placeholder","hideClear","arrowControl","default-time"],mounted:function(){this.init()},data:function(){return{timeinorg:[]}},computed:{isRangeType:function(){var _ref=this||{},type=_ref.type;return["daterange","datetimerange"].includes(type)},defaultFormats:function(){var $timeformat=this.$timeformat,$dateformat=this.$dateformat,dateformat=($dateformat||"").replaceAll("Y","y");return dateformat=(dateformat||"").replaceAll("D","d"),{date:dateformat,month:"yyyy-MM",datetime:"".concat(dateformat," ").concat($timeformat),time:"".concat($timeformat),week:"yyyywWW",timerange:"".concat($timeformat),daterange:"".concat(dateformat),monthrange:"yyyy-MM",datetimerange:"".concat(dateformat," ").concat($timeformat),year:"yyyy"}},pickerFormat:function(){var _ref2=this||{},defaultFormats=_ref2.defaultFormats,type=_ref2.type,format=_ref2.format;return(0,validation/* isEmpty */.xb)(format)&&!(0,validation/* isEmpty */.xb)(defaultFormats[type])?defaultFormats[type]:format},ttime:{get:function(){var _this=this,_ref3=this||{},value=_ref3.value,isRangeType=_ref3.isRangeType;return(0,validation/* isEmpty */.xb)(value)?isRangeType?[]:"":isRangeType?value.map((function(val){return _this.getTimeInSystemZone(val)})):this.getTimeInSystemZone(value)},set:function(value){var isRangeType=this.isRangeType;if(isRangeType){if((0,validation/* isEmpty */.xb)(value))this.timeinorg=[];else for(var time in value)this.timeinorg[time]=this.$helpers.getTimeInOrg(value[time]);this.$emit("input",this.timeinorg),this.$emit("change",this.timeinorg)}else{var modifiedTimeFormat=this.$helpers.getTimeInOrg(value);this.$emit("input",modifiedTimeFormat),this.$emit("change",modifiedTimeFormat)}}}},methods:{pickerChange:function(){var isRangeType=this.isRangeType,value=this.value;if(isRangeType){if((0,validation/* isEmpty */.xb)(value))this.timeinorg=[];else for(var time in value)this.timeinorg[time]=this.$helpers.getTimeInOrg(value[time]);this.$emit("pickerChange",this.timeinorg)}else{var modifiedTimeFormat=this.$helpers.getTimeInOrg(value);this.$emit("pickerChange",modifiedTimeFormat)}},init:function(){var isRangeType=this.isRangeType,value=this.value;if(isRangeType){if((0,validation/* isEmpty */.xb)(value))this.timeinorg=[];else for(var time in value){var timeVal=parseInt(value[time]);this.timeinorg[time]=timeVal}this.$emit("input",this.timeinorg)}else if(!(0,validation/* isEmpty */.xb)(value)){var isPlaceHoldersEnabled=constant/* default */.Z.FIELD_PLACEHOLDERS.includes(value)||!1;isPlaceHoldersEnabled||this.$emit("input",value)}this.$emit("initialized")},focus:function(){this.$refs["date-picker"].focus()},getTimeInSystemZone:function(value){return new Date(moment_timezone_default().tz(value,this.$timezone).format("YYYY-MM-DD HH:mm:ss"))}}},overview_FDatePickervue_type_script_lang_js=FDatePickervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(overview_FDatePickervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FDatePicker=component.exports},
/***/142926:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return NewRulesSummary}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/firealarm/rules/NewRulesSummary.vue?vue&type=template&id=43cb1419&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticStyle:{height:"auto","overflow-y":"scroll"}},[_vm.ruleOverviewLoading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.ruleOverviewLoading,size:"80"}})],1):_vm.rule&&_vm.rule?_c("div",{staticClass:"fc__layout__align fc__asset__main__header pT20 pB20 pL20 pR20",staticStyle:{width:"auto","align-items":"center !important","border-bottom":"none",height:"70px"}},[_vm.rule&&_vm.rule?_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"wos-id",attrs:{title:_vm.$t("common.header.back")},on:{click:function($event){return _vm.goBack()}}},[_c("span",{staticClass:"fc-id"},[_vm._v("#"+_vm._s(_vm.rule.id))])]),_c("div",{staticClass:"fc-black-22 fw3 flex-middle"},[_c("div",{staticClass:"fc-separator-lg mL20 mR20"}),_c("div",{staticClass:"max-width500px textoverflow-ellipsis"},[_vm._v(" "+_vm._s(_vm.rule.name)+" ")]),_c("div",{staticClass:"fc-newsummary-chip"},[_vm._v(" "+_vm._s(_vm.rule.status?_vm.$t("common._common.active"):_vm.$t("common._common.inactive"))+" ")])])]):_vm._e(),_c("div",{staticClass:"display-flex mR10"},[_c("div",{staticClass:"flRight fc-el-button mL10"},[_vm.$hasPermission("alarmrules:UPDATE,UPDATE_TEAM,UPDATE_OWN")?_c("el-button",{attrs:{loading:_vm.isEditLoading},on:{click:function($event){_vm.isEditLoading=!0,_vm.editThresholdRule(_vm.ruleId)}}},[_vm._v(_vm._s(_vm.$t("common._common.edit")))]):_vm._e(),_vm.$hasPermission("alarmrules:UPDATE,UPDATE_TEAM,UPDATE_OWN")?_c("el-button",{attrs:{loading:_vm.isLoading,type:"primary"},on:{click:function($event){return _vm.updateStatus(_vm.rule)}},model:{value:_vm.rule.status,callback:function($$v){_vm.$set(_vm.rule,"status",$$v)},expression:"rule.status"}},[_vm._v(" "+_vm._s((_vm.rule.status?_vm.$t("common._common.deactivate"):_vm.$t("common._common.activate"))+(_vm.isLoading?"ing":""))+" ")]):_vm._e(),_c("el-dropdown",{staticClass:"mL10 fc-btn-ico-lg pointer",staticStyle:{"padding-top":"5px","padding-bottom":"5px",position:"relative",top:"5px"},attrs:{trigger:"click"}},[_c("span",{staticClass:"el-dropdown-link"},[_c("img",{attrs:{src:__webpack_require__(935010),width:"16",height:"16"}})]),_c("el-dropdown-menu",{staticClass:"p10",attrs:{slot:"dropdown",trigger:"click"},slot:"dropdown"},[_c("div",{staticClass:"pT5 pB5 fc-label-hover label-txt-black f14 pL10 pR10 pointer",on:{click:function($event){_vm.showHistoryDialog=!0}}},[_vm._v(" "+_vm._s(_vm.$t("common.tabs.historical_run"))+" ")]),_c("div",{staticClass:"pT5 pB5 fc-label-hover label-txt-black f14 pL10 pR10 pointer",on:{click:_vm.enableWO}},[_vm.isEditRuleToWo?_c("div",[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.edit_fault_wo"))+" ")]):_c("div",[_vm._v("Fault To WorkOrder")])]),_vm.isEditRuleToWo?_c("div",{staticClass:"pT5 pB5 fc-label-hover label-txt-black f14 pL10 pR10 pointer",on:{click:_vm.disableFaultWO}},[_vm.isFaultToWo?_c("span",[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.disable_fault_wo"))+" ")]):_c("span",[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.enable_fault_wo"))+" ")])]):_vm._e()])],1)],1)])]):_vm._e(),_vm.showHistoryDialog?_c("historical-run",{attrs:{visibility:_vm.showHistoryDialog,details:_vm.details},on:{"update:visibility":function($event){_vm.showHistoryDialog=$event}}}):_vm._e(),_vm.showForm?_c("RuleWorkOrderForm",{attrs:{visibility:_vm.showForm,modules:_vm.module,moduleName:_vm.moduleWo,module:_vm.module.name,isNew:_vm.isNew,moduleDisplayName:_vm.module.displayName,ruleType:_vm.currentRuleType,activityTypes:_vm.activityTypes,ruleActions:_vm.currentActionTab.actions,currentAction:_vm.currentAction,ruleId:_vm.ruleId,rulename:_vm.rule.name,isEdit:_vm.isEditRuleToWo,details:_vm.rulewoDetails},on:{"update:visibility":function($event){_vm.showForm=$event},loadPage:_vm.loadRuleDetails}}):_vm._e(),_vm.rule&&_vm.rule?_c("page",{key:_vm.rule.id,attrs:{module:_vm.currentModuleName,id:_vm.rule.id,details:_vm.rule,primaryFields:_vm.primaryFields,isFaultToWo:_vm.isFaultToWo}}):_vm._e()],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),PageBuilder=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(976801),__webpack_require__(670560),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(760218)),HistoricalRunDialog=__webpack_require__(657659),api=__webpack_require__(32284),validation=__webpack_require__(990260),RuleWorkOrderFormvue_type_template_id_043236d6_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-dialog",{staticStyle:{"z-index":"1999"},attrs:{visible:_vm.visibility,fullscreen:!0,"append-to-body":!0,"before-close":_vm.closeForm,"custom-class":"fc-dialog-form fc-dialog-right custom-rule-dialog setup-dialog50 setup-dialog "},on:{"update:visible":function($event){_vm.visibility=$event}}},[_vm.loading?[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})]:_vm._e(),_vm.loading?_vm._e():[_c("div",{attrs:{id:"new-custom-rule"}},[_c("error-banner",{attrs:{error:_vm.error,errorMessage:_vm.errorMessage}}),_c("el-form",[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-modal"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"setup-modal-title"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.fault_to_wo"))+" ")])])])]),_vm.loading?_c("div",{staticClass:"new-body-modal"},[_c("el-row",[_c("el-col",{staticClass:"pR10",attrs:{span:12}},[_c("span",{staticClass:"line1 loading-shimmer width50"}),_c("span",{staticClass:"line2 loading-shimmer width100"})]),_c("el-col",{staticClass:"pL10",attrs:{span:12}},[_c("span",{staticClass:"line1 loading-shimmer width50"}),_c("span",{staticClass:"line2 loading-shimmer width100"})])],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("span",{staticClass:"line3 loading-shimmer width50"}),_c("span",{staticClass:"line4 loading-shimmer width100"})])],1)],1):_c("div",{staticClass:"new-body-modal"},[_c("div",{staticClass:"pB30",staticStyle:{"border-bottom":"1px solid #e5e5ea"}},[_c("el-row",[_c("el-col",{staticClass:"utility-block fc-id bold pointer f14 pL5 pT10",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.execute_on"))+" ")]),_c("p",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.define_execute"))+" ")]),_c("el-form-item",{attrs:{prop:"activityType"}},[_c("el-select",{staticClass:"width100 fc-input-full-border-select2",attrs:{placeholder:"Select"},model:{value:_vm.workflowRule.event.activityType,callback:function($$v){_vm.$set(_vm.workflowRule.event,"activityType",$$v)},expression:"workflowRule.event.activityType"}},_vm._l(_vm.createWoActivityType,(function(type,index){return _c("el-option",{key:index,attrs:{label:type.label,value:type.value}})})),1)],1)],1)],1),"Field Change"===_vm.activityType?_c("FaultToWoFields",{attrs:{workflowRule:_vm.workflowRule,module:_vm.moduleName,isEdit:_vm.isEdit},on:{selectedFields:_vm.addWoCreationFields}}):_vm._e(),"On Date"===_vm.activityType?_c("SchedulerForRuleWo",{attrs:{moduleFields:_vm.moduleFields,module:_vm.moduleName,workflowRule:_vm.workflowRule,isEdit:_vm.isEdit},on:{schedulerFields:_vm.addWodateField}}):_vm._e(),_c("el-row",[_c("el-col",{staticClass:"utility-block fc-id bold pointer f14 pL5 pT10",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.approvalprocess.action"))+" ")]),_c("el-form-item",{attrs:{label:_vm.$t("rule.faultToWorkorder.workorder_template"),prop:"formId"}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{placeholder:"Select"},on:{change:function($event){return _vm.loadWOFormFields(_vm.formId,!0)}},model:{value:_vm.alarmWo.templateJson.formId,callback:function($$v){_vm.$set(_vm.alarmWo.templateJson,"formId",$$v)},expression:"alarmWo.templateJson.formId"}},_vm._l(_vm.templates,(function(form,index){return _c("el-option",{key:index,attrs:{label:form.displayName,value:form.id}})})),1)],1)],1)],1),_c("el-row",[_c("el-col",{staticClass:"utility-block fc-id bold pointer f14 pL5 pT10",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.workorder_field_mapping"))+" ")]),_c("div",{staticClass:"fc__layout__has__row pB10"},_vm._l(_vm.alarmFieldMatcher,(function(fieldMatcher,index){return _c("div",{key:index},[_c("el-row",{staticClass:"visibility-visible-actions fc-row-hover pT10 pB10  pointer"},[_c("el-col",{attrs:{span:9}},[_c("el-select",{staticClass:"fc-input-full-border-select2 width100",attrs:{disabled:_vm.disableFormFieldSelect(index),filterable:""},on:{change:function($event){return _vm.statusFieldName(fieldMatcher,index)}},model:{value:fieldMatcher.field,callback:function($$v){_vm.$set(fieldMatcher,"field",$$v)},expression:"fieldMatcher.field"}},_vm._l(_vm.woFormFields,(function(field,index){return _c("el-option",{key:index,attrs:{label:field.displayName,value:field.name}})})),1)],1),_c("el-col",{attrs:{span:9}},[_c("div",{},[fieldMatcher.fieldObj?fieldMatcher.isSpacePicker?_c("div",[_c("el-input",{staticClass:"fc-input-full-border-select2 mL20 width100",attrs:{disabled:""},model:{value:_vm.field.parseLabel,callback:function($$v){_vm.$set(_vm.field,"parseLabel",$$v)},expression:"field.parseLabel"}},[_c("i",{staticClass:"el-input__icon el-icon-search space-picker",attrs:{slot:"suffix"},slot:"suffix"})])],1):_c("div",{staticClass:"flex-middle"},[_vm.lookupCondition(fieldMatcher)||"LOOKUP"===_vm.dataTypeEnum(fieldMatcher)._name?_c("el-select",{staticClass:"fc-input-full-border-select2 width100 mL20",attrs:{filterable:"","collapse-tags":""},on:{change:function($event){return _vm.changeDataType(fieldMatcher)}},model:{value:fieldMatcher.valueArray,callback:function($$v){_vm.$set(fieldMatcher,"valueArray",$$v)},expression:"fieldMatcher.valueArray"}},_vm._l(_vm.pickList(fieldMatcher),(function(value,key){return _c("el-option",{key:key,attrs:{label:value,value:key}})})),1):_c("el-input",{staticClass:"fc-input-full-border-select2 mL20 width130px",model:{value:fieldMatcher.value,callback:function($$v){_vm.$set(fieldMatcher,"value",$$v)},expression:"fieldMatcher.value"}})],1):_c("div",[_c("el-input",{staticClass:"fc-input-full-border-select2 mL20 width100",model:{value:fieldMatcher.value,callback:function($$v){_vm.$set(fieldMatcher,"value",$$v)},expression:"fieldMatcher.value"}})],1)])]),_c("el-col",{attrs:{span:4}},[_c("div",{staticClass:"visibility-hide-actions pT10 mR20 text-right pointer"},[_c("fc-icon",{staticClass:"pointer",attrs:{group:"action",name:"circle-plus"},on:{click:_vm.addRowWO}}),_vm.fieldMatch.length>1&&1!==_vm.fieldMatch.length?_c("fc-icon",{staticClass:"pointer mL5",attrs:{group:"action",name:"circle-minus"},on:{click:function($event){return _vm.deleteRow(index)}}}):_vm._e()],1)])],1)],1)})),0)])],1),_c("div",{staticClass:"mT40"},[_c("el-checkbox",{on:{change:function($event){_vm.createComment=!_vm.createComment}},model:{value:_vm.includeComments,callback:function($$v){_vm.includeComments=$$v},expression:"includeComments"}},[_vm._v(_vm._s(_vm.$t("rule.faultToWorkorder.include_commands")))])],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_vm.createComment?_c("el-input",{staticClass:"fc-input-full-border-select2 pT10",attrs:{"min-rows":1,type:"textarea",autosize:{minRows:1,maxRows:1},placeholder:_vm.$t("rule.faultToWorkorder.enter_commands"),reseize:"none"},model:{value:_vm.workflowRule.comments.create,callback:function($$v){_vm.$set(_vm.workflowRule.comments,"create",$$v)},expression:"workflowRule.comments.create"}}):_vm._e()],1)],1),_c("div",[_c("div",{staticClass:"mT40"},[_c("el-checkbox",{model:{value:_vm.workflowRule.isRecommendationAsTask,callback:function($$v){_vm.$set(_vm.workflowRule,"isRecommendationAsTask",$$v)},expression:"workflowRule.isRecommendationAsTask"}},[_vm._v(_vm._s(_vm.$t("rule.faultToWorkorder.fault_to_workorder_task")))])],1),_c("div",{staticClass:"mT40"},[_c("el-checkbox",{model:{value:_vm.workflowRule.isPossibleCauseAsDesc,callback:function($$v){_vm.$set(_vm.workflowRule,"isPossibleCauseAsDesc",$$v)},expression:"workflowRule.isPossibleCauseAsDesc"}},[_vm._v(_vm._s(_vm.$t("rule.faultToWorkorder.fault_to_workorder_desc")))])],1)]),_c("div",[_c("div",{staticClass:"pT30 switch-align"},[_c("div",[_c("p",{staticClass:"form-item bold "},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.skip_creation"))+" ")])]),_c("div",[_c("el-switch",{on:{change:_vm.skipactions},model:{value:_vm.workflowRule.isSkip,callback:function($$v){_vm.$set(_vm.workflowRule,"isSkip",$$v)},expression:"workflowRule.isSkip"}})],1)]),_vm.workflowRule.isSkip?_c("div",[_c("el-row",[_c("el-col",{staticClass:"utility-block fc-id cpointer f14 pL5 pT10",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("common._common.criteria"))+" ")]),_c("div",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.skip_criteria"))+" ")]),_c("CriteriaBuilder",{key:"criteria-woCreation",staticClass:"pB20 pR75 ",attrs:{moduleName:_vm.actionModule,disabled:!_vm.workflowRule.isSkip},model:{value:_vm.workflowRule.woCriteria,callback:function($$v){_vm.$set(_vm.workflowRule,"woCriteria",$$v)},expression:"workflowRule.woCriteria"}})],1)],1),_c("div",{staticClass:"mT40"},[_c("el-checkbox",{attrs:{disabled:!_vm.workflowRule.isSkip},on:{change:function($event){_vm.skipComment=!_vm.skipComment}},model:{value:_vm.includeCommentsOnSkip,callback:function($$v){_vm.includeCommentsOnSkip=$$v},expression:"includeCommentsOnSkip"}},[_vm._v(_vm._s(_vm.$t("rule.faultToWorkorder.include_commands")))])],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_vm.skipComment?_c("el-input",{staticClass:"fc-input-full-border-select2 pT10",attrs:{"min-rows":1,type:"textarea",autosize:{minRows:1,maxRows:1},placeholder:_vm.$t("rule.faultToWorkorder.enter_commands"),reseize:"none"},model:{value:_vm.workflowRule.comments.skip,callback:function($$v){_vm.$set(_vm.workflowRule.comments,"skip",$$v)},expression:"workflowRule.comments.skip"}}):_vm._e()],1)],1)],1):_vm._e()])],1),_c("div",[_c("div",{staticClass:"pT20 switch-align"},[_c("div",[_c("p",{staticClass:"form-item bold "},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.auto_close_wo"))+" ")])]),_c("div",[_c("el-switch",{model:{value:_vm.closeWorkflowRule.status,callback:function($$v){_vm.$set(_vm.closeWorkflowRule,"status",$$v)},expression:"closeWorkflowRule.status"}})],1)]),_c("el-row",[_c("el-col",{staticClass:"utility-block pT20 fc-id bold pointer f14 pL5 ",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.execute_on"))+" ")]),_c("p",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.define_execute"))+" ")]),_c("el-form-item",{attrs:{prop:"activityType"}},[_c("el-select",{staticClass:"width100 fc-input-full-border-select2",attrs:{placeholder:"Select",disabled:!_vm.closeWoStatus},model:{value:_vm.closeEvent.activityType,callback:function($$v){_vm.$set(_vm.closeEvent,"activityType",$$v)},expression:"closeEvent.activityType"}},_vm._l(_vm.closeWoActivityType,(function(type,index){return _c("el-option",{key:index,attrs:{label:type.label,value:type.value}})})),1)],1)],1)],1),"Field Change"===_vm.closeActivityType?_c("FaultToWoFields",{attrs:{workflowRule:_vm.closeWorkflowRule,module:_vm.moduleName,isEdit:_vm.isEdit},on:{selectedFields:_vm.addCloseWoFields}}):_vm._e(),"On Date"===_vm.closeActivityType?_c("SchedulerForRuleWo",{attrs:{moduleFields:_vm.moduleFields,module:_vm.moduleName,workflowRule:_vm.closeWorkflowRule,isEdit:_vm.isEdit},on:{schedulerFields:_vm.addClosedateField}}):_vm._e(),_c("el-row",[_c("el-col",{staticClass:"utility-block fc-id cpointer f14 pL5 pT10",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("common._common.criteria"))+" ")]),_c("div",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.close_criteria"))+" ")]),_c("CriteriaBuilder",{key:"criteria-closeWoCriteria",staticClass:"pB20 pR75 ",attrs:{moduleName:_vm.actionModule,disabled:!_vm.closeWoStatus},model:{value:_vm.closeWoCriteria,callback:function($$v){_vm.closeWoCriteria=$$v},expression:"closeWoCriteria"}})],1)],1),_c("el-row",[_c("el-col",{staticClass:"utility-block fc-id bold pointer f14 pL5 pT10",attrs:{span:24}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.approvalprocess.action"))+" ")]),_c("p",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("rule.faultToWorkorder.workorder_status"))+" ")]),_c("el-form-item",{attrs:{prop:"Actions"}},[_c("el-select",{staticClass:"width100 fc-input-full-border-select2",attrs:{placeholder:"Select",disabled:!_vm.closeWoStatus},model:{value:_vm.closeWoAction.templateJson.new_state,callback:function($$v){_vm.$set(_vm.closeWoAction.templateJson,"new_state",$$v)},expression:"closeWoAction.templateJson.new_state"}},_vm._l(_vm.statusList,(function(status,index){return _c("el-option",{key:index,attrs:{label:status.label,value:status.value}})})),1)],1)],1)],1),_c("div",{staticClass:"mT40"},[_c("el-checkbox",{attrs:{disabled:!_vm.closeWoStatus},on:{change:function($event){_vm.closeComment=!_vm.closeComment}},model:{value:_vm.includeCloseComments,callback:function($$v){_vm.includeCloseComments=$$v},expression:"includeCloseComments"}},[_vm._v(_vm._s(_vm.$t("rule.faultToWorkorder.include_commands")))])],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_vm.closeComment?_c("el-input",{staticClass:"fc-input-full-border-select2 pT10",attrs:{"min-rows":1,type:"textarea",autosize:{minRows:1,maxRows:1},placeholder:_vm.$t("rule.faultToWorkorder.enter_commands"),reseize:"none",disabled:!_vm.closeWoStatus},model:{value:_vm.closeWorkflowRule.comments.close,callback:function($$v){_vm.$set(_vm.closeWorkflowRule.comments,"close",$$v)},expression:"closeWorkflowRule.comments.close"}}):_vm._e()],1)],1)],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeForm()}}},[_vm._v(_vm._s(_vm.$t("setup.users_management.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.isloading},on:{click:_vm.saveForm}},[_vm._v(_vm._s(_vm.isloading?_vm.$t("maintenance._workorder.saving"):_vm.$t("maintenance._workorder.save")))])],1)])],1)]],2)],1)},RuleWorkOrderFormvue_type_template_id_043236d6_staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),toConsumableArray=__webpack_require__(488478),slicedToArray=__webpack_require__(554621),objectSpread2=__webpack_require__(595082),dist=(__webpack_require__(538077),__webpack_require__(336585),__webpack_require__(162506),__webpack_require__(654564),__webpack_require__(90385),__webpack_require__(191853)),vuex_esm=__webpack_require__(420629),picklist=__webpack_require__(961358),FaultToWoFieldsvue_type_template_id_7f3301ec_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"approve-form-item"},[_c("el-form-item",{staticClass:"fc-tag p0 pL10 pR10",attrs:{prop:"activityType"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.header.field"))+" "+_vm._s(_vm.selectedFields.length>0?"("+_vm.selectedFields.length+")":"")+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width50",attrs:{"multiple-limit":3,multiple:"","collapse-tags":"",placeholder:"Select"},on:{change:_vm.addFields},model:{value:_vm.selectedFields,callback:function($$v){_vm.selectedFields=$$v},expression:"selectedFields"}},_vm._l(_vm.moduleFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1),_vm.selectedFields.length<3?_c("el-button",{staticClass:"all-rule-btn",attrs:{slot:"reference"},slot:"reference"},[_c("img",{staticClass:"mL10",attrs:{src:__webpack_require__(353654)}})]):_vm._e()],1)],1)},FaultToWoFieldsvue_type_template_id_7f3301ec_staticRenderFns=[],FaultToWoFieldsvue_type_script_lang_js=(__webpack_require__(450886),{data:function(){return{selectedFields:[],metaInfo:{}}},mounted:function(){this.getMetaFields()},created:function(){var _this=this,_ref=this||{},isEdit=_ref.isEdit;if(isEdit){var _ref2=this||{},workflowRule=_ref2.workflowRule,_ref3=workflowRule||{},fields=_ref3.fields;(0,validation/* isEmpty */.xb)(fields)||fields&&(this.selectedFieldObject=[],fields.map((function(d){_this.selectedFields.push(parseInt(d.fieldId))})),this.$emit("selectedFields",fields))}},props:["workflowRule","module","isEdit"],computed:{moduleFields:function(){return this.$getProperty(this.metaInfo,"fields",null)}},methods:{getMetaFields:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var module,url,_yield$API$get,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(module=_this2.module,!module){_context.next=8;break}return url="/module/meta?moduleName=".concat(module),_context.next=5,api/* API */.bl.get(url,{module:module});case 5:_yield$API$get=_context.sent,data=_yield$API$get.data,_this2.metaInfo=data.meta;case 8:case"end":return _context.stop()}}),_callee)})))()},addFields:function(){var _ref4=this||{},selectedFields=_ref4.selectedFields,fields=[];selectedFields.forEach((function(d){fields.push({fieldId:d})})),this.$emit("selectedFields",fields)}}}),rule_FaultToWoFieldsvue_type_script_lang_js=FaultToWoFieldsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(rule_FaultToWoFieldsvue_type_script_lang_js,FaultToWoFieldsvue_type_template_id_7f3301ec_render,FaultToWoFieldsvue_type_template_id_7f3301ec_staticRenderFns,!1,null,null,null)
/* harmony default export */,FaultToWoFields=component.exports,SchedulerForRuleWovue_type_template_id_5eaad7d8_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-row",{attrs:{prop:"workflowRule"}},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.dateField"))+" ")]),_c("el-select",{staticClass:"width300px",attrs:{placeholder:"Select"},model:{value:_vm.scheduleObj.dateFieldId,callback:function($$v){_vm.$set(_vm.scheduleObj,"dateFieldId",$$v)},expression:"scheduleObj.dateFieldId"}},_vm._l(_vm.filteredDateFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1)],1),_c("el-col",{staticClass:"pL40",attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.scheduled_type"))+" ")]),_c("el-radio-group",{staticClass:"criteria-radio-label",model:{value:_vm.scheduleObj.scheduleType,callback:function($$v){_vm.$set(_vm.scheduleObj,"scheduleType",$$v)},expression:"scheduleObj.scheduleType"}},[_vm.beforeFieldIds.includes(_vm.scheduleObj.dateFieldId)?_vm._e():_c("el-radio",{key:1,staticClass:"fc-radio-btn",attrs:{label:1}},[_vm._v("Before")]),_c("el-radio",{key:2,staticClass:"fc-radio-btn",attrs:{label:2}},[_vm._v("On ")]),_c("el-radio",{key:3,staticClass:"fc-radio-btn",attrs:{label:3}},[_vm._v("After ")])],1)],1)],1),_c("el-row",{staticClass:"mT30"},[[1,3].includes(parseInt(_vm.scheduleObj.scheduleType))?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Days")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:"",placeholder:"Select"},model:{value:_vm.scheduleObj.dateObject.days,callback:function($$v){_vm.$set(_vm.scheduleObj.dateObject,"days",$$v)},expression:"scheduleObj.dateObject.days"}},_vm._l(60,(function(index){return _c("el-option",{key:"days-"+index,attrs:{label:index,value:index}})})),1)],1),_vm.checkDateTimeField?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Hours")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:""},model:{value:_vm.scheduleObj.dateObject.hours,callback:function($$v){_vm.$set(_vm.scheduleObj.dateObject,"hours",$$v)},expression:"scheduleObj.dateObject.hours"}},_vm._l(_vm.$constants.HOURS,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1),_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Mins")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{placeholder:"Select"},model:{value:_vm.scheduleObj.dateObject.minute,callback:function($$v){_vm.$set(_vm.scheduleObj.dateObject,"minute",$$v)},expression:"scheduleObj.dateObject.minute"}},_vm._l(_vm.$constants.MINUTES,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1)]:_vm._e()]:_vm._e(),_vm.checkDateTimeField?_vm._e():_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Time")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{"collapse-tags":""},model:{value:_vm.scheduleObj.time,callback:function($$v){_vm.$set(_vm.scheduleObj,"time",$$v)},expression:"scheduleObj.time"}},_vm._l(_vm.timesOption,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1)],2)],1)},SchedulerForRuleWovue_type_template_id_5eaad7d8_staticRenderFns=[],utils_field=(__webpack_require__(634338),__webpack_require__(843843),__webpack_require__(815872)),SchedulerForRuleWovue_type_script_lang_js={props:["moduleFields","workflowRule","isEdit"],data:function(){return{dateFieldToExclude:["sysCreatedTime","sysModifiedTime","sysDeletedTime"],beforeDateFieldsToExclude:["createdTime","modifiedTime"],dateFieldName:["DATE","DATE_TIME"],metaInfo:{},scheduleObj:{time:null,scheduleType:3,dateFieldId:null,dateObject:{days:null,minute:0,hours:0,minu:null}}}},watch:{scheduleObj:{handler:function(){this.dateField()},deep:!0}},created:function(){var isEdit=this.isEdit;if(isEdit){var workflowRule=this.workflowRule,_ref=workflowRule||{},interval=_ref.interval,dateFieldId=this.dateFieldsCheck(workflowRule,interval);this.$setProperty(this,"scheduleObj.dateFieldId",dateFieldId),this.$setProperty(this,"scheduleObj.scheduleType",workflowRule.scheduleType),this.dateField()}},computed:{checkDateTimeField:function(){var dateFields=this.dateFields,scheduleObj=this.scheduleObj,_ref2=scheduleObj||{},dateFieldId=_ref2.dateFieldId,field=(dateFields||[]).find((function(fld){return fld.fieldId===dateFieldId}))||{};return!(0,validation/* isEmpty */.xb)(field)&&(0,utils_field/* isDateTimeField */.K)(field)},filteredDateFields:function(){var fields=(0,toConsumableArray/* default */.Z)(this.dateFieldToExclude);return 1===this.scheduleType&&(fields=[].concat((0,toConsumableArray/* default */.Z)(fields),(0,toConsumableArray/* default */.Z)(this.beforeDateFieldsToExclude))),(this.dateFields||[]).filter((function(field){return!fields.includes(field.name)}))},dateFields:function(){var moduleFields=this.moduleFields,dateFieldName=this.dateFieldName;return(moduleFields||[]).filter((function(d){return(dateFieldName||[]).includes(d.dataTypeEnum._name)}))},beforeFieldIds:function(){var _this=this;return(this.dateFields||[]).filter((function(field){return(_this.beforeDateFieldsToExclude||[]).includes(field.name)})).map((function(field){return field.id}))}},methods:{dateFieldsCheck:function(rule,dateObj){var _ref3=rule||{},event=_ref3.event,dateFieldId=_ref3.dateFieldId,scheduleType=_ref3.scheduleType,_ref4=event||{},activityType=_ref4.activityType;if(524288===activityType&&!(0,validation/* isEmpty */.xb)(dateFieldId)){if(dateObj&&[1,3].includes(parseInt(scheduleType))){var dateObject=this.$helpers.secTodaysHoursMinu(dateObj);this.scheduleObj.dateObject=(0,objectSpread2/* default */.Z)({},dateObject)}return rule.dateFieldId}return this.dateObject={days:null,minute:0,hours:0,minu:null},null},dateField:function(){var scheduleObj=this.scheduleObj;this.$emit("schedulerFields",scheduleObj)}}},rule_SchedulerForRuleWovue_type_script_lang_js=SchedulerForRuleWovue_type_script_lang_js,SchedulerForRuleWo_component=(0,componentNormalizer/* default */.Z)(rule_SchedulerForRuleWovue_type_script_lang_js,SchedulerForRuleWovue_type_template_id_5eaad7d8_render,SchedulerForRuleWovue_type_template_id_5eaad7d8_staticRenderFns,!1,null,null,null)
/* harmony default export */,SchedulerForRuleWo=SchedulerForRuleWo_component.exports,NewCustomTypeRule=__webpack_require__(991326),RuleWorkOrderFormvue_type_script_lang_js={components:{CriteriaBuilder:dist/* CriteriaBuilder */.IP,FaultToWoFields:FaultToWoFields,SchedulerForRuleWo:SchedulerForRuleWo},extends:NewCustomTypeRule/* default */.Z,props:["visibility","modules","moduleName","ruleId","rulename","isEdit","details","activityTypes"],data:function(){return{errorMessage:"",error:"",isloading:!1,comments:null,closeEvent:{moduleName:"newreadingalarm",activityType:2048},wofields:[],closefields:[],templates:[],woModuleFields:[],status:!0,updateComments:null,woStatus:!0,statusActions:[],alarmWo:{actionType:11,templateJson:{formId:null,fieldMatcher:[]}},closeWoAction:{actionType:12,templateJson:{new_state:null}},workflowRule:{scheduleType:3,ruleType:48,event:{moduleName:"newreadingalarm",activityType:549755813888},actions:[],status:!0,name:null,fields:[],interval:null,dateFieldId:-1,woCriteria:null,comments:{create:null,skip:null},isSkip:!1,id:null,isRecommendationAsTask:!0,isPossibleCauseAsDesc:!0},includeComments:!0,includeCommentsOnSkip:!0,closeWoCriteria:null,woFormFields:[],picklistOptions:{},assets:null,fields:[],categoryMetric:null,closeWorkflowRule:{name:"",scheduleType:3,ruleType:48,fields:[],interval:null,dateFieldId:-1,actions:[],comments:{close:null},woCriteria:{},status:!0,id:null},includeCloseComments:!0,reqWoFields:[],optionalWoFields:[],closeWoFields:[],dateFieldToExclude:["sysCreatedTime","sysModifiedTime","sysDeletedTime"],beforeDateFieldsToExclude:["createdTime","modifiedTime"],dateFieldName:["DATE","DATE_TIME"],metaInfo:{},dateObject:{days:null,minute:0,hours:0,minu:null},statusList:[],closeState:null,loading:!1}},created:function(){this.fetchMetaFields(),this.$store.dispatch("loadTicketStatus",this.actionModule),this.$store.dispatch("loadTicketCategory"),this.$store.dispatch("loadTicketPriority"),this.$store.dispatch("loadAssetCategory"),this.$store.dispatch("loadGroups")},mounted:function(){this.init()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({users:function(state){return state.users},groups:function(state){return state.groups},ticketcategory:function(state){return state.ticketCategory},assetCategory:function(state){return state.assetCategory},ticketpriority:function(state){return state.ticketPriority}})),(0,vuex_esm/* mapGetters */.Se)(["getTicketStatusPickList"])),{},{alarmFieldMatcher:function(){var alarmWo=this.alarmWo,_alarmWo$templateJson=alarmWo.templateJson,templateJson=void 0===_alarmWo$templateJson?{}:_alarmWo$templateJson,_templateJson$fieldMa=templateJson.fieldMatcher,fieldMatcher=void 0===_templateJson$fieldMa?[]:_templateJson$fieldMa;return fieldMatcher},closeActivityType:function(){var activityTypes=this.activityTypes,_this$closeEvent=this.closeEvent,closeEvent=void 0===_this$closeEvent?{}:_this$closeEvent,_ref=closeEvent||{},activityType=_ref.activityType,activity=[];return activityTypes&&(activity=activityTypes.filter((function(types){return types.value===activityType}))),activity[0].label},activityType:function(){var activityTypes=this.activityTypes,workflowRule=this.workflowRule,_ref2=workflowRule||{},event=_ref2.event,_ref3=event||{},activityType=_ref3.activityType,activity=[];return activityTypes&&(activity=activityTypes.filter((function(types){return types.value===activityType}))),activity[0].label},closeWoStatus:function(){var _this$closeWorkflowRu=this.closeWorkflowRule,closeWorkflowRule=void 0===_this$closeWorkflowRu?{}:_this$closeWorkflowRu,status=closeWorkflowRule.status;return status},skipComment:function(){var includeCommentsOnSkip=this.includeCommentsOnSkip;return includeCommentsOnSkip},createComment:function(){var includeComments=this.includeComments;return includeComments},closeComment:function(){var includeCloseComments=this.includeCloseComments;return includeCloseComments},createWoActivityType:function(){var _ref4=this||{},activityTypes=_ref4.activityTypes,activity=[];return activityTypes&&(activity=activityTypes.filter((function(types){return 2048!==types.value}))),activity},moduleFields:function(){return this.$getProperty(this.metaInfo,"fields",null)},closeWoActivityType:function(){var _ref5=this||{},activityTypes=_ref5.activityTypes,activity=[];return activityTypes&&(activity=activityTypes.filter((function(types){return 549755813888!==types.value}))),activity},actionModule:function(){return"workorder"},formId:function(){var _ref6=this||{},alarmWo=_ref6.alarmWo,_ref7=alarmWo||{},templateJson=_ref7.templateJson,_ref8=templateJson||{},formId=_ref8.formId;return(0,validation/* isEmpty */.xb)(formId)?null:formId},fieldMatch:function(){var alarmWo=this.alarmWo,templateJson=alarmWo.templateJson,fieldMatcher=templateJson.fieldMatcher;return fieldMatcher}}),methods:{lookupCondition:function(fieldMatcher){var fieldObj=fieldMatcher.fieldObj,_ref9=fieldObj||{},displayType=_ref9.displayType,dataTypeEnum=_ref9.dataTypeEnum;return"LOOKUP"===dataTypeEnum||"LOOKUP_SIMPLE"===displayType},pickList:function(fieldMatcher){var field=fieldMatcher.field,_this$picklistOptions=this.picklistOptions,picklistOptions=void 0===_this$picklistOptions?{}:_this$picklistOptions;return picklistOptions[field]},dataTypeEnum:function(fieldMatcher){var fieldObj=fieldMatcher.fieldObj,_ref10=fieldObj||{},dataTypeEnum=_ref10.dataTypeEnum;return dataTypeEnum},getMetaFields:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var module,url,_yield$API$get,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(module=_this.module,!module){_context.next=8;break}return url="/module/meta?moduleName=".concat(module),_context.next=5,api/* API */.bl.get(url,{module:module});case 5:_yield$API$get=_context.sent,data=_yield$API$get.data,_this.metaInfo=data.meta;case 8:case"end":return _context.stop()}}),_callee)})))()},woStatusList:function(){for(var _this$closeState$,closeWoAction=this.closeWoAction,statusList=this.statusList,isEdit=this.isEdit,templateJson=closeWoAction.templateJson,_i=0,_Object$entries=Object.entries(this.getTicketStatusPickList("workorder"));_i<_Object$entries.length;_i++){var _Object$entries$_i=(0,slicedToArray/* default */.Z)(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1],data={label:value,value:key};statusList.push(data)}(this.closeState=statusList.filter((function(state){return"Closed"===state.label})),isEdit)||this.$set(templateJson,"new_state",null===(_this$closeState$=this.closeState[0])||void 0===_this$closeState$?void 0:_this$closeState$.value)},init:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this2.loading=!0,_context2.next=3,_this2.loadWoTemplates("workorder");case 3:return _this2.woStatusList(),_this2.addRowWO(),_context2.next=7,_this2.initPrefill();case 7:return _context2.next=9,_this2.getMetaFields();case 9:_this2.skipactions(),_this2.loading=!1;case 11:case"end":return _context2.stop()}}),_callee2)})))()},initPrefill:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var isEdit;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(isEdit=_this3.isEdit,!isEdit){_context3.next=4;break}return _context3.next=4,_this3.prefill();case 4:case"end":return _context3.stop()}}),_callee3)})))()},changeDataType:function(criteria){var _ref11=criteria||{},fieldObj=_ref11.fieldObj,dateObject=_ref11.dateObject,valueArray=_ref11.valueArray,_ref12=fieldObj||{},dataTypeEnum=_ref12.dataTypeEnum;if(["DATE_TIME","DATE"].includes(dataTypeEnum)){if(dateObject){var interval=this.$helpers.daysHoursMinuToSec(dateObject);criteria.value=1e3*interval}}else valueArray&&(criteria.value={id:valueArray});this.$forceUpdate()},statusFieldName:function(selectedField,index){var _ref13=selectedField||{},field=_ref13.field,alarmWo=this.alarmWo,picklistOptions=this.picklistOptions,_ref14=alarmWo||{},templateJson=_ref14.templateJson,_ref15=templateJson||{},fieldMatcher=_ref15.fieldMatcher;if(!(0,validation/* isEmpty */.xb)(field)){var fld=this.woFormFields.filter((function(field){return field.name===selectedField.field}));if(fieldMatcher[index].field=selectedField.field,fieldMatcher[index].fieldObj=fld[0].field,fieldMatcher[index].isSpacePicker=!1,fieldMatcher[index].columnName=fld[0].field.completeColumnName,!(0,validation/* isEmpty */.xb)(fld)){var _ref16=fld[0]||{},_field=_ref16.field,lookupModuleName=_ref16.lookupModuleName,name=_ref16.name,_ref17=_field||{},dataTypeEnum=_ref17.dataTypeEnum,specialType=_ref17.specialType,lookupModule=_ref17.lookupModule;if("site"===lookupModuleName&&(this.$set(fieldMatcher[index].fieldObj,"dataTypeEnum","LOOKUP"),this.loadPickList(lookupModuleName,"siteId")),"ENUM"===dataTypeEnum&&this.$set(picklistOptions,_field.name,_field.enumMap),"LOOKUP"===dataTypeEnum&&specialType)this.loadSpecialTypePickList(specialType,name);else if("LOOKUP"===dataTypeEnum&&lookupModule)if("ticketstatus"===lookupModule.name)this.$set(picklistOptions,name,this.getTicketStatusPickList(this.module));else if("ticketpriority"===lookupModule.name){var priority={};this.ticketpriority.forEach((function(d){priority[d.id]=d.displayName})),this.$set(picklistOptions,name,priority)}else this.loadPickList(lookupModule.name,name)}}},skipactions:function(){var closeWorkflowRule=this.closeWorkflowRule,status=closeWorkflowRule.status;this.$set(this,"includeCloseComments",status)},addRowWO:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var alarmWo,_ref18,templateJson,_ref19,fieldMatcher;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:alarmWo=_this4.alarmWo,_ref18=alarmWo||{},templateJson=_ref18.templateJson,_ref19=templateJson||{},fieldMatcher=_ref19.fieldMatcher,fieldMatcher.push({field:"",isSpacePicker:!1,value:null,parseLabel:null,valueArray:null,dateObject:{},fieldObj:null});case 4:case"end":return _context4.stop()}}),_callee4)})))()},fetchMetaFields:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var moduleName,_yield$API$get2,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return moduleName=_this5.module,_context5.next=3,api/* API */.bl.get("/module/metafields",{moduleName:moduleName});case 3:_yield$API$get2=_context5.sent,data=_yield$API$get2.data,_this5.fields=_this5.$getProperty(data,"meta.fields",[]);case 6:case"end":return _context5.stop()}}),_callee5)})))()},loadCategoryMetric:function(id){var _this6=this;this.$util.loadAssetReadingFields(-1,id).then((function(fields){_this6.categoryMetric=fields})),this.$util.loadAsset({withReadings:!0,categoryId:id}).then((function(response){var _this6$assets;_this6.assets=[],_this6.assets.push({id:"${workorder.resource.id}",name:"Current Asset"}),(_this6$assets=_this6.assets).push.apply(_this6$assets,(0,toConsumableArray/* default */.Z)(response.assets))}))},prefill:function(){var _this7=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var _ref20,details,_ref21,workOrderCreation,_ref22,closeWo,workflowRule,_ref23,formId,i,alarmWo,templateJson,fieldMatcher,closeWoAction,closeWorkflowRule,_ref24,woCriteria;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:if(_ref20=_this7||{},details=_ref20.details,_ref21=details||{},workOrderCreation=_ref21.woCreation,_ref22=details||{},closeWo=_ref22.closeWo,(0,validation/* isEmpty */.xb)(workOrderCreation)){_context6.next=17;break}return workflowRule=_this7.$getProperty(details,"woCreation"),_this7.$set(_this7,"workflowRule",workflowRule),_this7.dateObj=_this7.$getProperty(workOrderCreation,"interval"),_this7.alarmWo.templateJson=_this7.$getProperty(workOrderCreation.actions[0].template,"originalTemplate"),_this7.$set(workOrderCreation,"status",!0),_ref23=_this7||{},formId=_ref23.formId,_context6.next=12,_this7.loadWOFormFields(formId,!1);case 12:i=0,alarmWo=_this7.alarmWo,templateJson=alarmWo.templateJson,fieldMatcher=templateJson.fieldMatcher,fieldMatcher.forEach((function(field){_this7.statusFieldName(field,i),i++}));case 17:(0,validation/* isEmpty */.xb)(closeWo)||(closeWoAction=_this7.closeWoAction,closeWorkflowRule=_this7.$getProperty(details,"closeWo"),_this7.$set(_this7,"closeWorkflowRule",closeWorkflowRule),_ref24=closeWo||{},woCriteria=_ref24.woCriteria,_this7.$set(_this7,"closeWoCriteria",woCriteria),_this7.$set(closeWoAction,"templateJson",closeWo.actions[0].template.additionInfo),_this7.closeEvent.activityType=_this7.$getProperty(closeWo.event,"activityType"));case 18:case"end":return _context6.stop()}}),_callee6)})))()},deleteAction:function(idx){this.workflowRule.actions.splice(idx,1),this.closeWorkflowRule.actions.splice(idx,1)},serializeData:function(){var _ref25=this||{},rulename=_ref25.rulename,_this$workflowRule=this.workflowRule,workflowRule=void 0===_this$workflowRule?{}:_this$workflowRule,_this$closeWorkflowRu2=this.closeWorkflowRule,closeWorkflowRule=void 0===_this$closeWorkflowRu2?{}:_this$closeWorkflowRu2;if(this.$set(workflowRule,"name",rulename),this.$set(closeWorkflowRule,"name",rulename),this.setAction(),!this.validateForm(workflowRule))return!1;if(delete workflowRule.commentsJsonStr,delete closeWorkflowRule.commentsJsonStr,(0,validation/* isEmpty */.xb)(this.closeWoCriteria)&&this.setDefaultCloseCriteria(),closeWorkflowRule=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},closeWorkflowRule),{},{woCriteria:this.closeWoCriteria}),!this.validateForm(this.closeWorkflowRule))return!1;var ruleWoData={woCreation:workflowRule,closeWo:closeWorkflowRule};return ruleWoData},setDefaultCloseCriteria:function(){var closeState=this.closeState,criteria={conditions:{1:{fieldName:"moduleState",operatorId:37,value:closeState[0].value}},pattern:"( 1 )"};this.$set(this,"closeWoCriteria",criteria)},setAction:function(){var _this8=this,_ref26=this||{},workflowRule=_ref26.workflowRule,alarmWo=_ref26.alarmWo,isEdit=this.isEdit;if(isEdit&&this.deleteAction(0),!(0,validation/* isEmpty */.xb)(alarmWo)){var _ref27=workflowRule||{},actions=_ref27.actions,event=_ref27.event,templateJson=alarmWo.templateJson,fieldMatcher=templateJson.fieldMatcher;fieldMatcher.forEach((function(d){(0,validation/* isEmpty */.xb)(d.fieldObj)||_this8.$set(d,"fieldObj",null)})),actions.push(alarmWo),this.$set(workflowRule,"activityType",event.activityType)}if(!(0,validation/* isEmpty */.xb)(this.closeWorkflowRule)){var _ref28=this||{},closeWorkflowRule=_ref28.closeWorkflowRule,closeWoFields=_ref28.closeWoFields,_ref29=closeWorkflowRule||{},_actions=_ref29.actions,_ref30=this||{},closeEvent=_ref30.closeEvent;_actions.push(this.closeWoAction),this.$set(this.closeWorkflowRule,"event",closeEvent),this.$set(this.closeWorkflowRule,"activityType",closeEvent.activityType),this.closeWorkflowRule=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},closeWorkflowRule),{},{fields:closeWoFields})}},checkComments:function(){var closeComment=this.closeComment,createComment=this.createComment,skipComment=this.skipComment,closeWorkflowRule=this.closeWorkflowRule,workflowRule=this.workflowRule;skipComment||this.$set(workflowRule,"comments.skip",null),createComment||this.$set(workflowRule,"comments.create",null),closeComment||this.$set(closeWorkflowRule,"comments.close",null)},addCloseWoFields:function(selectedFields){var fields=[];selectedFields.forEach((function(d){fields.push(d)})),this.$set(this,"closeWoFields",fields)},addWoCreationFields:function(selectedFields){var _ref31=this||{},workflowRule=_ref31.workflowRule;this.workflowRule=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},workflowRule),{},{fields:selectedFields})},saveForm:function(){var _this9=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee7(){var _ref32,isEdit,ruleWoData;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context7){while(1)switch(_context7.prev=_context7.next){case 0:_ref32=_this9||{},isEdit=_ref32.isEdit,_this9.isloading=!0,ruleWoData=_this9.serializeData(),_this9.checkComments(),ruleWoData&&(isEdit?_this9.updateRuleWorkOrder(ruleWoData):_this9.addRuleWorkOrder(ruleWoData));case 5:case"end":return _context7.stop()}}),_callee7)})))()},closeForm:function(){this.$emit("close"),this.$emit("update:visibility",!1),this.$emit("loadPage")},updateRuleWorkOrder:function(ruleWoData){var _this10=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee8(){var url,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context8){while(1)switch(_context8.prev=_context8.next){case 0:return url="v3/readingrule/actions/updateRuleWo",_context8.next=3,api/* API */.bl.post(url,{faultToWorkorder:ruleWoData,ruleId:_this10.ruleId});case 3:_yield$API$post=_context8.sent,error=_yield$API$post.error,_yield$API$post.data,error?(_this10.isloading=!1,_this10.$message.error("Error Occured")):(_this10.closeForm(),_this10.$message.success("WorkOrderForm Updated"));case 7:case"end":return _context8.stop()}}),_callee8)})))()},addRuleWorkOrder:function(ruleWoData){var _this11=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee9(){var url,_yield$API$post2,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context9){while(1)switch(_context9.prev=_context9.next){case 0:return url="v3/readingrule/actions/addRuleWo",_context9.next=3,api/* API */.bl.post(url,{faultToWorkorder:ruleWoData,ruleId:_this11.ruleId});case 3:_yield$API$post2=_context9.sent,error=_yield$API$post2.error,_yield$API$post2.data,error?(_this11.isloading=!1,_this11.$message.error("Error Occured")):(_this11.closeForm(),_this11.$message.success("WorkOrder Form Configured"));case 7:case"end":return _context9.stop()}}),_callee9)})))()},loadWoTemplates:function(moduleName){var _this12=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee10(){var alarmWo,isEdit,url,_yield$API$get3,data,error,message,_ref33,_ref33$forms,forms,form;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context10){while(1)switch(_context10.prev=_context10.next){case 0:return _this12.loadWoFields(moduleName),alarmWo=_this12.alarmWo,isEdit=_this12.isEdit,url="/v2/forms?moduleName=".concat(moduleName),_this12.isLoading=!0,_context10.next=6,api/* API */.bl.get(url);case 6:_yield$API$get3=_context10.sent,data=_yield$API$get3.data,error=_yield$API$get3.error,error?(message=error.message,_this12.$message.error(message)):(_ref33=data||{},_ref33$forms=_ref33.forms,forms=void 0===_ref33$forms?[]:_ref33$forms,_this12.$set(_this12,"templates",forms),form=_this12.$getProperty(_this12,"templates.0.id",null),isEdit||(_this12.$setProperty(alarmWo.templateJson,"formId",form),_this12.loadWOFormFields(form,!0)));case 10:case"end":return _context10.stop()}}),_callee10)})))()},loadSpecialTypePickList:function(specialType,fieldName){var pickOption={},store=this.$store.state;if("users"===specialType){var users=store.users,userList=users;pickOption["${LOGGED_USER}"]="Current User";var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(userList);try{for(_iterator.s();!(_step=_iterator.n()).done;){var user=_step.value;pickOption[user.id]=user.name}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.$set(this.picklistOptions,fieldName,pickOption)}else if("groups"===specialType){var _step2,groups=store.groups,groupList=groups,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(groupList);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var group=_step2.value;pickOption[group.groupId]=group.name}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}this.$set(this.picklistOptions,fieldName,pickOption)}else if("basespace"===specialType){var _step3,spaces=store.spaces,spaceList=spaces,_iterator3=(0,createForOfIteratorHelper/* default */.Z)(spaceList);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var space=_step3.value;pickOption[space.id]=space.name}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}this.$set(this.picklistOptions,fieldName,pickOption)}else"alarmType"===specialType?this.$set(this.picklistOptions,fieldName,this.$constants.AlarmCategory):"sourceType"===specialType&&this.$set(this.picklistOptions,fieldName,this.$constants.SourceType)},loadPickList:function(moduleName,fieldName){var _this13=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee11(){var _yield$getFieldOption,error,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context11){while(1)switch(_context11.prev=_context11.next){case 0:return _context11.next=2,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:moduleName,skipDeserialize:!0}});case 2:_yield$getFieldOption=_context11.sent,error=_yield$getFieldOption.error,options=_yield$getFieldOption.options,error?_this13.$message.error(error.message||"Error Occured"):_this13.$set(_this13.picklistOptions,fieldName,options);case 6:case"end":return _context11.stop()}}),_callee11)})))()},loadWOFormFields:function(formId,change){var _this14=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee12(){var url,_yield$API$get4,data,error,message,_ref34,form,_ref35,fields;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context12){while(1)switch(_context12.prev=_context12.next){case 0:if(!(formId>0)){_context12.next=17;break}return url="/v2/forms/workorder?formId=".concat(formId),_context12.next=4,api/* API */.bl.get(url);case 4:if(_yield$API$get4=_context12.sent,data=_yield$API$get4.data,error=_yield$API$get4.error,!error){_context12.next=12;break}message=error.message,_this14.$message.error(message),_context12.next=17;break;case 12:return _ref34=data||{},form=_ref34.form,_ref35=form||{},fields=_ref35.fields,_this14.woFormFields=(fields||[]).flatMap((function(fld){return(0,validation/* isEmpty */.xb)(fld.field)||"siteId"===fld.name?[]:fld})),_context12.next=17,_this14.filterWoFormFields(change);case 17:case"end":return _context12.stop()}}),_callee12)})))()},filterWoFormFields:function(change){var _this15=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee13(){var _ref36,woFormFields,alarmWo,templateJson,fieldMatcher,i;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context13){while(1)switch(_context13.prev=_context13.next){case 0:_ref36=_this15||{},woFormFields=_ref36.woFormFields,_this15.reqWoFields=woFormFields.filter((function(fld){return!0===fld.required})),_this15.optionalWoFields=woFormFields.filter((function(fld){return!1===fld.required})),_this15.reqWoFields&&(alarmWo=_this15.alarmWo,templateJson=alarmWo.templateJson,fieldMatcher=templateJson.fieldMatcher,change&&(i=0,fieldMatcher.splice(0,fieldMatcher.length),_this15.reqWoFields.forEach((function(d){(0,validation/* isEmpty */.xb)(d.name)||(_this15.addRowWO(),_this15.$set(fieldMatcher[i],"field",d.name),"subject"===d.name&&_this15.$set(fieldMatcher[i],"value","${newreadingalarm.subject}"),_this15.statusFieldName(fieldMatcher[i],i),++i)}))));case 4:case"end":return _context13.stop()}}),_callee13)})))()},disableFormFieldSelect:function(index){var reqWoFields=this.reqWoFields;return index<reqWoFields.length},loadWoFields:function(moduleName){var _this16=this;this.$util.loadFields(moduleName,!1).then((function(fields){_this16.woModuleFields=fields}))},deleteRow:function(index){this.alarmWo.templateJson.fieldMatcher.splice(index,1)},addWodateField:function(scheduleFields){var _ref37=scheduleFields||{},dateFieldId=_ref37.dateFieldId,scheduleType=_ref37.scheduleType,dateObject=_ref37.dateObject,checkDateTimeField=_ref37.checkDateTimeField,_ref38=this||{},workflowRule=_ref38.workflowRule;this.$set(workflowRule,"dateFieldId",dateFieldId),this.$set(workflowRule,"scheduleType",scheduleType),this.dateField(workflowRule,dateObject,checkDateTimeField)},addClosedateField:function(scheduleFields){var _ref39=scheduleFields||{},dateFieldId=_ref39.dateFieldId,scheduleType=_ref39.scheduleType,dateObject=_ref39.dateObject,checkDateTimeField=_ref39.checkDateTimeField,_ref40=this||{},closeWorkflowRule=_ref40.closeWorkflowRule;this.$set(closeWorkflowRule,"dateFieldId",dateFieldId),this.$set(closeWorkflowRule,"scheduleType",scheduleType),this.dateField(closeWorkflowRule,dateObject,checkDateTimeField)},dateField:function(workflowRule,dateObject,checkDateTimeField){workflowRule.interval=null;var closeEvent=this.closeEvent;524288!==closeEvent.activityType&&524288!==parseInt(workflowRule.event.activityType)||dateObject&&(workflowRule.dateFieldId&&(checkDateTimeField||(dateObject.hours=0,dateObject.minute=0)),1===workflowRule.scheduleType||3===workflowRule.scheduleType?workflowRule.interval=this.$helpers.daysHoursMinuToSec(dateObject):workflowRule.interval=null),workflowRule.dateFieldId||(delete workflowRule.dateFieldId,delete workflowRule.interval),workflowRule.dateFieldId&&this.checkDateTimeField&&(workflowRule.time=null)},dateFieldsCheck:function(rule,dateObj){if(524288===rule.event.activityType&&!(0,validation/* isEmpty */.xb)(rule.dateFieldId)){if(dateObj&&[1,3].includes(parseInt(rule.scheduleType))){var dateObject=this.$helpers.secTodaysHoursMinu(dateObj);this.dateObject=(0,objectSpread2/* default */.Z)({},dateObject)}return rule.dateFieldId}return this.dateObject={days:null,minute:0,hours:0,minu:null},null},validateWoFormFields:function(ruleData){this.error=!1;var validate=!0,reqWoFields=this.reqWoFields,_ref41=ruleData||{},actions=_ref41.actions,_actions$0$templateJs=actions[0].templateJson,templateJson=void 0===_actions$0$templateJs?{}:_actions$0$templateJs,fieldMatcher=templateJson.fieldMatcher;return reqWoFields.forEach((function(d){if("siteId"!==d.name){var _val$,val=fieldMatcher.filter((function(val){return d.name===val.field}));((0,validation/* isEmpty */.xb)(val[0])||(null===(_val$=val[0])||void 0===_val$||!_val$.value)&&(0,validation/* isEmpty */.xb)(val[0].value))&&(validate=!1)}})),validate},validateForm:function(ruleData){this.error=!1;var _ref42=ruleData||{},actions=_ref42.actions;if(524288===ruleData.event.activityType){if(!ruleData.dateFieldId)return this.isloading=!1,this.error=!0,this.errorMessage="Please select field for on date activity",!1;if(3===ruleData.scheduleType&&!ruleData.interval)return this.isloading=!1,this.error=!0,this.errorMessage="Please select duration",!1}else if(1048576===ruleData.event.activityType&&(!ruleData.fields||!ruleData.fields.length>0))return this.error=!0,this.isloading=!1,this.errorMessage="Please select atleast on field for field change activity",!1;return!(!(0,validation/* isEmpty */.xb)(actions[0].templateJson.fieldMatcher)&&!this.validateWoFormFields(ruleData))||(this.error=!0,this.isloading=!1,this.errorMessage="Please fill mandatory form fields",!1)}}},rule_RuleWorkOrderFormvue_type_script_lang_js=RuleWorkOrderFormvue_type_script_lang_js,RuleWorkOrderForm_component=(0,componentNormalizer/* default */.Z)(rule_RuleWorkOrderFormvue_type_script_lang_js,RuleWorkOrderFormvue_type_template_id_043236d6_render,RuleWorkOrderFormvue_type_template_id_043236d6_staticRenderFns,!1,null,null,null)
/* harmony default export */,RuleWorkOrderForm=RuleWorkOrderForm_component.exports,sortBy=__webpack_require__(189734),sortBy_default=__webpack_require__.n(sortBy),router=__webpack_require__(329435),NewRulesSummaryvue_type_script_lang_js={components:{Page:PageBuilder/* default */.Z,HistoricalRun:HistoricalRunDialog/* default */.Z,RuleWorkOrderForm:RuleWorkOrderForm},mounted:function(){this.loadRuleDetails(),this.loadModuleMeta()},data:function(){return{showHistoryDialog:!1,rule:null,thresholddialog:!1,ruleOverviewLoading:!1,isEditLoading:!1,isLoading:!1,currentModuleName:"newreadingrules",primaryFields:["name","description","category","type","siteId","space","qrVal"],showForm:!1,module:null,isNew:!1,moduleWo:"newreadingalarm",rulewoDetails:null}},computed:{ruleId:function(){return parseInt(this.$route.params.id)},moduleName:function(){return"newreadingrules"},viewname:function(){return this.$route.params.viewname},currentAction:function(){return"WorkFlow"},currentRuleType:function(){var currentAction=this.currentAction;return(0,validation/* isEmpty */.xb)(currentAction)?null:"WorkFlow"===currentAction?37:38},workFlowActionHash:function(){return this.$constants.WorkFlowAction.module["newreadingalarm"]},activityTypes:function(){var workFlowActionHash=this.workFlowActionHash,activity=["On Date","Field Change","On each Alarm Occurrence","Clear"],activityTypes=[];return null!==workFlowActionHash&&void 0!==workFlowActionHash&&workFlowActionHash.activityTypes&&workFlowActionHash.activityTypes.forEach((function(types){activity.includes(types.label)&&activityTypes.push(types)})),activityTypes=sortBy_default()(activityTypes,["label"]),activityTypes||[]},currentActionTab:function(){var workFlowActionHash=this.workFlowActionHash,currentAction=this.currentAction;if(!(0,validation/* isEmpty */.xb)(workFlowActionHash)){var _ref=workFlowActionHash||{},tabs=_ref.tabs;return tabs.find((function(tab){return tab.name===currentAction}))}return{}},isEditRuleToWo:function(){var _ref2=this||{},rulewoDetails=_ref2.rulewoDetails;return!(!rulewoDetails||(0,validation/* isEmpty */.xb)(rulewoDetails))},isFaultToWo:function(){var _ref3=this||{},rulewoDetails=_ref3.rulewoDetails,faultToWo=!1;if(rulewoDetails&&!(0,validation/* isEmpty */.xb)(rulewoDetails)){var _ref4=rulewoDetails||{},closeWo=_ref4.closeWo,woCreation=_ref4.woCreation,_ref5=closeWo||{},closeStatus=_ref5.status,_ref6=woCreation||{},createStatus=_ref6.status;(0,validation/* isEmpty */.xb)(createStatus)||(0,validation/* isEmpty */.xb)(closeStatus)||(faultToWo=createStatus&&closeStatus)}return faultToWo}},watch:{ruleId:function(){this.loadRuleDetails()}},methods:{loadReadingRules:function(){},goBack:function(){window.history.go(-1)},editThresholdRule:function(id){var viewname=this.viewname,moduleName=this.moduleName;if((0,router/* isWebTabsEnabled */.tj)()){var _ref7=(0,router/* findRouteForModule */.Jp)(moduleName,router/* pageTypes */.As.EDIT)||{},name=_ref7.name;name&&this.$router.push({name:name,params:{viewname:viewname,id:id}})}else this.$router.push({name:"new-rule-edit",params:{viewname:viewname,id:id},query:this.$route.query})},loadRuleDetails:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var self,params,_yield$API$fetchRecor,newreadingrules;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return self=_this,_this.ruleOverviewLoading=!0,params={id:_this.ruleId},_context.prev=3,_context.next=6,api/* API */.bl.fetchRecord(_this.moduleName,params);case 6:_yield$API$fetchRecor=_context.sent,newreadingrules=_yield$API$fetchRecor.newreadingrules,self.rule=newreadingrules,self.ruleOverviewLoading=!1,_context.next=15;break;case 12:_context.prev=12,_context.t0=_context["catch"](3),_this.$message.error(_context.t0.message);case 15:return _context.next=17,_this.loadRuleWoDetails();case 17:case"end":return _context.stop()}}),_callee,null,[[3,12]])})))()},loadRuleWoDetails:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var ruleId,params,_yield$API$get,error,data,_ref8,faultToWorkorder;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return ruleId=_this2.ruleId,params={ruleId:ruleId},_context2.next=4,api/* API */.bl.get("v3/readingrule/actions/fetchRuleWo",params);case 4:_yield$API$get=_context2.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?_this2.$message.error("Error Occured"):data&&(_ref8=data||{},faultToWorkorder=_ref8.faultToWorkorder,delete faultToWorkorder.ruleId,_this2.rulewoDetails=faultToWorkorder);case 8:case"end":return _context2.stop()}}),_callee2)})))()},updateStatus:function(record){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _ref9,id,url,params,_yield$API$post,error,data,_ref10,newreadingrules,_ref11,status;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this3.isLoading=!0,_this3.rule.status=!_this3.rule.status,_ref9=record||{},id=_ref9.id,url="v3/modules/data/patch",params={data:record,moduleName:_this3.moduleName,id:id},_context3.next=7,api/* API */.bl.post(url,params);case 7:_yield$API$post=_context3.sent,error=_yield$API$post.error,data=_yield$API$post.data,error?_this3.$message.error("Error Occurred"):(0,validation/* isEmpty */.xb)(data)||(_ref10=data||{},newreadingrules=_ref10.newreadingrules,_ref11=newreadingrules||{},status=_ref11.status,_this3.isLoading=!1,_this3.$message.success((status?_this3.$t("common._common.activate"):_this3.$t("common._common.deactivate"))+_this3.$t("common._common.rule_successfully")));case 11:case"end":return _context3.stop()}}),_callee3)})))()},enableWO:function(){this.isLoading=!1,this.isNew=!0,this.showForm=!0,this.loadModuleMeta()},loadModuleMeta:function(){var _this4=this;this.$util.loadModuleMeta(this.moduleWo).then((function(response){return _this4.module=response.module}))},disableFaultWO:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var ruleId,params,_yield$API$get2,error,isFaultToWo;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return ruleId=_this5.ruleId,params={ruleId:ruleId},_context4.next=4,api/* API */.bl.get("v3/readingrule/actions/updatewfStatus",params);case 4:if(_yield$API$get2=_context4.sent,error=_yield$API$get2.error,_yield$API$get2.data,!error){_context4.next=11;break}_this5.$message.error("Error Occured"),_context4.next=15;break;case 11:return _context4.next=13,_this5.loadRuleWoDetails();case 13:isFaultToWo=_this5.isFaultToWo,isFaultToWo?_this5.$message.success("Fault To Workorder configuration is enabled"):_this5.$message.success("Fault To Workorder configuration is disabled");case 15:case"end":return _context4.stop()}}),_callee4)})))()}}},rules_NewRulesSummaryvue_type_script_lang_js=NewRulesSummaryvue_type_script_lang_js,NewRulesSummary_component=(0,componentNormalizer/* default */.Z)(rules_NewRulesSummaryvue_type_script_lang_js,render,staticRenderFns,!1,null,"43cb1419",null)
/* harmony default export */,NewRulesSummary=NewRulesSummary_component.exports},
/***/991326:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return NewCustomTypeRule}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/notificationAndWorkflows/NewCustomTypeRule.vue?vue&type=template&id=0abc87fc
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-dialog",{staticStyle:{"z-index":"1999"},attrs:{visible:_vm.visibilityshow,fullscreen:!0,"append-to-body":!0,"before-close":_vm.closeDialog,"custom-class":"fc-dialog-form fc-dialog-right custom-rule-dialog setup-dialog50 setup-dialog"},on:{"update:visible":function($event){_vm.visibilityshow=$event}}},[_c("div",{attrs:{id:"new-custom-rule"}},[_c("error-banner",{attrs:{error:_vm.error,errorMessage:_vm.errorMessage}}),_c("el-form",{ref:"newCustomRule",attrs:{model:_vm.data,"label-position":"top"}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-modal"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"setup-modal-title"},[_vm._v(_vm._s(_vm.title))])])])]),_vm.loading?_c("div",{staticClass:"new-body-modal"},[_c("el-row",[_c("el-col",{staticClass:"pR10",attrs:{span:12}},[_c("span",{staticClass:"line1 loading-shimmer width50"}),_c("span",{staticClass:"line2 loading-shimmer width100"})]),_c("el-col",{staticClass:"pL10",attrs:{span:12}},[_c("span",{staticClass:"line1 loading-shimmer width50"}),_c("span",{staticClass:"line2 loading-shimmer width100"})])],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("span",{staticClass:"line3 loading-shimmer width50"}),_c("span",{staticClass:"line4 loading-shimmer width100"})])],1)],1):_c("div",{staticClass:"new-body-modal"},[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"name"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.roles.name"))+" ")]),_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{autofocus:!0,placeholder:_vm.$t("setup.setupLabel.action_name")},model:{value:_vm.data.rule.name,callback:function($$v){_vm.$set(_vm.data.rule,"name",$$v)},expression:"data.rule.name"}})],1)],1),_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"siteId"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("space.sites._site"))+" ")]),_c("Lookup",{attrs:{field:_vm.fields.site,hideLookupIcon:!0},on:{recordSelected:_vm.setSelectedValue,showLookupWizard:_vm.showLookupWizardSite},model:{value:_vm.data.rule.siteId,callback:function($$v){_vm.$set(_vm.data.rule,"siteId",$$v)},expression:"data.rule.siteId"}})],1)],1)],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{attrs:{prop:"description"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("space.sites.site_description"))+" ")]),_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{"min-rows":1,type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:_vm.$t("common._common.enter_desc"),reseize:"none"},model:{value:_vm.data.rule.description,callback:function($$v){_vm.$set(_vm.data.rule,"description",$$v)},expression:"data.rule.description"}})],1)],1)],1),_c("el-row",{attrs:{gutter:20}},[_c("el-col",{staticClass:"utility-block",attrs:{span:12}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.execute_on"))+" ")]),_c("p",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.notify_rule_executed"))+" ")]),_c("el-form-item",{attrs:{prop:"activityType"}},[_c("el-select",{staticClass:"width100 fc-input-full-border-select2",attrs:{placeholder:"Select"},model:{value:_vm.data.rule.event.activityType,callback:function($$v){_vm.$set(_vm.data.rule.event,"activityType",$$v)},expression:"data.rule.event.activityType"}},_vm._l(_vm.activityTypes,(function(type,index){return _c("el-option",{key:index,attrs:{label:type.label,value:type.value}})})),1)],1)],1)],1),524288===_vm.data.rule.event.activityType||1048576===_vm.data.rule.event.activityType?_c("div",{staticClass:"fc-div-bg-border mB20"},[524288===_vm.data.rule.event.activityType?_c("div",[_c("el-row",[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.dateField"))+" ")]),_c("el-select",{staticClass:"width300px",attrs:{placeholder:"Select"},model:{value:_vm.data.rule.dateFieldId,callback:function($$v){_vm.$set(_vm.data.rule,"dateFieldId",$$v)},expression:"data.rule.dateFieldId"}},_vm._l(_vm.filteredDateFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1)],1),_c("el-col",{staticClass:"pL40",attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.scheduled_type"))+" ")]),_c("el-radio-group",{staticClass:"criteria-radio-label",model:{value:_vm.data.rule.scheduleType,callback:function($$v){_vm.$set(_vm.data.rule,"scheduleType",$$v)},expression:"data.rule.scheduleType"}},[_vm.beforeFieldIds.includes(_vm.data.rule.dateFieldId)?_vm._e():_c("el-radio",{key:1,staticClass:"fc-radio-btn",attrs:{label:1}},[_vm._v("Before")]),_c("el-radio",{key:2,staticClass:"fc-radio-btn",attrs:{label:2}},[_vm._v("On ")]),_c("el-radio",{key:3,staticClass:"fc-radio-btn",attrs:{label:3}},[_vm._v("After ")])],1)],1)],1),_c("el-row",{staticClass:"mT30"},[[1,3].includes(parseInt(_vm.data.rule.scheduleType))?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Days")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:"",placeholder:"Select"},model:{value:_vm.dateObject.days,callback:function($$v){_vm.$set(_vm.dateObject,"days",$$v)},expression:"dateObject.days"}},_vm._l(60,(function(index){return _c("el-option",{key:"days-"+index,attrs:{label:index,value:index}})})),1)],1),_vm.checkDateTimeField?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Hours")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:""},model:{value:_vm.dateObject.hours,callback:function($$v){_vm.$set(_vm.dateObject,"hours",$$v)},expression:"dateObject.hours"}},_vm._l(_vm.$constants.HOURS,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1),_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Mins")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{placeholder:"Select"},model:{value:_vm.dateObject.minute,callback:function($$v){_vm.$set(_vm.dateObject,"minute",$$v)},expression:"dateObject.minute"}},_vm._l(_vm.$constants.MINUTES,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1)]:_vm._e()]:_vm._e(),_vm.checkDateTimeField?_vm._e():_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Time")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{"collapse-tags":""},model:{value:_vm.data.rule.time,callback:function($$v){_vm.$set(_vm.data.rule,"time",$$v)},expression:"data.rule.time"}},_vm._l(_vm.timesOption,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1)],2)],1):1048576===_vm.data.rule.event.activityType?_c("div",[_c("el-row",[1048576===_vm.data.rule.event.activityType?_c("div",{staticClass:"approve-form-item"},[_c("el-form-item",{staticClass:"fc-tag p0 pL10 pR10",attrs:{prop:"activityType"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" Field "+_vm._s(_vm.selectedFieldObject.length>0?"("+_vm.selectedFieldObject.length+")":"")+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width50",attrs:{"multiple-limit":3,multiple:"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.selectedFieldObject,callback:function($$v){_vm.selectedFieldObject=$$v},expression:"selectedFieldObject"}},_vm._l(_vm.moduleFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1),_vm.selectedFieldObject.length<3?_c("el-button",{staticClass:"all-rule-btn",attrs:{slot:"reference"},slot:"reference"},[_c("img",{staticClass:"mL10",attrs:{src:__webpack_require__(353654)}})]):_vm._e()],1)],1):_vm._e()])],1):_vm._e()]):_vm._e(),_c("div",{staticClass:"form-input"},[_c("div",{staticClass:"wo-save-subH"},[_vm._v(" "+_vm._s(_vm.$t("common._common.criteria"))+" ")]),_c("div",{staticClass:"fc-sub-title-desc"},[_vm._v(" "+_vm._s(_vm.$t("common._common.specify_rule_custom",{module:_vm.module}))+" ")]),_c("CriteriaBuilder",{attrs:{moduleName:_vm.module,isOneLevelEnabled:!0},model:{value:_vm.data.rule.criteria,callback:function($$v){_vm.$set(_vm.data.rule,"criteria",$$v)},expression:"data.rule.criteria"}})],1),_c("event-dialog-helper",{ref:"eventDialog",attrs:{ruleType:_vm.ruleType,rule:_vm.data,module:_vm.module,moduleFields:_vm.moduleFields,moduleId:_vm.moduleId,actions:_vm.ruleActions},on:{actions:_vm.addAction}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(_vm._s(_vm.$t("setup.users_management.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:_vm.save}},[_vm._v(_vm._s(_vm.saving?_vm.$t("maintenance._workorder.saving"):_vm.$t("maintenance._workorder.save")))])],1)])],1)])],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),objectSpread2=__webpack_require__(595082),EventDialogHelper=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(434284),__webpack_require__(450886),__webpack_require__(670560),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(494177)),ErrorBanner=__webpack_require__(297157),NotificationHelper=__webpack_require__(683038),validation=__webpack_require__(990260),utils_field=__webpack_require__(815872),ui_forms=__webpack_require__(141323),dist=__webpack_require__(191853),vuex_esm=__webpack_require__(420629),api=__webpack_require__(32284),fields={site:{isDataLoading:!1,options:[],lookupModuleName:"site",field:{lookupModule:{name:"site",displayName:"Sites"}},multiple:!1,additionalParams:{orderBy:"spaceType",orderType:"asc"}}},NewCustomTypeRulevue_type_script_lang_js={props:["isNew","visibilityshow","mailWidth","module","moduleDisplayName","activityTypes","ruleType","ruleActions","currentAction"],mixins:[NotificationHelper/* default */.Z],data:function(){return{fields:fields,timesOption:[],error:!1,isUpdate:!1,errorMessage:"",selectedFieldObject:[],moduleMeta:null,saving:!1,data:{rule:{name:"",scheduleType:3,description:"",ruleType:null,event:{moduleName:"alarm",activityType:1},dateFieldId:null,time:null,fields:[],criteria:null},siteId:null,actions:[]},dateObject:{days:null,minute:0,hours:0,minu:null},closeWo:{actionType:12},ruleDialog:!0,dateFieldToExclude:["sysCreatedTime","sysModifiedTime","sysDeletedTime"],beforeDateFieldsToExclude:["createdTime","modifiedTime"],dateFieldName:["DATE","DATE_TIME"],loading:!1}},components:{Lookup:ui_forms/* Lookup */.tY,ErrorBanner:ErrorBanner/* default */.Z,EventDialogHelper:EventDialogHelper/* default */.Z,CriteriaBuilder:dist/* CriteriaBuilder */.IP},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({metaInfo:function(state){return state.view.metaInfo}})),{},{moduleFields:function(){return this.$getProperty(this.metaInfo,"fields",null)},moduleId:function(){return this.$getProperty(this.metaInfo,"module.moduleId",null)},checkDateTimeField:function(){var dateFields=this.dateFields,data=this.data,_ref=data||{},rule=_ref.rule,_ref2=rule||{},dateFieldId=_ref2.dateFieldId,field=(dateFields||[]).find((function(fld){return fld.fieldId===dateFieldId}))||{};return!(0,validation/* isEmpty */.xb)(field)&&(0,utils_field/* isDateTimeField */.K)(field)},title:function(){var isNew=this.isNew,module=this.module,currentAction=this.currentAction,moduleDisplayName=this.moduleDisplayName,title=isNew?"New":"Edit";return moduleDisplayName="newreadingalarm"===module?"Alarm":moduleDisplayName,currentAction=(0,validation/* isEmpty */.xb)(currentAction)?"Action":currentAction,title="".concat(title," ").concat(moduleDisplayName," ").concat(currentAction),title},filteredDateFields:function(){var fields=(0,toConsumableArray/* default */.Z)(this.dateFieldToExclude);return 1===this.data.rule.scheduleType&&(fields=[].concat((0,toConsumableArray/* default */.Z)(fields),(0,toConsumableArray/* default */.Z)(this.beforeDateFieldsToExclude))),(this.dateFields||[]).filter((function(field){return!fields.includes(field.name)}))},dateFields:function(){var moduleFields=this.moduleFields,dateFieldName=this.dateFieldName;return(moduleFields||[]).filter((function(d){return(dateFieldName||[]).includes(d.dataTypeEnum._name)}))},beforeFieldIds:function(){var _this=this;return(this.dateFields||[]).filter((function(field){return(_this.beforeDateFieldsToExclude||[]).includes(field.name)})).map((function(field){return field.id}))}}),mounted:function(){for(var i=0;i<=23;i++){var time=(i<10?"0"+i:i)+":";this.timesOption.push(time+"00"),this.timesOption.push(time+"30")}},created:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var selectedRuleId,params,_yield$API$get,data,error,siteId,actions,rule,_fields,dateObj;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(selectedRuleId=_this2.$attrs.selectedRuleId||{},!selectedRuleId||_this2.isNew){_context.next=19;break}return _this2.loading=!0,_context.prev=3,params={ruleId:selectedRuleId},_context.next=7,api/* API */.bl.get("v2/modules/rules/getRule",params);case 7:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this2.$message.error(error.message||"Something went wrong"):(siteId=_this2.$getProperty(data,"workflowRule.siteId")>-1?_this2.$getProperty(data,"workflowRule.siteId"):"",actions=_this2.$getProperty(data,"workflowRule.actions"),rule=_this2.$getProperty(data,"workflowRule"),_fields=_this2.$getProperty(data,"workflowRule.fields"),dateObj=_this2.$getProperty(data,"workflowRule.interval"),rule.dateFieldId=_this2.dateFieldsCheck(rule,dateObj),_this2.data={rule:(0,objectSpread2/* default */.Z)({},rule),siteId:siteId,actions:actions},_this2.$setProperty(_this2.data,"rule.siteId",siteId),_fields&&(_this2.selectedFieldObject=[],_fields.map((function(d){_this2.selectedFieldObject.push(parseInt(d.fieldId))})))),_context.next=16;break;case 13:_context.prev=13,_context.t0=_context["catch"](3),_this2.data.rule={};case 16:return _context.prev=16,_this2.loading=!1,_context.finish(16);case 19:case"end":return _context.stop()}}),_callee,null,[[3,13,16,19]])})))()},methods:{closeDialog:function(){this.$emit("update:visibilityshow",!1)},showLookupWizardSite:function(field,canShow){canShow=!1,this.$set(this,"selectedLookupField",field),this.$set(this,"canShowLookupWizardSite",canShow)},setSelectedValue:function(selectedValues,field){},addAction:function(action){this.data.rule.actions=action},save:function(){var self=this,actions=this.data.actions;if(2048===parseInt(this.data.rule.event.activityType)){var woActionIdx=actions.findIndex((function(action){return 11===action.actionType}));-1!==woActionIdx&&actions.splice(woActionIdx,1)}else if(actions){var idx=actions.findIndex((function(action){return 12===action.actionType}));-1!==idx&&actions.splice(idx,1)}self.data.rule.criteria?Object.keys(self.data.rule.criteria.conditions).forEach((function(kessy){self.data.rule.criteria.conditions[kessy].hasOwnProperty("fieldName")?self.data.rule.criteria&&(self.data.rule.criteria.conditions[kessy].fieldName?(delete self.data.rule.criteria.conditions[kessy].valueArray,delete self.data.rule.criteria.conditions[kessy].operatorsDataType,delete self.data.rule.criteria.conditions[kessy].operatorLabel):self.data.rule.criteria=null):self.data.rule.criteria=null})):self.data.rule.criteriaId=-99,self.selectedFieldObject.length>0?(self.data.rule.fields=[],self.selectedFieldObject.forEach((function(d){self.data.rule.fields.push({fieldId:d})}))):delete self.data.rule.fields,this.data.rule.interval=null,524288===parseInt(this.data.rule.event.activityType)&&this.dateObject&&(this.data.rule.dateFieldId&&(this.checkDateTimeField||(this.dateObject.hours=0,this.dateObject.minute=0)),1===this.data.rule.scheduleType||3===this.data.rule.scheduleType?this.data.rule.interval=this.$helpers.daysHoursMinuToSec(this.dateObject):this.data.rule.interval=null),this.data.rule.dateFieldId||(delete this.data.rule.dateFieldId,this.data.rule.time=null),this.data.rule.dateFieldId&&this.checkDateTimeField&&(this.data.rule.time=null);var apiaction,data=this.$helpers.cloneObject(this.data);if(data.actions=actions,!this.validateForm(data))return!1;if(self.isNew)data.rule.ruleType=this.ruleType,data.rule.event.moduleName=this.module,apiaction="addcustom";else{var newAction=this.$refs.eventDialog.updateAction(data.actions);newAction&&(this.data.actions=[],data.actions=newAction),(0,validation/* isEmpty */.xb)(data.rule.siteId)?data.rule.siteId=-99:data.rule.siteId||delete data.rule.siteId,apiaction="updatecustom"}this.saving=!0,this.$util.addOrUpdateRule(this.module,data,!this.isNew,apiaction).then((function(rule){self.saving=!1,self.$emit("actionSaved",rule),self.closeDialog()})).catch((function(error){self.saving=!1}))},validateForm:function(ruleData){if(this.error=!1,!ruleData.rule.name)return this.error=!0,this.errorMessage="Enter Name ",!1;if(524288===ruleData.rule.event.activityType){if(!ruleData.rule.dateFieldId)return this.error=!0,this.errorMessage="Please select field for on date activity",!1;if(3===ruleData.rule.scheduleType&&!ruleData.rule.interval)return this.error=!0,this.errorMessage="Please select duration",!1}else if(1048576===ruleData.rule.event.activityType&&(!ruleData.rule.fields||!ruleData.rule.fields.length>0))return this.error=!0,this.errorMessage="Please select atleast on field for field change activity",!1;return!(!ruleData.actions||!ruleData.actions.length>0)||(this.error=!0,this.errorMessage="Please select atleast one a action",!1)},dateFieldsCheck:function(rule,dateObj){if(524288===rule.event.activityType&&!(0,validation/* isEmpty */.xb)(rule.dateFieldId)){if(dateObj&&[1,3].includes(parseInt(rule.scheduleType))){var dateObject=this.$helpers.secTodaysHoursMinu(dateObj);this.dateObject=(0,objectSpread2/* default */.Z)({},dateObject)}return rule.dateFieldId}return this.dateObject={days:null,minute:0,hours:0,minu:null},null}}},notificationAndWorkflows_NewCustomTypeRulevue_type_script_lang_js=NewCustomTypeRulevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(notificationAndWorkflows_NewCustomTypeRulevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,NewCustomTypeRule=component.exports},
/***/935010:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"765af973ce02f8f593ec7a4e85d08efb.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/14616.js.map