(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[61282,20861],{
/***/643781:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ModulekpiList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/kpi/ModulekpiList.vue?vue&type=template&id=a587a20c&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("CommonListLayout",{attrs:{moduleName:"formulaField",getPageTitle:function(){return"Module KPI List"}},scopedSlots:_vm._u([_vm.tabCheck()?{key:"views",fn:function(){return[_c("KpiViews")]},proxy:!0}:{key:"views",fn:function(){return[_c("ReadingKpiViews")]},proxy:!0},{key:"header",fn:function(){return[!_vm.showSearch&&_vm.totalCount>0?[_c("pagination",{staticClass:"pL15 fc-black-small-txt-12",attrs:{total:_vm.totalCount,perPage:_vm.perPage}}),_c("span",{staticClass:"separator"},[_vm._v("|")])]:_vm._e(),_c("search",{attrs:{config:_vm.filterConfigData,moduleName:_vm.filterConfigData.moduleName,defaultFilter:"name",includeAllMetaFields:!1}}),_vm.showSearch?_vm._e():[_c("span",{staticClass:"separator"},[_vm._v("|")]),_c("div",{staticClass:"pL10"},[_c("button",{staticClass:"fc-create-btn outline-none",staticStyle:{"margin-top":"-10px"},on:{click:function($event){return _vm.createKpi()}}},[_vm._v(" "+_vm._s(_vm.$t("common.products.new_kpi"))+" ")])])]]},proxy:!0}],null,!0)},[_c("div",{staticClass:"fc-list-view p10 pT0 mT10 fc-list-table-container height100vh fc-table-td-height fc-table-viewchooser pB100"},[_c("div",[_c("tags",{attrs:{disableSaveFilters:!0}})],1),_vm.moduleLoading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.moduleLoading,size:"80"}})],1):_vm.$validation.isEmpty(_vm.kpiList)?_c("div",{staticClass:"width100 text-center empty-container pB30 pT30"},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/emptystate/kpi",iconClass:"icon icon-256"}}),_c("div",{staticClass:"f18 bold",staticStyle:{"margin-bottom":"7px"}},[_vm._v(" "+_vm._s(_vm.$t("common.products.no_kpis_found"))+" ")]),_c("div",{staticClass:"f12 grey-text2"},[_vm._v(" "+_vm._s(_vm.$t("common.header.you_dont_seem_to_have_kpis_created_view"))+" ")])],1):_c("el-table",{key:"KPIlist",staticClass:"kpi-list fc-list-eltable",staticStyle:{width:"100%"},attrs:{data:_vm.kpiList,height:"auto","row-class-name":"tablerow-edit-delete-icon"}},[_c("el-table-column",{attrs:{label:_vm.$t("common._common.kpi_name")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("div",{staticClass:"q-item-label",staticStyle:{"margin-top":"1px","letter-spacing":"0.3px"}},[_vm._v(" "+_vm._s(kpi.row.name)+" ")])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("setup.setupLabel.modules")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(scope.row.moduleObj))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common.tabs.metric")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(scope.row.metricDisplayName))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common.safe_limit")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(scope.row.safeLimit))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common.header.current_value")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(scope.row.currentValue))])]}}])}),_c("el-table-column",{attrs:{width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("div",{staticClass:"d-flex justify-content-center"},[_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"hover-actions-view outline-none",attrs:{title:_vm.$t("common._common.edit")},on:{click:function($event){return _vm.editKpi(kpi.row)}}},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/edit",iconClass:"icon icon-sm mR25 icon-edit"}})],1),_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"hover-actions-view",attrs:{title:_vm.$t("common._common.delete")},on:{click:function($event){return _vm.openDeleteDialog(kpi.row.id)}}},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/delete",iconClass:"icon icon-sm icon-remove"}})],1)])]}}])})],1)],1),_vm.showCreationForm?_c("new-kpi",{attrs:{isNew:_vm.isNew,kpi:_vm.selectedKPI},on:{onSave:function($event){return _vm.loadData()},onClose:function($event){_vm.showCreationForm=!1}}}):_vm._e(),_c("el-dialog",{staticClass:"fieldchange-Dialog pB15 fc-dialog-center-container kpi-list",attrs:{visible:_vm.canShowDialog,width:"30%",title:"Warning","custom-class":"dialog-header-padding","append-to-body":!0,"show-close":!1,"before-close":function(){return _vm.canShowDialog=!1}}},[_c("div",{staticClass:"pB40 pT10 break-word height180",domProps:{innerHTML:_vm._s(_vm.$t("kpi.kpi.warning_message"))}}),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){_vm.canShowDialog=!1}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save delete-dialog",attrs:{type:"primary"},on:{click:function($event){return _vm.removeKpi("v2/kpi/module/delete")}}},[_vm._v(_vm._s(_vm.$t("common._common.delete")))])],1)])],1)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),slicedToArray=__webpack_require__(554621),objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),ReadingKpiViews=(__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(634338),__webpack_require__(425728),__webpack_require__(670560),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(336585),__webpack_require__(450886),__webpack_require__(434284),__webpack_require__(538077),__webpack_require__(648324),__webpack_require__(655857)),ReadingKpiTemplates=__webpack_require__(39381),FPagination=__webpack_require__(929593),validation=__webpack_require__(990260),kpiConstants=__webpack_require__(361251),DeprecatedCommonLayout=__webpack_require__(714218),Search=__webpack_require__(718452),Tags=__webpack_require__(482912),AddModuleKpi=__webpack_require__(441243),kpiViews=__webpack_require__(294438),router=__webpack_require__(329435),api=__webpack_require__(32284),vuex_esm=__webpack_require__(420629),ModulekpiListvue_type_script_lang_js={name:"ModulekpiList",extends:ReadingKpiTemplates["default"],props:["isOldKpi"],components:{Pagination:FPagination/* default */.Z,CommonListLayout:DeprecatedCommonLayout/* default */.Z,Search:Search/* default */.Z,Tags:Tags/* default */.Z,NewKpi:AddModuleKpi/* default */.Z,KpiViews:kpiViews/* default */.Z,ReadingKpiViews:ReadingKpiViews/* default */.Z},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.loadModules();case 2:_this.loadData();case 3:case"end":return _context.stop()}}),_callee)})))()},data:function(){return{kpiList:[],moduleLoading:!0,totalCount:null,perPage:50,metrics:{},modulesObjList:[],filterConfigData:{moduleName:"formulaField",path:"/app/em/kpi/",includeParentCriteria:!0,excludeModuleStateField:!0,data:{name:{label:this.$t("common.products.name"),displayType:"string",value:""},siteId:{label:this.$t("common.products.site"),options:{},value:null,displayType:"select",key:"siteId"}},availableColumns:["name","site"],fixedCols:["name"],saveView:!1}}},watch:{page:function(){this.loadData()}},computed:(0,objectSpread2/* default */.Z)({page:function(){return this.$route.query.page||1}},(0,vuex_esm/* mapState */.rn)({currentTab:function(state){return state.webtabs.selectedTab}})),methods:{tabCheck:function(){if((0,router/* isWebTabsEnabled */.tj)()){var _this$currentTab$type,_this$currentTab,tabType=null!==(_this$currentTab$type=null===(_this$currentTab=this.currentTab)||void 0===_this$currentTab?void 0:_this$currentTab.typeEnum)&&void 0!==_this$currentTab$type?_this$currentTab$type:null;return!(0,validation/* isEmpty */.xb)(tabType)&&"KPI"===tabType}return this.isOldKpi},loadData:function(){var _this2=this;if(!(0,validation/* isEmpty */.xb)(this.modulesObjList)){this.getCount();var url=this.getUrl();this.moduleLoading=!0,this.$http.get(url).then((function(response){if(0===response.data.responseCode){var _ref=response.data.result||{},_ref$kpis=_ref.kpis,kpis=void 0===_ref$kpis?[]:_ref$kpis;if(_this2.kpiList=kpis||[],(0,validation/* isEmpty */.xb)(kpis))_this2.moduleLoading=!1;else{var promises=[];_this2.kpiList.forEach((function(kpi){var target=kpi.target,minTarget=kpi.minTarget,moduleName=kpi.moduleName,metricId=kpi.metricId,metricName=kpi.metricName,currentValue=kpi.currentValue;(0,validation/* isEmpty */.xb)(target)||(0,validation/* isEmpty */.xb)(minTarget)?(0,validation/* isEmpty */.xb)(target)?(0,validation/* isEmpty */.xb)(minTarget)?kpi.safeLimit="--":kpi.safeLimit="> ".concat(minTarget):kpi.safeLimit="< ".concat(target):kpi.safeLimit="".concat(minTarget," - ").concat(target),(0,validation/* isNullOrUndefined */.le)(currentValue)&&(kpi.currentValue="---");var moduleObj=_this2.modulesObjList[0].list.find((function(moduleList){return moduleList.moduleName===moduleName}));(0,validation/* isEmpty */.xb)(moduleObj)&&(moduleObj=_this2.modulesObjList[1].list.find((function(moduleList){return moduleList.moduleName===moduleName}))),kpi.moduleObj=moduleObj?moduleObj.label:"";var promise=_this2.loadMetric(moduleName,metricId,metricName).then((function(metric){return _this2.$set(kpi,"metricDisplayName",metric)}));promises.push(promise)})),Promise.all(promises).then((function(){return _this2.moduleLoading=!1}))}}else _this2.$message.error(response.data.message),_this2.moduleLoading=!1}))}},loadModules:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _yield$API$get,error,data,modulesListKey;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api/* API */.bl.get("/v3/modules/list/all");case 2:_yield$API$get=_context2.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?_this3.$message.error(error.message):(modulesListKey={systemModules:"System Modules",customModules:"Custom Modules"},Object.entries(modulesListKey).forEach((function(_ref2){var _ref3=(0,slicedToArray/* default */.Z)(_ref2,2),key=_ref3[0],value=_ref3[1],list=data[key].map((function(list){return{moduleName:list.name,label:list.displayName}}));"systemModules"===key&&(list=[].concat((0,toConsumableArray/* default */.Z)(list),(0,toConsumableArray/* default */.Z)((0,kpiConstants/* getModules */.h)().filter((function(module){return!0===_this3.$helpers.isLicenseEnabled(module.license)}))))),_this3.modulesObjList.push({list:list,label:value})})));case 6:case"end":return _context2.stop()}}),_callee2)})))()},loadMetric:function(moduleName,metricId,metricName){var _this4=this;return new Promise((function(resolve){_this4.getMetricList(_this4.metrics,moduleName).then((function(){var metric;metric=(0,validation/* isEmpty */.xb)(metricName)?_this4.metrics[moduleName].find((function(metric){return metric.id===metricId})):_this4.metrics[moduleName].find((function(metric){return metric.name===metricName})),resolve(_this4.$getProperty(metric,"displayName","---"))}))}))},getMetricList:function(list,moduleName){var _this5=this;if(list[moduleName])return(0,validation/* isArray */.kJ)(list[moduleName])?new Promise((function(resolve){return resolve(list[moduleName])})):list[moduleName];var url="v2/kpi/module/metrics?moduleName=".concat(moduleName),promise=this.$http.get(url).then((function(_ref4){var data=_ref4.data;if(0===data.responseCode){var metrics=data.result.metrics;_this5.metrics[moduleName]=metrics}}));return this.metrics[moduleName]=promise,promise},getUrl:function(){var parsedFilters,url="/v2/kpi/module/list?fetchCurrentValue=true&type=1&page=".concat(this.page,"&perPage=").concat(this.perPage,"&"),filters=this.filters,filterObj=(0,objectSpread2/* default */.Z)({},filters);return(0,validation/* isEmpty */.xb)(filterObj)||(filterObj.resource&&delete filterObj.resource,parsedFilters=encodeURIComponent(JSON.stringify(filterObj))),(0,validation/* isEmpty */.xb)(parsedFilters)||(url="".concat(url,"filters=").concat(parsedFilters,"&")),url},getCount:function(){var _this6=this,url="v2/kpi/module/count";this.$http.get(url).then((function(_ref5){var data=_ref5.data;if(0===data.responseCode){var count=data.result.count;_this6.totalCount=count}}))},loadKPICount:function(){}}},kpi_ModulekpiListvue_type_script_lang_js=ModulekpiListvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(kpi_ModulekpiListvue_type_script_lang_js,render,staticRenderFns,!1,null,"a587a20c",null)
/* harmony default export */,ModulekpiList=component.exports},
/***/39381:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ReadingKpiTemplates}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/kpi/ReadingKpiTemplates.vue?vue&type=template&id=430bb50a&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("CommonListLayout",{attrs:{moduleName:"formulaField",getPageTitle:function(){return"Reading KPI List"}},scopedSlots:_vm._u([{key:"views",fn:function(){return[_c("KpiViews")]},proxy:!0},{key:"header",fn:function(){return[!_vm.showSearch&&_vm.totalCount>0?[_c("pagination",{staticClass:"pL15 fc-black-small-txt-12",attrs:{total:_vm.totalCount,perPage:50}}),_c("span",{staticClass:"separator"},[_vm._v("|")])]:_vm._e(),_vm.isFilterOptionsLoading?_vm._e():_c("search",{attrs:{config:_vm.filterConfig,moduleName:_vm.filterConfig.moduleName,defaultFilter:"name",includeAllMetaFields:!1}}),_vm.showSearch?_vm._e():[_c("span",{staticClass:"separator"},[_vm._v("|")]),_c("div",{staticClass:"pL10"},[_c("button",{staticClass:"fc-create-btn outline-none",staticStyle:{"margin-top":"-10px"},on:{click:function($event){return _vm.createKpi()}}},[_vm._v(" "+_vm._s(_vm.$t("common.products.new_kpi"))+" ")])])]]},proxy:!0}])},[_c("div",{staticClass:"fc-list-view p10 pT0 mT10 fc-list-table-container height100vh fc-table-td-height fc-table-viewchooser pB100"},[_c("div",[_c("tags",{attrs:{disableSaveFilters:!0}})],1),_vm.loading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm.$validation.isEmpty(_vm.kpiList)?_c("div",{staticClass:"width100 text-center empty-container pB30 pT30"},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/emptystate/kpi",iconClass:"icon icon-256"}}),_c("div",{staticClass:"f18 bold",staticStyle:{"margin-bottom":"7px"}},[_vm._v(" "+_vm._s(_vm.$t("common.products.no_kpis_found"))+" ")]),_c("div",{staticClass:"f12 grey-text2"},[_vm._v(" "+_vm._s(_vm.$t("common.header.you_dont_seem_to_have_kpis_created_view"))+" ")])],1):_c("el-table",{key:"KPIlist",staticClass:"kpi-list fc-list-eltable",staticStyle:{width:"100%"},attrs:{data:_vm.kpiList,height:"auto","row-class-name":"tablerow-edit-delete-icon"}},[_c("el-table-column",{attrs:{label:_vm.$t("common.products._name")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("div",{staticClass:"q-item-label",staticStyle:{"margin-top":"1px","letter-spacing":"0.3px"},on:{click:function($event){return _vm.opensummary(kpi.row.id)}}},[_vm._v(" "+_vm._s(kpi.row.name)+" ")])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common.category")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("span",[_vm._v(_vm._s(_vm.getKpiCategoryById(kpi.row.kpiCategory)?_vm.getKpiCategoryById(kpi.row.kpiCategory).name:"---"))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common._space_asset")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(_vm.getResourceName(scope.row)?_vm.getResourceName(scope.row):""))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common._common.frequency")},scopedSlots:_vm._u([{key:"default",fn:function(scope){return[_c("span",[_vm._v(_vm._s(scope.row.frequency?_vm.frequencyTypes[scope.row.frequency]:"---"))])]}}])}),_c("el-table-column",{attrs:{label:_vm.$t("common.products.status")},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("el-switch",{attrs:{"active-color":"rgba(57, 178, 194, 0.8)","inactive-color":"#e5e5e5"},on:{change:function($event){return _vm.toggleStatus(kpi.row)}},model:{value:kpi.row.active,callback:function($$v){_vm.$set(kpi.row,"active",$$v)},expression:"kpi.row.active"}})]}}])}),_c("el-table-column",{attrs:{width:"150"},scopedSlots:_vm._u([{key:"default",fn:function(kpi){return[_c("div",{staticClass:"d-flex justify-content-center"},[_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"hover-actions-view outline-none",attrs:{title:_vm.$t("common._common.edit")},on:{click:function($event){return _vm.editKpi(kpi.row)}}},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/edit",iconClass:"icon icon-sm mR25 icon-edit"}})],1),_c("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"hover-actions-view",attrs:{title:_vm.$t("common._common.delete")},on:{click:function($event){return _vm.openDeleteDialog(kpi.row.id)}}},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/delete",iconClass:"icon icon-sm icon-remove"}})],1)])]}}])})],1)],1),_vm.showCreationForm?_c("new-kpi",{attrs:{isNew:_vm.isNew,kpi:_vm.selectedKPI},on:{onSave:function($event){return _vm.loadData()},onClose:function($event){_vm.showCreationForm=!1}}}):_vm._e(),_c("el-dialog",{staticClass:"fieldchange-Dialog pB15 fc-dialog-center-container kpi-list",attrs:{visible:_vm.canShowDialog,width:"30%",title:"Warning","custom-class":"dialog-header-padding","append-to-body":!0,"show-close":!1,"before-close":function(){return _vm.canShowDialog=!1}}},[_c("div",{staticClass:"pB40 pT10 break-word height180",domProps:{innerHTML:_vm._s(_vm.$t("kpi.kpi.warning_message"))}}),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){_vm.canShowDialog=!1}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save delete-dialog",attrs:{type:"primary"},on:{click:function($event){return _vm.removeKpi("/v2/kpi/delete")}}},[_vm._v(_vm._s(_vm.$t("common._common.delete")))])],1)])],1)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),validation=(__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(169358),__webpack_require__(648324),__webpack_require__(634338),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(425728),__webpack_require__(339772),__webpack_require__(990260)),vuex_esm=__webpack_require__(420629),FPagination=__webpack_require__(929593),DeprecatedCommonLayout=__webpack_require__(714218),Search=__webpack_require__(718452),Tags=__webpack_require__(482912),AddKpi=__webpack_require__(169251),kpiViews=__webpack_require__(294438),picklist=__webpack_require__(961358),api=__webpack_require__(32284),router=__webpack_require__(329435),ReadingKpiTemplatesvue_type_script_lang_js={name:"KPIList",components:{Pagination:FPagination/* default */.Z,CommonListLayout:DeprecatedCommonLayout/* default */.Z,Search:Search/* default */.Z,Tags:Tags/* default */.Z,NewKpi:AddKpi/* default */.Z,KpiViews:kpiViews/* default */.Z},data:function(){return{kpiList:[],perPage:50,loading:!0,isNew:!1,selectedKPI:null,totalCount:null,showCreationForm:!1,isFilterOptionsLoading:!0,kpiIdToDelete:null,canShowDialog:!1,filterConfig:{moduleName:"formulaField",path:"/app/em/kpi/",includeParentCriteria:!0,excludeModuleStateField:!0,data:{name:{label:this.$t("common.products.name"),displayType:"string",value:""},kpiCategory:{label:this.$t("common._common.category"),displayType:"select",options:{},value:null},siteId:{label:this.$t("common.products.site"),options:{},value:null,displayType:"select",key:"siteId"},assetCategoryId:{label:this.$t("common._common.asset_category"),displayType:"select",options:{},value:null}},availableColumns:["name","kpiCategory","siteId","assetCategoryId"],fixedCols:["name"],saveView:!1}}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.$store.dispatch("loadKpiCategories");case 2:return _context.next=4,_this.init();case 4:return _context.next=6,_this.loadFilterOptions();case 6:case"end":return _context.stop()}}),_callee)})))()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({showSearch:function(state){return state.search.active}})),(0,vuex_esm/* mapGetters */.Se)({getKpiCategoryById:"getKpiCategoryById"})),{},{assetCategoryList:function(){return this.$store.state.assetCategory},frequencyTypes:function(){var types=this.$helpers.cloneObject(this.$constants.FACILIO_FREQUENCY);return types["8"]="Hourly",types},page:function(){return this.$route.query.page||1},filters:function(){var $route=this.$route,_ref=$route||{},search=_ref.query.search;return(0,validation/* isEmpty */.xb)(search)?null:JSON.parse(this.$route.query.search)}}),watch:{filters:{handler:function(newVal,oldVal){newVal!==oldVal&&this.init()}},page:function(){this.init()}},methods:{init:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _this2.loading=!0,_context2.next=3,_this2.loadData();case 3:return _context2.next=5,_this2.loadKPICount();case 5:_this2.loading=!1;case 6:case"end":return _context2.stop()}}),_callee2)})))()},loadData:function(){var parsedFilters,_this3=this,url="/v2/kpi/list?type=1&page=".concat(this.page,"&perPage=50&"),filters=this.filters,filterObj=(0,objectSpread2/* default */.Z)({},filters),resource=filterObj.resource,params={};return(0,validation/* isEmpty */.xb)(filterObj)||(filterObj.resource&&delete filterObj.resource,parsedFilters=encodeURIComponent(JSON.stringify(filterObj))),(0,validation/* isEmpty */.xb)(parsedFilters)||(url="".concat(url,"filters=").concat(parsedFilters,"&")),(0,validation/* isEmpty */.xb)(resource)||(params.resource=resource[0].value),url=Object.keys(params).reduce((function(res,key){return res+=key+"="+params[key]+"&",res}),url),this.$http.get(url).then((function(_ref2){var data=_ref2.data;0===data.responseCode&&(_this3.kpiList=data.result.formulaList)}))},loadKPICount:function(){var _this4=this,url="/v2/kpi/count?type=1&fetchCount=true";return(0,validation/* isEmpty */.xb)(this.page)||(url+="&page=".concat(this.page,"&perPage=").concat(this.perPage)),this.$http.get(url).then((function(_ref3){var data=_ref3.data;0===data.responseCode&&(_this4.totalCount=data.result.count)})).catch((function(){_this4.totalCount=null}))},loadFilterOptions:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$getFieldOption,error,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this5.isFilterOptionsLoading=!0,_context3.next=3,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:"kpiCategory",skipDeserialize:!0}});case 3:_yield$getFieldOption=_context3.sent,error=_yield$getFieldOption.error,options=_yield$getFieldOption.options,error?_this5.$message.error(error.message||"Error Occured"):(_this5.$set(_this5.filterConfig.data,"kpiCategory",(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},_this5.filterConfig.data.kpiCategory),{},{options:options})),_this5.isFilterOptionsLoading=!1);case 7:case"end":return _context3.stop()}}),_callee3)})))()},onClick:function(row,col){col.label&&(this.selectedKPI=row,this.opensummary(row.id))},opensummary:function(id){if((0,router/* isWebTabsEnabled */.tj)()){var _ref4=(0,router/* findRouteForTab */.OD)(router/* pageTypes */.As.READING_KPI_SUMMARY)||{},name=_ref4.name;this.$router.push({name:name,params:{id:id},query:this.$route.query})}else this.$router.push({path:"/app/em/kpi/reading/templates/"+id+"/overview",query:this.$route.query})},getResourceName:function(KPI){if(!(0,validation/* isEmpty */.xb)(KPI.matchedResourcesIds)){if(KPI.assetCategoryId>0){var message,selectedCount,categoryName=this.getCategoryName(KPI.assetCategoryId);if(KPI.includedResources&&KPI.includedResources.length&&(selectedCount=KPI.includedResources.length),selectedCount){if(1===selectedCount)return KPI.matchedResources[0].name;message=selectedCount+" "+categoryName+"s"}else message="All "+categoryName+"s";return message}var firstResource=KPI.matchedResources[Object.keys(KPI.matchedResources)[0]];return 1===KPI.matchedResources.length?firstResource.name:1===firstResource.resourceType?"Some Spaces":"Some Assets"}return"---"},getCategoryName:function(categoryId){if(categoryId>0&&this.assetCategoryList){var category=this.assetCategoryList.find((function(category){return category.id===categoryId}));if(category)return category.name}},createKpi:function(){this.isNew=!0,this.selectedKPI=null,this.showCreationForm=!0},editKpi:function(kpi){-1===kpi.siteId&&(kpi.siteId=null),this.isNew=!1,this.selectedKPI=kpi,this.showCreationForm=!0},openDeleteDialog:function(kpiId){this.kpiIdToDelete=kpiId,this.canShowDialog=!0},removeKpi:function(url){var _this6=this;this.$http.post(url,{id:this.kpiIdToDelete}).then((function(_ref5){var data=_ref5.data;0===data.responseCode?(_this6.$message.success(_this6.$t("common.header.kpi_deleted_successfully")),_this6.loadData()):_this6.$message.error(_this6.$t("common.header.kpi_could_not_be_deleted"))})).finally((function(){_this6.kpiIdToDelete=null,_this6.canShowDialog=!1}))},toggleStatus:function(kpiObj){var _this7=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var _ref6,active,id,_yield$API$post,error,index;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _ref6=kpiObj||{},active=_ref6.active,id=_ref6.id,_context4.next=3,api/* API */.bl.post("v2/kpi/status",{status:active,ruleId:id});case 3:_yield$API$post=_context4.sent,error=_yield$API$post.error,error?(_this7.$message.error(error.message||"Status Update Failed"),index=_this7.kpiList.findIndex((function(kpi){return id===kpi.id})),-1!==index&&_this7.$set(_this7.kpiList,index,(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},kpiObj),{},{active:!active}))):_this7.$message.success("Status Updated Successfully");case 6:case"end":return _context4.stop()}}),_callee4)})))()}}},kpi_ReadingKpiTemplatesvue_type_script_lang_js=ReadingKpiTemplatesvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(kpi_ReadingKpiTemplatesvue_type_script_lang_js,render,staticRenderFns,!1,null,"430bb50a",null)
/* harmony default export */,ReadingKpiTemplates=component.exports},
/***/441243:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return AddModuleKpi}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/kpi/components/AddModuleKpi.vue?vue&type=template&id=374aa6e0&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{visible:!0,fullscreen:!0,"append-to-body":!0,"custom-class":"fc-dialog-form fc-dialog-right setup-dialog50 setup-dialog","before-close":_vm.closeDialog}},[_c("div",{staticClass:"kpi-modal"},[_c("el-form",{ref:"categoryForm",staticClass:"fc-form",attrs:{model:_vm.newkpi,rules:_vm.rules,"label-position":"top"}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(" "+_vm._s(_vm.isNew?_vm.$t("common._common.new"):_vm.$t("common._common._edit"))+_vm._s(_vm.$t("common.header.kpi_definition"))+" ")])])]),_c("div",{staticClass:"new-body-modal enpi-body-modal"},[_c("div",{staticClass:"body-scroll pR10"},[_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.module"))+" ")]),_c("el-form-item",{attrs:{prop:"moduleObj"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:!_vm.isNew,placeholder:_vm.$t("common.header.please_select_the_module"),filterable:""},on:{change:function($event){return _vm.loadFields()}},model:{value:_vm.newkpi.moduleObj,callback:function($$v){_vm.$set(_vm.newkpi,"moduleObj",$$v)},expression:"newkpi.moduleObj"}},_vm._l(_vm.modulesObjList,(function(moduleObj,index){return _c("el-option-group",{key:index,attrs:{label:moduleObj.label}},_vm._l(moduleObj.list,(function(list){return _c("el-option",{key:list.moduleName,attrs:{label:list.label,value:list.moduleName}})})),1)})),1)],1)],1)],1),_c("el-row",{staticClass:"mB10",attrs:{gutter:20}},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common._common.kpi_name"))+" ")]),_c("el-form-item",{attrs:{prop:"name"}},[_c("el-input",{staticClass:"width50 fc-input-full-border2",attrs:{autofocus:"",type:"text",autocomplete:"off",placeholder:_vm.$t("common._common.enter_kpi_name")},model:{value:_vm.newkpi.name,callback:function($$v){_vm.$set(_vm.newkpi,"name",$$v)},expression:"newkpi.name"}})],1)],1)],1),_c("el-row",{staticClass:"mB10",attrs:{gutter:20}},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.report_description"))+" ")]),_c("el-form-item",[_c("el-input",{staticClass:"width100 fc-input-full-border-textarea",attrs:{type:"textarea",autosize:{minRows:4,maxRows:4},placeholder:_vm.$t("common._common.enter_desc"),resize:"none"},model:{value:_vm.newkpi.description,callback:function($$v){_vm.$set(_vm.newkpi,"description",$$v)},expression:"newkpi.description"}})],1)],1)],1),_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.products.site"))+" ")]),_c("Lookup",{attrs:{field:_vm.siteField,hideLookupIcon:!0,disabled:!_vm.isNew},model:{value:_vm.newkpi.siteId,callback:function($$v){_vm.$set(_vm.newkpi,"siteId",$$v)},expression:"newkpi.siteId"}})],1)],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"mT40 mB10 fbTitle"},[_vm._v(" "+_vm._s(_vm.$t("common._common._criteria"))+" ")]),_c("el-form-item",{attrs:{prop:"criteria"}},[_vm.showCriteria?_c("criteria-builder",{ref:"criteriaBuilder",staticClass:"stateflow-criteria",attrs:{moduleName:_vm.newkpi.moduleObj,disable:_vm.$validation.isEmpty(_vm.newkpi.moduleObj),isOneLevelEnabled:!0},model:{value:_vm.newkpi.criteria,callback:function($$v){_vm.$set(_vm.newkpi,"criteria",$$v)},expression:"newkpi.criteria"}}):_vm._e()],1)],1)],1),_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"mT20 mB10 fbTitle"},[_vm._v(_vm._s(_vm.$t("common.tabs.metric")))]),_c("el-form-item",{attrs:{prop:"metric"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:_vm.$validation.isEmpty(_vm.newkpi.moduleObj),placeholder:_vm.$t("common.header.please_select_the_metric"),filterable:""},model:{value:_vm.newkpi.metric,callback:function($$v){_vm.$set(_vm.newkpi,"metric",$$v)},expression:"newkpi.metric"}},_vm._l(_vm.metrics,(function(metric,index){return _c("el-option",{key:index,attrs:{label:metric.displayName,value:metric.name}})})),1)],1)],1),_vm.newkpi.metric&&"count"!==_vm.newkpi.metric?_c("el-col",{staticClass:"mL20 mT9",attrs:{span:2}},[_c("div",{staticClass:"fc-input-div-full-border-f14-1 pointer mT25"},[_c("el-popover",{attrs:{disabled:!_vm.showMetricAggregation(_vm.newkpi.metric),placement:"bottom",width:"70",trigger:"click","popper-class":"metric-popover"},model:{value:_vm.toggleMetricAggregation,callback:function($$v){_vm.toggleMetricAggregation=$$v},expression:"toggleMetricAggregation"}},[_vm._l(_vm.metricAggregation,(function(metricAggr){return _c("div",{key:metricAggr.value,staticClass:"pointer pT5 pB5 fc-label-hover label-txt-black f14 text-center",class:{active:_vm.newkpi.aggr===metricAggr.value},attrs:{value:metricAggr.value},on:{click:function($event){return _vm.setMetricAggregation(metricAggr.value)}}},[_vm._v(" "+_vm._s(metricAggr.label)+" ")])})),_c("img",{staticClass:"p15",attrs:{slot:"reference",disabled:!_vm.showMetricAggregation(_vm.newkpi.metric),src:__webpack_require__(667527)},slot:"reference"})],2)],1)]):_vm._e()],1),_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:24}},[_c("p",{staticClass:"mT20 mB10 fbTitle"},[_vm._v(" "+_vm._s(_vm.$t("common.header.date_filter"))+" ")]),_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.date_picker.date_field"))+" ")]),_c("el-form-item",{attrs:{prop:"selectedTimeField"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:_vm.$validation.isEmpty(_vm.newkpi.moduleObj),placeholder:_vm.$t("common.header.please_select_the_date_field"),filterable:""},on:{change:function($event){_vm.newkpi.dateOperator=22}},model:{value:_vm.newkpi.selectedTimeField,callback:function($$v){_vm.$set(_vm.newkpi,"selectedTimeField",$$v)},expression:"newkpi.selectedTimeField"}},[_vm._l(_vm.dateFields,(function(time,index){return _c("el-option",{key:index,attrs:{label:time.displayName,value:time.name}})})),_c("el-option",{attrs:{label:_vm.$t("common.wo_report.none"),value:-1}})],2)],1)],1)],1)],1),_vm.$validation.isEmpty(_vm.newkpi.selectedTimeField)?_vm._e():_c("el-row",{staticClass:"mB10"},[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.period"))+" ")]),_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:_vm.$validation.isEmpty(_vm.newkpi.selectedTimeField),placeholder:_vm.$t("common.header.please_select_the_period"),filterable:""},model:{value:_vm.newkpi.dateOperator,callback:function($$v){_vm.$set(_vm.newkpi,"dateOperator",$$v)},expression:"newkpi.dateOperator"}},_vm._l(_vm.dateOperators,(function(dateRange,index){return _c("el-option",{key:index,attrs:{label:dateRange.label,value:dateRange.value}})})),1)],1),20===_vm.newkpi.dateOperator?_c("el-col",{staticClass:"pL20",attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.date_picker.date_range"))+" ")]),_c("el-form-item",{staticClass:"kpi-date-picker-width",attrs:{prop:"dateRange"}},[_c("f-date-picker",{attrs:{"start-placeholder":_vm.$t("common.wo_report.start_date"),"end-placeholder":_vm.$t("common.wo_report.end_date"),"picker-options":_vm.dateOptions,type:"datetimerange"},model:{value:_vm.newkpi.dateRange,callback:function($$v){_vm.$set(_vm.newkpi,"dateRange",$$v)},expression:"newkpi.dateRange"}})],1)],1):_vm._e()],1),_c("el-row",{staticClass:"mB20"},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"mB20 mT40 fbTitle"},[_vm._v(" "+_vm._s(_vm.$t("common._common.safe_limit"))+" ")]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.safeLimitTypes.MIN,value:_vm.safeLimitTypes.MIN},model:{value:_vm.safeLimitType,callback:function($$v){_vm.safeLimitType=$$v},expression:"safeLimitType"}},[_vm._v(_vm._s(_vm.$t("common._common.less_then")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.safeLimitTypes.MAX,value:_vm.safeLimitTypes.MAX},model:{value:_vm.safeLimitType,callback:function($$v){_vm.safeLimitType=$$v},expression:"safeLimitType"}},[_vm._v(_vm._s(_vm.$t("common._common.greater_than")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.safeLimitTypes.BETWEEN,value:_vm.safeLimitTypes.BETWEEN},model:{value:_vm.safeLimitType,callback:function($$v){_vm.safeLimitType=$$v},expression:"safeLimitType"}},[_vm._v(_vm._s(_vm.$t("common._common.between")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.safeLimitTypes.NONE,value:_vm.safeLimitTypes.NONE},model:{value:_vm.safeLimitType,callback:function($$v){_vm.safeLimitType=$$v},expression:"safeLimitType"}},[_vm._v(_vm._s(_vm.$t("common.wo_report.none")))])],1)],1),_c("el-row",[_vm.safeLimitType===_vm.safeLimitTypes.MIN?_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"target"}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"number",placeholder:_vm.$t("common._common.enter_maximum_target_value")},model:{value:_vm.newkpi.target,callback:function($$v){_vm.$set(_vm.newkpi,"target",$$v)},expression:"newkpi.target"}})],1)],1):_vm.safeLimitType===_vm.safeLimitTypes.MAX?_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"minTarget"}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"number",placeholder:_vm.$t("common._common.enter_minimum_target_value")},model:{value:_vm.newkpi.minTarget,callback:function($$v){_vm.$set(_vm.newkpi,"minTarget",$$v)},expression:"newkpi.minTarget"}})],1)],1):_vm.safeLimitType===_vm.safeLimitTypes.BETWEEN?_c("el-col",{attrs:{span:24}},[_c("el-col",{staticClass:"pR5",attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"minTarget"}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"number",placeholder:_vm.$t("common._common.enter_minimum_target_value")},model:{value:_vm.newkpi.minTarget,callback:function($$v){_vm.$set(_vm.newkpi,"minTarget",$$v)},expression:"newkpi.minTarget"}})],1)],1),_c("el-col",{staticClass:"pL5",attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"target"}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{type:"number",placeholder:_vm.$t("common._common.enter_maximum_target_value")},model:{value:_vm.newkpi.target,callback:function($$v){_vm.$set(_vm.newkpi,"target",$$v)},expression:"newkpi.target"}})],1)],1)],1):_c("el-col",{attrs:{span:24}})],1)],1)]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:function($event){return _vm.submitForm()}}},[_vm._v(_vm._s(_vm.saving?_vm.$t("common._common._saving"):_vm.$t("common._common._save")))])],1)])],1)])},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),slicedToArray=__webpack_require__(554621),objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),AddKpi=(__webpack_require__(186466),__webpack_require__(260228),__webpack_require__(821057),__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(659749),__webpack_require__(386544),__webpack_require__(634338),__webpack_require__(336585),__webpack_require__(450886),__webpack_require__(538077),__webpack_require__(169251)),validation=__webpack_require__(990260),DateHelper=__webpack_require__(281230),FDatePicker=__webpack_require__(358551),kpiConstants=__webpack_require__(361251),api=__webpack_require__(32284),dist=__webpack_require__(191853),AddModuleKpivue_type_script_lang_js={name:"AddModuleKpi",extends:AddKpi/* default */.Z,components:{CriteriaBuilder:dist/* CriteriaBuilder */.IP,FDatePicker:FDatePicker/* default */.Z},mixins:[DateHelper/* default */.Z],props:["kpi"],data:function(){return{showCriteria:!0,modulesObjList:[],dateOptions:{disabledDate:function(time){var today=new Date;return time.getTime()>today.getTime()}},dateOperators:[{label:"Today",value:22},{label:"Yesterday",value:25},{label:"This Week",value:31},{label:"This Week Until Now",value:47},{label:"Last Week",value:30},{label:"This Month",value:28},{label:"This Month Till Yesterday",value:66},{label:"This Month Until Now",value:48},{label:"Last Month",value:27},{label:"Range",value:20},{label:"This Year",value:44},{label:"This Year upto Now",value:46},{label:"Last Year",value:45}],dateFields:null,metrics:null,newkpi:{name:"",description:"",siteId:null,triggerType:1,formulaFieldType:1,resultDataType:3,moduleObj:"workorder",metric:null,aggr:-1,selectedTimeField:-1,dateOperator:null,dateRange:null,criteria:null,target:null,minTarget:null},metricAggregation:[{label:"SUM",value:3,name:"sum"},{label:"AVG",value:2,name:"avg"},{label:"MIN",value:4,name:"min"},{label:"MAX",value:5,name:"max"}],toggleMetricAggregation:!1,criteriaRendered:!1,rules:{name:{required:!0,message:this.$t("common._common.please_enter_a_name"),trigger:"change"},moduleObj:{required:!0,message:this.$t("common.header.please_select_a_module"),trigger:"change"},metric:{required:!0,message:this.$t("common.header.please_select_metric"),trigger:"change"},criteria:{validator:function(rule,value,callback){var conditions=this.newkpi.criteria.conditions,criteriaObjValues=Object.values(conditions),throwError=criteriaObjValues.every((function(field){if(!(0,validation/* isEmpty */.xb)(field)){var _field$active=field.active,active=void 0!==_field$active&&_field$active,fieldName=field.fieldName,operatorId=field.operatorId,_value=field.value;if(!(0,validation/* isEmpty */.xb)(fieldName)&&!(0,validation/* isEmpty */.xb)(operatorId)){if(!active)return!1;if(!(0,validation/* isEmpty */.xb)(_value))return!1}}return!0}));throwError?callback(new Error(this.$t("common.header.please_configure_atleast_one_criteria"))):callback()}.bind(this),trigger:"change"},target:{validator:function(rule,value,callback){this.safeLimitType!==this.safeLimitTypes.MIN&&this.safeLimitType!==this.safeLimitTypes.BETWEEN||((0,validation/* isEmpty */.xb)(this.newkpi.target)?callback(new Error(this.$t("common._common.fields_cannot_be_empty"))):callback())}.bind(this),trigger:"change"},minTarget:{validator:function(rule,value,callback){this.safeLimitType!==this.safeLimitTypes.MAX&&this.safeLimitType!==this.safeLimitTypes.BETWEEN||((0,validation/* isEmpty */.xb)(this.newkpi.minTarget)?callback(new Error(this.$t("common._common.fields_cannot_be_empty"))):callback())}.bind(this),trigger:"change"}}}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.loadModules();case 2:_this.init(),_this.loadFields();case 4:case"end":return _context.stop()}}),_callee)})))()},methods:{init:function(){var _this2=this;if(this.newkpi=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.newkpi),this.$helpers.cloneObject(this.kpi)),!this.isNew){var moduleName=this.newkpi.moduleName;this.newkpi.moduleObj=moduleName,delete this.newkpi.moduleName;var metric=this.newkpi.metric;this.newkpi.metric=metric.name;var dateFieldId=this.newkpi.dateFieldId;(0,validation/* isEmpty */.xb)(dateFieldId)||this.loadDateFields().then((function(dateFields){var time=dateFields.find((function(time){return time.id===dateFieldId}));_this2.newkpi.selectedTimeField=time.name}));var dateValue=this.newkpi.dateValue;(0,validation/* isEmpty */.xb)(dateValue)||(dateValue=dateValue.split(","),this.newkpi.dateRange=[],dateValue.forEach((function(date){_this2.newkpi.dateRange.push(parseInt(date))})));var _this$newkpi=this.newkpi,minTarget=_this$newkpi.minTarget,target=_this$newkpi.target;minTarget=(0,validation/* isEmpty */.xb)(minTarget)?null:minTarget,target=(0,validation/* isEmpty */.xb)(target)?null:target,(0,validation/* isEmpty */.xb)(minTarget)&&(0,validation/* isEmpty */.xb)(target)?this.safeLimitType=this.safeLimitTypes.NONE:(0,validation/* isEmpty */.xb)(minTarget)||(0,validation/* isEmpty */.xb)(target)?(0,validation/* isEmpty */.xb)(target)?this.safeLimitType=this.safeLimitTypes.MAX:this.safeLimitType=this.safeLimitTypes.MIN:this.safeLimitType=this.safeLimitTypes.BETWEEN,this.$set(this.newkpi,"minTarget",minTarget),this.$set(this.newkpi,"target",target)}},submitForm:function(){var _this3=this;this.$refs["categoryForm"].validate((function(valid){if(!valid)return!1;null===_this3.newkpi.siteId&&(_this3.newkpi.siteId=-1);var url="/v2/kpi/module/addOrUpdate",kpiObj=_this3.$helpers.cloneObject(_this3.newkpi),criteria=kpiObj.criteria,isValidateCriteria=_this3.$refs["criteriaBuilder"].validate();if(isValidateCriteria){var id=kpiObj.id,name=kpiObj.name,description=kpiObj.description,siteId=kpiObj.siteId,moduleName=kpiObj.moduleObj,metric=kpiObj.metric,aggr=kpiObj.aggr,dateOperator=kpiObj.dateOperator,minTarget=kpiObj.minTarget,target=kpiObj.target,dateRange=kpiObj.dateRange,dateFieldId=_this3.newkpi.selectedTimeField;if(!(0,validation/* isEmpty */.xb)(_this3.newkpi.selectedTimeField)){var _this3$dateFields$fin=_this3.dateFields.find((function(time){return time.name===_this3.newkpi.selectedTimeField})),_id=_this3$dateFields$fin.id;dateFieldId=_id}var kpi={name:name,description:description,siteId:siteId,moduleName:moduleName,criteria:criteria,metricName:metric},metricObj=_this3.metrics.find((function(metric){return metric.name===_this3.newkpi.metric}));if((0,validation/* isEmpty */.xb)(metricObj.id)||(kpi.metricId=metricObj.id),minTarget&&(kpi.minTarget=minTarget),target&&(kpi.target=target),"count"!==metric&&(kpi.aggr=(0,validation/* isEmpty */.xb)(aggr)?3:aggr),(0,validation/* isEmpty */.xb)(dateFieldId)?kpi.dateFieldId=-99:kpi.dateFieldId=dateFieldId,(0,validation/* isEmpty */.xb)(dateFieldId)?kpi.dateOperator=-99:dateOperator&&(kpi.dateOperator=dateOperator),id&&(kpi.id=id),!(0,validation/* isEmpty */.xb)(dateRange)){var dateValue="".concat(dateRange[0],",").concat(dateRange[1]);kpi.dateValue=dateValue}var param={kpi:kpi},showError=function(){_this3.$message.error(_this3.isNew?_this3.$t("common.header.kpi_addition_failed"):_this3.$t("common.header.kpi_updation_failed"))};_this3.saving=!0,_this3.$http.post(url,param).then((function(response){_this3.saving=!1,0===response.data.responseCode?(_this3.$message.success(_this3.isNew?_this3.$t("common.products.new_kpi_added_successfully"):_this3.$t("common.header.kpi_updated_successfully")),_this3.$emit("onSave",response.data.result.kpi||kpi),_this3.$emit("onClose")):showError()})).catch((function(){_this3.saving=!1,showError()}))}}))},loadModules:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _yield$API$get,error,data,modulesListKey;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api/* API */.bl.get("/v3/modules/list/all");case 2:_yield$API$get=_context2.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?_this4.$message.error(error.message):(modulesListKey={systemModules:"System Modules",customModules:"Custom Modules"},Object.entries(modulesListKey).forEach((function(_ref){var _ref2=(0,slicedToArray/* default */.Z)(_ref,2),key=_ref2[0],value=_ref2[1],list=data[key].map((function(list){return{moduleName:list.name,label:list.displayName}}));"systemModules"===key&&(list=[].concat((0,toConsumableArray/* default */.Z)(list),(0,toConsumableArray/* default */.Z)((0,kpiConstants/* getModules */.h)().filter((function(module){return!0===_this4.$helpers.isLicenseEnabled(module.license)}))))),_this4.modulesObjList.push({list:list,label:value})})));case 6:case"end":return _context2.stop()}}),_callee2)})))()},loadFields:function(){var _this5=this;this.showCriteria=!1;var promise=[];return promise.push(this.loadDateFields()),promise.push(this.loadMetrics()),this.$nextTick((function(){_this5.showCriteria=!0,_this5.$refs["criteriaBuilder"]&&_this5.$refs["criteriaBuilder"].forceUpdate()})),promise},loadDateFields:function(){var _this6=this,url="/v3/report/fields?moduleName=".concat(this.newkpi.moduleObj);return api/* API */.bl.get(url).then((function(response){if(!response.error){var meta=response.data.meta,dateField=meta.dimension.time||[],filteredDateField=dateField.filter((function(field){return field.id>0}));return _this6.dateFields=filteredDateField,_this6.dateFields}_this6.$message.error("Error while getting fields")})).catch((function(){_this6.dateFields=[]}))},loadMetrics:function(){var _this7=this,url="v2/kpi/module/metrics?moduleName=".concat(this.newkpi.moduleObj);return this.$http.get(url).then((function(_ref3){var data=_ref3.data;if(0===data.responseCode){var metrics=data.result.metrics;return _this7.metrics=metrics,_this7.isNew&&(_this7.newkpi.metric="count"),metrics}})).catch((function(){_this7.metrics=[]}))},showMetricAggregation:function(metric){return!metric||!metric.defaultMetric||(this.toggleMetricAggregation=!1,!1)},setMetricAggregation:function(metricAggrValue){this.newkpi.aggr=metricAggrValue,this.toggleMetricAggregation=!1}}},components_AddModuleKpivue_type_script_lang_js=AddModuleKpivue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_AddModuleKpivue_type_script_lang_js,render,staticRenderFns,!1,null,"374aa6e0",null)
/* harmony default export */,AddModuleKpi=component.exports},
/***/655857:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return ReadingKpiViews}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/readingkpi/ReadingKpiViews.vue?vue&type=template&id=61aebbdb&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("ul",{staticClass:"subheader-tabs pull-left pB10"},_vm._l(_vm.views,(function(item){return _c("router-link",{key:item.name,attrs:{tag:"li",to:item.path,"active-class":"active"}},[_c("a",[_vm._v(_vm._s(item.label))]),_c("div",{staticClass:"sh-selection-bar"})])})),1)},staticRenderFns=[],defineProperty=__webpack_require__(482482),router=(__webpack_require__(434284),__webpack_require__(329435)),ReadingKpiViewsvue_type_script_lang_js={methods:{getroutePath:function(pageType,isLive){if(!(0,router/* isWebTabsEnabled */.tj)()){var _pagetypeVsPath,pagetypeVsPath=(_pagetypeVsPath={},(0,defineProperty/* default */.Z)(_pagetypeVsPath,router/* pageTypes */.As.NEW_READING_KPI_LIST,"/app/em/readingKpi/list/".concat(isLive?"live":"scheduled")),(0,defineProperty/* default */.Z)(_pagetypeVsPath,router/* pageTypes */.As.MODULE_KPI,"/app/em/readingKpi/module/list"),_pagetypeVsPath);return pagetypeVsPath[pageType]}"MODULE_KPI"===pageType&&(pageType="NEW_MODULE_KPI");var _ref=(0,router/* findRouteForTab */.OD)(pageType)||{},name=_ref.name;if(name)return{name:name,params:{kpiType:isLive?"live":"scheduled"}}}},data:function(){return{views:[{name:"moduleKpi",label:this.$t("common._common.module_kpi"),path:this.getroutePath(router/* pageTypes */.As.MODULE_KPI)},{name:"liveReadingKpilist",label:this.$t("kpi.kpi.live_kpi"),path:this.getroutePath(router/* pageTypes */.As.NEW_READING_KPI_LIST,!0)},{name:"scheduledReadingKpilist",label:this.$t("kpi.kpi.scheduled_kpi"),path:this.getroutePath(router/* pageTypes */.As.NEW_READING_KPI_LIST,!1)}]}}},readingkpi_ReadingKpiViewsvue_type_script_lang_js=ReadingKpiViewsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(readingkpi_ReadingKpiViewsvue_type_script_lang_js,render,staticRenderFns,!1,null,"61aebbdb",null)
/* harmony default export */,ReadingKpiViews=component.exports},
/***/667527:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"00e2f8b54392f5c9d15bf4a60fcf5285.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/61282.js.map