"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[13427],{
/***/760218:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PageBuilder}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/PageBuilder.vue?vue&type=template&id=0dd0982f
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.showPage&&_vm.pagebuilderComponent?_c(_vm.pagebuilderComponent,_vm._b({tag:"component",attrs:{module:_vm.module},on:{forceOldPage:function($event){_vm.forceOld=!0}}},"component",_vm.$attrs,!1)):_vm._e()},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),vuex_esm=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(420629)),PageBuildervue_type_script_lang_js={props:["module"],data:function(){return{forceOld:!1,showPage:!1}},components:{NewPageBuilder:function(){return Promise.all(/* import() */[__webpack_require__.e(93208),__webpack_require__.e(50232),__webpack_require__.e(93765),__webpack_require__.e(95953),__webpack_require__.e(35309),__webpack_require__.e(18778),__webpack_require__.e(12303),__webpack_require__.e(84290),__webpack_require__.e(31721),__webpack_require__.e(64418),__webpack_require__.e(5603),__webpack_require__.e(57432),__webpack_require__.e(435),__webpack_require__.e(72230),__webpack_require__.e(94255),__webpack_require__.e(67683),__webpack_require__.e(44178),__webpack_require__.e(91132),__webpack_require__.e(20280),__webpack_require__.e(78256),__webpack_require__.e(22200),__webpack_require__.e(49081),__webpack_require__.e(89472),__webpack_require__.e(12085),__webpack_require__.e(55754),__webpack_require__.e(86494),__webpack_require__.e(3037),__webpack_require__.e(49908),__webpack_require__.e(22061),__webpack_require__.e(31602),__webpack_require__.e(73609),__webpack_require__.e(44119),__webpack_require__.e(88262),__webpack_require__.e(82080),__webpack_require__.e(88506)]).then(__webpack_require__.bind(__webpack_require__,110570))},OldPageBuilder:function(){return Promise.all(/* import() */[__webpack_require__.e(93208),__webpack_require__.e(50232),__webpack_require__.e(93765),__webpack_require__.e(95953),__webpack_require__.e(35309),__webpack_require__.e(18778),__webpack_require__.e(12303),__webpack_require__.e(84290),__webpack_require__.e(31721),__webpack_require__.e(64418),__webpack_require__.e(5603),__webpack_require__.e(57432),__webpack_require__.e(435),__webpack_require__.e(72230),__webpack_require__.e(94255),__webpack_require__.e(67683),__webpack_require__.e(44178),__webpack_require__.e(91132),__webpack_require__.e(20280),__webpack_require__.e(78256),__webpack_require__.e(22200),__webpack_require__.e(49081),__webpack_require__.e(89472),__webpack_require__.e(12085),__webpack_require__.e(55754),__webpack_require__.e(86494),__webpack_require__.e(3037),__webpack_require__.e(49908),__webpack_require__.e(22061),__webpack_require__.e(31602),__webpack_require__.e(73609),__webpack_require__.e(23803),__webpack_require__.e(55246)]).then(__webpack_require__.bind(__webpack_require__,223803))}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(_context.prev=0,!_this.$helpers.isLicenseEnabled("PAGE_BUILDER")){_context.next=4;break}return _context.next=4,_this.$store.dispatch("pagebuilder/loadNewPageEnabledModules");case 4:_context.next=8;break;case 6:_context.prev=6,_context.t0=_context["catch"](0);case 8:_this.$nextTick((function(){_this.showPage=!0}));case 9:case"end":return _context.stop()}}),_callee,null,[[0,6]])})))()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({newPageEnabledModules:function(state){return state.pagebuilder.newPageEnabledModules}})),{},{pagebuilderComponent:function(){var newPageEnabledModules=this.newPageEnabledModules,module=this.module,forceOld=this.forceOld,isNew=(newPageEnabledModules||[]).includes(module),showNew=!forceOld&&(this.showNewPageBuilder||isNew);return showNew?"NewPageBuilder":"OldPageBuilder"},showNewPageBuilder:function(){var query=this.$route.query,_query$showNewPageBui=query.showNewPageBuilder,showNewPageBuilder=void 0!==_query$showNewPageBui&&_query$showNewPageBui;return!0===showNewPageBuilder||"true"===showNewPageBuilder}})},page_PageBuildervue_type_script_lang_js=PageBuildervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(page_PageBuildervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PageBuilder=component.exports},
/***/987612:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return TransitionButtons}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/stateflow/TransitionButtons.vue?vue&type=template&id=cca90304&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"display-flex",class:_vm.rootClass},[_vm.hasTransitionBtns?_c("div",{staticClass:"d-flex"},[_c("div",{staticClass:"stateflow-btn-wrapper mL10"},[_c("async-button",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{buttonType:"primary",buttonClass:_vm.asyncBtnClassName,disable:_vm.transitions.featured[0].scheduled,clickAction:_vm.startTransition,actionParams:[_vm.transitions.featured[0]],disabled:_vm.isDisabled,"data-test-selector":_vm.transitions.featured[0].name,title:""+_vm.transitions.featured[0].name,loading:_vm.firstBtnLoading}},[_vm._v(" "+_vm._s(_vm.transitions.featured[0].name)+" ")])],1),_vm.hasDropDownBtns?_c("div",{staticClass:"mL10"},[_c("el-dropdown",{staticClass:"pointer stateflow-btn-wrapper",attrs:{"split-button":"","data-test-selector":_vm.transitions.featured[1].name,disabled:_vm.isDisabled},on:{click:function($event){return _vm.initiateDropdownTransition(_vm.transitions.featured[1])},command:_vm.initiateDropdownTransition}},[_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"transition-btn-name",attrs:{title:""+_vm.transitions.featured[1].name}},[_vm.dropdownLoading?_c("span",[_c("i",{staticClass:"el-icon-loading"}),_vm._v(" "+_vm._s(_vm.$t("common._common.loading"))+" ")]):_c("span",[_vm._v(_vm._s(_vm.transitions.featured[1].name))])]),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},_vm._l(_vm.transitions.dropdown,(function(transition,index){return _c("el-dropdown-item",{key:index,attrs:{command:transition,disabled:_vm.isDisabled,"data-test-selector":transition.name}},[_vm._v(" "+_vm._s(transition.name)+" ")])})),1)],1)],1):_vm.hasOnly2Btns?_c("div",{staticClass:"stateflow-btn-wrapper mL10"},[_c("async-button",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{buttonClass:_vm.asyncBtnClassName,disable:_vm.transitions.featured[1].scheduled,clickAction:_vm.startTransition,actionParams:[_vm.transitions.featured[1]],disabled:_vm.isDisabled,"data-test-selector":_vm.transitions.featured[1].name,title:""+_vm.transitions.featured[1].name,loading:_vm.lastBtnLoading}},[_vm._v(" "+_vm._s(_vm.transitions.featured[1].name)+" ")])],1):_vm._e()]):_vm._e(),_vm.canShowForm?_c("TransitionForm",_vm._b({},"TransitionForm",_vm.transitionFormProps,!1)):_vm._e(),_vm.showConfirmationDialog?_c("ConfirmationDialog",{attrs:{transition:_vm.selectedTransition,confirmations:_vm.confirmationDialogs,onConfirm:_vm.continueTransition,onCancel:_vm.cancelTransition}}):_vm._e()],1)},staticRenderFns=[],defineProperty=__webpack_require__(482482),objectSpread2=__webpack_require__(595082),slicedToArray=__webpack_require__(554621),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),api=(__webpack_require__(865137),__webpack_require__(976801),__webpack_require__(689730),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(336585),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(32284)),AsyncButton=__webpack_require__(303514),TransitionForm=__webpack_require__(323796),TransitionConfirmationsvue_type_template_id_08a79305_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{visible:_vm.dialogVisible,title:_vm.activeDialog.title,width:"540px","custom-class":"confirmation-dialog","append-to-body":"","close-on-click-modal":!1,"before-close":_vm.activeDialog.cancel},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c("div",{staticClass:"message-block"},[_vm._v(" "+_vm._s(_vm.activeDialog.message)+" ")]),_c("div",{staticClass:"dialog-footer"},[_c("el-button",{staticClass:"btn btn--secondary cancel-btn",attrs:{type:"button"},on:{click:_vm.activeDialog.cancel}},[_vm._v(" Cancel ")]),_c("el-button",{staticClass:"btn btn--primary btn--danger delete-btn",attrs:{type:"button",disabled:_vm.loadingOnConfirm,loading:_vm.loadingOnConfirm},on:{click:_vm.activeDialog.proceed}},[_vm._v(" Confirm ")])],1)])},TransitionConfirmationsvue_type_template_id_08a79305_staticRenderFns=[],TransitionConfirmationsvue_type_script_lang_js={props:["confirmations","onConfirm","onCancel"],data:function(){return{dialogVisible:!1,activeDialog:null,currentIndex:0,loadingOnConfirm:!1}},watch:{confirmations:{handler:"startConfirmation",immediate:!0}},methods:{startConfirmation:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var confirmations,currentIndex,delay,dialog,dialogObj;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:confirmations=_this.confirmations,currentIndex=_this.currentIndex,delay=_this.$helpers.delay,dialog=confirmations[currentIndex],dialogObj={title:dialog.name,message:dialog.message,proceed:function(){var _proceed=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(currentIndex!==confirmations.length-1){_context.next=9;break}return _this.loadingOnConfirm=!0,_context.next=4,_this.onConfirm();case 4:_this.loadingOnConfirm=!1,_this.dialogVisible=!1,_this.currentIndex=0,_context.next=12;break;case 9:_this.currentIndex+=1,_this.dialogVisible=!1,delay(200).then((function(){return _this.startConfirmation()}));case 12:case"end":return _context.stop()}}),_callee)})));function proceed(){return _proceed.apply(this,arguments)}return proceed}(),cancel:function(){var _cancel=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_this.dialogVisible=!1,_this.currentIndex=0,_this.onCancel();case 3:case"end":return _context2.stop()}}),_callee2)})));function cancel(){return _cancel.apply(this,arguments)}return cancel}()},_this.activeDialog=dialogObj,_this.$nextTick((function(){return _this.dialogVisible=!0}));case 5:case"end":return _context3.stop()}}),_callee3)})))()}}},stateflow_TransitionConfirmationsvue_type_script_lang_js=TransitionConfirmationsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionConfirmationsvue_type_script_lang_js,TransitionConfirmationsvue_type_template_id_08a79305_render,TransitionConfirmationsvue_type_template_id_08a79305_staticRenderFns,!1,null,null,null)
/* harmony default export */,TransitionConfirmations=component.exports,validation=__webpack_require__(990260),cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),TransitionButtonsUtils=__webpack_require__(982072),TransitionButtonsvue_type_script_lang_js={props:["moduleName","record","updateFn","updateUrl","transformFn","transitionFilter","buttonClass","disabled","hideNotifications"],components:{AsyncButton:AsyncButton/* default */.Z,TransitionForm:TransitionForm/* default */.Z,ConfirmationDialog:TransitionConfirmations},created:function(){this.fetchAvailableStates()},data:function(){return{stateTransitions:null,loading:!1,canShowForm:!1,selectedTransition:null,dataForCurrentTransition:null,confirmationDialogs:null,showConfirmationDialog:!1,dropdownLoading:!1,selectedTransitionActions:null,firstBtnLoading:!1,lastBtnLoading:!1}},computed:{isV3:function(){var moduleName=this.moduleName,updateUrl=this.updateUrl;return!(0,validation/* isEmpty */.xb)(moduleName)&&(0,validation/* isEmpty */.xb)(updateUrl)},transitions:function(){if((0,validation/* isEmpty */.xb)(this.stateTransitions))return null;var transitions=(0,toConsumableArray/* default */.Z)(this.stateTransitions).sort((function(first,second){
// sorts array in ascending order but placing all '-1' values at the end
return[-1,0,3].includes(first.buttonType)?1:[-1,0,3].includes(second.buttonType)?-1:first.buttonType-second.buttonType}));return{featured:transitions.slice(0,2)||[],dropdown:transitions.slice(2)||[]}},shouldCreateModuleRecord:function(){var _this$selectedTransit=this.selectedTransition,selectedTransition=void 0===_this$selectedTransit?{}:_this$selectedTransit,_ref=selectedTransition||{},_ref$dialogType=_ref.dialogType,dialogType=void 0===_ref$dialogType?null:_ref$dialogType,formModuleName=_ref.formModuleName;return!(0,validation/* isEmpty */.xb)(dialogType)&&!(0,validation/* isEmpty */.xb)(formModuleName)&&2===dialogType},shouldCreateNotes:function(){var _ref2=this.selectedTransition||{},form=_ref2.form;return 5===this.$getProperty(form,"module.type",null)},rootClass:function(){return""},isDisabled:function(){var loading=this.loading,disabled=this.disabled,dropdownLoading=this.dropdownLoading,firstBtnLoading=this.firstBtnLoading,lastBtnLoading=this.lastBtnLoading;return loading||disabled||dropdownLoading||firstBtnLoading||lastBtnLoading},hasTransitionBtns:function(){var _ref3=this.transitions||{},featured=_ref3.featured;return!(0,validation/* isEmpty */.xb)(featured)},hasDropDownBtns:function(){var _ref4=this.transitions||{},featured=_ref4.featured,dropdown=_ref4.dropdown;return this.hasTransitionBtns&&!(0,validation/* isEmpty */.xb)(dropdown)&&featured.length>1&&dropdown.length>0},hasOnly2Btns:function(){var _ref5=this.transitions||{},featured=_ref5.featured;return this.hasTransitionBtns&&featured.length>1},asyncBtnClassName:function(){var buttonClass=this.buttonClass,isDisabled=this.isDisabled;return"".concat(buttonClass," ").concat(isDisabled&&"disabled"," transition-btn-name")},transitionFormProps:function(){var selectedTransition=this.selectedTransition,record=this.record,shouldCreateModuleRecord=this.shouldCreateModuleRecord,saveDataForTransition=this.saveDataForTransition,cancelTransition=this.cancelTransition,isV3=this.isV3,_ref6=selectedTransition||{},moduleName=_ref6.moduleName,formId=_ref6.formId,_ref7=record||{},recordId=_ref7.id;return{moduleName:moduleName,recordId:recordId,formId:formId,record:record,isV3:isV3,transition:selectedTransition,isExternalModule:shouldCreateModuleRecord,saveAction:saveDataForTransition,closeAction:cancelTransition}}},watch:{moduleName:function(newVal,oldVal){newVal!==oldVal&&this.fetchAvailableStates()},record:function(newVal,oldVal){newVal!==oldVal&&this.fetchAvailableStates({force:!0})}},methods:{refresh:function(){this.fetchAvailableStates()},fetchAvailableStates:function(){var _arguments=arguments,_this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _ref8,_ref8$force,force,_yield$API$get,data,error,_ref9,_ref9$currentState,currentState,_ref9$states,states;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _ref8=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:{},_ref8$force=_ref8.force,force=void 0!==_ref8$force&&_ref8$force,_this.loading=!0,_context.next=4,api/* API */.bl.get("/v2/statetransition/getAvailableState",{moduleName:_this.moduleName,id:_this.record.id},{force:force});case 4:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this.stateTransitions=null:(_ref9=data||{},_ref9$currentState=_ref9.currentState,currentState=void 0===_ref9$currentState?null:_ref9$currentState,_ref9$states=_ref9.states,states=void 0===_ref9$states?[]:_ref9$states,currentState&&_this.$emit("currentState",currentState.id),(0,validation/* isEmpty */.xb)(_this.transitionFilter)||(0,validation/* isEmpty */.xb)(_this.states)||(states=states.filter(_this.transitionFilter)),_this.stateTransitions=states||[]),_this.loading=!1;case 9:case"end":return _context.stop()}}),_callee)})))()},startTransition:function(transition){var _ref10=this.transitions||{},featured=_ref10.featured;if(!this.dropdownLoading&&!(0,validation/* isEmpty */.xb)(featured)){var _ref11=featured[0]||{},firstTransitionId=_ref11.id,_ref12=featured[1]||{},lastTransitionId=_ref12.id,_ref13=transition||{},currentTransitionId=_ref13.id;this.firstBtnLoading=currentTransitionId===firstTransitionId,this.lastBtnLoading=currentTransitionId===lastTransitionId}var NOT_CONFIGURED=TransitionButtonsUtils/* actionStatusFlag */.Zj.NOT_CONFIGURED,YET_TO_START=TransitionButtonsUtils/* actionStatusFlag */.Zj.YET_TO_START;return this.selectedTransitionActions=Object.entries(TransitionButtonsUtils/* transitionBtnActions */._M||{}).reduce((function(actionList,_ref14){var _ref15=(0,slicedToArray/* default */.Z)(_ref14,2),action=_ref15[0],transKey=_ref15[1];return actionList[action]=(0,validation/* isEmpty */.xb)(transition[transKey])?NOT_CONFIGURED:YET_TO_START,actionList}),{}),this.selectedTransition=cloneDeep_default()(transition),this.startTransitionProcess()},startTransitionProcess:function(){var selectedTransitionActions=this.selectedTransitionActions,selectedTransition=this.selectedTransition,YET_TO_START=TransitionButtonsUtils/* actionStatusFlag */.Zj.YET_TO_START,IN_PROCESS=TransitionButtonsUtils/* actionStatusFlag */.Zj.IN_PROCESS,FAILED=TransitionButtonsUtils/* actionStatusFlag */.Zj.FAILED,isAnyActionFailed=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.some((function(action){return selectedTransitionActions[action]===FAILED})),currentRunningProcess=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.some((function(action){return selectedTransitionActions[action]===IN_PROCESS}));if(!isAnyActionFailed&&!currentRunningProcess){var nextProcessToStart=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.find((function(action){return selectedTransitionActions[action]===YET_TO_START}))||null;return(0,validation/* isEmpty */.xb)(nextProcessToStart)?this.continueTransition():(this.$set(this.selectedTransitionActions,nextProcessToStart,IN_PROCESS),"FORM"===nextProcessToStart?(this.showStateFlowForm(),Promise.resolve()):"CONFIRMATION"===nextProcessToStart?this.checkConfirmations(selectedTransition):void 0)}},saveDataForTransition:function(formData){return this.dataForCurrentTransition=cloneDeep_default()(formData),this.$set(this.selectedTransitionActions,"FORM",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),this.closeStateFlowForm(),this.startTransitionProcess()},checkConfirmations:function(transition){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var moduleName,record,params,dataForCurrentTransition,formData,_yield$API$post,error,data,validConfirmationDialogs;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return moduleName=_this2.moduleName,record=_this2.record,params={id:record.id,moduleName:moduleName,transitionId:transition.id},dataForCurrentTransition=_this2.dataForCurrentTransition,(0,validation/* isEmpty */.xb)(transition.formId)||(0,validation/* isEmpty */.xb)(dataForCurrentTransition)||(formData=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},dataForCurrentTransition),dataForCurrentTransition.data||{}),delete formData.data,params["data"]=formData),_context2.next=6,api/* API */.bl.post("v2/statetransition/confirmationDialogs",params);case 6:if(_yield$API$post=_context2.sent,error=_yield$API$post.error,data=_yield$API$post.data,!error){_context2.next=14;break}_this2.defaultResponseHandler({error:error}),_this2.cancelTransition(),_context2.next=22;break;case 14:if(validConfirmationDialogs=data.validConfirmationDialogs,(0,validation/* isEmpty */.xb)(validConfirmationDialogs)){_context2.next=20;break}_this2.confirmationDialogs=validConfirmationDialogs,_this2.showConfirmationDialog=!0,_context2.next=22;break;case 20:return _this2.$set(_this2.selectedTransitionActions,"CONFIRMATION",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),_context2.abrupt("return",_this2.startTransitionProcess());case 22:case"end":return _context2.stop()}}),_callee2)})))()},proceedAfterConfirmation:function(){this.$set(this.selectedTransitionActions,"CONFIRMATION",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),this.startTransitionProcess()},initiateDropdownTransition:function(transition){this.dropdownLoading=!0,this.startTransition(transition)},continueTransition:function(){var selectedTransition=this.selectedTransition,_this$dataForCurrentT=this.dataForCurrentTransition,formData=void 0===_this$dataForCurrentT?null:_this$dataForCurrentT;return this.transitionToState(formData,selectedTransition)},cancelTransition:function(){this.selectedTransition=null,this.dataForCurrentTransition=null,this.confirmationDialogs=null,this.dropdownLoading=!1,this.firstBtnLoading=!1,this.lastBtnLoading=!1,this.selectedTransitionActions=null,this.closeStateFlowForm(),this.closeConfirmationDialogs()},getParams:function(_ref16){var formData=_ref16.formData,transition=_ref16.transition,moduleName=this.moduleName,record=this.record,_ref17=record||{},id=_ref17.id,_ref18=transition||{},stateTransitionId=_ref18.id,formId=_ref18.formId,formModuleName=_ref18.formModuleName,serializedFormData=formData;if(this.shouldCreateModuleRecord&&(serializedFormData={relations:(0,defineProperty/* default */.Z)({},formModuleName,[{data:[(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formData),{},{formId:formId})]}])}),this.shouldCreateNotes||!this.isV3){var firstArg={moduleName:moduleName,id:id,stateTransitionId:stateTransitionId},secondArg=this.isV3||this.shouldCreateNotes?null:formData;return this.transformFn(firstArg,secondArg)}return{id:id,stateTransitionId:stateTransitionId,data:serializedFormData||{}}},transitionToState:function(formData,transition){var _this3=this;(0,validation/* isEmpty */.xb)(transition)&&(transition=this.selectedTransition);var url=this.getUrl(transition),params=this.getParams({formData:formData,transition:transition}),defaultResponseHandler=this.defaultResponseHandler,updateFn=this.updateFn,moduleName=this.moduleName,record=this.record;if(this.isV3){if(!(0,validation/* isEmpty */.xb)(updateFn)&&(0,validation/* isFunction */.mf)(updateFn))return updateFn(moduleName,params).then(defaultResponseHandler);var _ref19=record||{},recordId=_ref19.id,_url="v3/action/".concat(moduleName,"/").concat(recordId,"/transition");return api/* API */.bl.patch(_url,params).then(defaultResponseHandler)}return api/* API */.bl.post(url,params).then(function(){var _ref21=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(_ref20){var error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:error=_ref20.error,error?defaultResponseHandler({error:error}):_this3.shouldCreateNotes||_this3.shouldCreateModuleRecord?_this3.v2SubModuleHandler(formData,transition).then((function(){return defaultResponseHandler({})})).catch((function(){
// Edge case where transition is success but record creation fails
_this3.fetchAvailableStates({force:!0}),_this3.$emit("transitionSuccess"),defaultResponseHandler({error:{}})})):defaultResponseHandler({});case 2:case"end":return _context3.stop()}}),_callee3)})));return function(_x){return _ref21.apply(this,arguments)}}())},v2SubModuleHandler:function(formData,transition){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var shouldCreateNotes,shouldCreateModuleRecord,formModuleName;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(shouldCreateNotes=_this4.shouldCreateNotes,shouldCreateModuleRecord=_this4.shouldCreateModuleRecord,formModuleName=transition.formModuleName,!shouldCreateNotes){_context4.next=6;break}return _context4.abrupt("return",_this4.createNoteForModule(formModuleName,formData,transition));case 6:if(!shouldCreateModuleRecord){_context4.next=8;break}return _context4.abrupt("return",_this4.createRecordForModule(formModuleName,formData,transition));case 8:case"end":return _context4.stop()}}),_callee4)})))()},createNoteForModule:function(moduleName,formData){var _this5=this;return new Promise((function(resolve,reject){api/* API */.bl.post("v2/notes/add",{module:moduleName,ticketModuleName:_this5.moduleName,note:{parentId:_this5.record.id,notifyRequester:!1,body:formData.body}}).then((function(_ref22){var error=_ref22.error;error?reject():resolve()}))}))},createRecordForModule:function(moduleName,formData,transition){var data,_ref23=this.record||{},_ref23$siteId=_ref23.siteId,siteId=void 0===_ref23$siteId?null:_ref23$siteId,formId=transition.formId||null,form=transition.form,isCustomModule=this.$getProperty(form,"module.custom",!1);if(isCustomModule)data=(0,objectSpread2/* default */.Z)({moduleName:moduleName,withLocalId:!1},this.constructCustomModuleData({},formData,transition));else
// TODO MOVE to v3
if("workpermit"===moduleName){var datum=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formData),{},{ticket:{id:this.record.id}});(0,validation/* isEmpty */.xb)(siteId)||(datum.siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(datum.formId=formId),data={workPermitRecords:[datum]}}else{var formObj=this.constructWoModuleData(formData,transition);data={workorder:(0,objectSpread2/* default */.Z)({},formObj)},moduleName="workorders"}var url=isCustomModule?"v2/module/data/add":"/v2/".concat(moduleName,"/add");return new Promise((function(resolve,reject){api/* API */.bl.post(url,data).then((function(_ref24){var error=_ref24.error;error?reject():resolve()}))}))},constructCustomModuleData:function(returnObj,data,transition){var _this6=this;
// Remove once v3 is done for custom modules
if(returnObj["moduleData"]={},data){data.comment&&(returnObj.comment=data.comment,delete data.comment),returnObj["moduleData"]=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},returnObj["moduleData"]),data);var _ref25=this.record||{},_ref25$siteId=_ref25.siteId,siteId=void 0===_ref25$siteId?null:_ref25$siteId,formId=transition.formId||null;!(0,validation/* isEmpty */.xb)(siteId)&&(0,validation/* isEmpty */.xb)(returnObj["moduleData"].siteId)&&(returnObj["moduleData"].siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(returnObj["moduleData"].formId=formId)}var formFields=this.$getProperty(transition,"form.fields")||[],currentModuleLookupField=formFields.find((function(field){return field.lookupModuleName===_this6.moduleName}));return currentModuleLookupField&&(returnObj["moduleData"].data=returnObj["moduleData"].data||{},returnObj["moduleData"].data[currentModuleLookupField.name]=this.record.id),returnObj},constructWoModuleData:function(data,transition){var _this7=this,formData=(0,objectSpread2/* default */.Z)({},data),_ref26=this.record||{},_ref26$siteId=_ref26.siteId,siteId=void 0===_ref26$siteId?null:_ref26$siteId,formId=transition.formId||null;
// Remove once v3 is done for workorders, handle it through relations
!(0,validation/* isEmpty */.xb)(siteId)&&(0,validation/* isEmpty */.xb)(formData.siteId)&&(formData.siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(formData.formId=formId);var formFields=this.$getProperty(transition,"form.fields")||[],currentModuleLookupField=formFields.find((function(field){var fieldObj=field.field;return field.lookupModuleName===_this7.moduleName&&!fieldObj.default}));return currentModuleLookupField&&(formData.data=formData.data||{},formData.data[currentModuleLookupField.name]={id:this.record.id}),Object.keys(formData).forEach((function(name){var value=formData[name];(0,validation/* isObject */.Kn)(value)&&-99===value.id&&(formData[name]=null)})),formData},defaultResponseHandler:function(){var _this8=this,_ref27=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},error=_ref27.error,delay=this.$helpers.delay,$message=this.$message;error?this.$emit("transitionFailure"):(this.fetchAvailableStates({force:!0}),this.$emit("transitionSuccess")),this.cancelTransition(),this.hideNotifications||(error?$message.error(error.message||this.$t("maintenance._workorder.state_update_failed")):delay(200).then((function(){$message.success(_this8.$t("maintenance._workorder.state_update_success"))})))},closeStateFlowForm:function(){this.canShowForm=!1},showStateFlowForm:function(){this.canShowForm=!0},closeConfirmationDialogs:function(){this.showConfirmationDialog=!1},getUrl:function(transition){return(0,validation/* isFunction */.mf)(this.updateUrl)?this.updateUrl(transition):this.updateUrl}}},stateflow_TransitionButtonsvue_type_script_lang_js=TransitionButtonsvue_type_script_lang_js,TransitionButtons_component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionButtonsvue_type_script_lang_js,render,staticRenderFns,!1,null,"cca90304",null)
/* harmony default export */,TransitionButtons=TransitionButtons_component.exports},
/***/13427:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return IndividualInspectionSummary}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/inspection/individual-inspection/IndividualInspectionSummary.vue?vue&type=template&id=09e8a00f&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"qanda-response-summary"},[_vm.loading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm._e(),_vm.$validation.isEmpty(_vm.record)?_vm._e():_c("div",{staticClass:"header pT10 pB15 pL20 pR20"},[_c("div",{staticClass:"qanda-details"},[_c("div",{staticClass:"d-flex flex-middle"},[_c("div",{staticClass:"mL5"},[_c("div",{staticClass:"qanda-id mT10"},[_vm.$account.portalInfo?_c("i",{directives:[{name:"tippy",rawName:"v-tippy",value:{animateFill:!1,animation:"shift-toward"},expression:"{ animateFill: false, animation: 'shift-toward' }"}],staticClass:"el-icon-back fc-grey3-text14 fw6 pR10 pointer",attrs:{content:"back",arrow:""},on:{click:_vm.back}}):_vm._e(),_vm._v(" #"+_vm._s(_vm.record&&_vm.record.id)+" ")]),_c("div",{staticClass:"qanda-name mb5 d-flex"},[_vm._v(" "+_vm._s(_vm.$getProperty(_vm.record,"name",""))+" "),_vm.isStateFlowEnabled&&_vm.currentModuleState?_c("div",{staticClass:"fc-badge text-uppercase inline vertical-middle mL15"},[_vm._v(" "+_vm._s(_vm.currentModuleState)+" ")]):_vm._e()])])])]),_c("div",{staticClass:"d-flex flex-direction-row align-center",staticStyle:{"margin-left":"auto"}},[_c("CustomButton",{staticClass:"p10",attrs:{record:_vm.record,moduleName:_vm.moduleName,position:_vm.POSITION.SUMMARY},on:{refresh:function($event){return _vm.refreshObj(!0)},onError:function(){}}}),_vm.isStateFlowEnabled?[_c("TransitionButtons",{key:_vm.record.id,staticClass:"mR10",attrs:{moduleName:_vm.moduleName,record:_vm.record,disabled:_vm.isApprovalEnabled,buttonClass:"asset-el-btn"},on:{currentState:function(){},transitionSuccess:function($event){return _vm.refreshObj(!0)},transitionFailure:function(){}}})]:_vm._e(),_vm.canShowLiveForm?_c("el-button",{staticClass:"open-survey-btn",on:{click:_vm.openLiveForm}},[_vm._v(_vm._s(_vm.liveFormBtnText))]):_vm._e(),_c("el-dropdown",{staticClass:"mL10 self-center fc-btn-ico-lg pT3 pB3 pL8 pR8 pointer",attrs:{trigger:"click"},on:{command:_vm.dropDownActions}},[_c("span",{staticClass:"el-dropdown-link"},[_c("inline-svg",{staticClass:"vertical-middle",attrs:{src:"svgs/menu",iconClass:"icon icon-md"}})],1),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[_c("el-dropdown-item",{attrs:{command:"downloadPdf"}},[_vm._v(_vm._s(_vm.$t("qanda.response.download_pdf")))]),_c("el-dropdown-item",{attrs:{command:"openPrintPreview"}},[_vm._v(_vm._s(_vm.$t("qanda.response.print")))])],1)],1)],2)]),_vm.downloadUrl?_c("iframe",{staticStyle:{display:"none"},attrs:{src:_vm.downloadUrl}}):_vm._e(),_vm.$validation.isEmpty(_vm.record)?_vm._e():_c("Page",{key:_vm.record.id,attrs:{module:_vm.moduleName,id:_vm.record.id,details:_vm.record,primaryFields:_vm.primaryFields,notesModuleName:_vm.notesModuleName,attachmentsModuleName:_vm.attachmentsModuleName,isV3Api:!0}}),_c("router-view",{key:"child-"+_vm.id})],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),objectSpread2=__webpack_require__(595082),PageBuilder=(__webpack_require__(634338),__webpack_require__(976801),__webpack_require__(434284),__webpack_require__(670560),__webpack_require__(760218)),api=__webpack_require__(32284),CustomButtonUtil=__webpack_require__(746095),CustomButton=__webpack_require__(623857),TransitionButtons=__webpack_require__(987612),vuex_esm=__webpack_require__(420629),validation=__webpack_require__(990260),router=__webpack_require__(329435),IndividualInspectionSummaryvue_type_script_lang_js={props:["moduleName"],components:{Page:PageBuilder/* default */.Z,CustomButton:CustomButton/* default */.Z,TransitionButtons:TransitionButtons/* default */.Z},data:function(){return{record:null,loading:!0,activeTab:"summary",primaryFields:[],executeBtnLoading:!1,POSITION:CustomButtonUtil/* POSITION_TYPE */.Rz,downloadUrl:null}},created:function(){this.$store.dispatch("loadTicketStatus",this.moduleName)},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({moduleMeta:function(state){return state.view.metaInfo}})),(0,vuex_esm/* mapGetters */.Se)(["getTicketStatus","isStatusLocked","getApprovalStatus"])),{},{notesModuleName:function(){var _ref=this||{},moduleName=_ref.moduleName;return"".concat(moduleName,"notes")},attachmentsModuleName:function(){var _ref2=this||{},moduleName=_ref2.moduleName;return"".concat(moduleName,"attachments")},id:function(){var paramId=this.$route.params.id;return paramId&&"null"!==paramId?parseInt(this.$route.params.id):""},isStateFlowEnabled:function(){var hasState=this.$getProperty(this.record,"moduleState.id"),isEnabled=this.$getProperty(this.moduleMeta,"module.stateFlowEnabled");return hasState&&isEnabled},isApprovalEnabled:function(){var record=this.record,_ref3=record||{},approvalFlowId=_ref3.approvalFlowId,approvalStatus=_ref3.approvalStatus;return!(0,validation/* isEmpty */.xb)(approvalFlowId)&&!(0,validation/* isEmpty */.xb)(approvalStatus)},currentModuleState:function(){var moduleName=this.moduleName,record=this.record,currentStateId=this.$getProperty(record,"moduleState.id"),currentState=this.getTicketStatus(currentStateId,moduleName),_ref4=currentState||{},displayName=_ref4.displayName,status=_ref4.status;return(0,validation/* isEmpty */.xb)(displayName)?status||null:displayName},pdfUrl:function(){var _ref5=(0,router/* getApp */.wx)()||{},_ref5$linkName=_ref5.linkName,appName=void 0===_ref5$linkName?"maintenance":_ref5$linkName;return window.location.protocol+"//"+window.location.host+"/".concat(appName,"/pdf/inspectionpdf?id=").concat(this.id)},canShowLiveForm:function(){var record=this.record,$account=this.$account,peopleId=this.$getProperty(record,"people.id"),assignedToId=this.$getProperty(record,"assignedTo.id"),currUserPeopleId=this.$getProperty($account,"user.peopleId"),userId=this.$getProperty($account,"user.id"),isCurrentUser=peopleId===currUserPeopleId||assignedToId===userId,responseStatus=this.$getProperty(record,"responseStatus"),canEditRecord=this.$getProperty(this,"canEditRecord",!0),returnVal=record&&![1,4].includes(responseStatus)&&!this.$getProperty(record,"parent.deleted")&&isCurrentUser&&canEditRecord;return returnVal},isRequestedState:function(){var record=this.record,_ref6=record||{},approvalStatus=_ref6.approvalStatus;if((0,validation/* isEmpty */.xb)(approvalStatus))return!1;var statusObj=this.getApprovalStatus(approvalStatus.id);return this.$getProperty(statusObj,"requestedState",!1)},isRecordLocked:function(){var moduleName=this.moduleName,record=this.record,moduleState=this.$getProperty(record,"moduleState.id",null);return moduleState&&this.isStatusLocked(moduleState,moduleName)},canEditRecord:function(){var isRecordLocked=this.isRecordLocked,isRequestedState=this.isRequestedState;return!isRecordLocked&&!isRequestedState},liveFormBtnText:function(){var record=this.record,currOrg=this.$getProperty(this,"$account.org.id"),_ref7=record||{},picklist=_ref7.picklist,valueMap={inspectionType:1};return 17!==currOrg||picklist===valueMap["inspectionType"]?"Conduct Inspection":"Conduct Audit"}}),watch:{id:{handler:function(){this.loadInspectionRecord()},immediate:!0}},methods:{refreshObj:function(){this.loadInspectionRecord()},loadInspectionRecord:function(){var _arguments=arguments,_this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var force,moduleName,id,_yield$API$fetchRecor,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return force=!(_arguments.length>0&&void 0!==_arguments[0])||_arguments[0],moduleName=_this.moduleName,id=_this.id,_this.loading=!0,_context.next=5,api/* API */.bl.fetchRecord(moduleName,{id:id},{force:force});case 5:_yield$API$fetchRecor=_context.sent,data=_yield$API$fetchRecor[moduleName],error=_yield$API$fetchRecor.error,error?_this.$message.error("Error Occured"):_this.record=data,_this.loading=!1;case 10:case"end":return _context.stop()}}),_callee)})))()},openLiveForm:function(){var record=this.record,moduleName=this.moduleName,id=this.$getProperty(record,"id","");if((0,router/* isWebTabsEnabled */.tj)()){var _ref8=(0,router/* findRouteForModule */.Jp)(moduleName,router/* pageTypes */.As.EDIT)||{},name=_ref8.name;name&&this.$router.push({name:name,params:{id:id}})}else this.$router.push({name:"inspection-live-form",params:{id:id}})},openPrintPreview:function(){window.open(this.pdfUrl)},dropDownActions:function(action){(0,validation/* isEmpty */.xb)(this[action])||this[action]()},downloadPdf:function(){var _this2=this;this.downloadUrl=null,this.$message({message:"Downloading...",showClose:!0,duration:0});var additionalInfo={showFooter:!1,footerStyle:"p {font-size:12px; margin-left:500px}",footerHtml:'<p>Page  <span class="pageNumber"></span> / <span class="totalPages"></span></p>'};api/* API */.bl.post("/v2/integ/pdf/create",{url:this.pdfUrl,additionalInfo:additionalInfo}).then((function(_ref9){var data=_ref9.data,error=_ref9.error;if(_this2.$message.closeAll(),error){var _error$message=error.message,message=void 0===_error$message?"Unable to fetch quote download link":_error$message;_this2.$message.error(message)}else{var _ref10=data||{},fileUrl=_ref10.fileUrl;_this2.downloadUrl=fileUrl||null}}))}}},individual_inspection_IndividualInspectionSummaryvue_type_script_lang_js=IndividualInspectionSummaryvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(individual_inspection_IndividualInspectionSummaryvue_type_script_lang_js,render,staticRenderFns,!1,null,"09e8a00f",null)
/* harmony default export */,IndividualInspectionSummary=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/13427.js.map