"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[61231],{
/***/161231:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return AssetOverviewLayout}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/assets/asset/v1/AssetOverviewLayout.vue?vue&type=template&id=55d42f66
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"height100 d-flex"},[_c("div",{staticStyle:{flex:"0 0 300px","max-width":"300px"}},[_c("div",{staticClass:"height100vh full-layout-white fc-border-left fc-border-right"},[_c("div",{staticClass:"row p15 fc-border-bottom pointer"},[_c("div",{staticClass:"col-1 text-left"},[_c("i",{staticClass:"el-icon-back fw6",staticStyle:{"vertical-align":"sub"},on:{click:_vm.back}})]),_c("el-popover",{attrs:{placement:"bottom",width:"250","popper-class":"popover-height asset-popover ",trigger:"click","visible-arrow":"true"},model:{value:_vm.toggle,callback:function($$v){_vm.toggle=$$v},expression:"toggle"}},[_c("ul",_vm._l(_vm.views,(function(view,index){return _c("li",{key:index,class:{active:_vm.currentView===view.name},on:{click:function($event){return _vm.switchView(view)}}},[_vm._v(" "+_vm._s(view.displayName)+" ")])})),0),_c("span",{staticClass:"line-height20",attrs:{slot:"reference"},slot:"reference"},[_vm._v(_vm._s(_vm.currentViewDetail.displayName)),_c("i",{staticClass:"el-icon-arrow-down el-icon-arrow-down-tv",staticStyle:{"padding-left":"8px"}})])]),_c("div",{staticClass:"pointer",on:{click:_vm.toggleQuickSearch}},[_c("i",{staticClass:"fa fa-search fa-search-asste-icon",attrs:{"aria-hidden":"true"}})]),_vm.showQuickSearch?_c("div",{staticClass:"row"},[_c("div",{staticClass:"col-12 fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper fc-list-search-wrapper-asset"},[_c("svg",{staticClass:"search-icon-asset",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"}},[_c("title",[_vm._v("search")]),_c("path",{attrs:{d:"M21.487 22.927l7.037 7.037c.473.473 1.238.475 1.71.003s.47-1.237-.003-1.71l-7.037-7.037c3.96-4.82 3.675-11.967-.846-16.487C17.539-.076 9.757-.092 4.966 4.699S.191 17.272 5 22.081c4.52 4.52 11.667 4.805 16.487.846zM6.679 6.413c3.848-3.848 10.099-3.836 13.962.027s3.875 10.114.027 13.962c-3.848 3.848-10.099 3.836-13.962-.027S2.831 10.261 6.679 6.413z"}})]),_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.quickSearchQuery,expression:"quickSearchQuery"}],ref:"quickSearchQuery",staticClass:"quick-search-input-asset",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.quickSearchQuery},on:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.loadAssetsList({forceFetch:!0})},input:function($event){$event.target.composing||(_vm.quickSearchQuery=$event.target.value)}}}),_c("svg",{staticClass:"close-icon-asset",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.closeSearch}},[_c("title",[_vm._v("close")]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_vm._e()],1),_c("div",{staticClass:"row sp-navbar2"},[_c("ul",{staticClass:"sp-ul"},[_c("v-infinite-scroll",{staticStyle:{height:"100vh","padding-bottom":"100px","overflow-y":"scroll"},attrs:{loading:_vm.loading,offset:20},on:{bottom:_vm.nextPage}},_vm._l(_vm.assets,(function(asset){return _c("div",{key:asset.id,staticClass:"menu-item space-secondary-color sp-li ellipsis f12 pointer asset-item p20",class:{active:_vm.currentassetId===asset.id},on:{click:function($event){return _vm.getAssetLink(asset.id)}}},[_c("span",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",animation:"shift-away",arrow:!0},expression:"{\n                    placement: 'top',\n                    animation: 'shift-away',\n                    arrow: true,\n                  }"}],staticClass:"label",attrs:{title:asset.name}},[_vm._v(_vm._s(asset.name))])])})),0)],1),_vm.loading?_c("ul",{staticClass:"sp-ul"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm._e(),_vm.loadingLists?_c("ul",{staticClass:"sp-ul"},[_c("spinner",{attrs:{show:_vm.loadingLists,size:"60"}})],1):_vm._e()])])]),_c("div",{staticStyle:{flex:"1"}},[_c("router-view",{key:_vm.currentassetId})],1)])])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),objectSpread2=__webpack_require__(595082),v_infinite_scroll=(__webpack_require__(670560),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(564043),__webpack_require__(61514),__webpack_require__(169358),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(857267),__webpack_require__(648324),__webpack_require__(634338),__webpack_require__(561364)),v_infinite_scroll_default=__webpack_require__.n(v_infinite_scroll),vuex_esm=__webpack_require__(420629),validation=__webpack_require__(990260),api=__webpack_require__(32284),router=__webpack_require__(329435),AssetOverviewLayoutvue_type_script_lang_js={data:function(){return{toggle:!1,loading:!0,loadingLists:!1,page:1,showQuickSearch:!1,quickSearchQuery:null,fetchingMore:!1,canLoadMore:!0,assets:[]}},components:{VInfiniteScroll:v_infinite_scroll_default()},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({groupViews:function(state){return state.view.groupViews},metaInfo:function(state){return state.view.metaInfo}})),{},{views:function(){var views=[];return this.filters&&views.push({displayName:"Filtered Assets",name:"filteredassets"}),this.groupViews&&(0,validation/* isArray */.kJ)(this.groupViews)&&this.groupViews.forEach((function(group){views.push.apply(views,(0,toConsumableArray/* default */.Z)(group.views))})),views},currentassetId:function(){var assetId=this.$attrs.id||this.$route.params.assetid;return(0,validation/* isEmpty */.xb)(assetId)?null:parseInt(assetId)},scrollDisabled:function(){return this.loading||!this.canLoadMore||this.fetchingMore},currentView:function(){if(this.filters)return"filteredassets";var viewName=this.$attrs.viewname||this.$route.params.viewname;return viewName||"all"},currentViewDetail:function(){var _this=this;return this.filters?{displayName:"Filtered Assets",name:"filteredassets"}:this.views.find((function(view){return view.name===_this.currentView}))||{}},currentModuleName:function(){return(this.metaInfo||{}).name||"asset"},filters:function(){var search=this.$route.query.search;return search?JSON.parse(search):null}}),created:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _ref,moduleName;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this2.$store.dispatch("view/clearViews"),_context.next=3,_this2.loadViews();case 3:_ref=_this2.assets.find((function(asset){return asset.id===_this2.currentassetId}))||{},moduleName=_ref.moduleName,_this2.loadModuleMeta(moduleName),_this2.loadAssetsList({forceFetch:!0});case 6:case"end":return _context.stop()}}),_callee)})))()},watch:{assets:function(newVal){this.currentassetId||this.getAssetLink(newVal[0].id)},currentView:function(newVal,oldVal){newVal&&oldVal!==newVal&&this.loadAssetsList({forceFetch:!0})}},methods:{loadViews:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var param;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return param={moduleName:_this3.currentModuleName||"asset"},_context2.next=3,_this3.$store.dispatch("view/loadGroupViews",param);case 3:return _context2.abrupt("return",_context2.sent);case 4:case"end":return _context2.stop()}}),_callee2)})))()},loadModuleMeta:function(moduleName){return this.$store.dispatch("view/loadModuleMeta",moduleName)},switchView:function(view){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var filterIndex,currentassetId,assets,record,_findRouteForModule,name;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this4.toggle=!1,filterIndex=_this4.views.findIndex((function(view){return"filteredassets"===view.name})),-1!==filterIndex&&_this4.views.splice(filterIndex,1),_context3.next=5,_this4.loadModuleMeta(view.moduleName||"asset");case 5:return _context3.next=7,_this4.loadAssetsList({viewName:view.name});case 7:currentassetId=_this4.currentassetId,assets=_this4.assets,record=assets.find((function(_ref2){var id=_ref2.id;return id===currentassetId})),(0,validation/* isEmpty */.xb)(record)&&(record=(0,validation/* isEmpty */.xb)(assets)?{}:assets[0]),(0,router/* isWebTabsEnabled */.tj)()?(_findRouteForModule=(0,router/* findRouteForModule */.Jp)("asset",router/* pageTypes */.As.OVERVIEW),name=_findRouteForModule.name,name&&_this4.$router.replace({name:name,params:{viewname:view.name,id:record.id||currentassetId},query:_this4.$route.query})):_this4.$helpers.isEtisalat()?_this4.$router.replace({name:"metersummary",params:{viewname:view.name,assetid:record.id||currentassetId},query:_this4.$route.query}):_this4.$router.replace({name:"assetsummary",params:{viewname:view.name,assetid:record.id||currentassetId},query:_this4.$route.query});case 11:case"end":return _context3.stop()}}),_callee3)})))()},loadAssetsList:function(){var _arguments=arguments,_this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var _ref3,loadMore,viewName,forceFetch,currentView,page,queryObj,_yield$API$fetchAll,list,error,meta,_error$message,message,listCount;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _ref3=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:{},loadMore=_ref3.loadMore,viewName=_ref3.viewName,forceFetch=_ref3.forceFetch,loadMore?(_this5.fetchingMore=!0,_this5.page++):(_this5.loading=!0,_this5.page=1),currentView=_this5.currentView,page=_this5.page,queryObj={viewName:viewName||currentView,page:page,filters:_this5.$route.query.search?JSON.stringify(JSON.parse(_this5.$route.query.search)):"",search:_this5.quickSearchQuery,includeParentFilter:"filteredList"===currentView,perPage:50,withCount:!0},_context4.next=6,api/* API */.bl.fetchAll(_this5.currentModuleName,queryObj,{force:forceFetch});case 6:_yield$API$fetchAll=_context4.sent,list=_yield$API$fetchAll.list,error=_yield$API$fetchAll.error,meta=_yield$API$fetchAll.meta,error?(_error$message=error.message,message=void 0===_error$message?"Error Occured while fetching Asset list":_error$message,_this5.$message.error(message)):(forceFetch?_this5.assets=list:loadMore&&(_this5.assets=[].concat((0,toConsumableArray/* default */.Z)(_this5.assets||[]),(0,toConsumableArray/* default */.Z)(list))),listCount=_this5.$getProperty(meta,"pagination.totalCount",null),_this5.canLoadMore=listCount>(_this5.assets||[]).length),_this5.loading=!1,_this5.loadingLists=!1,_this5.fetchingMore=!1;case 14:case"end":return _context4.stop()}}),_callee4)})))()},nextPage:function(){this.scrollDisabled||(this.loadingLists=!0,this.fetchingMore=!0,this.loadAssetsList({loadMore:!0}))},closeSearch:function(){this.toggleQuickSearch(),this.quickSearchQuery=null,this.loadAssetsList({forceFetch:!0})},toggleQuickSearch:function(){this.showQuickSearch=!this.showQuickSearch},getAssetLink:function(id){if(null!==id){var currentView=this.currentView;if((0,router/* isWebTabsEnabled */.tj)()){var _findRouteForModule2=(0,router/* findRouteForModule */.Jp)("asset",router/* pageTypes */.As.OVERVIEW),name=_findRouteForModule2.name;name&&this.$router.push({name:name,params:{viewname:currentView,id:id},query:this.$route.query})}else this.$helpers.isEtisalat()?this.$router.push({name:"metersummary",params:{viewname:currentView,assetid:id},query:this.$route.query}):this.$router.push({name:"assetsummary",params:{viewname:currentView,assetid:id},query:this.$route.query})}},back:function(){var currentView=this.currentView;if((0,router/* isWebTabsEnabled */.tj)()){var _findRouteForModule3=(0,router/* findRouteForModule */.Jp)("asset",router/* pageTypes */.As.LIST),name=_findRouteForModule3.name;name&&this.$router.push({name:name,params:{viewname:currentView},query:this.$route.query})}else{var path,_this$$route=this.$route,params=_this$$route.params,query=_this$$route.query,viewname=params.viewname,viewName="filteredassets"===viewname?"all":viewname;path=this.$helpers.isEtisalat()?"/app/home/assets/".concat(viewName):"/app/at/assets/".concat(viewName),this.$router.push({path:path,query:query})}}}},v1_AssetOverviewLayoutvue_type_script_lang_js=AssetOverviewLayoutvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(v1_AssetOverviewLayoutvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,AssetOverviewLayout=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/61231.js.map