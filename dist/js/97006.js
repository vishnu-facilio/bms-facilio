(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[97006],{
/***/720096:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return PreviewFile}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/PreviewFile.vue?vue&type=template&id=447c7e89
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.currentFile?_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.show,expression:"show"}],staticClass:"preview-file"},[_c("div",{staticClass:"top-toolbar"},[_c("div",{staticClass:"a-top-toolbar"},[_c("div",{staticClass:"file-name word-break-keep"},[_vm._v(" "+_vm._s(_vm.currentFile.fileName)+" ")]),_c("div",{staticClass:"top-toolbar-icon-right flex align-center"},[_vm.currentFile.contentType.includes("image")?[_c("div",{staticClass:"flex-middle pL15"},[_vm.showOriginalImage?_c("div",{staticClass:"fc-white-14 word-break-keep pointer",on:{click:_vm.showOriginalPhoto}},[_vm._v(" "+_vm._s(_vm.$t("common._common.view_original"))+" ")]):_vm._e(),_vm.showCompressedImage?_c("div",{staticClass:"fc-white-14 word-break-keep pointer",on:{click:_vm.showCompressedPhoto}},[_vm._v(" "+_vm._s(_vm.$t("common._common.view_default"))+" ")]):_vm._e()]),_c("div",{staticClass:"download-icon round flex-middle pL15",on:{click:function($event){return _vm.downloadAttachment(_vm.currentFile)}}},[_c("i",{staticClass:"el-icon-download op8",staticStyle:{color:"#ffff"}})])]:_vm._e(),_vm.currentFile.contentType.includes("pdf")?[_c("div",{staticClass:"download-icon round flex-middle pL15",on:{click:function($event){return _vm.downloadAttachment(_vm.currentFile)}}},[_c("i",{staticClass:"el-icon-download op8",staticStyle:{color:"#ffff"}})])]:_vm._e(),_vm.showDeleteOption()?_c("div",{staticClass:"flex-middle pL15",on:{click:function($event){return _vm.deletePreview()}}},[_c("inline-svg",{staticClass:"pointer edit-icon-color close vertical-text-top",attrs:{src:"svgs/delete",iconClass:"icon icon-md"}})],1):_vm._e(),_c("div",{staticClass:"pL15"},[_c("i",{staticClass:"el-icon-close close",on:{click:_vm.closePreview}})])],2)])]),_vm.currentFileIndex>0?_c("a",{staticClass:"el-icon-arrow-left prev",staticStyle:{"font-size":"30px"},on:{click:function($event){return _vm.plusSlides(-1)}}}):_vm._e(),_vm.currentFileIndex<_vm.files.length-1?_c("a",{staticClass:"el-icon-arrow-right next",staticStyle:{"font-size":"30px"},on:{click:function($event){return _vm.plusSlides(1)}}}):_vm._e(),_c("div",{staticClass:"preview-content"},[_vm.currentFile.contentType.includes("image")?[_vm.compressedImage?_c("img",{staticClass:"content",staticStyle:{"box-shadow":"none"},attrs:{src:_vm.$prependBaseUrl(_vm.currentFile.previewUrl)}}):_vm.originalImage?_c("img",{staticClass:"content original",staticStyle:{"box-shadow":"none"},attrs:{src:_vm.$prependBaseUrl(_vm.currentFile.previewUrl+"?fetchOriginal=true")}}):_vm._e()]:_vm.currentFile.contentType.includes("pdf")?_c("div",{staticClass:"width100 height-100"},[_c("iframe",{staticClass:"fc-preview-pdf",attrs:{src:_vm.$prependBaseUrl(_vm.currentFile.previewUrl),height:"100%",width:"100%"}})]):_vm.isVideoSupported(_vm.currentFile.contentType)?_c("div",{staticClass:"width100 height-100 fc-preview-video"},[_c("video",{attrs:{controls:""}},[_c("source",{attrs:{src:_vm.$prependBaseUrl(_vm.$getProperty(_vm.currentFile,"downloadUrl",null)),type:_vm.$getProperty(_vm.currentFile,"contentType")}}),_vm._v(" "+_vm._s(_vm.$t("common._common.browser_not_supported"))+" ")])]):_c("div",{staticClass:"no-preview"},[_c("div",{staticClass:"flex justify-center pT24"},[_c("inline-svg",{staticClass:"d-flex",attrs:{src:_vm.getFileIcon(_vm.currentFile),iconClass:"icon icon-60 overlay"}})],1),_c("div",{staticClass:"f14 pT12 pB12"},[_vm._v("No preview available")]),_c("div",{staticClass:"download-button"},[_c("a",{staticClass:"flex flex-row",staticStyle:{color:"#ffff"},on:{click:function($event){return _vm.downloadAttachment(_vm.currentFile)}}},[_c("div",[_vm._v("Download")])])])])],2),_vm.exportDownloadUrl?_c("iframe",{staticStyle:{display:"none"},attrs:{src:_vm.exportDownloadUrl}}):_vm._e()]):_vm._e()},staticRenderFns=[],validation=(__webpack_require__(339772),__webpack_require__(260228),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(228436),__webpack_require__(990260)),PreviewFilevue_type_script_lang_js={props:["previewFile","files","visibility","showDelete","isLockedState","isTaskClosed"],data:function(){return{show:!0,previewUrl:null,currentFileIndex:0,currentFile:null,imageMargin:null,exportDownloadUrl:null,originalImage:!1,compressedImage:!0,showOriginalImage:!0,showCompressedImage:!1}},destroyed:function(){window.removeEventListener("keyup",this.handler)},mounted:function(){window.addEventListener("keyup",this.handler),this.preloadImages()},watch:{},computed:{},methods:{handler:function(){
// If escape key is pressed...
27===event.keyCode?this.closePreview():37===event.keyCode?this.plusSlides(-1):39===event.keyCode&&this.plusSlides(1)},preloadImages:function(){this.currentFile=this.previewFile?this.previewFile:this.files[0],this.currentFileIndex=this.files.indexOf(this.currentFile)},plusSlides:function(n){var index=this.currentFileIndex+n;index<0&&(index=0),index>=this.files.length&&(index=this.files.length-1),this.currentFileIndex=index,this.currentFile=this.files[index]},closePreview:function(){this.$emit("update:visibility",!1)},deletePreview:function(){var currentFile=this.currentFile;this.$emit("onDelete",currentFile)},downloadAttachment:function(file){var _this=this,_ref=file||{},url=_ref.downloadUrl;this.exportDownloadUrl&&(this.exportDownloadUrl=null),this.$nextTick((function(){_this.exportDownloadUrl=url}))},showOriginalPhoto:function(){this.originalImage=!0,this.showCompressedImage=!0,this.showOriginalImage=!1,this.compressedImage=!1},showCompressedPhoto:function(){this.showCompressedImage=!1,this.originalImage=!1,this.showOriginalImage=!0,this.compressedImage=!0},getFileIcon:function(attachment){var contentType=attachment.contentType,FILE_TYPE_ICONS=this.$constants.FILE_TYPE_ICONS,selectedIndex=FILE_TYPE_ICONS.findIndex((function(icons){var fileTypes=icons.fileTypes;return fileTypes.some((function(type){return contentType.includes(type)}))}));return(0,validation/* isEmpty */.xb)(selectedIndex)?FILE_TYPE_ICONS[0].path:FILE_TYPE_ICONS[selectedIndex].path},isVideoSupported:function(contentType){contentType=contentType||"";var supportedTypes=["video/webm","video/mp4","video/ogg"];return supportedTypes.includes(contentType.trim().toLowerCase())},showDeleteOption:function(){var showDelete=this.showDelete,isLockedState=this.isLockedState,isTaskClosed=this.isTaskClosed;return showDelete&&!isLockedState&&!isTaskClosed}}},components_PreviewFilevue_type_script_lang_js=PreviewFilevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_PreviewFilevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,PreviewFile=component.exports},
/***/1346:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return InventoryServices}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/workorders/v3/widgets/InventoryServices.vue?vue&type=template&id=969c5f6a&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"p30 white-bg-block mB20"},[_c("div",{staticClass:"flex-middle"},[_c("div",{staticClass:"fc-v1-icon-bg text-center"},[_c("InlineSvg",{attrs:{src:"svgs/service",iconClass:"icon icon-lg fill-white"}})],1),_c("div",{staticClass:"fc-black3-16 mL10"},[_vm._v(" "+_vm._s(_vm.$t("common.products.services"))+" ")])]),_c("div",{staticClass:"inventory-table inventory-tool-table inventory-labour-tool-table pT20  overflow-y-scroll"},[_vm.loading.woService?_c("table",{staticClass:"width100"},[_c("tr",[_c("td",{attrs:{colspan:"100%"}},[_c("div",{staticClass:"iTloading in-no-data"},[_c("spinner",{attrs:{show:!0,size:"80"}})],1)])])]):_c("table",{staticClass:"width100"},[_c("thead",[_c("tr",[_c("th",{staticStyle:{width:"180px"}},[_vm._v(" "+_vm._s(_vm.$t("common.products._service"))+" ")]),_c("th",{staticClass:"text-right width110px"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report._start_time"))+" ")]),_c("th",{staticClass:"text-right width110px pL20"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report._end_time"))+" ")]),_c("th",{staticClass:"text-right width130px"},[_vm._v(" "+_vm._s(_vm.$t("common._common.duration_hr"))+" ")]),_c("th",{staticClass:"text-right width130px"},[_vm._v(" "+_vm._s(_vm.$t("common._common._quantity"))+" ")]),_c("th",{staticClass:"text-right"},[_vm._v(_vm._s(_vm.$t("common.header._price")))]),_c("th",{staticClass:"text-right"},[_vm._v(_vm._s(_vm.$t("common.tabs._cost")))]),_c("th",{staticClass:"width40px"})])]),_vm.workorderServiceList.length?_c("tbody",_vm._l(_vm.workorderServiceList,(function(workService){return _c("tr",{key:workService.id,staticClass:"borderB1px border-color11 visibility-visible-actions pointer"},[_c("td",[_c("div",{staticClass:"pL17",staticStyle:{width:"180px"}},[_c("div",[_vm._v(_vm._s(workService.service.name))])])]),_c("td",[_c("div",{staticClass:"in-Quantity width110px"},[_c("div",{staticClass:"fc-black-13 text-right pR17"},[_vm._v(" "+_vm._s(_vm.formatTime(Number(workService.startTime),"hh:mm a",!1))+" ")]),_c("div",{staticClass:"fc-grey2-text12 text-right"},[_c("el-date-picker",{staticClass:"fc-input-border-remove inventory-date-picker pL40 fc-grey2-text12",attrs:{format:"dd-MM-yyyy hh:mm a","value-format":"timestamp",type:"datetime",disabled:!_vm.actionRule||1===_vm.$getProperty(workService,"service.paymentType"),placeholder:"Start time"},on:{change:function($event){return _vm.changeWorkServiceField(workService,1)}},model:{value:workService.startTime,callback:function($$v){_vm.$set(workService,"startTime",$$v)},expression:"workService.startTime"}})],1)])]),_c("td",{staticClass:"pL20"},[_c("div",{staticClass:"in-Quantity width110px"},[_c("div",{staticClass:"fc-black-13 text-right"},[_vm._v(" "+_vm._s(_vm.formatTime(Number(workService.endTime),"hh:mm a",!1))+" ")]),_c("div",{staticClass:"fc-grey2-text12 text-right"},[_c("el-date-picker",{staticClass:"fc-input-border-remove inventory-date-picker pL40 fc-grey2-text12",attrs:{format:"dd-MM-yyyy hh:mm a","value-format":"timestamp",type:"datetime",disabled:!_vm.actionRule||1===_vm.$getProperty(workService,"service.paymentType"),placeholder:"End time","picker-options":{disabledDate:function(time){return time.getTime()<workService.startTime}}},on:{change:function($event){return _vm.changeWorkServiceField(workService,2)}},model:{value:workService.endTime,callback:function($$v){_vm.$set(workService,"endTime",$$v)},expression:"workService.endTime"}})],1)])]),_c("td",[_c("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                placement: 'top',\n                arrow: true,\n                animation: 'shift-away',\n              }"}],staticClass:"in-Quantity",staticStyle:{width:"70px","text-align":"right",float:"right"},attrs:{title:workService.duration}},[_c("el-input",{staticClass:"pL10 labour-inventory-items-input labour-inventory-input pR0 fc-input-full-border-select2",attrs:{placeholder:_vm.$t("common._common._duration"),disabled:!_vm.actionRule||1===_vm.$getProperty(workService,"service.paymentType")},on:{change:function($event){return _vm.changeWorkServiceField(workService,3)}},model:{value:workService.duration,callback:function($$v){_vm.$set(workService,"duration",$$v)},expression:"workService.duration"}})],1)]),_c("td",[_c("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"top",arrow:!0,animation:"shift-away"},expression:"{\n                placement: 'top',\n                arrow: true,\n                animation: 'shift-away',\n              }"}],staticClass:"in-Quantity",staticStyle:{width:"70px","text-align":"right",float:"right"},attrs:{title:workService.quantity}},[_c("el-input",{staticClass:"pL10 labour-inventory-items-input labour-inventory-input pR0 fc-input-full-border-select2",attrs:{placeholder:_vm.$t("common._common._duration"),disabled:!_vm.actionRule},on:{change:function($event){return _vm.changeWorkServiceField(workService,4)}},model:{value:workService.quantity,callback:function($$v){_vm.$set(workService,"quantity",$$v)},expression:"workService.quantity"}})],1)]),_c("td",[_c("div",{staticClass:"text-right"},[_c("currency",{attrs:{value:(workService.service||{}).buyingPrice||0,recordCurrency:_vm.recordCurrency}})],1)]),_c("td",[_c("div",{staticClass:"text-right"},[_c("currency",{attrs:{value:workService.cost,recordCurrency:_vm.recordCurrency}})],1)]),_c("td",{directives:[{name:"show",rawName:"v-show",value:_vm.actionRule,expression:"actionRule"}]},[_c("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"el-icon-delete pointer inv-delet-icon visibility-hide-actions pR10 pL10",attrs:{"data-arrow":"true",title:_vm.$t("common._common.delete")},on:{click:function($event){return _vm.deleteWoService(workService)}}})])])})),0):_c("tbody",[_c("tr",[_c("td",{staticClass:"inventory-td-selected pL20 pT10 pB10",class:{disabled:!_vm.actionRule},on:{click:function($event){_vm.actionRule&&_vm.addNewWOService()}}},[_c("div",[_vm._v(_vm._s(_vm.$t("common.header.add_service")))])]),_vm._m(0),_vm._m(1),_c("td",[_c("div",{staticClass:"text-right"},[_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center mR10",attrs:{placeholder:"",type:"number",disabled:""}})],1)]),_c("td",[_c("div",{staticClass:"text-right"},[_c("el-input",{staticClass:"fc-input-full-border2 width50px inventory-input-width text-center mR10",attrs:{placeholder:"",type:"number",disabled:""}})],1)]),_c("td",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"fc-grey3-13 text-right"},[_c("currency",{attrs:{value:0,recordCurrency:_vm.recordCurrency}})],1)]),_c("td",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"fc-grey3-13 text-right"},[_c("currency",{attrs:{value:0,recordCurrency:_vm.recordCurrency}})],1)]),_c("td")])])])]),_vm.loading.woService?_c("div",{staticClass:"item-add"}):_c("div",{staticClass:"item-add"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.isNotPortal&&_vm.actionRule&&(_vm.workorderServiceList||[]).length,expression:"\n        isNotPortal && actionRule && (workorderServiceList || []).length\n      "}],staticClass:"fL"},[_c("div",{staticClass:"green-txt-13 fc-v1-add-txt pointer",on:{click:_vm.addNewWOService}},[_c("img",{attrs:{src:__webpack_require__(353654)}}),_vm._v(_vm._s(_vm.$t("common.header.add_service"))+" ")])]),_c("div",{staticClass:"fR inline-flex mR44"},[_c("div",{staticClass:"bold mR50"},[_vm._v(_vm._s(_vm.$t("common.header._total")))]),_c("div",{staticClass:"fc-black3-16 text-right bold pL10"},[_c("currency",{attrs:{value:_vm.workServiceCost,recordCurrency:_vm.recordCurrency}})],1)])]),_c("el-dialog",{attrs:{visible:_vm.serviceAddDialogVisibility,fullscreen:!1,open:"top","custom-class":"fc-dialog-up Inventoryaddvaluedialog","append-to-body":!0},on:{"update:visible":function($event){_vm.serviceAddDialogVisibility=$event}}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"fc-setup-modal-title"},[_vm._v(" "+_vm._s(_vm.$t("common.products.services_list"))+" ")])]),_c("div",{staticClass:"fc-inv-container-body"},[_vm.loading.serviceList?_c("spinner",{staticClass:"flex-middle justify-content-center flex-direction-column",attrs:{show:_vm.loading.serviceList,size:"80"}}):_c("table",{staticClass:"setting-list-view-table width100 invent-table-dialog"},[_c("thead",[_c("th",{staticClass:"setting-table-th setting-th-text"}),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("common.products.name"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s("Buying Price ("+_vm.$currency+")")+" ")])]),_vm.allServiceList.length?_c("tbody",_vm._l(_vm.allServiceList,(function(service){return _c("tr",{key:service.id,staticClass:"tablerow asset-hover-td"},[_c("td",{staticStyle:{width:"10%"}},[_c("el-checkbox",{model:{value:service.checked,callback:function($$v){_vm.$set(service,"checked",$$v)},expression:"service.checked"}})],1),_c("td",[_vm._v(_vm._s(service.name))]),_c("td",[_vm._v(_vm._s(service.buyingPrice||"---"))])])})),0):_c("tbody",[_c("tr",[_c("td",{attrs:{colspan:"100%"}},[_c("div",{staticClass:"flex-middle justify-content-center flex-direction-column"},[_c("inline-svg",{attrs:{src:"svgs/emptystate/inventory",iconClass:"icon text-center icon-100"}}),_c("div",{staticClass:"nowo-label f14 bold"},[_vm._v(" "+_vm._s(_vm.$t("common.products.no_services_present"))+" ")])],1)])])])])],1),_c("div",{staticClass:"modal-dialog-footer-parts-dialog"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeServiceDialog()}}},[_vm._v(_vm._s(_vm.$t("common._common.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",staticStyle:{"margin-left":"0px !important"},attrs:{type:"primary",loading:_vm.loading.woServiceSave},on:{click:function($event){return _vm.addWoService()}}},[_vm._v(_vm._s(_vm.$t("common._common._add")))])],1)])],1)},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("td",{staticClass:"pT10 pB10"},[_c("div",{staticClass:"fc-black-13 text-right"},[_vm._v("-- -- --")])])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("td",{staticClass:"pT10 pB10 pL20"},[_c("div",{staticClass:"fc-black-13 text-right"},[_vm._v("-- -- --")])])}],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),createForOfIteratorHelper=__webpack_require__(566347),moment_timezone=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(339772),__webpack_require__(434284),__webpack_require__(648324),__webpack_require__(425728),__webpack_require__(670560),__webpack_require__(879288),__webpack_require__(947522),__webpack_require__(162506),__webpack_require__(450886),__webpack_require__(897389),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(480008)),moment_timezone_default=__webpack_require__.n(moment_timezone),vue_runtime_esm=__webpack_require__(720144),workorderHelper=__webpack_require__(865764),InlineSvg=__webpack_require__(586166),eventBus=__webpack_require__(398011),api=__webpack_require__(32284),validation=__webpack_require__(990260),InventoryUtil=__webpack_require__(976195),relatedFieldUtil=__webpack_require__(850558),InventoryServicesvue_type_script_lang_js={props:["details","resizeWidget"],mixins:[workorderHelper/* default */.Z],data:function(){return{newItemPartToggle:!1,selectedInventory:null,hidequrry:!0,additionalCost:{name:null,cost:null},loading:{deleteAdditionalCost:!1,serviceList:!1,woService:!1,woServiceSave:!1},toolLoading:!1,addissueditem:!1,selectedInventoryList:[],inventoryRequestForWOLoading:!1,iTloading:!1,itemnsloading:!1,toolsloading:!1,labourLoading:!1,selectedTool:null,workorderItemsList:[],workLabourTotalCost:null,workorderToolsList:[],workorderLabourList:[],workorderServiceList:[],newToolPartToggle:!1,workOrderCostList:[],individualItemList:[],individualToolList:[],labourList:[],newLabourToggle:!1,inventory:[],stockedTools:[],selectedLabour:[],tempStoreList:[],temptoolStoreList:[],itemSerachQuerry:null,selectedStoreList:[],selectedToolStoreList:[],inventoryRequestDialogVisibility:!1,issueToolIRDialogVisibility:!1,issueItemIRDialogVisibility:!1,issueInventoryIRDialogVisibility:!1,inventoryRequestList:null,allToolListLoading:!1,inventoryListLoading:!1,serviceAddDialogVisibility:!1,allServiceList:[],items:[]}},created:function(){this.$store.dispatch("loadTicketStatus","workorder"),this.init()},mounted:function(){var _this=this;eventBus/* eventBus */.Y.$on("refresh-inventory-summary",(function(){_this.reload()}))},components:{InlineSvg:InlineSvg/* default */.Z},computed:{workorder:function(){return this.details.workorder},inventoryList:function(){var list=[];list=this.inventory.filter((function(item){return!(item.itemType.approvalNeeded||item.storeRoom.approvalNeeded)}));var self=this;if(this.selectedStoreList.length&&(list=list.filter((function(rt){if(self.selectedStoreList.findIndex((function(rl){return rl===rt.storeRoom.id}))>-1)return rt}))),this.itemSerachQuerry){var _self=this;return list.filter((function(data){if(data.itemType.name.toLowerCase().indexOf(_self.itemSerachQuerry.toLowerCase())>-1||data.storeRoom.name.toLowerCase().indexOf(_self.itemSerachQuerry.toLowerCase())>-1||0===JSON.stringify(data.quantity).toLowerCase().indexOf(_self.itemSerachQuerry.toLowerCase()))return data}))}return list},toolsList:function(){var list=[];list=this.stockedTools.filter((function(item){return!(item.toolType.approvalNeeded||item.storeRoom.approvalNeeded)}));var self=this;if(this.selectedToolStoreList.length&&(list=list.filter((function(rt){if(self.selectedToolStoreList.findIndex((function(rl){return rl===rt.storeRoom.id}))>-1)return rt}))),this.itemSerachQuerry){var _self2=this;return list.filter((function(data){if(data.toolType.name.toLowerCase().indexOf(_self2.itemSerachQuerry.toLowerCase())>-1||data.storeRoom.name.toLowerCase().indexOf(_self2.itemSerachQuerry.toLowerCase())>-1||0===JSON.stringify(data.quantity).toLowerCase().indexOf(_self2.itemSerachQuerry.toLowerCase()))return data}))}return list},individualItemListwrapper:function(){var list=this.individualItemList;if(this.itemSerachQuerry){var self=this;return list.filter((function(data){if(data.serialNumber.toLowerCase().indexOf(self.itemSerachQuerry.toLowerCase())>-1)return data}))}return list},individualToolListwrapper:function(){var list=this.individualToolList;if(this.itemSerachQuerry){var self=this;return list.filter((function(data){if(data.serialNumber.toLowerCase().indexOf(self.itemSerachQuerry.toLowerCase())>-1)return data}))}return list},workToolTotalCost:function(){return this.workOrderCostList.length&&this.workOrderCostList.find((function(rt){return"tools"===rt.costTypeEnum}))?this.workOrderCostList.find((function(rt){return"tools"===rt.costTypeEnum})).cost:0},actionRule:function(){return!!this.canEdit},workItemTotalCost:function(){return this.workOrderCostList.length&&this.workOrderCostList.find((function(rt){return"items"===rt.costTypeEnum}))?this.workOrderCostList.find((function(rt){return"items"===rt.costTypeEnum})).cost:0},workOrderTotalCost:function(){if(this.workOrderCostList&&this.workOrderCostList.length){for(var cost=0,i=0;i<this.workOrderCostList.length;i++)cost+=this.workOrderCostList[i].cost;return cost}return 0},workServiceCost:function(){return((this.workOrderCostList||[]).find((function(rt){return"service"===rt.costTypeEnum}))||{}).cost||0},individualTracking:function(){return!!(this.inventory&&this.inventory.length&&this.selectedInventory)},individualToolTracking:function(){return!!(this.stockedTools&&this.stockedTools.length&&this.selectedTool)},canEdit:function(){return this.isStateFlowEnabled?!this.$store.getters.isStatusLocked(this.workorder.moduleState.id,"workorder"):this.workorder&&2!==this.workorder.approvalState},isStateFlowEnabled:function(){return Boolean(this.workorder.moduleState&&this.workorder.moduleState.id)}},methods:{init:function(){
// this.loadWoItemParts(true)
// this.loadWorkOrderToolParts(true)
// this.getWorkOrderCostList(true)
// this.loadWorkOrderLabour(true)
this.loadWorkOrderService(!0),
// this.loadItem(true)
this.loadInventoryRequest()},reload:function(){this.loadWoItemParts(!0),this.loadInventoryRequest()},loadInventory:function(){var _this2=this,self=this;this.itemSerachQuerry=null,this.inventoryListLoading=!0,this.$http.get("v2/item/view/all?showForWorkorder=true&includeServingSite=true&siteId="+this.workorder.siteId).then((function(response){_this2.inventoryListLoading=!1;var inventory=[];if(inventory=response.data.result&&response.data.result.items?response.data.result.items:[],response){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(inventory);try{var _loop=function(){var item=_step.value;item.checked=!1,item.addedQuantity=0,item.invidualList=[],item.storeRoom&&self.tempStoreList.findIndex((function(rt){return rt.id===item.storeRoom.id}))<0&&self.tempStoreList.push(item.storeRoom)};for(_iterator.s();!(_step=_iterator.n()).done;)_loop()}catch(err){_iterator.e(err)}finally{_iterator.f()}var self2=self;self.inventory=inventory.filter((function(rt){if(self2.itemshowRule(rt))return rt}))}}))},loadToolslist:function(){var _this3=this,self=this;this.itemSerachQuerry=null,this.allToolListLoading=!0,this.$http.get("v2/tool/view/all").then((function(response){var stockedTools=[];if(stockedTools=response.data.result&&response.data.result.tool?response.data.result.tool:[],_this3.allToolListLoading=!1,response){var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(stockedTools);try{var _loop2=function(){var item=_step2.value;item.checked=!1,item.addedQuantity=0,item.invidualList=[],item.storeRoom&&self.temptoolStoreList.findIndex((function(rt){return rt.id===item.storeRoom.id}))<0&&self.temptoolStoreList.push(item.storeRoom)};for(_iterator2.s();!(_step2=_iterator2.n()).done;)_loop2()}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var self2=self;self.stockedTools=stockedTools.filter((function(rt){if(self2.toolshowRule(rt))return rt}))}}))},getItemCount:function(workItem){var diff;return workItem?(diff=workItem.requestedLineItem?Number(workItem.tempQuantity)+Number(workItem.requestedLineItem.issuedQuantity)-Number(workItem.requestedLineItem.usedQuantity)-Number(workItem.quantity):-1!==workItem.parentTransactionId?Number(workItem.tempQuantity)+Number(workItem.remainingQuantity)-Number(workItem.quantity):Number(workItem.tempQuantity)+Number(workItem.tempItem.quantity)-Number(workItem.quantity),Number(workItem.quantity)<0?"Quantity must be nonzero":diff<0?"Exceeded":diff):""},getItemQuantityState:function(workItem){var diff;return!!workItem&&(diff=workItem.requestedLineItem?Number(workItem.tempQuantity)+Number(workItem.requestedLineItem.issuedQuantity)-Number(workItem.requestedLineItem.usedQuantity)-Number(workItem.quantity):-1!==workItem.parentTransactionId?Number(workItem.tempQuantity)+Number(workItem.remainingQuantity)-Number(workItem.quantity):Number(workItem.tempQuantity)+Number(workItem.tempItem.quantity)-Number(workItem.quantity),Number(workItem.quantity)<0||diff<0)},getToolCount:function(worktool){var diff;return worktool?(diff=worktool.requestedLineItem?Number(worktool.requestedLineItem.issuedQuantity)-Number(worktool.quantity):-1!==worktool.parentTransactionId?Number(worktool.tempQuantity)+Number(worktool.remainingQuantity)-Number(worktool.quantity):Number(worktool.tempQuantity)+Number(worktool.tempTool.currentQuantity)-Number(worktool.quantity),Number(worktool.quantity)<0?"Quantity must be nonzero":diff<0?"Exceeded":diff):""},getToolQuantityState:function(worktool){var diff;return!!worktool&&(diff=worktool.requestedLineItem?Number(worktool.requestedLineItem.issuedQuantity)-Number(worktool.quantity):-1!==worktool.parentTransactionId?Number(worktool.tempQuantity)+Number(worktool.remainingQuantity)-Number(worktool.quantity):Number(worktool.tempQuantity)+Number(worktool.tempTool.currentQuantity)-Number(worktool.quantity),Number(worktool.quantity)<0||diff<0)},addNewWOLabour:function(){this.loadLabour(!0),this.newLabourToggle=!0},addNewWOItem:function(){var self=this;this.individualItemList=[],this.inventory=this.inventory.filter((function(rt){if(self.itemshowRule(rt))return rt.checked=!1,rt})),this.newItemPartToggle=!0},addNewWOTool:function(){var self=this;this.individualToolList=[],this.stockedTools=this.stockedTools.filter((function(rt){if(self.toolshowRule(rt))return rt.checked=!1,rt})),this.newToolPartToggle=!0},ticketstatusvalue:function(id){if(null!==id){var statusObj=this.$store.getters.getTicketStatus(id,"workorder");if(!statusObj)return"";var status=statusObj.status;return status||""}return""},itemshowRule:function(invt){if(invt.itemType.isRotating)return invt.quantity>0&&invt.itemType.currentQuantity>0;var tempWorkItem=this.workorderItemsList.filter((function(i){return i.item.id===invt.id})),check=!0;return tempWorkItem.forEach((function(i){-1===i.parentTransactionId&&(check=!1)})),check},toolshowRule:function(invt){if(invt.toolType.isRotating)return invt.toolType.currentQuantity>0;var tempWorkItem=this.workorderToolsList.filter((function(i){return i.tool.id===invt.id})),check=!0;return tempWorkItem.forEach((function(i){-1===i.parentTransactionId&&(check=!1)})),check},addAdditionalCost:function(){var _this4=this,self=this;if(this.additionalCost.name&&null!==this.additionalCost.cost){var param={workorderCost:{name:this.additionalCost.name,parentId:{id:this.workorder.id},cost:Number(this.additionalCost.cost),costType:5}};this.$http.post("v2/workorderCosts/add",param).then((function(response){0===response.data.responseCode?(self.$message.success(_this4.$t("common._common.cost_added_successfully")),self.actionToWorkorderStatusChange(),self.additionalCost={name:null,cost:null},self.getWorkOrderCostList()):self.$message.error(response.data.message)}))}},updateAdditionalCost:function(data){var _this5=this;if(data){var self=this,param={id:data.id,name:data.name,parentId:{id:this.workorder.id},costType:5,cost:Number(data.cost)};this.$http.post("v2/workorderCosts/update",param).then((function(response){self.actionToWorkorderStatusChange(),0===response.data.responseCode?(self.$message.success(_this5.$t("common._common.cost_edited_successfully")),self.getWorkOrderCostList()):self.$message.error(response.data.message)}))}},deleteAdditionalCost:function(id){if(id){var self=this,param={workordercostId:[id],parentId:this.workorder.id};this.$http.post("v2/workorderCosts/delete",param).then((function(response){self.actionToWorkorderStatusChange(),0===response.data.responseCode?(self.getWorkOrderCostList(),self.$message.success("Cost Deleted")):self.$message.error(response.data.message)}))}},deleteWorkorderLabour:function(workLabour){var _this6=this,self=this,param={parentId:this.workorder.id,workorderLabourIds:[]};param.workorderLabourIds.push(workLabour.id),this.$http.post("v2/workorderLabour/delete",param).then((function(response){0===response.data.responseCode?(self.$message.success(_this6.$t("common.products.labour_deleted_successfully")),self.actionToWorkorderStatusChange(),self.loadWorkOrderLabour(),self.getWorkOrderCostList()):self.$message.error(response.data.message)})).catch((function(error){}))},deleteWorkorderTool:function(workTool,index){if(workTool.tool.hasOwnProperty("storeRoom")){var self=this,param={parentId:this.workorder.id,workorderToolsIds:[]};param.workorderToolsIds.push(workTool.id),this.$http.post("v2/workorderTools/delete",param).then((function(response){0===response.data.responseCode?(self.actionToWorkorderStatusChange(),self.loadToolslist(),self.loadWorkOrderToolParts(),self.getWorkOrderCostList(),self.$message.success("Tool Deleted"),self.workorderToolsList.splice(index,1)):self.$message.error(response.data.message)})).catch()}else this.workorderToolsList.pop()},deleteWorkorderItem:function(workItem,index){var self=this;if(workItem.hasOwnProperty("purchasedItem")){var param={parentId:this.workorder.id,workorderItemsId:[]};param.workorderItemsId.push(workItem.id),this.$http.post("v2/workorderItems/delete",param).then((function(response){0===response.data.responseCode?(self.actionToWorkorderStatusChange(),self.loadInventory(),self.$message.success("Item Deleted"),self.getWorkOrderCostList(),self.workorderItemsList.splice(index,1)):self.$message.error(response.data.message)})).catch((function(error){}))}else this.workorderItemsList.pop()},cancelLabourDialog:function(){this.newLabourToggle=!1},cancelToolPartsDialog:function(){this.newToolPartToggle=!1,this.selectedTool=null,this.selectedTool=null},getWorkOrderCostList:function(loading){var self=this;this.$http.get("v2/workorderCostsList/parent/"+this.workorder.id).then((function(response){loading||(self.itemnsloading=!1),self.workOrderCostList=response.data.result.workorderCost}))},getCurrentTime:function(){return moment_timezone_default()().tz(vue_runtime_esm["default"].prototype.$timezone).valueOf()},addLabourSave:function(){var _this7=this,self=this,param={workorderLabourList:[]};if(this.labourList.length){for(var i=0;i<this.labourList.length;i++){var labour=this.labourList[i];if(labour.checked){var temp={parentId:this.workorder.id,startTime:-1,endTime:-1,labour:labour};param.workorderLabourList.push(temp),this.labourList[i]=!1}}this.labourLoading=!0,this.$http.post("/v2/workorderLabour/addOrUpdate",param).then((function(response){self.labourLoading=!0,0!==response.data.responseCode?_this7.$message.error(response.data.message):(self.$message.success(_this7.$t("common._common.added_available_labour_successfully")),self.actionToWorkorderStatusChange(),self.loadWorkOrderLabour(),self.getWorkOrderCostList())})).catch((function(error){_this7.$message.error(_this7.$t("common.wo_report.unable_to_add_labour")),self.labourLoading=!1})),this.newLabourToggle=!1}},addToolPartSave:function(){var _this8=this,self=this,param={workorderToolsList:[]},purchasedTools=[];this.individualToolList.length&&(purchasedTools=this.individualToolList.map((function(rt){if(rt.checked)return rt.id})),purchasedTools=purchasedTools.filter((function(rt){return"undefined"!==typeof rt})));var temp={parentId:this.workorder.id,tool:{id:this.selectedTool},quantity:1,assetIds:purchasedTools};param.workorderToolsList.push(temp),this.toolsloading=!0,this.$http.post("/v2/workorderTools/addOrUpdate",param).then((function(response){0!==response.data.responseCode?_this8.$message.error(response.data.message):(self.$message.success(_this8.$t("common._common.added_successfully")),self.selectedTool=null,self.actionToWorkorderStatusChange(),self.loadWorkOrderToolParts(!1,!0),self.getWorkOrderCostList())})).catch((function(error){_this8.$message.error(_this8.$t("common.wo_report.unable_to_update"))})),this.newToolPartToggle=!1},bulkaddItem:function(){var selectedItems=this.inventory.filter((function(rt){return rt.checked})),bulkItem=selectedItems.filter((function(rt){if(rt&&rt.itemType&&!rt.itemType.isRotating)return rt}));bulkItem.length&&(this.addbulkItem(bulkItem),this.individualItemList.length||(this.newItemPartToggle=!1)),this.individualTracking&&this.individualItemList.length&&(this.addbulkItem(!1,this.individualItemList),this.newItemPartToggle=!1)},bulkaddTool:function(){var selectedItems=this.stockedTools.filter((function(rt){return rt.checked})),bulkItem=selectedItems.filter((function(rt){if(rt&&rt.toolType&&!rt.toolType.isRotating)return rt}));bulkItem.length&&(this.addbulkTool(bulkItem),this.individualToolList.length||(this.newToolPartToggle=!1)),this.individualToolTracking&&this.individualToolList.length&&(this.addbulkTool(!1,this.individualToolList),this.newToolPartToggle=!1)},addbulkTool:function(tools,individualToolList){var _this9=this,self=this,param={workorderToolsList:[]},obj={},assetIds=[],data=[];if(individualToolList&&individualToolList.length)for(var i=0;i<individualToolList.length;i++)data=individualToolList[i],data.checked&&(assetIds=[data.id],obj={parentId:this.workorder.id,tool:{id:data.tool.id},quantity:1,assetIds:assetIds},param.workorderToolsList.push(obj));else if(tools){data=[];for(var _i=0;_i<tools.length;_i++){var _data=tools[_i];obj={parentId:this.workorder.id,tool:{id:_data.id},quantity:1,assetIds:assetIds},param.workorderToolsList.push(obj)}}this.toolsloading=!0,this.$http.post("/v2/workorderTools/addOrUpdate",param).then((function(response){0!==response.data.responseCode?_this9.$message.error(response.data.message):(self.$message.success(_this9.$t("common._common.added_successfully")),self.selectedTool=null,self.actionToWorkorderStatusChange(),self.loadWorkOrderToolParts(!1,!0),self.getWorkOrderCostList())})).catch((function(){_this9.$message.error(_this9.$t("common.wo_report.unable_to_update"))}))},addbulkItem:function(items,individualItemList){var _this10=this,param={workorderItems:[]},obj={},assetIds=[],data=[];if(individualItemList&&individualItemList.length)for(var i=0;i<individualItemList.length;i++)data=individualItemList[i],data.checked&&(assetIds=[data.id],obj={parentId:this.workorder.id,item:{id:data.item.id},quantity:1,assetIds:assetIds,remainingQuantity:0},param.workorderItems.push(obj));else if(items){data=[];for(var _i2=0;_i2<items.length;_i2++){var _data2=items[_i2];obj={parentId:this.workorder.id,item:{id:_data2.id},quantity:1,assetIds:assetIds,remainingQuantity:0},param.workorderItems.push(obj)}}var self=this;this.$http.post("/v2/workorderItems/addOrUpdate",param).then((function(response){0!==response.data.responseCode?self.$message.error(response.data.message):(self.$message.success(_this10.$t("common.header.item_added_successfully")),self.actionToWorkorderStatusChange(),self.loadWoItemParts(!1,!0))})).catch((function(){}))},addNewbulkItem:function(){var _this11=this,param={workorderItems:[]},obj={},assetIds=[];this.inventoryList.forEach((function(item){obj={},assetIds=[],item.itemType.isRotating?item.invidualList.length&&(assetIds=item.invidualList.map((function(rl){return rl.id})),obj={parentId:_this11.workorder.id,item:{id:item.id},quantity:item.invidualList.length,assetIds:assetIds},param.workorderItems.push(obj)):item.addedQuantity>0&&(obj={parentId:_this11.workorder.id,item:{id:item.id},quantity:item.addedQuantity,assetIds:assetIds},param.workorderItems.push(obj))})),this.selectedInventory=null,this.individualItemList=[],this.individualToolList=[],this.newItemPartToggle=!1;var self=this;this.$http.post("/v2/workorderItems/addOrUpdate",param).then((function(response){0!==response.data.responseCode?self.$message.error(response.data.message):(self.$message.success(_this11.$t("common.header.item_added_successfully")),self.actionToWorkorderStatusChange(),self.loadWoItemParts(!1,!0))})).catch((function(error){}))},addNewbulkTool:function(){var _this12=this,self=this,param={workorderToolsList:[]},obj={},assetIds=[];this.toolsList.forEach((function(item){obj={},assetIds=[],item.toolType.isRotating?item.invidualList.length&&(assetIds=item.invidualList.map((function(rl){return rl.id})),obj={parentId:_this12.workorder.id,tool:{id:item.id},quantity:item.invidualList.length,assetIds:assetIds},param.workorderToolsList.push(obj)):item.addedQuantity>0&&(obj={parentId:_this12.workorder.id,tool:{id:item.id},quantity:item.addedQuantity,assetIds:assetIds},param.workorderToolsList.push(obj))})),this.selectedTool=null,this.individualItemList=[],this.individualToolList=[],this.newToolPartToggle=!1,this.$http.post("/v2/workorderTools/addOrUpdate",param).then((function(response){0!==response.data.responseCode?self.$message.error(response.data.message):(self.$message.success(_this12.$t("common.products.tools_added_successfully")),self.selectedTool=null,self.actionToWorkorderStatusChange(),self.loadWorkOrderToolParts(!1,!0),self.getWorkOrderCostList())})).catch((function(){}))},actionToWorkorderStatusChange:function(){this.fetchWo()},cancelItemPartsDialog:function(){this.newItemPartToggle=!1,this.selectedInventory=null,this.selectedTool=null},loadItem:function(){var _this13=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,InventoryUtil/* getFilteredItemListWithParentModule */.fL)("workorder");case 2:_this13.items=_context.sent;case 3:case"end":return _context.stop()}}),_callee)})))()},loadStockedTools:function(){var _this14=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,(0,InventoryUtil/* getFilteredToolListWithParentModule */.EJ)("workorder");case 2:_this14.tools=_context2.sent;case 3:case"end":return _context2.stop()}}),_callee2)})))()},changeWorkLabourField:function(workLabour,index,changedfield){var _this15=this,self=this,duration=Number(workLabour.duration).toFixed(2),param={workorderLabourList:[]};-1===workLabour.startTime&&(workLabour.startTime=null),-1===workLabour.endTime&&(workLabour.endTime=null);var startTime=null!==workLabour.startTime?moment_timezone_default()(workLabour.startTime).tz(this.$timezone).valueOf():workLabour.startTime,endTime=null!==workLabour.endTime?moment_timezone_default()(workLabour.endTime).tz(this.$timezone).valueOf():workLabour.endTime,temp={id:workLabour.id,parentId:this.workorder.id,duration:3===changedfield||1===changedfield?duration:-1,labour:workLabour.labour,startTime:startTime||-99,endTime:2===changedfield?endTime:-99};param.workorderLabourList.push(temp),this.$http.post("/v2/workorderLabour/addOrUpdate",param).then((function(response){self.actionToWorkorderStatusChange(),0!==response.data.responseCode?self.$message.error(response.data.message):(self.$message.success(_this15.$t("common._common.updated_successfully")),self.loadWorkOrderLabour())})).catch((function(){}))},changeWorkToolField:function(workTool,index,durationHour,changedField){var _this16=this;if(Number(workTool.quantity)<=Number(workTool.tempQuantity)+Number(workTool.tempTool.quantity)){var param={workorderToolsList:[]};-1===workTool.issueTime&&(workTool.issueTime=null),-1===workTool.returnTime&&(workTool.returnTime=null);var issueTime=null!==workTool.issueTime?moment_timezone_default()(workTool.issueTime).tz(this.$timezone).valueOf():workTool.issueTime,returnTime=null!==workTool.returnTime?moment_timezone_default()(workTool.returnTime).tz(this.$timezone).valueOf():workTool.returnTime,temp={},duration=Number(workTool.duration);durationHour?(duration=Number(workTool.durationInHour).toFixed(2),null!==issueTime&&issueTime>0&&duration>0&&(returnTime=Number(issueTime)+Number(duration))):duration=Number(duration).toFixed(2),0!==issueTime&&null!==issueTime||(issueTime=-1),0!==returnTime&&null!==returnTime||(returnTime=-1),this.workorderToolsList[index].duration=duration,temp={parentId:this.workorder.id,id:workTool.id,tool:{id:workTool.tool.id},quantity:parseInt(workTool.quantity),duration:1==changedField||3==changedField?duration:-1,issueTime:issueTime||-99,returnTime:2===changedField?returnTime:-99,requestedLineItem:workTool.requestedLineItem,parentTransactionId:workTool.parentTransactionId},param.workorderToolsList.push(temp);var self=this;this.$http.post("/v2/workorderTools/addOrUpdate",param).then((function(response){0===response.data.responseCode?(self.$message.success(_this16.$t("common._common.edited_successfully")),self.actionToWorkorderStatusChange(),self.loadWorkOrderToolParts(),self.getWorkOrderCostList()):self.$message.error(response.data.message)}))}else this.$message.error(this.$t("common.dashboard.quantity_should_be_less"))},changeWorkItemQuantity:function(workItem){var _this17=this;if(workItem.quantity<=workItem.tempQuantity+workItem.tempItem.quantity){var param={workorderItems:[]},temp={parentId:this.workorder.id,id:workItem.id,item:{id:workItem.item.id},quantity:workItem.quantity,requestedLineItem:workItem.requestedLineItem,parentTransactionId:workItem.parentTransactionId,remainingQuantity:workItem.remainingQuantity+workItem.tempQuantity};param.workorderItems.push(temp);var self=this;this.$http.post("/v2/workorderItems/addOrUpdate",param).then((function(response){0===response.data.responseCode?(self.loadWoItemParts(),self.actionToWorkorderStatusChange(),self.$message.success(_this17.$t("common._common.updated_successfully"))):self.$message.error(response.data.message)}))}else this.$message.error(this.$t("common.dashboard.quantity_should_be_less"))},loadWorkOrderToolParts:function(loading,inventory){var _this18=this;loading&&(this.toolLoading=!0);var self=this;this.$http.get("/v2/workorderToolsList/parent/"+this.workorder.id).then((function(response){var wktool={};for(var workTool in _this18.workorderToolsList=response.data.result.workorderTools,response.data.result.workorderTools)_this18.workorderToolsList[workTool].durationInHour=_this18.workorderToolsList[workTool].duration.toFixed(2),_this18.workorderToolsList[workTool].issueTime=-1===_this18.workorderToolsList[workTool].issueTime||null===_this18.workorderToolsList[workTool].issueTime?null:_this18.workorderToolsList[workTool].issueTime,_this18.workorderToolsList[workTool].returnTime=-1===_this18.workorderToolsList[workTool].returnTime||null===_this18.workorderToolsList[workTool].returnTime?null:_this18.workorderToolsList[workTool].returnTime,wktool=response.data.result.workorderTools[workTool],wktool.tempQuantity=wktool.quantity,wktool.tempTool=wktool.tool;self.workorderToolsList=self.$helpers.cloneObject(response.data.result.workorderTools),loading&&self.loadToolslist(),inventory&&self.loadToolslist(),_this18.toolLoading=!1})).catch((function(error){_this18.$message.error(_this18.$t("common.wo_report.unable_to_load_tools")),_this18.toolLoading=!1})),this.loadStockedTools()},loadLabour:function(){var _this19=this,self=this;this.$http.get("/v2/labour/labourList").then((function(response){self.labourList=response.data.result.labours;for(var i=0;i<self.labourList.length;i++){var labourItem=self.labourList[i];self.selectedLabour.includes(labourItem.id)&&self.labourList.splice(i,1)}})).catch((function(error){self.$message.error(_this19.$t("common.wo_report.unable_to_labor_list"))}))},loadWorkOrderLabour:function(loading){var _this20=this;loading&&(this.labourLoading=!0);var self=this;this.$http.get("/v2/workorderLabourList/parent/"+this.workorder.id).then((function(response){for(var workLabour in _this20.workLabourTotalCost=0,response.data.result.workorderLabour)_this20.workLabourTotalCost=_this20.workLabourTotalCost+response.data.result.workorderLabour[workLabour].cost;for(var index in self.workorderLabourList=self.$helpers.cloneObject(response.data.result.workorderLabour),self.selectedLabour=[],self.workorderLabourList){var workLabourItem=self.workorderLabourList[index];self.selectedLabour.push(workLabourItem.labour.id),workLabourItem.startTime=workLabourItem.startTime<=0?null:workLabourItem.startTime,workLabourItem.endTime=workLabourItem.endTime<=0?null:workLabourItem.endTime,workLabourItem.duration=workLabourItem.duration.toFixed(2)}self.getWorkOrderCostList(),self.labourLoading=!1})).catch((function(error){self.$message.error(_this20.$t("common.wo_report.unable_to_load_labor")),self.labourLoading=!1}))},loadWoItemParts:function(loading,inventory){var _this21=this;this.loadWorkOrderItemParts=[];var self=this,self1=this;loading&&(this.itemnsloading=!0),this.$http.get("/v2/workorderItemsList/parent/"+this.workorder.id).then((function(response){var workItem={};for(var item in response.data.result.workorderItem)workItem=response.data.result.workorderItem[item],workItem.tempQuantity=workItem.quantity,workItem.tempItem=workItem.item;(loading||inventory)&&self.loadInventory(),self1.itemnsloading=!1,self.workorderItemsList=self.$helpers.cloneObject(response.data.result.workorderItem),self1.getWorkOrderCostList()})).catch((function(){self.$message.error(_this21.$t("common.wo_report.unable_to_load_parts"))})),this.loadItem()},loadindividualTrackingList:function(items){var _this22=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var filters,individualItemList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this22.individualItemList=[],_this22.iTloading=!0,filters={rotatingItem:{operatorId:36,value:items.map((function(rt){return rt.id+""}))},isUsed:{operatorId:15,value:["false"]}},_context3.next=5,_this22.$util.getFilteredAssetList(filters);case 5:individualItemList=_context3.sent,_this22.individualItemList=individualItemList.map((function(item){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},item),{},{checked:!1})})),_this22.iTloading=!1;case 8:case"end":return _context3.stop()}}),_callee3)})))()},loadindividualToolTrackingList:function(items){var _this23=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var filters,individualToolList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _this23.individualToolList=[],_this23.iTloading=!0,filters={rotatingTool:{operatorId:36,value:items.map((function(rt){return rt.id+""}))},isUsed:{operatorId:15,value:[!1+""]}},_context4.next=5,_this23.$util.getFilteredAssetList(filters);case 5:individualToolList=_context4.sent,_this23.individualToolList=individualToolList.map((function(item){return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},item),{},{checked:!1})})),_this23.iTloading=!1;case 8:case"end":return _context4.stop()}}),_callee4)})))()},loadInventoryRequest:function(){var _arguments=arguments,_this24=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var force,workorder,_ref,id,relatedFieldName,relatedConfig,_yield$API$fetchAllRe,error,list;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return force=_arguments.length>0&&void 0!==_arguments[0]&&_arguments[0],_this24.inventoryRequestForWOLoading=!0,workorder=_this24.workorder,_ref=workorder||{},id=_ref.id,relatedFieldName=(0,relatedFieldUtil/* getRelatedFieldName */.C9)("workorder","inventoryrequest"),relatedConfig={moduleName:"workorder",id:id,relatedModuleName:"inventoryrequest",relatedFieldName:relatedFieldName},_context5.next=8,api/* API */.bl.fetchAllRelatedList(relatedConfig,{},{force:force});case 8:_yield$API$fetchAllRe=_context5.sent,error=_yield$API$fetchAllRe.error,list=_yield$API$fetchAllRe.list,error?_this24.$error.message(error.message||"Error Occured"):(0,validation/* isEmpty */.xb)(list)||(_this24.inventoryRequestList=list),_this24.inventoryRequestForWOLoading=!1;case 13:case"end":return _context5.stop()}}),_callee5)})))()},loadWorkOrderService:function(loading){var _this25=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var route,_yield$API$get,data,error,message,_data$workorderServic,workorderServices;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:return loading&&(_this25.loading.woService=!0),route="/v2/workorderServiceList/parent/".concat(_this25.workorder.id),_context6.next=4,api/* API */.bl.get(route,null,{force:!0});case 4:_yield$API$get=_context6.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?(message=error.message,_this25.$message.error(message||_this25.$t("common._common.error_occured_while_fetching_workorder"))):(_data$workorderServic=data.workorderServices,workorderServices=void 0===_data$workorderServic?[]:_data$workorderServic,workorderServices.forEach((function(woService){if((0,validation/* isEmpty */.xb)(woService.endTime)&&(woService.endTime=null),(0,validation/* isEmpty */.xb)(woService.startTime)&&(woService.startTime=null),woService.cost<=0&&(woService.cost=0),woService.duration<=0)woService.duration=0;else if(!(0,validation/* isEmpty */.xb)(woService.duration)){var duration=woService.duration/3600;woService.duration=Number(duration).toFixed(2)}})),_this25.workorderServiceList=workorderServices||[]),_this25.loading.woService=!1;case 9:case"end":return _context6.stop()}}),_callee6)})))()},addNewWOService:function(){this.loadAllServices(),this.serviceAddDialogVisibility=!0},loadAllServices:function(){var _this26=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee7(){var allWoServiceIds,_yield$API$get2,data,error,message,_data$services,services;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context7){while(1)switch(_context7.prev=_context7.next){case 0:return allWoServiceIds=(_this26.workorderServiceList||[]).map((function(woService){return _this26.$getProperty(woService,"service.id",-1)})),_this26.loading.serviceList=!0,_context7.next=4,api/* API */.bl.get("/v2/service/all");case 4:_yield$API$get2=_context7.sent,data=_yield$API$get2.data,error=_yield$API$get2.error,error?(message=error.message,_this26.$message.error(message||_this26.$t("common._common.error_occured_while_fetching_services_list"))):(_data$services=data.services,services=void 0===_data$services?[]:_data$services,(0,validation/* isEmpty */.xb)(services)||(services=services.filter((function(service){return!allWoServiceIds.includes(service.id)}))||[],services.forEach((function(service){_this26.$setProperty(service,"checked",!1)}))),_this26.allServiceList=services||[]),_this26.loading.serviceList=!1;case 9:case"end":return _context7.stop()}}),_callee7)})))()},closeServiceDialog:function(){this.serviceAddDialogVisibility=!1},addWoService:function(){var _this27=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee8(){var param,_this27$allServiceLis,allServiceList,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context8){while(1)switch(_context8.prev=_context8.next){case 0:if(param={workorderServiceList:[]},_this27$allServiceLis=_this27.allServiceList,allServiceList=void 0===_this27$allServiceLis?[]:_this27$allServiceLis,allServiceList.forEach((function(service){if(service.checked){var tempObj={parentId:_this27.workorder.id,startTime:-1,endTime:-1,service:service};param.workorderServiceList.push(tempObj)}})),(0,validation/* isEmpty */.xb)(param.workorderServiceList)){_context8.next=13;break}return _this27.loading.woServiceSave=!0,_context8.next=7,api/* API */.bl.post("/v2/workorderService/addOrUpdate",param);case 7:_yield$API$post=_context8.sent,error=_yield$API$post.error,error?_this27.$message.error(error||_this27.$t("common._common.error_occured_while_adding_workorder_services")):(_this27.$message.success(_this27.$t("common._common.added_service_successfully")),_this27.closeServiceDialog(),_this27.serviceUpdateActions()),_this27.loading.woServiceSave=!1,_context8.next=14;break;case 13:_this27.closeServiceDialog();case 14:case"end":return _context8.stop()}}),_callee8)})))()},serviceUpdateActions:function(){this.actionToWorkorderStatusChange(),this.loadWorkOrderService(!0),this.getWorkOrderCostList()},deleteWoService:function(woService){var _this28=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee9(){var param,_yield$API$post2,error,message;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context9){while(1)switch(_context9.prev=_context9.next){case 0:return param={parentId:_this28.workorder.id,workorderServiceIds:[]},param.workorderServiceIds.push(woService.id),_this28.loading.woService=!0,_context9.next=5,api/* API */.bl.post("v2/workorderService/delete",param);case 5:_yield$API$post2=_context9.sent,error=_yield$API$post2.error,error?(message=error.message,_this28.$message.error(message||_this28.$t("common._common.error_occured_while_deleting_workorder_service"))):(_this28.$message.success(_this28.$t("common.products.service_deleted_successfully")),_this28.serviceUpdateActions()),_this28.loading.woService=!0;case 9:case"end":return _context9.stop()}}),_callee9)})))()},changeWorkServiceField:function(workService,changedfield){var _this29=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee10(){var duration,param,startTime,endTime,temp,_yield$API$post3,error,message;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context10){while(1)switch(_context10.prev=_context10.next){case 0:return duration=Number(workService.duration).toFixed(2),param={workorderServiceList:[]},(0,validation/* isEmpty */.xb)(workService.startTime)&&(workService.startTime=null),(0,validation/* isEmpty */.xb)(workService.endTime)&&(workService.endTime=null),startTime=null!==workService.startTime?moment_timezone_default()(workService.startTime).tz(_this29.$timezone).valueOf():workService.startTime,endTime=null!==workService.endTime?moment_timezone_default()(workService.endTime).tz(_this29.$timezone).valueOf():workService.endTime,temp={id:workService.id,parentId:_this29.workorder.id,duration:3===changedfield||1===changedfield?duration:-1,service:workService.service,startTime:startTime||-99,endTime:2===changedfield?endTime:-99,quantity:workService.quantity},param.workorderServiceList.push(temp),_context10.next=10,api/* API */.bl.post("/v2/workorderService/addOrUpdate",param);case 10:_yield$API$post3=_context10.sent,error=_yield$API$post3.error,error?(message=error.message,_this29.$message.error(message||_this29.$t("common._common.error_occured_while_updating_workorder_service"))):(_this29.$message.success(_this29.$t("common._common.updated_successfully")),_this29.loadWorkOrderService(!0),_this29.getWorkOrderCostList());case 13:case"end":return _context10.stop()}}),_callee10)})))()}}},widgets_InventoryServicesvue_type_script_lang_js=InventoryServicesvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(widgets_InventoryServicesvue_type_script_lang_js,render,staticRenderFns,!1,null,"969c5f6a",null)
/* harmony default export */,InventoryServices=component.exports},
/***/353654:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"d7f1f315aba97cd14240ee6f3d34465f.svg";
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/97006.js.map