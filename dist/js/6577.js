"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[6577],{
/***/406577:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ActualsCost}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/workorders/v3/widgets/actuals/ActualsCost.vue?vue&type=template&id=6e0ed803&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{key:_vm.customCostList.length},[_c("div",{staticClass:"flex cost-title"},[_c("div",{staticClass:"fc-black3-16 p20 pB15"},[_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.cost"))+" ")]),_c("div",{staticClass:"add-color"},[_c("div",{staticClass:"pointer",on:{click:function($event){return _vm.addAdditionalCost()}}},[_c("i",{staticClass:"el-icon-plus plus-icon"}),_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.add"))+" ")])])]),_vm.isLoading?_c("div",[_c("spinner",{attrs:{show:_vm.isLoading,size:"80"}})],1):_c("table",{ref:"actualsCostTable"},[_c("tbody",[_c("tr",[_c("td",{staticClass:"pL20"},[_vm._v(_vm._s(_vm.$t("common.header.labours")))]),_c("td",{staticClass:"text-right pT15 pB15 pR5 cost-color"},[_vm._v(" "+_vm._s(_vm.$currency+" "+_vm.labourCost)+" ")]),_c("td",{staticClass:"width20px"})]),_c("tr",[_c("td",{staticClass:"pL20"},[_vm._v(_vm._s(_vm.$t("common.header.items")))]),_c("td",{staticClass:"text-right pT15 pB15 pR5 cost-color"},[_vm._v(" "+_vm._s(_vm.$currency+" "+_vm.itemCost)+" ")]),_c("td",{staticClass:"width20px"})]),_c("tr",[_c("td",{staticClass:"pL20"},[_vm._v(_vm._s(_vm.$t("common.header.tools")))]),_c("td",{staticClass:"text-right pT15 pB15 pR5 cost-color"},[_vm._v(" "+_vm._s(_vm.$currency+" "+_vm.toolCost)+" ")]),_c("td",{staticClass:"width20px"})]),_c("tr",[_c("td",{staticClass:"pL20"},[_vm._v(_vm._s(_vm.$t("common.products.services")))]),_c("td",{staticClass:"text-right pT15 pB15 pR5 cost-color"},[_vm._v(" "+_vm._s(_vm.$currency+" "+_vm.serviceCost)+" ")]),_c("td",{staticClass:"width20px"})]),_vm._l(_vm.customCostList,(function(customCost){return _c("tr",{key:customCost.id,staticClass:"addtional-cost"},[_c("td",{staticClass:"pL20 additional-cost-name"},[_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"label-txt-black textoverflow-ellipsis",attrs:{content:customCost.name}},[_vm._v(" "+_vm._s(customCost.name||"---")+" ")])]),_c("td",{staticClass:"text-right pT15 pB15 pR5 cost-color"},[_vm._v(" "+_vm._s(_vm.$currency+" "+(customCost.cost||0))+" ")]),_c("td",{staticClass:"width20px"},[_c("span",{staticClass:"additionalCostDelete",on:{click:function($event){return _vm.deleteAdditionalCost(customCost.id)}}},[_c("i",{staticClass:"el-icon-delete"})])])])}))],2)]),_vm.additionalCostDialogVisibility?_c("el-dialog",{attrs:{visible:_vm.additionalCostDialogVisibility,width:"40%",fullscreen:!1,"append-to-body":!0,"before-close":_vm.closeDialog},on:{"update:visible":function($event){_vm.additionalCostDialogVisibility=$event}}},[_c("template",{slot:"title"},[_c("div",{staticClass:"label-txt-black fw-bold text-uppercase fL"},[_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.additional_cost"))+" ")])]),_c("div",[_c("div",{staticClass:"headers"},[_c("div",{staticClass:"cost-name"},[_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.cost_name"))+" "),_c("span",{staticClass:"mandatory"},[_vm._v(" * ")])]),_c("div",{staticClass:"pL142"},[_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.cost"))+" "),_c("span",{staticClass:"mandatory"},[_vm._v(" * ")])])]),_c("div",{staticClass:"overflow-y-scroll max-height-275 pL15"},_vm._l(_vm.additionalCosts,(function(additionalCost,index){return _c("div",{key:index,staticClass:"flex"},[_c("div",{staticClass:"cost-common-wrap"},[_c("div",{staticClass:"cost-name-wrap"},[_c("div",[_c("el-input",{staticClass:"fc-input-full-border2 width200px",attrs:{placeholder:_vm.$t("common.workorder_actuals.enter_name")},model:{value:additionalCost.name,callback:function($$v){_vm.$set(additionalCost,"name",$$v)},expression:"additionalCost.name"}})],1)]),_c("div",{staticClass:"cost-name-wrap"},[_c("div",{staticStyle:{display:"flex"}},[_c("div",{staticClass:"currency"},[_vm._v(" "+_vm._s(""+_vm.$currency)+" ")]),_c("div",[_c("el-input",{staticClass:"fc-input-full-border2 width200px",attrs:{type:"number",placeholder:_vm.$t("common.workorder_actuals.enter_price")},model:{value:additionalCost.cost,callback:function($$v){_vm.$set(additionalCost,"cost",$$v)},expression:"additionalCost.cost"}})],1)])])]),_c("div",{staticClass:"remove-icon"},[_vm.additionalCosts.length>1?_c("i",{staticClass:"el-icon-remove-outline fc-row-delete-icon f15 bold",on:{click:function($event){return _vm.removeAdditionalCost(index)}}}):_vm._e()])])})),0),_c("div",{staticClass:"pT20 pL15"},[_c("el-button",{staticClass:"line-item-list-footer-add-btn",attrs:{type:"primary"},on:{click:function($event){return _vm.newAdditionalCost()}}},[_c("i",{staticClass:"el-icon-plus plus-icon"}),_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.add"))+" ")])],1)]),_c("div",{staticClass:"footer-btns"},[_c("el-button",{staticClass:"save-btn",attrs:{type:"primary"},on:{click:function($event){return _vm.saveRecords()}}},[_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.save")))]),_c("el-button",{staticClass:"cancel-btn",attrs:{type:"primary"},on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(" "+_vm._s(_vm.$t("common.workorder_actuals.cancel")))])],1)],2):_vm._e(),_vm.isLoading?_vm._e():_c("div",{staticClass:"text-right  grand-total"},[_c("div",{staticClass:"cost-color pB10"},[_vm._v(" "+_vm._s(_vm.$t("common._common.grand_total"))+" ")]),_c("div",{staticClass:"fw-550"},[_vm._v(_vm._s(_vm.$currency+" "+_vm.grossAmount))])])],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),eventBus=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(434284),__webpack_require__(450886),__webpack_require__(162506),__webpack_require__(670560),__webpack_require__(648324),__webpack_require__(947522),__webpack_require__(425728),__webpack_require__(398011)),utility_methods=__webpack_require__(773258),validation=__webpack_require__(990260),api=__webpack_require__(32284),ActualsCostvue_type_script_lang_js={props:["details","resizeWidget"],data:function(){return{additionalCostDialogVisibility:!1,showDeleteIcon:!1,itemCost:0,toolCost:0,serviceCost:0,labourCost:0,grossAmount:0,isLoading:!1,customCostList:{},additionalCosts:[{name:null,cost:null}]}},computed:{workorder:function(){var _ref=this||{},details=_ref.details,_ref2=details||{},workorder=_ref2.workorder;return workorder}},created:function(){this.loadWorkOrderCostList()},mounted:function(){var _this=this;eventBus/* eventBus */.Y.$on("reloadWorkorderActualsCost",(function(){_this.loadWorkOrderCostList()}))},methods:{deleteAdditionalCost:function(additionalCostId){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var moduleName,_yield$API$deleteReco,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _this2.isLoading=!0,moduleName="workorderCost",_context.next=4,api/* API */.bl.deleteRecord(moduleName,additionalCostId);case 4:_yield$API$deleteReco=_context.sent,error=_yield$API$deleteReco.error,error?_this2.$message.error(error.message||_this2.$t("common._common.error_occured")):(_this2.$message.success(_this2.$t("common.workorder_actuals.add_cost_deleted_success")),_this2.isLoading=!0,_this2.loadWorkOrderCostList());case 7:case"end":return _context.stop()}}),_callee)})))()},saveRecords:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var _ref3,additionalCosts,workorder,_ref4,id,workorderCost,url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(_ref3=_this3||{},additionalCosts=_ref3.additionalCosts,workorder=_ref3.workorder,_ref4=workorder||{},id=_ref4.id,additionalCosts=additionalCosts.filter((function(element){var _ref5=element||{},name=_ref5.name,cost=_ref5.cost;return!(0,validation/* isEmpty */.xb)(name)&&!(0,validation/* isEmpty */.xb)(cost)})),(0,validation/* isEmpty */.xb)(additionalCosts)){_context2.next=14;break}return workorderCost=additionalCosts.map((function(element){var _ref6=element||{},name=_ref6.name,cost=_ref6.cost;return{name:name,cost:cost,parentId:{id:id},costType:5}})),url="v3/modules/bulkCreate/workorderCost",params={data:{workorderCost:workorderCost},moduleName:"workorderCost"},_context2.next=9,api/* API */.bl.post(url,params);case 9:_yield$API$post=_context2.sent,error=_yield$API$post.error,error?_this3.$message.error(error.message||_this3.$t("common._common.error_occured")):(_this3.$message.success(_this3.$t("common.workorder_actuals.add_cost_added_success")),_this3.loadWorkOrderCostList(),_this3.closeDialog()),_context2.next=15;break;case 14:_this3.$message.error(_this3.$t("common.workorder_actuals.please_add_additional_cost"));case 15:case"end":return _context2.stop()}}),_callee2)})))()},removeAdditionalCost:function(index){var additionalCosts=this.additionalCosts;additionalCosts.splice(index,1)},closeDialog:function(){this.additionalCosts=[{name:null,cost:null}],this.additionalCostDialogVisibility=!1},newAdditionalCost:function(){var additionalCosts=this.additionalCosts,additionalCost={name:null,cost:null};additionalCosts.push((0,utility_methods/* deepCloneObject */.kh)(additionalCost))},autoResize:function(){var _this4=this;this.$nextTick((function(){var container=_this4.$refs["actualsCostTable"];if(container){var height=container.scrollHeight+140,width=container.scrollWidth;_this4.resizeWidget({height:height,width:width})}}))},addAdditionalCost:function(){this.additionalCostDialogVisibility=!0},loadWorkOrderCostList:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _ref7,workorder,_ref8,id,params,_yield$API$fetchAll,list,error,totalCostOfCustomCost,customCostList,laboursCostObj,itemsCostObj,toolsCostObj,servicesCostObj,_ref9,labourCost,itemCost,toolCost,serviceCost;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _this5.isLoading=!0,_ref7=_this5||{},workorder=_ref7.workorder,_ref8=workorder||{},id=_ref8.id,params={filters:JSON.stringify({parentId:{operatorId:9,value:["".concat(id)]}})},_context3.next=6,api/* API */.bl.fetchAll("workorderCost",params);case 6:_yield$API$fetchAll=_context3.sent,list=_yield$API$fetchAll.list,error=_yield$API$fetchAll.error,(0,validation/* isEmpty */.xb)(error)?(totalCostOfCustomCost=0,customCostList=list.filter((function(element){return"custom"===element.costTypeEnum})),_this5.customCostList=customCostList,(0,validation/* isEmpty */.xb)(customCostList)||customCostList.forEach((function(element){totalCostOfCustomCost+=element.cost||0})),laboursCostObj=list.find((function(element){return"Labour"===element.costName})),itemsCostObj=list.find((function(element){return"Items"===element.costName})),toolsCostObj=list.find((function(element){return"Tools"===element.costName})),servicesCostObj=list.find((function(element){return"Service"===element.costName})),_this5.labourCost=_this5.$getProperty(laboursCostObj,"cost",0),_this5.itemCost=_this5.$getProperty(itemsCostObj,"cost",0),_this5.toolCost=_this5.$getProperty(toolsCostObj,"cost",0),_this5.serviceCost=_this5.$getProperty(servicesCostObj,"cost",0),_ref9=_this5||{},labourCost=_ref9.labourCost,itemCost=_ref9.itemCost,toolCost=_ref9.toolCost,serviceCost=_ref9.serviceCost,_this5.grossAmount=labourCost+itemCost+toolCost+serviceCost+totalCostOfCustomCost,_this5.isLoading=!1,_this5.autoResize()):_this5.$message.error(error.message||_this5.$t("common._common.error_occured"));case 10:case"end":return _context3.stop()}}),_callee3)})))()}}},actuals_ActualsCostvue_type_script_lang_js=ActualsCostvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(actuals_ActualsCostvue_type_script_lang_js,render,staticRenderFns,!1,null,"6e0ed803",null)
/* harmony default export */,ActualsCost=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/6577.js.map