"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[3127],{
/***/381056:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return AnomalyMixin}});
// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js
__webpack_require__(260228),__webpack_require__(670560);
// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.push.js
var render,staticRenderFns,moment_timezone=__webpack_require__(480008),moment_timezone_default=__webpack_require__.n(moment_timezone),NewDateHelper=__webpack_require__(105534),AnomalyMixinvue_type_script_lang_js={computed:{lastMonth:function(){return moment_timezone_default()().tz(this.$timezone).subtract(1,"months").format("MMMM")},currentMonth:function(){return moment_timezone_default()().tz(this.$timezone).startOf("month").format("MMMM")},isMetricsApiLoading:function(){return this.$store.state.anomalies.isLoading},currMntNLastMntRanges:function(){var thisMonthdateRange=NewDateHelper/* default */.Z.getDatePickerObject(28,this.$timezone),lastMonthDateRange=NewDateHelper/* default */.Z.getDatePickerObject(27,this.$timezone),dateRanges={};return dateRanges.startTime=lastMonthDateRange.value[0],dateRanges.endTime=thisMonthdateRange.value[1],dateRanges}},methods:{loadEnrgyByCdd:function(resourcesIds){return this.$util.getWorkFlowResult(49,[resourcesIds,this.details.alarm.resource.siteId])},loadEnergyWastage:function(resourceIds){return this.$util.getWorkFlowResult(99,[resourceIds,this.details.alarm.id])},loadAnomaliesCount:function(resourceIds,isRCA){return this.$util.getWorkFlowResult(100,[resourceIds,this.details.alarm.id,isRCA||!1])},loadDeviation:function(resourceIds){return this.$util.getWorkFlowResult(46,[resourceIds,this.details.alarm.id])},loadMetrics:function(resourceId,alarmId,siteId,dateRange,rca){var _this=this,url="/v2/mlAnomalyAlarm/metrics",paramJson={};return paramJson.alarmId=alarmId,paramJson.resourceId=resourceId,paramJson.siteId=siteId,null!=dateRange&&(paramJson.dateRange=dateRange),rca&&(paramJson.rca=rca),this.loading=!0,new Promise((function(resolve,reject){_this.$http.post(url,paramJson).then((function(response){resolve(response.data.result.metrics)})).catch((function(error){reject(error)}))}))},loadMeanMetrics:function(){var workflowID,_this2=this;workflowID="readingalarm"===this.moduleName?8:"newreadingalarm"===this.moduleName?108:"agentAlarm"===this.moduleName||"operationalarm"===this.moduleName?11:47;
// if (!this.details.metricsPromise) {
var params=[this.details.alarm.id];"newreadingalarm"===this.moduleName&&params.push(this.cardId);var promise=this.$util.getWorkFlowResult(workflowID,params).finally((function(_){_this2.$set(_this2.details,"metricsPromise",null)}));
// }
return this.$set(this.details,"metricsPromise",promise),this.details.metricsPromise}}},mixins_AnomalyMixinvue_type_script_lang_js=AnomalyMixinvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(mixins_AnomalyMixinvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,AnomalyMixin=component.exports},
/***/803127:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return AnomalySubMeterWidget}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/anomalies/AnomalySubMeterWidget.vue?vue&type=template&id=2e9f82f2
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"f-el-group-table-style-1 fc-anamaloy-metertable-page"},[_c("portal",{attrs:{to:_vm.widget.key+"-title-section"}},[_c("div",{staticClass:"widget-header d-flex flex-direction-row justify-content-space mB15 mT5"},[_c("div",{staticClass:"widget-header-name"},[_vm._v("Sub-meter Contributions")])])]),_vm.loading?_c("div",{staticClass:"flex-middle fc-empty-white"},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1):_vm.subMeterDetails.length>0?_vm.loading?_vm._e():_c("el-table",{staticStyle:{width:"100%"},attrs:{data:_vm.subMeterDetails}},[_c("el-table-column",{attrs:{prop:"name",label:"SUB-METER NAME",width:"200"}}),_c("el-table-column",{attrs:{label:"NO OF OCCURRENCES"}},[_c("el-table-column",{attrs:{prop:"anomalyThisMonth",label:_vm.$t("common.date_picker.this_month")}}),_c("el-table-column",{attrs:{prop:"anomalyLastMonth",label:"Last Month"}})],1),_c("el-table-column",{attrs:{label:"ENERGY/CDD (kWh/CDD)"}},[_c("el-table-column",{attrs:{prop:"energyByCdd",label:_vm.$t("common.date_picker.this_month")}}),_c("el-table-column",{attrs:{prop:"energyByCddLastMonth",label:"Last Month"}})],1),_c("el-table-column",{attrs:{label:"EXCEEDED ENERGY"}},[_c("el-table-column",{attrs:{prop:"projectedWastage",label:_vm.$t("common.date_picker.this_month")}}),_c("el-table-column",{attrs:{prop:"lastMProjectedWastage",label:"Last Month"}})],1)],1):_c("div",[_c("div",{staticClass:"mT40 mB40 text-center p30imp"},[_c("InlineSvg",{attrs:{src:"svgs/emptystate/alarmEmpty",iconClass:"icon text-center icon-xxxxlg emptystate-icon-size"}}),_c("div",{staticClass:"pT20 fc-black-dark f18 bold"},[_vm._v("No Sub Meter Available!")])],1)])],1)},staticRenderFns=[],AnomalyMixin=(__webpack_require__(450886),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(897389),__webpack_require__(381056)),AnomalySubMeterWidgetvue_type_script_lang_js={props:["details","widget"],mixins:[AnomalyMixin/* default */.Z],mounted:function(){this.loadSubMeter()},data:function(){return{loading:!1,subMeterDetails:[],assetMetricMap:{}}},methods:{loadSubMeter:function(){var _this=this;this.loading=!0,this.details&&this.details.alarm&&this.$util.getdefaultWorkFlowResult("48",this.details.alarm.id).then((function(response){_this.loading=!1;var subMeters=response.subMeter,ids=subMeters.map((function(meter){return meter.id}));ids.length&&_this.loadData(ids,subMeters)})).catch((function(){_this.loading=!1}))},loadData:function(resourceIds,subMeters){var _this2=this;this.loading=!0;var promises=[];resourceIds.forEach((function(d,index){promises.push(_this2.loadMetrics(d,_this2.details.alarm.id,_this2.details.alarm.resource.siteId,_this2.currMntNLastMntRanges,!0))})),Promise.all(promises).then((function(d){Object.assign(_this2.assetMetricMap,d),subMeters.forEach((function(meter){if(_this2.assetMetricMap[meter.id]){var energyByCddThisMonth=_this2.assetMetricMap[meter.id].energyByCdd[_this2.currentMonth]?_this2.assetMetricMap[meter.id].energyByCdd[_this2.currentMonth].value:null,energyByCddLastMonth=_this2.assetMetricMap[meter.id].energyByCdd[_this2.lastMonth]?_this2.assetMetricMap[meter.id].energyByCdd[_this2.lastMonth].value:null,wastage=_this2.assetMetricMap[meter.id].wastage[_this2.currentMonth],lMWastage=_this2.assetMetricMap[meter.id].wastage[_this2.lastMonth],anomalyThisMonth=_this2.assetMetricMap[meter.id].noofanomalies[_this2.currentMonth]?_this2.assetMetricMap[meter.id].noofanomalies[_this2.currentMonth]:0,anomalyLastMonth=_this2.assetMetricMap[meter.id].noofanomalies[_this2.lastMonth]?_this2.assetMetricMap[meter.id].noofanomalies[_this2.lastMonth]:0,data={anomalyThisMonth:anomalyThisMonth,anomalyLastMonth:anomalyLastMonth,energyByCdd:energyByCddThisMonth>0?energyByCddThisMonth.toFixed(2):0,energyByCddLastMonth:energyByCddLastMonth>0?energyByCddLastMonth.toFixed(2):0,projectedWastage:wastage>0?wastage.toFixed(2):0,lastMProjectedWastage:lMWastage>0?lMWastage.toFixed(2):0};data.projectedWastage>1e4?data.projectedWastage=(data.projectedWastage/1e3).toFixed(2)+" MWh":data.projectedWastage+=" kWh",data.lastMProjectedWastage>1e4?data.lastMProjectedWastage=(data.lastMProjectedWastage/1e3).toFixed(2)+" MWh":data.lastMProjectedWastage+=" kWh",Object.assign(meter,data)}})),_this2.subMeterDetails=subMeters})).finally((function(){return _this2.loading=!1}))}}},anomalies_AnomalySubMeterWidgetvue_type_script_lang_js=AnomalySubMeterWidgetvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(anomalies_AnomalySubMeterWidgetvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,AnomalySubMeterWidget=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/3127.js.map