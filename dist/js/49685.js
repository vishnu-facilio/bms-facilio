"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[49685],{
/***/303514:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return AsyncButton}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/AsyncButton.vue?vue&type=template&id=16ca9ad1
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-button",_vm._b({class:_vm.buttonClass,attrs:{loading:_vm.showLoading,type:_vm.buttonType,size:_vm.size,disabled:_vm.disabled},on:{click:function($event){return _vm.save()}}},"el-button",_vm.$attrs,!1),[_vm._t("default")],2)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),AsyncButtonvue_type_script_lang_js=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),{props:["clickAction","actionParams","buttonType","buttonClass","size","disabled","loading"],data:function(){return{isLoading:!1}},computed:{showLoading:function(){return this.loading||this.isLoading}},methods:{save:function(){var _this=this;if(this.clickAction&&"function"===typeof this.clickAction){this.isLoading=!0;var returnPromise=this.actionParams?this.clickAction.apply(this,(0,toConsumableArray/* default */.Z)(this.actionParams)):this.clickAction(),minimumTimeout=this.$helpers.delay(1e3);returnPromise?Promise.all([returnPromise,minimumTimeout]).finally((function(){_this.isLoading=!1})):this.$helpers.delay(1e3).then((function(){return _this.isLoading=!1}))}}}}),components_AsyncButtonvue_type_script_lang_js=AsyncButtonvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_AsyncButtonvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,AsyncButton=component.exports},
/***/13118:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return CreateKpi}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/readingkpi/CreateKpi.vue?vue&type=template&id=1993404a
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"formbuilder-fullscreen-popup sla-policy-container"},[_c("div",{staticClass:"setting-header"},[_c("div",{staticClass:"d-flex flex-direction-column"},[_c("div",{staticClass:"mT10 mB10 f22 fw3 letter-spacing0_5"},[_vm._v(_vm._s(_vm.title))])]),_c("div",{staticClass:"fR stateflow-btn-wrapper"},[_c("AsyncButton",{attrs:{buttonClass:"asset-el-btn",clickAction:_vm.goBack}},[_vm._v(" "+_vm._s(_vm.$t("common._common.cancel"))+" ")]),_c("AsyncButton",{attrs:{buttonType:"primary",buttonClass:"asset-el-btn",clickAction:_vm.save}},[_vm._v(" "+_vm._s(_vm.$t("common._common._save"))+" ")])],1)]),_c("div",{staticClass:"d-flex setup-grey-bg"},[_c("div",{staticClass:"sla-sidebar pT10"},[_c("a",{staticClass:"sla-link active",attrs:{id:"kpidetails-link"},on:{click:function($event){return _vm.scrollTo("kpidetails")}}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.kpi_details"))+" ")]),_c("a",{staticClass:"sla-link",attrs:{id:"kpitype-link"},on:{click:function($event){return _vm.scrollTo("kpitype")}}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.kpi_type"))+" ")]),_c("a",{staticClass:"sla-link",attrs:{id:"formulaBuilder-link"},on:{click:function($event){return _vm.scrollTo("formulaBuilder")}}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.kpi_formula_builder"))+" ")])]),_c("div",{staticClass:"scroll-container"},[_vm.isLoading?_c("div",{staticClass:"mT20"},[_c("spinner",{attrs:{show:_vm.isLoading,size:"80"}})],1):[_c("KPIDetails",{ref:"kpidetails-section",staticClass:"mB20",attrs:{id:"kpidetails-section",isNew:!_vm.isEditForm,kpiInfo:_vm.kpiData},on:{kpiDetailsChange:_vm.setProperties}}),_c("KPITypeForm",{ref:"kpitype-section",staticClass:"mB20",attrs:{id:"kpitype-section",isNew:!_vm.isEditForm,kpiInfo:_vm.kpiData},on:{kpiTypeChange:_vm.setProperties}}),_c("KPIFormulaBuilder",{ref:"formulaBuilder-section",staticClass:"mB20 height74vh",attrs:{id:"formulaBuilder-section",kpiInfo:_vm.kpiData,isEditForm:_vm.isEditForm},on:{onConditionsChange:_vm.setProperties}})],_c("div",{staticClass:"mT50"})],2)])])},staticRenderFns=[],objectSpread2=__webpack_require__(595082),toConsumableArray=__webpack_require__(488478),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),AsyncButton=(__webpack_require__(670560),__webpack_require__(434284),__webpack_require__(260228),__webpack_require__(186466),__webpack_require__(919649),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(450886),__webpack_require__(947522),__webpack_require__(303514)),KPIDetailsvue_type_template_id_1c4e73da_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"section-header",attrs:{id:"kpidetails-header"}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.kpi_details"))+" ")]),_c("el-form",{ref:"kpiDetailsForm",staticClass:"p50 pT10 pB30",attrs:{model:_vm.kpiDetailsObj,rules:_vm.validationRules,"label-width":"150px","label-position":"left"}},[_c("div",{staticClass:"section-container flex-container"},[_c("div",{staticClass:"reading-kpi-form-item reading-kpi-form-item fc-label-required"},[_c("el-form-item",{attrs:{label:""+this.$t("common.roles.name"),prop:"name"}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{placeholder:""+this.$t("common.roles.name"),autofocus:!0},model:{value:_vm.kpiDetailsObj.name,callback:function($$v){_vm.$set(_vm.kpiDetailsObj,"name",$$v)},expression:"kpiDetailsObj.name"}})],1)],1),_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("common.roles.description"),prop:"description"}},[_c("el-input",{staticClass:"mT3 fc-input-full-border-textarea",attrs:{type:"textarea",autofocus:!0,"min-rows":2,autosize:{minRows:3,maxRows:4},placeholder:""+this.$t("common.roles.description")},model:{value:_vm.kpiDetailsObj.description,callback:function($$v){_vm.$set(_vm.kpiDetailsObj,"description",$$v)},expression:"kpiDetailsObj.description"}})],1)],1),_c("div",{staticClass:"reading-kpi-form-item  fc-label-required"},[_c("el-form-item",{attrs:{label:""+this.$t("kpi.kpi.kpi_category"),prop:"kpiCategory"}},[_c("el-select",{key:"kpiCategoryId",ref:"kpiCategoryId",staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{"data-test-selector":"kpiCategoryId",filterable:"","collapse-tags":"",placeholder:_vm.$t("common.products.select_category"),remote:"","remote-method":_vm.remoteMethodKpiCatRequest},model:{value:_vm.kpiDetailsObj.kpiCategory,callback:function($$v){_vm.$set(_vm.kpiDetailsObj,"kpiCategory",$$v)},expression:"kpiDetailsObj.kpiCategory"}},[_c("div",{staticClass:"min-width730",attrs:{slot:"empty"},slot:"empty"},[_c("div",{staticClass:"el-select-dropdown__empty"},[_vm._v(" "+_vm._s(_vm.$t("common._common.empty_option_text"))+" ")]),_c("div",{staticClass:"kpi-form-item"},[_c("el-button",{staticClass:"add-kpi-category-container",on:{click:function($event){return _vm.addKpiCategory()}}},[_c("i",{staticClass:"el-icon-plus plus-icon"}),_vm._v(" "+_vm._s(_vm.$t("common.header.new_category")))])],1)]),_vm._l(_vm.kpiCategoryOptions,(function(option,index){return _c("el-option",{key:index,attrs:{label:option.label,value:option.value}})}))],2)],1)],1),_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("common.products.site")}},[_c("FLookupField",{key:"kpi-site",attrs:{model:_vm.kpiDetailsObj.siteId,field:_vm.siteField,isRemoteField:!1},on:{"update:model":function($event){return _vm.$set(_vm.kpiDetailsObj,"siteId",$event)}}})],1)],1),_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",[_c("el-radio-group",{model:{value:_vm.kpiDetailsObj.resourceType,callback:function($$v){_vm.$set(_vm.kpiDetailsObj,"resourceType",$$v)},expression:"kpiDetailsObj.resourceType"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:4}},[_vm._v(_vm._s(_vm.$t("common.space_asset_chooser.asset")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:3}},[_vm._v(_vm._s(_vm.$t("common.space_asset_chooser.space")))])],1)],1)],1),3===_vm.kpiDetailsObj.resourceType?_c("div",{staticClass:"reading-kpi-form-item"},[_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("maintenance.pm_list.space_category"),prop:"spaceCategory"}},[_c("FLookupField",{key:"kpi-spacecategory",attrs:{model:_vm.kpiDetailsObj.spaceCategory,field:_vm.spaceCategoryField,isRemoteField:!1,disabled:!_vm.isNew},on:{"update:model":function($event){return _vm.$set(_vm.kpiDetailsObj,"spaceCategory",$event)},recordSelected:_vm.onSpaceCategorySelected}})],1),_vm.isSpaceCategoryEmpty?_c("div",{staticClass:"reading-kpi-form-item fc-label-required"},[_c("el-form-item",{attrs:{label:""+this.$t("common.wo_report.spaces"),prop:"spaces"}},[_c("FLookupField",{key:"kpi-site",attrs:{model:_vm.kpiDetailsObj.spaces,field:_vm.spaceField,isRemoteField:!1},on:{"update:model":function($event){return _vm.$set(_vm.kpiDetailsObj,"spaces",$event)}}})],1)],1):_c("div",{staticClass:"reading-kpi-form-item "},[_c("el-form-item",[_c("el-radio-group",{model:{value:_vm.bulkSelectOption,callback:function($$v){_vm.bulkSelectOption=$$v},expression:"bulkSelectOption"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"all"}},[_vm._v(_vm._s(_vm.$t("space.sites.all_spaces")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"include"}},[_vm._v(_vm._s(_vm.$t("space.sites.specific_spaces")))])],1)],1)],1),_vm.isSpaceCategoryEmpty?_vm._e():_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("common.wo_report.spaces")}},[_vm.isAllAssetsSelected?_c("div",[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{placeholder:_vm.allSpacesPlaceHolderText,disabled:!0}})],1):_c("FLookupField",{key:"spaces-lookup-field",ref:"spaces-lookup-field",attrs:{model:_vm.kpiDetailsObj.spaces,field:_vm.spaceField,preHookFilterConstruction:_vm.constructSpaceCategoryFilter},on:{"update:model":function($event){return _vm.$set(_vm.kpiDetailsObj,"spaces",$event)},showLookupWizard:_vm.showLookupWizard}})],1)],1)],1)]):_c("div",{staticClass:"reading-kpi-form-item"},[_c("div",{staticClass:"reading-kpi-form-item  fc-label-required"},[_c("el-form-item",{attrs:{label:""+this.$t("alarm.alarm.asset_category"),prop:"assetCategoryId"}},[_c("FLookupField",{key:"kpi-assetcategory",attrs:{model:_vm.kpiDetailsObj.assetCategoryId,field:_vm.assetCategoryField,isRemoteField:!1,disabled:!_vm.isNew},on:{"update:model":function($event){return _vm.$set(_vm.kpiDetailsObj,"assetCategoryId",$event)},recordSelected:_vm.onAssetCategorySelected}})],1)],1),_vm.isAssetCategoryEmpty?_vm._e():_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",[_c("el-radio-group",{model:{value:_vm.bulkSelectOption,callback:function($$v){_vm.bulkSelectOption=$$v},expression:"bulkSelectOption"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"all"}},[_vm._v(_vm._s(_vm.$t("alarm.rules.all_assets")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"include"}},[_vm._v(_vm._s(_vm.$t("alarm.rules.specific_assets")))])],1)],1)],1),_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("common.products.assets")}},[_vm.isAllAssetsSelected?_c("div",[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{placeholder:_vm.allAssetsPlaceHolderText,disabled:!0}})],1):_c("FLookupField",{key:"assets-lookup-field",ref:"assets-lookup-field",attrs:{model:_vm.kpiDetailsObj.assets,field:_vm.assetField,preHookFilterConstruction:_vm.constructAssetCategoryFilter},on:{"update:model":function($event){return _vm.$set(_vm.kpiDetailsObj,"assets",$event)},showLookupWizard:_vm.showLookupWizard}})],1)],1)])])]),_vm.canShowLookupWizard?_c("div",[_vm.isNewLookupWizardEnabled?_c("LookupWizard",{attrs:{canShowLookupWizard:_vm.canShowLookupWizard,field:_vm.selectedLookupField},on:{"update:canShowLookupWizard":function($event){_vm.canShowLookupWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowLookupWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}}):_c("FLookupFieldWizard",{attrs:{canShowLookupWizard:_vm.canShowLookupWizard,selectedLookupField:_vm.selectedLookupField,categoryId:_vm.kpiDetailsObj.assetCategoryId},on:{"update:canShowLookupWizard":function($event){_vm.canShowLookupWizard=$event},"update:can-show-lookup-wizard":function($event){_vm.canShowLookupWizard=$event},setLookupFieldValue:_vm.setLookupFieldValue}})],1):_vm._e()],1)},KPIDetailsvue_type_template_id_1c4e73da_scoped_true_staticRenderFns=[],FLookupField=(__webpack_require__(659749),__webpack_require__(386544),__webpack_require__(538077),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(891719),__webpack_require__(855048)),FLookupFieldWizard=__webpack_require__(499751),validation=__webpack_require__(586529),isEqual=__webpack_require__(618446),isEqual_default=__webpack_require__.n(isEqual),picklist=__webpack_require__(961358),api=__webpack_require__(32284),debounce=__webpack_require__(23279),debounce_default=__webpack_require__.n(debounce),ui_forms=__webpack_require__(141323),KPIDetailsvue_type_script_lang_js={components:{FLookupField:FLookupField/* default */.Z,FLookupFieldWizard:FLookupFieldWizard["default"],LookupWizard:ui_forms/* LookupWizard */.ns},props:{isNew:{type:Boolean},kpiInfo:{type:Object}},data:function(){return{kpiDetailsObj:{name:"",description:"",kpiCategory:null,siteId:null,resourceType:4,
//enum index
assetCategoryId:null,spaceCategory:null,asset:null,assets:null,space:null,spaces:null},showAddOptionKpiCat:!1,kpiCatSearchText:null,kpiCategoryOptions:null,validationRules:{name:[{required:!0,message:"Please enter KPI name",trigger:"blur"}],kpiCategory:[{required:!0,message:"Please select KPI category",trigger:"blur"}],assetCategoryId:[{required:!0,message:"Please select asset category",trigger:"blur"}]},siteField:{lookupModuleName:"site",lookupModule:{type:-1},options:[],placeHolderText:"".concat(this.$t("setup.setup.select_site")),isDataLoading:!1},assetCategoryField:{lookupModuleName:"assetCategory",lookupModule:{type:-1},options:[],isDataLoading:!1,placeHolderText:"".concat(this.$t("kpi.kpi.select_asset_category"))},spaceCategoryField:{lookupModuleName:"spacecategory",lookupModule:{type:-1},options:[],isDataLoading:!1,placeHolderText:"".concat(this.$t("kpi.kpi.select_space_category"))},spaceField:{lookupModuleName:"space",field:{lookupModule:{name:"space",displayName:"Space"}},options:[],isDataLoading:!1,multiple:!0,placeHolderText:"".concat(this.$t("rule.create.select_space"))},assetField:{isDataLoading:!1,options:[],lookupModuleName:"asset",placeHolderText:"".concat(this.$t("commissioning.sheet.select_asset")),field:{lookupModule:{name:"asset",displayName:"Asset"}},multiple:!0},canShowLookupWizard:!1,canShowKpiCategoryDialog:!1,selectedLookupField:null,bulkSelectOption:"all",selectedAssetCategoryLabel:"",selectedSpaceCategoryLabel:"",isMatchedSpaceSelection:!1,isMatchedAssetSelection:!1}},created:function(){this.getKpiCategoryOptions(),this.isNew||this.prefillKpiDetails(),this.remoteMethodKpiCatRequest=debounce_default()(this.getKpiCatRemote,500)},computed:{isAssetCategoryEmpty:function(){var kpiDetailsObj=this.kpiDetailsObj,_ref=kpiDetailsObj||{},assetCategoryId=_ref.assetCategoryId;return(0,validation/* isEmpty */.xb)(assetCategoryId)},isSpaceCategoryEmpty:function(){var kpiDetailsObj=this.kpiDetailsObj,_ref2=kpiDetailsObj||{},spaceCategory=_ref2.spaceCategory;return(0,validation/* isEmpty */.xb)(spaceCategory)},isAllAssetsSelected:function(){var bulkSelectOption=this.bulkSelectOption;return"all"===bulkSelectOption},allSpacesPlaceHolderText:function(){var selectedSpaceCategoryLabel=this.selectedSpaceCategoryLabel;return"All ".concat(selectedSpaceCategoryLabel," selected")},allAssetsPlaceHolderText:function(){var selectedAssetCategoryLabel=this.selectedAssetCategoryLabel;return"All ".concat(selectedAssetCategoryLabel," selected")},isNewLookupWizardEnabled:function(){return this.$helpers.isLicenseEnabled("NEW_LOOKUP_WIZARD")}},watch:{kpiDetailsObj:{handler:function(newVal,oldVal){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _ref3,assetCategoryIdNew,spaceCategoryIdNew,_ref4,assetCategoryIdOld,spaceCategoryIdOld,$refs,assetField,kpiDetailsObj,isMatchedAssetSelection,elem,options,_$refs,spaceField,_kpiDetailsObj,isMatchedSpaceSelection,_elem,_options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if((0,validation/* isEmpty */.xb)(newVal)||_this.$emit("kpiDetailsChange",newVal),_ref3=newVal||{},assetCategoryIdNew=_ref3.assetCategoryId,spaceCategoryIdNew=_ref3.spaceCategoryId,_ref4=oldVal||{},assetCategoryIdOld=_ref4.assetCategoryId,spaceCategoryIdOld=_ref4.spaceCategoryId,isEqual_default()(assetCategoryIdNew,assetCategoryIdOld)){_context.next=16;break}if($refs=_this.$refs,assetField=_this.assetField,kpiDetailsObj=_this.kpiDetailsObj,isMatchedAssetSelection=_this.isMatchedAssetSelection,elem=$refs["assets-lookup-field"],(0,validation/* isEmpty */.xb)(elem)||isMatchedAssetSelection){_context.next=15;break}return _context.next=9,elem.getOptions({initialFetch:!0});case 9:if(_context.t0=_context.sent,_context.t0){_context.next=12;break}_context.t0=[];case 12:options=_context.t0,_this.$set(kpiDetailsObj,"assets",null),_this.$set(assetField,"options",options);case 15:_this.isMatchedAssetSelection=!1;case 16:if(isEqual_default()(spaceCategoryIdNew,spaceCategoryIdOld)){_context.next=29;break}if(_$refs=_this.$refs,spaceField=_this.spaceField,_kpiDetailsObj=_this.kpiDetailsObj,isMatchedSpaceSelection=_this.isMatchedSpaceSelection,_elem=_$refs["spaces-lookup-field"],(0,validation/* isEmpty */.xb)(_elem)||isMatchedSpaceSelection){_context.next=28;break}return _context.next=22,_elem.getOptions({initialFetch:!0});case 22:if(_context.t1=_context.sent,_context.t1){_context.next=25;break}_context.t1=[];case 25:_options=_context.t1,_this.$set(_kpiDetailsObj,"spaces",null),_this.$set(spaceField,"options",_options);case 28:_this.isMatchedSpaceSelection=!1;case 29:case"end":return _context.stop()}}),_callee)})))()},deep:!0},isAllAssetsSelected:{handler:function(value){value&&this.$set(this.kpiDetailsObj,"assets",null)}}},methods:{getKpiCatRemote:function(searchText){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var query,_yield$getFieldOption,options,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return query={field:{lookupModuleName:"kpiCategory"}},(0,validation/* isEmpty */.xb)(searchText)?_this2.showAddOptionKpiCat&&(_this2.showAddOptionKpiCat=!1):query.searchText=searchText,_context2.next=4,(0,picklist/* getFieldOptions */._K)(query);case 4:_yield$getFieldOption=_context2.sent,options=_yield$getFieldOption.options,error=_yield$getFieldOption.error,(0,validation/* isEmpty */.xb)(error)?(_this2.kpiCategoryOptions=options,(0,validation/* isEmpty */.xb)(options)&&(_this2.kpiCatSearchText=searchText,_this2.showAddOptionKpiCat=!0)):_this2.$message.error(error.message||"Error occured");case 8:case"end":return _context2.stop()}}),_callee2)})))()},getKpiCategoryOptions:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$getFieldOption2,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:"kpiCategory"}});case 2:_yield$getFieldOption2=_context3.sent,options=_yield$getFieldOption2.options,_this3.kpiCategoryOptions=options;case 5:case"end":return _context3.stop()}}),_callee3)})))()},prefillKpiDetails:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var kpiDetailsObj,kpiInfo,_ref5,name,description,kpiCategory,siteId,assets,_ref6,resourceType,assetCategory,_ref7,displayName,id;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_this4.getKpiCategoryOptions(),kpiDetailsObj=_this4.kpiDetailsObj,kpiInfo=_this4.kpiInfo,(0,validation/* isEmpty */.xb)(kpiInfo)||(_ref5=kpiInfo||{},name=_ref5.name,description=_ref5.description,kpiCategory=_ref5.kpiCategory,siteId=_ref5.siteId,assets=_ref5.assets,_this4.kpiDetailsObj={name:name,description:description,kpiCategory:kpiCategory,siteId:siteId,assets:assets},_ref6=kpiInfo||{},resourceType=_ref6.resourceType,assetCategory=_ref6.assetCategory,_ref7=assetCategory||{},displayName=_ref7.displayName,_this4.selectedAssetCategoryLabel=displayName,_this4.$set(_this4.kpiDetailsObj,"resourceType",resourceType),id=assetCategory.id,_this4.kpiDetailsObj.assetCategoryId=id,(0,validation/* isEmpty */.xb)(assets)||(_this4.bulkSelectOption="include",_this4.isMatchedAssetSelection=!0,_this4.$set(kpiDetailsObj,"assets",assets)));case 3:case"end":return _context4.stop()}}),_callee4)})))()},showLookupWizard:function(field,canShow){this.$set(this,"selectedLookupField",field),this.$set(this,"canShowLookupWizard",canShow)},setLookupFieldValue:function(props){var kpiDetailsObj=this.kpiDetailsObj,field=props.field,_field$options=field.options,options=void 0===_field$options?[]:_field$options,_field$selectedItems=field.selectedItems,selectedItems=void 0===_field$selectedItems?[]:_field$selectedItems,selectedItemIds=[];if(!(0,validation/* isEmpty */.xb)(selectedItems))if(selectedItemIds=selectedItems.map((function(item){return item.value})),(0,validation/* isEmpty */.xb)(options))options=(0,toConsumableArray/* default */.Z)(selectedItems);else{var _options2,ids=options.map((function(item){return item.value})),newOptions=selectedItems.filter((function(item){return!ids.includes(item.value)}));(_options2=options).unshift.apply(_options2,(0,toConsumableArray/* default */.Z)(newOptions))}this.$set(kpiDetailsObj,"assets",selectedItemIds),this.$set(this.selectedLookupField,"options",options)},constructAssetCategoryFilter:function(){var kpiDetailsObj=this.kpiDetailsObj,_ref8=kpiDetailsObj||{},assetCategoryId=_ref8.assetCategoryId,filters={};return(0,validation/* isEmpty */.xb)(assetCategoryId)||(filters={category:{operator:"is",value:["".concat(assetCategoryId)]}}),filters},constructSpaceCategoryFilter:function(){var kpiDetailsObj=this.kpiDetailsObj,_ref9=kpiDetailsObj||{},spaceCategory=_ref9.spaceCategory,filters={};return(0,validation/* isEmpty */.xb)(spaceCategory)||(filters={spaceCategory:{operator:"is",value:["".concat(spaceCategory)]}}),filters},onSpaceCategorySelected:function(selectedValue){var _ref10=selectedValue||{},label=_ref10.label,spaceField=this.spaceField,kpiDetailsObj=this.kpiDetailsObj,_ref11=spaceField||{},selectedItems=_ref11.selectedItems;(0,validation/* isEmpty */.xb)(label)||(this.selectedSpaceCategoryLabel=label),(0,validation/* isEmpty */.xb)(selectedItems)||(spaceField.selectedItems=[],this.$set(kpiDetailsObj,"spaces",null))},onAssetCategorySelected:function(selectedValue){var _ref12=selectedValue||{},label=_ref12.label,assetField=this.assetField,kpiDetailsObj=this.kpiDetailsObj,_ref13=assetField||{},selectedItems=_ref13.selectedItems;(0,validation/* isEmpty */.xb)(label)||(this.selectedAssetCategoryLabel=label),(0,validation/* isEmpty */.xb)(selectedItems)||(assetField.selectedItems=[],this.$set(kpiDetailsObj,"assets",null))},addKpiCategory:function(){var _this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var params,_yield$API$post,error,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return params={kpiCategory:{name:_this5.kpiCatSearchText}},_context5.next=3,api/* API */.bl.post("v2/kpi/category/add",params);case 3:if(_yield$API$post=_context5.sent,error=_yield$API$post.error,data=_yield$API$post.data,!(0,validation/* isEmpty */.xb)(error)){_context5.next=12;break}return _context5.next=9,_this5.refreshCategories(data.kpiCategoryContext.id);case 9:_this5.showAddOptionKpiCat=!1,_context5.next=13;break;case 12:_this5.$message.error(error.message||_this5.$t("common._common.error_while_creatingkpi_category"));case 13:case"end":return _context5.stop()}}),_callee5)})))()},refreshCategories:function(categoryId){var _this6=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee6(){var _yield$getFieldOption3,error,options;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context6){while(1)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,(0,picklist/* getFieldOptions */._K)({field:{lookupModuleName:"kpiCategory"}});case 2:_yield$getFieldOption3=_context6.sent,error=_yield$getFieldOption3.error,options=_yield$getFieldOption3.options,error?_this6.$message.error(error.message||"Error Occured"):(_this6.$set(_this6,"kpiCategoryOptions",options),_this6.$set(_this6.kpiDetailsObj,"kpiCategory",0!==categoryId?categoryId:null),_this6.canShowKpiCategoryDialog=!1);case 6:case"end":return _context6.stop()}}),_callee6)})))()}}},readingkpi_KPIDetailsvue_type_script_lang_js=KPIDetailsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(readingkpi_KPIDetailsvue_type_script_lang_js,KPIDetailsvue_type_template_id_1c4e73da_scoped_true_render,KPIDetailsvue_type_template_id_1c4e73da_scoped_true_staticRenderFns,!1,null,"1c4e73da",null)
/* harmony default export */,KPIDetails=component.exports,KPIFormulaBuildervue_type_template_id_6def0bc0_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"section-header pB10",attrs:{id:"formulaBuilder-header"}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.kpi_formula_builder"))+" ")]),_c("FormulaBuilder",{attrs:{ruleCondition:_vm.kpiInfo,isEditForm:_vm.isEditForm,preferredCodeBoilerPlate:_vm.codeBoilerPlate,removeToggle:_vm.isDynamicKpi,moduleName:"readingkpi"},on:{setCondition:_vm.setCondition}})],1)},KPIFormulaBuildervue_type_template_id_6def0bc0_staticRenderFns=[],FormulaBuilder=__webpack_require__(945484),KPIFormulaBuildervue_type_script_lang_js={components:{FormulaBuilder:FormulaBuilder/* default */.Z},props:["kpiInfo","isEditForm"],data:function(){return{codeBoilerPlate:"Number test(){\n \nreturn  ; \n}"}},computed:{isDynamicKpi:function(){var _ref=this.kpiInfo||{},kpiType=_ref.kpiType;return"dynamic"===kpiType||3===kpiType}},methods:{setCondition:function(condition){this.$emit("onConditionsChange",condition)}}},readingkpi_KPIFormulaBuildervue_type_script_lang_js=KPIFormulaBuildervue_type_script_lang_js,KPIFormulaBuilder_component=(0,componentNormalizer/* default */.Z)(readingkpi_KPIFormulaBuildervue_type_script_lang_js,KPIFormulaBuildervue_type_template_id_6def0bc0_render,KPIFormulaBuildervue_type_template_id_6def0bc0_staticRenderFns,!1,null,null,null)
/* harmony default export */,KPIFormulaBuilder=KPIFormulaBuilder_component.exports,KPITypeFormvue_type_template_id_8d26b01e_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"section-header",attrs:{id:"kpitype-header"}},[_vm._v(" "+_vm._s(_vm.$t("kpi.kpi.kpi_type"))+" ")]),_c("el-form",{ref:"kpiTypeForm",staticClass:"p50 pT10 pB30",attrs:{model:_vm.kpiTypeObj,"label-width":"150px","label-position":"left"}},[_c("div",{staticClass:"section-contaner flex-container"},[_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("kpi.kpi.kpi_type")}},[_c("el-radio-group",{attrs:{disabled:!_vm.isNew},on:{change:_vm.handleKpiTypeChange},model:{value:_vm.kpiTypeObj.kpiTypeLabel,callback:function($$v){_vm.$set(_vm.kpiTypeObj,"kpiTypeLabel",$$v)},expression:"kpiTypeObj.kpiTypeLabel"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"computed"}},[_vm._v(_vm._s(_vm.$t("kpi.kpi.computed_kpi")))]),_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:"realtime"}},[_vm._v(_vm._s(_vm.$t("kpi.kpi.real_time_kpi")))])],1)],1)],1),"realtime"!==_vm.kpiTypeObj.kpiTypeLabel?_c("div",{staticClass:"reading-kpi-form-item fc-label-required"},[_c("el-form-item",{attrs:{prop:"frequency",label:""+this.$t("common._common.frequency")}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{placeholder:_vm.$t("kpi.kpi.select_frequency")},on:{change:_vm.handleFreqChange},model:{value:_vm.kpiTypeObj.frequency,callback:function($$v){_vm.$set(_vm.kpiTypeObj,"frequency",$$v)},expression:"kpiTypeObj.frequency"}},_vm._l(_vm.frequencies,(function(key,label){return _c("el-option",{key:key,attrs:{label:label,value:key}})})),1)],1)],1):_vm._e(),_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("kpi.kpi.metric")}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{filterable:"",clearable:"",placeholder:_vm.$t("common.products.select_metric"),disabled:!_vm.isNew},on:{change:function($event){return _vm.loadUnit(_vm.metricsUnits)}},model:{value:_vm.kpiTypeObj.metricId,callback:function($$v){_vm.$set(_vm.kpiTypeObj,"metricId",$$v)},expression:"kpiTypeObj.metricId"}},_vm._l(_vm.metricsList,(function(metric,index){return _c("el-option",{key:index,attrs:{label:metric.name,value:metric.metricId}})})),1)],1)],1),0!==_vm.kpiTypeObj.metricId?_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("common.header.unit")}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",attrs:{disabled:!_vm.kpiTypeObj.metricId||!_vm.isNew,placeholder:_vm.$t("common.products.select_unit"),filterable:"",clearable:""},model:{value:_vm.kpiTypeObj.unitId,callback:function($$v){_vm.$set(_vm.kpiTypeObj,"unitId",$$v)},expression:"kpiTypeObj.unitId"}},_vm._l(_vm.unitOptions,(function(unit,index){return _c("el-option",{key:index,attrs:{label:unit.displayName+" ("+unit.symbol+")",value:unit.unitId}})})),1)],1)],1):_c("div",{staticClass:"reading-kpi-form-item"},[_c("el-form-item",{attrs:{label:""+this.$t("common.header.unit")}},[_c("el-input",{staticClass:"fc-input-full-border2",attrs:{placeholder:""+this.$t("common._common.enter_unit"),autofocus:!0,disabled:!_vm.isNew},model:{value:_vm.kpiTypeObj.customUnit,callback:function($$v){_vm.$set(_vm.kpiTypeObj,"customUnit",$$v)},expression:"kpiTypeObj.customUnit"}})],1)],1)])])],1)},KPITypeFormvue_type_template_id_8d26b01e_scoped_true_staticRenderFns=[],frequencies=(__webpack_require__(425728),{"1 Min":1,"2 Mins":2,"3 Mins":3,"4 Mins":4,"5 Mins":5,"10 Mins":6,"15 Mins":7,"20 Mins":8,"30 Mins":9,"1 Hr":10,"2 Hr":11,"3 Hr":12,"4 Hr":13,"8 Hr":14,"12 Hr":15,"1 Day":16,"Weekly ":17,"Monthly ":18,"Quarterly ":19,"Half Yearly":20,"Annually ":21}),KPITypeFormvue_type_script_lang_js={components:{},props:{isNew:{type:Boolean},kpiInfo:{type:Object}},data:function(){return{metricsUnits:{},metricName:"",unitId:null,metricId:null,kpiTypeObj:{kpiTypeLabel:"computed",kpiType:1,frequency:null,newOrExistingReading:"new",metricId:null,unitId:null,customUnit:null},prefillPhase:!0,frequencies:frequencies}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.loadDefaultMetricUnits();case 2:_this.isNew||_this.prefillKpiDetails();case 3:case"end":return _context.stop()}}),_callee)})))()},computed:{metricsList:function(){var metricList=this.$getProperty(this,"metricsUnits.metrics");if(!(0,validation/* isEmpty */.xb)(metricList)){var others={_name:"OTHER",metricId:0,name:"Others",siUnitId:0};metricList.push(others)}return metricList},unitOptions:function(){return(0,validation/* isEmpty */.xb)(this.metricName)||(0,validation/* isEmpty */.xb)(this.metricsUnits.metricWithUnits)?[]:this.metricsUnits.metricWithUnits[this.metricName]}},watch:{kpiTypeObj:{handler:function(newVal){var _ref=newVal||{},frequency=_ref.frequency;(0,validation/* isEmpty */.xb)(frequency)||(this.kpiTypeObj.kpiType=frequency>16?2:1),this.$emit("kpiTypeChange",newVal)},deep:!0}},methods:{prefillKpiDetails:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var kpiInfo,_ref2,kpiType,frequency,metricId,unitId,customUnit,metricType;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:kpiInfo=_this2.kpiInfo,(0,validation/* isEmpty */.xb)(kpiInfo)||(_ref2=kpiInfo||{},kpiType=_ref2.kpiType,frequency=_ref2.frequency,metricId=_ref2.metricId,unitId=_ref2.unitId,customUnit=_ref2.customUnit,_this2.kpiTypeObj={metricId:metricId,unitId:unitId,customUnit:customUnit},1===kpiType||2===kpiType?(_this2.$set(_this2.kpiTypeObj,"kpiTypeLabel","computed"),_this2.$set(_this2.kpiTypeObj,"frequency",frequency)):(_this2.$set(_this2.kpiTypeObj,"kpiTypeLabel","realtime"),_this2.$set(_this2.kpiTypeObj,"frequency",null)),metricType=_this2.getMetricType(_this2.kpiTypeObj.metricId),0===metricType?_this2.$set(_this2.kpiTypeObj,"metricId",null):2===metricType?(_this2.$set(_this2.kpiTypeObj,"metricId",0),_this2.setMetricName(_this2.metricsUnits)):_this2.setMetricName(_this2.metricsUnits)),_this2.prefillPhase=!1;case 3:case"end":return _context2.stop()}}),_callee2)})))()},handleKpiTypeChange:function(){var kpiTypeObj=this.kpiTypeObj,_ref3=kpiTypeObj||{},kpiTypeLabel=_ref3.kpiTypeLabel;this.kpiTypeObj.kpiType="realtime"===kpiTypeLabel?3:1,this.kpiTypeObj.frequency=null},handleFreqChange:function(){var kpiTypeObj=this.kpiTypeObj,_ref4=kpiTypeObj||{},frequency=_ref4.frequency;(0,validation/* isEmpty */.xb)(frequency)||(this.kpiTypeObj.kpiType=frequency>16?2:1)},getMetricType:function(metricId){
//0 - doesnt exist
//1 - standard
//2 - custom
var customUnit=this.$getProperty(this.kpiTypeObj,"customUnit");return(0,validation/* isEmpty */.xb)(metricId)?0:0!==metricId||(0,validation/* isEmpty */.xb)(customUnit)?1:2},setLookupFieldValue:function(props){var kpiTypeObj=this.kpiTypeObj,field=props.field,_field$options=field.options,options=void 0===_field$options?[]:_field$options,_field$selectedItems=field.selectedItems,selectedItems=void 0===_field$selectedItems?[]:_field$selectedItems,selectedItemIds=[];if(!(0,validation/* isEmpty */.xb)(selectedItems))if(selectedItemIds=selectedItems.map((function(item){return item.value})),(0,validation/* isEmpty */.xb)(options))options=(0,toConsumableArray/* default */.Z)(selectedItems);else{var _options,ids=options.map((function(item){return item.value})),newOptions=selectedItems.filter((function(item){return!ids.includes(item.value)}));(_options=options).unshift.apply(_options,(0,toConsumableArray/* default */.Z)(newOptions))}this.$set(kpiTypeObj,"assets",selectedItemIds),this.$set(this.selectedLookupField,"options",options)},constructCategoryFilter:function(){var kpiTypeObj=this.kpiTypeObj,_ref5=kpiTypeObj||{},assetCategoryId=_ref5.assetCategoryId,filters={};return(0,validation/* isEmpty */.xb)(assetCategoryId)||(filters={category:{operator:"is",value:["".concat(assetCategoryId)]}}),filters},onAssetCategorySelected:function(selectedValue){var _ref6=selectedValue||{},label=_ref6.label,assetField=this.assetField,kpiTypeObj=this.kpiTypeObj,_ref7=assetField||{},selectedItems=_ref7.selectedItems;(0,validation/* isEmpty */.xb)(label)||(this.selectedCategoryLabel=label),(0,validation/* isEmpty */.xb)(selectedItems)||(assetField.selectedItems=[],this.$set(kpiTypeObj,"assets",null))},loadDefaultMetricUnits:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$API$get,data;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,api/* API */.bl.get("/units/getDefaultMetricUnits");case 2:_yield$API$get=_context3.sent,data=_yield$API$get.data,(0,validation/* isEmpty */.xb)(data)||(_this3.metricsUnits=data);case 5:case"end":return _context3.stop()}}),_callee3)})))()},setMetricName:function(metricsUnits){var _this4=this;0!==this.kpiTypeObj.metricId&&(this.metricName=metricsUnits.metrics.find((function(metric){return _this4.kpiTypeObj.metricId===metric.metricId})),this.metricName=this.metricName._name)},loadUnit:function(metricsUnits){var _this5=this;0!==this.kpiTypeObj.metricId?(this.setMetricName(metricsUnits),this.unitId=metricsUnits.orgUnitsList.find((function(metric){return metric.metric===_this5.kpiTypeObj.metricId})),(0,validation/* isEmpty */.xb)(this.kpiTypeObj.unitId)||this.$set(this.kpiTypeObj,"unitId",this.unitId.unit)):this.$set(this.kpiTypeObj,"unitId",0)}}},readingkpi_KPITypeFormvue_type_script_lang_js=KPITypeFormvue_type_script_lang_js,KPITypeForm_component=(0,componentNormalizer/* default */.Z)(readingkpi_KPITypeFormvue_type_script_lang_js,KPITypeFormvue_type_template_id_8d26b01e_scoped_true_render,KPITypeFormvue_type_template_id_8d26b01e_scoped_true_staticRenderFns,!1,null,"8d26b01e",null)
/* harmony default export */,KPITypeForm=KPITypeForm_component.exports,SidebarScrollMixin=__webpack_require__(565476),utils_validation=__webpack_require__(990260),CustomModuleData=__webpack_require__(689565),liveKpiFrequencies=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],scheduledKpiFrequencies=[17,18,19,20,21],CreateKpivue_type_script_lang_js={components:{AsyncButton:AsyncButton/* default */.Z,KPIDetails:KPIDetails,KPIFormulaBuilder:KPIFormulaBuilder,KPITypeForm:KPITypeForm},mounted:function(){this.$nextTick(this.registerScrollHandler)},mixins:[SidebarScrollMixin/* default */.Z],created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var isEditForm;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(isEditForm=_this.isEditForm,!isEditForm){_context.next=5;break}return _context.next=4,_this.prefillKpi();case 4:_this.isNew=!1;case 5:case"end":return _context.stop()}}),_callee)})))()},data:function(){return{moduleName:"readingkpi",isLoading:!1,hasChanged:!1,kpiData:{},rootElementForScroll:".scroll-container",sidebarElements:["#kpidetails-link","#kpitype-link","#formulaBuilder-link"],sectionElements:["#kpidetails-section","#kpitype-section","#formulaBuilder-section"],isNew:!0,liveKpiFrequencies:liveKpiFrequencies,scheduledKpiFrequencies:scheduledKpiFrequencies}},computed:{title:function(){var isNew=this.isNew,title=isNew?this.$t("kpi.kpi.new_kpi_defintion"):this.$t("kpi.kpi.edit_kpi");return title},isEditForm:function(){var id=this.$getProperty(this,"$route.params.id");return!(0,utils_validation/* isEmpty */.xb)(id)},modelDataClass:function(){return CustomModuleData/* CustomModuleData */.u}},methods:{save:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var kpiData,isValidKpi,isValidFormula,_yield$_this2$saveRec,readingkpi,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(kpiData=_this2.kpiData,_this2.serializeData(),isValidKpi=_this2.validateKpi(kpiData),isValidFormula=_this2.validateFields(kpiData),!isValidKpi||!isValidFormula){_context2.next=13;break}return _context2.next=7,_this2.saveRecord(kpiData);case 7:_yield$_this2$saveRec=_context2.sent,readingkpi=_yield$_this2$saveRec.readingkpi,error=_yield$_this2$saveRec.error,(0,utils_validation/* isEmpty */.xb)(readingkpi)?_this2.$message.error(error.message||"Error Occured"):_this2.$router.push({name:"readingkpi.list"}),_context2.next=14;break;case 13:isValidKpi?_this2.$message.error(_this2.$t("rule.create.variables_must_be_unique")):_this2.$message.error(_this2.$t("rule.create.fill_mandatory_fields"));case 14:case"end":return _context2.stop()}}),_callee2)})))()},serializeData:function(){var kpiData=this.kpiData,_ref=kpiData||{},assetCategoryId=_ref.assetCategoryId,resourceType=_ref.resourceType,kpiType=_ref.kpiType,assets=_ref.assets;3===kpiType&&this.$set(this.kpiData,"frequency",-1),this.$set(this.kpiData,"resourceType",resourceType),this.$set(this.kpiData,"assetCategory",{id:parseInt(assetCategoryId)}),this.$set(this.kpiData.ns,"includedAssetIds",assets)},saveRecord:function(serilaizedData){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var moduleName,_ref2,id;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(moduleName=_this3.moduleName,_ref2=serilaizedData||{},id=_ref2.id,!(0,utils_validation/* isEmpty */.xb)(id)){_context3.next=8;break}return _context3.next=5,api/* API */.bl.createRecord(moduleName,{data:serilaizedData});case 5:return _context3.abrupt("return",_context3.sent);case 8:return _context3.next=10,api/* API */.bl.updateRecord(moduleName,{id:id,data:serilaizedData});case 10:return _context3.abrupt("return",_context3.sent);case 11:case"end":return _context3.stop()}}),_callee3)})))()},validateKpi:function(kpi){var mandatoryFields={},_ref3=kpi||{},name=_ref3.name,kpiCategory=_ref3.kpiCategory,resourceType=_ref3.resourceType,assetCategory=_ref3.assetCategory,spaceCategory=_ref3.spaceCategory,kpiType=_ref3.kpiType,frequency=_ref3.frequency,ns=_ref3.ns,_ref4=ns||{},workflowContext=_ref4.workflowContext,_ref5=workflowContext||{},workflowV2String=_ref5.workflowV2String;mandatoryFields={name:name,kpiCategory:kpiCategory,resourceType:resourceType,kpiType:kpiType,workflowV2String:workflowV2String},3!==kpiType&&(mandatoryFields.frequency=frequency);var validKpi=Object.values(mandatoryFields).every((function(value){return!(0,utils_validation/* isEmpty */.xb)(value)}))&&(!(0,utils_validation/* isEmpty */.xb)(assetCategory)||!(0,utils_validation/* isEmpty */.xb)(spaceCategory));return validKpi},validateFields:function(kpi){var variables=[],isRelatedReadingPresent=!1,isCurrentAssetAvailable=!1,_ref6=kpi||{},ns=_ref6.ns,_ref7=ns||{},fields=_ref7.fields;variables=fields;var uniqueVariables=(0,toConsumableArray/* default */.Z)(new Set(variables.map((function(variable){return variable.varName})))),finalReadings=[];return variables.forEach((function(variable){var _ref8=variable||{},fieldId=_ref8.fieldId,resourceId=_ref8.resourceId,relMapContext=_ref8.relMapContext,nsFieldType=_ref8.nsFieldType,_ref9=relMapContext||{},mappingLinkName=_ref9.mappingLinkName;(0,utils_validation/* isEmpty */.xb)(fieldId)||finalReadings.push(fieldId);var assetId=resourceId;(-1===assetId&&"ASSET_READING"===nsFieldType||!(0,utils_validation/* isEmpty */.xb)(mappingLinkName))&&(isCurrentAssetAvailable=isCurrentAssetAvailable||!0),"RELATED_READING"===nsFieldType&&(isRelatedReadingPresent=!0)})),!(uniqueVariables.length!==variables.length||finalReadings.length!==variables.length||!isCurrentAssetAvailable&&!isRelatedReadingPresent)},goBack:function(){this.$emit("closeEditForm",!0),this.$router.push({name:"readingkpi.list"})},setProperties:function(value){this.kpiData=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},this.kpiData),value)},prefillKpi:function(){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var id;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _this4.isLoading=!0,id=_this4.$getProperty(_this4,"$route.params.id"),_context4.next=4,_this4.loadSummary(id);case 4:_this4.isLoading=!1;case 5:case"end":return _context4.stop()}}),_callee4)})))()},loadSummary:function(id){var _arguments=arguments,_this5=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee5(){var force,moduleName,_yield$API$fetchRecor,readingkpi;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return force=!(_arguments.length>1&&void 0!==_arguments[1])||_arguments[1],moduleName=_this5.moduleName,_context5.next=4,api/* API */.bl.fetchRecord(moduleName,{id:id},{force:force});case 4:_yield$API$fetchRecor=_context5.sent,readingkpi=_yield$API$fetchRecor.readingkpi,_this5.$set(_this5,"kpiData",readingkpi);case 7:case"end":return _context5.stop()}}),_callee5)})))()}}},readingkpi_CreateKpivue_type_script_lang_js=CreateKpivue_type_script_lang_js,CreateKpi_component=(0,componentNormalizer/* default */.Z)(readingkpi_CreateKpivue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,CreateKpi=CreateKpi_component.exports},
/***/565476:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return SidebarScrollMixin}});
// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.map.js
__webpack_require__(450886),__webpack_require__(260228),__webpack_require__(947522);
// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js
var render,staticRenderFns,vue_scrollto=__webpack_require__(593081),vue_scrollto_default=__webpack_require__.n(vue_scrollto),SidebarScrollMixinvue_type_script_lang_js={beforeDestroy:function(){var root=document.querySelector(this.rootElementForScroll);root&&root.removeEventListener("scroll",this.scrollhandler)},methods:{registerScrollHandler:function(){var root=document.querySelector(this.rootElementForScroll);root&&root.addEventListener("scroll",this.scrollhandler,{passive:!0})},scrollhandler:function(){var highlightSidebarElement=this.highlightSidebarElement,anchorSectionHeader=this.anchorSectionHeader,deAnchorSectionHeader=this.deAnchorSectionHeader,sectionElements=this.sectionElements,elements=sectionElements.map((function(id){return document.querySelector(id)}));window.requestAnimationFrame((function(){elements.forEach((function(el){var _el$getBoundingClient=el.getBoundingClientRect(),top=_el$getBoundingClient.top,sectionName=el.getAttribute("id").split("-")[0];top<153?anchorSectionHeader(sectionName):deAnchorSectionHeader(sectionName),top<400&&highlightSidebarElement(sectionName)}))}))},scrollTo:function(sectionName){var _this=this,onDone=function(){return _this.highlightSidebarElement(sectionName)};vue_scrollto_default().scrollTo("#".concat(sectionName,"-section"),500,{container:".scroll-container",easing:"ease-in",offset:0,force:!0,onDone:onDone})},highlightSidebarElement:function(sectionName){var sidebarElements=this.sidebarElements,elements=sidebarElements.map((function(e){return document.querySelector(e)}));elements.forEach((function(el){el.getAttribute("id")==="".concat(sectionName,"-link")?el.classList.add("active"):el.classList.remove("active")}))},anchorSectionHeader:function(sectionName){var elements=document.querySelectorAll(".section-header");elements.forEach((function(el){el.getAttribute("id")==="".concat(sectionName,"-header")&&el.classList.add("anchor-top")}))},deAnchorSectionHeader:function(sectionName){var elements=document.querySelectorAll(".section-header");elements.forEach((function(el){el.getAttribute("id")==="".concat(sectionName,"-header")&&el.classList.remove("anchor-top")}))}}},mixins_SidebarScrollMixinvue_type_script_lang_js=SidebarScrollMixinvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(mixins_SidebarScrollMixinvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,SidebarScrollMixin=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/49685.js.map