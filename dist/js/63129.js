"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[63129],{
/***/937376:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FNewAnalyticsReportV1}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/energy/analytics/newTools/v1/FNewAnalyticsReportV1.vue?vue&type=template&id=1fa73ec3&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"analytics-section mT20 height100"},[_c("div",{staticClass:"new-analytics-filter-section"},[_vm.config.hidedatepicker?_vm._e():_c("new-date-picker",{ref:"newDatePicker",staticClass:"filter-field date-filter-comp inline",attrs:{zone:_vm.$timezone,dateObj:_vm.config.dateFilter,isDateFixed:_vm.config.applyReportDate},on:{date:_vm.setDateFilter}}),this.reportObj&&this.reportObj.options&&!0===this.reportObj.options.settings.timeperiod&&[1,4].includes(_vm.config.mode)?_c("div",{staticClass:"chart-icon pointer flRight pB8 el-popover__reference",staticStyle:{"margin-right":"120px"}},[_c("el-select",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"period-select width20 fc-input-full-border2 ",attrs:{placeholder:"Period",title:"Time period","data-arrow":"true"},on:{change:_vm.onPeriodChange},model:{value:_vm.config.period,callback:function($$v){_vm.$set(_vm.config,"period",$$v)},expression:"config.period"}},_vm._l(_vm.getAvailablePeriods,(function(period,index){return _c("el-option",{key:index,attrs:{label:period.name,value:period.value,disabled:!period.enable}})})),1)],1):_vm._e(),_vm.showTemplateFilter&&_vm.resultObj&&_vm.resultObj.report&&_vm.resultObj.report.currentTemplate&&_vm.resultObj.report.currentTemplate.show?_c("div",[_c("el-select",{staticClass:"fc-input-full-border-h35 fc-report-label-position",attrs:{filterable:""},on:{change:_vm.changeParentForTemplate},model:{value:_vm.resultObj.report.currentTemplate.parentId,callback:function($$v){_vm.$set(_vm.resultObj.report.currentTemplate,"parentId",$$v)},expression:"resultObj.report.currentTemplate.parentId"}},_vm._l(_vm.resultObj.report.currentTemplate.chooseValues,(function(asset,assetIdx){return _c("el-option",{key:assetIdx,attrs:{value:asset.id,label:asset.name}})})),1)],1):_vm._e(),!_vm.config.hidechartoptions&&_vm.reportObj&&!0===!_vm.isRegression?_c("f-chart-settings",{attrs:{dataPoints:_vm.reportObj.options.dataPoints,settings:_vm.reportObj.options.settings,showChart:!1,showTable:!1,showChartMode:_vm.showChartMode,showTimePeriod:_vm.showTimePeriod,showAlarm:!(!_vm.reportObj.options||!_vm.reportObj.options.common||1!==_vm.reportObj.options.common.type),showSafelimit:!(!_vm.reportObj.options||!_vm.reportObj.options.common||1!==_vm.reportObj.options.common.type||"undefined"!==typeof _vm.resultObj.regression),disableChartMode:_vm.reportObj.booleanData},on:{onSettingsChange:_vm.onSettingsChange}},[_vm._v(_vm._s(_vm.showTimePeriod))]):_vm._e(),_vm.resultObj&&_vm.resultObj.report&&0!==_vm.resultObj.report.dataPoints.length&&!_vm.isRegression?_c("span"):_vm._e()],1),!_vm.$mobile&&_vm.predictive&&_vm.config.predictionTimings&&_vm.config.predictionTimings.length?_c("prediction-timings-bar",{staticClass:" prediction-timing-bar",attrs:{reportObj:_vm.reportObj,config:_vm.config}}):_vm._e(),_vm.loading?_c("spinner",{staticClass:"analytics-spinner",attrs:{show:_vm.loading,size:"80"}}):_vm.failed?_c("div",{staticStyle:{"margin-top":"30px",opacity:"0.7","font-size":"13px",padding:"50px","line-height":"25px","text-align":"center"}},[_c("div",[_vm._v(_vm._s(_vm.$t("home.dashboard.data_loading_failed")))])]):_vm.reportObj.data?_c("div",{staticClass:"height100"},[_vm.config.hidechart?_vm._e():_c("div",{staticClass:"height100"},[_vm.$route.meta&&_vm.$route.meta.layout&&"mobile"===_vm.$route.meta.layout&&_vm.reportObj&&"multi"===_vm.reportObj.options.settings.chartMode?_c("f-mobile-multi-chart",{ref:"multiChart",attrs:{isWidget:!!_vm.config,width:_vm.config&&_vm.config.width?_vm.config.width:null,resultObj:_vm.resultObj,height:_vm.config&&_vm.config.height?_vm.config.height:null,data:_vm.reportObj.data,options:_vm.reportObj.options,alarms:_vm.reportObj.alarms,dateRange:_vm.reportObj.dateRange,hidecharttypechanger:_vm.config&&_vm.config.widget,booleanData:_vm.reportObj.booleanData}}):_vm._e(),_vm.$route.meta&&_vm.$route.meta.layout&&"mobile"===_vm.$route.meta.layout&&_vm.reportObj&&"multi"===_vm.reportObj.options.settings.chartMode?_c("div",{staticClass:"empty-multi-chart"},[_vm._v(" Currently this chart not supported in the mobile ")]):_vm.reportObj&&"multi"===_vm.reportObj.options.settings.chartMode?_c("f-multi-chart",{ref:"multiChart",attrs:{data:_vm.reportObj.data,options:_vm.reportObj.options,alarms:_vm.reportObj.alarms,booleanData:_vm.reportObj.booleanData,dateRange:_vm.reportObj.dateRange,resultObj:_vm.resultObj,hidecharttypechanger:_vm.config.hidecharttypechanger||_vm.isRegression}}):_c("div",{staticClass:"height100"},[_vm.$route.meta&&_vm.$route.meta.layout&&"mobile"===_vm.$route.meta.layout&&!_vm.isHeatMap?_c("f-mobile-chart",{ref:"newChart",staticClass:"mobile-chart",attrs:{data:_vm.reportObj.data,options:_vm.reportObj.options,dateRange:_vm.reportObj.dateRange,resultObj:_vm.resultObj}}):_vm.isHeatMap?_vm._e():_c("f-new-chart",{ref:"newChart",attrs:{data:_vm.reportObj.data,options:_vm.reportObj.options,alarms:_vm.reportObj.alarms,dateRange:_vm.reportObj.dateRange,resultObj:_vm.resultObj,hidecharttypechanger:_vm.config.hidecharttypechanger||_vm.isRegression,fixedChartHeight:_vm.config.fixedChartHeight,config:_vm.config,showWidgetLegends:!_vm.config||_vm.config.showWidgetLegends,chartTypeTarget:_vm.chartTypeTarget}},[_c("template",{slot:"relatedAlarmBar"},[_vm._t("relatedAlarmBarLayout")],2)],2),_vm.isHeatMap?_c("FNewHeatMap",{attrs:{config:_vm.config,resultObject:_vm.resultObj,reportObject:_vm.reportObj}}):_vm._e()],1)],1),_vm.config.hidetabular?_vm._e():_c("f-tabular-report",{ref:"newTable",staticClass:"new-analytics-table mL30 mR30",class:{"regression-table-fit":_vm.isRegression},attrs:{reportObject:_vm.resultObj,reportConfig:_vm.reportObj}})],1):_c("div",{staticStyle:{"margin-top":"30px","font-size":"13px",padding:"50px","line-height":"25px","text-align":"center"}},[_c("inline-svg",{attrs:{src:"svgs/emptystate/reportlist",iconClass:"icon text-center icon-100"}}),_c("div",{staticClass:"nowo-label f13"},[_vm._v(" "+_vm._s(_vm.$t("common.wo_report.empty_data"))+" "),_vm.resultObj&&_vm.resultObj.dateRange?_c("span",{staticClass:"bold"},[_vm._v(_vm._s(_vm._f("formatPeriod")(_vm.resultObj.dateRange.value,"MMM DD, YYYY")))]):_vm._e()])],1),_vm.resultObj?_c("RangeChartDialog",{attrs:{visibility:_vm.showRangeChartDialog,dataPoints:_vm.resultObj.report.dataPoints},on:{"update:visibility":function($event){_vm.showRangeChartDialog=$event},rangePoints:_vm.addRangePoints}}):_vm._e()],1)},staticRenderFns=[],createForOfIteratorHelper=__webpack_require__(566347),NewDatePicker=(__webpack_require__(670560),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(538077),__webpack_require__(947522),__webpack_require__(434284),__webpack_require__(648324),__webpack_require__(169358),__webpack_require__(900773)),FNewchartV1vue_type_template_id_4ddd8122_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100 f-singlechart mL20 mR20"},[_vm.chartTypeTarget&&!_vm.hidecharttypechanger?_c("portal",{attrs:{to:_vm.chartTypeTarget,slim:""}},[_c("f-chart-type",{attrs:{options:_vm.options}})],1):_vm.hidecharttypechanger?_vm._e():_c("f-chart-type",{staticClass:"charttypechanger fc-new--chart-type-single",attrs:{options:_vm.options}}),_vm.chartContext&&!1!==_vm.options.settings.chart?_c("div",{staticStyle:{"text-align":"center"}},[_vm.chartContext.options.legend.show&&"top"===_vm.chartContext.options.legend.position?_c("f-chart-legends",{ref:"chartLegend",attrs:{chart:_vm.c3.chart,options:_vm.options,xValueMode:_vm.chartContext.xValueMode,xLabelMap:_vm.chartContext.xLabelMap,config:_vm.config}}):_vm._e(),_vm._t("relatedAlarmBar"),_vm.chartContext.options.regionConfig?_c("f-chart-title",{ref:"chartTitle",attrs:{chart:_vm.c3.chart,options:_vm.options,xValueMode:_vm.chartContext.xValueMode,xLabelMap:_vm.chartContext.xLabelMap,config:_vm.config,chartContext:_vm.chartContext}}):_vm._e(),_c("div",{style:_vm.isWidget?"position: relative; top: 15px;":""},[_vm.showAlarms&&_vm.showAlarmTitle?_c("div",{staticClass:"fc-alarms-chart-title"},[_vm._v(" Alarms ")]):_vm._e(),_c("div",{ref:"alarmsChartEle",staticClass:"fc-alarms-chart pdf-chart"})]),_c("div",{staticClass:"fc-newchart-container"},[_c("div",{ref:"newChartEle",staticClass:"fc-new-chart pdf-chart",class:{"hide-y2-axis":_vm.options&&_vm.options.axis&&!1===_vm.options.axis.showy2axis}}),_vm.chartContext.options.legend.show&&"right"===_vm.chartContext.options.legend.position?_c("f-chart-legends",{style:{width:_vm.chartContext.options.legend.width+"px"},attrs:{chart:_vm.c3.chart,options:_vm.options,xValueMode:_vm.chartContext.xValueMode,xLabelMap:_vm.chartContext.xLabelMap,config:_vm.config}}):_vm._e()],1),_vm.chartContext.options.legend.show&&"bottom"===_vm.chartContext.options.legend.position?_c("f-chart-legends",{ref:"chartLegend",attrs:{chart:_vm.c3.chart,options:_vm.options,xValueMode:_vm.chartContext.xValueMode,xLabelMap:_vm.chartContext.xLabelMap}}):_vm._e(),_vm.showWidget?_c("f-widget-legends",{ref:"newWidget",staticClass:"widget-legends",attrs:{chart:_vm.c3.chart,reportVarianceData:_vm.resultObj?_vm.resultObj.reportData.aggr:null,data:_vm.data,options:_vm.options}}):_vm._e()],2):_vm._e()],1)},FNewchartV1vue_type_template_id_4ddd8122_staticRenderFns=[],billboard=(__webpack_require__(212826),__webpack_require__(872695)),basechart=__webpack_require__(503162),c3_helper=__webpack_require__(167021),FChartLegends=__webpack_require__(906575),FChartTitle=__webpack_require__(23369),FWidgetLegends=__webpack_require__(547301),FNewChartType=__webpack_require__(270352),JumpToHelper=__webpack_require__(921466),tooltip=__webpack_require__(460895),color_helper=__webpack_require__(794211),deepmerge=__webpack_require__(708634),FNewchartV1vue_type_script_lang_js={mixins:[basechart/* default */.Z,JumpToHelper/* default */.Z],props:["resultObj","isWidget","showWidgetLegends","config","chartTypeTarget"],components:{FChartLegends:FChartLegends/* default */.Z,FWidgetLegends:FWidgetLegends/* default */.Z,FChartType:FNewChartType/* default */.Z,FChartTitle:FChartTitle/* default */.Z},computed:{showWidget:function(){return"undefined"===typeof this.showWidgetLegends||!!this.config.hasOwnProperty("showWidgetLegends")&&this.config.showWidgetLegends},isRegression:function(){return!!(this.$route.path.includes("regression")||this.resultObj&&this.resultObj.regressionConfig&&0!==this.resultObj.regressionConfig.length&&!0===this.resultObj.regression)},showAlarmTitle:function(){return!this.chartContext||!this.chartContext.options||!this.chartContext.options.hideAlarmTitle}},data:function(){return{chartContext:null,chartId:Math.random().toString(36).substr(2,9),c3:{params:null,chart:null},showAlarms:!1,updateTimeout:null}},mounted:function(){this.config.hidecharttypechanger&&(this.hidecharttypechanger=!0),this.isRegression&&(this.hidecharttypechanger=!0),this.render()},beforeDestroy:function(){tooltip/* default */.Z.hideTooltip(),this.c3&&this.c3.chart&&this.c3.chart.destroy(),this.chartContext=null,this.c3.params=null,this.c3.chart=null},methods:{render:function(){var _this=this;this.data&&(this.chartContext=null,this.$nextTick((function(){_this.chartContext={},_this.chartContext.options=_this.getOptions(),_this.chartContext.dateRange=_this.dateRange,_this.chartContext.data=_this.data,_this.chartContext.xValueMode=_this.isXValueMode(_this.chartContext.options,_this.data),_this.chartContext.unitMap=_this.getUnitMap(_this.options.dataPoints),_this.chartContext.enumMap=_this.getEnumMap(_this.options.dataPoints),_this.chartContext.openAlarm=function(alarmList){if(alarmList){var _step,alarmId=[],_iterator=(0,createForOfIteratorHelper/* default */.Z)(alarmList);try{for(_iterator.s();!(_step=_iterator.n()).done;){var a=_step.value;alarmId.push(a.id)}}catch(err){_iterator.e(err)}finally{_iterator.f()}_this.jumpToAlarms(alarmId)}},"pie"!==_this.chartContext.options.type&&"donut"!==_this.chartContext.options.type||(_this.chartContext.options.padding.top=20);var c3Params=c3_helper/* default */.Z.prepare(_this.chartContext);c3Params&&(c3Params.data.onclick=function(d){_this.$emit("drilldown",d)}),_this.mergeOption&&(_this.chartContext.options.padding.left=_this.mergeOption.padding.left,_this.chartContext.options.padding.right=_this.mergeOption.padding.right,_this.chartContext.options.axis.x.label.text="Month",c3Params.axis.y.label.text="No of Work Request"),_this.isWidget&&(_this.chartContext.options.legend.show?c3Params.size.height=c3Params.size.height-50:c3Params.size.height=c3Params.size.height-20,_this.options.widgetLegend.show&&(c3Params.size.height=c3Params.size.height-75),_this.resultObj&&_this.resultObj.report.userFilters&&(c3Params.size.height=c3Params.size.height-65));var self=_this;self.showAlarms=1===_this.getOptions().common.mode&&_this.getOptions().settings.alarm,_this.config&&_this.config.hasOwnProperty("showAlarms")&&(self.showAlarms=_this.config.showAlarms),self.showAlarms&&(_this.chartContext.alarms=_this.alarms,c3Params.size.height=c3Params.size.height-100);var alarmsParams=null;if(self.showAlarms&&(alarmsParams=c3_helper/* default */.Z.prepareBooleanChart(_this.chartContext,c3Params.data.json.x,_this.alarms),self.$refs["alarmsChartEle"]&&(alarmsParams.bindto=self.$refs["alarmsChartEle"],billboard.bb.generate(alarmsParams))),_this.chartContext.options.customizeC3){var defaultOptions={},mergedOptions=deepmerge/* default */.Z.objectAssignDeep(defaultOptions,c3Params,_this.chartContext.options.customizeC3);c3Params=mergedOptions}self.$refs["newChartEle"]?(c3Params.bindto=self.$refs["newChartEle"],self.isWidget&&self.$refs["chartLegend"]&&(c3Params.size.height=c3Params.size.height-(self.$refs["chartLegend"].$el.clientHeight-20)),self.fixedChartHeight&&(c3Params.size.height=self.fixedChartHeight),self.c3.params=c3Params,self.c3.chart=billboard.bb.generate(c3Params)):_this.$nextTick((function(){self.showAlarms&&self.$refs["alarmsChartEle"]&&(alarmsParams.bindto=self.$refs["alarmsChartEle"],billboard.bb.generate(alarmsParams)),c3Params.bindto=self.$refs["newChartEle"],self.isWidget&&self.$refs["chartLegend"]&&(c3Params.size.height=c3Params.size.height-(self.$refs["chartLegend"].$el.clientHeight-20)),self.fixedChartHeight&&(c3Params.size.height=self.fixedChartHeight),self.c3.params=c3Params,self.c3.chart=billboard.bb.generate(c3Params)}))})))},isXValueMode:function(options,data){if("pie"===options.type||"donut"===options.type){if(options.xColorMap)return!0;if(data&&data.x&&2===Object.keys(data).length&&data.x.length<=15){for(var colors=color_helper/* default */.Z.newColorPicker(data.x.length),xColorMap={},i=0;i<data.x.length;i++){var xVal=data.x[i];xColorMap[xVal]=options.xColorMap&&options.xColorMap[xVal]?options.xColorMap[xVal]:colors[i]}return options.xColorMap=xColorMap,!0}}return!1},reRender:function(){var _this2=this;this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout((function(){return _this2.render()}),500)},resize:function(){this.reRender(),this.$refs["newWidget"]&&this.$refs["newWidget"].resize()},update:function(){this.reRender()}}},components_FNewchartV1vue_type_script_lang_js=FNewchartV1vue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FNewchartV1vue_type_script_lang_js,FNewchartV1vue_type_template_id_4ddd8122_render,FNewchartV1vue_type_template_id_4ddd8122_staticRenderFns,!1,null,null,null)
/* harmony default export */,FNewchartV1=component.exports,FMobileChart=__webpack_require__(242208),FMultiChart=__webpack_require__(649206),NewDataFormatHelper=__webpack_require__(804911),AnalyticsMixin=__webpack_require__(244936),FTabularReportNew=__webpack_require__(979),FNewChartSettings=__webpack_require__(83322),FMobileMultiChart=__webpack_require__(696593),PredictionTimingsBar=__webpack_require__(107387),NewDateHelper=__webpack_require__(105534),RangeChartDialog=__webpack_require__(515326),NewReportSummaryHelper=__webpack_require__(601458),FNewHeatMap=__webpack_require__(283938),FNewAnalyticsReportV1vue_type_script_lang_js={props:["config","baseLines","readings","showChartMode","showTimePeriod","chartTypeTarget"],mixins:[NewDataFormatHelper/* default */.Z,AnalyticsMixin/* default */.Z,NewDateHelper/* default */.Z,NewReportSummaryHelper/* default */.Z],components:{NewDatePicker:NewDatePicker/* default */.Z,FNewChart:FNewchartV1,FMultiChart:FMultiChart/* default */.Z,FTabularReport:FTabularReportNew/* default */.Z,FMobileChart:FMobileChart/* default */.Z,FChartSettings:FNewChartSettings/* default */.Z,FMobileMultiChart:FMobileMultiChart/* default */.Z,PredictionTimingsBar:PredictionTimingsBar/* default */.Z,RangeChartDialog:RangeChartDialog/* default */.Z,FNewHeatMap:FNewHeatMap/* default */.Z},data:function(){return{loading:!0,predictive:!0,failed:!1,reportObj:null,resultObj:null,showRangeChartDialog:!1,showTemplateFilter:!1}},mounted:function(){this.init()},created:function(){this.$store.dispatch("loadAssetCategory")},computed:{isHeatMap:function(){return!(!this.$route||!this.$route.meta||"heatmap"!==this.$route.meta.analyticsType)},getAvailablePeriods:function(){var operationOnId=this.config.dateFilter.operationOnId,avail=[];
// avail.push({
//   name:'Week of year', // W1, W2
//   value: 16,
//   enable: true
// })
// avail.push({
//   name:'Month of year', // Jan, Feb , march
//   value: 15,
//   enable: true
// })
return avail.push({name:"High-res",value:0,enable:6===operationOnId||4!==operationOnId}),avail.push({name:"Hourly",value:20,enable:6===operationOnId||4!==operationOnId}),avail.push({name:"Daily",value:12,enable:!0}),avail.push({name:"Weekly",value:11,enable:!0}),avail.push({name:"Monthly",value:10,enable:!0}),avail.push({name:"Quarterly",value:25,enable:4===operationOnId||5===operationOnId}),avail.push({name:"Yearly",value:8,enable:4===operationOnId}),avail.push({name:"Hour of day",
// 12, 1, 2, 3
value:19,enable:!0}),avail.push({name:"Day of week",
// sun, mon
value:17,enable:!0}),avail.push({name:"Day of month",
// 1,2,3
value:18,enable:!0}),avail},isRegression:function(){return!!this.$route.path.includes("regression")}},watch:{config:{handler:function(newData,oldData){this.config.applyReportDate&&this.config.period||this.init(!1)},deep:!0},getAvailablePeriods:{handler:function(newData,oldData){var _this=this,avail=this.getAvailablePeriods,selected=avail.find((function(a){return a.value===_this.config.period&&a.enable}));if(!selected){var filterName=this.config.dateFilter.operationOn,defaultPeriod=avail.filter((function(a){return a.enable}))[0].value;"week"===filterName||"month"===filterName?defaultPeriod=12:"year"===filterName&&(defaultPeriod=10),this.config.period=defaultPeriod}},immediate:!0}},methods:{changeParentForTemplate:function(){this.config.template&&(this.config.template.parentId=this.resultObj.report.currentTemplate.parentId)},onPeriodChange:function(){if(!this.config.dataPoints.length){var filter="D";20===this.config.period?filter="W":12===this.config.period?filter="M":10===this.config.period&&(filter="Y"),this.config.dateFilter=this.getDefaultDateFilter(filter)}},addRangePoints:function(val,remainingDataPoints){var _step,ranges=["min","max","avg"],dataPoints=[],_iterator=(0,createForOfIteratorHelper/* default */.Z)(val);try{for(_iterator.s();!(_step=_iterator.n()).done;){var rangeConfig=_step.value;for(var key in rangeConfig){var config={};ranges.includes(key)&&(config["parentId"]=rangeConfig[key].parentId,config["prediction"]=!1,config["aliases"]={actual:rangeConfig[key].alias},config["yAxis"]={aggr:rangeConfig[key].aggr,fieldId:rangeConfig[key].fieldId},dataPoints.push(config))}}}catch(err){_iterator.e(err)}finally{_iterator.f()}var _step2,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(remainingDataPoints);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var dataPoint=_step2.value,_config={};_config["parentId"]=dataPoint.metaData.parentIds[0],_config["prediction"]=!1,_config["aliases"]={actual:dataPoint.aliases.actual},_config["yAxis"]={aggr:dataPoint.yAxis.aggr,fieldId:dataPoint.yAxis.fieldId},dataPoints.push(_config)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var analyticConfig=this.$helpers.cloneObject(this.config);analyticConfig.dataPoints=dataPoints,analyticConfig.period="undefined"!==typeof this.config.period&&null!==this.config.period?0===this.config.period?this.getXAggr():this.config.period:0,this.$emit("update:config",analyticConfig)},setDateFilter:function(dateFilter){this.$set(this.config,"dateFilter",dateFilter);
// this.$emit('update:config', this.config)
},init:function(){this.initChart()},resize:function(){this.$refs["newChart"]&&this.$refs["newChart"].resize(),this.$refs["multiChart"]&&this.$refs["multiChart"].resize(),this.$refs["newTable"]&&this.$refs["newTable"].resize()},getReportParams:function(){var baselines,baselineNames,_this2=this;if(this.config.baseLine&&Array.isArray(this.config.baseLine)&&this.config.baseLine.length){if(this.config.baseLine[0]>0){var bl={};bl.baseLineId=this.config.baseLine[0],this.config.baseLine.length>1&&(bl.adjustType=this.config.baseLine[1]);var blList=[];blList.push(bl),baselines=blList}}else this.config.baseLine&&this.config.baseLine>0&&(baselines=[{baseLineId:this.config.baseLine}]);baselines&&this.baseLines&&(baselineNames=[],baselines.forEach((function(baseline){var baseLineName=_this2.baseLines.find((function(bl){return bl.id===baseline.baseLineId})).name;baselineNames.push(baseLineName)})));var fields=[];if(3===this.config.mode){var _step3,parentId=[],fieldId=null,yAggr=3,_iterator3=(0,createForOfIteratorHelper/* default */.Z)(this.config.dataPoints);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var dp=_step3.value;parentId.push(dp.parentId),fieldId=dp.yAxis.fieldId,yAggr=dp.yAxis.aggr}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}fields.push({parentId:parentId,yAxis:{fieldId:fieldId,aggr:0!==this.config.period&&0===yAggr?3:yAggr},type:1,aliases:{actual:"A"}}),this.setAlias(fields,baselineNames)}else{this.setAlias(this.config.dataPoints,baselineNames);var _step4,_iterator4=(0,createForOfIteratorHelper/* default */.Z)(this.config.dataPoints);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _dp=_step4.value,metaData={};_dp.categoryId&&(metaData.categoryId=_dp.categoryId),this.config.template?fields.push({parentId:_dp.parentId?Array.isArray(_dp.parentId)?_dp.parentId:[_dp.parentId]:null,buildingId:_dp.buildingId?_dp.buildingId:-1,metaData:metaData,yAxis:{fieldId:_dp.yAxis.fieldId,aggr:_dp.yAxis.aggr},aliases:_dp.aliases,type:_dp.type>0?_dp.type:1,predictedTime:_dp.predictedTime,rule_aggr_type:null===_dp||void 0===_dp?void 0:_dp.rule_aggr_type}):fields.push({parentId:_dp.parentId?Array.isArray(_dp.parentId)?_dp.parentId:[_dp.parentId]:null,name:_dp.name,buildingId:_dp.buildingId?_dp.buildingId:-1,metaData:metaData,yAxis:_dp.yAxis,aliases:_dp.aliases,type:_dp.type>0?_dp.type:1,predictedTime:_dp.predictedTime,moduleName:_dp.reportModuleName})}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}if(this.config.sorting&&(6===this.config.mode||7===this.config.mode||8===this.config.mode)&&(this.config.sorting.orderByFunc||this.config.sorting.limit)){var sortByField=this.config.sorting.sortByField;if(sortByField){var _field=fields.find((function(f){return f.yAxis.fieldId===sortByField}));_field||(sortByField=null)}sortByField||(sortByField=fields[0].yAxis.fieldId,this.config.sorting.sortByField=fields[0].yAxis.fieldId);var field=null;sortByField?field=fields.find((function(f){return f.yAxis.fieldId===sortByField})):this.config.dataPoints.length<=1&&(field=fields[0]),field&&(field.defaultSortPoint=!0,this.config.sorting.orderByFunc&&(field.orderByFunc=this.config.sorting.orderByFunc),this.config.sorting.limit&&(field.limit=this.config.sorting.limit))}this.config.template&&null!==this.config.template.parentId&&fields.forEach((function(d){d.parentId=[_this2.config.template.parentId]}));var params={mode:this.config.mode,startTime:this.config.dateFilter.value[0],endTime:this.config.dateFilter.value[1],xAggr:1===this.config.mode||3===this.config.mode||4===this.config.mode||5===this.config.mode?this.config.period:0,fields:JSON.stringify(fields),transformWorkflow:this.config.transformWorkflow};if(this.reportObj&&this.reportObj.options&&this.reportObj.options.settings?(params.showAlarms=this.reportObj.options.settings.alarm,params.showSafeLimit=this.reportObj.options.settings.safelimit):this.config.savedReport?(params.showAlarms=this.config.savedReport.showAlarms,params.showSafeLimit=this.config.savedReport.showSafeLimit):params.showSafeLimit=!0,window.fetchMarkedAlso&&(params.shouldIncludeMarked=!0),baselines&&(params.baseLines=JSON.stringify(baselines)),this.config.filters&&this.config.filters.xCriteriaMode)if(params.xCriteriaMode=this.config.filters.xCriteriaMode,this.config.filters.parentId&&this.config.filters.parentId.length)params.parentId=this.config.filters.parentId;else{var categoryId=this.config.filters.assetCategory;if(!categoryId||!categoryId.length){categoryId=[];var _step5,_iterator5=(0,createForOfIteratorHelper/* default */.Z)(this.config.dataPoints);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _dp2=_step5.value;-1===categoryId.indexOf(_dp2.categoryId)&&categoryId.push(_dp2.categoryId)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}categoryId.length&&(params.assetCategory=categoryId),this.config.filters.spaceId&&this.config.filters.spaceId.length&&(params.spaceId=this.config.filters.spaceId)}return this.$route.query&&this.$route.query.alarmId&&(params.alarmId=parseInt(this.$route.query.alarmId),params.showAlarms=!0),params},initChart:function(){var self=this;self.loading=!0,self.failed=!1;var apiURL=this.config.api?this.config.api:"/v2/report/readingReport",params=null;this.config.alarmId&&(apiURL="/v2/report/fetchReadingsFromAlarm",params={alarmId:this.config.alarmId,mode:1,xAggr:this.config.period||0,startTime:this.config.dateFilter.value[0],endTime:this.config.dateFilter.value[1],showAlarms:!0}),this.config.readingRuleId&&(params.readingRuleId=this.config.readingRuleId),this.config.isWithPrerequsite&&(params.isWithPrerequsite=this.config.isWithPrerequsite),params||(params=self.getReportParams()),this.config.template&&this.config.template.show&&(apiURL=apiURL+"?templateString="+encodeURIComponent(JSON.stringify(this.config.template))),this.config.analyticsType&&(params.analyticsType=this.config.analyticsType),params.newFormat=!0,self.$http.post(apiURL,params).then((function(response){var result=response.data.result;if(result.xAggr=params.xAggr,result.mode=params.mode,self.config.analyticsType&&(result.report.analyticsType=self.config.analyticsType),self.config.filters&&(result.filters=self.config.filters),self.config.sorting&&(result.sorting=self.config.sorting),self.config.applyReportDate?(self.config.dateFilter=result.dateRange=NewDateHelper/* default */.Z.getDatePickerObject(self.config.dateFilter.operatorId,result.report.dateValue),self.$nextTick((function(){self.$refs.newDatePicker.loadFromObject()}))):result.dateRange=self.config.dateFilter,self.reportObj&&!self.config.alarmId?(result.report.chartState=self.reportObj.options,result.report.tabularState=self.reportObj.params.tabularState):self.config.savedReport&&(result.report.chartState=self.config.savedReport.chartState,result.report.tabularState=self.config.savedReport.tabularState),self.reportObj=self.prepareReport(result),self.config.customizeC3&&self.reportObj.options&&(self.reportObj.options["customizeC3"]=self.config.customizeC3),self.config.customizeChartOptions&&self.reportObj.options&&(self.reportObj.options=deepmerge/* default */.Z.objectAssignDeep(self.reportObj.options,self.config.customizeChartOptions)),self.config.template){var currentTemplate=JSON.parse(JSON.stringify(self.config.template)),filters=self.getFiltersFromCriteria(currentTemplate);self.loadReportTemplateValues(currentTemplate,filters).then((function(){currentTemplate.parentId=null===currentTemplate.parentId?currentTemplate.defaultValue:currentTemplate.parentId,self.$set(self.resultObj.report,"currentTemplate",currentTemplate),self.showTemplateFilter=!0}))}(self.config.isFromAlarmSummary||self.$route.query&&self.$route.query.isFromAlarmSummary&&!self.resultObj)&&self.reportObj.booleanData&&(self.reportObj.options.dataPoints=self.groupNonBooleanPoints(self.reportObj.options.dataPoints)),(self.$route.query&&self.$route.query.alarmId||self.config.alarmId)&&(self.reportObj.options.settings.alarm=!0),self.config.alarmId&&"undefined"!=typeof self.config.showAlarmBar&&(self.reportObj.options.settings.alarm=self.config.showAlarmBar),self.resultObj=result,self.reportObj.params=params,self.reportObj.tableConfig=self.config.tableConfig,self.reportObj.alarms=self.prepareBooleanReport(result.reportData.aggr),self.config.alarmId&&(self.reportObj.alarms.barSize="medium"),self.config.regionConfig&&(self.reportObj.options.regionConfig=self.config.regionConfig),self.config.hideDataPoints&&(self.reportObj.options.hideDataPoints=self.config.hideDataPoints),self.config.hasOwnProperty("disbaleNiceTickMarks")&&(self.reportObj.options.disbaleNiceTickMarks=self.config.disbaleNiceTickMarks),self.config.chartType&&(self.reportObj.options.chartType=self.config.chartType),self.config.diffChartConfig&&(self.reportObj.options.diffChartConfig=self.config.diffChartConfig),self.config.hideLegends&&self.reportObj.options.legend&&(self.reportObj.options.legend.show=!1),self.config.paddingOptions&&(self.reportObj.options.padding=self.config.paddingOptions),self.config.intersections&&(self.reportObj.options.intersections=self.config.intersections),self.config.point&&(self.config.pointShowRule?self.reportObj.options.point=self.pointShowRule(self.reportObj.dateRange,self.config.pointShowRule):self.reportObj.options.point=self.config.point),self.config.zoom&&(self.reportObj.options.zoom=self.config.zoom),self.config.size&&(self.config.size.width||self.config.size.height)&&(self.reportObj.options.size=self.config.size),self.config.axes&&(self.reportObj.options.axes=self.config.axes),self.reportObj.options.xFormat="MM-DD-YYYY",self.config.xFormat&&(self.reportObj.options.xFormat=self.config.xFormat),self.config.colors&&self.reportObj.options.dataPoints&&self.reportObj.options.dataPoints.length&&self.reportObj.options.dataPoints.forEach((function(rt){rt.color=self.config.colors[rt.key]})),self.config.axis&&(self.reportObj.options.fixedAxis=self.config.axis),self.reportObj.options.predictionTimings=self.config.predictionTimings,self.$emit("reportLoaded",self.reportObj,self.resultObj),self.loading=!1})).catch((function(error){error&&(self.loading=!1,self.failed=!0)}))},onSettingsChange:function(changedOption){"alarm"===changedOption?this.reportObj.alarms&&this.reportObj.alarms.regions.length||!this.reportObj.options.settings.alarm||this.init():"safelimit"===changedOption&&!this.reportObj.options.safeLimit.length&&this.reportObj.options.settings.safelimit&&this.init()}}},v1_FNewAnalyticsReportV1vue_type_script_lang_js=FNewAnalyticsReportV1vue_type_script_lang_js,FNewAnalyticsReportV1_component=(0,componentNormalizer/* default */.Z)(v1_FNewAnalyticsReportV1vue_type_script_lang_js,render,staticRenderFns,!1,null,"1fa73ec3",null)
/* harmony default export */,FNewAnalyticsReportV1=FNewAnalyticsReportV1_component.exports},
/***/315065:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FHeatMapPointSelector}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/report/components/FHeatMapPointSelector.vue?vue&type=template&id=ba78c72a
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.visibility?_c("div",{staticClass:"analytics-sidebar-bg"},[_c("div",{staticClass:"sidebar-position-setup"},[_c("div",{staticClass:"sidebar-close-btn pointer",on:{click:_vm.cancel}},[_vm._m(0)]),_c("div",{staticClass:"building-analysis-sidebar-conatainer"},[_vm.buildingIds&&_vm.buildingIds.length?_vm.loading?_c("div",{staticClass:"newanalytics-sidebar col-3"},[_c("spinner",{attrs:{show:_vm.loading}})],1):_c("div",{staticClass:"newanalytics-sidebar col-3"},[_c("div",{staticClass:"data-pointer-selector-popup"},[_c("analaytics-filter",{attrs:{zones:_vm.zones,selectedBuildings:_vm.selectedBuildings,isSiteAnalysis:_vm.isSiteAnalysis},on:{"update:selectedBuildings":function($event){_vm.selectedBuildings=$event},"update:selected-buildings":function($event){_vm.selectedBuildings=$event}}})],1),_c("div",[_vm.showQuickSearch?_c("div",[_c("div",{staticClass:"fc-list-search"},[_c("div",{staticClass:"fc-list-search-wrapper relative fc-list-search-wrapperbuilding-search"},[_c("input",{directives:[{name:"model",rawName:"v-model",value:_vm.searchKey,expression:"searchKey"}],ref:"quickSearchQuery",staticClass:"quick-search-input4",attrs:{autofocus:"",type:"text",placeholder:"Search"},domProps:{value:_vm.searchKey},on:{keyup:_vm.quickSearch,input:function($event){$event.target.composing||(_vm.searchKey=$event.target.value)}}}),_c("svg",{staticClass:"close-icon4",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 32 32","aria-hidden":"true"},on:{click:_vm.closeSearch}},[_c("title",[_vm._v("close")]),_c("path",{attrs:{d:"M17.992 16l8.796-8.796a1.409 1.409 0 0 0-1.992-1.992L16 14.008 7.204 5.212a1.409 1.409 0 0 0-1.992 1.992L14.008 16l-8.796 8.796a1.409 1.409 0 0 0 1.992 1.992L16 17.992l8.796 8.796a1.409 1.409 0 0 0 1.992-1.992L17.992 16z"}})])])])]):_vm._e(),_c("div",{staticClass:"building-analysis-side-block"},[_c("div",{staticClass:"building-hover-actions"},[_c("div",{staticClass:"sidebar-asset-H fL",staticStyle:{cursor:"pointer"},on:{click:_vm.loadAssetCategories}},[_vm._v(" Assets ")])]),"assets"===_vm.config.mainPanel.currentModule?_c("div",{staticClass:"building-anlysis-active-block"},[_vm._l(_vm.config.mainPanel.assetCategories,(function(category,index){return _vm.config.mainPanel.assetCategories&&_vm.config.mainPanel.assetCategories.length?_c("div",{key:index,class:["building-anlysis-label-txt","clearboth",{"asset-list-block-txt-active":_vm.config.mainPanel.selectedAssetCategory===category.id}],on:{click:function($event){return _vm.openAssetCategory(category.id)}}},[_c("i",{class:{"fa fa-circle":!0,"dot-blue-icon":_vm.config.mainPanel.selectedAssetCategory===category.id,"dot-grey-icon":_vm.config.mainPanel.selectedAssetCategory!=category.id},attrs:{"aria-hidden":"true"}}),_c("div",{staticClass:"width80"},[_vm._v(_vm._s(category.displayName))])]):_vm._e()})),_vm.config.mainPanel.assetCategoriesLoading?_c("spinner",{staticClass:"clearboth",attrs:{show:_vm.config.mainPanel.assetCategoriesLoading}}):_vm.config.mainPanel.assetCategories.length?_vm._e():_c("div",{staticClass:"building-anlysis-label-txt clearboth"},[_vm._v(" -- No assets -- ")])],2):_vm._e()]),_c("div",{staticClass:"building-analysis-side-block"},[_c("div",{staticClass:"building-hover-actions"},[_c("div",{staticClass:"sidebar-asset-H fL",staticStyle:{cursor:"pointer"},on:{click:_vm.loadSpaceReadings}},[_vm._v(" Spaces ")])])]),_vm.isSiteAnalysis?_vm._e():_c("div",{staticClass:"building-analysis-side-block"},[_c("div",{staticClass:"building-hover-actions"},[_c("div",{staticClass:"sidebar-asset-H fL",staticStyle:{cursor:"pointer"},on:{click:_vm.weatherPanelToggler}},[_vm._v(" Weather ")]),_vm.weatherPanel.show?_c("div",{attrs:{lass:"building-anlysis-active-block"}},_vm._l(_vm.weatherModules,(function(weatherModule,wIdx){return _c("div",{key:wIdx,class:["pointer","building-anlysis-label-txt","clearboth",{"asset-list-block-txt-active":_vm.weatherPanel.weatherCategory&&weatherModule.displayName===_vm.weatherPanel.weatherCategory.displayName}],on:{click:function($event){return _vm.loadWeatherReadings(weatherModule)}}},[_c("i",{class:{"fa fa-circle":!0,"dot-blue-icon":!0===weatherModule.selected,"dot-grey-icon":!1===weatherModule.selected},attrs:{"aria-hidden":"true"}}),_c("div",{staticClass:"width80"},[_vm._v(_vm._s(weatherModule.displayName))])])})),0):_vm._e()])]),_c("div",{staticClass:"building-analysis-side-block"},[_c("div",{staticClass:"building-hover-actions"},[_c("div",{staticClass:"sidebar-asset-H fL",staticStyle:{cursor:"pointer"},on:{click:_vm.loadEnPIReadings}},[_vm._v(" EnPI ")])])])])]):_c("div",[_vm._v(" No buildings selected. ")]),_vm.config.assetPointsPanel.show?_c("div",{staticClass:"assets-points-Scontainer assets-points-Scontainer-lalign"},[_c("div",{staticClass:"assets-points-inner-container"},[_c("el-tabs",{on:{"tab-click":function($event){return _vm.openAssetCategory(_vm.config.mainPanel.selectedAssetCategory)}},model:{value:_vm.config.assetPointsPanel.activeSubTab,callback:function($$v){_vm.$set(_vm.config.assetPointsPanel,"activeSubTab",$$v)},expression:"config.assetPointsPanel.activeSubTab"}},[_c("el-tab-pane",{attrs:{label:"Points",name:"points"}},[_c("span",{attrs:{slot:"label"},slot:"label"},[_c("img",{staticStyle:{position:"relative",top:"4px",right:"7px"},attrs:{src:__webpack_require__(587758),width:"18px",height:"18px"}}),_vm._v("Points")]),_c("div",{staticClass:"building-points-search"},[_c("el-input",{attrs:{placeholder:"Filter points",autofocus:""},model:{value:_vm.config.assetPointsPanel.filterQuery,callback:function($$v){_vm.$set(_vm.config.assetPointsPanel,"filterQuery",$$v)},expression:"config.assetPointsPanel.filterQuery"}})],1),_c("div",{staticClass:"asset-list-container mT10"},[_vm.config.assetPointsPanel.loading?_c("spinner",{attrs:{show:_vm.config.assetPointsPanel.loading}}):_vm.config.assetPointsPanel.data&&_vm.config.assetPointsPanel.data.length?_vm._l(_vm.filteredAssetPointsPanel,(function(item,index){return _c("div",{key:index,staticClass:"asset-list-block-txt",class:{"asset-list-block-txt-active":_vm.config.assetPointsPanel.selectedAssetOrPoint===item.id},on:{click:function($event){return _vm.openPoint(item.id,item.displayName)}}},[_c("div",{staticClass:"asset-active-select-item"},[_vm._v(" "+_vm._s(item.displayName?item.displayName:item.name)+" ")])])})):_c("div",{staticClass:"asset-list-block-txt text-center"},[_vm._v(" No points found. ")])],2)]),_c("el-tab-pane",{attrs:{label:"Assets",name:"assets"}},[_c("span",{attrs:{slot:"label"},slot:"label"},[_c("img",{staticStyle:{position:"relative",top:"4px",right:"8px"},attrs:{src:__webpack_require__(134105),width:"16px",height:"16px"}}),_vm._v("Assets")]),_c("div",{staticClass:"building-points-search"},[_c("el-input",{attrs:{placeholder:"Filter assets",autofocus:""},model:{value:_vm.config.assetPointsPanel.filterQuery,callback:function($$v){_vm.$set(_vm.config.assetPointsPanel,"filterQuery",$$v)},expression:"config.assetPointsPanel.filterQuery"}})],1),_c("div",{staticClass:"asset-list-container mT10"},[_vm.config.assetPointsPanel.loading?_c("spinner",{attrs:{show:_vm.config.assetPointsPanel.loading}}):_vm.config.assetPointsPanel.data&&_vm.config.assetPointsPanel.data.length?_vm._l(_vm.filteredAssetPointsPanel,(function(item,index){return _c("div",{key:index,staticClass:"asset-list-block-txt",class:{"asset-list-block-txt-active":_vm.config.assetPointsPanel.selectedAssetOrPoint===item.id},on:{click:function($event){return _vm.openAsset(item.id,item.name)}}},[_c("div",{staticClass:"asset-active-select-item"},[_vm._v(" "+_vm._s(item.name?item.name:item.displayName)+" ")])])})):_c("div",{staticClass:"asset-list-block-txt text-center"},[_vm._v(" No assets found. ")])],2)])],1)],1)]):_vm._e(),_vm.config.selectReadingsPanel.show?_c("div",{staticClass:"assets-points-Scontainer assets-points-Scontainer-shadow"},[_c("div",[_c("div",{staticClass:"assets-points-inner-container readings-list-container"},[_vm._m(1),_c("div",{staticClass:"building-points-search building-points-height"},[_c("el-input",{attrs:{placeholder:"Filter readings",autofocus:""},model:{value:_vm.config.selectReadingsPanel.filterQuery,callback:function($$v){_vm.$set(_vm.config.selectReadingsPanel,"filterQuery",$$v)},expression:"config.selectReadingsPanel.filterQuery"}})],1),_c("div",{staticClass:"asset-list-container mT10"},[_vm.config.selectReadingsPanel.loading?_c("spinner",{attrs:{show:_vm.config.selectReadingsPanel.loading}}):_vm.config.selectReadingsPanel.data&&_vm.config.selectReadingsPanel.data.length?_vm._e():_c("div",{staticClass:"text-center"},[_vm._v(" No data found. ")]),_vm._l(_vm.filteredReadingsPanel,(function(item,index){return _c("div",{key:index,staticClass:"asset-list-block-txt",on:{click:function($event){_vm.selectDataPoint(item.id+"_"+_vm.config.selectReadingsPanel.parentId),_vm.apply(item.displayName?item.displayName:item.name)}}},[_vm._v(" "+_vm._s(item.displayName?item.displayName:item.name)+" "),_vm.config.mainPanel.selectedDataPoints[0]===item.id+"_"+_vm.config.selectReadingsPanel.parentId?_c("i",{staticClass:"el-icon-check heatmap-icon"}):_vm._e()])}))],2)])])]):_vm._e(),_vm.config.selectAssetsPanel.show?_c("div",{staticClass:"assets-points-Scontainer assets-points-Scontainer-shadow"},[_c("div",[_c("div",{staticClass:"assets-points-inner-container readings-list-container"},[_vm._m(2),_c("div",{staticClass:"building-points-search building-points-height"},[_c("el-input",{attrs:{placeholder:"Filter assets",autofocus:""},model:{value:_vm.config.selectAssetsPanel.filterQuery,callback:function($$v){_vm.$set(_vm.config.selectAssetsPanel,"filterQuery",$$v)},expression:"config.selectAssetsPanel.filterQuery"}})],1),_c("div",{staticClass:"asset-list-container mT10"},[_vm.config.selectAssetsPanel.loading?_c("spinner",{attrs:{show:_vm.config.selectAssetsPanel.loading}}):_vm.config.selectAssetsPanel.data&&_vm.config.selectAssetsPanel.data.length?_vm._e():_c("div",{staticClass:"text-center"},[_vm._v(" No data found. ")]),_vm._l(_vm.filteredAssetsPanel,(function(item,index){return _c("div",{key:index,staticClass:"asset-list-block-txt",on:{click:function($event){_vm.selectDataPoint(_vm.config.selectAssetsPanel.readingId+"_"+item.id),_vm.apply(item.displayName?item.displayName:item.name)}}},[_vm._v(" "+_vm._s(item.displayName?item.displayName:item.name)+" "),_vm.config.mainPanel.selectedDataPoints[0]===_vm.config.selectAssetsPanel.readingId+"_"+item.id?_c("i",{staticClass:"el-icon-check heatmap-icon"}):_vm._e()])}))],2)])])]):_vm._e()])]),_c("el-dialog",{staticClass:"fc-dialog-center-container",attrs:{visible:_vm.deleteRangePoint,title:"Delete Range point",width:"40%","append-to-body":!0,"show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function($event){_vm.deleteRangePoint=$event},keydown:function($event){if(!$event.type.indexOf("key")&&_vm._k($event.keyCode,"esc",27,$event.key,["Esc","Escape"]))return null;_vm.deleteRangePoint=!1}}},[_c("div",{staticClass:"height200"},[_c("div",[_vm._v(" This datapoint is part of a range group. Deleting it, removes the range group. ")]),_c("div",[_vm._v("Are you sure you want to delete it?")]),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.cancelRangeDeletion}},[_vm._v("Close")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary"},on:{click:_vm.deleteRangePoints}},[_vm._v("Delete")])],1)])])],1):_vm._e()},staticRenderFns=[function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{},[_c("i",{staticClass:"el-icon-close"})])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"select-reading-header"},[_c("div",{staticClass:"select-reading-H"},[_vm._v(" SELECT READINGS ")])])},function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"select-reading-header"},[_c("div",{staticClass:"select-reading-H"},[_vm._v(" SELECT ASSETS ")])])}],toConsumableArray=__webpack_require__(488478),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),createForOfIteratorHelper=__webpack_require__(566347),objectSpread2=__webpack_require__(595082),AnalayticsFilter=(__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(919649),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(670560),__webpack_require__(228436),__webpack_require__(434284),__webpack_require__(976801),__webpack_require__(648324),__webpack_require__(843843),__webpack_require__(169358),__webpack_require__(162506),__webpack_require__(450886),__webpack_require__(425728),__webpack_require__(947522),__webpack_require__(398758)),vuex_esm=__webpack_require__(420629),api=__webpack_require__(32284),picklist=__webpack_require__(961358),FHeatMapPointSelectorvue_type_script_lang_js={props:["visibility","zones","isSiteAnalysis","savedPoints","reportObject"],data:function(){return{config:{mainPanel:{currentModule:"",assetCategories:null,assetCategoriesLoading:!1,selectedAssetCategory:null,selectedDataPoints:[]},assetPointsPanel:{show:!1,activeSubTab:"points",data:null,loading:!0,selectedAssetOrPoint:null,filterQuery:""},selectReadingsPanel:{show:!1,data:null,loading:!1,parentId:null,filterQuery:""},selectAssetsPanel:{show:!1,data:null,loading:!1,readingId:null,filterQuery:""}},weatherPanel:{show:!1,weatherCategory:null},selectedDataPoints:[],loading:!0,readings:{categories:[],assets:{},categoryWithAssets:{},fields:{},categoryWithFields:{}},showQuickSearch:!1,quickSearchQuery:null,selectedBuildings:[],weatherModules:[{displayName:"Live Weather",moduleName:"weather",selected:!1},{displayName:"Daily Weather",moduleName:"weatherDaily",selected:!1},{displayName:"Degree Days",selected:!1},{displayName:"Psychrometric",moduleName:"psychrometric",selected:!1}],deleteRangePoint:!1,rangePointConfirmation:!1,pointDeletionStore:{},summaryList:[],allFields:{assets:[]},currentKey:0,siteId:null,readingName:"",assetName:"",urlParams:{perPage:50,page:1,viewName:"hidden-all"},default_building_id:null,selectedBuildingLabel:this.isSiteAnalysis?"No Sites":"No Buildings"}},components:{AnalayticsFilter:AnalayticsFilter/* default */.Z},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetCategory:function(state){return state.assetCategory}})),{},{isRangeModeEnabled:function(){if("undefined"!==typeof this.reportObject&&null!==this.reportObject){var dP=this.reportObject.options.dataPoints.filter((function(point){return"rangeGroup"===point.type}));return 0!==dP.length}return!1},moreThanOneLocation:function(){var locationSet=new Set;if(0!==this.summaryList.length){var _step,_iterator=(0,createForOfIteratorHelper/* default */.Z)(this.summaryList);try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step2,group=_step.value,_iterator2=(0,createForOfIteratorHelper/* default */.Z)(group.readings);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var reading=_step2.value;locationSet.add(reading.location)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return locationSet.size>1}return!1},showFourthPanel:function(){return 0!==this.summaryList.length&&(0!==this.config.mainPanel.selectedDataPoints.length||0===this.summaryList.length||(this.addToSummaryListNew(),!1))},buildingIds:function(){if(this.selectedBuildings&&this.selectedBuildings.length){var _step3,buildingIds=[],_iterator3=(0,createForOfIteratorHelper/* default */.Z)(this.selectedBuildings);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var sb=_step3.value;buildingIds.push(parseInt(sb))}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return buildingIds}return null},selectedBuildingName:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _yield$getFieldValue,data,error,value,_yield$getFieldValue2,_data,_error,_value;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(!_this.selectedBuildings||!_this.selectedBuildings.length){_context.next=18;break}if(1!==_this.selectedBuildings.length){_context.next=18;break}if(!_this.selectedBuildings[0]||_this.isSiteAnalysis){_context.next=11;break}return _context.next=5,(0,picklist/* getFieldValue */.oe)({lookupModuleName:"building",selectedOptionId:[_this.selectedBuildings[0]]});case 5:_yield$getFieldValue=_context.sent,data=_yield$getFieldValue.data,error=_yield$getFieldValue.error,!error&&data&&(value=_this.$getProperty(data,"0.label"),_this.selectedBuildingLabel=value),_context.next=18;break;case 11:if(!_this.selectedBuildings[0]||!_this.isSiteAnalysis){_context.next=18;break}return _context.next=14,(0,picklist/* getFieldValue */.oe)({lookupModuleName:"site",selectedOptionId:[_this.selectedBuildings[0]]});case 14:_yield$getFieldValue2=_context.sent,_data=_yield$getFieldValue2.data,_error=_yield$getFieldValue2.error,!_error&&_data&&(_value=_this.$getProperty(_data,"0.label"),_this.selectedBuildingLabel=_value);case 18:case"end":return _context.stop()}}),_callee)})))()},filteredAssetPointsPanel:function(){var self=this;return this.config.assetPointsPanel.data&&this.config.assetPointsPanel.data.length?this.config.assetPointsPanel.filterQuery&&this.config.assetPointsPanel.filterQuery.trim().length?this.config.assetPointsPanel.data.filter((function(d){var name=d.displayName?d.displayName:d.name;if(name.toLowerCase().indexOf(self.config.assetPointsPanel.filterQuery.toLowerCase())>=0&&!["BOOLEAN","ENUM"].includes(d.dataTypeEnum))return d})):this.config.assetPointsPanel.data.filter((function(d){if(!["BOOLEAN","ENUM"].includes(d.dataTypeEnum))return d})):[]},filteredReadingsPanel:function(){var self=this;return this.config.selectReadingsPanel.data&&this.config.selectReadingsPanel.data.length?this.config.selectReadingsPanel.filterQuery&&this.config.selectReadingsPanel.filterQuery.trim().length?this.config.selectReadingsPanel.data.filter((function(d){var name=d.displayName?d.displayName:d.name;if(name.toLowerCase().indexOf(self.config.selectReadingsPanel.filterQuery.toLowerCase())>=0&&!["BOOLEAN","ENUM"].includes(d.dataTypeEnum))return d})):this.config.selectReadingsPanel.data.filter((function(d){if(!["BOOLEAN","ENUM"].includes(d.dataTypeEnum))return d})):[]},filteredAssetsPanel:function(){var self=this;return this.config.selectAssetsPanel.data&&this.config.selectAssetsPanel.data.length?this.config.selectAssetsPanel.filterQuery&&this.config.selectAssetsPanel.filterQuery.trim().length?this.config.selectAssetsPanel.data.filter((function(d){var name=d.displayName?d.displayName:d.name;if(name.toLowerCase().indexOf(self.config.selectAssetsPanel.filterQuery.toLowerCase())>=0)return d})):this.config.selectAssetsPanel.data:[]}}),watch:{buildingIds:function(newVal,oldVal){JSON.stringify(newVal)!==JSON.stringify(oldVal)&&(this.loadAssetCategories(),this.resetResetReadings())},selectedBuildingName:function(){var _selectedBuildingName=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(newVal){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.selectedBuildingName;case 2:this.$emit("selectBuildings",{name:this.selectedBuildingLabel,ids:this.selectedBuildings});case 3:case"end":return _context2.stop()}}),_callee2,this)})));function selectedBuildingName(_x){return _selectedBuildingName.apply(this,arguments)}return selectedBuildingName}(),"config.mainPanel.selectedDataPoints":{handler:function(newVal,oldVal){0===newVal.length||null!==this.savedPoints&&"undefined"!==typeof this.savedPoints||this.addToSummaryListNew()},deep:!0},savedPoints:function(newValue,oldVal){newValue&&JSON.stringify(newValue)!==JSON.stringify(oldVal)&&this.config.mainPanel.assetCategories&&this.prepareSavedDataPoints()}},mounted:function(){this.setDefaultSelection()},created:function(){var _this2=this;Promise.all([this.$store.dispatch("loadAssetCategory"),this.loadDefaultBuilding()]).then((function(){_this2.setDefaultSelection()}))},methods:{loadDefaultBuilding:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var _yield$API$get,data,error,_yield$API$get2,_data2,_error2;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(_this3.isSiteAnalysis){_context3.next=9;break}return _context3.next=3,api/* API */.bl.get("/v3/picklist/building",_this3.urlParams,{force:!0});case 3:_yield$API$get=_context3.sent,data=_yield$API$get.data,error=_yield$API$get.error,!error&&(null===data||void 0===data?void 0:data.pickList.length)>0&&(_this3.default_building_id=data.pickList[0].value),_context3.next=15;break;case 9:return _context3.next=11,api/* API */.bl.get("/v3/picklist/site",_this3.urlParams,{force:!0});case 11:_yield$API$get2=_context3.sent,_data2=_yield$API$get2.data,_error2=_yield$API$get2.error,!_error2&&(null===_data2||void 0===_data2?void 0:_data2.pickList.length)>0&&(_this3.default_building_id=_data2.pickList[0].value);case 15:case"end":return _context3.stop()}}),_callee3)})))()},selectDataPoint:function(datapoint){this.config.mainPanel.selectedDataPoints[0]=datapoint,this.addToBuildingMap(this.config.mainPanel.selectedDataPoints)},addToBuildingMap:function(newVal){var buildingId=this.buildingIds[0];this.config.buildingToReadingMap||(this.config["buildingToReadingMap"]={}),this.config.buildingToReadingMap[buildingId]=newVal},checkForRangePoints:function(newVal){if(this.addToBuildingMap(newVal),this.reportObject&&0!==this.summaryList.length){var rangeGroups=this.reportObject.options.dataPoints.filter((function(dP){return"rangeGroup"===dP.type}));if(0!==rangeGroups.length){var _step4,inRangeGroup=new Set,_iterator4=(0,createForOfIteratorHelper/* default */.Z)(rangeGroups);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _step6,rGroup=_step4.value,_iterator6=(0,createForOfIteratorHelper/* default */.Z)(rGroup.children);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var child=_step6.value;inRangeGroup.add(child.fieldId+"_"+child.parentId),this.pointDeletionStore["readingId"]=child.fieldId,this.pointDeletionStore["resourceId"]=child.parentId}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}var _step5,_iterator5=(0,createForOfIteratorHelper/* default */.Z)(inRangeGroup);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var inPoint=_step5.value;if(!newVal.includes(inPoint))return void(this.deleteRangePoint=!0)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}}},getAllSummaryDataPoints:function(){var allDataPoints=[];if(this.summaryList)for(var key in this.summaryList)allDataPoints.push.apply(allDataPoints,(0,toConsumableArray/* default */.Z)(this.summaryList[key].readings));return allDataPoints},convertToList:function(readings){var _step7,readingsObject={},_iterator7=(0,createForOfIteratorHelper/* default */.Z)(readings);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var reading=_step7.value;readingsObject[reading.id]=reading}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return readingsObject},cancelRangeDeletion:function(){this.pointDeletionStore={};var _step8,dataPoints=[],_iterator8=(0,createForOfIteratorHelper/* default */.Z)(this.reportObject.options.dataPoints);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var dp=_step8.value;dp.children&&0!==dp.children.length?dataPoints.push.apply(dataPoints,(0,toConsumableArray/* default */.Z)(JSON.parse(JSON.stringify(dp.children)))):dataPoints.push(JSON.parse(JSON.stringify(dp)))}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}for(var _i=0,_dataPoints=dataPoints;_i<_dataPoints.length;_i++){var dataPoint=_dataPoints[_i];dataPoint["aliases"]={},dataPoint.aliases["actual"]=dataPoint.alias,dataPoint["yAxis"]={},dataPoint.yAxis["fieldId"]=dataPoint.fieldId}this.setInitialValues(dataPoints,null,"restoreRange"),this.deleteRangePoint=!1},deleteRangePoints:function(){
// obtain range points
var existingDataPoints=(0,toConsumableArray/* default */.Z)(this.config.mainPanel.selectedDataPoints),readingId=this.pointDeletionStore["readingId"],resourceId=this.pointDeletionStore["resourceId"],tobeDeleted=[];if(this.reportObject){var _step9,_iterator9=(0,createForOfIteratorHelper/* default */.Z)(this.reportObject.options.dataPoints);try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var dP=_step9.value;if("rangeGroup"===dP.type){var inDp=dP.children.filter((function(rDp){return rDp.fieldId===readingId&&rDp.parentId===resourceId}));if(0!==inDp.length){tobeDeleted.push.apply(tobeDeleted,(0,toConsumableArray/* default */.Z)(dP.children));break}}}
// to reduce dataPoints
}catch(err){_iterator9.e(err)}finally{_iterator9.f()}var _step10,toBeDeleted=this.reduceDataPoints(tobeDeleted),_iterator10=(0,createForOfIteratorHelper/* default */.Z)(toBeDeleted);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var dataPoint=_step10.value,index=existingDataPoints.indexOf(dataPoint.fieldId+"_"+dataPoint.parentId);-1!==index&&existingDataPoints.splice(index,1)}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}this.config.mainPanel.selectedDataPoints=existingDataPoints,this.addToSummaryListNew(),this.deleteRangePoint=!1}},reduceDataPoints:function(toBeDeletedDataPoints){var uniqueKeys=new Set;return toBeDeletedDataPoints.map((function(dp){return uniqueKeys.add(dp.fieldId+"."+dp.parentId)})),1===uniqueKeys.size?[toBeDeletedDataPoints[0]]:toBeDeletedDataPoints},prepareSavedDataPoints:function(){var _this4=this;if(this.savedPoints&&"undefined"!==typeof this.savedPoints){var _this$summaryList,points=(0,toConsumableArray/* default */.Z)(this.savedPoints);this.currentKey=this.currentKey+1;var _step11,_iterator11=(0,createForOfIteratorHelper/* default */.Z)(this.savedPoints);try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var _step13,group=_step11.value,_iterator13=(0,createForOfIteratorHelper/* default */.Z)(group.readings);try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var reading=_step13.value;reading.marked=this.currentKey}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}this.summaryList=[];var assetReadings=points.filter((function(group){return"Asset"===group.label})),assetGroupIndex=points.indexOf(assetReadings[0]);if(0!==assetReadings.length){var _step12,_iterator12=(0,createForOfIteratorHelper/* default */.Z)(assetReadings[0].readings);try{var _loop=function(){var inReading=_step12.value,assetCategory=inReading.categoryId?inReading.categoryId:-1,assetCategoryLabel=_this4.assetCategory.filter((function(category){return category.id===parseInt(assetCategory)}));if(0!==assetCategoryLabel.length&&(assetCategoryLabel=assetCategoryLabel[0].displayName,_this4.addAssetToGroup(assetCategoryLabel,inReading,assetCategory)),_this4.config.mainPanel.assetCategories){var category=_this4.config.mainPanel.assetCategories.filter((function(categories){return categories.id===parseInt(assetCategory)}));if(0!==category.length){_this4.openAssetCategory(assetCategory);var self=_this4;_this4.$nextTick().then((function(){if("undefined"!==typeof self.readings.categoryWithFields[assetCategory]){var asset=self.readings.categoryWithFields[assetCategory][inReading.readingId];asset&&self.openPoint(inReading.readingId)}}))}}};for(_iterator12.s();!(_step12=_iterator12.n()).done;)_loop()}catch(err){_iterator12.e(err)}finally{_iterator12.f()}}-1!==assetGroupIndex&&points.splice(assetGroupIndex,1),(_this$summaryList=this.summaryList).push.apply(_this$summaryList,(0,toConsumableArray/* default */.Z)(points)),this.savedPoints=null}},addAssetToGroup:function(label,reading,assetCategory){if(this.summaryList&&0===this.summaryList.length){var temp={};temp["label"]=label,temp["categoryId"]=assetCategory,temp["readings"]=[],temp.readings.push(reading),this.summaryList.push(temp)}else if(this.summaryList&&this.summaryList.length>0){var readingGroup=this.summaryList.filter((function(group){return group.label===label}));if(0!==readingGroup.length)readingGroup[0].readings.push(reading);else{var _temp={};_temp["label"]=label,_temp["categoryId"]=assetCategory,_temp["readings"]=[],_temp.readings.push(reading),this.summaryList.push(_temp)}}},getRangeGroup:function(reading){if(this.reportObject){var _step14,_iterator14=(0,createForOfIteratorHelper/* default */.Z)(this.reportObject.options.dataPoints);try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var dataPoint=_step14.value;if("rangeGroup"===dataPoint.type&&dataPoint.children){var _step15,_iterator15=(0,createForOfIteratorHelper/* default */.Z)(dataPoint.children);try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var child=_step15.value;if(child.fieldId===reading.readingId&&child.parentId===reading.resourceId)return!0}}catch(err){_iterator15.e(err)}finally{_iterator15.f()}}}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}}},removeDataPointFromGroup:function(reading,readingGroupIndex){if(this.isRangeModeEnabled){
// to find range point
var isRangePoint=this.getRangeGroup(reading);isRangePoint?(this.deleteRangePoint=!0,this.pointDeletionStore["readingId"]=reading.readingId,this.pointDeletionStore["resourceId"]=reading.resourceId):this.removePoint(reading,readingGroupIndex)}else this.removePoint(reading,readingGroupIndex)},removePoint:function(reading,readingGroupIndex){var readingGroup=this.summaryList[readingGroupIndex],readingSumId=reading.readingId+"_"+reading.resourceId;this.config.mainPanel.selectedDataPoints.splice(this.config.mainPanel.selectedDataPoints.indexOf(readingSumId),1);var readingIndex=readingGroup.readings.indexOf(reading);readingGroup.readings.splice(readingIndex,1),0===readingGroup.readings.length&&this.summaryList.splice(readingGroupIndex,1)},isSummaryEmpty:function(id,isAsset){if(0===this.summaryList.length)return!0;if(isAsset){var filteredGroup=this.summaryList.filter((function(pointGroup){return pointGroup.categoryId&&pointGroup.categoryId===id}));return 0===filteredGroup.length}var _filteredGroup=this.summaryList.filter((function(pointGroup){return pointGroup.label===id}));return 0===_filteredGroup.length},getCategoryFromId:function(reading){var readingSplit=reading.split("_"),assetObject=this.readings.assets[parseInt(readingSplit[readingSplit.length-1])];return this.buildingIds[0]===parseInt(readingSplit[1])?"":assetObject?"assets":"weather"},addToSummaryListNew:function(){var _this5=this,existingReadings=[],points=[];if(this.config.mainPanel.selectedDataPoints&&0!==this.config.mainPanel.selectedDataPoints.length){var _step16,_iterator16=(0,createForOfIteratorHelper/* default */.Z)(this.config.mainPanel.selectedDataPoints);try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var point=_step16.value,temp={point:point,isDone:!1};points.push(temp)}}catch(err){_iterator16.e(err)}finally{_iterator16.f()}if(0!==this.summaryList.length){this.currentKey=this.currentKey+1;var _step17,_iterator17=(0,createForOfIteratorHelper/* default */.Z)(this.summaryList);try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var _step19,group=_step17.value,_iterator19=(0,createForOfIteratorHelper/* default */.Z)(group.readings);try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var reading=_step19.value;existingReadings.push(reading)}}catch(err){_iterator19.e(err)}finally{_iterator19.f()}}}catch(err){_iterator17.e(err)}finally{_iterator17.f()}var _step18,_iterator18=(0,createForOfIteratorHelper/* default */.Z)(points);try{var _loop2=function(){var dataPoint=_step18.value,readingSplit=dataPoint.point.split("_"),readingId=parseInt(readingSplit[0]),resourceId=parseInt(readingSplit[readingSplit.length-1]),reading=existingReadings.filter((function(element){return element.readingId+"_"+element.resourceId===readingId+"_"+resourceId}));if(0===reading.length)return 1;// continue
reading[0].marked=_this5.currentKey,dataPoint.isDone=!0};for(_iterator18.s();!(_step18=_iterator18.n()).done;)_loop2()}catch(err){_iterator18.e(err)}finally{_iterator18.f()}}this.removeUnwantedReadings();var notInserted=points.filter((function(point){return!1===point.isDone}));if(0!==notInserted.length){var _step20,_iterator20=(0,createForOfIteratorHelper/* default */.Z)(notInserted);try{var _loop3=function(){var nInsert=_step20.value,readingSplit=nInsert.point.split("_"),category=_this5.getCategoryFromId(nInsert.point),readingObject=null;category&&""!==category&&(readingObject=_this5.allFields[category][parseInt(readingSplit[0])]);var categoryLabel=null,categoryId=null;if("assets"===category){for(var _i2=0,_Object$keys=Object.keys(_this5.readings.categoryWithAssets);_i2<_Object$keys.length;_i2++){var cat=_Object$keys[_i2];if(Object.keys(_this5.readings.categoryWithAssets[cat]).includes(readingSplit[readingSplit.length-1])){categoryId=parseInt(cat);break}categoryId=-1}categoryLabel=_this5.config.mainPanel.assetCategories.filter((function(categories){return categories.id===categoryId}))[0].name}else if("weather"===category){var _step21,_iterator21=(0,createForOfIteratorHelper/* default */.Z)(_this5.summaryList);try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var _step22,_group=_step21.value,_iterator22=(0,createForOfIteratorHelper/* default */.Z)(_group.readings);try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var _reading=_step22.value;if(_reading.readingId+"_"+_reading.resourceId===readingSplit[0]+"_"+readingSplit[1]){categoryLabel=_group.label;break}}}catch(err){_iterator22.e(err)}finally{_iterator22.f()}}}catch(err){_iterator21.e(err)}finally{_iterator21.f()}categoryLabel||(categoryLabel=_this5.weatherModules.filter((function(wModule){return wModule&&wModule.moduleName===readingObject.module})),categoryLabel=0===categoryLabel.length?"Degree Days":categoryLabel[0].displayName)}else 0!==_this5.allFields.length&&(_this5.allFields["space"]&&"undefined"!==typeof _this5.allFields["space"][parseInt(readingSplit[0])]?(readingObject=_this5.allFields["space"][parseInt(readingSplit[0])],categoryLabel="Space"):(readingObject=_this5.allFields["enpi"][parseInt(readingSplit[0])],categoryLabel="Enpi"));var existingGroup=_this5.summaryList.filter((function(inGroup){return inGroup.label===categoryLabel}));if(0===_this5.summaryList.length||0===existingGroup.length){var _reading2={};_reading2["readingId"]=parseInt(readingSplit[0]),_reading2["readingLabel"]=readingObject.displayName,_reading2["resourceId"]=parseInt(readingSplit[readingSplit.length-1]),_reading2["resourceLabel"]="assets"===category?_this5.readings.assets[parseInt(readingSplit[readingSplit.length-1])]:null,_reading2["location"]=_this5.selectedBuildingLabel,_reading2["marked"]=_this5.currentKey;var temp={};temp["label"]=categoryLabel,temp["readings"]=[],"assets"===category&&(temp["categoryId"]=categoryId),temp.readings.push(_reading2),_this5.summaryList.push(temp)}else{var _reading3={};_reading3["readingId"]=parseInt(readingSplit[0]),_reading3["readingLabel"]=readingObject.displayName,_reading3["resourceId"]=parseInt(readingSplit[readingSplit.length-1]),_reading3["resourceLabel"]="assets"===category?_this5.readings.assets[parseInt(readingSplit[readingSplit.length-1])]:null,_reading3["location"]=_this5.selectedBuildingLabel,_reading3["marked"]=_this5.currentKey,existingGroup[0].readings.push(_reading3)}nInsert.isDone=!0};for(_iterator20.s();!(_step20=_iterator20.n()).done;)_loop3()}catch(err){_iterator20.e(err)}finally{_iterator20.f()}}}},removeUnwantedReadings:function(){var _step23,_iterator23=(0,createForOfIteratorHelper/* default */.Z)(this.summaryList);try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var _step24,group=_step23.value,_iterator24=(0,createForOfIteratorHelper/* default */.Z)(group.readings);try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var reading=_step24.value;if(reading&&reading.marked!==this.currentKey){var readingIndex=group.readings.indexOf(reading);group.readings.splice(readingIndex,1)}0===group.readings.length&&this.summaryList.splice(this.summaryList.indexOf(group),1)}}catch(err){_iterator24.e(err)}finally{_iterator24.f()}}}catch(err){_iterator23.e(err)}finally{_iterator23.f()}},weatherPanelToggler:function(){this.weatherPanel.show?this.weatherPanel.show=!1:this.weatherPanel.show=!0},weatherModuleHandler:function(weatherModule,readings){if(weatherModule.moduleName){var _step25,filtered=[],_iterator25=(0,createForOfIteratorHelper/* default */.Z)(readings);try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var reading=_step25.value;reading.module===weatherModule.moduleName&&filtered.push(reading)}}catch(err){_iterator25.e(err)}finally{_iterator25.f()}return filtered}var _step26,_filtered=[],_iterator26=(0,createForOfIteratorHelper/* default */.Z)(readings);try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var _reading4=_step26.value;"cdd"!==_reading4.module&&"hdd"!==_reading4.module&&"wdd"!==_reading4.module||_filtered.push(_reading4)}}catch(err){_iterator26.e(err)}finally{_iterator26.f()}return _filtered},setDefaultSelection:function(){this.selectedBuildings=[],this.default_building_id&&(this.selectedBuildings=[this.default_building_id])},setSelectedBuildings:function(selectedBuildings){this.selectedBuildings=selectedBuildings},toggleQuickSearch:function(){var _this6=this;this.showQuickSearch=!this.showQuickSearch,this.showQuickSearch&&this.$nextTick((function(){_this6.$refs.quickSearchQuery.focus()}))},closeSearch:function(){this.toggleQuickSearch(),this.quickSearchQuery=null,this.quickSearch()},loadAssetCategories:function(){var self=this;self.weatherPanel.show=!1,self.weatherPanel.weatherCategory=null;var _step27,_iterator27=(0,createForOfIteratorHelper/* default */.Z)(self.weatherModules);try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var module=_step27.value;module.selected=!1}}catch(err){_iterator27.e(err)}finally{_iterator27.f()}if("assets"!==self.config.mainPanel.currentModule){self.config.mainPanel.currentModule="assets",self.config.mainPanel.selectedAssetCategory=null,self.config.mainPanel.assetCategories=null,self.config.mainPanel.assetCategoriesLoading=!0;var panels=[];self.config["assetPointsPanel"].show&&panels.push("assetPointsPanel"),self.config["selectReadingsPanel"].show&&panels.push("selectReadingsPanel"),self.config["selectAssetsPanel"].show&&panels.push("selectAssetsPanel"),self.togglePanel(panels),self.$http.post("/asset/getAssetCategoryWithReadings",{buildingIds:self.buildingIds}).then((function(response){var categoryIds=Object.keys(response.data);self.assetCategory&&(self.config.mainPanel.assetCategories=self.assetCategory.filter((function(ele){for(var index=0;index<categoryIds.length;index++){var element=categoryIds[index];if(parseInt(element)===ele.id)return ele.toggle=!1,ele}}))),self.config.mainPanel.assetCategoriesLoading=!1,self.loading=!1,self.savedPoints&&"undefined"!==typeof self.savedPoints&&0!==self.savedPoints.length&&self.prepareSavedDataPoints()}))}else self.config.mainPanel.currentModule=""},resetResetReadings:function(){this.readings={categories:[],assets:{},categoryWithAssets:{},fields:{},categoryWithFields:{}}},removeSelectedDataPoint:function(dataPoint,index){this.config.mainPanel.selectedDataPoints.splice(index,1)},togglePanel:function(){for(var self=this,configKeys=Object.keys(self.config),_len=arguments.length,panels=new Array(_len),_key=0;_key<_len;_key++)panels[_key]=arguments[_key];for(var _i3=0,_configKeys=configKeys;_i3<_configKeys.length;_i3++){var configKey=_configKeys[_i3];panels.indexOf(configKey)>=0?self.config[configKey].show=!0:(self.config[configKey].show=!1,self.config[configKey].selectedItem=null)}},openAssetCategory:function(categoryId){var _this7=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var self,assetIds,readingIds;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(self=_this7,self.togglePanel("assetPointsPanel"),self.config.mainPanel.selectedAssetCategory=categoryId,self.config.assetPointsPanel.loading=!0,self.config.assetPointsPanel.selectedAssetOrPoint=null,!self.readings.categories.includes(categoryId)||!self.readings.categoryWithAssets[categoryId]){_context4.next=9;break}"assets"===self.config.assetPointsPanel.activeSubTab?(assetIds=Object.keys(self.readings.categoryWithAssets[categoryId]),self.config.assetPointsPanel.data=assetIds.map((function(el){return{id:el,name:self.readings.assets[el]}})),self.config.assetPointsPanel.loading=!1):(readingIds=Object.keys(self.readings.categoryWithFields[categoryId]),self.config.assetPointsPanel.data=readingIds.map((function(el){return self.readings.fields[el]})),self.config.assetPointsPanel.loading=!1),_context4.next=12;break;case 9:if(!self.buildingIds){_context4.next=12;break}return _context4.next=12,self.$http.post("/asset/getReadingsForSpecificAssetCategory",{buildingIds:self.buildingIds,categoryIds:[categoryId]}).then((function(response){if(self.readings.categories.includes(categoryId)||self.readings.categories.push(categoryId),response.data.categoryWithAssets[categoryId]&&(self.readings.categoryWithAssets[categoryId]=response.data.categoryWithAssets[categoryId]),response.data.categoryWithFields[categoryId]&&(self.readings.categoryWithFields[categoryId]=response.data.categoryWithFields[categoryId]),response.data.fields)for(var _i4=0,_Object$keys2=Object.keys(response.data.fields);_i4<_Object$keys2.length;_i4++){var fieldId=_Object$keys2[_i4];self.readings.fields[fieldId]||(self.readings.fields[fieldId]=response.data.fields[fieldId]),self.allFields["assets"]&&!self.allFields["assets"][fieldId]&&(self.allFields["assets"][fieldId]=response.data.fields[fieldId])}if(response.data.assets)for(var _i5=0,_Object$keys3=Object.keys(response.data.assets);_i5<_Object$keys3.length;_i5++){var assetId=_Object$keys3[_i5];self.readings.assets[assetId]||(self.readings.assets[assetId]=response.data.assets[assetId])}if("assets"===self.config.assetPointsPanel.activeSubTab&&self.readings.categoryWithAssets[categoryId]){var _assetIds=Object.keys(self.readings.categoryWithAssets[categoryId]);self.config.assetPointsPanel.data=_assetIds.map((function(el){return{id:el,name:self.readings.assets[el]}})),self.config.assetPointsPanel.loading=!1}else if(self.readings.categoryWithFields[categoryId]){var _readingIds=Object.keys(self.readings.categoryWithFields[categoryId]);self.config.assetPointsPanel.data=_readingIds.map((function(el){return self.readings.fields[el]})),self.config.assetPointsPanel.loading=!1}else self.config.assetPointsPanel.loading=!1}));case 12:case"end":return _context4.stop()}}),_callee4)})))()},openAsset:function(assetId,assetName){var self=this;self.config.assetPointsPanel.selectedAssetOrPoint=assetId,self.togglePanel("assetPointsPanel","selectReadingsPanel"),self.config.selectReadingsPanel.loading=!0,self.config.selectReadingsPanel.parentId=assetId,assetName&&(self.assetName=assetName);var fieldIds=self.readings.categoryWithAssets[self.config.mainPanel.selectedAssetCategory][assetId];self.config.selectReadingsPanel.data=fieldIds.map((function(el){return self.readings.fields[el]})),self.config.selectReadingsPanel.loading=!1},openPoint:function(pointId,pointName){var self=this;self.config.assetPointsPanel.selectedAssetOrPoint=pointId,self.togglePanel("assetPointsPanel","selectAssetsPanel"),self.config.selectAssetsPanel.loading=!0,self.config.selectAssetsPanel.readingId=pointId,pointName&&(self.readingName=pointName);var assetIds=self.readings.categoryWithFields[self.config.mainPanel.selectedAssetCategory][pointId];self.config.selectAssetsPanel.data=assetIds.map((function(el){return{id:el,name:self.readings.assets[el]}})),self.config.selectAssetsPanel.loading=!1},getReadingFields:function(readings){var _step28,data=[],_iterator28=(0,createForOfIteratorHelper/* default */.Z)(readings);try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var _step29,reading=_step28.value,_iterator29=(0,createForOfIteratorHelper/* default */.Z)(reading.fields);try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var field=_step29.value;field.module=reading.name,data.push(field)}}catch(err){_iterator29.e(err)}finally{_iterator29.f()}}}catch(err){_iterator28.e(err)}finally{_iterator28.f()}return data},loadSpaceReadings:function(){var self=this;self.config.mainPanel.currentModule="spaces",self.togglePanel("selectReadingsPanel"),self.config.selectReadingsPanel.loading=!0,self.config.selectReadingsPanel.parentId=self.buildingIds[0],self.$http.get("/reading/getspacespecificreadings?parentId="+self.buildingIds[0]).then((function(response){self.config.selectReadingsPanel.data=self.getReadingFields(response.data.filter((function(el){
// TODO check whether to show for building analysis also, all readings except enpi
if(self.isSiteAnalysis?7!==el.type:3===el.type)return el}))),self.allFields["space"]=self.convertToList(self.config.selectReadingsPanel.data),self.config.selectReadingsPanel.loading=!1}))},loadWeatherReadings:function(weatherModule){var self=this;self.weatherPanel.weatherCategory=weatherModule;var _step30,_iterator30=(0,createForOfIteratorHelper/* default */.Z)(self.weatherModules);try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var module=_step30.value;module.selected=!1}}catch(err){_iterator30.e(err)}finally{_iterator30.f()}self.config.selectReadingsPanel.loading=!0,self.config.mainPanel.currentModule=weatherModule.moduleName,self.togglePanel("selectReadingsPanel"),weatherModule.selected=!0;var fetchWeatherReadings=function(siteId){self.$http.get("/reading/getspacespecificreadings?excludeForecastReadings=false&parentId="+siteId).then((function(response){self.config.selectReadingsPanel.data=self.weatherModuleHandler(weatherModule,self.getReadingFields(response.data)),self.allFields["weather"]=self.convertToList(self.config.selectReadingsPanel.data),self.config.selectReadingsPanel.loading=!1}))};self.$http.get("/building/"+self.buildingIds[0]).then((function(response){if(response.data.building){var siteId=response.data.building.siteId;self.config.selectReadingsPanel.parentId=siteId,fetchWeatherReadings(siteId)}else self.$http.get("/zone/"+self.buildingIds[0]).then((function(response){if(response.data.zone){var _siteId=response.data.zone.siteId;self.config.selectReadingsPanel.parentId=_siteId,fetchWeatherReadings(_siteId)}}))}))},loadEnPIReadings:function(){var self=this;self.config.mainPanel.currentModule="enpi",self.togglePanel("selectReadingsPanel"),self.config.selectReadingsPanel.loading=!0,self.config.selectReadingsPanel.parentId=self.buildingIds[0],self.$http.get("/reading/getspacespecificreadings?parentId="+self.buildingIds[0]).then((function(response){self.config.selectReadingsPanel.data=self.getReadingFields(response.data.filter((function(el){if(7===el.type)return el}))),self.allFields["enpi"]=self.convertToList(self.config.selectReadingsPanel.data),self.config.selectReadingsPanel.loading=!1}))},cancel:function(){this.$emit("update:visibility",!1)},getBuildingId:function(dp){for(var building in this.config.buildingToReadingMap){var dataPoint=this.config.buildingToReadingMap[building].find((function(d){return d===dp}));if(dataPoint)return building}return null},apply:function(){var _this8=this,dataPoints=[];if(this.config.mainPanel.selectedDataPoints&&this.config.mainPanel.selectedDataPoints.length){var _step31,_iterator31=(0,createForOfIteratorHelper/* default */.Z)(this.config.mainPanel.selectedDataPoints);try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var dp=_step31.value,buildingId=this.getBuildingId(dp),readingFieldId=parseInt(dp.split("_")[0]),parentId=parseInt(dp.split("_")[1]),name=" ";this.readings.assets[parentId]&&this.allFields.assets&&this.allFields.assets[readingFieldId]?name=this.readings.assets[parentId]+" ( "+this.allFields.assets[readingFieldId].displayName+" )":this.readingName||this.assetName||(this.allFields.space&&this.allFields.space[readingFieldId]?name=this.allFields.space[readingFieldId].displayName:this.allFields.weather&&this.allFields.weather[readingFieldId]?name=this.allFields.weather[readingFieldId].displayName:this.allFields.enpi&&this.allFields.enpi[readingFieldId]&&(name=this.allFields.enpi[readingFieldId].displayName)),dataPoints.push({parentId:parentId,name:name,yAxis:{fieldId:readingFieldId,aggr:this.readings.fields[readingFieldId]&&this.readings.fields[readingFieldId].unit&&["currency","kwh","co2","kg","mwh"].includes(this.readings.fields[readingFieldId].unit.trim().toLowerCase())?3:2},buildingId:parseInt(buildingId),prediction:!!(this.readings&&this.readings.fields&&this.readings.fields[readingFieldId]&&this.readings.fields[readingFieldId].module)&&11===this.readings.fields[readingFieldId].module.type,duplicateDataPoint:!1}),this.assetName="",this.readingName="",""}}catch(err){_iterator31.e(err)}finally{_iterator31.f()}}this.config.mainPanel.selectedAssetCategory&&(this.$parent.assetCategoryName=this.config.mainPanel.assetCategories.filter((function(categories){return categories.id===_this8.config.mainPanel.selectedAssetCategory}))[0].name),this.$emit("updateDataPoints",dataPoints)},checkAndReduceRangeTraces:function(dataPoints){var _step32,finalDataPoints=[],keyAndDataPoints={},_iterator32=(0,createForOfIteratorHelper/* default */.Z)(dataPoints);try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var dP=_step32.value;keyAndDataPoints.hasOwnProperty(dP.yAxis.fieldId+"."+dP.parentId)||(keyAndDataPoints[dP.yAxis.fieldId+"."+dP.parentId]=[]),keyAndDataPoints[dP.yAxis.fieldId+"."+dP.parentId].push(dP)}
//reducing data point
}catch(err){_iterator32.e(err)}finally{_iterator32.f()}for(var key in keyAndDataPoints)if(3===keyAndDataPoints[key].length){var aliases=keyAndDataPoints[key][0].aliases.actual.split("."),dataPoint=this.$helpers.cloneObject(keyAndDataPoints[key][0]);dataPoint.aliases.actual=aliases[0],finalDataPoints.push(dataPoint)}else finalDataPoints.push(keyAndDataPoints[key][0]);return finalDataPoints},setInitialValues:function(dataPoints,buildings){var _this9=this,finalDataPoints=this.checkAndReduceRangeTraces(dataPoints);finalDataPoints.length!==this.config.mainPanel.selectedDataPoints.length&&(this.config.mainPanel.selectedDataPoints=[],finalDataPoints.forEach((function(dp){2===dp.type||dp.duplicateDataPoint||_this9.config.mainPanel.selectedDataPoints.push(dp.yAxis.fieldId+"_"+dp.parentId)}))),buildings&&buildings.length&&!this.selectedBuildings.includes(buildings[0])&&this.setSelectedBuildings(buildings)}}},components_FHeatMapPointSelectorvue_type_script_lang_js=FHeatMapPointSelectorvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FHeatMapPointSelectorvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FHeatMapPointSelector=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/63129.js.map