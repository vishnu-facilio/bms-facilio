(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[11305],{
/***/902294:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FFormulaBuilder}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/workflow/FFormulaBuilder.vue?vue&type=template&id=a2996d4e
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{attrs:{id:"fbFormulaBuilder"}},[_vm.title||""!==_vm.title?_c("div",{staticClass:"fbTitle"},[_vm._v(" "+_vm._s(_vm.title?_vm.title:_vm.$t("setup.formulaBuilder.formula_builder"))+" ")]):_vm._e(),_vm.hideModeChange||_vm.showOnlyVarible||_vm.isV2Script?_vm._e():_c("div",{staticClass:"f-element",class:_vm.renderInLeft?"text-left":"text-right"},[_c("el-radio-group",{on:{change:_vm.handleModeChange},model:{value:_vm.uiMode,callback:function($$v){_vm.uiMode=$$v},expression:"uiMode"}},[_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.WorkflowUIMode.COMPLEX}},[_vm._v(" "+_vm._s(_vm.$t("setup.formulaBuilder.change_expression"))+" ")]),_vm.hideCodeView?_vm._e():_c("el-radio",{staticClass:"fc-radio-btn",attrs:{label:_vm.WorkflowUIMode.XML}},[_vm._v(" "+_vm._s(_vm.$t("setup.formulaBuilder.code_view"))+" ")])],1)],1),_vm.uiMode!==_vm.WorkflowUIMode.XML?_c("div",[_vm.showOnlyVarible?_vm._e():_c("div",{staticClass:"fbContainer"},[_c("div",{staticClass:"fbExpressions"},[_vm._l(_vm.result,(function(token,index){return["variable"===token.type?[_c("f-popover",{key:"variable"+index,attrs:{placement:"right","popper-class":"fbVariablePopper",title:_vm.$t("setup.formulaBuilder.set_variable"),trigger:"click",width:"290"},on:{save:function($event){return _vm.setVariable(_vm.variables[token.value])}},model:{value:_vm.variables[token.value].popover,callback:function($$v){_vm.$set(_vm.variables[token.value],"popover",$$v)},expression:"variables[token.value].popover"}},[_c("template",{slot:"content"},["virtual"!==_vm.module?_c("div",[_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"fc-input-full-border-select2",staticStyle:{width:"100%"},attrs:{placeholder:_vm.$t("setup.formulaBuilder.choose_module")},on:{change:function($event){_vm.loadRelatedModule(_vm.variables[token.value]),_vm.variables[token.value].aggregation=null}},model:{value:_vm.variables[token.value].module,callback:function($$v){_vm.$set(_vm.variables[token.value],"module",$$v)},expression:"variables[token.value].module"}},[_c("el-option",{key:"asset",attrs:{label:"Asset",value:"asset"}}),_c("el-option",{key:"space",attrs:{label:"Space",value:"space"}}),_c("el-option",{key:"assetreading",attrs:{label:"Asset Reading",value:"assetreading"}}),_c("el-option",{key:"spacereading",attrs:{label:"Space Reading",value:"spacereading"}}),"workorder"===_vm.module?_c("el-option",{key:"workorder",attrs:{label:"Work Order",value:"workorder"}}):_vm._e(),_c("el-option",{key:"function",attrs:{label:"Function",value:"function"}}),_c("el-option",{key:"constant",attrs:{label:"Constant",value:"constant"}})],1)],1)])],1),"assetreading"===_vm.variables[token.value].module||"asset"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Asset"},on:{change:function($event){_vm.loadRelatedModule(_vm.variables[token.value]),_vm.variables[token.value].readingFieldId=null}},model:{value:_vm.variables[token.value].assetId,callback:function($$v){_vm.$set(_vm.variables[token.value],"assetId",$$v)},expression:"variables[token.value].assetId"}},_vm._l(_vm.assetList,(function(asset){return _c("el-option",{key:"asset"+asset.id,attrs:{label:asset.name,value:asset.id}})})),1)],1)])],1):_vm._e(),"spacereading"===_vm.variables[token.value].module||"space"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Space"},on:{change:function($event){return _vm.loadRelatedModule(_vm.variables[token.value])}},model:{value:_vm.variables[token.value].spaceId,callback:function($$v){_vm.$set(_vm.variables[token.value],"spaceId",$$v)},expression:"variables[token.value].spaceId"}},_vm._l(_vm.spaceList,(function(space){return _c("el-option",{key:"space"+space.id,attrs:{label:space.name,value:space.id}})})),1)],1)])],1):_vm._e(),"workorder"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Field"},on:{change:function($event){return _vm.loadRelatedModule(_vm.variables[token.value])}},model:{value:_vm.variables[token.value].workorderFieldName,callback:function($$v){_vm.$set(_vm.variables[token.value],"workorderFieldName",$$v)},expression:"variables[token.value].workorderFieldName"}},_vm._l(_vm.workorderFields,(function(field){return _c("el-option",{key:"wofields"+field.id,attrs:{label:field.displayName,value:field.name}})})),1)],1)])],1):_vm._e(),"space"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Field"},model:{value:_vm.variables[token.value].spaceFieldId,callback:function($$v){_vm.$set(_vm.variables[token.value],"spaceFieldId",$$v)},expression:"variables[token.value].spaceFieldId"}},_vm._l(_vm.spaceFields,(function(field){return _c("el-option",{key:"spacefields"+field.id,attrs:{label:field.displayName,value:field.id}})})),1)],1)])],1):_vm._e(),"spacereading"===_vm.variables[token.value].module&&_vm.variables[token.value].spaceId?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Reading"},on:{change:function($event){_vm.variables[token.value].aggrCondOperator=null}},model:{value:_vm.variables[token.value].spaceReadingFieldId,callback:function($$v){_vm.$set(_vm.variables[token.value],"spaceReadingFieldId",$$v)},expression:"variables[token.value].spaceReadingFieldId"}},_vm._l(_vm.getSpaceReadings(_vm.variables[token.value].spaceId),(function(field){return _c("el-option",{key:field.id,attrs:{label:field.displayName,value:field.id}})})),1)],1)])],1):_vm._e(),"asset"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Field"},model:{value:_vm.variables[token.value].assetFieldId,callback:function($$v){_vm.$set(_vm.variables[token.value],"assetFieldId",$$v)},expression:"variables[token.value].assetFieldId"}},_vm._l(_vm.assetFields,(function(field){return _c("el-option",{key:"assetfields"+field.id,attrs:{label:field.displayName,value:field.id}})})),1)],1)])],1):_vm._e(),"assetreading"===_vm.variables[token.value].module&&_vm.variables[token.value].assetId?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Reading"},on:{change:function($event){_vm.variables[token.value].aggrCondOperator=null}},model:{value:_vm.variables[token.value].readingFieldId,callback:function($$v){_vm.$set(_vm.variables[token.value],"readingFieldId",$$v)},expression:"variables[token.value].readingFieldId"}},_vm._l(_vm.getAssetSpecificReadings(_vm.variables[token.value].assetId),(function(field){return _c("el-option",{key:"assetreadings"+field.id,attrs:{label:field.displayName,value:field.id}})})),1)],1)])],1):_vm._e(),"constant"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},["thresholdrule"===_vm.module?_c("el-popover",{attrs:{width:_vm.$refs["previnput"+token.value]&&_vm.$refs["previnput"+token.value][0]&&_vm.$refs["previnput"+token.value][0].$el?_vm.$refs["previnput"+token.value][0].$el.clientWidth:"",trigger:"click","popper-class":"prev-popper"},model:{value:_vm.variables[token.value].showPrevPopover,callback:function($$v){_vm.$set(_vm.variables[token.value],"showPrevPopover",$$v)},expression:"variables[token.value].showPrevPopover"}},[_c("div",{staticClass:"prev-value",staticStyle:{cursor:"pointer",padding:"10px"},on:{click:function($event){return _vm.setPrevValue(token.value,index)}}},[_vm._v(" "+_vm._s((_vm.metric?_vm.metric.displayName+"'s ":"")+"Previous Value")+" ")]),_c("div",{attrs:{slot:"reference"},slot:"reference"},[_c("el-input",{ref:"previnput"+token.value,refInFor:!0,staticClass:"fc-input-full-border-select2 width100",attrs:{type:"text",placeholder:"Enter Constant Value"},nativeOn:{keydown:function($event){_vm.variables[token.value].showPrevPopover=!1}},model:{value:_vm.variables[token.value].constant,callback:function($$v){_vm.$set(_vm.variables[token.value],"constant",$$v)},expression:"variables[token.value].constant"}},[_c("i",{class:["prev-icon el-select__caret el-input__icon el-icon-arrow-down",{active:_vm.variables[token.value].showPrevPopover}],staticStyle:{"line-height":"16px"},attrs:{slot:"suffix"},slot:"suffix"})])],1)]):_c("el-input",{staticClass:"fc-input-full-border2",staticStyle:{width:"100%"},attrs:{type:"text",placeholder:"Enter Constant Value"},model:{value:_vm.variables[token.value].constant,callback:function($$v){_vm.$set(_vm.variables[token.value],"constant",$$v)},expression:"variables[token.value].constant"}})],1)])],1):_vm._e(),"assetreading"===_vm.variables[token.value].module||"spacereading"===_vm.variables[token.value].module?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{placeholder:"Choose Aggregation"},on:{change:function($event){_vm.variables[token.value].dateRange=null}},model:{value:_vm.variables[token.value].aggregation,callback:function($$v){_vm.$set(_vm.variables[token.value],"aggregation",$$v)},expression:"variables[token.value].aggregation"}},_vm._l(_vm.aggregateOptions,(function(label,value){return _c("el-option",{key:"aggregation"+value,attrs:{label:label,value:value}})})),1)],1)])],1):_vm._e(),_vm.variables[token.value].aggregation&&!["lastValue"].includes(_vm.variables[token.value].aggregation)&&"currentEnpi"!==_vm.variables[token.value].spaceReadingFieldId?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-checkbox",{staticClass:"form-item ",staticStyle:{width:"100%"},model:{value:_vm.variables[token.value].hasAggregateCondValue,callback:function($$v){_vm.$set(_vm.variables[token.value],"hasAggregateCondValue",$$v)},expression:"\n                            variables[token.value].hasAggregateCondValue\n                          "}},[_vm._v("Apply Aggregation Condition")])],1)])],1):_vm._e(),_vm.variables[token.value].hasAggregateCondValue?[_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{placeholder:"Choose Operator"},on:{change:function($event){_vm.variables[token.value].aggrCondValue=null}},model:{value:_vm.variables[token.value].aggrCondOperator,callback:function($$v){_vm.$set(_vm.variables[token.value],"aggrCondOperator",$$v)},expression:"variables[token.value].aggrCondOperator"}},_vm._l(_vm.getReadingFieldOperators(_vm.variables[token.value]),(function(operator){return _c("el-option",{key:operator.operator,attrs:{label:_vm._f("firstUpperCase")(operator.operator),value:parseInt(operator.operatorId)}})})),1)],1)])],1),_vm.valueNotNeed.includes(_vm.variables[token.value].aggrCondOperator)?_vm._e():_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},["BOOLEAN"===_vm.variables[token.value].readingDataType?_c("el-select",{staticClass:"form-item fc-input-full-border-select2",staticStyle:{width:"100%"},model:{value:_vm.variables[token.value].aggrCondValue,callback:function($$v){_vm.$set(_vm.variables[token.value],"aggrCondValue",$$v)},expression:"variables[token.value].aggrCondValue"}},[_c("el-option",{attrs:{label:"True",value:"true"}}),_c("el-option",{attrs:{label:"False",value:"false"}})],1):_c("el-input",{staticClass:"fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{type:"text",placeholder:"Enter Value"},model:{value:_vm.variables[token.value].aggrCondValue,callback:function($$v){_vm.$set(_vm.variables[token.value],"aggrCondValue",$$v)},expression:"variables[token.value].aggrCondValue"}})],1)])],1)]:_vm._e(),"enpi"!==_vm.module||"assetreading"!==_vm.variables[token.value].module&&"spacereading"!==_vm.variables[token.value].module||"lastValue"===_vm.variables[token.value].aggregation?_vm._e():_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-checkbox",{staticClass:"form-item ",staticStyle:{width:"100%"},model:{value:_vm.variables[token.value].hasBaseline,callback:function($$v){_vm.$set(_vm.variables[token.value],"hasBaseline",$$v)},expression:"variables[token.value].hasBaseline"}},[_vm._v("Apply Baseline Condition")])],1)])],1),"enpi"!==_vm.module||!_vm.variables[token.value].hasBaseline||"assetreading"!==_vm.variables[token.value].module&&"spacereading"!==_vm.variables[token.value].module?_vm._e():_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2",staticStyle:{width:"100%"},attrs:{placeholder:"Choose Baseline"},model:{value:_vm.variables[token.value].baselineId,callback:function($$v){_vm.$set(_vm.variables[token.value],"baselineId",$$v)},expression:"variables[token.value].baselineId"}},_vm._l(_vm.baselines,(function(baseline){return _c("el-option",{key:"base"+baseline.id,attrs:{label:baseline.name,value:baseline.id}})})),1)],1)])],1),"thresholdrule"!==_vm.module&&"impact"!==_vm.module||!_vm.variables[token.value].aggregation||"lastValue"===_vm.variables[token.value].aggregation?_vm._e():_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{placeholder:"Choose Date Range"},model:{value:_vm.variables[token.value].dateRange,callback:function($$v){_vm.$set(_vm.variables[token.value],"dateRange",$$v)},expression:"variables[token.value].dateRange"}},_vm._l(_vm.dateRangeOptions,(function(label,value){return _c("el-option",{key:"dateRangeOptions"+value,attrs:{label:label,value:parseInt(value)}})})),1)],1)])],1),"function"===_vm.variables[token.value].module?[_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Namespace"},model:{value:_vm.variables[token.value].nameSpace,callback:function($$v){_vm.$set(_vm.variables[token.value],"nameSpace",$$v)},expression:"variables[token.value].nameSpace"}},_vm._l(_vm.namespaces,(function(namespace,key){return _c("el-option",{key:key,attrs:{label:namespace.label,value:key}})})),1)],1)])],1),_vm.variables[token.value].nameSpace?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Function"},model:{value:_vm.variables[token.value].functionName,callback:function($$v){_vm.$set(_vm.variables[token.value],"functionName",$$v)},expression:"variables[token.value].functionName"}},_vm._l(_vm.namespaces[_vm.variables[token.value].nameSpace].functions,(function(func,value){return _c("el-option",{key:value,attrs:{label:func.label,value:value}})})),1)],1)])],1):_vm._e()]:_vm._e()],2):_vm._e(),"virtual"===_vm.module?_c("div",{staticStyle:{width:"250px"}},[_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Choose Meter"},model:{value:_vm.variables[token.value].assetId,callback:function($$v){_vm.$set(_vm.variables[token.value],"assetId",$$v)},expression:"variables[token.value].assetId"}},_vm._l(_vm.meterlist,(function(meter){return _c("el-option",{key:meter.id,attrs:{label:meter.name,value:meter.id}})})),1)],1)])],1)],1):_vm._e()]),_c("el-button",{class:["fbVariable",{focused:_vm.variables[token.value].popover}],attrs:{slot:"reference"},slot:"reference"},[_vm._v(" "+_vm._s(_vm.variables[token.value].name)+" ")])],2)]:_vm._e(),"operator"===token.type?[index!==_vm.result.length-1?_c("el-popover",{key:"operator"+index,attrs:{"popper-class":"fbOperatorPopper",placement:"top",trigger:"hover"}},[_c("div",{staticClass:"operator-list p15"},[_c("div",{staticClass:"arithmetic"},[_c("div",{on:{click:function($event){return _vm.selectOperator("+",index)}}},[_c("img",{attrs:{src:__webpack_require__(194984)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator("-",index)}}},[_c("img",{staticClass:"small",attrs:{src:__webpack_require__(814465)}})]),"virtual"!==_vm.module?[_c("div",{on:{click:function($event){return _vm.selectOperator("*",index)}}},[_c("img",{attrs:{src:__webpack_require__(780818)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator("/",index)}}},[_c("img",{attrs:{src:__webpack_require__(318912)}})])]:_vm._e()],2),"thresholdrule"===_vm.module||"impact"===_vm.module?_c("div",{staticClass:"relational"},[_c("div",{on:{click:function($event){return _vm.selectOperator("==",index)}}},[_c("img",{staticClass:"small",attrs:{src:__webpack_require__(623276)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator("!=",index)}}},[_c("img",{staticClass:"small",attrs:{src:__webpack_require__(906107)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator("<",index)}}},[_c("img",{staticClass:"small",attrs:{src:__webpack_require__(498961)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator("<=",index)}}},[_c("img",{attrs:{src:__webpack_require__(82)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator(">",index)}}},[_c("img",{staticClass:"small",attrs:{src:__webpack_require__(47393)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator(">=",index)}}},[_c("img",{attrs:{src:__webpack_require__(679789)}})])]):_vm._e(),"thresholdrule"===_vm.module?_c("div",{staticClass:"logical"},[_c("div",{on:{click:function($event){return _vm.selectOperator("&&",index)}}},[_c("img",{attrs:{src:__webpack_require__(895963)}})]),_c("div",{on:{click:function($event){return _vm.selectOperator("||",index)}}},[_c("img",{attrs:{src:__webpack_require__(608356)}})])]):_vm._e()]),_c("div",{staticClass:"fbOperator",attrs:{slot:"reference"},slot:"reference"},["+"===token.value?[_c("img",{attrs:{src:__webpack_require__(849476)}})]:"-"===token.value?[_c("img",{staticStyle:{"padding-top":"3px"},attrs:{src:__webpack_require__(391673)}})]:"*"===token.value?[_c("img",{attrs:{src:__webpack_require__(811957)}})]:"/"===token.value?[_c("img",{staticStyle:{"padding-top":"2px"},attrs:{src:__webpack_require__(744180)}})]:"=="===token.value?[_c("img",{attrs:{src:__webpack_require__(703325)}})]:"!="===token.value?[_c("img",{attrs:{src:__webpack_require__(895366)}})]:"<"===token.value?[_c("img",{staticStyle:{width:"9px"},attrs:{src:__webpack_require__(291432)}})]:"<="===token.value?[_c("img",{staticStyle:{width:"15px"},attrs:{src:__webpack_require__(948534)}})]:">"===token.value?[_c("img",{staticStyle:{width:"9px"},attrs:{src:__webpack_require__(820862)}})]:">="===token.value?[_c("img",{staticStyle:{width:"15px"},attrs:{src:__webpack_require__(440087)}})]:"&&"===token.value?[_c("img",{staticStyle:{width:"15px"},attrs:{src:__webpack_require__(817935)}})]:"||"===token.value?[_c("img",{attrs:{src:__webpack_require__(821137)}})]:_c("div",[_vm._v(_vm._s(token.value))])],2)]):_vm._e()]:_vm._e(),"brace"===token.type?["("===token.value?_c("img",{key:"brace"+index,staticStyle:{height:"50px"},attrs:{src:__webpack_require__(895252)}}):_c("div",{key:"brace"+index,staticStyle:{display:"flex","align-items":"center"}},[_c("div",{staticClass:"fbNewBtn inner",on:{click:function($event){return _vm.addExpression(index)}}},[_vm._v(" + ")]),_c("span",{staticStyle:{"letter-spacing":"2px","font-size":"13px",color:"#84ccd5"}},[_vm._v("---")]),_c("img",{staticStyle:{height:"50px"},attrs:{src:__webpack_require__(255496)}})])]:_vm._e(),index!==_vm.result.length-1?_c("span",{key:index,staticClass:"flLeft",staticStyle:{"letter-spacing":"2px","font-size":"13px",color:"#84ccd5"}},[_vm._v("---")]):_vm._e()]})),_c("span",{staticStyle:{"letter-spacing":"2px","font-size":"13px",color:"#84ccd5"}},[_vm._v("---")]),_c("div",{staticClass:"fbNewBtn",on:{click:function($event){return _vm.addExpression()}}},[_vm._v("+")])],2),"thresholdrule"===_vm.module?_c("div",{staticClass:"fbOccurence"},[_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle",gutter:20}},[_c("el-col",{staticStyle:{"padding-right":"35px","padding-left":"0px"},attrs:{span:12}},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v("Occurrences")]),_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{placeholder:"Choose Occurence Type"},on:{change:_vm.evaluateExpression},model:{value:_vm.occurenceType,callback:function($$v){_vm.occurenceType=$$v},expression:"occurenceType"}},[_c("el-option",{attrs:{label:"None",value:0}}),_c("el-option",{attrs:{label:"Occurrence Consecutively",value:1}}),_c("el-option",{attrs:{label:"Occurrence Over Period",value:2}}),_c("el-option",{attrs:{label:"Over Period",value:3}})],1)],1)])],1),[1,2].includes(_vm.occurenceType)?_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle",gutter:20}},[_c("el-col",{staticStyle:{"padding-right":"35px","padding-left":"0px"},attrs:{span:12}},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v("Count")]),_c("div",{staticClass:"add"},[_c("el-input",{staticClass:"fc-input-select fc-input-full-border-select2 width100",attrs:{type:"number",placeholder:"Enter Occurrences"},on:{change:_vm.evaluateExpression},model:{value:_vm.occurences,callback:function($$v){_vm.occurences=$$v},expression:"occurences"}})],1)])],1):_vm._e(),[2,3].includes(_vm.occurenceType)?_c("el-row",{staticStyle:{margin:"0px"},attrs:{align:"middle",gutter:20}},[_c("el-col",{staticStyle:{"padding-right":"35px","padding-left":"0px","padding-top":"20px"},attrs:{span:12}},[_c("div",{staticClass:"fc-input-label-txt"},[_vm._v("Period")]),_c("div",{staticClass:"add"},[_c("el-select",{staticClass:"form-item fc-input-full-border-select2 width280px",staticStyle:{width:"100%"},attrs:{placeholder:"Choose Period"},on:{change:_vm.evaluateExpression},model:{value:_vm.overPeriod,callback:function($$v){_vm.overPeriod=$$v},expression:"overPeriod"}},[_c("el-option",{attrs:{label:"Last 20 Minutes",value:1200}}),_c("el-option",{attrs:{label:"Last 1 Hour",value:3600}}),_c("el-option",{attrs:{label:"Last 3 Hour",value:10800}}),_c("el-option",{attrs:{label:"Last 6 Hour",value:21600}}),_c("el-option",{attrs:{label:"Last 12 Hour",value:7200}})],1)],1)])],1):_vm._e()],1):_vm._e()]),_vm.uiMode!==_vm.WorkflowUIMode.COMPLEX||_vm.showOnlyVarible?_vm._e():_c("el-row",{staticStyle:{margin:"0px","padding-top":"20px"},attrs:{align:"middle"}},[_c("el-col",{attrs:{span:24}},[_c("div",{staticClass:"add"},[_c("div",{staticClass:"new-label-text"},[_vm._v("Expression")]),_c("el-input",{staticClass:"fc-input-full-border2 pT10",staticStyle:{width:"100%"},attrs:{type:"text",placeholder:"Enter Expression"},on:{change:_vm.evaluateExpression},model:{value:_vm.fbResult,callback:function($$v){_vm.fbResult=$$v},expression:"fbResult"}})],1)])],1),_c("div",{staticClass:"fbVariableLegendContainer"},[_c("table",{attrs:{border:"0",cellspacing:"0",cellpadding:"0"}},_vm._l(_vm.result,(function(token,index){return _c("tr",{key:"legend"+index,staticClass:"fbVariableLegend"},["variable"===token.type?[_c("td",{staticClass:"fbVariableLegend"},[_vm._v(" "+_vm._s(_vm.variables[token.value].name)+" ")]),_c("td",{staticClass:"fbVariableLegendInfo"},[_c("div",{staticStyle:{float:"left"}},[""!==_vm.getVariableName(_vm.variables[token.value])?_c("span",[_vm._v(_vm._s(_vm.getVariableName(_vm.variables[token.value])))]):_c("span",{staticStyle:{color:"#aaa"}},[_vm._v("Variable not set")])]),_vm.showOnlyVarible?_vm._e():_c("div",{staticClass:"fbVariableLegendDelete",staticStyle:{float:"right"},on:{click:function($event){return _vm.removeExpression(index)}}},[_c("i",{staticClass:"fa fa-trash"})]),_c("div",{staticStyle:{clear:"both"}})])]:_vm._e()],2)})),0)])],1):_c("div",{staticClass:"pT10"},[_vm.isV2Script?_c("div",{staticClass:"height150 overflow-y-scroll pB50"},[_c("code-mirror",{attrs:{codeeditor:!0},model:{value:_vm.workflowV2String,callback:function($$v){_vm.workflowV2String=$$v},expression:"workflowV2String"}})],1):_c("textarea",{directives:[{name:"model",rawName:"v-model",value:_vm.workflowString,expression:"workflowString"}],staticClass:"formula-xml",attrs:{rows:"10",placeholder:"Write in XML"},domProps:{value:_vm.workflowString},on:{change:_vm.evaluateExpression,input:function($event){$event.target.composing||(_vm.workflowString=$event.target.value)}}})])])},staticRenderFns=[],esm_typeof=__webpack_require__(103336),objectSpread2=__webpack_require__(595082),FPopover=(__webpack_require__(434284),__webpack_require__(169358),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(564043),__webpack_require__(670560),__webpack_require__(300268),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(322462),__webpack_require__(162506),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(507008)),vuex_esm=__webpack_require__(420629),CodeMirror=__webpack_require__(919324),formatOptions={indent:4,newline:"\n"},format=__webpack_require__(754123),expRegex=/([a-zA-Z])|([1-9]\d*)|([\\(\\)])|([-+*\\/])|(<=?|>=?|==|!=)|(&&|\|{1,2})/g,WorkflowUIMode={GUI:1,XML:2,COMPLEX:3},FFormulaBuildervue_type_script_lang_js={props:["module","value","title","metric","assetCategory","hideCodeView","hideModeChange","restrictInit","setResultAsExpr","renderInLeft","showOnlyVarible","isMv"],components:{FPopover:FPopover/* default */.Z,CodeMirror:CodeMirror/* default */.Z},data:function(){return{variables:{},result:[],lastVariable:65,meterlist:[],model:{name:"",value:"",buildingId:null,purposeSpaceId:null,assetId:"",popover:!1,showPrevPopover:!1,module:"",readingFieldId:"",spaceReadingFieldId:"",aggregation:null,dateRange:null,assetFieldId:"",constant:"",spaceId:"",spaceFieldId:"",hasBaseline:null,hasAggregateCondValue:!1,baselineId:null,aggrCondOperator:null,aggrCondValue:null},aggregateOptions:{sum:"Sum",count:"Count",avg:"Average",min:"Minimum",max:"Maximum",lastValue:"Current Value"},dateRangeOptions:{20:"Last 20 Minutes",
// Temp
30:"Last 30 Minutes",
// Temp
40:"Last 40 Minutes",
// Temp
1:"Last 1 Hour",3:"Last 3 Hour",6:"Last 6 Hour",12:"Last 12 Hour",22:"Today",23:"Tomorrow",25:"Yesterday",28:"This Month",44:"This Year"},namespaces:{date:{label:"Date",functions:{getCurrentHour:{label:"Get Current Hour",params:"startTime",paramType:"Number"},getCurrentDate:{label:"Get Current Date",params:"startTime",paramType:"Number"},getCurrentDay:{label:"Get Current Day",params:"startTime",paramType:"Number"},getCurrentMonth:{label:"Get Current Month",params:"startTime",paramType:"Number"},getCurrentMonthDays:{label:"Get Current Month Days",params:"startTime",paramType:"Number"},getLastMonthDays:{label:"Get Last Month Days",params:"startTime",paramType:"Number"},now:{label:"Now",params:"startTime",paramType:"Number"}}}},valueNotNeed:[1,2],evaluated:!1,uiMode:WorkflowUIMode.GUI,WorkflowUIMode:WorkflowUIMode,fbResult:"",workflowString:"",workflowV2String:"",isV2Script:!1,occurenceType:0,occurences:null,overPeriod:1200,assetMetaField:{name:"asset",lookupModule:{name:"asset"}},currentAsset:{value:"resourceId",label:"Current Asset"}}},created:function(){this.restrictInit||this.$store.dispatch("formulabuilder/initData")},mounted:function(){var unwatch=this.$watch("value",(function(){this.evaluated||(this.initExpressions(),unwatch())}));this.initExpressions(),"virtual"===this.module&&this.loadMeters(),this.loadBaselines()},watch:{workflowV2String:function(){this.evaluateExpression()}},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({assetList:function(state){return state.formulabuilder.assetList},assetReadingFields:function(state){return state.formulabuilder.assetReadingFields},spaceReadingFields:function(state){return state.formulabuilder.spaceReadingFields},assetFields:function(state){return state.formulabuilder.assetFields},spaceList:function(state){return state.formulabuilder.spaceList},workorderFields:function(state){return state.formulabuilder.workorderFields},spaceFields:function(state){return state.formulabuilder.spaceFields},baselines:function(state){return state.formulabuilder.baselines}})),(0,vuex_esm/* mapGetters */.Se)({getSpaceReadings:"formulabuilder/getSpaceReadings",getAssetReadings:"formulabuilder/getAssetReadings",getAsset:"formulabuilder/getAsset",getSpace:"formulabuilder/getSpace"})),{},{isMvChange:function(){return this.isMv&&321===this.$org.id}}),methods:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({setDefaultExpression:function(){var a=this.$helpers.cloneObject(this.model);a.name="A",this.$set(this.variables,"A",a);var b=this.$helpers.cloneObject(this.model);b.name="B",this.$set(this.variables,"B",b),this.lastVariable++,this.result=[{type:"brace",value:"("},{type:"variable",value:"A"},{type:"operator",value:"+"},{type:"variable",value:"B"},{type:"brace",value:")"}]},initExpressions:function(){var _this=this;if(this.result=[],this.uiMode=this.value?this.value.workflowUIMode:WorkflowUIMode.GUI,!this.value||"object"===(0,esm_typeof/* default */.Z)(this.value)&&this.value.constructor===Object&&!Object.keys(this.value).length)this.setDefaultExpression();else if(this.uiMode===WorkflowUIMode.XML)this.workflowString=this.value.workflowString,this.value.isV2Script&&(this.isV2Script=!0,this.workflowV2String=this.value.workflowV2String),this.setDefaultExpression();else{var resultEvaluator,isVirtual="virtual"===this.module;if(!isVirtual&&this.value&&this.value.expressions){if(resultEvaluator=this.value.resultEvaluator,!resultEvaluator&&this.setResultAsExpr){var expression=this.value.expressions.find((function(expr){return"resultExpr"===expr.name||expr.expr}));expression&&(resultEvaluator=expression.expr)}}else resultEvaluator=this.value;if(resultEvaluator){var tempExp={};
// this.setFbResult()
if(isVirtual||this.value.expressions.forEach((function(expression){tempExp[expression.name]=expression})),this.value&&this.value.occurences){var occurences=this.value.occurences;this.occurences=-1!==occurences.occurences?occurences.occurences:null,this.overPeriod=-1!==occurences.overPeriod?occurences.overPeriod:1200,this.occurences?-1!==occurences.overPeriod?this.occurenceType=2:occurences.consecutive&&(this.occurenceType=1):-1!==occurences.overPeriod&&(this.occurenceType=3)}if(this.uiMode===WorkflowUIMode.COMPLEX)return this.value.expressions.forEach((function(expression){_this.initVariable(expression.name,expression)})),void(this.fbResult=resultEvaluator);var match=expRegex.exec(resultEvaluator);while(null!=match){if(match[1]||match[2]){var name=void 0,exp=void 0,assetId=void 0;"virtual"===this.module?(name=String.fromCharCode(this.lastVariable++),assetId=parseInt(match[2])):(name=match[0],exp=tempExp[match[1]]),this.initVariable(name.toUpperCase(),exp,assetId)}else match[3]?this.result.push({type:"brace",value:match[3]}):(match[4]||match[5]||match[6])&&this.result.push({type:"operator",value:match[0]});match=expRegex.exec(resultEvaluator)}}}},initVariable:function(name,exp,assetId){var variable=this.$helpers.cloneObject(this.model);"virtual"===this.module?variable.assetId=assetId:(this.lastVariable=name.charCodeAt(0)>this.lastVariable?name.charCodeAt(0):this.lastVariable,this.setEnpi(exp,variable)),variable.name=name,this.$set(this.variables,name,variable),this.result.push({type:"variable",value:name})},setEnpi:function(exp,expression){var _this2=this;if(exp){var moduleName=exp.moduleName;if(exp.customFunctionResultEvaluator)moduleName="function";else if(moduleName){if("basespace"===moduleName)moduleName="space";else if("asset"!==moduleName){var id;if(exp.criteria&&exp.criteria.conditions&&exp.criteria.conditions["1"]){var val=exp.criteria.conditions["1"].value;id=isNaN(val)?val.includes("resourceId")?"resourceId":val:parseInt(val)}
// temp
return void(this.isMvChange?this.$http.get("v2/resource/getResourcesDetails?resourceId[0]=".concat(id)).then((function(response){var resource=response.data.result.resource[0];expression.module=2===resource.resourceType?"assetreading":"spacereading",_this2.setEnpiExpression(exp,expression)})):this.loadAssets().then((function(){expression.module=_this2.assetList.find((function(asset){return asset.id===id}))?"assetreading":"spacereading",_this2.setEnpiExpression(exp,expression)})))}}else moduleName=exp.constant.startsWith("${workorder.")?"workorder":"constant";expression.module=moduleName,this.setEnpiExpression(exp,expression)}},setEnpiExpression:function(exp,expression){var parentId,_this3=this;if(exp.criteria&&exp.criteria.conditions&&exp.criteria.conditions["1"]){var val=exp.criteria.conditions["1"].value;parentId=isNaN(val)?val.includes("resourceId")?"resourceId":val:parseInt(val)}if("assetreading"===expression.module||"asset"===expression.module?expression.assetId=parentId:"spacereading"===expression.module||"space"===expression.module?expression.spaceId=parentId:"constant"===expression.module?expression.constant=exp.constant:"function"===expression.module?(expression.functionName=exp.defaultFunctionContext.functionName,expression.nameSpace=exp.defaultFunctionContext.nameSpace):"workorder"===expression.module&&(expression.workorderFieldName=exp.constant.match(/\${workorder\.([a-z1-9]*)}/)[1]),"enpi"!==this.module||"assetreading"!==expression.module&&"spacereading"!==expression.module||exp.conditionSeqVsBaselineId&&exp.conditionSeqVsBaselineId[2]&&(expression.hasBaseline=!0,expression.baselineId=exp.conditionSeqVsBaselineId[2]),("thresholdrule"===this.module||"impact"===this.module)&&("assetreading"===expression.module||"spacereading"===expression.module)&&exp.criteria.conditions["2"]){var range,operatorId=exp.criteria.conditions["2"].operatorId;[22,23,25,28,44].includes(operatorId)?range=operatorId:isNaN(exp.criteria.conditions["2"].value.split(",")[0])||(range=parseInt(exp.criteria.conditions["2"].value.split(",")[0])),expression.dateRange=range}exp.criteria&&exp.criteria.conditions&&exp.criteria.conditions["3"]&&(expression.hasAggregateCondValue=!0,expression.aggrCondOperator=exp.criteria.conditions["3"].operatorId,expression.aggrCondValue=exp.criteria.conditions["3"].value),this.loadRelatedModule(expression,!0).then((function(){"asset"===expression.module?expression.assetFieldId=_this3.assetFields.find((function(field){return field.name===exp.fieldName})).id:"space"===expression.module?expression.spaceFieldId=_this3.spaceFields.find((function(field){return field.name===exp.fieldName})).id:"assetreading"===expression.module?(expression.aggregation=exp.aggregateString,expression.readingFieldId=_this3.getAssetSpecificReadings(parentId).find((function(readingField){return readingField.module.name===exp.moduleName&&readingField.name===exp.fieldName})).id):"spacereading"===expression.module&&(expression.aggregation=exp.aggregateString,expression.spaceReadingFieldId=_this3.getSpaceReadings(parentId).find((function(readingField){return readingField.module.name===exp.moduleName&&readingField.name===exp.fieldName})).id)}))},evaluateExpression:function(fetchObj){var _this4=this;if(this.evaluated=!0,this.uiMode===WorkflowUIMode.XML&&!0!==fetchObj){var workflow={workflowString:this.workflowString,workflowUIMode:this.uiMode};return this.isV2Script&&(workflow.workflowV2String=this.workflowV2String,workflow.isV2Script=!0),void this.$emit("input",workflow)}if("virtual"!==this.module){for(var obj={workflowContext:{expressions:[],parameters:[],resultEvaluator:"",workflowUIMode:this.uiMode}},_loop=function(){var token=_this4.result[_i];if("variable"===token.type){var exp=_this4.variables[token.value];if("constant"===exp.module)obj.workflowContext.expressions.push({name:exp.name,constant:exp.constant});else if("asset"===exp.module){var isCurrentResource="resourceId"===exp.assetId;isCurrentResource&&_this4.addParam(obj,"resourceId","Number"),obj.workflowContext.expressions.push({name:exp.name,fieldName:_this4.assetFields.find((function(field){return field.id===exp.assetFieldId})).name,moduleName:"asset",aggregateString:"[0]",criteria:{pattern:"1",conditions:{1:{fieldName:"id",operatorId:9,sequence:"1",value:isCurrentResource?"${"+exp.assetId+"}":exp.assetId}}}})}else if("space"===exp.module)obj.workflowContext.expressions.push({name:exp.name,fieldName:_this4.spaceFields.find((function(field){return field.id===exp.spaceFieldId})).name,moduleName:"basespace",aggregateString:"[0]",criteria:{pattern:"1",conditions:{1:{fieldName:"id",operatorId:9,sequence:"1",value:exp.spaceId}}}});else if("workorder"===exp.module){var constantName="workorder."+exp.workorderFieldName;obj.workflowContext.expressions.push({name:exp.name,constant:"${"+constantName+"}"}),_this4.addParam(obj,constantName)}else if("assetreading"===exp.module||"spacereading"===exp.module){var parentId,reading;"assetreading"===exp.module?(parentId=exp.assetId,reading=_this4.getAssetSpecificReadings(parentId).find((function(readingField){return readingField.id===exp.readingFieldId}))):(parentId=exp.spaceId,reading=_this4.getSpaceReadings(parentId).find((function(readingField){return readingField.id===exp.spaceReadingFieldId})));var _isCurrentResource="resourceId"===parentId;_isCurrentResource&&_this4.addParam(obj,"resourceId","Number"),"currentEnpi"===exp.spaceReadingFieldId&&(_this4.addParam(obj,"currentModule"),_this4.addParam(obj,"currentField"));var expression={name:exp.name,aggregateString:exp.aggregation,fieldName:reading.name,moduleName:reading.module.name,criteria:{pattern:"(1 and 2)",conditions:{1:{fieldName:"parentId",operatorId:9,sequence:"1",value:_isCurrentResource?"${"+parentId+"}":parentId},2:{fieldName:"ttime",operatorId:20,sequence:"2",value:"${startTime}, ${endTime}"}}},conditionSeqVsBaselineId:{}};
// if (this.module === 'impact') {
//   expression.criteria.pattern = '(1)'
//   delete expression.criteria.conditions['2']
// }
if("lastValue"===exp.aggregation)expression.orderByFieldName="ttime",expression.sortBy="desc",expression.limit=1,"thresholdrule"!==_this4.module&&"impact"!==_this4.module||(expression.criteria.pattern="(1)",delete expression.criteria.conditions["2"]);else if(("thresholdrule"===_this4.module||"impact"===_this4.module)&&exp.dateRange){var operatorId;operatorId=[20,30,40].includes(exp.dateRange)?56:[1,3,6,12].includes(exp.dateRange)?42:exp.dateRange,expression.criteria.conditions["2"].operatorId=operatorId,operatorId!==exp.dateRange?(expression.criteria.conditions["2"].value=exp.dateRange+",${ttime}",// eslint-disable-line no-template-curly-in-string
_this4.addParam(obj,"ttime","Number")):delete expression.criteria.conditions["2"].value}exp.hasAggregateCondValue&&exp.aggrCondOperator&&exp.aggrCondValue&&(expression.criteria.conditions["3"]={fieldName:expression.fieldName,operatorId:exp.aggrCondOperator,sequence:"3",value:exp.aggrCondValue},expression.criteria.pattern="(1 and 2 and 3)"),exp.baselineId&&(expression.conditionSeqVsBaselineId[2]=exp.baselineId),obj.workflowContext.expressions.push(expression),"thresholdrule"!==_this4.module&&"impact"!==_this4.module&&(_this4.addParam(obj,"startTime","Number"),_this4.addParam(obj,"endTime","Number"))}
// Temp...needs to handle all fucnctions
else if("function"===exp.module){var func=_this4.namespaces[exp.nameSpace].functions[exp.functionName];if(obj.workflowContext.expressions.push({name:exp.name,defaultFunctionContext:{nameSpace:exp.nameSpace,functionName:exp.functionName,params:func.params}}),func.params){var placeholder=_this4.$helpers.getPlaceholders(func.params);_this4.addParam(obj,placeholder.length?placeholder[0]:func.params,func.paramType)}}exp.module&&(obj.workflowContext.resultEvaluator+=token.value)}else("operator"!==token.type||"variable"!==_this4.result[_i+1].type||_this4.variables[_this4.result[_i+1].value].module)&&(obj.workflowContext.resultEvaluator+=token.value)},_i=0;_i<this.result.length;_i++)_loop();if(this.uiMode===WorkflowUIMode.COMPLEX&&(obj.workflowContext.resultEvaluator=this.fbResult),this.setResultAsExpr&&(obj.workflowContext.expressions.push({name:"resultExpr",expr:obj.workflowContext.resultEvaluator}),delete obj.workflowContext.resultEvaluator),"thresholdrule"===this.module||"impact"===this.module){if(this.metric){var typeString;if("object"===(0,esm_typeof/* default */.Z)(this.metric.dataTypeEnum))typeString=this.metric.dataTypeEnum.typeAsString;else if("STRING"===this.metric.dataTypeEnum){var type={STRING:"String",NUMBER:"Number",DECIMAL:"Decimal",BOOLEAN:"Boolean"};typeString=type[this.metric.dataTypeEnum]}this.addParam(obj,"previousValue",typeString)}obj.workflowContext.occurences={occurences:[1,2].includes(this.occurenceType)&&this.occurences>0?this.occurences:-99,overPeriod:[2,3].includes(this.occurenceType)&&this.overPeriod>0?this.overPeriod:-99,consecutive:1===this.occurenceType}}return this.$emit("input",obj.workflowContext),obj.workflowContext}for(var expressionObj="",i=0;i<this.result.length;i++){var token=this.result[i];if("variable"===token.type)this.variables[token.value].assetId?expressionObj+=this.variables[token.value].assetId:"operator"===this.result[i+1].type&&i++;else{if("operator"===token.type&&"variable"===this.result[i+1].type&&!this.variables[this.result[i+1].value].assetId){i++;continue}expressionObj+=token.value}}this.$emit("input",expressionObj)},addParam:function(obj,name,type){obj.workflowContext.parameters||(obj.workflowContext.parameters=[]);var params=obj.workflowContext.parameters;params.find((function(param){return param.name===name}))||params.push({name:name,typeString:type||"String"})},addExpression:function(index){if(90!==this.lastVariable){68===this.lastVariable&&this.lastVariable++;var name=String.fromCharCode(++this.lastVariable),variable=this.$helpers.cloneObject(this.model);if(variable.name=name,this.$set(this.variables,name,variable),index){var _this$result,tokens=[{type:"operator",value:"+"},{type:"variable",value:name}];(_this$result=this.result).splice.apply(_this$result,[index,0].concat(tokens))}else this.uiMode===WorkflowUIMode.COMPLEX?this.result.push({type:"variable",value:name}):(0!==this.result.length&&this.result.push({type:"operator",value:"+"}),this.result.push({type:"brace",value:"("},{type:"variable",value:name},{type:"brace",value:")"}));
// this.setFbResult()
this.evaluateExpression()}},loadRelatedModule:function(expression,fetchSpaceDetails){var _this5=this;return"assetreading"===expression.module?this.loadAssets().then((function(){return _this5.loadAssetReadings(expression.assetId)})):"asset"===expression.module?this.loadAssets().then((function(){return _this5.loadAssetFields()})):"workorder"===expression.module?this.loadWorkorderFields():"spacereading"===expression.module?
// temp
this.isMvChange?(this.loadSpaces(),this.loadSpaceDetails(expression.spaceId).then((function(){return _this5.loadSpaceReadings(expression.spaceId)}))):this.loadSpaces().then((function(){return _this5.loadSpaceReadings(expression.spaceId)})):"space"===expression.module?this.loadSpaces().then((function(){return _this5.loadSpaceFields()})):Promise.resolve()},getAssetSpecificReadings:function(assetId){return assetId&&assetId>0?this.getAssetReadings(assetId):this.getAssetReadings(this.assetCategory?this.assetCategory.id:-1,!0)}},(0,vuex_esm/* mapActions */.nv)({loadSpaceDetails:"formulabuilder/loadSpaceDetails",loadSpaces:"formulabuilder/loadSpaces",loadSpaceFields:"formulabuilder/loadSpaceFields",loadAssetFields:"formulabuilder/loadAssetFields",loadWorkorderFields:"formulabuilder/loadWorkorderFields",loadSpaceReadings:"formulabuilder/loadSpaceReadings",loadBaselines:"formulabuilder/loadBaselines"})),{},{loadAssets:function(){return this.$store.dispatch("formulabuilder/loadAssets",{assetCategory:this.assetCategory,orgId:this.$account.org.id})},loadAssetReadings:function(assetId){return this.$store.dispatch("formulabuilder/loadAssetReadings",{assetCategoryId:assetId&&assetId>-1?this.getAsset(assetId).category.id:this.assetCategory?this.assetCategory.id:-1})},loadMeters:function(){var that=this;that.$http.get("/energymeter/all").then((function(response){that.loading=!1,200===response.status&&(that.meterlist=response.data?response.data:[])}))},getVariableName:function(expression){if("virtual"===this.module&&expression.assetId)return this.getMeterName(expression.assetId);var variable="";if("asset"===expression.module)expression.assetId&&(variable+=this.getAssetName(expression.assetId)),expression.assetFieldId&&(variable=variable+" - "+this.getAssetFieldName(expression.assetFieldId)),expression.aggregation&&(variable=variable+" - "+this.aggregateOptions[expression.aggregation]);else if("space"===expression.module)expression.spaceId&&(variable+=this.getSpaceName(expression.spaceId)),expression.spaceFieldId&&(variable=variable+" - "+this.getSpaceFieldName(expression.spaceFieldId)),expression.aggregation&&(variable=variable+" - "+this.aggregateOptions[expression.aggregation]);else if("workorder"===expression.module)expression.workorderFieldName&&(variable+=this.getWorkorderFieldName(expression.workorderFieldName));else if("assetreading"===expression.module)expression.assetId&&(variable+=this.getAssetName(expression.assetId)),expression.readingFieldId&&(variable=variable+" - "+this.getReadingFieldName(expression.readingFieldId,expression.assetId,"asset")),expression.aggregation&&(variable=variable+" - "+this.aggregateOptions[expression.aggregation]),expression.dateRange&&(variable+=" - "+this.dateRangeOptions[expression.dateRange]),expression.baselineId&&(variable+=" - "+this.getBaselineName(expression.baselineId));else if("spacereading"===expression.module)expression.spaceId&&(variable+=this.getSpaceName(expression.spaceId)),expression.spaceReadingFieldId&&(variable=variable+" - "+this.getReadingFieldName(expression.spaceReadingFieldId,expression.spaceId,"space")),expression.aggregation&&(variable=variable+" - "+this.aggregateOptions[expression.aggregation]),expression.dateRange&&(variable+=" - "+this.dateRangeOptions[expression.dateRange]),expression.baselineId&&(variable+=" - "+this.getBaselineName(expression.baselineId));else if("constant"===expression.module)variable+=expression.constant;else if("function"===expression.module&&expression.nameSpace){var namespace=this.namespaces[expression.nameSpace];variable+=namespace.label,expression.functionName&&(variable+=" - "+namespace.functions[expression.functionName].label)}return variable},getBaselineName:function(id){return this.baselines.find((function(baseline){return baseline.id===id})).name},getReadingFieldName:function(id,objId,type){if("asset"===type){var field=this.getAssetSpecificReadings(objId).find((function(readingField){return readingField.id===id}));if(field)return field.displayName}else if("space"===type){var _field=this.getSpaceReadings(objId).find((function(readingField){return readingField.id===id}));if(_field)return _field.displayName}},getSpaceFieldName:function(id){return this.spaceFields.find((function(spaceField){return spaceField.id===id})).displayName},getWorkorderFieldName:function(name){return this.workorderFields.find((function(workorderField){return workorderField.name===name})).displayName},getAssetFieldName:function(id){return this.assetFields.find((function(assetField){return assetField.id===id})).displayName},getSpaceName:function(id){return this.spaceList.length?this.spaceList.find((function(space){return space.id===id})).name:""},getAssetName:function(id){return this.assetList.length?this.assetList.find((function(asset){return asset.id===id})).name:""},getMeterName:function(id){return this.meterlist.length?this.meterlist.find((function(meter){return meter.id===id})).name:""},getReadingFieldOperators:function(variable){var fields,readingFieldId;"assetreading"===variable.module?(fields=this.getAssetSpecificReadings(variable.assetId),readingFieldId=variable.readingFieldId):(fields=this.getSpaceReadings(variable.spaceId),readingFieldId=variable.spaceReadingFieldId);var readingField=fields.find((function(readingField){return readingField.id===readingFieldId}));if(readingField)return variable.readingDataType=readingField.dataTypeEnum._name,readingField.dataTypeEnum.operators},removeExpression:function(index){if(delete this.variables[this.result[index].value],this.uiMode!==WorkflowUIMode.COMPLEX){var deleteCount=1;0!==index&&"operator"===this.result[index-1].type?(--index,deleteCount=2):0!==index&&"brace"===this.result[index-1].type&&(this.result[index+1]&&"brace"===this.result[index+1].type?(
/* if (index === 1) {
            --index; deleteCount = 3
            }
            else {
            index = index - 2; deleteCount = 4
            } */
index=1===index?index-1:index-2,deleteCount=4):deleteCount=2),this.result.splice(index,deleteCount)}else this.result.splice(index,1);
// this.setFbResult()
this.evaluateExpression()},selectOperator:function(operator,index){this.result[index].value=operator,this.evaluateExpression()},setVariable:function(expression){expression.popover=!1,this.evaluateExpression()},setPrevValue:function(val){this.variables[val].constant="${previousValue}",this.variables[val].showPrevPopover=!1},setFbResult:function(){if(this.uiMode===WorkflowUIMode.COMPLEX){this.fbResult="";for(var i=0;i<this.result.length;i++){var token=this.result[i];token.type,this.fbResult+=token.value}}},parseResult:function(resultExp){this.result=[];var match=expRegex.exec(resultExp),virtualVariable=97;while(null!=match){if(match[1]||match[2]){var name="virtual"===this.module?String.fromCharCode(virtualVariable++):match[0];this.result.push({type:"variable",value:name})}else match[3]?this.result.push({type:"brace",value:match[3]}):(match[4]||match[5]||match[6])&&this.result.push({type:"operator",value:match[0]});match=expRegex.exec(resultExp)}this.evaluateExpression()},handleModeChange:function(){var _this6=this;if(this.uiMode===WorkflowUIMode.COMPLEX)this.result=this.result.filter((function(token){return"variable"===token.type}));else if(this.uiMode===WorkflowUIMode.XML&&this.value){var workflow=this.evaluateExpression(!0);this.$http.post("/v2/workflow/xml",{workflow:workflow}).then((function(response){0===response.data.responseCode&&(_this6.workflowString=format(response.data.result.workflowString,formatOptions),_this6.evaluateExpression())}))}}})},workflow_FFormulaBuildervue_type_script_lang_js=FFormulaBuildervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(workflow_FFormulaBuildervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FFormulaBuilder=component.exports},
/***/817935:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"a82b74da1f02aaf0f85c94995efd4e0d.svg";
/***/},
/***/895963:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"5c6f3c1f1f140369f1f61646a9011d30.svg";
/***/},
/***/744180:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"2cb67458c0c90886e19bd65e3ba62a1d.svg";
/***/},
/***/318912:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"344a25d644a19468392479fe2cfd74ed.svg";
/***/},
/***/703325:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"473d1930d4541f9f161ebd996afc3e41.svg";
/***/},
/***/623276:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"b473b31af19d7b066771d785da97976c.svg";
/***/},
/***/440087:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"f116e5b2f707ec1a77be525c145c0fce.svg";
/***/},
/***/820862:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"86115a734ab4913e8c024683c5c894b2.svg";
/***/},
/***/47393:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"4532dbf263b7c6aa4387b0bdd1a4a65d.svg";
/***/},
/***/679789:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"b4d193b6b2d6a0638169cfd61b9f7136.svg";
/***/},
/***/948534:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"bd1c1d21a0edee6be096f1117b24d33b.svg";
/***/},
/***/291432:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"ad16ea85660bbae6c0b419aaef68fd68.svg";
/***/},
/***/498961:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"2c5851f124e75d7e2819be3d152bce8c.svg";
/***/},
/***/82:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"204b1f6b1b726377b26afcd34fddfe2d.svg";
/***/},
/***/391673:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"bb91c79306a90bd8322fb2244f77ec34.svg";
/***/},
/***/814465:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"5d00ab576ab8f697791b54cc716405c5.svg";
/***/},
/***/811957:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"9c3020335c58acc4712f7424250d5af5.svg";
/***/},
/***/780818:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"1c8fc3ae73eb074bfe47ec6c20f6731b.svg";
/***/},
/***/895366:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"5537981e23adeee2e19bdb154c446110.svg";
/***/},
/***/906107:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"eacd3b061d215ab888bd412e37c7211b.svg";
/***/},
/***/821137:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"6858c323c9d4e94bec7b6eb5f3dd9b03.svg";
/***/},
/***/608356:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"a083f1b067bc16c42a0b6a2d2d300128.svg";
/***/},
/***/849476:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"283afaa6f9c0dde185eebb7babb6f6fa.svg";
/***/},
/***/194984:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"0e3063488beb9be7f7a385f65705b9a6.svg";
/***/},
/***/255496:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"29fe6ddc7053edbeeb65eace4e917f40.svg";
/***/},
/***/895252:
/***/function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"f1cecaadbbddf99eae7165ff4e123788.svg";
/***/},
/***/892729:
/***/function(){
/* (ignored) */
/***/}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/11305.js.map