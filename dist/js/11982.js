"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[11982],{
/***/806339:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return WidgetPagination}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/page/widget/utils/WidgetPagination.vue?vue&type=template&id=6b10cd5b
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"fc-widget-pagination"},[_vm.total>0?_c("div",{class:{"fc-black-small-txt-12":!_vm.hideToggle}},[_vm.from!==_vm.to?_c("span",[_vm._v(_vm._s(_vm.from)+" -")]):_vm._e(),_c("span",[_vm._v(_vm._s(_vm.to))]),_vm.hideToggle?_vm._e():[_vm._v(" of "+_vm._s(_vm.total)+" "),_c("span",{staticClass:"el-icon-arrow-left fc-black-small-txt-12 fw-bold f16 pointer mL10 mR5",class:{disable:_vm.from<=1},on:{click:function($event){_vm.from>1&&_vm.prev()}}}),_c("span",{staticClass:"el-icon-arrow-right fc-black-small-txt-12 f16 pointer mR10 fw-bold",class:{disable:_vm.to===_vm.total},on:{click:function($event){_vm.to!==_vm.total&&_vm.next()}}})]],2):_vm._e()])},staticRenderFns=[],WidgetPaginationvue_type_script_lang_js={props:["currentPage","perPage","total","hideToggle"],data:function(){return{from:0,to:0,page:1}},mounted:function(){this.init()},watch:{total:function(){this.init()},currentPage:function(val){val!==this.page&&this.init()}},methods:{init:function(){this.page=this.currentPage||1,this.from=(this.page-1)*this.perPage+1;var to=this.from+this.perPage-1;this.to=this.total>to?to:this.total},next:function(){this.from=this.to+1,this.to+=this.perPage,this.to>this.total&&(this.to=this.total),this.page++,this.updateCurrentPage()},prev:function(){this.to=this.from-1,this.from-=this.perPage,this.from<=1?this.from=this.page=1:this.page--,this.updateCurrentPage()},updateCurrentPage:function(){
// Update currentPage value
this.$emit("update:currentPage",this.page),this.$emit("onChange")}}},utils_WidgetPaginationvue_type_script_lang_js=WidgetPaginationvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(utils_WidgetPaginationvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,WidgetPagination=component.exports},
/***/511982:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FacilioResourcePlanner}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/workorder/FacilioResourcePlanner.vue?vue&type=template&id=5f7331b5
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{ref:"resourcePlanner",staticClass:"facilio-resource-planner",class:[{"full-screen":_vm.isFullScreen}]},[_c("div",{staticClass:"fc-rp-top-bar white-bg inline-flex"},[_c("div",{staticClass:"inline-flex",staticStyle:{width:"41%"}},[_vm._t("plannerLeftTop"),_c("el-button",{staticClass:"mL10 fc-btn-grey-border40 pL20 pR20",on:{click:_vm.todayClicked}},[_vm._v("Today")]),_vm.saving?_c("div",{staticClass:"green-txt-13 pT15 pL10"},[_vm._v("Saving...")]):_vm._e()],2),_c("div",{staticClass:"fc-text-pink bold flex-middle facilio-resource-date-picker-container",staticStyle:{width:"20%"}},[_vm.showPicker?_c("new-date-picker",{staticClass:"facilio-resource-date-picker",attrs:{dateObj:_vm.pickerObj,zone:_vm.timeZone,tabs:_vm.datePickerTabs()},on:{date:_vm.navigateFromPicker}}):_vm._e()],1),_vm.showSettings?_c("el-dialog",{staticClass:"fc-dialog-center-container fc-dialog-center-body-p0",attrs:{title:"Planner Settings",visible:"",width:"30%","append-to-body":""},on:{close:function($event){_vm.showSettings=!1}}},[_c("div",{staticClass:"height450 pL20 pR20"},[_c("settings",{attrs:{settings:_vm.plannerSettings.viewSettings,selectedView:this.currentView,views:_vm.views},on:{close:function($event){_vm.showSettings=!1},saveSettings:_vm.handleSettingsChange}})],1)]):_vm._e(),_vm.showMoveSettings?_c("el-dialog",{staticClass:"fc-dialog-center-container fc-dialog-center-body-p0",attrs:{title:"Default Move action",visible:"",width:"30%","append-to-body":""},on:{close:function($event){_vm.showMoveSettings=!1}}},[_c("div",{staticClass:"height150 pL20 pR20"},[_c("div",{staticClass:"fc-input-label-txt pB10 mT20"},[_vm._v(" On workorder drag and drop ,move ")]),_c("el-select",{staticClass:"fc-input-full-border2 width100",model:{value:_vm.moveTypeSelect,callback:function($$v){_vm.moveTypeSelect=$$v},expression:"moveTypeSelect"}},_vm._l(_vm.moveTypeOptions,(function(option,index){return _c("el-option",{key:index,attrs:{value:option,label:_vm.$t("maintenance.planner.move_type."+option)}})})),1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel ",on:{click:function($event){_vm.showMoveSettings=!1}}},[_vm._v("Cancel ")]),_c("el-button",{staticClass:"modal-btn-save ",on:{click:_vm.saveMoveType}},[_vm._v("Save ")])],1)],1)]):_vm._e(),_vm.showLegendSettings?_c("el-dialog",{staticClass:"fc-dialog-center-container fc-dialog-center-body-p0",attrs:{title:"Legend settings",visible:"",width:"30%","append-to-body":""},on:{close:function($event){_vm.showLegendSettings=!1}}},[_c("div",{staticClass:"height150 pL20 pR20"},[_c("div",{staticClass:"fc-input-label-txt pB10 mT20"},[_vm._v("Color based on")]),_c("el-select",{staticClass:"fc-input-full-border2 width100",model:{value:_vm.legendColorAttribute,callback:function($$v){_vm.legendColorAttribute=$$v},expression:"legendColorAttribute"}},_vm._l(_vm.legendOptions,(function(option,index){return _c("el-option",{key:index,attrs:{value:option.name,label:option.displayName}})})),1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){_vm.showLegendSettings=!1}}},[_vm._v("Cancel")]),_c("el-button",{staticClass:"modal-btn-save",on:{click:_vm.saveLegendSettings}},[_vm._v("Save")])],1)],1)]):_vm._e(),_vm.showColumnSettings?_c("column-settings",{attrs:{settings:_vm.plannerSettings.columnSettings,plannerType:_vm.plannerType},on:{close:function($event){_vm.showColumnSettings=!1},save:_vm.saveColumnSettings}}):_vm._e(),_vm.showTimeMetricSettings?_c("time-metric-settings",{attrs:{settings:_vm.plannerSettings.timeMetricSettings},on:{close:function($event){_vm.showTimeMetricSettings=!1},save:_vm.saveTimeMetricSettings}}):_vm._e(),_c("el-dialog",{staticClass:"fc-dialog-header-hide",attrs:{visible:_vm.showDropOptions,width:"30%","append-to-body":""},on:{"update:visible":function($event){_vm.showDropOptions=$event},closed:_vm.handleClose}},[_c("div",{staticClass:"move-options height150 mL40 mR40"},[_c("div",{staticClass:"label-txt-black line-height20"},[_vm._v(" Do you want to move all subsequent "),_c("br"),_vm._v(" WorkOrders? ")]),_c("el-checkbox",{staticClass:"pT10",model:{value:_vm.dontAskAgain,callback:function($$v){_vm.dontAskAgain=$$v},expression:"dontAskAgain"}},[_vm._v("Don't ask again")]),this.dontAskAgain?_c("div",{staticClass:"mT10 line-height20 fc-grey2 f12"},[_vm._v(" You can change this later in settings ")]):_vm._e(),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-save",on:{click:function($event){return _vm.handleUserDropOption("subsequent")}}},[_vm._v("Yes, Move")]),_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.handleUserDropOption("single")}}},[_vm._v("No, Don't move")])],1)],1)]),_vm.showCard?_c("f-new-popover",{attrs:{id:"customPopover"},on:{close:_vm.handleCardClose}},[_c("template",{slot:"popoverContent"},[_vm._t("card",null,{event:_vm.openTask,col:_vm.gridColumns[_vm.openCell.colIndex]})],2)],2):_vm._e(),_c("div",[_c("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:_vm.views.length>1,expression:"views.length > 1"}],staticClass:"mR20 fc-pm-summary-planner-radio",on:{change:function($event){return _vm.handleViewTabClick($event)}},model:{value:_vm.currentView,callback:function($$v){_vm.currentView=$$v},expression:"currentView"}},_vm._l(_vm.views,(function(view,index){return _c("el-radio-button",{key:index,attrs:{label:view}},[_c("div",[_vm._v(_vm._s(_vm.viewState[view].displayName))])])})),1),_vm._t("plannerRightTop"),_c("el-button-group",{staticClass:"fc-btn-group-white settings-fullscreen"},[_vm.allowUserSettings?_c("el-dropdown",{attrs:{trigger:"click"},on:{command:_vm.handleSettingsDropDown}},[_c("el-button",{staticClass:"fc-icon-hover-parent pm-settings-btn"},[_c("InlineSvg",{attrs:{src:"svgs/setting",iconClass:"icon icon-md"}})],1),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[_c("el-dropdown-item",{attrs:{command:"planner"}},[_vm._v("Planner Settings")]),this.isPMAssetPlanner?_c("el-dropdown-item",{attrs:{command:"moveType"}},[_vm._v("Default move action")]):_vm._e(),this.customizationSettings.columnSettings?_c("el-dropdown-item",{attrs:{command:"column"}},[_vm._v("Column Settings")]):_vm._e(),this.customizationSettings.calendarSettings?_c("el-dropdown-item",{attrs:{command:"timeMetric"}},[_vm._v("Calendar Settings")]):_vm._e(),this.customizationSettings.legendSettings?_c("el-dropdown-item",{attrs:{command:"legend"}},[_vm._v("Legend Settings ")]):_vm._e(),_vm._t("extraSettings")],2)],1):_vm._e(),_c("el-button",{staticClass:"pm-fullscreen-btn fc-icon-hover-parent",on:{click:function($event){_vm.isFullScreen=!_vm.isFullScreen}}},[_c("InlineSvg",{attrs:{src:"svgs/full-screen",iconClass:"icon icon-xl vertical-middle mL10"}})],1),_vm.allowDownload?_c("el-button",{staticClass:"fc-icon-hover-parent pm-printer-btn",on:{click:_vm.printPlanner}},[_c("i",{staticClass:"el-icon-printer f14 fc-black-color align-top"})]):_vm._e()],1)],2)],1),_vm.loading?_c("div",{staticClass:"resource-loading"},[_c("spinner",{attrs:{show:_vm.loading,width:"50",height:"50"}})],1):_c("div",{staticClass:"grid-container white-bg"},[_vm.tableRowData.length>0?_c("div",{ref:"tableContainer",staticClass:"table-container"},[_c("table",{class:[[_vm.currentView]],style:["WEEK"==_vm.currentView?{"table-layout":"fixed"}:{"table-layout":"auto"}],attrs:{cellpadding:"0"}},[_c("thead",{ref:"tableHeader",class:[{"is-grouped":_vm.currentViewState.grouping}]},[_c("tr",[_vm.isServerRows?_vm._l(_vm.resourceHeaders,(function(resourceHeader,index){return _c("th",{key:resourceHeader.name,staticClass:"rp-type-header server-rows",style:{left:151*index+"px"},attrs:{rowspan:_vm.resourceTypeRowSpan}},[_c("div",{staticClass:"rp-type-header-cell text-left"},[_vm._v(" "+_vm._s(_vm.$t("maintenance.planner.colHeaders."+_vm.plannerType+"."+resourceHeader.name))+" ")])])})):_c("th",{staticClass:"rp-type-header",attrs:{rowspan:_vm.resourceTypeRowSpan}},[_c("div",{staticClass:"rp-type-header-cell text-left"},[_vm._t("resourceSelection")],2)]),_vm.currentViewState.grouping?_vm._l(_vm.groupColumns,(function(group,groupIndex){return _c("th",{key:groupIndex,staticClass:"rp-group-header rp-group-boundary",attrs:{colspan:group.gridColumns.length}},[_c("div",{staticClass:"rp-group-header-cell",on:{click:function($event){return _vm.groupHeaderClick(group)}}},[_vm._v(" "+_vm._s(group.label)+" ")])])})):_vm._l(_vm.gridColumns,(function(column){return _c("th",{key:column.start,staticClass:"rp-grid-header"},[_c("div",{staticClass:"rp-grid-header-cell",on:{click:function($event){return _vm.colHeaderClick($event,column)},mousedown:_vm.preventTextSelection}},[_vm._v(" "+_vm._s(column.label)+" ")])])}))],2),_vm.currentViewState.grouping&&_vm.currentViewState.showGridLineHeaders?_c("tr",_vm._l(_vm.gridColumns,(function(column){return _c("th",{key:column.start,staticClass:"rp-grid-header",class:[{"rp-group-boundary":column.isGroupBoundary}]},[_c("div",{staticClass:"rp-grid-header-cell",on:{click:function($event){return _vm.colHeaderClick($event,column)},mousedown:_vm.preventTextSelection}},[_vm._v(" "+_vm._s(column.label)+" ")])])})),0):_vm._e()]),_c("tbody",[_vm._l(_vm.visibleRows,(function(row){return[_vm.resourceGrouping&&null!=_vm.groupingBreaks[row.rowIndex]?_c("tr",{key:"seperator-"+row.rowIndex,staticClass:"rp-seperator-row"},[_c("th",{staticClass:"rp-seperator-item bg-seperator-color",style:{position:"sticky",left:"0px",top:_vm.headerHeight+"px","z-index":12+row.rowIndex},attrs:{colspan:_vm.resourceHeaders.length}},[_c("div",{staticClass:"rp-seperator-item-cell p10"},[_vm.resourceGroupMap[_vm.groupingBreaks[row.rowIndex]].visible?_c("i",{staticClass:"rp-seperator-icon el-icon-arrow-up",on:{click:function($event){return _vm.toggleResourceGroupCollapse(_vm.groupingBreaks[row.rowIndex])}}}):_c("i",{staticClass:"rp-seperator-icon el-icon-arrow-down",on:{click:function($event){return _vm.toggleResourceGroupCollapse(_vm.groupingBreaks[row.rowIndex])}}}),_vm._v(" "+_vm._s(_vm.groupingBreaks[row.rowIndex])+" ")])]),_c("td",{staticClass:"rp-seperator-item-body bg-seperator-color",style:{position:"sticky",top:_vm.headerHeight+"px","z-index":10+row.rowIndex},attrs:{colspan:_vm.gridColumns.length}},[_c("div",{staticClass:"rp-seperator-item-body-cell"})])]):_vm._e(),!_vm.resourceGrouping||row.visibility?_c("tr",{key:row.rowIndex},[_vm.isServerRows?_vm._l(_vm.resourceTitles[row.rowIndex].data,(function(resourceTitle,resourceTitleColIndex){return _c("th",{key:resourceTitleColIndex,staticClass:"rp-resource-item server-rows",style:{left:151*(_vm.resourceHeaders.length-_vm.resourceTitles[row.rowIndex].data.length)+151*resourceTitleColIndex+"px"},attrs:{rowspan:resourceTitle.rowSpan}},[_c("div",{staticClass:"rp-resource-item-cell",style:{position:"sticky",top:_vm.headerHeight+"px"}},[_vm._v(" "+_vm._s(resourceTitle.name)+" ")])])})):_c("th",{staticClass:"rp-resource-item"},[_c("div",{staticClass:"rp-resource-item-cell "},[_vm._v(" "+_vm._s(row.resource.title)+" ")])]),_vm._l(_vm.gridColumns,(function(col,colIndex){return _c("td",{key:row.data[colIndex].cellID,class:[{"rp-group-boundary":col.isGroupBoundary}]},[_c("div",{staticClass:"rp-cell",class:[{"unallowed-date":!!_vm.currentDateCol&&colIndex<=_vm.currentDateCol.index},{"past-date":col.past}],on:{dragover:function($event){return _vm.handleDragOver($event,row.data[colIndex])},drop:function($event){return _vm.handleDrop($event,row.data[colIndex])},dragenter:function($event){return _vm.handleDragEnter($event,row.data[colIndex])},dragleave:function($event){return _vm.handleDragLeave($event,row.data[colIndex])},click:function($event){return _vm.$emit("cellClicked",{cell:row.data[colIndex],col:_vm.gridColumns[colIndex]})}}},_vm._l(row.data[colIndex].tasks,(function(task,index){var _obj;return _c("div",{key:index,staticClass:"rp-task ",class:[(_obj={"task-selected":task.selection},_obj["wo-legend-color-"+task.colorIndex]=null!=task.colorIndex&&-1!=task.colorIndex,_obj)],style:_vm.allowStetch?{width:task.taskSpan*_vm.taskWidth+"px"}:{},attrs:{draggable:_vm.isDragDropAllowed,"data-taskid":task.id},on:{drag:_vm.handleDrag,click:function($event){return $event.stopPropagation(),_vm.handleTaskClick($event,task,row.data[colIndex])},dragstart:function($event){return _vm.handleDragStart($event,task,row.data[colIndex])},dragend:_vm.handleDragEnd}},[_vm._t("taskContent",null,{event:task,displayType:_vm.currentViewState["displayType"]})],2)})),0)])}))],2):_vm._e()]}))],2)])]):_c("div",{staticClass:"resource-empty"},[_c("inline-svg",{attrs:{src:"svgs/emptystate/workorder",iconClass:"icon text-center icon-xxxxlg"}}),_c("div",{staticClass:"nowo-label"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.no_wo_title"))+" ")])],1),_vm.paginate?_c("portal",{attrs:{to:"pmPagination"}},[_c("pagination",{key:"pm-planner-pagination",staticClass:"mR15",attrs:{currentPage:_vm.pageNumber,total:_vm.itemCount,perPage:_vm.pageSize},on:{"update:currentPage":function($event){_vm.pageNumber=$event},"update:current-page":function($event){_vm.pageNumber=$event}}})],1):_vm._e()],1)])])},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),WidgetPagination=(__webpack_require__(879288),__webpack_require__(670560),__webpack_require__(689730),__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),__webpack_require__(478730),__webpack_require__(779307),__webpack_require__(398858),__webpack_require__(461318),__webpack_require__(33228),__webpack_require__(212826),__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(538077),__webpack_require__(947522),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(806339)),CalendarMixin=__webpack_require__(801576),CalendarConstants=__webpack_require__(736663),esm_popper=__webpack_require__(928981),FNewPopovervue_type_template_id_8f11a9c8_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:_vm.hide,expression:"hide"}],staticClass:"position f-new-popover",attrs:{id:"eventpopover"}},[_vm._t("popoverContent")],2)},FNewPopovervue_type_template_id_8f11a9c8_staticRenderFns=[],FNewPopovervue_type_script_lang_js={
//page x page y co ordinates of mouse event
props:["pageX","pageY"],mounted:function(){
// this.positionPopOver(this.pageX, this.pageY)
this.$emit("ready")},data:function(){return{popoverStyle:{left:"0px",top:"0px"}}},methods:{hide:function(){this.$emit("close")}}},components_FNewPopovervue_type_script_lang_js=FNewPopovervue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_FNewPopovervue_type_script_lang_js,FNewPopovervue_type_template_id_8f11a9c8_render,FNewPopovervue_type_template_id_8f11a9c8_staticRenderFns,!1,null,null,null)
/* harmony default export */,FNewPopover=component.exports,NewDatePicker=__webpack_require__(900773),FResourceSettingsvue_type_template_id_f5050eae_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"planner-settings"},[_c("div",{staticClass:"fc-input-label-txt pB10 mT20"},[_vm._v("Select View")]),_c("el-select",{staticClass:"fc-input-full-border2 width100",model:{value:_vm.selectedSettingsView,callback:function($$v){_vm.selectedSettingsView=$$v},expression:"selectedSettingsView"}},_vm._l(_vm.views,(function(view,index){return _c("el-option",{key:index,attrs:{value:view,label:_vm.$t("maintenance.planner.views."+view)}})})),1),_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt pB10"},[_vm._v("Select Gridlines")]),_c("el-select",{staticClass:"grid-select fc-input-full-border2 width100",model:{value:_vm.selectedViewState.gridLines,callback:function($$v){_vm.$set(_vm.selectedViewState,"gridLines",$$v)},expression:"selectedViewState.gridLines"}},_vm._l(_vm.gridLineOptions,(function(option,index){return _c("el-option",{key:index,attrs:{value:option,label:_vm.$t("maintenance.planner.views."+option)}})})),1)],1),_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt pB10"},[_vm._v("Select Grouplines")]),_c("el-select",{staticClass:"group-select fc-input-full-border2 width100",model:{value:_vm.selectedViewState.grouping,callback:function($$v){_vm.$set(_vm.selectedViewState,"grouping",$$v)},expression:"selectedViewState.grouping"}},_vm._l(_vm.groupingOptions,(function(option,index){return _c("el-option",{key:index,attrs:{value:option,label:_vm.$t("maintenance.planner.views."+option)}})})),1)],1),_c("div",{staticClass:"mT20"},[_c("div",{staticClass:"fc-input-label-txt pB10"},[_vm._v("Select Label to show in grid")]),_c("el-select",{staticClass:"label-select fc-input-full-border2 width100",model:{value:_vm.selectedViewState.displayType,callback:function($$v){_vm.$set(_vm.selectedViewState,"displayType",$$v)},expression:"selectedViewState.displayType"}},_vm._l(_vm.labelOptions,(function(option,index){return _c("el-option",{key:index,attrs:{value:option,label:_vm.$t("maintenance.planner.display_type."+option)}})})),1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.$emit("close")}}},[_vm._v("Cancel ")]),_c("el-button",{staticClass:"modal-btn-save ",on:{click:_vm.saveSettings}},[_vm._v("Save ")])],1)],1)},FResourceSettingsvue_type_template_id_f5050eae_scoped_true_staticRenderFns=[],FResourceSettingsvue_type_script_lang_js={props:["settings","selectedView","views"],computed:{selectedViewState:function(){return this.viewSettings[this.selectedSettingsView]},gridLineOptions:function(){switch(this.selectedSettingsView){case"YEAR":return["WEEK","MONTH"];case"MONTH":return["DAY"];case"WEEK":return["DAY"];case"DAY":return["1H","4H"]}return null},groupingOptions:function(){switch(this.selectedSettingsView){case"YEAR":return["MONTH","QUARTER","NONE"];case"MONTH":return["WEEK","NONE"];case"WEEK":return["NONE"];case"DAY":return["4H","NONE"]}return null}},data:function(){return{labelOptions:["subject","dateTime","frequency"],selectedSettingsView:null,viewSettings:null}},created:function(){
//make a copy of settings state , only saved  from parent when 'save' clicked
this.viewSettings=this.$helpers.cloneObject(this.settings),this.selectedSettingsView=this.selectedView},methods:{saveSettings:function(){this.$emit("saveSettings",this.viewSettings)}}},workorder_FResourceSettingsvue_type_script_lang_js=FResourceSettingsvue_type_script_lang_js,FResourceSettings_component=(0,componentNormalizer/* default */.Z)(workorder_FResourceSettingsvue_type_script_lang_js,FResourceSettingsvue_type_template_id_f5050eae_scoped_true_render,FResourceSettingsvue_type_template_id_f5050eae_scoped_true_staticRenderFns,!1,null,"f5050eae",null)
/* harmony default export */,FResourceSettings=FResourceSettings_component.exports,TimeMetricSettingsvue_type_template_id_20af7acd_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticClass:"fc-dialog-center-container fc-dialog-center-body-p0",attrs:{title:"Calendar Settings",visible:"",width:"30%","append-to-body":""},on:{close:function($event){return _vm.$emit("close")}}},[_c("div",{staticClass:"height350 p20 overflow-y-scroll pB50"},[_c("el-checkbox-group",{attrs:{min:1},model:{value:_vm.selectedMetrics,callback:function($$v){_vm.selectedMetrics=$$v},expression:"selectedMetrics"}},[_c("draggable",{model:{value:_vm.timeMetricOptions,callback:function($$v){_vm.timeMetricOptions=$$v},expression:"timeMetricOptions"}},_vm._l(_vm.timeMetricOptions,(function(column,index){return _c("el-checkbox",{key:index,staticClass:"label-txt-black flex-middle p10 fc-input-div-full-border bold mB20 visibility-visible-actions mB10",attrs:{label:column.name}},[_vm.editedOption&&_vm.editedOption.name==column.name?_c("el-input",{ref:"metricInput",refInFor:!0,on:{blur:_vm.renameMetric},nativeOn:{keyup:function($event){return!$event.type.indexOf("key")&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?null:_vm.renameMetric.apply(null,arguments)}},model:{value:_vm.metricNameInput,callback:function($$v){_vm.metricNameInput=$$v},expression:"metricNameInput"}}):_c("span",{on:{dblclick:function($event){return _vm.handleDbclick(column)}}},[_vm._v(" "+_vm._s(column.displayName)+" ")]),_c("InlineSvg",{staticClass:"pm-planner-col-icon cursor-drag visibility-hide-actions",attrs:{src:"svgs/drag-and-drop",iconClass:"icon icon-md fc-grey-svg-color"}})],1)})),1)],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel ",on:{click:function($event){return _vm.$emit("close")}}},[_vm._v("Cancel ")]),_c("el-button",{staticClass:"modal-btn-save ",on:{click:_vm.handleSave}},[_vm._v("Save ")])],1)],1)])},TimeMetricSettingsvue_type_template_id_20af7acd_scoped_true_staticRenderFns=[],vuedraggable_umd=(__webpack_require__(450886),__webpack_require__(909980)),vuedraggable_umd_default=__webpack_require__.n(vuedraggable_umd),TimeMetricSettingsvue_type_script_lang_js={props:{settings:{type:Array}},components:{draggable:vuedraggable_umd_default()},created:function(){this.timeMetricOptions=this.$helpers.cloneObject(this.settings),this.selectedMetrics=this.timeMetricOptions.filter((function(e){return e.enabled})).map((function(e){return e.name}))},data:function(){return{selectedMetrics:[],timeMetricOptions:[],metricNameInput:"",editedOption:null,dragOptions:{handle:".icon-right",ghostClass:"drag-ghost",dragClass:"custom-drag",animation:150}}},methods:{handleDbclick:function(column){var _this=this;this.editedOption=column,this.metricNameInput=column.displayName,this.$nextTick((function(){_this.$refs["metricInput"][0].focus()}))},renameMetric:function(){this.editedOption&&(""==this.metricNameInput?alert("name cannot be empty"):(this.editedOption.displayName=this.metricNameInput,this.editedOption=null))},handleSave:function(){var _this2=this;this.timeMetricOptions.forEach((function(e){-1!=_this2.selectedMetrics.indexOf(e.name)?e.enabled=!0:e.enabled=!1})),this.$emit("save",this.timeMetricOptions)}}},workorder_TimeMetricSettingsvue_type_script_lang_js=TimeMetricSettingsvue_type_script_lang_js,TimeMetricSettings_component=(0,componentNormalizer/* default */.Z)(workorder_TimeMetricSettingsvue_type_script_lang_js,TimeMetricSettingsvue_type_template_id_20af7acd_scoped_true_render,TimeMetricSettingsvue_type_template_id_20af7acd_scoped_true_staticRenderFns,!1,null,"20af7acd",null)
/* harmony default export */,TimeMetricSettings=TimeMetricSettings_component.exports,ColumnSettingsvue_type_template_id_29a709d2_scoped_true_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticClass:"fc-dialog-center-container fc-dialog-center-body-p0",attrs:{title:_vm.$t("common._common.column_settings"),visible:"",width:"30%","append-to-body":""},on:{close:function($event){return _vm.$emit("close")}}},[_c("div",{staticClass:"height350 p20 overflow-y-scroll pB50"},[_c("el-checkbox-group",{model:{value:_vm.selectedColumns,callback:function($$v){_vm.selectedColumns=$$v},expression:"selectedColumns"}},_vm._l(_vm.columnOptions,(function(column,index){return _c("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:"timeMetric"!=column.name,expression:"column.name != 'timeMetric'"}],key:index,staticClass:"label-txt-black flex-middle p10 fc-input-div-full-border bold mB20 visibility-visible-actions mB10",attrs:{label:column.name,disabled:column.mandatory}},[_vm._v(" "+_vm._s(_vm.$t("maintenance.planner.colHeaders."+_vm.plannerType+"."+column.name))+" ")])})),1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel ",on:{click:function($event){return _vm.$emit("close")}}},[_vm._v("Cancel ")]),_c("el-button",{staticClass:"modal-btn-save ",on:{click:_vm.handleSave}},[_vm._v("Save ")])],1)],1)])},ColumnSettingsvue_type_template_id_29a709d2_scoped_true_staticRenderFns=[],ColumnSettingsvue_type_script_lang_js={props:["settings","plannerType"],data:function(){return{columnOptions:[],selectedColumns:[]}},created:function(){this.columnOptions=this.$helpers.cloneObject(this.settings),this.selectedColumns=this.columnOptions.filter((function(e){return e.enabled})).map((function(e){return e.name}))},methods:{handleSave:function(){var _this=this;this.columnOptions.forEach((function(e){-1!=_this.selectedColumns.indexOf(e.name)?e.enabled=!0:e.enabled=!1})),this.$emit("save",this.columnOptions)}}},workorder_ColumnSettingsvue_type_script_lang_js=ColumnSettingsvue_type_script_lang_js,ColumnSettings_component=(0,componentNormalizer/* default */.Z)(workorder_ColumnSettingsvue_type_script_lang_js,ColumnSettingsvue_type_template_id_29a709d2_scoped_true_render,ColumnSettingsvue_type_template_id_29a709d2_scoped_true_staticRenderFns,!1,null,"29a709d2",null)
/* harmony default export */,ColumnSettings=ColumnSettings_component.exports,isNil=__webpack_require__(414293),isNil_default=__webpack_require__.n(isNil),throttle=__webpack_require__(823493),throttle_default=__webpack_require__.n(throttle),Cell=__webpack_require__(911790),InlineSvg=__webpack_require__(586166),element_ui_common=__webpack_require__(364720),validation=__webpack_require__(990260),router=__webpack_require__(329435),FacilioResourcePlannervue_type_script_lang_js={mixins:[CalendarMixin/* default */.Z],props:{plannerType:{type:String},allowDownload:{type:Boolean,default:!1},isRowDragRestrict:{type:Boolean,default:!0},resourceGrouping:{type:Boolean,default:!1},paginate:{type:Boolean,default:!1},pageSize:{type:Number,default:15},isServerRows:{type:Boolean,default:!1},isPMAssetPlanner:{type:Boolean,default:!1},customizationSettings:{type:Object,default:function(){return{}}},saving:{type:Boolean,default:!1},minWidth:{type:String,default:""},allowStetch:{type:Boolean,default:!1},taskWidth:{type:Number,default:56},noDataText:{type:String}},components:{Pagination:WidgetPagination/* default */.Z,settings:FResourceSettings,timeMetricSettings:TimeMetricSettings,columnSettings:ColumnSettings,InlineSvg:InlineSvg/* default */.Z,NewDatePicker:NewDatePicker/* default */.Z,FNewPopover:FNewPopover},data:function(){return{resourceList:[],resourceKey:null,moveTypeOptions:["askEachTime","single","subsequent"],moveTypeSelect:null,showMoveSettings:!1,showColumnSettings:!1,showTimeMetricSettings:!1,showLegendSettings:!1,legendOptions:[{name:"none",displayName:"None"},{name:"timeMetric",displayName:"Calendar"},{name:"category",displayName:"Category"},{name:"priority",displayName:"Priority"},{name:"type",displayName:"Type"},{name:"frequency",displayName:"Frequency"}],legendColorAttribute:null,tableRowData:[],resourceTitles:[],resourceHeaders:[],resourceGroupMap:{},groupingBreaks:{},headerHeight:0,headerWidth:0,resources:[],itemCount:null,pageNumber:1,pageStartIndex:null,pageEndIndex:null,visibleRows:[],dragDrop:{
//task,source are needed but no need to be  reactive
// task: null,
// sourceCell: null,
//hoveredCell: null,
multiSelectItems:[],
// ghostTaskIDs: [],
// dragInProgress: false,
multiSelectCol:null},
// allowCardClose:false,
showDropOptions:!1,showCard:!1,openTask:null,openCell:null,dontAskAgain:!1,moveTaskBuffer:[]}},watch:{pageNumber:function(to,from){var _this=this;to>from?(this.nextPage(),this.$nextTick((function(){_this.$refs["tableContainer"].scrollTop=0}))):(this.prevPage(),this.$nextTick((function(){_this.$refs["tableContainer"].scrollTop=0})))}},created:function(){var _this2=this;
//listen for ESC Key press to exit  full screen
this.escapeListener=function(e){"Escape"===e.key&&(_this2.isFullScreen=!1)},document.addEventListener("keydown",this.escapeListener)},destroyed:function(){document.removeEventListener("keydown",this.escapeListener)},beforeUpdate:function(){this.timeBeforeUpdate=performance.now()},updated:function(){},methods:{generatePages:function(){
//get number of unique resources from resource ID and generate page boundaries with it
//need to find ranges in each page
if(this.resources=[],0!=this.resourceTitles.length){for(var resourceID=this.resourceTitles[0].id,resourceStartIndex=0,i=0;i<this.resourceTitles.length;i++)resourceID!=this.resourceTitles[i].id&&(this.resources.push({resourceID:resourceID,resourceStartIndex:resourceStartIndex,resourceEndIndex:i-1}),resourceID=this.resourceTitles[i].id,resourceStartIndex=i);this.resources.push({resourceID:resourceID,resourceStartIndex:resourceStartIndex,resourceEndIndex:this.resourceTitles.length-1}),this.itemCount=this.resources.length,this.pageStartIndex=0,this.pageEndIndex=this.pageSize-1,this.pageEndIndex>=this.itemCount&&(this.pageEndIndex=this.itemCount-1),this.setVisibleRows()}},prevPage:function(){this.pageStartIndex=(this.pageNumber-1)*this.pageSize,this.pageEndIndex=this.pageNumber*this.pageSize-1,this.pageEndIndex>=this.itemCount&&(this.pageEndIndex=this.itemCount-1),this.setVisibleRows()},nextPage:function(){this.pageStartIndex=(this.pageNumber-1)*this.pageSize,this.pageEndIndex=this.pageNumber*this.pageSize-1,this.pageEndIndex>=this.itemCount&&(this.pageEndIndex=this.itemCount-1),this.setVisibleRows()},setVisibleRows:function(pageStartIndex,pageEndIndex){this.visibleRows=this.tableRowData.slice(this.resources[this.pageStartIndex].resourceStartIndex,this.resources[this.pageEndIndex].resourceEndIndex+1),this.generateResourceGroups()},scrollColToView:function(){if(this.currentDateCol){var scrollAmount=56*this.currentDateCol.index,scrollContainer=this.$refs["tableContainer"];(0,validation/* isEmpty */.xb)(scrollContainer)||(scrollContainer.scrollLeft=scrollAmount)}},printPlanner:function(){var _getApp=(0,router/* getApp */.wx)(),_getApp$linkName=_getApp.linkName,linkName=void 0===_getApp$linkName?"app":_getApp$linkName;linkName="newapp"==linkName?"app":linkName;
//to do ,later get url/route from user as prop
var printUrl=new URL(window.location);printUrl.searchParams.append("paginate",!1),printUrl.searchParams.append("plannerType",this.plannerType),printUrl.pathname="".concat(linkName,"/pdf/pmplanner"),window.open(printUrl.toString())},handleSettingsDropDown:function(command){switch(this.$emit("settings:open",command),command){case"planner":this.showSettings=!0;break;case"moveType":this.moveTypeSelect=this.plannerSettings.moveType,this.showMoveSettings=!0;break;case"column":this.showColumnSettings=!0;break;case"timeMetric":this.showTimeMetricSettings=!0;break;case"legend":this.legendColorAttribute=this.plannerSettings.legendSettings[0].name,this.showLegendSettings=!0;break}},loadSettings:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,_this3.$http.post("v2/pmplanner/settings",{settings:{plannerType:CalendarConstants/* PlannerTypes */.W$[_this3.plannerType]}});case 3:return resp=_context.sent,_context.abrupt("return",resp.data.result.settings);case 7:_context.prev=7,_context.t0=_context["catch"](0);case 10:case"end":return _context.stop()}}),_callee,null,[[0,7]])})))()},handleSettingsChange:function(viewSettings){var _this4=this;this.plannerSettings.viewSettings=viewSettings,this.showSettings=!1,this.saveSettingsRequest().then((function(resp){_this4.initPlanner()})).catch((function(e){}))},saveMoveType:function(){this.plannerSettings.moveType=this.moveTypeSelect,this.saveSettingsRequest(),this.showMoveSettings=!1},saveColumnSettings:function(columnSettings){var _this5=this;this.showColumnSettings=!1,this.plannerSettings.columnSettings=columnSettings,this.saveSettingsRequest().then((function(){_this5.initPlanner()}))},saveTimeMetricSettings:function(timeMetricSettings){var _this6=this;this.showTimeMetricSettings=!1,this.plannerSettings.timeMetricSettings=timeMetricSettings,this.saveSettingsRequest().then((function(){_this6.initPlanner()}))},saveLegendSettings:function(){var _this7=this;this.plannerSettings.legendSettings=[{name:this.legendColorAttribute,displayName:this.legendOptions.find((function(e){return e.name==_this7.legendColorAttribute})).displayName}],this.showLegendSettings=!1,this.saveSettingsRequest().then((function(){_this7.initPlanner()}))},saveSettingsRequest:function(){var _this8=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var metricsEnabledCount,url,resp;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,isNil_default()(_this8.plannerSettings.timeMetricSettings)||(
//not null or undefined , but [] is valid
metricsEnabledCount=_this8.plannerSettings.timeMetricSettings.filter((function(e){return e.enabled})).length,
//if more than one metric is selected , show the calendar column else hide it
//time metric column is last
_this8.plannerSettings.columnSettings[3].enabled=metricsEnabledCount>1),url="v2/pmplanner/update/settings",_context2.next=5,_this8.$http.post(url,{settings:_this8.plannerSettings});case 5:return resp=_context2.sent,_context2.abrupt("return",resp);case 9:throw _context2.prev=9,_context2.t0=_context2["catch"](0),_context2.t0;case 13:case"end":return _context2.stop()}}),_callee2,null,[[0,9]])})))()},
// gridColumnClass(column) {
//   console.log('grid col class method')
//   if (column.start <= this.currentDate && this.currentDate < column.end) {
//     return 'current-date'
//   }
// },
handleClose:function(){this.userDropOptionPromise("single")},handleCardClose:function(){
// if(this.allowCardClose){
this.showCard=!1,this.openTask=null,this.openCell=null},groupHeaderClick:function(group){this.goToRange(group.start,this.viewState[this.currentView].grouping),this.setPicker()},colHeaderClick:function(event,column){event.shiftKey?this.selectAll(column):(this.goToRange(column.start,this.viewState[this.currentView].gridLines),this.setPicker())},preventTextSelection:function(){event.shiftKey&&event.preventDefault()},isDropAllowed:function(sourceCell,destinationCell){if(!sourceCell.equals(destinationCell)){
//allow drop only if greater than current date and drop across rows is permitted
var isValidTime=sourceCell.colId>this.currentDate&&destinationCell.colId>this.currentDate;if(isValidTime){var isDragAlowed=!this.isRowDragRestrict||sourceCell.rowIndex==destinationCell.rowIndex;return isDragAlowed||element_ui_common.Message.info("Can't reschedule across rows"),isDragAlowed}return element_ui_common.Message.info("Can't reschedule  events to/from past dates"),!1}},
// dropTargetClass(cell) {
//   console.log('drop target class called')
//   if (cell.equals(this.dragDrop.hoveredCell)) {
//     //this indicates the currently hovered cell ,
//     if (this.dragDrop.hoveredCell.colId > this.currentDate) {
//       console.log('valid drop target')
//       return 'valid-drop-target'
//     } else {
//       return 'invalid-drop-target'
//     }
//   } else {
//     return 'task-list-plain'
//   }
// },
handleDrag:function(e){
//console.log("drag fired");
this.handleScroll(e);
// if(this.isMultiSelect)
// {
//     this.moveDragGhost(
//     e.clientX - this.originalX,
//     e.clientY - this.originalY
//   );
// }
// if (this.plannerSettings.moveType == 'subsequent' || this.isMultiSelect) {
//   this.moveDragGhost(
//     e.clientX - this.originalX,
//     e.clientY - this.originalY
//   )
// }
},
//reset to zero once done on dragend, this must always succed so dont throttle
resetDragGhost:function(){
//console.log('drag ghost reset')
this.drawCustomGhost(0,0)},
//this needs to be throttled to be smooth
moveDragGhost:throttle_default()((function(offSetX,offSetY){this.drawCustomGhost(offSetX,offSetY)}),50),
//adjust this throttle to render a smooth ghost
drawCustomGhost:function(offSetX,offSetY){if(this.dragDrop.dragInProgress&&0!=this.dragDrop.ghostTaskIDs.length)
//console.log('drawing ghost',offSetX,offSetY)
{var selectQuery="";this.dragDrop.ghostTaskIDs.forEach((function(taskId){selectQuery+="div[data-taskid='".concat(taskId,"'],")})),selectQuery=selectQuery.substring(0,selectQuery.length-1);
// console.log(selectQuery)
var taskNodes=document.querySelectorAll(selectQuery);taskNodes.forEach((function(taskNode){
//needed for smooth animation
// requestAnimationFrame(() => {
// // taskNode.style.position='absolute'
// //taskNode.style.transform = `translate(${offSetX}px,${offSetY}px)`;
// taskNode.style.left = offSetX + "px";
// taskNode.style.top = offSetY + "px";
// });
}))}},handleScroll:throttle_default()((function(mouseEvent){var scrollContainer=this.$refs["tableContainer"],containerRect=scrollContainer.getBoundingClientRect(),topPoint=containerRect.top+this.$refs["tableHeader"].offsetHeight,bottomPoint=containerRect.top+scrollContainer.offsetHeight,rightPoint=containerRect.left+scrollContainer.offsetWidth,leftPoint=containerRect.left+150;
//start scrolling up when mouse reaches header
// 150px is header col sticky
//left scroll triggered when drag reaches  fixed col to the left
this.isServerRows&&(leftPoint=containerRect.left+150*this.resourceHeaders.length);var scrollMeta={};
//vertical scroll  up
mouseEvent.clientY<topPoint?scrollMeta.scrollTop=-25:mouseEvent.clientY>bottomPoint&&(scrollMeta.scrollTop=25),
//horizontal scroll left , right
mouseEvent.clientX<leftPoint?scrollMeta.scrollLeft=-25:mouseEvent.clientX>rightPoint&&(scrollMeta.scrollLeft=25),this.$helpers.isEmpty(scrollMeta)||this.scrollContainer(scrollMeta)}),100),scrollContainer:function(scrollMeta){var container=this.$refs["tableContainer"];scrollMeta.scrollTop&&(container.scrollTop+=scrollMeta.scrollTop),scrollMeta.scrollLeft&&(container.scrollLeft+=scrollMeta.scrollLeft)},handleTaskClick:function(event,task,cell){var _this9=this;event.shiftKey?this.selectTask(task,cell):
// this.openTask.pageX=event.pageX
// this.openTask.pageY=event.pageY
setTimeout((function(){
//check and remove settimeout usage
_this9.openCell=cell,_this9.openTask=task,
//close old card and then show new one
_this9.showCard=!1,_this9.$nextTick((function(){_this9.showCard=!0,_this9.$nextTick((function(){_this9.$emit("eventClick",{event:_this9.openTask,displayType:_this9.currentViewState["displayType"],col:_this9.gridColumns[_this9.openCell.colIndex]}),_this9.positionPopOver()}))}))}),0)},positionPopOver:function(){var popper=this.$refs["resourcePlanner"].querySelector("#customPopover"),scrollContainer=this.$refs["tableContainer"],reference=scrollContainer.querySelector("div[data-taskid= '".concat(this.openTask.id,"']"));new esm_popper["default"](reference,popper,{placement:"right",modifiers:{preventOverflow:{enabled:!0,boundariesElement:scrollContainer}}})},selectTask:function(task,cell){var selectAll=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isPMAssetPlanner)//multi select not allowed in staff view
if(task.selection){if(selectAll)return;//don't unselect already selected during all selection
task.selection=!1;var taskIndex=this.dragDrop.multiSelectItems.findIndex((function(e){return task.id==e.task.id}));this.dragDrop.multiSelectItems.splice(taskIndex,1)}else{
if(this.isMultiSelect&&cell.colIndex!=this.dragDrop.multiSelectCol)return void element_ui_common.Message.info("Select multiple items within same column");this.dragDrop.multiSelectCol=cell.colIndex,task.selection=!0,this.dragDrop.multiSelectItems.push({task:task,sourceCell:cell})}},selectAll:function(column){var _this10=this,colIndex=column.index,totalTaskCount=0;
//get total number of tasks in row
this.visibleRows.forEach((function(row){row.data[colIndex].tasks.forEach((function(task){totalTaskCount++}))}));
//true is select all , false is deselect All , delect shoud be done only when all tasks are already selected
var isSelectAll=totalTaskCount!=this.dragDrop.multiSelectItems.length;this.visibleRows.forEach((function(row){row.data[colIndex].tasks.forEach((function(task){_this10.selectTask(task,row.data[colIndex],isSelectAll)}))}))},clearAllSelections:function(){this.dragDrop.multiSelectItems.forEach((function(e){e.task.selection=!1})),this.dragDrop.multiSelectItems=[]},handleDragStart:function(e,task,cell){
//e.dataTransfer.setDragImage(document.createElement('span'),0,0)
if(this.isMultiSelect&&!this.dragDrop.multiSelectItems.find((function(e){return task.id==e.task.id})))return e.preventDefault(),!1;
//  this.dragDrop.dragInProgress = true
e.dataTransfer.setData("text/plain","dummy"),
//without set timeout ghost won't be drawn as item is hidden before being dragged
//setTimeout(() => e.target.classList.add('hide'), 0)
requestAnimationFrame((function(){e.target.classList.add("hide")})),this.dragDrop.task=task,this.dragDrop.sourceCell=cell,
// e.preventDefault()
this.originalX=e.clientX,this.originalY=e.clientY},getAllNextInrowTaskIds:function(cell){for(var allMatchedTasksIds=[],colIndex=cell.colIndex,rowIndex=cell.rowIndex,i=colIndex;i<this.tableRowData[rowIndex].data.length;i++)this.tableRowData[rowIndex].data[i].tasks.forEach((function(task){
// if(task.id==this.dragDrop.task.id)return
allMatchedTasksIds.push(task.id)}));return allMatchedTasksIds},handleDrop:function(e,destinationCell){
// let colDisplacement = destinationCell.colIndex - this.dragDrop.sourceCell.colIndex;
if(e.preventDefault(),this.isDropAllowed(this.dragDrop.sourceCell,destinationCell)){
//this.dragDrop.dragInProgress = false
//single or subsequent move option available for PM PLanner asset view
if(this.isPMAssetPlanner)return void this.extraDropOptions(this.dragDrop.task,this.dragDrop.sourceCell,destinationCell);this.handleNormalDragDrop(this.dragDrop.task,this.dragDrop.sourceCell,destinationCell)}},handleNormalDragDrop:function(draggedTask,sourceCell,destinationCell){this.moveWorkOrder(draggedTask,sourceCell,destinationCell)},
//only for PM Planner asset view , single ,subsequent,with and without modal case
extraDropOptions:function(draggedTask,sourceCell,destinationCell){var _this11=this;"askEachTime"==this.plannerSettings.moveType?(
//show dialog case
this.isMultiSelect?this.moveWorkOrderMultiple(sourceCell,destinationCell):this.moveWorkOrder(draggedTask,sourceCell,destinationCell),
//show modal after item has moved
this.$nextTick((function(){
// setTimeout(() => {
_this11.promptUserDropAction().then((function(option){
//this.plannerSettings.moveType = option;
"subsequent"==option&&(_this11.isMultiSelect?_this11.moveSubsequentWorkOrdersMultiple(sourceCell,destinationCell):_this11.clearAllSelections(),_this11.moveSubsequentWorkOrders(draggedTask,sourceCell,destinationCell)),
// this.userDropOptionPromise = null;
_this11.showDropOptions=!1,_this11.clearAllSelections()}));
// }, 100);
}))):"single"==this.plannerSettings.moveType?(this.isMultiSelect?this.moveWorkOrderMultiple(sourceCell,destinationCell):this.moveWorkOrder(draggedTask,sourceCell,destinationCell),this.clearAllSelections()):"subsequent"==this.plannerSettings.moveType&&(this.isMultiSelect?this.moveWorkOrderMultiple(sourceCell,destinationCell):this.moveWorkOrder(draggedTask,sourceCell,destinationCell),this.isMultiSelect?this.moveSubsequentWorkOrdersMultiple(sourceCell,destinationCell):this.moveSubsequentWorkOrders(draggedTask,sourceCell,destinationCell),this.clearAllSelections())},
//move one workorder per row but multiple selected in the same column
moveWorkOrderMultiple:function(sourceCell,destinationCell){var _this12=this,colDisplacement=destinationCell.colIndex-sourceCell.colIndex;this.dragDrop.multiSelectItems.forEach((function(e){_this12.moveWorkOrder(e.task,e.sourceCell,_this12.tableRowData[e.sourceCell.rowIndex].data[e.sourceCell.colIndex+colDisplacement])}))},moveWorkOrder:function(draggedTask,sourceCell,destinationCell){var emitEvent=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],colDisplacement=destinationCell.colIndex-sourceCell.colIndex;draggedTask.start=this.getNextTimeStamp(draggedTask.start,this.currentViewState.gridLines,colDisplacement),
//recalculate formatted label string when task date changes
this.formatLabel(draggedTask),this.spliceAndInsertTask(draggedTask,sourceCell,destinationCell),emitEvent&&this.$emit("dropped",{event:draggedTask,sourceCell:sourceCell,destinationCell:destinationCell})},
//for subsequent move task that was dragged has already moved,so no need to move it again
moveSubsequentWorkOrdersMultiple:function(sourceCell,destinationCell){var _this13=this,colDisplacement=destinationCell.colIndex-sourceCell.colIndex;this.dragDrop.multiSelectItems.forEach((function(e){_this13.moveSubsequentWorkOrders(e.task,e.sourceCell,_this13.tableRowData[e.sourceCell.rowIndex].data[e.sourceCell.colIndex+colDisplacement])}))},moveSubsequentWorkOrders:function(draggedTask,draggedSourceCell,destinationCell){for(var _this14=this,colDisplacement=destinationCell.colIndex-draggedSourceCell.colIndex,dragColIndex=draggedSourceCell.colIndex,rowIndex=draggedSourceCell.rowIndex,newPositions=[],i=dragColIndex;i<this.gridColumns.length;i++)newPositions.push.apply(newPositions,(0,toConsumableArray/* default */.Z)(this.calculateNewPostion(draggedTask,this.tableRowData[rowIndex].data[i],colDisplacement)));newPositions.forEach((function(e){_this14.spliceAndInsertTask(e.task,e.sourceCell,e.destinationCell),_this14.$emit("dropped",{event:e.task,sourceCell:e.sourceCell,destinationCell:e.destinationCell})}))},calculateNewPostion:function(draggedTask,sourceCell,colDisplacement){var _this15=this,newPosOfTasksInCell=[];
//for each cell move all tasks by amount user moved draggedTask
return sourceCell.tasks.forEach((function(task){var newTime=_this15.getNextTimeStamp(task.start,_this15.currentViewState.gridLines,colDisplacement);if(newTime>=_this15.gridColumns[0].start&&newTime<_this15.gridColumns[_this15.gridColumns.length-1].end&&(!_this15.currentDateCol||newTime>=_this15.currentDateCol.end)&&draggedTask.id!=task.id){var destinationCell=_this15.tableRowData[sourceCell.rowIndex].data[sourceCell.colIndex+colDisplacement];
//mutate the start time to new cell time
task.start=newTime,_this15.formatLabel(task),
//refresh the label when date changes
newPosOfTasksInCell.push({task:task,sourceCell:sourceCell,destinationCell:destinationCell})}})),newPosOfTasksInCell},spliceAndInsertTask:function(task,sourceCell,destinationCell){var _this16=this;
//change resource key to reflect new row
this.isRowDragRestrict||(
//to do , dont get resourcekey dynamically
task[this.resourceKey]=this.tableRowData[destinationCell.rowIndex].resource.id);var deleteIndex=sourceCell.tasks.findIndex((function(e){return e.id==task.id}));sourceCell.tasks.splice(deleteIndex,1);var insertIndex=destinationCell.tasks.findIndex((function(e){return _this16.start<e.start}));-1==insertIndex&&(insertIndex=destinationCell.tasks.length),destinationCell.tasks.splice(insertIndex,0,task)},handleDragEnd:function(e){e.target.classList.contains("hide")&&e.target.classList.remove("hide");
//this.resetDragGhost()
// this.dragDrop.ghostTaskIDs = []
// this.dragDrop.dragInProgress = false
//this.clearAllSelections()
// this.dragDrop.hoveredCell = null
},handleDragEnter:function(e,cell){e.preventDefault()},handleDragOver:function(e,cell){
//console.log(e,hoveredCell);
// if(this.currentDate.valueOf()<this.dra)
e.preventDefault();
// console.log("drag over");
},handleDragLeave:function(){},handleUserDropOption:function(option){this.dontAskAgain&&(this.plannerSettings.moveType=option,this.saveSettingsRequest()),this.userDropOptionPromise(option),this.dontAskAgain=!1},promptUserDropAction:function(){var _this17=this;return this.showDropOptions=!0,new Promise((function(resolve){_this17.userDropOptionPromise=resolve}))},
/**
     * maintain planner date state , refresh the grid alone
     */
refreshGrid:function(){this.loading=!0,this.emitViewChanged()},
/**
     * call this to render the planner with given tasks and resources
     *
     * @param {taskList} - List of tasks to render
     * @param {resourceList} - List of resources
     * @param {resourceKey} - which field in task listed is mapped to resourcelist
     */
renderPlanner:function(taskList,resourceList,resourceKey){var _this18=this;
// this.resourceMeta=resourceMeta
// this.allResources=allResources
//console.time();
this.resourceList=resourceList,this.taskList=taskList,this.resourceKey=resourceKey,this.generateColumnData(),this.spreadTasksToColumns(),this.generateRowData(),
//console.timeEnd();
this.paginate?this.generatePages():this.visibleRows=this.tableRowData,this.loading=!1,this.$nextTick((function(){_this18.$emit("ready"),_this18.scrollColToView()}))},setHeaderHeight:function(){this.headerHeight=this.$refs["tableHeader"].offsetHeight},renderPlannerNew:function(resourceHeaders,resourceTitles,taskData){var _this19=this;performance.now();this.resourceHeaders=resourceHeaders,this.resourceTitles=resourceTitles,this.generateColumnData(),this.processServerRows(taskData),this.resourceGroupMap={},this.groupingBreak={},this.paginate?
//for paginated case ,generate resource groups per page
this.generatePages():(this.visibleRows=this.tableRowData,this.resourceGrouping&&this.generateResourceGroups()),this.loading=!1,this.$nextTick((function(){_this19.$emit("ready"),_this19.setHeaderHeight(),_this19.scrollColToView()}))},
//new method , server rows,copied code , TODO , refractor to common format
processServerRows:function(data){var _this20=this;performance.now();this.tableRowData=[],data.forEach((function(rowTasks,rowIndex){for(
//initialize an  array of columns with cell object for each row
var rowColumns=[],i=0;i<_this20.gridColumns.length;i++){var cell=new Cell/* default */.Z(null,_this20.gridColumns[i].start,rowIndex,i);cell.tasks=[],rowColumns.push(cell)}var colIndex=0;rowTasks.some((function(task){_this20.formatLabel(task);
//iterate through rowTasks list,
//for each task go to the correct grid(column) and insert
while(task.start>=_this20.gridColumns[colIndex].end)if(colIndex++,task.start>=_this20.gridColumns[_this20.gridColumns.length-1].end)return!0;
//break out of loop when one of the tasks exceeds end column in grid
return _this20.$set(task,"selection",!1),rowColumns[colIndex].tasks.push(task),!1;//some func  false calls next interation , true breaks loop
})),_this20.tableRowData.push({data:rowColumns,rowIndex:rowIndex,visibility:!0})}))},generateResourceGroups:function(){var _this21=this;this.groupingBreaks={},this.resourceGroupMap={},
//this.visibleRows.forEach(visibleRow=>{visibleRow.visibility=true})
//to do , see if it's possible to maintain state across pages
this.visibleRows.forEach((function(visibleRow){visibleRow.visibility=!0;//this is row visiblity
var rg=_this21.resourceTitles[visibleRow.rowIndex].resourceGroup;_this21.resourceGroupMap[rg]?_this21.resourceGroupMap[rg].resources.push(visibleRow.rowIndex):(_this21.resourceGroupMap[rg]={resources:[visibleRow.rowIndex],visible:!0},_this21.groupingBreaks[visibleRow.rowIndex]=rg)}))},toggleResourceGroupCollapse:function(resourceGroup){var _this22=this;this.resourceGroupMap[resourceGroup].visible=!this.resourceGroupMap[resourceGroup].visible,this.resourceGroupMap[resourceGroup].resources.forEach((function(e){_this22.tableRowData[e].visibility=_this22.resourceGroupMap[resourceGroup].visible}))},generateRowData:function(){var _this23=this;
///generate column Data for el table
this.tableRowData=[];
// this.tableColData.unshift({ prop: "resource", label: "Staff" });
//generate row data for el table
//create a map resource count , use that later to sort the resource list in order of maximum assigned tasks
var resourceTaskCountMap={};this.resourceList.forEach((function(resource,rowIndex){resourceTaskCountMap[resource.id]=0;var row={};
//row data structure : resource={} , data=[{cell},{cell}....]
row.resource=resource,row.data=[],row.rowIndex=rowIndex,_this23.gridColumns.forEach((function(column,colIndex){var cell=new Cell/* default */.Z(resource.id,column.start,rowIndex,colIndex);cell.tasks=[],cell.tasks=column.tasks.filter((function(task){return task[_this23.resourceKey]==resource.id})),cell.tasks.forEach((function(task){
//if tasks have an end time , need to set
if(task.end&&_this23.allowStetch){var taskLength=task.end-task.start,taskSpan=Math.ceil(taskLength/_this23.getGridLength());_this23.$set(task,"taskSpan",taskSpan)}})),
// row[column.prop] = cell;
row.data[colIndex]=cell,resourceTaskCountMap[resource.id]+=row.data[colIndex].tasks.length})),_this23.tableRowData.push(row)}))},formatLabel:function(task){task.dateTime=this.$helpers.getOrgMoment(task.start).format(this.getLabelFormat(this.viewState[this.currentView].gridLines))},getGridLength:function(){return this.gridColumns[1].start-this.gridColumns[0].start},deleteEvent:function(taskID){
//need to find the event and delete it from the table structure
var eventDetails=this.getEventDetails(taskID);eventDetails.cell.tasks.splice(eventDetails.taskIndex,1),this.handleCardClose()},
//currently used only in staff view
reAssignResource:function(taskID,newResourceID){var eventDetails=this.getEventDetails(taskID),task=eventDetails.task,sourceCell=eventDetails.cell,newColIndex=sourceCell.colIndex,newRowIndex=this.tableRowData.findIndex((function(row){return row.resource.id==newResourceID})),destinationCell=this.tableRowData[newRowIndex].data[newColIndex];this.moveWorkOrder(task,sourceCell,destinationCell),this.handleCardClose()},getEventDetails:function(taskID){var eventDetails=null;
//can't use return to break out of foreach inside foreach
return this.tableRowData.forEach((function(row){row.data.forEach((function(cell){cell.tasks.forEach((function(task,taskIndex){task.id!=taskID||(eventDetails={task:task,taskIndex:taskIndex,cell:cell})}))}))})),eventDetails}},computed:{isMultiSelect:function(){return 0!=this.dragDrop.multiSelectItems.length},gridColHeaderClass:function(){return this.viewState[this.currentView].showGridLineHeaders?"grid-col-header":"grid-col-header-hide"},resourceTypeRowSpan:function(){return this.currentViewState.showGridLineHeaders||this.currentViewState.grouping?2:1}}},workorder_FacilioResourcePlannervue_type_script_lang_js=FacilioResourcePlannervue_type_script_lang_js,FacilioResourcePlanner_component=(0,componentNormalizer/* default */.Z)(workorder_FacilioResourcePlannervue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,FacilioResourcePlanner=FacilioResourcePlanner_component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/11982.js.map