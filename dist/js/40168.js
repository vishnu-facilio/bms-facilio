"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[40168],{
/***/929593:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return FPagination}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/list/FPagination.vue?vue&type=template&id=7641710c&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.total>0?_c("div",{staticClass:"flex-center-row-space mT-5",class:{"fc-black-small-txt-12":!_vm.hideToggle}},[_c("el-popover",{attrs:{placement:"bottom",trigger:"click",disabled:_vm.disablePopup}},[_c("span",{staticClass:"p8 pointer",class:[!_vm.disablePopup&&"button-hover"],attrs:{slot:"reference"},slot:"reference"},[_vm.from!==_vm.to?_c("span",[_vm._v(_vm._s(_vm.from)+" - ")]):_vm._e(),_c("span",[_vm._v(_vm._s(_vm.to))]),_vm._v(" of "+_vm._s(_vm.total)+" ")]),_c("el-pagination",{attrs:{layout:"prev, pager, next",total:_vm.total,"pager-count":5,"page-size":_vm.perPage,"current-page":_vm.page},on:{"current-change":_vm.handleCurrentChange,"update:pageSize":function($event){_vm.perPage=$event},"update:page-size":function($event){_vm.perPage=$event},"update:currentPage":function($event){_vm.page=$event},"update:current-page":function($event){_vm.page=$event}}})],1),_vm.hideToggle?_vm._e():_c("span",[_c("span",{staticClass:"el-icon-arrow-left pagination-arrow fc-black-small-txt-12 f16 fw-bold pointer p5",class:{disable:_vm.from<=1},on:{click:function($event){_vm.from>1&&_vm.prev()}}}),_c("span",{staticClass:"el-icon-arrow-right pagination-arrow fc-black-small-txt-12 f16 fw-bold pointer p5",class:{disable:_vm.to===_vm.total},on:{click:function($event){_vm.to!==_vm.total&&_vm.next()}}})])],1):_vm._e()])},staticRenderFns=[],router=(__webpack_require__(879288),__webpack_require__(670560),__webpack_require__(329435)),FPaginationvue_type_script_lang_js={props:{total:[Number,String],perPage:Number,hideToggle:{type:Boolean,default:!1},pageNo:Number,hidePopover:{type:Boolean,default:!1}},data:function(){return{from:0,to:0,page:1}},created:function(){(0,router/* isWebTabsEnabled */.tj)()&&document.addEventListener("keydown",this.keyDownHandler)},mounted:function(){this.init()},beforeDestroy:function(){(0,router/* isWebTabsEnabled */.tj)()&&document.removeEventListener("keydown",this.keyDownHandler)},computed:{pageQuery:function(){var _ref=this.$route||{},query=_ref.query,_ref2=query||{},page=_ref2.page;return parseInt(page)||1},hasMorePage:function(){return this.total/this.perPage>1},disablePopup:function(){return this.hidePopover||!this.hasMorePage}},watch:{total:function(){this.init()},pageQuery:function(){this.init()}},methods:{init:function(){if(this.page=this.pageQuery,this.from=(this.page-1)*this.perPage+1,this.from>this.total&&this.from&&this.from>0&&this.total&&this.total>0)this.reset();else{var to=this.from+this.perPage-1;this.to=this.total>to?to:this.total}},handleCurrentChange:function(val){this.page=val,this.from=(this.page-1)*this.perPage+1,this.to=this.total>=this.from+this.perPage?this.from+this.perPage-1:this.total,this.setPage()},next:function(){this.from=this.to+1,this.to+=this.perPage,this.to>this.total&&(this.to=this.total),this.page++,this.setPage()},prev:function(){this.to=this.from-1,this.from-=this.perPage,this.from<=1?this.from=this.page=1:this.page--,this.setPage()},reset:function(){this.page=1,this.setPage(!0)},setPage:function(isReset){if(this.pageNo)this.$emit("onPageChanged",this.page);else{var query={};Object.assign(query,this.$route.query),query?query.page=this.page:query={page:this.page},this.$router.push({query:query}),isReset||this.$emit("onPageChanged",this.page)}},keyDownHandler:function(e){e.shiftKey&&("ArrowRight"===e.key&&this.to!==this.total?this.next():"ArrowLeft"===e.key&&this.from>1&&this.prev())}}},list_FPaginationvue_type_script_lang_js=FPaginationvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(list_FPaginationvue_type_script_lang_js,render,staticRenderFns,!1,null,"7641710c",null)
/* harmony default export */,FPagination=component.exports},
/***/240168:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ModuleActionList}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/notificationAndWorkflows/ModuleActionList.vue?vue&type=template&id=99e2a334
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"height100 overflow-hidden"},[_c("div",{staticClass:"setting-header2"},[_c("div",{staticClass:"setting-title-block"},[_c("div",{staticClass:"setting-form-title capitalize"},[_vm._v(" "+_vm._s(_vm.title)+" "+_vm._s(_vm.currentAction)+" ")]),_c("div",{staticClass:"heading-description"},[_vm._v(" "+_vm._s(_vm.$t("setup.list.list_of_all"))+" "+_vm._s(_vm.title)+" "+_vm._s(_vm.currentAction)+" ")])]),_vm.$validation.isEmpty(_vm.modules)?_vm._e():_c("div",{staticClass:"action-btn setting-page-btn"},[_c("el-button",{staticClass:"setup-el-btn",attrs:{type:"primary"},on:{click:function($event){_vm.showNewCustomRule=!0,_vm.isNew=!0}}},[_vm._v(_vm._s(_vm.$t("setup.add.add"))+_vm._s(_vm.currentActionTab.name))]),_vm.showNewCustomRule?_c("new-custom-type-rule",{attrs:{module:_vm.modules.name,moduleDisplayName:_vm.modules.displayName,isNew:_vm.isNew,selectedRuleId:_vm.selectedRuleId,visibilityshow:_vm.showNewCustomRule,ruleType:_vm.currentRuleType,activityTypes:_vm.activityTypes,ruleActions:_vm.currentActionTab.actions,currentAction:_vm.currentAction},on:{"update:visibilityshow":function($event){_vm.showNewCustomRule=$event},actionSaved:_vm.actionOnSave}}):_vm._e()],1)]),_c("div",{staticClass:"flex-middle setting-Rlayout",staticStyle:{"justify-content":"space-between"}},[_c("portal-target",{attrs:{name:"automation-modules"}}),_c("pagination",{staticClass:"nowrap",attrs:{currentPage:_vm.page,total:_vm.totalCount,perPage:10},on:{"update:currentPage":function($event){_vm.page=$event},"update:current-page":function($event){_vm.page=$event}}})],1),_c("div",{staticClass:"container-scroll mT30"},[_c("div",{staticClass:"row setting-Rlayout"},[_c("div",{staticClass:"col-lg-12 col-md-12"},[_c("table",{staticClass:"setting-list-view-table"},[_c("thead",[_c("tr",[_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.rule_name"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("setup.approvalprocess.executeon"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("rule.create.actions"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.status"))+" ")]),_c("th",{staticClass:"setting-table-th setting-th-text"})])]),_vm.loading?_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_c("spinner",{attrs:{show:_vm.loading,size:"80"}})],1)])]):_vm.workFlowRules.length?_c("tbody",_vm._l(_vm.workFlowRules,(function(rule,index){return _c("tr",{key:index,staticClass:"tablerow"},[_c("td",[_vm._v(_vm._s(rule.name))]),_c("td",[_vm._v(_vm._s(_vm.checkActivityType(rule.event.activityType)))]),_c("td",[rule.actions?_c("div",{staticStyle:{display:"flex",position:"relative"}},_vm._l(_vm.setActionText(rule.actions),(function(actionText,idx){return _c("div",{key:idx,staticStyle:{"margin-right":"10px"}},["SMS"===actionText?_c("el-tag",{attrs:{size:"small"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Email"===actionText?_c("el-tag",{attrs:{size:"small",type:"danger"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Mobile"===actionText?_c("el-tag",{attrs:{size:"small",type:"info"}},[_vm._v(_vm._s(_vm.$t("setup.customButton.app")))]):_vm._e(),"Whatsapp"===actionText?_c("el-tag",{attrs:{size:"small",type:"success"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Call"===actionText?_c("el-tag",{attrs:{size:"small",type:"warning"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Create WorkOrder"===actionText?_c("el-tag",{attrs:{size:"small",type:"warning"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Close WorkOrder"===actionText?_c("el-tag",{attrs:{size:"small",type:"warning"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Field Change"===actionText?_c("el-tag",{attrs:{size:"small",color:"#bbbbc"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Control"===actionText?_c("el-tag",{attrs:{size:"small",type:"warning"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Script"===actionText?_c("el-tag",{attrs:{size:"small",type:"warning"}},[_vm._v(_vm._s(actionText))]):_vm._e(),"Change Status"===actionText?_c("el-tag",{attrs:{size:"small",color:"#bbbbc"}},[_vm._v(_vm._s(actionText))]):_vm._e()],1)})),0):_c("div",[_vm._v("---")])]),_c("td",[_c("el-switch",{staticClass:"Notification-toggle",attrs:{"active-color":"rgba(57, 178, 194, 0.8)","inactive-color":"#e5e5e5"},on:{change:function($event){return _vm.changeRuleStatus(rule)}},model:{value:rule.status,callback:function($$v){_vm.$set(rule,"status",$$v)},expression:"rule.status"}})],1),_c("td",{staticStyle:{width:"15%"}},[rule.locked?_vm._e():_c("div",{staticClass:"text-left actions",staticStyle:{"margin-top":"0px","margin-right":"15px","text-align":"center"}},[_c("i",{staticClass:"el-icon-edit pointer",on:{click:function($event){return _vm.editAlarmAction(rule)}}}),_vm._v("    "),_c("i",{staticClass:"el-icon-delete pointer",on:{click:function($event){return _vm.deleteRule(rule)}}})])])])})),0):_c("tbody",[_c("tr",[_c("td",{staticClass:"text-center",attrs:{colspan:"100%"}},[_vm._v(" "+_vm._s(_vm.$t("setup.empty.no"))+" "+_vm._s(_vm.$validation.isEmpty(_vm.currentAction)?"Rules":_vm.currentAction)+" "+_vm._s(_vm.$t("setup.empty.created_yet"))+" ")])])])])])])])])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),NewCustomTypeRule=(__webpack_require__(434284),__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(947522),__webpack_require__(670560),__webpack_require__(865137),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(991326)),validation=__webpack_require__(990260),isEqual=__webpack_require__(618446),isEqual_default=__webpack_require__.n(isEqual),FPagination=__webpack_require__(929593),api=__webpack_require__(32284),ModuleActionListvue_type_script_lang_js={components:{NewCustomTypeRule:NewCustomTypeRule/* default */.Z,Pagination:FPagination/* default */.Z},props:["modules","isCustomModule"],computed:{currentAction:function(){var $route=this.$route,currentAction=$route.meta.currentAction;return currentAction},currentRuleType:function(){var currentAction=this.currentAction;return(0,validation/* isEmpty */.xb)(currentAction)?null:"WorkFlow"===currentAction?37:38},workFlowActionHash:function(){var isCustomModule=this.isCustomModule,modules=this.modules,moduleName=isCustomModule?"customModules":modules.name;return this.$constants.WorkFlowAction.module[moduleName]||this.$constants.WorkFlowAction.module.customModules},currentActionTab:function(){var workFlowActionHash=this.workFlowActionHash,currentAction=this.currentAction;return(0,validation/* isEmpty */.xb)(workFlowActionHash)?{}:workFlowActionHash.tabs.find((function(tab){return tab.name===currentAction}))},activityTypes:function(){var workFlowActionHash=this.workFlowActionHash;return workFlowActionHash.activityTypes},title:function(){var modules=this.modules;if(!(0,validation/* isEmpty */.xb)(modules)){var displayName=modules.displayName;return"".concat(displayName)}return""},page:function(){return this.$route.query.page||1},isWorkPermitLicenseEnabled:function(){var $helpers=this.$helpers,_ref=$helpers||{},isLicenseEnabled=_ref.isLicenseEnabled;return isLicenseEnabled("WORK_PERMIT")}},watch:{modules:{handler:function(newVal,oldVal){isEqual_default()(newVal,oldVal)||(0,validation/* isEmpty */.xb)(newVal)||this.loadActions()}},page:function(newVal,oldVal){newVal!==oldVal&&(this.loadActions(),this.loadCount())}},data:function(){return{showNewCustomRule:!1,workFlowRules:[],isNew:!0,showDeleteDialog:!1,selectedRule:null,loading:!0,totalCount:null,selectedRuleId:null}},created:function(){var modules=this.modules,page=this.page;(0,validation/* isEmpty */.xb)(modules)||1!==page||(this.loadActions(),this.loadCount())},methods:{changeRuleStatus:function(rule){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var url,params,_yield$API$post,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return url=rule.status?"turnonrule":"turnoffrule",params={workflowId:rule.id},_context.next=4,api/* API */.bl.post("/setup/"+url,params);case 4:_yield$API$post=_context.sent,error=_yield$API$post.error,error&&_this.$message.error(error.message||_this.$t("setup.failed.rule_status_change_failed"));case 7:case"end":return _context.stop()}}),_callee)})))()},setActionText:function(actions){var isWorkPermitLicenseEnabled=this.isWorkPermitLicenseEnabled;if(actions){var typeString=[];return actions.forEach((function(d){3===d.actionType?-1===typeString.indexOf("Email")&&typeString.push("Email"):4===d.actionType?-1===typeString.indexOf("SMS")&&typeString.push("SMS"):7===d.actionType?-1===typeString.indexOf("Mobile")&&typeString.push("Mobile"):11===d.actionType?-1===typeString.indexOf("Create WorkOrder")&&typeString.push("Create WorkOrder"):12===d.actionType?-1===typeString.indexOf("Close WorkOrder")&&typeString.push("Close WorkOrder"):13===d.actionType?-1===typeString.indexOf("Field Change")&&typeString.push("Field Change"):19===d.actionType?-1===typeString.indexOf("Change Status")&&typeString.push("Change Status"):18===d.actionType?-1===typeString.indexOf("Control")&&typeString.push("Control"):21===d.actionType?-1===typeString.indexOf("Script")&&typeString.push("Script"):26===d.actionType?-1===typeString.indexOf("Whatsapp")&&isWorkPermitLicenseEnabled&&typeString.push("Whatsapp"):27===d.actionType&&-1===typeString.indexOf("Call")&&isWorkPermitLicenseEnabled&&typeString.push("Call")})),typeString.sort()}return"---"},loadActions:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var modules,currentRuleType,name,params,_yield$API$get,error,data,workflowRuleList;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return modules=_this2.modules,currentRuleType=_this2.currentRuleType,name=modules.name,_this2.loading=!0,params={ruleType:currentRuleType,moduleName:name,page:_this2.page,perPage:10},_context2.next=6,api/* API */.bl.get("/v2/modules/rules/list",params);case 6:_yield$API$get=_context2.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?_this2.$message.error(error.message):(workflowRuleList=data.workflowRuleList,_this2.workFlowRules=workflowRuleList||[]),_this2.loading=!1;case 11:case"end":return _context2.stop()}}),_callee2)})))()},loadCount:function(){var _this3=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var name,currentRuleType,params,_yield$API$get2,data,error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return name=_this3.modules.name,currentRuleType=_this3.currentRuleType,params={ruleType:currentRuleType,moduleName:name},_context3.next=4,api/* API */.bl.get("/v2/modules/rules/getCount",params);case 4:_yield$API$get2=_context3.sent,data=_yield$API$get2.data,error=_yield$API$get2.error,error?_this3.$message.error(error.message):_this3.totalCount=_this3.$getProperty(data,"count",null);case 8:case"end":return _context3.stop()}}),_callee3)})))()},editAlarmAction:function(rule){this.selectedRuleId=rule.id,this.isNew=!1,this.showNewCustomRule=!0},checkActivityType:function(value){var activityTypes=this.activityTypes;return(activityTypes.find((function(type){return type.value===value}))||{}).label},actionOnSave:function(){this.loadActions(),this.loadCount()},deleteRule:function(selectedRule){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var value,params,_yield$API$post2,error,idx;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_this4.$dialog.confirm({title:_this4.$t("setup.delete.delete_rule"),message:_this4.$t("setup.delete.are_you_sure_you_want_to_delete_this_rule"),rbDanger:!0,rbLabel:_this4.$t("setup.delete.delete")});case 2:if(value=_context4.sent,!value){_context4.next=10;break}return params={ids:[selectedRule.id]},_context4.next=7,api/* API */.bl.post("/v2/modules/rules/delete",params);case 7:_yield$API$post2=_context4.sent,error=_yield$API$post2.error,error?_this4.$message.error(error.message||_this4.$t("setup.delete.rule_deletion_failed")):(_this4.$message.success(_this4.$t("setup.delete.rule_deleted_successfully")),idx=_this4.workFlowRules.findIndex((function(rule){return rule.id===selectedRule.id})),_this4.workFlowRules.splice(idx,1),_this4.totalCount--);case 10:case"end":return _context4.stop()}}),_callee4)})))()}}},notificationAndWorkflows_ModuleActionListvue_type_script_lang_js=ModuleActionListvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(notificationAndWorkflows_ModuleActionListvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,ModuleActionList=component.exports},
/***/991326:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return NewCustomTypeRule}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/pages/setup/notificationAndWorkflows/NewCustomTypeRule.vue?vue&type=template&id=0abc87fc
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("el-dialog",{staticStyle:{"z-index":"1999"},attrs:{visible:_vm.visibilityshow,fullscreen:!0,"append-to-body":!0,"before-close":_vm.closeDialog,"custom-class":"fc-dialog-form fc-dialog-right custom-rule-dialog setup-dialog50 setup-dialog"},on:{"update:visible":function($event){_vm.visibilityshow=$event}}},[_c("div",{attrs:{id:"new-custom-rule"}},[_c("error-banner",{attrs:{error:_vm.error,errorMessage:_vm.errorMessage}}),_c("el-form",{ref:"newCustomRule",attrs:{model:_vm.data,"label-position":"top"}},[_c("div",{staticClass:"new-header-container"},[_c("div",{staticClass:"new-header-modal"},[_c("div",{staticClass:"new-header-text"},[_c("div",{staticClass:"setup-modal-title"},[_vm._v(_vm._s(_vm.title))])])])]),_vm.loading?_c("div",{staticClass:"new-body-modal"},[_c("el-row",[_c("el-col",{staticClass:"pR10",attrs:{span:12}},[_c("span",{staticClass:"line1 loading-shimmer width50"}),_c("span",{staticClass:"line2 loading-shimmer width100"})]),_c("el-col",{staticClass:"pL10",attrs:{span:12}},[_c("span",{staticClass:"line1 loading-shimmer width50"}),_c("span",{staticClass:"line2 loading-shimmer width100"})])],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("span",{staticClass:"line3 loading-shimmer width50"}),_c("span",{staticClass:"line4 loading-shimmer width100"})])],1)],1):_c("div",{staticClass:"new-body-modal"},[_c("el-row",{attrs:{gutter:20}},[_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"name"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("common.roles.name"))+" ")]),_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{autofocus:!0,placeholder:_vm.$t("setup.setupLabel.action_name")},model:{value:_vm.data.rule.name,callback:function($$v){_vm.$set(_vm.data.rule,"name",$$v)},expression:"data.rule.name"}})],1)],1),_c("el-col",{attrs:{span:12}},[_c("el-form-item",{attrs:{prop:"siteId"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("space.sites._site"))+" ")]),_c("Lookup",{attrs:{field:_vm.fields.site,hideLookupIcon:!0},on:{recordSelected:_vm.setSelectedValue,showLookupWizard:_vm.showLookupWizardSite},model:{value:_vm.data.rule.siteId,callback:function($$v){_vm.$set(_vm.data.rule,"siteId",$$v)},expression:"data.rule.siteId"}})],1)],1)],1),_c("el-row",[_c("el-col",{attrs:{span:24}},[_c("el-form-item",{attrs:{prop:"description"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("space.sites.site_description"))+" ")]),_c("el-input",{staticClass:"fc-input-full-border-select2",attrs:{"min-rows":1,type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:_vm.$t("common._common.enter_desc"),reseize:"none"},model:{value:_vm.data.rule.description,callback:function($$v){_vm.$set(_vm.data.rule,"description",$$v)},expression:"data.rule.description"}})],1)],1)],1),_c("el-row",{attrs:{gutter:20}},[_c("el-col",{staticClass:"utility-block",attrs:{span:12}},[_c("p",{staticClass:"subHeading-pink-txt"},[_vm._v(" "+_vm._s(_vm.$t("maintenance._workorder.execute_on"))+" ")]),_c("p",{staticClass:"small-description-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.notify_rule_executed"))+" ")]),_c("el-form-item",{attrs:{prop:"activityType"}},[_c("el-select",{staticClass:"width100 fc-input-full-border-select2",attrs:{placeholder:"Select"},model:{value:_vm.data.rule.event.activityType,callback:function($$v){_vm.$set(_vm.data.rule.event,"activityType",$$v)},expression:"data.rule.event.activityType"}},_vm._l(_vm.activityTypes,(function(type,index){return _c("el-option",{key:index,attrs:{label:type.label,value:type.value}})})),1)],1)],1)],1),524288===_vm.data.rule.event.activityType||1048576===_vm.data.rule.event.activityType?_c("div",{staticClass:"fc-div-bg-border mB20"},[524288===_vm.data.rule.event.activityType?_c("div",[_c("el-row",[_c("el-col",{attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.dateField"))+" ")]),_c("el-select",{staticClass:"width300px",attrs:{placeholder:"Select"},model:{value:_vm.data.rule.dateFieldId,callback:function($$v){_vm.$set(_vm.data.rule,"dateFieldId",$$v)},expression:"data.rule.dateFieldId"}},_vm._l(_vm.filteredDateFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1)],1),_c("el-col",{staticClass:"pL40",attrs:{span:12}},[_c("p",{staticClass:"fc-input-label-txt mB10"},[_vm._v(" "+_vm._s(_vm.$t("setup.setupLabel.scheduled_type"))+" ")]),_c("el-radio-group",{staticClass:"criteria-radio-label",model:{value:_vm.data.rule.scheduleType,callback:function($$v){_vm.$set(_vm.data.rule,"scheduleType",$$v)},expression:"data.rule.scheduleType"}},[_vm.beforeFieldIds.includes(_vm.data.rule.dateFieldId)?_vm._e():_c("el-radio",{key:1,staticClass:"fc-radio-btn",attrs:{label:1}},[_vm._v("Before")]),_c("el-radio",{key:2,staticClass:"fc-radio-btn",attrs:{label:2}},[_vm._v("On ")]),_c("el-radio",{key:3,staticClass:"fc-radio-btn",attrs:{label:3}},[_vm._v("After ")])],1)],1)],1),_c("el-row",{staticClass:"mT30"},[[1,3].includes(parseInt(_vm.data.rule.scheduleType))?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Days")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:"",placeholder:"Select"},model:{value:_vm.dateObject.days,callback:function($$v){_vm.$set(_vm.dateObject,"days",$$v)},expression:"dateObject.days"}},_vm._l(60,(function(index){return _c("el-option",{key:"days-"+index,attrs:{label:index,value:index}})})),1)],1),_vm.checkDateTimeField?[_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Hours")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{clearable:""},model:{value:_vm.dateObject.hours,callback:function($$v){_vm.$set(_vm.dateObject,"hours",$$v)},expression:"dateObject.hours"}},_vm._l(_vm.$constants.HOURS,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1),_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Mins")]),_c("el-select",{staticClass:"fc-input-full-border-select2",attrs:{placeholder:"Select"},model:{value:_vm.dateObject.minute,callback:function($$v){_vm.$set(_vm.dateObject,"minute",$$v)},expression:"dateObject.minute"}},_vm._l(_vm.$constants.MINUTES,(function(index){return _c("el-option",{key:index+1,attrs:{label:index,value:index}})})),1)],1)]:_vm._e()]:_vm._e(),_vm.checkDateTimeField?_vm._e():_c("el-col",{attrs:{span:8}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v("Time")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width100 fc-tag",attrs:{"collapse-tags":""},model:{value:_vm.data.rule.time,callback:function($$v){_vm.$set(_vm.data.rule,"time",$$v)},expression:"data.rule.time"}},_vm._l(_vm.timesOption,(function(time){return _c("el-option",{key:time,attrs:{label:time,value:time}})})),1)],1)],2)],1):1048576===_vm.data.rule.event.activityType?_c("div",[_c("el-row",[1048576===_vm.data.rule.event.activityType?_c("div",{staticClass:"approve-form-item"},[_c("el-form-item",{staticClass:"fc-tag p0 pL10 pR10",attrs:{prop:"activityType"}},[_c("p",{staticClass:"fc-input-label-txt"},[_vm._v(" Field "+_vm._s(_vm.selectedFieldObject.length>0?"("+_vm.selectedFieldObject.length+")":"")+" ")]),_c("el-select",{staticClass:"fc-input-full-border-select2 width50",attrs:{"multiple-limit":3,multiple:"","collapse-tags":"",placeholder:"Select"},model:{value:_vm.selectedFieldObject,callback:function($$v){_vm.selectedFieldObject=$$v},expression:"selectedFieldObject"}},_vm._l(_vm.moduleFields,(function(fld,index){return _c("el-option",{key:index,attrs:{label:fld.displayName,value:fld.id}})})),1),_vm.selectedFieldObject.length<3?_c("el-button",{staticClass:"all-rule-btn",attrs:{slot:"reference"},slot:"reference"},[_c("img",{staticClass:"mL10",attrs:{src:__webpack_require__(353654)}})]):_vm._e()],1)],1):_vm._e()])],1):_vm._e()]):_vm._e(),_c("div",{staticClass:"form-input"},[_c("div",{staticClass:"wo-save-subH"},[_vm._v(" "+_vm._s(_vm.$t("common._common.criteria"))+" ")]),_c("div",{staticClass:"fc-sub-title-desc"},[_vm._v(" "+_vm._s(_vm.$t("common._common.specify_rule_custom",{module:_vm.module}))+" ")]),_c("CriteriaBuilder",{attrs:{moduleName:_vm.module,isOneLevelEnabled:!0},model:{value:_vm.data.rule.criteria,callback:function($$v){_vm.$set(_vm.data.rule,"criteria",$$v)},expression:"data.rule.criteria"}})],1),_c("event-dialog-helper",{ref:"eventDialog",attrs:{ruleType:_vm.ruleType,rule:_vm.data,module:_vm.module,moduleFields:_vm.moduleFields,moduleId:_vm.moduleId,actions:_vm.ruleActions},on:{actions:_vm.addAction}})],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:function($event){return _vm.closeDialog()}}},[_vm._v(_vm._s(_vm.$t("setup.users_management.cancel")))]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.saving},on:{click:_vm.save}},[_vm._v(_vm._s(_vm.saving?_vm.$t("maintenance._workorder.saving"):_vm.$t("maintenance._workorder.save")))])],1)])],1)])],1)},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),objectSpread2=__webpack_require__(595082),EventDialogHelper=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(976801),__webpack_require__(843843),__webpack_require__(434284),__webpack_require__(450886),__webpack_require__(670560),__webpack_require__(339772),__webpack_require__(162506),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(494177)),ErrorBanner=__webpack_require__(297157),NotificationHelper=__webpack_require__(683038),validation=__webpack_require__(990260),utils_field=__webpack_require__(815872),ui_forms=__webpack_require__(141323),dist=__webpack_require__(191853),vuex_esm=__webpack_require__(420629),api=__webpack_require__(32284),fields={site:{isDataLoading:!1,options:[],lookupModuleName:"site",field:{lookupModule:{name:"site",displayName:"Sites"}},multiple:!1,additionalParams:{orderBy:"spaceType",orderType:"asc"}}},NewCustomTypeRulevue_type_script_lang_js={props:["isNew","visibilityshow","mailWidth","module","moduleDisplayName","activityTypes","ruleType","ruleActions","currentAction"],mixins:[NotificationHelper/* default */.Z],data:function(){return{fields:fields,timesOption:[],error:!1,isUpdate:!1,errorMessage:"",selectedFieldObject:[],moduleMeta:null,saving:!1,data:{rule:{name:"",scheduleType:3,description:"",ruleType:null,event:{moduleName:"alarm",activityType:1},dateFieldId:null,time:null,fields:[],criteria:null},siteId:null,actions:[]},dateObject:{days:null,minute:0,hours:0,minu:null},closeWo:{actionType:12},ruleDialog:!0,dateFieldToExclude:["sysCreatedTime","sysModifiedTime","sysDeletedTime"],beforeDateFieldsToExclude:["createdTime","modifiedTime"],dateFieldName:["DATE","DATE_TIME"],loading:!1}},components:{Lookup:ui_forms/* Lookup */.tY,ErrorBanner:ErrorBanner/* default */.Z,EventDialogHelper:EventDialogHelper/* default */.Z,CriteriaBuilder:dist/* CriteriaBuilder */.IP},computed:(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},(0,vuex_esm/* mapState */.rn)({metaInfo:function(state){return state.view.metaInfo}})),{},{moduleFields:function(){return this.$getProperty(this.metaInfo,"fields",null)},moduleId:function(){return this.$getProperty(this.metaInfo,"module.moduleId",null)},checkDateTimeField:function(){var dateFields=this.dateFields,data=this.data,_ref=data||{},rule=_ref.rule,_ref2=rule||{},dateFieldId=_ref2.dateFieldId,field=(dateFields||[]).find((function(fld){return fld.fieldId===dateFieldId}))||{};return!(0,validation/* isEmpty */.xb)(field)&&(0,utils_field/* isDateTimeField */.K)(field)},title:function(){var isNew=this.isNew,module=this.module,currentAction=this.currentAction,moduleDisplayName=this.moduleDisplayName,title=isNew?"New":"Edit";return moduleDisplayName="newreadingalarm"===module?"Alarm":moduleDisplayName,currentAction=(0,validation/* isEmpty */.xb)(currentAction)?"Action":currentAction,title="".concat(title," ").concat(moduleDisplayName," ").concat(currentAction),title},filteredDateFields:function(){var fields=(0,toConsumableArray/* default */.Z)(this.dateFieldToExclude);return 1===this.data.rule.scheduleType&&(fields=[].concat((0,toConsumableArray/* default */.Z)(fields),(0,toConsumableArray/* default */.Z)(this.beforeDateFieldsToExclude))),(this.dateFields||[]).filter((function(field){return!fields.includes(field.name)}))},dateFields:function(){var moduleFields=this.moduleFields,dateFieldName=this.dateFieldName;return(moduleFields||[]).filter((function(d){return(dateFieldName||[]).includes(d.dataTypeEnum._name)}))},beforeFieldIds:function(){var _this=this;return(this.dateFields||[]).filter((function(field){return(_this.beforeDateFieldsToExclude||[]).includes(field.name)})).map((function(field){return field.id}))}}),mounted:function(){for(var i=0;i<=23;i++){var time=(i<10?"0"+i:i)+":";this.timesOption.push(time+"00"),this.timesOption.push(time+"30")}},created:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var selectedRuleId,params,_yield$API$get,data,error,siteId,actions,rule,_fields,dateObj;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(selectedRuleId=_this2.$attrs.selectedRuleId||{},!selectedRuleId||_this2.isNew){_context.next=19;break}return _this2.loading=!0,_context.prev=3,params={ruleId:selectedRuleId},_context.next=7,api/* API */.bl.get("v2/modules/rules/getRule",params);case 7:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this2.$message.error(error.message||"Something went wrong"):(siteId=_this2.$getProperty(data,"workflowRule.siteId")>-1?_this2.$getProperty(data,"workflowRule.siteId"):"",actions=_this2.$getProperty(data,"workflowRule.actions"),rule=_this2.$getProperty(data,"workflowRule"),_fields=_this2.$getProperty(data,"workflowRule.fields"),dateObj=_this2.$getProperty(data,"workflowRule.interval"),rule.dateFieldId=_this2.dateFieldsCheck(rule,dateObj),_this2.data={rule:(0,objectSpread2/* default */.Z)({},rule),siteId:siteId,actions:actions},_this2.$setProperty(_this2.data,"rule.siteId",siteId),_fields&&(_this2.selectedFieldObject=[],_fields.map((function(d){_this2.selectedFieldObject.push(parseInt(d.fieldId))})))),_context.next=16;break;case 13:_context.prev=13,_context.t0=_context["catch"](3),_this2.data.rule={};case 16:return _context.prev=16,_this2.loading=!1,_context.finish(16);case 19:case"end":return _context.stop()}}),_callee,null,[[3,13,16,19]])})))()},methods:{closeDialog:function(){this.$emit("update:visibilityshow",!1)},showLookupWizardSite:function(field,canShow){canShow=!1,this.$set(this,"selectedLookupField",field),this.$set(this,"canShowLookupWizardSite",canShow)},setSelectedValue:function(selectedValues,field){},addAction:function(action){this.data.rule.actions=action},save:function(){var self=this,actions=this.data.actions;if(2048===parseInt(this.data.rule.event.activityType)){var woActionIdx=actions.findIndex((function(action){return 11===action.actionType}));-1!==woActionIdx&&actions.splice(woActionIdx,1)}else if(actions){var idx=actions.findIndex((function(action){return 12===action.actionType}));-1!==idx&&actions.splice(idx,1)}self.data.rule.criteria?Object.keys(self.data.rule.criteria.conditions).forEach((function(kessy){self.data.rule.criteria.conditions[kessy].hasOwnProperty("fieldName")?self.data.rule.criteria&&(self.data.rule.criteria.conditions[kessy].fieldName?(delete self.data.rule.criteria.conditions[kessy].valueArray,delete self.data.rule.criteria.conditions[kessy].operatorsDataType,delete self.data.rule.criteria.conditions[kessy].operatorLabel):self.data.rule.criteria=null):self.data.rule.criteria=null})):self.data.rule.criteriaId=-99,self.selectedFieldObject.length>0?(self.data.rule.fields=[],self.selectedFieldObject.forEach((function(d){self.data.rule.fields.push({fieldId:d})}))):delete self.data.rule.fields,this.data.rule.interval=null,524288===parseInt(this.data.rule.event.activityType)&&this.dateObject&&(this.data.rule.dateFieldId&&(this.checkDateTimeField||(this.dateObject.hours=0,this.dateObject.minute=0)),1===this.data.rule.scheduleType||3===this.data.rule.scheduleType?this.data.rule.interval=this.$helpers.daysHoursMinuToSec(this.dateObject):this.data.rule.interval=null),this.data.rule.dateFieldId||(delete this.data.rule.dateFieldId,this.data.rule.time=null),this.data.rule.dateFieldId&&this.checkDateTimeField&&(this.data.rule.time=null);var apiaction,data=this.$helpers.cloneObject(this.data);if(data.actions=actions,!this.validateForm(data))return!1;if(self.isNew)data.rule.ruleType=this.ruleType,data.rule.event.moduleName=this.module,apiaction="addcustom";else{var newAction=this.$refs.eventDialog.updateAction(data.actions);newAction&&(this.data.actions=[],data.actions=newAction),(0,validation/* isEmpty */.xb)(data.rule.siteId)?data.rule.siteId=-99:data.rule.siteId||delete data.rule.siteId,apiaction="updatecustom"}this.saving=!0,this.$util.addOrUpdateRule(this.module,data,!this.isNew,apiaction).then((function(rule){self.saving=!1,self.$emit("actionSaved",rule),self.closeDialog()})).catch((function(error){self.saving=!1}))},validateForm:function(ruleData){if(this.error=!1,!ruleData.rule.name)return this.error=!0,this.errorMessage="Enter Name ",!1;if(524288===ruleData.rule.event.activityType){if(!ruleData.rule.dateFieldId)return this.error=!0,this.errorMessage="Please select field for on date activity",!1;if(3===ruleData.rule.scheduleType&&!ruleData.rule.interval)return this.error=!0,this.errorMessage="Please select duration",!1}else if(1048576===ruleData.rule.event.activityType&&(!ruleData.rule.fields||!ruleData.rule.fields.length>0))return this.error=!0,this.errorMessage="Please select atleast on field for field change activity",!1;return!(!ruleData.actions||!ruleData.actions.length>0)||(this.error=!0,this.errorMessage="Please select atleast one a action",!1)},dateFieldsCheck:function(rule,dateObj){if(524288===rule.event.activityType&&!(0,validation/* isEmpty */.xb)(rule.dateFieldId)){if(dateObj&&[1,3].includes(parseInt(rule.scheduleType))){var dateObject=this.$helpers.secTodaysHoursMinu(dateObj);this.dateObject=(0,objectSpread2/* default */.Z)({},dateObject)}return rule.dateFieldId}return this.dateObject={days:null,minute:0,hours:0,minu:null},null}}},notificationAndWorkflows_NewCustomTypeRulevue_type_script_lang_js=NewCustomTypeRulevue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(notificationAndWorkflows_NewCustomTypeRulevue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,NewCustomTypeRule=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/40168.js.map