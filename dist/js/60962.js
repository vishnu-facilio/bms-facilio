"use strict";(self["webpackChunkfacilio_web"]=self["webpackChunkfacilio_web"]||[]).push([[60962,34878],{
/***/303514:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return AsyncButton}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/AsyncButton.vue?vue&type=template&id=16ca9ad1
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-button",_vm._b({class:_vm.buttonClass,attrs:{loading:_vm.showLoading,type:_vm.buttonType,size:_vm.size,disabled:_vm.disabled},on:{click:function($event){return _vm.save()}}},"el-button",_vm.$attrs,!1),[_vm._t("default")],2)},staticRenderFns=[],toConsumableArray=__webpack_require__(488478),AsyncButtonvue_type_script_lang_js=(__webpack_require__(260228),__webpack_require__(821694),__webpack_require__(76265),{props:["clickAction","actionParams","buttonType","buttonClass","size","disabled","loading"],data:function(){return{isLoading:!1}},computed:{showLoading:function(){return this.loading||this.isLoading}},methods:{save:function(){var _this=this;if(this.clickAction&&"function"===typeof this.clickAction){this.isLoading=!0;var returnPromise=this.actionParams?this.clickAction.apply(this,(0,toConsumableArray/* default */.Z)(this.actionParams)):this.clickAction(),minimumTimeout=this.$helpers.delay(1e3);returnPromise?Promise.all([returnPromise,minimumTimeout]).finally((function(){_this.isLoading=!1})):this.$helpers.delay(1e3).then((function(){return _this.isLoading=!1}))}}}}),components_AsyncButtonvue_type_script_lang_js=AsyncButtonvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(components_AsyncButtonvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,AsyncButton=component.exports},
/***/534878:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__),
// EXPORTS
__webpack_require__.d(__webpack_exports__,{default:function(){/* binding */return ExecuteTransitionPopup}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/stateflow/ExecuteTransitionPopup.vue?vue&type=template&id=88fc9d08&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:!0,"before-close":_vm.closeDialog,"append-to-body":!0,width:"30%",title:"Change Status","custom-class":"fc-dialog-center-container state-transition-list-dialog"}},[_c("div",[_c("div",{staticClass:"state-transition-list-container"},[_c("el-row",{staticClass:"mB20"},[_c("el-col",{attrs:{span:24}},[_c("el-form",{ref:"stateChooser",attrs:{model:_vm.formModel,rules:_vm.rules,"label-position":"top"}},[_c("el-form-item",{attrs:{label:"Choose Transition",prop:"selectedTransitionId"}},[_c("el-select",{staticClass:"fc-input-full-border2 width100",on:{change:_vm.transitionChangeAction},model:{value:_vm.formModel.selectedTransitionId,callback:function($$v){_vm.$set(_vm.formModel,"selectedTransitionId",$$v)},expression:"formModel.selectedTransitionId"}},_vm._l(_vm.stateTransitions||[],(function(transition){return _c("el-option",{key:transition.id,attrs:{label:transition.name,value:transition.id}})})),1)],1)],1)],1)],1),_vm.selectedTransition&&_vm.selectedTransition.formId>0?_c("div",[_c("TransitionForm",{ref:"state-transition-form",attrs:{moduleName:_vm.selectedTransition.moduleName,recordId:_vm.record.recordId,formId:_vm.selectedTransition.formId,record:_vm.record,transition:_vm.selectedTransition,isExternalModule:_vm.shouldCreateModuleRecord,saveAction:_vm.transitionToState,closeAction:_vm.closeStateFlowForm}})],1):_vm._e()],1),_c("div",{staticClass:"modal-dialog-footer"},[_c("el-button",{staticClass:"modal-btn-cancel",on:{click:_vm.closeDialog}},[_vm._v(" "+_vm._s(_vm.$t("common._common.cancel"))+" ")]),_c("el-button",{staticClass:"modal-btn-save",attrs:{type:"primary",loading:_vm.isSaving},on:{click:_vm.changeState}},[_vm._v(" "+_vm._s(_vm.$t("common._common._save"))+" ")])],1)])])},staticRenderFns=[],regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),TransitionButtons=(__webpack_require__(425728),__webpack_require__(260228),__webpack_require__(987612)),ExecuteTransitionFormvue_type_template_id_15202d02_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_vm.isLoading||_vm.isFormDataLoading?_c("Spinner",{attrs:{size:"80",show:!0}}):[_c("f-webform",{ref:"state-transition-f-form",attrs:{form:_vm.formObj,module:_vm.moduleName,isSaving:_vm.isSaving,canShowPrimaryBtn:!1,canShowSecondaryBtn:!1,canShowNotifyRequester:_vm.canShowNotifyRequester,formLabelPosition:"top",removeDefaultStyling:!0,isEdit:!1},on:{"update:form":function($event){_vm.formObj=$event},save:_vm.submitForm,cancel:_vm.closeAction}})]],2)},ExecuteTransitionFormvue_type_template_id_15202d02_staticRenderFns=[],validation=__webpack_require__(990260),TransitionForm=__webpack_require__(323796),ExecuteTransitionFormvue_type_script_lang_js={extends:TransitionForm/* default */.Z,watch:{formId:{handler:function(newVal,oldVal){newVal!==oldVal&&(this.selectedForm.id=newVal,this.loadFormData())}}},methods:{saveRecord:function(){var $refs=this.$refs;if(!(0,validation/* isEmpty */.xb)($refs)){var fWebFormComponent=$refs["state-transition-f-form"];(0,validation/* isEmpty */.xb)(fWebFormComponent)||fWebFormComponent.saveRecord()}}}},stateflow_ExecuteTransitionFormvue_type_script_lang_js=ExecuteTransitionFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(stateflow_ExecuteTransitionFormvue_type_script_lang_js,ExecuteTransitionFormvue_type_template_id_15202d02_render,ExecuteTransitionFormvue_type_template_id_15202d02_staticRenderFns,!1,null,null,null)
/* harmony default export */,ExecuteTransitionForm=component.exports,api=__webpack_require__(32284),ExecuteTransitionPopupvue_type_script_lang_js={extends:TransitionButtons/* default */.Z,components:{TransitionForm:ExecuteTransitionForm},data:function(){return{selectedTransition:null,formModel:{selectedTransitionId:null},isSaving:!1,rules:{selectedTransitionId:[{required:!0,message:"Please Choose a Transition",trigger:"change"}]}}},methods:{closeDialog:function(){this.$emit("onClose")},transitionChangeAction:function(){var formModel=this.formModel;this.selectedTransition=this.stateTransitions.find((function(transition){return transition.id==formModel.selectedTransitionId}))},changeState:function(){var _this=this,selectedTransition=this.selectedTransition;this.$refs.stateChooser.validate((function(valid){valid&&!(0,validation/* isEmpty */.xb)(selectedTransition)&&((selectedTransition||{}).formId>0?(_this.isSaving=!0,_this.saveFormRecord()):(_this.isSaving=!0,_this.startTransition(selectedTransition)))}))},saveFormRecord:function(){var $refs=this.$refs;if(!(0,validation/* isEmpty */.xb)($refs)){var formComponent=$refs["state-transition-form"];(0,validation/* isEmpty */.xb)(formComponent)||formComponent.saveRecord()}},defaultResponseHandler:function(_ref){var error=_ref.error;this.isSaving=!1,error?(this.$message({showClose:!0,message:error.message||this.$t("maintenance._workorder.state_update_failed"),type:"error"}),this.$emit("transitionFailure")):(this.$message.success(this.$t("maintenance._workorder.state_update_success")),this.$emit("transitionSuccess"))},transitionToState:function(formData,transition){var _this2=this;(0,validation/* isEmpty */.xb)(transition)&&(transition=this.selectedTransition);var url=this.getUrl(transition),params=this.getParams({formData:formData,transition:transition}),defaultResponseHandler=this.defaultResponseHandler,updateFn=this.updateFn,moduleName=this.moduleName;return this.isV3?!(0,validation/* isEmpty */.xb)(updateFn)&&(0,validation/* isFunction */.mf)(updateFn)?updateFn(moduleName,params).then(defaultResponseHandler):api/* API */.bl.updateRecord(moduleName,params).then(defaultResponseHandler):api/* API */.bl.post(url,params).then(function(){var _ref3=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(_ref2){var error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:error=_ref2.error,error?defaultResponseHandler({error:error}):_this2.shouldCreateNotes||_this2.shouldCreateModuleRecord?_this2.v2SubModuleHandler(formData,transition).then((function(){return defaultResponseHandler({})})).catch((function(){
// Edge case where transition is success but record creation fails
_this2.fetchAvailableStates({force:!0}),_this2.$emit("transitionSuccess"),defaultResponseHandler({error:{}})})):defaultResponseHandler({});case 2:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref3.apply(this,arguments)}}())}}},stateflow_ExecuteTransitionPopupvue_type_script_lang_js=ExecuteTransitionPopupvue_type_script_lang_js,ExecuteTransitionPopup_component=(0,componentNormalizer/* default */.Z)(stateflow_ExecuteTransitionPopupvue_type_script_lang_js,render,staticRenderFns,!1,null,"88fc9d08",null)
/* harmony default export */,ExecuteTransitionPopup=ExecuteTransitionPopup_component.exports},
/***/987612:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return TransitionButtons}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/stateflow/TransitionButtons.vue?vue&type=template&id=cca90304&scoped=true
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"display-flex",class:_vm.rootClass},[_vm.hasTransitionBtns?_c("div",{staticClass:"d-flex"},[_c("div",{staticClass:"stateflow-btn-wrapper mL10"},[_c("async-button",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{buttonType:"primary",buttonClass:_vm.asyncBtnClassName,disable:_vm.transitions.featured[0].scheduled,clickAction:_vm.startTransition,actionParams:[_vm.transitions.featured[0]],disabled:_vm.isDisabled,"data-test-selector":_vm.transitions.featured[0].name,title:""+_vm.transitions.featured[0].name,loading:_vm.firstBtnLoading}},[_vm._v(" "+_vm._s(_vm.transitions.featured[0].name)+" ")])],1),_vm.hasDropDownBtns?_c("div",{staticClass:"mL10"},[_c("el-dropdown",{staticClass:"pointer stateflow-btn-wrapper",attrs:{"split-button":"","data-test-selector":_vm.transitions.featured[1].name,disabled:_vm.isDisabled},on:{click:function($event){return _vm.initiateDropdownTransition(_vm.transitions.featured[1])},command:_vm.initiateDropdownTransition}},[_c("div",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"transition-btn-name",attrs:{title:""+_vm.transitions.featured[1].name}},[_vm.dropdownLoading?_c("span",[_c("i",{staticClass:"el-icon-loading"}),_vm._v(" "+_vm._s(_vm.$t("common._common.loading"))+" ")]):_c("span",[_vm._v(_vm._s(_vm.transitions.featured[1].name))])]),_c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},_vm._l(_vm.transitions.dropdown,(function(transition,index){return _c("el-dropdown-item",{key:index,attrs:{command:transition,disabled:_vm.isDisabled,"data-test-selector":transition.name}},[_vm._v(" "+_vm._s(transition.name)+" ")])})),1)],1)],1):_vm.hasOnly2Btns?_c("div",{staticClass:"stateflow-btn-wrapper mL10"},[_c("async-button",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{buttonClass:_vm.asyncBtnClassName,disable:_vm.transitions.featured[1].scheduled,clickAction:_vm.startTransition,actionParams:[_vm.transitions.featured[1]],disabled:_vm.isDisabled,"data-test-selector":_vm.transitions.featured[1].name,title:""+_vm.transitions.featured[1].name,loading:_vm.lastBtnLoading}},[_vm._v(" "+_vm._s(_vm.transitions.featured[1].name)+" ")])],1):_vm._e()]):_vm._e(),_vm.canShowForm?_c("TransitionForm",_vm._b({},"TransitionForm",_vm.transitionFormProps,!1)):_vm._e(),_vm.showConfirmationDialog?_c("ConfirmationDialog",{attrs:{transition:_vm.selectedTransition,confirmations:_vm.confirmationDialogs,onConfirm:_vm.continueTransition,onCancel:_vm.cancelTransition}}):_vm._e()],1)},staticRenderFns=[],defineProperty=__webpack_require__(482482),objectSpread2=__webpack_require__(595082),slicedToArray=__webpack_require__(554621),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),toConsumableArray=__webpack_require__(488478),api=(__webpack_require__(865137),__webpack_require__(976801),__webpack_require__(689730),__webpack_require__(634338),__webpack_require__(538077),__webpack_require__(260228),__webpack_require__(336585),__webpack_require__(425728),__webpack_require__(434284),__webpack_require__(947522),__webpack_require__(169358),__webpack_require__(32284)),AsyncButton=__webpack_require__(303514),TransitionForm=__webpack_require__(323796),TransitionConfirmationsvue_type_template_id_08a79305_render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticStyle:{"z-index":"999999"},attrs:{visible:_vm.dialogVisible,title:_vm.activeDialog.title,width:"540px","custom-class":"confirmation-dialog","append-to-body":"","close-on-click-modal":!1,"before-close":_vm.activeDialog.cancel},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c("div",{staticClass:"message-block"},[_vm._v(" "+_vm._s(_vm.activeDialog.message)+" ")]),_c("div",{staticClass:"dialog-footer"},[_c("el-button",{staticClass:"btn btn--secondary cancel-btn",attrs:{type:"button"},on:{click:_vm.activeDialog.cancel}},[_vm._v(" Cancel ")]),_c("el-button",{staticClass:"btn btn--primary btn--danger delete-btn",attrs:{type:"button",disabled:_vm.loadingOnConfirm,loading:_vm.loadingOnConfirm},on:{click:_vm.activeDialog.proceed}},[_vm._v(" Confirm ")])],1)])},TransitionConfirmationsvue_type_template_id_08a79305_staticRenderFns=[],TransitionConfirmationsvue_type_script_lang_js={props:["confirmations","onConfirm","onCancel"],data:function(){return{dialogVisible:!1,activeDialog:null,currentIndex:0,loadingOnConfirm:!1}},watch:{confirmations:{handler:"startConfirmation",immediate:!0}},methods:{startConfirmation:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(){var confirmations,currentIndex,delay,dialog,dialogObj;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:confirmations=_this.confirmations,currentIndex=_this.currentIndex,delay=_this.$helpers.delay,dialog=confirmations[currentIndex],dialogObj={title:dialog.name,message:dialog.message,proceed:function(){var _proceed=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(currentIndex!==confirmations.length-1){_context.next=9;break}return _this.loadingOnConfirm=!0,_context.next=4,_this.onConfirm();case 4:_this.loadingOnConfirm=!1,_this.dialogVisible=!1,_this.currentIndex=0,_context.next=12;break;case 9:_this.currentIndex+=1,_this.dialogVisible=!1,delay(200).then((function(){return _this.startConfirmation()}));case 12:case"end":return _context.stop()}}),_callee)})));function proceed(){return _proceed.apply(this,arguments)}return proceed}(),cancel:function(){var _cancel=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_this.dialogVisible=!1,_this.currentIndex=0,_this.onCancel();case 3:case"end":return _context2.stop()}}),_callee2)})));function cancel(){return _cancel.apply(this,arguments)}return cancel}()},_this.activeDialog=dialogObj,_this.$nextTick((function(){return _this.dialogVisible=!0}));case 5:case"end":return _context3.stop()}}),_callee3)})))()}}},stateflow_TransitionConfirmationsvue_type_script_lang_js=TransitionConfirmationsvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionConfirmationsvue_type_script_lang_js,TransitionConfirmationsvue_type_template_id_08a79305_render,TransitionConfirmationsvue_type_template_id_08a79305_staticRenderFns,!1,null,null,null)
/* harmony default export */,TransitionConfirmations=component.exports,validation=__webpack_require__(990260),cloneDeep=__webpack_require__(150361),cloneDeep_default=__webpack_require__.n(cloneDeep),TransitionButtonsUtils=__webpack_require__(982072),TransitionButtonsvue_type_script_lang_js={props:["moduleName","record","updateFn","updateUrl","transformFn","transitionFilter","buttonClass","disabled","hideNotifications"],components:{AsyncButton:AsyncButton/* default */.Z,TransitionForm:TransitionForm/* default */.Z,ConfirmationDialog:TransitionConfirmations},created:function(){this.fetchAvailableStates()},data:function(){return{stateTransitions:null,loading:!1,canShowForm:!1,selectedTransition:null,dataForCurrentTransition:null,confirmationDialogs:null,showConfirmationDialog:!1,dropdownLoading:!1,selectedTransitionActions:null,firstBtnLoading:!1,lastBtnLoading:!1}},computed:{isV3:function(){var moduleName=this.moduleName,updateUrl=this.updateUrl;return!(0,validation/* isEmpty */.xb)(moduleName)&&(0,validation/* isEmpty */.xb)(updateUrl)},transitions:function(){if((0,validation/* isEmpty */.xb)(this.stateTransitions))return null;var transitions=(0,toConsumableArray/* default */.Z)(this.stateTransitions).sort((function(first,second){
// sorts array in ascending order but placing all '-1' values at the end
return[-1,0,3].includes(first.buttonType)?1:[-1,0,3].includes(second.buttonType)?-1:first.buttonType-second.buttonType}));return{featured:transitions.slice(0,2)||[],dropdown:transitions.slice(2)||[]}},shouldCreateModuleRecord:function(){var _this$selectedTransit=this.selectedTransition,selectedTransition=void 0===_this$selectedTransit?{}:_this$selectedTransit,_ref=selectedTransition||{},_ref$dialogType=_ref.dialogType,dialogType=void 0===_ref$dialogType?null:_ref$dialogType,formModuleName=_ref.formModuleName;return!(0,validation/* isEmpty */.xb)(dialogType)&&!(0,validation/* isEmpty */.xb)(formModuleName)&&2===dialogType},shouldCreateNotes:function(){var _ref2=this.selectedTransition||{},form=_ref2.form;return 5===this.$getProperty(form,"module.type",null)},rootClass:function(){return""},isDisabled:function(){var loading=this.loading,disabled=this.disabled,dropdownLoading=this.dropdownLoading,firstBtnLoading=this.firstBtnLoading,lastBtnLoading=this.lastBtnLoading;return loading||disabled||dropdownLoading||firstBtnLoading||lastBtnLoading},hasTransitionBtns:function(){var _ref3=this.transitions||{},featured=_ref3.featured;return!(0,validation/* isEmpty */.xb)(featured)},hasDropDownBtns:function(){var _ref4=this.transitions||{},featured=_ref4.featured,dropdown=_ref4.dropdown;return this.hasTransitionBtns&&!(0,validation/* isEmpty */.xb)(dropdown)&&featured.length>1&&dropdown.length>0},hasOnly2Btns:function(){var _ref5=this.transitions||{},featured=_ref5.featured;return this.hasTransitionBtns&&featured.length>1},asyncBtnClassName:function(){var buttonClass=this.buttonClass,isDisabled=this.isDisabled;return"".concat(buttonClass," ").concat(isDisabled&&"disabled"," transition-btn-name")},transitionFormProps:function(){var selectedTransition=this.selectedTransition,record=this.record,shouldCreateModuleRecord=this.shouldCreateModuleRecord,saveDataForTransition=this.saveDataForTransition,cancelTransition=this.cancelTransition,isV3=this.isV3,_ref6=selectedTransition||{},moduleName=_ref6.moduleName,formId=_ref6.formId,_ref7=record||{},recordId=_ref7.id;return{moduleName:moduleName,recordId:recordId,formId:formId,record:record,isV3:isV3,transition:selectedTransition,isExternalModule:shouldCreateModuleRecord,saveAction:saveDataForTransition,closeAction:cancelTransition}}},watch:{moduleName:function(newVal,oldVal){newVal!==oldVal&&this.fetchAvailableStates()},record:function(newVal,oldVal){newVal!==oldVal&&this.fetchAvailableStates({force:!0})}},methods:{refresh:function(){this.fetchAvailableStates()},fetchAvailableStates:function(){var _arguments=arguments,_this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){var _ref8,_ref8$force,force,_yield$API$get,data,error,_ref9,_ref9$currentState,currentState,_ref9$states,states;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:return _ref8=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:{},_ref8$force=_ref8.force,force=void 0!==_ref8$force&&_ref8$force,_this.loading=!0,_context.next=4,api/* API */.bl.get("/v2/statetransition/getAvailableState",{moduleName:_this.moduleName,id:_this.record.id},{force:force});case 4:_yield$API$get=_context.sent,data=_yield$API$get.data,error=_yield$API$get.error,error?_this.stateTransitions=null:(_ref9=data||{},_ref9$currentState=_ref9.currentState,currentState=void 0===_ref9$currentState?null:_ref9$currentState,_ref9$states=_ref9.states,states=void 0===_ref9$states?[]:_ref9$states,currentState&&_this.$emit("currentState",currentState.id),(0,validation/* isEmpty */.xb)(_this.transitionFilter)||(0,validation/* isEmpty */.xb)(_this.states)||(states=states.filter(_this.transitionFilter)),_this.stateTransitions=states||[]),_this.loading=!1;case 9:case"end":return _context.stop()}}),_callee)})))()},startTransition:function(transition){var _ref10=this.transitions||{},featured=_ref10.featured;if(!this.dropdownLoading&&!(0,validation/* isEmpty */.xb)(featured)){var _ref11=featured[0]||{},firstTransitionId=_ref11.id,_ref12=featured[1]||{},lastTransitionId=_ref12.id,_ref13=transition||{},currentTransitionId=_ref13.id;this.firstBtnLoading=currentTransitionId===firstTransitionId,this.lastBtnLoading=currentTransitionId===lastTransitionId}var NOT_CONFIGURED=TransitionButtonsUtils/* actionStatusFlag */.Zj.NOT_CONFIGURED,YET_TO_START=TransitionButtonsUtils/* actionStatusFlag */.Zj.YET_TO_START;return this.selectedTransitionActions=Object.entries(TransitionButtonsUtils/* transitionBtnActions */._M||{}).reduce((function(actionList,_ref14){var _ref15=(0,slicedToArray/* default */.Z)(_ref14,2),action=_ref15[0],transKey=_ref15[1];return actionList[action]=(0,validation/* isEmpty */.xb)(transition[transKey])?NOT_CONFIGURED:YET_TO_START,actionList}),{}),this.selectedTransition=cloneDeep_default()(transition),this.startTransitionProcess()},startTransitionProcess:function(){var selectedTransitionActions=this.selectedTransitionActions,selectedTransition=this.selectedTransition,YET_TO_START=TransitionButtonsUtils/* actionStatusFlag */.Zj.YET_TO_START,IN_PROCESS=TransitionButtonsUtils/* actionStatusFlag */.Zj.IN_PROCESS,FAILED=TransitionButtonsUtils/* actionStatusFlag */.Zj.FAILED,isAnyActionFailed=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.some((function(action){return selectedTransitionActions[action]===FAILED})),currentRunningProcess=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.some((function(action){return selectedTransitionActions[action]===IN_PROCESS}));if(!isAnyActionFailed&&!currentRunningProcess){var nextProcessToStart=TransitionButtonsUtils/* transitionBtnActionsOrder */.jt.find((function(action){return selectedTransitionActions[action]===YET_TO_START}))||null;return(0,validation/* isEmpty */.xb)(nextProcessToStart)?this.continueTransition():(this.$set(this.selectedTransitionActions,nextProcessToStart,IN_PROCESS),"FORM"===nextProcessToStart?(this.showStateFlowForm(),Promise.resolve()):"CONFIRMATION"===nextProcessToStart?this.checkConfirmations(selectedTransition):void 0)}},saveDataForTransition:function(formData){return this.dataForCurrentTransition=cloneDeep_default()(formData),this.$set(this.selectedTransitionActions,"FORM",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),this.closeStateFlowForm(),this.startTransitionProcess()},checkConfirmations:function(transition){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var moduleName,record,params,dataForCurrentTransition,formData,_yield$API$post,error,data,validConfirmationDialogs;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return moduleName=_this2.moduleName,record=_this2.record,params={id:record.id,moduleName:moduleName,transitionId:transition.id},dataForCurrentTransition=_this2.dataForCurrentTransition,(0,validation/* isEmpty */.xb)(transition.formId)||(0,validation/* isEmpty */.xb)(dataForCurrentTransition)||(formData=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},dataForCurrentTransition),dataForCurrentTransition.data||{}),delete formData.data,params["data"]=formData),_context2.next=6,api/* API */.bl.post("v2/statetransition/confirmationDialogs",params);case 6:if(_yield$API$post=_context2.sent,error=_yield$API$post.error,data=_yield$API$post.data,!error){_context2.next=14;break}_this2.defaultResponseHandler({error:error}),_this2.cancelTransition(),_context2.next=22;break;case 14:if(validConfirmationDialogs=data.validConfirmationDialogs,(0,validation/* isEmpty */.xb)(validConfirmationDialogs)){_context2.next=20;break}_this2.confirmationDialogs=validConfirmationDialogs,_this2.showConfirmationDialog=!0,_context2.next=22;break;case 20:return _this2.$set(_this2.selectedTransitionActions,"CONFIRMATION",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),_context2.abrupt("return",_this2.startTransitionProcess());case 22:case"end":return _context2.stop()}}),_callee2)})))()},proceedAfterConfirmation:function(){this.$set(this.selectedTransitionActions,"CONFIRMATION",TransitionButtonsUtils/* actionStatusFlag */.Zj.SUCCESS),this.startTransitionProcess()},initiateDropdownTransition:function(transition){this.dropdownLoading=!0,this.startTransition(transition)},continueTransition:function(){var selectedTransition=this.selectedTransition,_this$dataForCurrentT=this.dataForCurrentTransition,formData=void 0===_this$dataForCurrentT?null:_this$dataForCurrentT;return this.transitionToState(formData,selectedTransition)},cancelTransition:function(){this.selectedTransition=null,this.dataForCurrentTransition=null,this.confirmationDialogs=null,this.dropdownLoading=!1,this.firstBtnLoading=!1,this.lastBtnLoading=!1,this.selectedTransitionActions=null,this.closeStateFlowForm(),this.closeConfirmationDialogs()},getParams:function(_ref16){var formData=_ref16.formData,transition=_ref16.transition,moduleName=this.moduleName,record=this.record,_ref17=record||{},id=_ref17.id,_ref18=transition||{},stateTransitionId=_ref18.id,formId=_ref18.formId,formModuleName=_ref18.formModuleName,serializedFormData=formData;if(this.shouldCreateModuleRecord&&(serializedFormData={relations:(0,defineProperty/* default */.Z)({},formModuleName,[{data:[(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formData),{},{formId:formId})]}])}),this.shouldCreateNotes||!this.isV3){var firstArg={moduleName:moduleName,id:id,stateTransitionId:stateTransitionId},secondArg=this.isV3||this.shouldCreateNotes?null:formData;return this.transformFn(firstArg,secondArg)}return{id:id,stateTransitionId:stateTransitionId,data:serializedFormData||{}}},transitionToState:function(formData,transition){var _this3=this;(0,validation/* isEmpty */.xb)(transition)&&(transition=this.selectedTransition);var url=this.getUrl(transition),params=this.getParams({formData:formData,transition:transition}),defaultResponseHandler=this.defaultResponseHandler,updateFn=this.updateFn,moduleName=this.moduleName,record=this.record;if(this.isV3){if(!(0,validation/* isEmpty */.xb)(updateFn)&&(0,validation/* isFunction */.mf)(updateFn))return updateFn(moduleName,params).then(defaultResponseHandler);var _ref19=record||{},recordId=_ref19.id,_url="v3/action/".concat(moduleName,"/").concat(recordId,"/transition");return api/* API */.bl.patch(_url,params).then(defaultResponseHandler)}return api/* API */.bl.post(url,params).then(function(){var _ref21=(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee3(_ref20){var error;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context3){while(1)switch(_context3.prev=_context3.next){case 0:error=_ref20.error,error?defaultResponseHandler({error:error}):_this3.shouldCreateNotes||_this3.shouldCreateModuleRecord?_this3.v2SubModuleHandler(formData,transition).then((function(){return defaultResponseHandler({})})).catch((function(){
// Edge case where transition is success but record creation fails
_this3.fetchAvailableStates({force:!0}),_this3.$emit("transitionSuccess"),defaultResponseHandler({error:{}})})):defaultResponseHandler({});case 2:case"end":return _context3.stop()}}),_callee3)})));return function(_x){return _ref21.apply(this,arguments)}}())},v2SubModuleHandler:function(formData,transition){var _this4=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee4(){var shouldCreateNotes,shouldCreateModuleRecord,formModuleName;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(shouldCreateNotes=_this4.shouldCreateNotes,shouldCreateModuleRecord=_this4.shouldCreateModuleRecord,formModuleName=transition.formModuleName,!shouldCreateNotes){_context4.next=6;break}return _context4.abrupt("return",_this4.createNoteForModule(formModuleName,formData,transition));case 6:if(!shouldCreateModuleRecord){_context4.next=8;break}return _context4.abrupt("return",_this4.createRecordForModule(formModuleName,formData,transition));case 8:case"end":return _context4.stop()}}),_callee4)})))()},createNoteForModule:function(moduleName,formData){var _this5=this;return new Promise((function(resolve,reject){api/* API */.bl.post("v2/notes/add",{module:moduleName,ticketModuleName:_this5.moduleName,note:{parentId:_this5.record.id,notifyRequester:!1,body:formData.body}}).then((function(_ref22){var error=_ref22.error;error?reject():resolve()}))}))},createRecordForModule:function(moduleName,formData,transition){var data,_ref23=this.record||{},_ref23$siteId=_ref23.siteId,siteId=void 0===_ref23$siteId?null:_ref23$siteId,formId=transition.formId||null,form=transition.form,isCustomModule=this.$getProperty(form,"module.custom",!1);if(isCustomModule)data=(0,objectSpread2/* default */.Z)({moduleName:moduleName,withLocalId:!1},this.constructCustomModuleData({},formData,transition));else
// TODO MOVE to v3
if("workpermit"===moduleName){var datum=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},formData),{},{ticket:{id:this.record.id}});(0,validation/* isEmpty */.xb)(siteId)||(datum.siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(datum.formId=formId),data={workPermitRecords:[datum]}}else{var formObj=this.constructWoModuleData(formData,transition);data={workorder:(0,objectSpread2/* default */.Z)({},formObj)},moduleName="workorders"}var url=isCustomModule?"v2/module/data/add":"/v2/".concat(moduleName,"/add");return new Promise((function(resolve,reject){api/* API */.bl.post(url,data).then((function(_ref24){var error=_ref24.error;error?reject():resolve()}))}))},constructCustomModuleData:function(returnObj,data,transition){var _this6=this;
// Remove once v3 is done for custom modules
if(returnObj["moduleData"]={},data){data.comment&&(returnObj.comment=data.comment,delete data.comment),returnObj["moduleData"]=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},returnObj["moduleData"]),data);var _ref25=this.record||{},_ref25$siteId=_ref25.siteId,siteId=void 0===_ref25$siteId?null:_ref25$siteId,formId=transition.formId||null;!(0,validation/* isEmpty */.xb)(siteId)&&(0,validation/* isEmpty */.xb)(returnObj["moduleData"].siteId)&&(returnObj["moduleData"].siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(returnObj["moduleData"].formId=formId)}var formFields=this.$getProperty(transition,"form.fields")||[],currentModuleLookupField=formFields.find((function(field){return field.lookupModuleName===_this6.moduleName}));return currentModuleLookupField&&(returnObj["moduleData"].data=returnObj["moduleData"].data||{},returnObj["moduleData"].data[currentModuleLookupField.name]=this.record.id),returnObj},constructWoModuleData:function(data,transition){var _this7=this,formData=(0,objectSpread2/* default */.Z)({},data),_ref26=this.record||{},_ref26$siteId=_ref26.siteId,siteId=void 0===_ref26$siteId?null:_ref26$siteId,formId=transition.formId||null;
// Remove once v3 is done for workorders, handle it through relations
!(0,validation/* isEmpty */.xb)(siteId)&&(0,validation/* isEmpty */.xb)(formData.siteId)&&(formData.siteId=siteId),(0,validation/* isEmpty */.xb)(formId)||(formData.formId=formId);var formFields=this.$getProperty(transition,"form.fields")||[],currentModuleLookupField=formFields.find((function(field){var fieldObj=field.field;return field.lookupModuleName===_this7.moduleName&&!fieldObj.default}));return currentModuleLookupField&&(formData.data=formData.data||{},formData.data[currentModuleLookupField.name]={id:this.record.id}),Object.keys(formData).forEach((function(name){var value=formData[name];(0,validation/* isObject */.Kn)(value)&&-99===value.id&&(formData[name]=null)})),formData},defaultResponseHandler:function(){var _this8=this,_ref27=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},error=_ref27.error,delay=this.$helpers.delay,$message=this.$message;error?this.$emit("transitionFailure"):(this.fetchAvailableStates({force:!0}),this.$emit("transitionSuccess")),this.cancelTransition(),this.hideNotifications||(error?$message.error(error.message||this.$t("maintenance._workorder.state_update_failed")):delay(200).then((function(){$message.success(_this8.$t("maintenance._workorder.state_update_success"))})))},closeStateFlowForm:function(){this.canShowForm=!1},showStateFlowForm:function(){this.canShowForm=!0},closeConfirmationDialogs:function(){this.showConfirmationDialog=!1},getUrl:function(transition){return(0,validation/* isFunction */.mf)(this.updateUrl)?this.updateUrl(transition):this.updateUrl}}},stateflow_TransitionButtonsvue_type_script_lang_js=TransitionButtonsvue_type_script_lang_js,TransitionButtons_component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionButtonsvue_type_script_lang_js,render,staticRenderFns,!1,null,"cca90304",null)
/* harmony default export */,TransitionButtons=TransitionButtons_component.exports},
/***/323796:
/***/function(__unused_webpack_module,__webpack_exports__,__webpack_require__){
// EXPORTS
__webpack_require__.d(__webpack_exports__,{Z:function(){/* binding */return TransitionForm}});// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"5f5f0a0c-vue-loader-template"}!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/components/stateflow/TransitionForm.vue?vue&type=template&id=406a8f2a
var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{staticClass:"fc-dialog-header-hide wo-state-transition-dialog-center",staticStyle:{"z-index":"999999"},attrs:{"append-to-body":!0,visible:!0,"custom-class":"wo-web-form",width:_vm.hasMultiColumnElements?"70%":"35%"}},[_vm.isLoading||_vm.isFormDataLoading?_c("Spinner",{attrs:{size:"80",show:!0}}):[_c("div",{staticClass:"header pL30 pB20 pT10 d-flex bold"},[_c("div",{staticClass:"title mT10"},[_vm._v(_vm._s(_vm.formObj.displayName))])]),_c("f-webform",{attrs:{form:_vm.formObj,module:_vm.moduleName,isSaving:_vm.isSaving,isV3Api:_vm.isV3Api,canShowNotifyRequester:_vm.canShowNotifyRequester,canShowPrimaryBtn:!0,canShowSecondaryBtn:!0,isEdit:!0,isEditForm:!0,moduleData:_vm.moduleData,moduleDataId:_vm.moduleDataId,modifyFieldPropsHook:_vm.modifyFieldPropsHook,formLabelPosition:"top"},on:{"update:form":function($event){_vm.formObj=$event},save:_vm.submitForm,cancel:_vm.closeAction}})]],2)},staticRenderFns=[],objectSpread2=__webpack_require__(595082),regeneratorRuntime=__webpack_require__(150124),asyncToGenerator=__webpack_require__(548534),FormCreation=(__webpack_require__(434284),__webpack_require__(634338),__webpack_require__(260228),__webpack_require__(373729)),FWebform=__webpack_require__(434500),validation=__webpack_require__(990260),api=__webpack_require__(32284),CustomButtonUtil=__webpack_require__(746095),TransitionFormvue_type_script_lang_js={extends:FormCreation/* default */.Z,components:{FWebform:FWebform/* default */.Z},props:["moduleName","recordId","transition","record","formId","closeAction","saveAction","isExternalModule","isV3","actionType","isFormOfCustomButton"],data:function(){return{isSaving:!1,selectedForm:{id:this.formId},isFormDataLoading:!1,hasMultiColumnElements:!1,isLoading:!0}},created:function(){var _this=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee(){return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context){while(1)switch(_context.prev=_context.next){case 0:if(!_this.formId){_context.next=5;break}return _context.next=3,_this.loadModuleData();case 3:return _context.next=5,_this.loadFormData();case 5:case"end":return _context.stop()}}),_callee)})))()},computed:{moduleDataId:function(){return this.recordId},canShowNotifyRequester:function(){var moduleName=this.moduleName,record=this.record;return"workorder"===moduleName&&!(0,validation/* isEmpty */.xb)((record||{}).requester)},isV3Api:function(){return this.isV3}},methods:{init:function(){
// override to prevent default code in formcreation
},loadFormData:function(){var _this2=this;return(0,asyncToGenerator/* default */.Z)((0,regeneratorRuntime/* default */.Z)().mark((function _callee2(){var selectedForm,moduleName,moduleData,transition,formModuleName,id,name,formObj,_moduleName,formUrl,_yield$API$get,error,data,form,sections;return(0,regeneratorRuntime/* default */.Z)().wrap((function(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return selectedForm=_this2.selectedForm,moduleName=_this2.moduleName,moduleData=_this2.moduleData,transition=_this2.transition,formModuleName=transition.formModuleName,id=selectedForm.id,name=selectedForm.name,formObj={},_moduleName=_this2.isExternalModule?formModuleName:moduleName,formUrl=-1===id?"/v2/forms/".concat(_moduleName,"?formName=").concat(name,"&fetchFormRuleFields=true"):"/v2/forms/".concat(_moduleName,"?formId=").concat(id,"&fetchFormRuleFields=true"),_this2.isLoading=!0,_context2.next=9,api/* API */.bl.get(formUrl);case 9:return _yield$API$get=_context2.sent,error=_yield$API$get.error,data=_yield$API$get.data,error?_this2.$message.error(error.message):(form=data.form,(0,validation/* isEmpty */.xb)(form)||(formObj=form,_this2.$set(_this2,"formObj",formObj),_this2.setFormLabels(),form.sections&&(
// Check if there are any subforms
// TODO: Also handle for cases where fields with
// span !== 1..ie multiple fields in the same row
sections=form.sections,_this2.hasMultiColumnElements=sections.some((function(section){return section.subFormId>0}))),_this2.isExternalModule||(0,validation/* isEmpty */.xb)(moduleData)||_this2.deserializeData(moduleData))),_this2.isLoading=!1,_context2.abrupt("return",formObj);case 15:case"end":return _context2.stop()}}),_callee2)})))()},setFormLabels:function(){this.formObj.primaryBtnLabel=this.$t("common.roles.save"),this.formObj.secondaryBtnLabel=this.$t("common._common.cancel")},loadModuleData:function(){var _this3=this;
// Keeping this async in case we need to load data from api here
return(0,validation/* isEmpty */.xb)(this.record)?Promise.resolve():new Promise((function(resolve){_this3.$set(_this3,"moduleData",_this3.record),resolve()}))},modifyFieldPropsHook:function(field){var moduleName=this.moduleName,recordId=this.recordId,isFormOfCustomButton=this.isFormOfCustomButton,actionType=this.actionType,isExternalModule=this.isExternalModule,_ref=field||{},displayTypeEnum=_ref.displayTypeEnum,lookupModuleName=_ref.lookupModuleName,isRelatedModuleField="LOOKUP_SIMPLE"===displayTypeEnum&&lookupModuleName===moduleName,isDisabled=isFormOfCustomButton?actionType===CustomButtonUtil/* ACTION_TYPES */.aI.CREATE_RECORD:isExternalModule;if(isRelatedModuleField)return(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},field),{},{isDisabled:isDisabled,value:recordId})},submitForm:function(data){var _this4=this;this.isSaving=!0;var formObj=this.formObj,formId=this.formId,_data=data,subFormFiles=_data.subFormFiles;data=this.serializedData(formObj,data),subFormFiles&&(data=(0,objectSpread2/* default */.Z)((0,objectSpread2/* default */.Z)({},data),{},{subFormFiles:subFormFiles})),this.saveAction(data,formId).catch((function(){_this4.closeAction()})).finally((function(){_this4.isSaving=!1}))}}},stateflow_TransitionFormvue_type_script_lang_js=TransitionFormvue_type_script_lang_js,componentNormalizer=__webpack_require__(801001),component=(0,componentNormalizer/* default */.Z)(stateflow_TransitionFormvue_type_script_lang_js,render,staticRenderFns,!1,null,null,null)
/* harmony default export */,TransitionForm=component.exports}}]);
//# sourceMappingURL=http://localhost:5050/sourcemaps/js/60962.js.map